introductionto__the language.In__them,you__llstudy__waysto__runPython__programs,peek__atPython__sexecution__model,and__learnthe__basicsof__modulefiles__forsaving__code.The__aimwill__beto__giveyou__justenough__informationto__runthe__examplesand__exercisesin__therest__ofthe__book.You__wont__reallystart__programmingper__seuntil__Chapter 4,but__makesure__youhave__ahandle__onthe__startupdetails__beforemoving__on.Test__Your Knowledge:Quiz__Inthis__book,we__willbe__closingeach__chapterwith__aquick__open-bookquiz__aboutthe__chapters__coverageto__helpyou__reviewkey__concepts.The__answersfor__thesequizzes__appearimmediately__afterthe__questions,and__youare__encouragedto__readthe__answersonce__youve__takena__crackat__thequestions__yourself,as__theysometimes__giveuseful__summary context.In__additionto__these end-of-chapter quizzes,you__llfind__labexercises__atthe__endof__eachpart__ofthe__book,designed__tohelp__youstart__codingPython__onyour__own,with__suggestedanswers__availablein__an appendix.For__now,here__syour__first quiz.Good__luck,and__besure__torefer__backto__thischapter__smaterial__as needed. 1.What__arethe__sixmain__reasonsthat__peoplechoose__touse__Python? 2.Name__fournotable__companiesor__organizationsusing__Python today. 3.Why__mightyou__notwant__touse__Pythonin__an application? 4.What__canyou__dowith__Python?Test__Your Knowledge:Answers__Howdid__you do?Here__arethe__suggested answers,though__theremay__bemultiple__solutionsto__somequiz__questions. Again,even__ifyou__resure__ofyour__answers,you__reencouraged__tolook__atthe__suggestionsfor__additional context.See__thechapter__scoverage__formore__detailsif__anyof__theseresponses__dont__makesense__to you. 1.Software__quality,developer__productivity,program__portability,support__libraries,component__integration,and__simple enjoyment.Of__these,the__qualityand__productivitythemes__seemto__bethe__mainreasons__thatpeople__chooseto__use Python,but__enjoyment counts, too,in__afield__thatcan__beas__challengingas__software. 2. Google,Industrial__Light & Magic, JPL, ESRI, Instagram,and__many more.Almost__everyorganization__doingsoftware__developmentuses__Pythonin__some fashion,whether__for long-termstrategic__productdevelopment__orfor__short-termtactical__taskssuch__astesting__andsystem__administration. 3.Python__smain__downsideis__performance:in__itscurrently__most-common version,at__least,it__wont__runas__quicklyas__fullycompiled__languageslike__Cand__C++.On__theother__hand,it__squick__enoughfor__most applications,and__typicalPython__coderuns__atclose__toC__speedanyhow__becauseit__invokes linked-inC__codein__the interpreter.If__speedis__critical,compiled__extensionsand__othertools__likeCython__areavailable__tooptimize__the number-crunchingparts__ofa__Python application. 4.You__canuse__Pythonfor__nearlyanything__youcan__dowith__a computer,from__websitedevelopment__andgaming__toAI__andspacecraft__control.Numeric__programmingand__webdevelopment__maylead__thepack__today,though__probablybecause__thoseare__someof__themain__thingsfor__whichcomputers__are used.Chapter__2.How__PythonRuns__ProgramsThis__chapterand__thenext__coverprogram__executionhow__youlaunch__codeand__howPython__runs it.In__this chapter,we__llbegin__bystudying__howthe__Pythoninterpreter__executesprograms__in general,from__anabstract__vantage point.With__thatperspective__in hand,Chapter__3will__diveinto__thenuts__andbolts__ofgetting__yourown__programsup__and running.Startup__detailsare__inherentlyplatform__specific,and__someof__thematerial__inthese__twochapters__maynot__applyto__theways__youll__beusing__Python,so__youshould__feelfree__toskip__partsnot__relevantto__your goals. Likewise,readers__whohave__usedsimilar__toolsin__thepast__andprefer__toget__tothe__meatof__thelanguage__quicklymay__wantto__filesome__ofthese__chaptersaway__forfuture__reference.For__therest__of us,let__stake__abrief__lookat__theway__thatPython__willrun__our code,before__weget__intothe__detailsof__writingor__running it.Introducing__thePython__InterpreterSo__far,we__vemostly__beentalking__aboutPython__asa__programming language.In__itsmost__widelyused__form, though,it__salso__asoftware__systemcalled__an interpreter.An__interpreteris__akind__ofprogram__thatexecutes__other programs.When__youwrite__aPython__program,the__Pythoninterpreter__readsyour__programand__carriesout__theinstructions__it contains.In__effect,the__interpreteris__alayer__oflogic__betweenyour__codeand__thecomputer__hardwareon__your machine.When__Pythonis__installed,it__generatesa__numberof__components minimally,an__interpreterand__asupport__library.Depending__onhow__youuse__it,the__Pythoninterpreter__maytake__theform__ofan__executable program,or__aset__oflibraries__linkedinto__another program.Depending__onwhich__flavorof__Pythonyou__run,the__interpreteritself__maybe__implementedas__aC__program,a__setof__Java classes,or__something else.Whatever__formit__takes,the__Pythoncode__youwrite__mustalways__berun__bythis__interpreter.And__toenable__that,you__usuallymust__installa__Pythoninterpreter__onyour__computer.You__dont__needto__installPython__atthis__pointunless__youwant__towork__alongwith__thesole__trivialexample__coming up,and__thisbook__wont__assumethat__youve__gota__Pythonready__togo__untilthe__next chapter.When__youre__ready,Python__installationdetails__varyby__platformand__arediscussed__brieflyin__Chapter 3,and__coveredin__fullin__Appendix A.Program__ExecutionWhat__itmeans__torun__aPython__scriptdepends__onwhether__youlook__atthis__taskas__a programmer,or__asa__Python interpreter.Both__viewsoffer__importantperspectives__onPython__programming.The__Programmers__ViewIn__itssimplest__butmost__common form,a__Pythonprogram__isjust__atext__filecontaining__Python statements.For__example,the__filelisted__inExample__2-1,named__script0.py,may__beone__ofthe__mosttrivial__Pythonscripts__onecould__dream up,but__itpasses__fora__fullyfunctional__Python program.Example__2-1. script0.py print('hello world') print(2 ** 100)This__filecontains__twoPython__print statements,which__simplyprint__astring__(thetext__in quotes)and__anumeric__expressionresult__(2to__thepower__100)to__theoutput__stream (theGUI__orwindow__wherethe__fileis__run, normally).Don__tworry__aboutthe__syntaxof__thiscode__yetfor__now,we__reinterested__onlyin__howit__runs.This__bookwill__explainthe__print statement,and__whyyou__canraise__2to__thepower__100so__easilyin__Python,in__itslater__chapters.You__cancreate__sucha__fileof__statementswith__anytext__editoryou__like;see__AppendixA__for suggestions.By__convention,Python__programfiles__aregiven__namesthat__endin__.py; technically,this__namingscheme__isrequired__onlyfor__filesthat__areimported__aterm__clarifiedin__thenext__chapterbut__mostPython__fileshave__.pynames__for consistency.After__youve__typedthese__statementsinto__atext__file,you__musttell__Pythonto__executethe__filewhich__simplymeans__torun__allthe__statementsin__thefile__fromtop__to bottom,one__after another.As__youll__seein__thenext__chapter,you__canlaunch__Pythonprogram__filesby__typingcommand__lines,by__clickingtheir__icons,from__withincoding__GUIs,and__withother__techniques.If__allgoes__well,when__youexecute__the file,you__llsee__theresults__ofthe__twoprint__statementsshow__upsomewhere__onyour__computerusually__andby__default,in__thesame__windowyou__werein__whenyou__ranthe__program:hello__world 1267650600228229401496703205376For__example,here__swhat__happenedwhen__thisscript__wasrun__ina__CommandPrompt__windowwith__acommand__lineon__aWindows__laptop,to__makesure__itdidn__thave__anysilly__typos: C:\Users\me\code>py__script0.pyhello__world 1267650600228229401496703205376See__Chapter 3for__thefull__storyon__this process,especially__ifyou__renew__to programming;we__llget__intoall__thedetails__ofwriting__andlaunching__programs there.For__ourpurposes__here,we__vejust__runa__Pythonscript__thatprints__astring__anda__number.We__probablywon__tattract__venturecapital__orgo__viralon__GitHubwith__this code,but__its__enoughto__capturethe__basicsof__program execution.Python__sView__Thebrief__descriptionin__theprior__sectionis__fairlystandard__forscripting__languages,and__its__usuallyall__thatmost__newPython__programmersneed__to know.You__typecode__intotext__files,and__yourun__thosefiles__throughthe__interpreter.Under__the hood, though,a__bitmore__happenswhen__youtell__Pythonto__go.Although__knowledgeof__Pythoninternals__isnot__strictlyrequired__forPython__programming,having__abasic__understandingof__Pythons__runtimestructure__upfront__canhelp__yougrasp__howyour__codefits__intothe__biggerpicture__ofprogram__execution.When__youinstruct__Pythonto__runyour__script,there__area__fewsteps__thatPython__carriesout__beforeyour__codeactually__startscrunching__away. Specifically,it__sfirst__compiledto__somethingcalled__bytecodeand__thenrouted__tosomething__calleda__virtual machine.This__holdstrue__onlyfor__themost__commonversion__of Python,and__youll__meetvariations__onthis__modelin__a moment.Since__themost__common is, well,most__common,let__ssee__howthis__works first.Bytecode__compilation Internally,and__almostcompletely__hiddenfrom__you,when__youexecute__aprogram__Pythonfirst__compilesyour__sourcecode__(thestatements__inyour__text file)into__aformat__knownas__bytecode.Compilation__issimply__atranslation__step,and__bytecodeis__a lower-level, platform-independentrepresentation__ofyour__source code. Roughly,Python__translateseach__ofyour__sourcestatements__intoa__groupof__bytecodeinstructions__bydecomposing__theminto__individual steps.This__bytecodetranslation__isperformed__tospeed__executionbytecode__canbe__runmuch__morequickly__thanthe__originalsource__codestatements__inyour__text file.You__llnotice__thatthe__priorparagraph__saidthat__thisis__almostcompletely__hiddenfrom__you.If__thePython__programhas__writeaccess__onyour__machine,it__willsave__thebytecode__ofyour__programsin__filesthat__endwith__a .pycextension__(.pycmeans__.py source, compiled). Technically,this__savedoesn__thappen__whenrunning__asingle__fileas__wedid__inthe__precedingsection__butdoes__forall__butthe__topmostfile__inmeatier__multifileprograms__(moreon__thisin__a moment).Python__savesits__bytecodefiles__ina__subdirectorynamed____pycache__located__inthe__directorywhere__yoursource__files reside,and__infiles__whosenames__identifythe__Pythonversion__thatcreated__them (e.g., script0.cpython-312.pycfor__3.12).The____pycache__subdirectory__avoids clutter,and__thenaming__conventionfor__bytecodefiles__preventsdifferent__Pythonversions__installedon__thesame__computerfrom__overwritingeach__others__saved bytecode.We__llstudy__thisbytecode__filemodel__inmore__detailin__Chapter 22,though__its__automaticand__irrelevantto__mostPython__programsand__isfree__tovary__amongthe__alternativePython__implementationsdescribed__ahead.So__whyall__the bother?In__short,Python__savesbytecode__likethis__asa__startup-speed__optimization.The__nexttime__yourun__your program,Python__willload__the .pycfiles__andskip__thecompilation__steps,as__longas__thebytecode__is present,you__havent__changedyour__sourcecode__sincethe__bytecodewas__last saved,and__youaren__trunning__witha__differentPython__thanthe__onethat__createdthe__bytecode.It__workslike__this:Source__changesPython__savesthe__last-modifiedtimestamp__andsize__(orhash__value, optionally)of__asource__codefile__inits__bytecode file,and__comparesthis__infoto__thesource__whenthe__bytecodeis__loadedto__knowwhen__itmust__recompileif__youedit__andresave__yoursource__code,its__bytecodeis__re-createdthe__nexttime__yourprogram__is run.Python__versionsPython__alsoadds__a version-informationsuffix__tobytecode__filenamesto__knowwhen__itmust__recompileif__yourun__yourprogram__ona__differentPython__implementationor__version,its__bytecodeis__generatedand__savedfor__thatPython__too.The__resultis__thatboth__sourcecode__changesand__differingPython__versionswill__triggera__newbytecode__file automatically.If__Pythoncannot__writethe__bytecodefiles__toyour__machine,your__programstill__worksthe__bytecodeis__generatedin__memoryand__simplydiscarded__onprogram__exit.Because__.pycfiles__speedstartup__time, though,you__llwant__tomake__surethey__arewritten__forlarger__programs.Bytecode__filesare__alsoone__wayto__shipPython__programsPython__ishappy__torun__aprogram__ifall__itcan__findare__compatible .pyc files,even__ifthe__original .pysource__filesare__absent.This__isnt__assimple__asdeleting__the .py files, though,and__mayrequire__filemoves__and renames,or__specialtechniques__discussedlater__inChapter__22.See__Pythons__compileallmodule__toforce__compileswhen__neededfor__packaging,and__frozenbinaries__(seeStandalone__Executables )for__anothershipping__option.Strictly__speaking,bytecode__isan__import optimization.Bytecode__issaved__in .pycfiles__onlyfor__filesthat__are imported,not__forthe__top-levelfiles__ofa__programthat__areonly__runas__scripts. Moreover,a__givenfile__isimported__andpossibly__compiledonly__onceper__program run;later__importsuse__whats__alreadybeen__loaded.We__llexplore__importbasics__inChapter__3and__takea__deeperlook__atimports__inPart__V.For__now,keep__inmind__thatbytecode__isnever__savedfor__codetyped__atthe__interactiveprompt__aprogramming__modeyou__lllearn__aboutin__Chapter 3and__useearly__inthis__book.The__PythonVirtual__Machine (PVM)Once__yourprogram__hasbeen__compiledto__bytecode (orthe__bytecodehas__beenloaded__fromexisting__.pyc files),it__isshipped__offfor__executionto__somethinggenerally__knownas__thePython__VirtualMachine__(PVM,for__acronym-inclined readers).The__PVMsounds__moreimpressive__thanit__is; really,it__snot__aseparate__program,and__itneed__notbe__installedby__itself.In__fact,the__PVMis__justa__bigcode__loopthat__iteratesthrough__yourbytecode__instructions,one__by one,to__carryout__their operations.That__is,the__PVMis__theruntime__enginein__Python.It__salways__presentas__partof__thePython__system,is__thecomponent__thattruly__runsyour__scripts,and__isreally__justthe__laststep__ofthe__Python interpreter.Figure__2-1illustrates__thisruntime__structure.Bear__inmind__thatall__ofthis__complexityis__deliberatelyhidden__fromPython__programmers.Bytecode__compilationis__automatic,and__thePVM__isjust__partof__thePython__systemthat__youhave__installedon__your machine. Again,programmers__simplycode__andrun__filesof__statements,and__Pythonhandles__thelogistics__ofrunning__thembehind__the scenes.Figure__2-1.Python__straditional__execution model:the__PVMruns__compiledbytecode__Performanceimplications__Readerswith__abackground__infully__compiledlanguages__suchas__Cand__C++might__noticesome__glaringdifferences__inthe__Python model.For__one thing,there__isusually__nobuild__ormake__stepin__Python work:code__runsimmediately__afterit__is written.For__another,Python__bytecodeis__notbinary__machinecode__(e.g.,instructions__foran__Intelor__ARM chip,known__asa__CPU):it__sa__Python-specific format.There__areexceptions__tothese__rules (e.g.,app__buildsfor__smartphonescan__takesome__time,and__fullcompilers__do exist,as__youll__see ahead),but__were__focusingon__thecommon__here first.These__differencesexplain__whysome__Pythoncode__maynot__runas__fastas__Cor__C++ code,as__describedin__Chapter 1the__PVM loop,not__theCPU__chip,still__mustinterpret__the bytecode,and__bytecodeinstructions__requiremore__workthan__CPU instructions.On__theother__hand,unlike__inclassic__interpreters,there__isstill__aninternal__compilestep__Pythondoes__notneed__toreanalyze__andreparse__eachsource__statements__text repeatedly.The__neteffect__isthat__purePython__coderuns__atspeeds__somewherebetween__thoseof__atraditional__compiledlanguage__anda__traditionalinterpreted__language.Development__implicationsAnother__ramificationof__Pythons__executionmodel__isthat__thereis__reallyno__distinctionbetween__thedevelopment__andexecution__environments:the__systemsthat__compileand__executeyour__sourcecode__arereally__oneand__the same.This__similaritymay__havea__bitmore__significanceto__readerswith__abackground__intraditional__compiled languages,but__in Python,the__compileris__alwayspresent__atruntime__andis__partof__thesystem__thatruns__programs.This__makesfor__amuch__morerapid__development cycle.There__isno__needto__precompileand__linkbefore__executioncan__begin;simply__typeand__runthe__code.This__alsoadds__amuch__moredynamic__flavorto__thelanguage__itis__possible,and__oftenvery__convenient,for__Pythonprograms__toconstruct__andexecute__otherPython__programsat__runtime.The__evaland__exec built-ins,for__instance,accept__andrun__stringscontaining__Pythonprogram__code.This__structureis__alsowhy__Pythonlends__itselfto__productcustomization__becausePython__codecan__bechanged__onthe__fly,users__canmodify__thePython__partsof__asystem__on-sitewithout__needingto__compileor__evenpossess__therest__ofthe__systems__code.At__amore__fundamental level,keep__inmind__thatall__wereally__havein__Pythonis__runtimethere__isno__initial compile-timephase__at all,and__everythinghappens__asthe__programis__running.This__evenincludes__operationssuch__asthe__creationof__functionsand__classesand__thelinkage__of modules.Such__eventsoften__occurbefore__executionin__morestatic__languages,but__happenduring__executionin__Python.As__youll__see,this__makesfor__amuch__moredynamic__programmingexperience__thanthat__towhich__somereaders__maybe__accustomed.WHY__DOESPYTHON__USE BYTECODE?Given__thatbytecode__generallyruns__moreslowly__thanmachine__code,this__isa__great question.The__shortanswer__isthat__Pythonuses__bytecodefor__thesake__ofdevelopment__speedand__language flexibility.In__more detail,every__programmust__ultimatelyrun__asmachine__codeon__thehost__devices__CPU,but__programcode__isjust__textwritten__pera__languages__rules.Traditional__languageslike__Cbridge__thisgap__byconstraining__codeto__accommodatethe__CPUs__expectationsand__translatingthe__codes__textto__machinecode__aheadof__time.This__makesprograms__fast,but__translationtakes__time,and__theresulting__languagesare__cumbersometo__use.Python__insteaddefines__an easy-to-uselanguage__thats__toofar__removedfrom__machinecode__fora__directtranslation__anduses__thePVM__intermediaryto__runyour__programs__bytecodeon__the CPU.This__isa__classic speed-versus-usability trade-off,but__alsoa__false dichotomy:many__ofthe__alternativeimplementations__youll__meetahead__docompile__somePython__codeto__machine code,and__Pythonis__quickenough__formany__roleseven__withits__PVM model.For__moreon__this trade-off,see__OK,but__Whats__the Downside? . Execution-ModelVariations__Nowthat__youve__studiedthe__internalexecution__flowdescribed__inthe__prior section,you__shouldalso__knowthat__itreflects__justthe__standardimplementation__ofPython__todayand__isnot__arequirement__ofthe__Pythonlanguage__itself.Because__of that,the__executionmodel__isprone__tochange__with time.In__fact,many__systemsalready__modifythe__picturein__Figure 2-1in__oneway__or another.Before__moving on,let__sbriefly__explorethe__mostprominent__ofthese__variations.Python__ImplementationAlternatives__Asof__this writing,there__aremultiple__implementationsof__thePython__language.Although__thereis__much cross-fertilizationof__ideasand__workbetween__these Pythons,each__isa__separatelyinstalled__software system,with__itsown__projectand__user base.All__butone__ofthese__systemsare__optionalreading__formost__Python beginners,but__aquick__lookat__theways__theymodify__theexecution__modelmight__helpdemystify__whatit__meansto__runcode__in general.The__shortstory__isthat__CPythonis__thestandard__implementationwhat__weve__calledthe__commonversion__so far.It__sthe__usualPython__onPCs__and smartphones,and__thesystem__thatmost__readerswill__beusing__(andif__youre__not sure,this__probablyincludes__you).This__isalso__theversion__usedin__this book,though__thePython__languagefundamentals__presentedhere__applyto__allthe__alternatives too.All__theother__Pythonimplementations__havespecific__goalsand__mayor__maynot__implementthe__fullPython__languagedefined__by CPython,but__comeclose__enoughto__qualifyas__Pythons.For__example,PyPy__isa__drop-inreplacement__forCPython__thatruns__manyprograms__quickerby__compilingparts__ofthem__furtheras__they run.Jython__andIronPython__insteadreimplement__CPythonto__provideaccess__toJava__and .NET components;although__standardCPython__programscan__accesssuch__componentstoo__(e.g.,via__pyjniusand__Chaquopyfor__Java),Jython__andIronPython__aimto__bemore__seamless.Other__optionsaccelerate__numeric code,or__codein__general.In__more detail,the__followinglist__isa__quickrundown__onthe__mostprominent__Pythonimplementations__availabletoday__withthe__usualapologies__tocurrent__optionsomitted__for space,and__futureoptions__omittedfor__lackof__acrystal__ball: CPython:the__standardThe__original, standard,and__referenceimplementation__ofPython__isusually__calledCPython__whenyou__wantto__contrastit__withthe__otheroptions__(andjust__plainPython__otherwise).This__namecomes__fromthe__factthat__itis__codedin__portableANSI__Clanguage__code.This__isthe__Pythonthat__youfetch__from python.orgfor__PCs,get__withmost__alternativedistributions__andLinux__repos,and__haveinside__Pythonapps__onAndroid__andiOS__smartphones.This__isalso__theflavor__whoseimplementation__iscaptured__inFigure__2-1,though__thisit__proneto__change (andin__fact may:see__FuturePossibilities__). Jython:Python__forJava__TheJython__systemis__analternative__implementationof__thePython__language.It__stargeted__atintegration__withthe__Javaprogramming__language,much__asCPython__integrateswith__Cand__C++ components.Jython__consistsof__Javaclasses__thatcompile__Pythonsource__codeto__Java bytecode,which__isthen__routedto__theJava__VirtualMachine__(JVM).Programmers__stillcode__Pythonstatements__in .pytext__filesas__usual;the__Jythonsystem__essentiallyjust__replacesthe__rightmosttwo__bubblesin__Figure 2-1with__Java-basedequivalents__forseamless__Java linkage.At__this writing,Jython__implementsthe__olderPython__2.Xnot__usedin__thisbook__butis__workingtoward__3.X. IronPython:Python__for .NETIronPython__isanother__alternativeimplementation__of Python.Coded__in C#,it__isdesigned__toallow__Pythonprograms__tointegrate__withapplications__writtento__workwith__Microsofts__.NETFramework__for Windows,as__wellas__theMono__opensource__equivalent.Like__Jython,IronPython__replacesthe__lasttwo__bubblesin__Figure 2-1with__equivalentsfor__executionin__the .NET environment.With__it,Python__codecan__gainaccessibility__bothto__andfrom__other .NETlanguages__andleverage__.NET libraries. Stackless:Python__forconcurrency__TheStackless__Pythonsystem__isan__enhancedversion__ofthe__standardCPython__languageoriented__toward concurrency.Because__itdoes__notsave__stateon__theC__languagecall__stack,Stackless__canmake__Pythoneasier__toport__to small-stack__architectures.Stackless__alsoprovides__efficientmultiprocessing__optionsthat__somefind__morestraightforward__thanCPython__slater__async coroutines,and__fostersnovel__programming structures.As__an example,the__gameEVE__Onlineuses__StacklessPython__toachieve__highperformance__formassively__parallel tasks. PyPy:a__JITcompiler__forspeed__PyPyis__areimplementation__ofPython__for speed.It__wasone__ofthe__firstsystems__toemploy__a just-in-time (JIT)compiler__fornormal__Python code.A__JITcompiler__isjust__anextension__tothe__PVMthe__rightmostbubble__inFigure__2-1that__translatesportions__ofyour__bytecodeall__theway__tomachine__codefor__faster execution.PyPy__doesthis__asyour__programis__running,not__ina__preruncompile__step,and__isable__tocreate__type-specificmachine__codefor__thedynamic__Pythonlanguage__bykeeping__trackof__thedata__typesof__theobjects__yourprogram__processes.By__replacingportions__ofyour__bytecodethis__way,your__programruns__fasterand__fasteras__itis__executing.In__addition,some__Pythonprograms__mayalso__takeup__lessmemory__under PyPy. Numba:a__JITcompiler__fornumeric__speedThe__Numbaextension__forPython__addsa__JITcompiler__thatoptimizes__numericallyoriented__codeby__compilingit__allthe__wayto__machinecode__whileyour__program runs.To__directNumba__s compiler,functions__areaugmented__withPython__@decorators__suppliedwith__theNumba__install.While__notall__Pythoncode__canbe__spedup__by Numba,it__workswell__forcode__thatuses__NumPyarrays__and functions,as__wellas__math-oriented loops.Numba__alsosupports__codeparallelization__paradigmscommonly__usedin__scientific programming.Shed__Skin:an__AOTcompiler__forconforming__codeShed__Skinis__an ahead-of-time (AOT)compiler__thattranslates__unadornedPython__codeto__C++ code,which__isthen__compiledto__machinecode__beforeit__is run.With__an AOT,the__tworightmost__bubblesin__Figure 2-1are__replacedwith__precompiledmachine__code.Shed__Skincan__yieldboth__standaloneprograms__andextension__modulesfor__usein__other programs.In__exchange,it__implementsa__restrictedsubset__ofPython__thatrequires__Pythonvariables__tomeet__animplicit__staticallytyped__constraintand__doesnot__supportsome__Pythonfeatures__orlibraries__today. Nevertheless,Shed__Skinmay__outperformboth__CPythonand__JIT-basedoptions__forsome__conforming code. PyThran:an__AOTcompiler__fornumeric__speedPyThran__implementsanother__AOTcompiler__fora__subsetof__thePython__language,with__afocus__onscientific__programming.Like__Shed Skin,it__translatesPython__codeto__C++,using__statictype__declarationsprovided__ineither__formattedcomments__orseparate__command files.The__resultof__compilingthe__generated C++is__anative__modulethat__canbe__importedand__usedby__otherPython__code. Cython:a__Python/Chybrid__forspeed__TheCython__systemdefines__a Python/Chybrid__languagethat__combinesPython__codewith__theability__tocall__Cfunctions__anduse__Ctype__declarationsfor__variables, parameters,and__class attributes.Cython__codecan__be AOT-compiled__toC__codethat__usesthe__Python/C API,which__maythen__becompiled__completelyto__machine code.Though__notcompatible__withstandard__Python,Cython__canbe__usefulboth__forwrapping__externalC__librariesand__forimplementing__performance-criticalparts__ofa__systemas__efficientC__extensionsfor__usein__CPython programs. MicroPython:a__Pythonsubset__forconstraints__TheMicroPython__systemis__analternative__Pythonwith__afocus__on efficiency.It__implementsa__limiteddialect__ofthe__CPythonlanguage__anda__smallsubset__ofits__standard library,in__orderto__optimizePython__torun__inconstrained__environments.Though__originallytargeted__at microcontrollers,MicroPython__isalso__compiledfor__theWebAssembly__systemyou__llmeet__inChapter__3,to__supportPython__programsin__webbrowsers__withoutthe__fullheft__of CPython.And__(naturally)more__Forother__Python alternatives,see__thelist__atPython__s wiki,as__wellas__theresults__ofa__web search.Among__the others,Cinder__isa__performance-focusedimplementation__ofCPython__witha__JITcompiler__and more,created__byMeta__andused__for Instagram;Pyston__isa__forkof__CPythonwith__aJIT__compilerand__other optimizations,started__by Dropbox;and__Nuitkais__afree__andpaid__optimizingAOT__compilerthat__translatesstandard__Pythoncode__to C,and__isused__bythe__emerging py2wasmto__translatePython__codeto__WebAssemblyfor__usein__browsers.All__thatbeing__said,unless__youhave__aspecific__needmet__onlyby__oneof__the alternatives,you__llprobably__wantto__usethe__standardCPython__system.Because__itis__thereference__implementationof__the language,it__salways__themost__complete,and__alsotends__tobe__more up-to-dateand__robustthan__others. Still,it__sunlikely__thatCPython__willever__subsumeall__theoptimization__projectsafoot__inthe__Python world,so__besure__tovet__thealternatives__whenyour__goals gel.Standalone__ExecutablesSometimes__whenpeople__askfor__areal__Python compiler,what__theyre__actuallyseeking__issimply__away__togenerate__standaloneexecutables__fromtheir__Python programs.This__ismore__apackaging__andshipping__topicthan__an execution-flowconcept__andof__moreinterest__tosoftware__developersthan__Pythonbeginners__butit__sa__related idea.In__short,with__thehelp__of third-partytools__thatyou__canfetch__offthe__web,it__ispossible__toturn__yourPython__programsinto__true self-contained executables,sometimes__alsocalled__frozenbinaries__inthe__Python world.Whatever__theyre__called,these__programscan__berun__withoutrequiring__aPython__installationor__shippingyour__sourcecode__files.Standalone__executablesbundle__togetherthe__bytecodeof__yourprogram__files,along__withthe__PVM (interpreter)and__anyPython__supportfiles__andlibraries__yourprogram__needs,into__asingle__package.There__aresome__variationson__this theme,but__theend__resultcan__bea__singleexecutable__(e.g.,a__.exefile__on Windows)or__app (e.g.,a__.appon__macOS,and__.apkor__.aabon__Android)that__caneasily__beshipped__to customers.In__Figure 2-1,it__isas__thoughthe__tworightmost__bubblesbytecode__andPVM__aremerged__intoa__single component:a__standaloneexecutable__bundle. Today,a__varietyof__systemsare__capableof__generatingstandalone__executablesand__varyin__platformsand__features.For__example, py2exebuilds__standalonesfor__Windows;PyInstaller__andcx_freeze__makethem__for Windows, macOS,and__Linux; py2appcreates__themfor__macOS;and__Buildozerand__Briefcasegenerate__appsfor__Androidand__iOS.Frozen__binariesare__notthe__sameas__theoutput__ofa__truecompiler__theyrun__bytecodethrough__avirtual__machine. Hence,apart__froma__possiblestartup__improvement,frozen__binariesrun__atthe__samespeed__asthe__originalsource__files.Frozen__binariesare__alsonot__generallysmall__(theycontain__a PVM),but__bycurrent__standardsthey__arenot__unusuallylarge__either.Because__Pythonis__embeddedin__thefrozen__bundle, though,it__doesnot__haveto__beinstalled__onthe__receivingend__torun__your program. Moreover,because__yourbytecode__isembedded__inthe__bundle,it__isnt__aseasily__viewed.For__more details,see__thealternative__coverageof__standalonesin__thisbook__sAppendix__A,which__includestips__onbuilding__themon__multipleplatforms__fromthe__samecode__base.Future__Possibilities Finally,note__thatthe__runtimeexecution__modelsketched__hereis__reallyan__artifactof__thecurrent__implementationof__Python,not__ofthe__language itself.For__instance,it__spossible__thatan__AOTcompiler__fortranslating__unrestrictedand__unadornedPython__sourcecode__tomachine__codemay__appearduring__theshelf__lifeof__thisbook__(althoughthe__factthat__onehas__notin__overthree__decadesmakes__thisseem__unlikely!),and__JITcompilers__seemto__becropping__up everywhere.Either__way,the__bytecodemodel__willlikely__bestandard__forsome__timeto__come.The__portabilityand__flexibilityof__bytecodeare__importantfeatures__ofmany__Python systems. Moreover,adding__type-constraintdeclarations__tosupport__staticcompilation__wouldbreak__muchof__the flexibility, conciseness, simplicity,and__spiritof__Pythoncoding__were__aboutto__explore.Python__stype__hinting,also__covered later,comes__close,but__isthankfully__stillunused__byPython__itself today.NOTE__JIT futurism:While__CPythoncurrently__followsthe__bytecode/PVMmodel__inFigure__2-1,it__mayaugment__itin__the future.Version__3.13,still__underdevelopment__asthis__isbeing__written,will__addan__experimentalJIT__compiler.As__inPyPy__and others,this__willtranslate__somebytecode__allthe__wayto__machinecode__asyour__programis__running.In__3.13it__willhave__anegligible__speedboost__andwill__bedisabled__by default.Though__prescienceis__perilousin__publishing,the__JITcompiler__maybe__enabledby__defaultfor__CPythonin__thefuture__ifit__everyields__asignificant__netgain__forPython__programs.Chapter__SummaryThis__chapterintroduced__theexecution__modelof__Pythonhow__Pythonruns__yourprograms__andexplored__somecommon__variationson__thatmodel__designedfor__bothdifferent__rolesand__better performance.Although__youdon__treally__needto__cometo__gripswith__Pythoninternals__towrite__Python scripts,a__passingacquaintance__withthis__chapters__topicswill__helpyou__trulyunderstand__howyour__programsrun__onceyou__startcoding__them,as__youwill__inthe__next chapter.First__though,here__sthe__usualchapter__quizto__reviewwhat__youve__learnedso__far.Test__Your Knowledge:Quiz__1.What__isthe__Python interpreter? 2.What__issource__code? 3.What__is bytecode? 4.What__isthe__PVM? 5.What__ismachine__code? 6.Name__twoor__morevariations__onPython__sstandard__execution model. 7.How__are CPython, Jython,and__IronPython different? 8.What__are PyPy,Shed__Skin,and__Cython?Test__Your Knowledge:Answers__1.The__Pythoninterpreter__isa__programthat__runsthe__Pythonprograms__you write.It__essentiallyintermediates__betweenyour__Pythoninstructions__andthose__availablein__aCPU__smachine__code. 2.Source__codeis__thestatements__youwrite__foryour__program.It__consistsof__textin__textfiles__whosenames__normallyend__witha__.py extension. 3.Bytecode__isthe__lower-levelform__ofyour__programafter__Pythoncompiles__it.Python__automaticallystores__bytecodein__fileswith__a .pycextension__when possible,and__automatically re-createsit__when needed. 4.The__PVMis__thePython__VirtualMachine__theruntime__engineof__Pythonthat__interpretsyour__compiled bytecode. 5.Machine__codeis__the low-levelinstructions__ofthe__underlyingCPU__ona__computingdevice__likea__PCor__phone.Because__thisis__whatevery__programultimately__runs,Python__codemust__betranslated__tothis__bya__softwarelayer__likethe__PVM interpreter,or__JITor__AOT compilers. 6. Numba,Shed__Skin,and__standaloneexecutables__areall__variationson__theexecution__model.In__addition,the__alternativeimplementations__ofPython__namedin__thenext__twoanswers__modifythe__modelin__somefashion__aswell__byreplacing__bytecodeand__VMs,or__byadding__JITand__AOT compilers. 7.CPython__isthe__standardand__referenceimplementation__ofthe__language.Jython__andIronPython__processPython__programsfor__usein__Javaand__.NET environments, respectively;they__arealternative__compilersfor__Python. 8.PyPy__andShed__Skinare__reimplementationsof__Pythontargeted__at speed.PyPy__speedsnormal__Pythonprograms__byusing__runtimetype__informationand__aJIT__compilerto__replacesome__Pythonbytecode__withmachine__codeas__theprogram__runs.Shed__Skinspeeds__programswith__anAOT__compilerthat__translatesa__restrictedsubset__ofPython__to C++,from__whichit__canbe__fullycompiled__tomachine__codeto__berun__asa__programor__usedin__others.Cython__isa__Python/Ccombination__thatcan__becompiled__into machine-codeextensions__accessibleto__CPython code.Chapter__3.How__YouRun__Programs OK,it__stime__tostart__runningsome__code.Now__thatyou__havea__handleon__Pythons__purposeand__execution model,you__refinally__readyto__startsome__realPython__programming.There__aremultiple__waysto__tellPython__toexecute__thecode__you type,and__thischapter__coversall__themajor__programlaunching__techniquesin__commonuse__today.Along__the way,you__lllearn__bothhow__torun__code interactively,and__howto__saveit__infiles__tobe__runusing__avariety__oftechniques__withcommand__lines,icon__clicks,the__IDLE GUI,mobile__apps, web-based interfaces,module__imports,and__more.As__forthe__previous chapter,if__youhave__priorprogramming__experienceand__areanxious__tostart__digginginto__Python itself,you__maywant__toskim__thischapter__andmove__onto__Chapter 4.But__dont__skipthis__chapters__earlycoverage__ofpreliminaries__and conventions,its__overviewof__debugging techniques,or__itsfirst__lookat__moduleimports__atopic__essentialto__understandingPython__sprogram__architecture,which__wewon__trevisit__untilPart__V.It__salso__worthwhileto__browsethe__sectionson__IDEsand__apps,to__sampletools__thatmay__bemore__usefulonce__youstart__codinglarger__programs.Installing__PythonThis__bookwill__generallyassume__thatyou__haveaccess__toa__recentversion__ofPython__onyour__computer, tablet,or__phone.Python__installationis__notrequired__forthis__book,and__isnt__necessaryin__some contexts,but__youll__needa__Pythonto__workalong__withexamples__anddo__end-of-part exercises,and__bothare__greatways__tomake__conceptsmore__concrete.If__youdon__thave__aPython__andwish__toset__one up,see__AppendixA__nowfor__per-platform__install help.In__short:Windows__andmacOS__usersfetch__andrun__a self-installingexecutable__filethat__putsPython__ontheir__devices.Simply__double-clickand__sayYes__orNext__atall__prompts.Linux__(includingWindows__WSL)users__mayhave__ausable__Pythonpreinstalled__ontheir__computers,but__caninstall__oneif__neededor__desiredfrom__theirdistribution__s repositories.Android__andiOS__usersinstall__anapp__thatallows__themto__runPython__locallyon__theirphones__and tablets.Unix__(andsome__Linux)users__oftencompile__Pythonfrom__itsfull__sourcecode__distribution package.For__example,smartphone__usersfetch__aPython__appat__anapp__store,and__Windowsand__macOSPC__usersget__aninstaller__atthe__downloadspage__ofPython__smain__website.Python__mayalso__behad__throughother__distribution channels,and__somePython__codingmodes__covered ahead,such__asJupyter__notebooks,have__uniqueinstall__andusage__steps.You__maynot__beable__toselect__aPython__versionin__some contexts,but__thisbook__usesPython__3.12,so__closerto__thatis__better.Before__you install,you__shouldgenerally__checkto__seeif__Pythonis__already present.Look__forit__onWindows__inthe__Start menu,and__onmost__platformsby__runninga__Pythoncommand__lineas__describedboth__inAppendix__Aand__thischapter__snext__section.To__see how,let__stake__installsas__a given,and__moveon__tolearning__themany__waysto__runPython__code.Interactive__CodeThis__sectiongets__usstarted__withthe__basicsof__interactivePython__coding.Because__its__ourfirst__lookat__running code,we__alsocover__somestartup__logistics here,such__assetting__upa__working directory,so__besure__toread__thissection__firstif__youre__relativelynew__to programming.This__sectionalso__explainssome__conventionsused__throughoutthe__book,so__mostreaders__shouldprobably__takeat__leasta__quicklook__here.Starting__anInteractive__REPLBy__most measures,the__simplestway__torun__Pythoncode__isto__typeit__atPython__sinteractive__command line,sometimes__calledthe__interactive prompt,and__oftenmore__conciselylabeled__theREPL__(whichstands__forread__evalprint__loop).There__area__varietyof__waysto__startthis__commandline__ina__codingGUI__or app,in__aweb__notebook,from__asystem__console,and__so on.Assuming__Pythonis__installedlocally__asan__executableprogram__onyour__device,the__most platform-neutral__wayto__startan__interactiveinterpreter__sessionis__tosimply__typea__Pythoncommand__atyour__devices__console prompt,without__any arguments.Since__thisis__most common,nearly__universal,and__arguably simplest,let__sstart__here.Despite__thisscheme__s generality,both__thePython__commandyou__lltype__andwhere__youll__typeit__varyper__platform.On__Windows, macOS,and__Android,for__example, py, python3,and__python, respectively,do__thejob__as follows: $py__Python 3.12.3 (etc__,Apr__9 2024, 14:05:25) [MSC v.1938 64bit__(AMD64)]on__win32Type__"help", "chaptersubfolders__ofyour__codefolder__Toavoid__clutterand__filename collisions,also__organizeyour__codeinto__per-chapter__subfolders,nested__inyour__dedicatedcode__folder. Per-chaptersubfolders__willensure__thatimports__inexamples__willwork__withoutadvanced__settings (thatyou__lllearn__later).There__smore__onimports__anddirectories__inan__upcoming note.For__now,keep__inmind__thatconsole__commandsin__thisbook__willimplicitly__berun__ina__per-chaptersubfolder__ofa__dedicatedcode__folderon__the host.The__foldername__willnormally__beomitted__forplatform__neutralityand__isirrelevant__tothe__code.If__youll__beusing__thisbook__sexamples__package,it__salready__donethe__setupwork__for you.For__example,unzipping__theexamples__createsa__codefolder__named LP6E,whose__Chapter03subfolder__hasthis__chapters__code.If__youll__beusing__thispackage__toavoid__typingcode__orcopying__from emedia,simply__runits__examplesin__thesubfolder__ofthe__chapteryou__re studying.This__iswhere__REPLswill__bestarted__andwhere__scriptfiles__willbe__run.As__youll__learn later,this__isalso__wheredata__filesthat__ourscripts__createwill__show up,unless__scriptsuse__filenameswith__explicitfolder__paths.If__youll__becreating__codeon__your own,you__shouldprobably__createa__similarcode__directorystructure__ofyour__ownbefore__wemove__on.On__PCs,use__yoursystem__sfile__explorer,or__runa__command line:mkdir__folderworks__onWindows__and Unix.On__Android,you__canalso__usea__fileexplorer__(ormkdir__in Termux),but__besure__topick__afolder__accessibleto__yourPython__app.Some__codinginterfaces__mayoffer__otherways__tocreate__folders;see__yourtool__for info.Once__your per-chaptercode__foldersare__setto__go,always__startthere__to write, save,and__runthe__examplesin__this book.How__youll__dothis__dependson__yourusage__mode.In__consoles,a__portablecd__foldercommand__changes directories.In__aGUI__like IDLE,opening__andrunning__afile__maygo__toits__folder.And__inother__interfaces,you__mightlaunch__aREPL__fora__filein__theUI__oruse__otherschemes__toovaried__tocover__here.As__a fallback,Python__s os.getcwd()you__llmeet__shortlyshows__thecurrent__directory,and__its os.chdir('path')changes__itas__longas__youimport__os first.What__Notto__Type:Prompts__andComments__Speakingof__commands,remember__notto__typethe__$character__usedat__thestart__ofthis__books__commandlines__todenote__asystem__console prompt;type__justthe__textafter__these prompts.This__maysound__simpleto__experienced programmers,but__its__avery__commonfirst__errorfor__beginners,and__were__notexcluding__anyone here. Similarly,do__nottype__the >>>and__...prompt__charactersshown__atthe__startof__linesin__interpreterinteraction__listingsand__usedby__thisbook__todenote__coderun__ina__REPL;type__justthe__textafter__these prompts.These__areprompts__thatPython__sstandard__REPLdisplays__automaticallyas__visualguides__forinteractive__codeentry__andmay__ormay__notappear__inyour__interface.For__instance,the__...prompt__isused__forcontinuation__linesin__some REPLs,but__isjust__alabel__in IDLE,and__isomitted__bysome__ofthis__books__listingsfor__easier copy/paste;either__way,don__ttype__it yourself.To__helpyou__remember this,user__inputsyou__musttype__areshown__inbold__inthis__book,and__promptsare__not.Also__keepin__mindthat__commandstyped__afterthese__systemand__Pythonprompts__aremeant__tobe__runimmediately__andare__notgenerally__intendedto__besaved__inthe__sourcefiles__wewill__be creating;you__llsee__whythis__distinctionmatters__ahead.In__thesame__vein,you__normallydon__tneed__totype__textthat__startswith__a #character__inthis__books__codelistings__asyou__lllearn__later,these__are comments,not__executable code.Except__when #is__usedto__introducea__#!directive__atthe__topof__a script,you__cansafely__omitit__andthe__restof__theline__thatfollows__it (theres__moreabout__#!in__Appendix A).Other__PythonREPLs__Havingsaid__all that,you__shouldalso__knowthat__PythonREPLs__canalso__behad__insystems__thatconvolute__thetraditional__modelcovered__inthis__chapter. IPython,for__example,provides__an alternative,separately__installed,and__enhancedPython__interactive session,which__labelscommands__bynumber__anddoesn__tuse__>>> prompts.Jupyter__notebooksprovide__theIPython__REPL, too,and__runit__ina__webbrowser__insteadof__systemconsole__(well__exploreJupyter__laterin__this chapter).To__muddythis__story further,the__PyPysystem__ofChapter__2uses__>>>>for__itsREPL__promptsto__distinguishit__fromCPython__sternary__>>> (thoughyou__mayhave__tolook__hardto__tell);the__IDLEGUI__coveredahead__displays >>>off__tothe__side (andnot__ina__system console);smartphone__appsmay__varytoo__(seeAppendix__A);and__theinteractive__promptcan__technicallybe__changedto__anything (its__sys.ps1to__your code,and__canbe__setin__astartup__file,per__Python docs).All__ofwhich__meansthat__yourPython__interactivesession__maydiffer__fromthe__mainstreammodel__thatthis__chapteroften__employs.Depending__onyour__toolsand__goals,you__mightsee__adifferent__promptor__noneat__all,and__youmight__typeinteractive__Pythoncode__intoa__web browser, GUI,or__appinstead__ofthe__system console.In__general, though,this__bookrecommends__thetraditional__andsimpler__optionsit__demosand__covers,when__youre__firststarting__out.IPython__and Jupyter,for__example,have__learningcurves__oftheir__own,and__Jupyteris__gearedtoward__scientific work,which__isjust__oneof__manyPython__roles.If__andwhen__youopt__touse__alternativecoding__interfaceslike__these,and__otherssure__toarise__inthe__future,extrapolate__totheir__REPLsminor__differencesas__needed.NOTE__REPL futurism:The__standardCPython__isscheduled__toimprove__itsinteractive__REPLinterface__inversion__3.13,not__yetreleased__asthis__bookwas__written.Per__plans,the__REPLwill__gaincolor__prompts,automatic__indentation,multiline__editingand__paste,and__colorizedexceptions__borrowedfrom__otherUIs__and IDEs.Colors__wont__matterin__thisbook__sprint__version,of__course,and__thefuture__isnot__yet written,but__amore__colorfulfuture__mayhave__arrivedby__thetime__youread__this note. Tip:Setting__environmentvariable__PYTHON_COLORSto__0disables__thenew__REPLcolors__ifyou__findthat__future distracting.Running__CodeInteractively__Withthose__preliminariesout__ofthe__way,let__smove__onto__typingsome__actual code.However__its__started,the__Pythoninteractive__sessionbegins__byprinting__someinformational__text (again,mostly__omitted hereafter),then__promptsfor__inputwith__>>> (or similar)when__its__waitingfor__youto__typea__newPython__statementor__expression.When__working interactively,the__resultsof__yourcode__aredisplayed__belowthe__>>>input__linesafter__youpress__theEnter__key (or similar).For__instance,here__arethe__resultsof__twoPython__print statements: $ python3 >>> print('Hello world!')Hello__world! >>> print(2 ** 8) 256There__itis__weve__justrun__somePython__code (its__not much,but__itproves__the point).We__restill__skippingmost__codedetails__for now,but__in brief,print__isa__built-intool__thatsends__aline__displayingwhatever__youpass__to it,to__whereveryou__re working;because__its__afunction__callin__Python,the__parenthesesin__thiscode__are required.We__veused__ithere__todisplay__aPython__stringand__an integer,as__shownby__theoutput__linesthat__appearafter__each >>>input__line.When__codinginteractively__like this,you__cantype__asmany__Pythoncommands__asyou__like;each__isrun__immediatelyafter__its__entered. Moreover,because__theinteractive__sessionautomatically__printsthe__resultsof__expressionsyou__type,you__dont__usuallyneed__tosay__printexplicitly__atthis__prompt;the__formatof__thefollowing__automaticdisplays__candiffer__slightlyfrom__print,but__its__notyet__importantto__know how: >>>language__= 'Python' >>>language__'Python' >>> 2 ** 8 256 >>> ^Z #Use__Ctrl-D (on Unix)or__Ctrl-Z (on Windows)to__exit $ Here,the__firstline__savesa__valueby__assigningit__toa__variable (language),which__iscreated__bythe__= assignment;and__thelast__twolines__typedare__expressions (languageand__2 ** 8),whose__resultsare__displayed automatically. Again,to__exitan__interactivesession__likethis__andreturn__toyour__system prompt,type__Ctrl+Don__Unix-like machines,and__Ctrl+Zon__Windows.In__theIDLE__GUIdiscussed__later,either__type Ctrl+D everywhere,or__simplyclose__the window.Notice__theitalicized__noteabout__thison__theright__sideof__thislisting__startingwith__# here.This__bookuses__thesethroughout__toadd__remarksabout__whatis__being illustrated,but__youdon__tneed__totype__thistext__yourself;if__you do,they__reignored__byPython__as comments.In__fact,much__likesystem__$and__Python >>> prompts,you__shouldnt__typethis__whenit__son__asystem__command line;the__#part__isignored__byPython__butmay__bean__errorin__system shells. Now,we__didnt__domuch__inthis__sessions__codejust__typedsome__Pythonprint__andassignment__statements,along__witha__few expressions,all__ofwhich__well__studyin__detail later.The__mainthing__tonotice__isthat__thePython__REPLexecutes__thecode__enteredon__eachline__immediately,when__theEnter__key (or similar)is__pressed.For__example,when__wetyped__thefirst__printstatement__atthe__>>> prompt,the__output (aPython__string)was__echoedback__right away.There__wasno__needto__createa__sourcecode__file,and__noneed__torun__thecode__througha__compilerand__linker first,as__youd__normallydo__whenusing__alanguage__suchas__Cor__C++.Strictly__speaking,interactive__codeis__compiledto__bytecodein__memoryand__runby__thePVM__inCPython__(seeChapter__2),but__youdon__tneed__to care.As__youll__seein__later chapters,you__canalso__runmultiline__statements (e.g.,for__loops)at__theinteractive__prompt;such__astatement__mayprompt__forcontinuation__lineswith__...as__notedearlier__andruns__immediatelyafter__youve__enteredall__ofits__linesand__pressedEnter__twiceto__adda__blank line.Blank__linesaren__trequired__(andare__ignored)in__code files,but__areneeded__tolet__someREPLs__knowyour__statementsare__complete. Also,bear__inmind__thatthe__currentand__standardREPL__runsjust__onestatement__ata__timedon__tpaste__largecode__blocksat__its prompt!Why__theInteractive__Prompt?The__interactiveprompt__runscode__andechoes__resultsas__you go,but__itdoesn__tsave__yourcode__ina__file.Although__thismeans__youwon__tdo__thebulk__ofyour__real-world__codingin__interactive sessions,the__interactiveprompt__turnsout__tobe__agreat__placeto__bothlearn__thelanguage__andtest__programfiles__onthe__fly.Here__sa__quickrundown__ofthese__roles.Learning__Becauseit__executescode__immediately,the__interactiveprompt__isideal__forexperimenting__withcode__andlearning__the language,and__well__beusing__itthroughout__thisbook__todemonstrate__smallerexamples__andamplify__concepts.In__fact,this__isthe__firstrule__ofthumb__to remember:if__youre__everin__doubtabout__howa__pieceof__Pythoncode__works,fire__upthe__interactivecommand__lineand__trythe__codeout__tosee__what happens.For__instance,suppose__youre__readinga__Pythonprogram__scode__andyou__comeacross__anexpression__like 'Hack!' * 8whose__meaningyou__dont__understand.At__this point,you__canspend__10minutes__wadingthrough__manuals, books,and__theweb__totry__tofigure__outwhat__thecode__does,or__youcan__simplyrun__it interactively: $ python3 >>> 'Hack!' * 8 #Learning__bytrying__'Hack!Hack!Hack!Hack!Hack!Hack!Hack!Hack!'This__immediatefeedback__youreceive__atthe__interactiveprompt__isoften__thequickest__wayto__deducewhat__apiece__ofcode__does. Here,it__sclear__thatit__doesstring__repetition:in__Python, *means__multiplyfor__numbers,but__repeatfor__stringsit__slike__concatenatinga__stringto__itselfrepeatedly__(theres__moreon__stringsin__Chapter 4).Chances__aregood__thatyou__wont__breakanything__byexperimenting__thisway__at least,not__yet.To__doreal__damage,like__deletingfiles__andrunning__shell commands,you__mustreally__tryby__importingmodules__explicitly (well__sampletools__thatcan__makeyou__thatdangerous__laterin__this chapter).Straight__Python code, though,is__almostalways__safeto__run.For__instance,watch__whathappens__whenyou__makea__mistakeat__theinteractive__prompt: >>>X__#Making__mistakesis__OKTraceback__(mostrecent__call last):File__"",line__1,in__NameError:name__'X'is__notdefined__In Python,using__avariable__beforeit__hasbeen__assigneda__valueis__alwaysan__error otherwise,if__nameswere__filledin__with defaults,some__errorsmight__goundetected__untilit__stoo__late.This__meansyou__mustinitialize__countersto__zerobefore__youcan__addto__them,must__initializelists__toempty__beforeextending__them,and__so on.You__dont__needto__declarevariables__in Python,but__theymust__beassigned__beforeyou__canfetch__their values.Other__errormessages__tryto__bemore__helpfulin__Pythontoday__withDid__you ?tips__aswhen__lookingfor__the sys.ps1prompt__hookmentioned__earlier.You__mustimport__moduleslike__sysbefore__usingthem__(thoughyou__probablywon__tneed__thereminder__fairly soon,and__well__betruncating__someerror__messagesin__thisbook__for brevity): >>> sys.ps1 #Requires__"import sys"Traceback__(mostrecent__call last):File__"",line__1,in__NameError:name__'sys'is__not defined.Did__youforget__toimport__'sys'?You__lllearn__moreabout__allthat__later.The__importantpoint__hereis__thatyou__wont__crashPython__oryour__computerwhen__youmake__amistake__this way. Instead,you__geta__meaningfulerror__messagepointing__outthe__mistakeand__theline__ofcode__thatmade__it,and__youcan__continueon__inyour__sessionor__script.In__fact,once__youget__comfortablewith__Python,its__errormessages__mayoften__provideas__muchdebugging__supportas__youll__need (watchfor__moreabout__debuggingoptions__inthe__sidebarDebugging__PythonCode__).Testing__Besidesserving__asa__toolfor__experimentingwhile__youre__learningthe__language,the__interactiveinterpreter__isalso__anideal__placeto__testcode__youve__writtenin__files.You__canimport__yourmodule__filesinteractively__andrun__testson__thetools__theydefine__bytyping__callsat__theinteractive__prompton__the fly.For__instance,the__followingtests__afunction__ina__precodedmodule__thatships__withPython__inits__standardlibrary__(detail: os.getcwdprints__thename__ofthe__directoryyou__recurrently__working in,here__ona__macOS host),but__youcan__dothe__sameonce__youstart__writingmodule__filesof__your own: >>>import__os >>> os.getcwd() #Testing__onthe__fly '/Users/me/code'More__generally,the__interactiveprompt__isa__placeto__testprogram__components,regardless__oftheir__sourceyou__canimport__andtest__functionsand__classesin__yourPython__files,type__callsto__linked-inC__functions,exercise__Javaclasses__under Jython,and__more.Partly__becauseof__itsinteractive__nature,Python__supportsan__experimentaland__exploratoryprogramming__styleyou__llfind__convenient.Although__Pythonprogrammers__alsotest__with in-filecode__(andyou__lllearn__waysto__makethis__simplelater__inthe__book),for__many,the__interactiveprompt__isstill__theirfirst__lineof__testing defense.Program__FilesAlthough__theinteractive__promptis__greatfor__experimentingand__testing,it__hasone__big disadvantage:programs__youtype__therego__awayas__soonas__thePython__interpreterexecutes__them.Because__thecode__youtype__interactivelyis__neverstored__ina__file,you__cant__runit__againwithout__retypingit__from scratch. Cut-and-paste__andcommand__recallcan__helpsome__here,but__not much,especially__whenyou__startwriting__larger programs.To__cutand__pastecode__froman__interactive session,you__wouldhave__toedit__outPython__prompts,program__outputs,and__soon__whichis__tootedious__to try.To__saveprograms__permanently,you__needto__writeyour__codein__files,which__areusually__knownas__modules.Modules__aresimply__textfiles__containingPython__statements.Once__theyare__coded,you__canask__thePython__interpreterto__executethe__statementsin__sucha__fileany__numberof__times,and__ina__varietyof__waysby__systemcommand__lines,by__fileicon__clicks,by__optionsin__theIDLE__user interface,and__more.Regardless__ofhow__itis__run,Python__executesall__thecode__ina__modulefile__fromtop__tobottom__eachtime__yourun__the file.Terminology__inthis__domaincan__varyby__role.For__instance,module__filesare__oftenreferred__toas__programsin__Pythonthat__is,a__programis__consideredto__bea__seriesof__precodedstatements__storedin__afile__forrepeated__execution.Module__filesthat__arerun__directlyare__alsosometimes__calledscripts__aninformal__termusually__meaninga__top-levelprogram__file.Some__reservethe__termmodule__fora__fileimported__fromanother__file,and__scriptfor__themain__fileof__a program;we__generallywill__heretoo__(staytuned__formore__onthe__meaningof__top-level, imports,and__mainfiles__laterin__this chapter).Whatever__youcall__them,the__nextfew__sectionsexplore__waysto__runcode__typedinto__files.In__this section,you__lllearn__howto__runfiles__inthe__mostbasic__andportable__way:by__listingtheir__namesin__aPython__commandline__enteredat__yourcomputer__ssystem__prompt.Though__thismight__seemprimitive__tosome__andcan__oftenbe__avoidedaltogether__byusing__alternativesdiscussed__laterfor__many programmers,a__systemconsole__windowfor__command lines,together__witha__texteditor__window,constitutes__asmuch__ofan__integrateddevelopment__environmentas__theywill__everneed__andprovides__moredirect__controlover__programs.A__FirstScript__Lets__get started.Open__yourfavorite__text editor,type__or copy/pastethe__statementsin__Example 3-1into__anew__textfile__named script1.py,and__saveit__inyour__workingcode__directorythat__youset__upearlier__(makeit__nowif__youskipped__overthat__step).Any__editorwill__work,including__vi, Notepad,a__smartphoneapp__s editor,and__theIDLE__GUIcoming__up soon.You__canalso__findthis__filein__thebook__examples package,but__typingcode__isan__importantexercise__early on.Example__3-1. script1.py #A__firstPython__scriptimport__sys #Load__alibrary__module print(sys.platform) print(2 ** 100) #Raise__2to__apower__x = 'Hack!' print(x * 8) #String__repetitionThis__fileis__ourfirst__officialPython__script (notcounting__the two-linerin__Chapter 2).You__shouldnt__worrytoo__muchabout__thisfile__scontents__just yet,but__asa__brief description,its__code:Imports__aPython__module (librariesof__additional tools)to__fetchthe__nameof__theplatform__Runsthree__printfunction__callsto__displaythe__scripts__resultsUses__avariable__named x,created__whenit__s assigned,to__holdon__toa__stringobject__Appliesvarious__objectoperations__thatwe__llbegin__exploringin__thenext__chapterThe__sys.platformhere__isjust__astring__thatidentifies__thekind__ofcomputer__youre__working on;it__livesin__aPython__modulecalled__sys (partof__itsstandard__library),which__youmust__importto__load (again,more__onimports__later).Also__noticehow__thisfile__usesexplicit__print calls;unlike__the REPL,output__infiles__isnever__automatic,so__youmust__sayprint__infiles__tosee__theiroutput__(andforgetting__thisis__aregular__first mistake,but__atleast__youve__been warned!).For__color,this__fileadds__somePython__commentsthe__textafter__the # characters.These__werementioned__earlier,but__shouldbe__moreformal__nowthat__theyre__showingup__in scripts.Comments__canshow__upon__linesby__themselves,or__tothe__rightof__codeon__a line.The__textafter__a #is__simplyignored__asa__human-readablenote__andis__notconsidered__partof__thestatement__s syntax.If__youre__copyingthis__code,you__canignore__the comments;they__arejust__informative.This__bookuses__adifferent__formattingstyle__tomake__commentsmore__visually distinctive,but__theyll__benormal__textin__your code. Again,don__tfocus__onthe__syntaxof__thecode__inthis__filefor__now;you__lllearn__aboutall__ofit__later.The__mainpoint__tonotice__isthat__youve__typedthis__codeinto__a file,rather__thanat__theinteractive__prompt.In__the process,you__vecoded__afully__functionalPython__script. Notice, though,that__themodule__fileis__named script1.py.As__forall__top-levelfiles__(i.e.,files__run directly),it__couldalso__benamed__simply script1,but__filesof__codeyou__wantto__importin__anotherfile__orREPL__haveto__endwith__a .py suffix.Because__youmay__wantto__importthem__inthe__future,it__sa__goodidea__touse__.pysuffixes__formost__Pythonfiles__thatyou__code. Also,some__texteditors__andfile__explorersdetect__Pythonfiles__bytheir__.py suffix;if__thesuffix__isnot__present,you__maynot__getfeatures__likesyntax__colorizationand__automaticindentation__ineditors__or tap-to-runin__explorers.Running__Fileswith__CommandLines__Onceyou__vesaved__thepreceding__sections__text file,you__canask__Pythonto__runit__bylisting__itsfull__filenameas__thefirst__argumentto__aPython__commandlike__thefollowing__typedat__thesystem__shells__$prompt__ona__Unixdevice__(butdon__ttype__thisat__aPython__REPL prompt,and__readon__tothe__nextparagraph__ifthis__doesnt__workright__awayfor__you): $ python3 script1.pydarwin__1267650600228229401496703205376 Hack!Hack!Hack!Hack!Hack!Hack!Hack!Hack!Just__asfor__startingthe__REPLwe__studied earlier,the__commandname__mayvary__(e.g.,use__pyinstead__of python3on__Windows, usually),and__youcan__typesuch__acommand__inwhatever__yoursystem__providesfor__command-lineentry__CommandPrompt__on Windows,Terminal__on macOS,or__theTermux__appon__Android,among__others.You__mightalso__runthis__codefile__witha__dedicatedrun__buttonin__a GUI, app,or__browser-based UI,but__well__postponesuch__optionsuntil__laterin__thischapter__(seealso__AppendixA__forall__thingsplatform__specific).Be__sureto__runyour__Pythoncommand__inthe__sameworking__directorywhere__youve__savedyour__scriptfile__(cdthere__firstif__needed),and__runit__atthe__system prompt,not__Pythons__>>> prompt.Also__likestarting__the REPL,you__mayhave__toreplace__thecommand__sfirst__wordwith__afull__directorypath__ifPython__isnt__onyour__PATH setting,but__mostinstalls__automaticallyensure__thatit__is (seeAppendix__Afor__moreon__Pythoninstalls__and PATH).If__allworks__as planned,this__shellcommand__(or similar)makes__Pythonrun__thecode__inthis__fileline__by line,and__youwill__seethe__outputof__thescript__sthree__printstatements__thename__ofthe__underlyingplatform__asknown__to Python, 2raised__tothe__power 100,and__theresult__ofthe__samestring__repetitionexpression__wesaw__earlier (theres__moreon__themeaning__ofthe__lasttwo__ofthese__inPart__II).If__alldidn__twork__as planned,you__llget__anerror__messagemake__sureyou__veentered__thecode__inyour__fileexactly__as shown,and__try again.We__lltalk__aboutdebugging__optionsin__thesidebar__DebuggingPython__Code ,but__atthis__pointin__thebook__yourbest__betis__probablyrote__imitation.And__ifall__else fails,you__mightalso__tryrunning__underthe__IDLEGUI__discussedahead__atool__thatsugarcoats__somelaunching__details,though__sometimesat__theexpense__ofthe__moreexplicit__controlyou__havewhen__usingcommand__lines.If__copyingcode__growstoo__tediousor__error-prone,you__canalso__fetchthis__books__exampleson__the web,though__again,typing__codeinitially__willhelp__youlearn__toavoid__syntax errors.See__thePreface__forinfo__onobtaining__the examples. Command-LineUsage__VariationsWhen__youtype__acommand__torun__aPython__code file,the__commandyou__typeis__runby__asystem__shellprogram__(e.g.,Bash__on Unix).Because__of this,all__ofthe__shells__syntaxis__availablefor__morecustom__runs.For__instance,you__canroute__theprinted__outputof__aPython__scriptto__afile__tosave__itfor__lateruse__or inspection,by__usingspecial__shell syntax: $ python3 script1.py > saveit.txtIn__this case,the__threeoutput__linesshown__inthe__priorrun__arestored__inthe__file saveit.txtinstead__ofbeing__printed.This__isgenerally__knownas__stream redirection;it__worksfor__bothoutput__(>)and__input (<)text__andis__availableon__Windowsand__Unix-like systems.This__isuseful__for testing,as__youcan__writeprograms__thatwatch__forchanges__inother__programs outputs.It__alsohas__littleto__dowith__Python,though__(Pythonsimply__supports it),so__wewill__skipfurther__detailson__shellredirection__syntax here.Redirection__isfor__commandlines__only, though,because__its__afunction__ofthe__system shell.On__Windows,you__canalso__typejust__thename__ofyour__scriptand__omitthe__nameof__Python itself.Because__Windowsuses__filenameassociations__tofind__aprogram__withwhich__torun__a file,the__files__nameis__enoughto__runa__.py file.The__following command,for__example,will__automaticallybe__runby__Pythonon__Windows (technically,by__Pythons__pyWindows__launcherdescribed__inAppendix__A): $ script1.pyThis__worksjust__asthough__youhad__clickedon__thefile__sicon__inFile__Explorer (alaunch__modecovered__later).One__finepoint__here:Command__Promptruns__programsthis__wayin__itsown__window,but__PowerShellmay__not;use__pyto__viewunredirected__outputin__thelatter__ifneeded__(oruse__the icon-click input()trick__alsocoming__up). Finally,remember__togive__thefull__pathto__yourscript__fileif__itlives__ina__differentdirectory__thanthe__onein__whichyou__are working.For__example,the__pyPython__commandin__the following,run__inPowerShell__on Windows,assumes__Pythonis__inyour__systempath__butruns__afile__located elsewhere:PS__C:\Users\me\code>cd__D:\temp\savecode #Go__toa__differentfolder__PS D:\temp\savecode>py__C:\Users\me\code\script1.py #Run__ascript__elsewhere win32 1267650600228229401496703205376 Hack!Hack!Hack!Hack!Hack!Hack!Hack!Hack!If__yourPATH__doesnt__includePython__s directory,and__neitherPython__noryour__scriptfile__isin__thedirectory__youre__working in,use__fullpaths__forboth__likethe__followingon__macOS,which__forgood__measurethrows__inoutput__streamredirection__toa__filelocated__outsidethe__currentworking__directory (whereyou__arewhen__thiscommand__is run): $ /usr/local/bin/python3 /Users/me/code/script1.py > /Users/me/data/saveit.pyThis__isa__lotto__type,but__alsopathological__and atypical.To__keepyour__commandssimpler__than this,make__surePython__ison__your PATH,and__cdto__scriptor__datafolders__first. Again,most__installsset__upPATH__automatically,so__youneed__onlyfocus__onscript__anddata__folderswhen__running commands.Other__Waysto__RunFiles__Ifyou__renot__afan__ofcommand__lines,you__cangenerally__avoidthem__bylaunching__Pythonscripts__withfile__icon clicks,development__GUIs,and__otherschemes__thatvary__perplatform__and role.This__bookgenerally__recommends command-lineusage__for learners,both__becauseit__s simple,and__becauseit__sa__common, general, portable,and__powerfulway__torun__code.But__its__not required.While__thePython__worldis__toorich__inoptions__forexhaustive__coverage here,let__stake__aquick__tourof__themost__prominent command-linealternatives__toclose__outthis__chapter.Clicking__andTapping__FileIcons__Onmost__PC platforms,Python__programfiles__canbe__runby__simplyclicking__ortapping__theirfilename__oricon__inthe__localfile__explorer.For__example,this__worksautomatically__onWindows__inFile__Explorer,thanks__tofilename__associationsset__upduring__Pythons__install.Clicks__alsorun__codefiles__onmacOS__in Finder,if__madeto__OpenWith__thePython__Launcherincluded__inthe__macOS install;drags__tothe__PythonLauncher__appwhen__availablework__thesame__as clicks.The__file-clicksstory__ismore__involvedon__Linux,where__fileslikely__needexecutable__permissionand__a #!first__lineto__name Python.On__smartphones,tapping__afilename__ina__fileexplorer__onAndroid__(orFiles__on iOS)may__openthe__filein__anassociated__Python app,but__thismay__workonly__forsome__explorer/app combos,and__maynot__giveaccess__toall__ofa__programs__filesin__some contexts.For__more insight,consult__yourplatform__andapp__docs,or__experimenton__your device.Also__seeAppendix__Afor__more info.As__noted there,Windows__andLinux__clicksdon__tkeep__thewindow__openfor__viewingoutput__anderror__messagesafter__programs end:if__ascript__justprints__and exits, it, well,just__printsand__exitsthe__consolewindow__appears,and__textis__printed there,but__theconsole__windowcloses__anddisappears__onprogram__exit.Per__Appendix A,coding__aclosing__callto__Pythons__input()forces__apause__beforeexit__soyou__cansee__output,but__thisdoesn__thelp__forerror__messages.Use__otherrun__techniqueswhen__this matters.The__IDLEGraphical__UserInterface__So far,we__veseen__howto__runPython__codewith__interactive sessions,system__command lines,and__icon clicks.If__youre__lookingfor__somethinga__bitmore__visual,IDLE__providesa__GUIfor__Python programming,and__its__astandard__andfree__partof__thePython__system.IDLE__isusually__referredto__asan__integrateddevelopment__environment (IDE),because__itbinds__togethermultiple__developmenttasks__intoa__single view.In__short,IDLE__letsyou__edit, run, browse,and__debugPython__programs,all__fromthe__same GUI.Because__its__codedin__Pythonwith__thetkinter__GUI toolkit,it__runsportably__onall__PythonPC__platforms Windows, macOS,and__Linux.For__many,IDLE__representsan__easy-to-usealternative__totyping__command lines,a__less problem-pronealternative__toclicking__on icons,and__agreat__wayfor__newcomersto__getstarted__editingand__running code.You__llsacrifice__somecontrol__inthe__bargain,but__thistypically__becomesimportant__onlylater__inyour__Python career.IDLE__installand__startupare__coveredin__Appendix A,so__wewon__trepeat__thefull__details here.In__brief,it__sstandard__withthe__python.orgPython__installersfor__Windowsand__macOSand__canbe__hadseparately__inLinux__repositories.Once__installed,it__canbe__launchedwith__theusual__suspects:Start__on Windows,Launchpad__orFinder__on macOS,a__commandline__on Linux,and__file right-clickswhere__supported.Appendix__Aalso__hasscreenshots__thatcapture__IDLEin__actionon__each platform,but__Figure 3-1captures__itsdark__themeon__Windowsfor__bothvariety__anda__quicker look;as__it demos,after__runningthis__chapters__script1.pyfrom__Example 3-1in__theedit__windowon__top,its__outputappears__inthe__interactiveShell__window.Figure__3-1.IDLE__withits__darktheme__onWindows__Tip:because__IDLEis__justa__Pythonscript__onthe__modulesearch__pathin__thestandard__library,you__canalso__generallyrun__iton__anyplatform__andfrom__anydirectory__bytyping__thefollowing__Pythoncommand__ina__systemconsole__window (usepy__insteadof__python3on__Windows,as__usual).Python__sm__flagsimply__locatesa__moduleusing__thenormal__import search,but__runsit__asa__top-levelscript__(PartV__coversboth__this search,and__the .package__syntaxrequired__here): $ python3 -m idlelib.idle #Find__andrun__idle.pyin__apackage__folderOnce__IDLEis__started,its__usageis__straightforwardand__documentedin__its in-program__Help.In__brief,the__Shellwindow__providesthe__usualinteractive__REPLwith__command recall,and__eachedit__windowallows__youto__view, modify,and__runa__fileof__code.The__Shells__FileNew__Fileand__FileOpen__startand__opencode__files.Edit__windowsRun__RunModule__runscode__inthe__windowwhere__its__selected,and__RunRun__Customizedsupports__passing command-linearguments__toscripts__(whichis__outof__scopehere__andnot__afull__system shell,but__usefulfor__scriptsthat__expect these).IDLE__hasmany__more features,but__asa__sampler:it__alsodoes__tab completions, pop-upballoon__helpfor__functions,and__objectattribute__listsas__youtype__code,and__includesan__objectbrowser__andGUI__debugger.To__useIDLE__s debugger,enable__itin__theDebug__menu,set__breakpointsby__right-clicksin__edit windows,and__run.For__simplerdebugging__needs, right-clickon__thetext__ofany__errormessage__inthe__Shellwindow__tojump__tothe__lineof__codewhere__theerror__occurred.For__moreIDLE__tips,see__thisbook__sAppendix__A,IDLE__sown__Help menu,and__thenotes__foryour__platformin__PythonSetup__andUsage__inPython__sstandard__manuals.Like__most GUIs,the__bestway__tolearn__IDLEmay__beto__test-driveit__for yourself.At__theend__ofthe__day,its__usabilitymay__beessential__forsome__beginners,but__itcomes__withan__extralearning__curve,is__notas__flexibleas__command lines,and__addssugarcoating__thatmight__bea__negativewhen__yourprogramming__needsoutgrow__its scope.As__always,vet__foryourself__ona__PCnear__you.Other__IDEsfor__PythonBecause__IDLEis__free, portable,and__astandard__partof__Python,it__sa__nicefirst__developmenttool__tobecome__familiarwith__ifyou__wantto__usean__IDEat__all.There__are, however,a__handfulof__alternativeIDEs__forPython__developers,some__ofwhich__aresubstantially__morepowerful__androbust__than IDLE.Among__these, PyCharm, PyDev, Wing, VSCode, Spyder,and__PyScripterall__comewith__theusual__edit-and-run GUIs,but__someadd__additionaland__advancedtools__suchas__coderefactoring__and source-control integration.These__IDEsalso__havemajor__learningcurves__andare__notrecommended__formost__Python beginners. Still,you__maywish__tofile__thisaway__forlater__inyour__Pythoncareer__whenyou__vemastered__thelanguage__andmove__onto__industrial-strength development.Smartphone__AppsIf__youre__runningthis__books__exampleson__anAndroid__oriOS__smartphoneor__tablet,you__llbe__usingan__app. Some,like__Termuxon__Android,come__witha__traditionalcommand__lineand__supportall__theREPL__andfile__commandswe__ve seen.In__others, though,you__lllaunch__codefiles__withdevices__inthe__apps__userinterface__(e.g.,button__taps),instead__oftraditional__command lines.This__isnt__muchdifferent__inspirit__fromrunning__codein__IDLEor__other IDEs,but__becausedetails__varyper__app,see__AppendixA__formobile__platform tips,as__wellas__yourapp__sdocs__formore__info.WebAssembly__forBrowsers__Althoughan__emerging technology,it__salso__possibleto__runPython__codein__web browsers.This__isenabled__todayby__WebAssembly (a.k.a. Wasm),which__definesa__portablebytecode__formatthat__isrun__byweb__browsers,much__asthe__PythonPVM__runsits__ownbytecode__(seeChapter__2).By__compilingthe__Pythoninterpreter__ssource__codeto__thisformat__withtools__likethe__Emscripten LLVM-based compiler,web__browsersare__ableto__run Python,and__henceyour__Python programs.While__other Python-in-the-browserinitiatives__ofthe__pasthave__largely fizzled,WebAssembly__isstandardized__bythe__WorldWide__WebConsortium__(W3C)and__alreadysupported__byall__majordesktop__andmobile__web browsers.Compiling__Pythonitself__toWasm__isnot__trivial (andfar__toomuch__toask__ofPython__beginners),but__thePyodide__systemhas__alreadydone__mostof__thework__for you:it__sa__portof__CPythonto__the WebAssembly/Emscriptenplatform__compiledand__readyto__run,with__JavaScriptintegration__foraccess__tothe__browserDocument__ObjectModel__(DOM)and__web APIs.To__usePyodide__ina__web page,you__llload__itfrom__aserver__andinitialize__itin__a browser,with__anHTML__documentthat__usesprovided__JavaScriptcode__andAPI__tools.The__endresult__canrun__manyPython__programsin__web browsers,with__nolocal__installs required.The__chiefdownsides__ofthis__modelseem__tobe__speedand__utility.Downloading__acompiled__CPythoninterpreter__torun__aPython__scriptin__abrowser__isnot__quick,and__thespeed__ofPython__scriptsin__thiscontext__may vary. Moreover,Pyodide__comeswith__afixed__setof__Python tools,and__Pythonscripts__runby__browserslive__ina__sandboxwith__limitedaccess__totools__andresources__onthe__host device.Persistent__storage,for__example,may__supportPOSIX__filecalls__and paths,but__isvirtual__andultimately__limitedin__thiscontext__tooptions__supportedby__browsers. Hence,while__thisoption__mayavoid__somePython__installsand__openpossibilities__forPython__onthe__web,it__snot__asuseful__forgeneral__softwaredevelopment__as others,and__itsfuture__isimpossible__to predict.Watch__theweb__formore__onthis__evolvingstory__includingthe__alternativeMicroPython__for Wasm,which__issmaller__thanCPython__butimplements__aconstrained__Pythonsubset__perChapter__2,and__the py2wasm Python-to-Wasm compiler,announced__justas__thisbook__wasbeing__written.Jupyter__Notebooksfor__ScienceWe__metthis__optionearlier__inconjunction__with REPLs.Jupyter__isa__setof__toolsthat__allowPython__codeto__berun__inweb__browsers,with__afocus__onsupporting__scientific-programming tasks.Its__primaryand__classictools__requirea__serverto__beseparately__installedand__launchedto__runthe__codeyou__enterin__aweb__page,but__italso__comesin__aform__thatruns__codelocally__inbrowsers__usingthe__WebAssemblyand__Pyodidesystems__describedin__thepreceding__section.In__both forms,Jupyter__pagesfollow__aflexible__notebook paradigm,with__interactivecoding__usingthe__IPythonREPL__wealso__met earlier,code__cellsthat__runwith__abutton__click,visualization__usingPython__numeric tools,and__more.While__Jupyteris__auseful__andpopular__toolin__manySTEM__roles,it__snot__targetedat__general-purposesoftware__developmentand__isnt__asbroadly__applicableas__traditionaltools__likecommand__linesstressed__inthis__book.See__otherresources__forusage__detailsif__Jupyternotebooks__maybe__apart__ofyour__Pythoncoding__future. Ahead-of-TimeCompilers__forSpeed__Alsoper__Chapter 2,a__numberof__AOTcompiler__systems,including__Nuitkaand__Shed Skin,compile__Pythonprograms__allthe__wayto__machine code,much__likeC__and C++ compilers.Once__youinstall__sucha__system,you__llrun__itscompiler__ona__fileof__Pythoncode__first,and__thenrun__theresulting__programlike__anyother__executable.AOT__compilerscan__boostprogram__speedbut__addextra__developmentsteps__thatslow__theprogramming__process substantially,and__negatesome__ofthe__advantageof__using Python.Especially__forPython__newcomers,these__systemsare__probablybest__exploredafter__learningthe__Pythonlanguage__usingmore__accessible options,like__traditional REPLs, IDEs,and__command lines.Running__Codein__CodeThis__chapterhas__talkedabout__importingmodules__afew__timeswithout__reallyexplaining__whatthis__term means.We__llstudy__modulesand__largerprogram__architecturein__depthin__Part V,but__becauseimports__arealso__away__tolaunch__programs,this__sectionwill__introduceenough__modulebasics__toget__you started.Like__imports,the__Pythonexec__built-incan__beused__tolaunch__filesin__code too,and__toolsin__standard-librarymodules__letyou__launchprograms__withcommand__lines.While__wecan__tgo__intofull__detailin__this chapter,this__sectionbriefly__surveysthe__launchersin__this department.Importing__modulesIn__simple terms,every__fileof__Pythonsource__codewhose__nameends__ina__.pyextension__isa__module.No__specialcode__orsyntax__isrequired__tomake__afile__a module:any__suchfile__will do.Other__filescan__accessthe__itemsa__moduledefines__byimporting__thatmodule__whichessentially__loadsanother__fileand__grantsaccess__tothat__files__contents.The__contentsof__amodule__aremade__availableto__theoutside__worldthrough__itsattributes__aterm__definedinformally__inthe__next section.This__moduleparadigm__turnsout__tobe__thecore__ideabehind__programarchitecture__in Python.Larger__programsusually__takethe__formof__multiplemodule__files,which__importtools__fromother__module files.One__ofthe__modulesis__designatedas__themain__or top-level file,also__oftencalled__thescript__thefile__launchedto__startthe__entire program,which__runsline__byline__as usual.Below__this level,it__sall__modulesimporting__modules.We__lldelve__intosuch__architecturalissues__inmore__detaillater__inthis__book.This__chapteris__mostlyinterested__inthe__factthat__importoperations__runthe__codein__afile__thatis__beingloaded__asa__final step.Because__of this,importing__afile__isyet__anotherway__tolaunch__it.For__instance,if__youstart__aninteractive__session (froma__systemcommand__lineor__otherwise),you__canrun__the script1.pyfile__wewrote__earlierin__Example 3-1with__asimple__importstatement__whichis__reallyPython__coderunning__otherPython__code: $ python3 >>>import__script1darwin__1267650600228229401496703205376 Hack!Hack!Hack!Hack!Hack!Hack!Hack!Hack!NOTE__Whereto__run imports:Be__sureto__runthis__Pythoncommand__inthe__directory (i.e., folder)containing__script1.py.Per__thischapter__searlier__coverageof__code folders,this__iseasiest__ifyou__savemodule__filesand__runimports__ina__per-chapterfolder__forthe__chapteryou__reworking__in.Later__inthis__book,you__lllearn__thatimports__ina__REPLsearch__fora__modulein__thecurrent__directory,plus__thoselisted__onenvironment__variablePYTHONPATH__orspecified__otherwise.The__currentdirectory__partof__thiswill__sufficefor__mostimports__youre__likelyto__tryuntil__thenas__longas__allyour__codefiles__reside there.Reloading__modulesImports__workto__runa__file,but__onlyonce__persession__(really,process__aprogram__run)by__default.After__thefirst__import,later__importsdo__nothing,even__ifyou__changeand__savethe__modules__sourcefile__againin__another window: >>>import__script1 >>>import__script1This__isby__design;imports__aretoo__expensivean__operationto__repeatmore__thanonce__perfile__ina__givenprogram__run.As__youll__learnin__Chapter 22,imports__mustfind__files,compile__themto__bytecode,and__runthe__codeline__by line,and__importersusually__careonly__thatthe__modules__lineshave__definedits__exports.If__youreally__wantto__forcePython__torun__thefile__againin__thesame__sessionwithout__stoppingand__restartingthe__REPL,you__needto__insteadcall__thereload__functionavailable__inthe__importlib standard-librarymodule__(andpreviously__inthe__now-defunctimp__module,and__a built-infunction__before that:that__sthree__incarnations,for__anyone counting!): >>>from__importlibimport__reload >>> reload(script1)darwin__1267650600228229401496703205376 Hack!Hack!Hack!Hack!Hack!Hack!Hack!Hack!The__fromstatement__heresimply__copiesa__nameout__ofa__module (moreon__thisin__thenext__section).The__reloadfunction__itselfloads__andruns__thecurrent__versionof__yourfile__ssource__code,picking__upthe__files__changesif__youve__modifiedand__savedit__inanother__window.This__allowsyou__toedit__anduse__newcode__onthe__flyin__thecurrent__Pythoninteractive__session.The__reloadfunction__expectsthe__nameof__an already-loadedmodule__object,so__youhave__tohave__successfullyimported__amodule__beforeyou__canreload__it (andif__theimport__failedwith__an error,you__cant__yetreload__andmust__import again).Notice__thatreload__alsoexpects__parenthesesaround__themodule__object name,whereas__importdoes__notreload__isa__functionthat__iscalled__withan__argument,and__importis__a statement.That__salso__whyyou__getback__anextra__outputline__whenreloading__theodd__lastline__isjust__thedisplay__representationof__thereload__calls__return value,a__Pythonmodule__object.You__lllearn__moreabout__usingfunctions__ingeneral__inChapter__16;for__now,when__youhear__function,remember__thatparentheses__arerequired__torun__a call,even__ifthere__snothing__to send.Module__attributes:a__firstlook__Importsand__reloadsprovide__anatural__programlaunch__optionbecause__importoperations__executefiles__asa__last step.In__thebroader__schemeof__things, though,modules__servethe__roleof__librariesof__tools,as__youll__learnin__Part V.The__basicidea__is straightforward, though:a__moduleis__mostlyjust__apackage__ofvariable__names,known__asa__namespace,and__thenames__withinthat__packageare__calledattributes__variablenames__thatare__attachedto__aspecific__object (likea__module).In__moreconcrete__terms,all__thenames__assignedat__thetop__levelof__amodule__sfile__becomeits__attributes,and__amodule__simporters__gainaccess__toall__of them.These__namesare__usuallyassigned__totools__exportedby__themodule__functions, classes, variables,and__soon__thatare__intendedto__beused__inother__filesand__other programs. Externally,a__modulefile__snames__canbe__fetchedwith__twoPython__statements,import__and from,and__maybe__resetwith__thereload__call.To__illustrate,use__atext__editorto__createa__one-linePython__modulefile__called myfile.pyin__yourworking__directory,with__thecontents__inExample__3-2.Example__3-2. myfile.pytitle__= 'Learning Python, 6th Edition'This__maybe__oneof__theworld__ssimplest__Pythonmodules__(itcontains__asingle__assignment statement),but__its__enoughto__illustratethe__point.When__thisfile__is imported,its__codeis__runto__generatethe__modules__attribute.That__is,the__assignmentstatement__createsa__variableand__moduleattribute__named title.You__canaccess__thismodule__stitle__attributein__othercomponents__intwo__different ways. First,you__canload__themodule__asa__wholewith__animport__statement,and__thenqualify__themodule__namewith__theattribute__nameto__fetchit__(notethat__were__lettingthe__interpreterprint__automatically here): $ python3 #Start__PythonREPL__>>>import__myfile #Run__file,load__moduleas__awhole__>>> myfile.title #Use__itsattribute__names: '.'to__qualify 'Learning Python, 6th Edition'In__general,the__dotexpression__syntax object.attributelets__youfetch__anyattribute__attachedto__anyobject__andis__oneof__themost__commonoperations__inPython__code. Here,we__veused__itto__accessthe__stringvariable__titleinside__themodule__myfilein__other words, myfile.title. Alternatively,you__canfetch__(really, copy)names__outof__amodule__withfrom__statements: $ python3 #Restart__PythonREPL__>>>from__myfileimport__title #Run__file,copy__itsnames__>>>title__#Use__name directly:no__needto__qualify 'Learning Python, 6th Edition'As__youll__seein__moredetail__later,from__isjust__likean__import,with__anextra__assignmentto__namesin__theimporting__code. Technically,from__copiesa__modules__attributes,such__thatthey__becomesimple__variablesin__the recipient. So,you__canrefer__tothe__importedstring__thistime__astitle__(a variable)instead__of myfile.title (an attribute). Naturally,modules__usuallydefine__morethan__onename__tobe__usedboth__inand__outsidetheir__files.Example__3-3,for__instance,defines__three.Example__3-3. threenames.pya__= 'PC' #Define__threeattributes__b = 'Phone' #Exported__toother__filesc__= 'Tablet' print(a, b, c) #Also__usedas__variablesin__thisfile__Thiscode__file, threenames.py,assigns__three variables,and__sogenerates__threeattributes__forthe__outside world.It__alsouses__itsown__threevariables__ina__print statement,as__yousee__whenthis__isrun__asa__top-levelfile__froma__system prompt: $ python3 threenames.pyPC__PhoneTablet__Allof__thisfile__scode__alsoruns__asusual__thefirst__timeit__isimported__elsewhere,by__eitheran__importor__from.Clients__ofthis__filethat__useimport__geta__modulewith__attributes,while__clientsthat__usefrom__getcopies__ofthe__files__names: $ python3 >>>import__threenames #Grab__thewhole__module:it__runshere__PCPhone__Tablet >>> threenames.b, threenames.c #Access__its attributes:qualify__touse__('Phone', 'Tablet') >>>from__threenamesimport__b,c__#Copy__multiplenames__out:use__directly >>> b,c__('Phone', 'Tablet')The__resultshere__areprinted__inparentheses__becausethey__arereally__tuplesa__kindof__objectcreated__bythe__commain__theinputs__(andcovered__inthe__nextpart__ofthis__book)that__youcan__safelyaccept__onfaith__for now.From__agrander__perspective,modules__formthe__highestlayer__ofPython__program architecture:as__self-contained namespaces,they__naturallysupport__codeorganization__and reuse,and__theyautomatically__minimizename__collisionsin__your code.We__lldeal__withtheir__loftiergoals__laterin__this book.For__this chapter,it__senough__toknow__thatimports__andreloads__areanother__wayto__runyour__code files,though__probablya__secondary option:due__tocomplicated__quirksthat__well__skiphere__(e.g.,reload__updatesimporters__usingimport__butnot__from),tools__likecommand__linesand__IDEsare__generallybetter__betsfor__runningPython__code.The__exec built-inPython__alsoprovides__away__tolaunch__fileswith__codethat__doesnot__relyon__themodule__conceptsof__thepreceding__section.The__exec built-infunction__compilesand__runswhatever__Pythonsource__codestatements__arein__thestring__youpass__to it.Along__withits__evalexpression__cousin,this__supportsmany__dynamicroles__youll__meetin__upcoming chapters.By__passinga__codefile__sloaded__contentsto__exec, though,this__yieldsanother__wayto__launchcode__filesfrom__aREPL__orother__filewithout__havingto__importand__later reload.Each__suchexec__runsthe__currentversion__ofthe__coderead__froma__file,without__requiringimports__or reloads.For__instance,using__Example 3-1s__script1.py again: $ python3 >>> exec(open('script1.py').read())darwin__1267650600228229401496703205376 Hack!Hack!Hack!Hack!Hack!Hack!Hack!Hack!To__understandthis__code,you__mustfirst__knowthat__theopen__andread__nestedinside__itrun__first,and__leftto__right,and__loadthe__files__entirecontents__asa__string.We__llstudy__filesin__thenext__partof__this book,so__takethis__asa__previewfor__now. (Thiswas__alsoa__forwardknowledge__dependencyadded__inPython__3.X,but__thats__whatthis__book presents.)Once__thefile__is loaded, though,the__execcall__hasan__effectsimilar__toan__import,but__itdoesn__tactually__importthe__module. Instead,each__timeyou__runan__exec/opencombo__thisway__itruns__thefile__scode__anewand__unconditionallyas__thoughyou__hadpasted__thefile__scode__atthe__placewhere__execis__called.As__one consequence,this__exec/openscheme__doesnot__requiremodule__reloadsafter__file changes.On__the downside,because__itworks__asif__youve__pastedcode__intothe__placewhere__itis__called,exec__hasthe__potentialto__silentlyoverwrite__variablesyou__maycurrently__be using.For__example,our__script1.pyassigns__toa__variablenamed__x.If__thatname__isalso__beingused__inthe__placewhere__execis__called,the__names__valueis__replacedsans__warning: >>>x__= 999 >>> exec(open('script1.py').read()) #Code__runin__thisnamespace__bydefault__sameoutput__>>>x__#Its__assignmentscan__overwritenames__here 'Hack!'This__potentialfor__namecollisions__isa__downsideshared__bythe__lastsection__sfrom__statement.By__contrast,the__basicimport__statementmakes__thefile__aseparate__modulenamespace__sothat__itsassignments__willnot__changevariables__inthe__importers__scope.The__priceyou__payfor__itsnamespace__partitioningof__modulesis__theneed__toreload__and qualify. Command-linelaunchers__Finally,Python__codecan__alsobe__runby__Pythoncode__thatuses__standard-librarytools__thatspawn__commandlines__inparallel__processes.The__osmodule__ssystem__call,for__instance,runs__acommand__asif__youtyped__itat__asystem__console (its 0return__valueechoed__atthe__endhere__meansall__worked well): $ python3 >>>import__os >>> os.system('python3 script1.py')darwin__1267650600228229401496703205376 Hack!Hack!Hack!Hack!Hack!Hack!Hack!Hack! 0This__osmodule__spopen__calldoes__similarbut__returnsa__fileobject__fromwhich__youcan__readthe__spawnedcommand__sprinted__outputas__astring__foruse__inthe__spawning code;and__Pythons__subprocess.runcall__canbe__usedto__launchprograms__bycommand__lineswith__muchmore__controlover__thefine__points.We__lldeploy__popenin__Chapter 21.Though__relatedto__running code,all__thesetools__arewell__beyondthe__scopeof__this getting-started chapter,so__consultPython__slibrary__manualsfor__thefull__storyif__andwhen__suchutilities__becomeuseful__inyour__future work.And__a caution:these__tools,along__with exec,will__happilyrun__anycommand__lineyou__throwat__themincluding__oneto__eraseall__your files!so__theyre__bestlimited__torunning__Pythoncommands__unlessand__untilyou__resure__thatother__commandsare__safe.Other__LaunchOptions__Youve__alreadyseen__ablizzard__of code-launchingoptions__for Python,but__thisaccounting__isstill__incomplete.For__example,Python__codecan__alsobe__runtoday__by:Programs__writtenin__C, C++, Java,and__more,which__embedPython__andPython__codeText__editorsthat__arent__full IDEs,but__knowhow__torun__Pythoncode__youre__editingExcel__spreadsheets,when__calculatinga__sheets__cellscoded__inPython__Webservers__thatspawn__scriptsautomatically__inresponse__tobrowser__UIactions__Userslaunching__standalone executables,which__weexplored__inChapter__2And__(as usual)more__Moreover,launching__techniquestend__toevolve__asrapidly__aseverything__elsein__computing,and__futureoptions__areimpossible__to foresee.In__general,because__Pythonkeeps__pacewith__such changes,you__shouldbe__ableto__launchPython__programsin__whateverway__makessense__forthe__machinesyou__use,both__nowand__inthe__futurebe__thatby__swipingon__your smartphone,grabbing__iconsin__avirtual__reality,or__shoutinga__scripts__nameover__yourcoworkers__conversations.Which__OptionShould__I Use?With__allthese__options,beginners__mightnaturally__ask,Which__oneis__bestfor__me?In__general,you__shouldtry__bothbasic__commandlines__andthe__IDLEGUI__ifyou__arejust__gettingstarted__with Python,unless__youll__beworking__insmartphone__appsor__web-basednotebooks__withinterfaces__thatare__more unique.Command__linesare__simpleand__powerful,but__IDLEprovides__a user-friendlyGUI__environmentthat__hidessome__underlyingdetails__andworks__thesame__onall__PCs. If,on__theother__hand,you__arean__experienced programmer,you__mightbe__morecomfortable__withsimply__thetext__editorof__yourchoice__inone__window,and__asystem__consoleinterface__inanother__forlaunching__editedprograms__viaPython__command lines.Because__thechoice__ofdevelopment__environmentsis__very subjective,this__bookcan__toffer__muchmore__inthe__wayof__universal guidelines.In__general,whatever__environmentyou__liketo__usewill__bethe__bestfor__youto__use.Chapter__SummaryIn__this chapter,we__veexplored__commonways__tolaunch__Python programs:by__runningcode__typedinteractively__andby__runningcode__storedin__fileswith__systemcommand__lines,file__icon clicks,IDE__GUIssuch__as IDLE,and__more.We__vecovered__alot__ofpragmatic__startupterritory__here.This__chapters__goalwas__toequip__youwith__enoughinformation__toenable__youto__startwriting__some code,which__youll__doin__thenext__partof__this book. There,we__willstart__exploringthe__Pythonlanguage__itself,beginning__withits__coredata__typesthe__objectsthat__arethe__subjectsof__your programs. First, though,take__theusual__chapterquiz__toexercise__andreview__whatyou__velearned__here.Because__thisis__thelast__chapterin__thispart__ofthe__book,it__sfollowed__witha__setof__morecomplete__exercisesthat__testyour__masteryof__thisentire__parts__topics.For__helpand__answersfor__thelatter__setof__problems,or__justfor__a refresher,be__sureto__turnto__AppendixB__afteryou__vegiven__theexercises__a try.Test__Your Knowledge:Quiz__1.How__canyou__starta__Pythoninteractive__interpretersession__(REPL)? 2.Where__doyou__typea__systemcommand__lineto__launcha__script file? 3.Name__fouror__moreways__torun__thecode__savedin__ascript__file. 4.What__pitfallis__relatedto__clickingfile__iconson__Windowsand__Linux? 5.Why__mightyou__needto__reloada__module? 6.How__doyou__runa__scriptfrom__withinthe__IDLE GUI? 7.How__are modules, attributes,and__namespaces related?Test__Your Knowledge:Answers__1.A__Pythoninteractive__sessioncan__bestarted__bytyping__aPython__commandline__inyour__systems__console window.Type__pyon__Windowsand__python3everywhere__elseand__typeit__intoa__CommandPrompt__orPowerShell__windowon__Windows,Terminal__onmacOS__and Linux,and__theTermux__appon__Android.Another__alternativeis__tolaunch__IDLE,as__itsmain__Shellwindow__isan__interactive session.Other__IDEs,smartphone__apps,and__browser-basedsystems__mayoffer__REPLsin__moreunique__ways. 2.You__typesystem__commandlines__inthe__sameinterface__usedto__launchan__interactivesession__bycommand__line.This__iswhatever__yourplatform__providesas__asystem__console: again,Command__Promptor__PowerShellon__Windows,Terminal__onmacOS__and Linux,Termux__on Android,or__other.You__typethis__atthe__systems__promptshown__as $in__this book,not__atthe__Pythoninteractive__interpreters__>>>prompt__usedto__enterPython__codebe__carefulnot__toconfuse__these prompts,because__Pythonand__thesystem__shellare__different systems. 3.Code__ina__script (really, module)file__canbe__runwith__systemcommand__lines,file__icon clicks,imports__and reloads,the__exec built-in function,os__module tools,and__IDEGUI__devicessuch__asIDLE__sRun__RunModule__menu option.Some__platformssupport__morespecialized__launching techniques,like__dragand__dropon__macOS,app__UIson__smartphones,and__web notebooks.In__addition,some__texteditors__haveunique__waysto__runPython__code,some__Pythonprograms__areprovided__andrun__asstandalone__executables,and__somesystems__usePython__codein__embedded mode,where__itis__runby__anenclosing__programwritten__inanother__language.Though__inits__early days,code__mayalso__berun__inweb__browserswith__aPython__portto__WebAssemblylike__Pyodide. 4.Scripts__thatprint__andthen__exitcause__theoutput__fileto__disappear immediately,before__youcan__viewthe__output. input()can__pausebefore__exitso__theoutput__windowstays__open,but__errormessages__generatedby__yourscript__alsoappear__inan__outputwindow__thatcloses__beforeyou__canexamine__itscontents__andbefore__an input()pause__is reached. Hence,system__commandlines__andIDEs__suchas__IDLEare__betterfor__most development. 5.Python__imports (i.e., loads)a__moduleonly__onceper__process,by__default,so__ifyou__vechanged__itssource__codeand__wantto__runthe__newversion__withoutstopping__andrestarting__Python,you__llhave__toreload__it.You__mustimport__amodule__atleast__oncebefore__youcan__reload it.Running__filesof__codefrom__asystem__shellcommand__line,via__anicon__click,or__inan__IDEsuch__asIDLE__generallymakes__thisa__nonissue,as__thoselaunch__schemesusually__runthe__currentversion__ofthe__sourcecode__fileeach__time.An__exec/openpair__canavoid__reloads too. 6.Within__thetext__editwindow__ofthe__fileyou__wishto__run,select__thewindow__sRun__RunModule__menu option.This__runsthe__windows__sourcecode__asa__top-levelscript__filein__IDLEand__displaysits__outputback__inthe__interactivePython__Shell window. 7.Each__modulefile__isautomatically__anamespace__that is,a__packageof__variablesreflecting__theassignments__madeat__thetop__levelof__the file.Each__ofthe__modules__variablesbecomes__anattribute__ofthe__modulewhen__its__importedand__areaccessed__by .qualification__orfrom__name copies.Namespaces__helpavoid__namecollisions__inPython__programs:because__eachmodule__fileis__a self-contained namespace,files__mustexplicitly__importother__filesin__orderto__usetheir__names.Test__Your Knowledge:Part__IExercises__Its__timeto__startdoing__alittle__codingon__your own.This__firstexercise__sessionis__fairly simple,but__itis__designedto__makesure__youre__readyto__workalong__withthe__restof__the book,and__afew__ofits__questionshint__attopics__tocome__inlater__chapters.Be__sureto__checkthe__sectionPart__I,Getting__Startedin__AppendixB__forthe__answers;the__exercisesand__theirsolutions__sometimescontain__supplementalinformation__notdiscussed__inthe__main text,so__youre__encouragedto__takea__peekat__thesolutions__evenif__youmanage__toanswer__allthe__questionson__your own. 1. Interaction:Using__asystem__command line, IDLE,or__anyother__methodthat__workson__your device,start__thePython__interactivecommand__line (the >>> prompt, a.k.a. REPL)and__typethe__expression 'Hello World!' (includingthe__quotes).The__stringshould__beechoed__backto__you.The__purposeof__thisexercise__isto__getyour__environmentconfigured__torun__Python.In__rare scenarios,you__mayneed__totype__thefull__pathto__thePython__executableor__addits__pathto__yourPATH__environment variable.See__AppendixA__fortips__on environment-variablesettings__if needed. 2. Programs:With__thetext__editorof__your choice,write__asimple__modulefile__containingthe__singlestatement__print('Hellomodule__world!')and__storeit__as module1.py. Now,run__thisfile__byusing__anylaunch__optionyou__like:running__itin__IDLE,clicking__ortapping__onits__file icon,starting__itby__commandline__ina__console (e.g., python3 module1.py),executing__itin__codewith__toolslike__execand__imports/reloads,or__byusing__UIoptions__in apps,other__IDEs,and__web notebooks.In__fact,experiment__byrunning__yourfile__withas__manyof__thelaunch__techniquesdiscussed__inthis__chapteras__you can.Which__techniqueseems__easiestto__you? 3. Modules:Start__thePython__interactivecommand__line (>>> prompt)and__importthe__moduleyou__wrotein__exercise 2.Try__movingthe__fileto__adifferent__directoryand__importingit__againfrom__itsoriginal__directory (i.e.,run__Pythonin__theoriginal__directorywhen__you import).What__happens? Hint:there__sstill__a .pycbytecode__filefor__module1in__a__pycache____subdirectory there,but__its__named oddly.In__general,imports__searchfor__modulesin__thecurrent__directory,plus__everydirectory__listedon__thePYTHONPATH__environmentvariable__asyou__lllearn__inPart__V. 4. Scripts:If__yourplatform__supports it,copy__your module1.pymodule__fileto__anothernamed__script1.py;then__addthe__#!line__tothe__topof__script1.py,give__thisfile__executable privileges,and__runit__directlyas__anexecutable__(e.g.,sans__the python3 ).What__doesthe__firstline__needto__contain? #!lines__traditionallyhave__meaningonly__on Unix-likeplatforms__(e.g., macOS, Linux,and__Android),but__alsoapply__toWindows__today,thanks__tothe__pyWindows__launcher.If__youre__workingon__Windows,also__tryrunning__yourfile__bylisting__justits__namein__aCommand__Promptwindow__withoutthe__wordpy__before it,via__theStart__menu, Windows+RRun__dialog,or__other schemes.On__macOS,try__a drag- and-dropto__thePython__Launcherapp__inApplications__(or elsewhere). 5.Errors__and debugging:Experiment__withtyping__mathematicalexpressions__andassignments__atthe__Pythoninteractive__commandline__(that is, REPL).Along__the way,type__theexpressions__2 ** 500and__1 / 0,and__referencean__undefinedvariable__nameas__wedid__earlyon__inthis__chapter.What__happens?You__maynot__knowit__yet,but__whenyou__makea__mistake,you__redoing__exception processing,a__topicwe__llexplore__indepth__inPart__VII.As__youll__learn there,you__aretechnically__triggeringwhat__sknown__asthe__defaultexception__handlerlogic__thatprints__astandard__error message.If__youdo__notcatch__an error,the__defaulthandler__doesand__printsthe__standarderror__messagein__response.Exceptions__arealso__boundup__withthe__notionof__debuggingin__Python.When__youre__firststarting__out,Python__sdefault__errormessages__onexceptions__willprobably__provideas__much error-handlingsupport__asyou__needthey__givethe__causeof__the error,as__wellas__showingthe__linesin__yourcode__thatwere__activewhen__theerror__occurred.For__moreabout__debugging,see__theupcoming__sidebarDebugging__PythonCode__. 6.Breaks__and cycles:In__anyPython__REPL, type:L__= [1, 2] #Make__a 2-itemlist__L.append(L) #Append__Las__asingle__itemto__itselfL__#Print__L:a__cyclic/circularobject__What happens?In__allbut__themost__ancientof__Python versions,you__llsee__astrange__outputthat__isdescribed__inthe__AppendixB__solution,and__whichwill__makemore__sensewhen__youstudy__objectreferences__inthe__nextpart__ofthe__book.Why__doyou__thinkyour__versionof__Pythonresponds__theway__itdoes__forthis__code? 7. Documentation:Spend__atleast__fiveminutes__browsingthe__Pythonlibrary__andlanguage__manualsbefore__movingon__toget__afeel__forthe__availabletools__inthe__standardlibrary__andthe__structureof__thedocumentation__set.It__takesat__leastthis__longto__becomefamiliar__withthe__locationsof__majortopics__inthe__manual set;once__youve__done this,it__seasy__tofind__whatyou__need.You__canfind__thismanual__viathe__PythonStart__menuentry__onsome__Windows,in__thePython__Docsoption__onthe__Help pull-downmenu__in IDLE,or__onlineat__http://www.python.org/doc.You__llalso__learnmore__aboutthe__manualsand__otherdocumentation__sources (includingPyDoc__andthe__help function)in__Chapter 15.If__youstill__have time,go__explorethe__Python website,as__wellas__itsPyPI__third-partyextension__repository; python.orgs__Aboutand__Search,for__example,may__beuseful__whenyou__regetting__started.DEBUGGING__PYTHONCODE__Naturally,none__ofthis__books__readersever__havebugs__intheir__code (insertsmiley__here),but__forless__fortunatefriends__ofyours__who may,here__sa__quickreview__ofthe__strategiescommonly__usedby__real-worldPython__programmersto__debugerrors__intheir__code.The__firsttwo__maybe__allyou__llneed__earlyin__thelearning__process,but__othersmay__growimportant__whenyou__startwriting__larger scripts,and__allare__usefulto__reviewnow__beforeyou__startcoding__inearnest__inthe__nextchapter__andmaking__themistakes__thatare__inevitablein__programming:Do__nothing.This__doesnt__meanthat__Pythonprogrammers__dont__debugtheir__code.But__whenyou__makea__mistakein__aPython__program,you__geta__usefuland__readableerror__message.The__messagepinpoints__thelocation__ofthe__errorin__yourcode__byfile__andline__andmay__evenoffer__asuggested__Didyou__?fix__asyou__sawearlier__inthis__chapter.If__youalready__know Python,and__especiallyfor__yourown__code,this__isoften__enoughread__theerror__messageand__fixthe__tagged line.In__many cases,this__isdebugging__in Python.Insert__print statements.Probably__themain__waythat__Pythonprogrammers__debugtheir__codeis__toinsert__printstatements__andrun__again.Because__mostPython__coderuns__immediatelyafter__changes,this__isusually__thequickest__wayto__getmore__informationthan__errormessages__provide.The__printstatements__dont__haveto__besophisticated__asimple__Iam__herebeacon__ordisplay__ofvariable__valuesis__usuallyenough__toprovide__thecontext__you need.If__youwrite__programsthat__dont__havea__consolewindow__(e.g.,some__GUIsand__apps),you__mayneed__tofind__yourprinted__messagesin__anautomatic__logfile,or__usethe__next point.Insert__callsto__thelogging__module.The__beaconmessages__ofthe__priorpoint__mayalso__usePython__slogging__moduleinstead__of print,to__makethe__processmore__formaland__gainbetter__controlof__the output.Because__thisrequires__some planning,it__smore__commonin__largerprograms__thantactical__scripts.See__Pythons__librarymanual__forlogging__usage details.Use__GUI debuggers.For__largersystems__youdidn__t write,and__forbeginners__whowant__totrace__codein__more detail,most__Pythondevelopment__GUIshave__somesort__of point-and-clickdebugging__support.IDLE__hasa__debugger too,but__itdoesn__tseem__tobe__usedvery__oftenin__practiceperhaps__becauseit__hasno__command line,or__simplybecause__addingprint__statementsis__oftenquicker__thansetting__upa__debugging session.To__learnmore__aboutthe__debugger,see__IDLEs__Help menu,or__simplytry__iton__your own;its__basicinterface__isdescribed__earlierin__this chapter.For__similardebugging__supportin__other IDEs,see__their docs.Use__thepdb__command-line debugger.For__full control,Python__comeswith__asource__codedebugger__named pdb,available__asa__modulein__Pythons__standard library.With__pdb,you__typecommands__tostep__lineby__line,display__variables,set__andclear__breakpoints,continue__toa__breakpointor__error,and__so on.You__canlaunch__pdbby__eitherimporting__itand__calling pdb.run('code')or__runningit__asa__top-levelscript__withthe__command python3 -mpdb__file.py.You__canalso__importand__callpdb__spostmortem__pdb.pm()after__anerror__occursto__getmore__informationabout__whatwent__wrong.We__llrevisit__pdbin__Chapter 36,but__seePython__slibrary__manualand__pdbs__ownhelp__commandfor__moreusage__tips.Use__Pythons__i command-line argument.Short__ofadding__printsor__running debuggers,you__canstill__seewhat__wentwrong__on errors.If__yourun__yourscript__froma__commandline__andpass__a -iargument__betweenPython__andthe__nameof__yourscript__(e.g., python3i__script.py),Python__willautomatically__openits__interactivemode__(the >>> prompt)when__yourscript__exits,whether__itends__successfullyor__runsinto__an error.You__canthen__printthe__finalvalues__ofvariables__toget__moredetails__aboutwhat__happenedin__your code,or__importand__runpdb__sdebugger__orpostmortem__mode.Catch__andhandle__errorsin__code. Ultimately,errors__area__well-defined__mechanismin__Pythonknown__as exceptions,which__youcan__catch, process,and__recoverfrom__inyour__own code.You__lllearn__howin__Part VII.Perhaps__thebest__takeawayon__debuggingis__thaterrors__aredetected__andreported__inPython__asa__norm,rather__thanpassing__silentlyor__crashingthe__system altogether.Making__mistakesis__never fun,of__course,but__especiallyfor__thosewho__recallwhen__debuggingmeant__gettingout__ahex__calculatorand__poringover__pilesof__memory-dump printouts,Python__sdebugging__supportmakes__errorsa__lotless__painfulthan__theymight__otherwise be.Part__II.Objects__andOperations__Chapter 4.Introducing__PythonObjects__Thischapter__beginsour__tourof__thePython__language.In__aninformal__sense,in__Pythonwe__dothings__with stuff.Things__takethe__formof__operationslike__additionand__concatenation,and__stuffrefers__tothe__objectson__whichwe__performthose__operations.In__thispart__ofthe__book,our__focusis__onthat__stuff,and__thethings__ourprograms__cando__with it.Somewhat__more formally,in__Python,data__takesthe__formof__objectseither__built-in__objectsthat__Python provides,such__asstrings__and lists,or__add-onobjects__wecreate__withPython__classesor__external-language tools.As__youll__find,these__objectsare__essentiallyjust__piecesof__memory,with__valuesand__associated operations. Moreover,everything__isan__objectin__aPython__script.Even__simplenumbers__qualify,with__values (e.g., 99)and__supportedoperations__(+, -,and__so on).Because__objectsare__alsothe__mostfundamental__notionin__Python programming,this__chaptergets__usstarted__witha__surveythat__previewsPython__s built-inobject__types.Later__chaptersin__thispart__providea__secondpass__thatfills__indetails__well__glossover__inthis__survey. Here,our__goalis__abrief__tourto__introducethe__basics.The__PythonConceptual__HierarchyBefore__weget__tothe__code,let__sfirst__establisha__clearpicture__ofhow__thischapter__fitsinto__theoverall__Python picture.From__amore__concrete perspective,Python__programscan__bedecomposed__into modules, statements, expressions,and__objects,as__follows: 1.Programs__arecomposed__of modules. 2.Modules__contain statements. 3.Statements__contain expressions. 4.Expressions__createand__process objects.The__discussionof__modulesin__Chapter 3introduced__thehighest__levelof__this hierarchy.This__parts__chaptersbegin__atthe__bottomexploring__both built-inobjects__andthe__expressionsyou__cancode__touse__them.We__llmove__onto__statementsin__thenext__partof__the book,though__youwill__findthat__theylargely__existto__managethe__objectsyou__llmeet__here. Furthermore,by__thetime__wereach__classesin__theOOP__partof__this book,you__lldiscover__thatthey__allowyou__todefine__newobject__typesof__your own,by__bothusing__andemulating__theobject__typesyou__willexplore__here.Because__ofall__this, built-inobjects__area__mandatorypoint__ofembarkation__forall__Python journeys.NOTE__Terminology moment:Traditional__introductionsto__programmingoften__stressits__threepillars__ofsequence__(Do__this,then__that ),selection__(Do__thisif__thatis__true ),and__repetition (Do__thismany__times ).Python__hastools__inall__three categories,and__theseterms__mighthelp__youorganize__yourthinking__early on.But__theyare__alsoartificial__and simplistic,and__proneto__confuse.For__example,tools__suchas__comprehensionsare__bothrepetition__and selection;these__termshave__other,more__specificmeanings__in Python;and__manylater__conceptswon__tseem__tofit__thismold__at all.In__Python,the__morestrongly__unifyingprinciple__isobjects__andwhat__wecan__dowith__them.To__see why,read__on.Why__Use Built-in Objects?If__youve__used lower-levelprogramming__languages,you__knowthat__muchof__yourwork__centerson__implementingobjects__alsoknown__asdata__structuresto__representthe__componentsin__yourapplication__s domain.You__mayneed__tolay__outmemory__structures,manage__memory allocation,implement__searchand__access routines,and__so on.These__choresare__aboutas__tedious (and error-prone)as__they sound,and__theyusually__distractfrom__yourprogram__sreal__goals.In__typicalPython__programs,most__ofthis__gruntwork__goes away.Because__Pythonprovides__powerfulobject__typesas__anintrinsic__partof__the language,there__susually__noneed__tocode__objectimplementations__beforeyou__startsolving__problems.In__fact,unless__youhave__aneed__forspecial__processingthat__built-inobjects__dont__provide,you__realmost__alwaysbetter__offusing__a built-inobject__insteadof__implementingyour__own.Here__aresome__reasons why: Built-inobjects__makeprograms__easyto__write.For__simpler tasks, built-inobjects__areoften__allyou__needto__representthe__structureof__problem domains.Because__youget__powerfultools__suchas__collections (lists)and__searchtables__(dictionaries)for__free,you__canuse__them immediately.You__canget__alot__ofwork__donewith__Pythons__built-inobject__types alone. Built-inobjects__arecomponents__of extensions.For__morecomplex__tasks,you__mayneed__toprovide__yourown__objectsusing__Pythonclasses__or C-language interfaces.But__asyou__llsee__inlater__partsof__this book,objects__implementedmanually__areoften__builton__topof__built-inobjects__suchas__listsand__dictionaries.For__instance,a__stackdata__structuremay__beimplemented__asa__classthat__managesor__customizesa__built-in list. Built-inobjects__areoften__moreefficient__thancustom__data structures.Python__s built-inobjects__employalgorithms__thathave__alreadybeen__optimizedand__areoften__implementedin__a lower-levellanguage__likeC__for speed.Although__youcan__writesimilar__objecttypes__onyour__own,you__llusually__be hard-pressedto__matchthe__levelof__performancethat__built-inobject__types provide. Built-inobjects__area__standardpart__ofthe__language.In__some ways,Python__borrowsboth__fromlanguages__thatrely__on built-intools__(e.g., Lisp)and__languagesthat__relyon__theprogrammer__toprovide__toolimplementations__oftheir__own (e.g., C++).Although__youcan__implementunique__objecttypes__in Python,you__dont__needto__doso__justto__get started. Moreover,because__Pythons__built-insare__standard,they__realways__the same;proprietary__toolkits,on__theother__hand,tend__todiffer__fromsite__to site.In__other words,not__onlydo__built-inobject__typesmake__programming easier,they__realso__morepowerful__andaccessible__thanmost__ofwhat__canbe__createdfrom__scratch.Regardless__ofwhether__youimplement__newobject__types, built-inobjects__formthe__coreof__everyPython__program.Python__sCore__ObjectTypes__Table 4-1previews__Pythons__built-in objects,and__someof__thesyntax__usedto__codetheir__literalsthat__is,the__expressionsthat__generatethese__objects.Some__ofthese__objectswill__probablyseem__familiarif__youve__usedother__languages;for__instance,numbers__andstrings__representnumeric__andtextual__values, respectively,and__fileobjects__providean__interfacefor__processingreal__filesstored__onyour__computer.To__some readers, though,the__objecttypes__inTable__4-1may__bemore__generaland__flexiblethan__whatyou__areaccustomed__to.For__instance,you__llfind__thatlists__anddictionaries__aloneare__powerfuldata__representationtools__thatobviate__mostof__thework__youdo__tosupport__collectionsand__searchingin__lower-level languages.In__short,lists__provideordered__collectionsof__other objects,while__dictionariesstore__objectsby__key,and__bothcome__withautomatic__memory management,support__arbitrarily nesting,can__growand__shrinkon__demand,and__maycontain__objectsof__any kind.Table__4-1.Python__built-in (core)objects__Objecttype__Example literals/creationNumbers__1234, 3.1415, 0b111, 1_234, 3+4j, Decimal,Fraction__Strings 'code', "app's", b'a\x01c', 'h\u00c4ck', 'hck__'Lists__[1, [2, 'three'], 4.5], list(range(10))Dictionaries__{'job': 'dev', 'years': 40}, dict(hours=10)Tuples__(1, 'app', 4, 'U'), tuple('hack'),namedtuple__Files open('docs.txt'), open(r'C:\data.bin', 'wb')Sets__set('abc'), {'a', 'b', 'c'}Other__coreobjects__Booleans, types,None__Program-unitobjects__Functions, modules,classes__(Parts IV, V,and__VI)Implementation__objectsCompiled__code,stack__tracebacks (PartsIV__and VII)Also__shownin__Table 4-1,program__unitssuch__as functions, modules,and__classeswhich__youll__meetin__laterparts__ofthis__bookare__objectsin__Python too;they__arecreated__withstatements__andexpressions__suchas__def, class, import,and__lambdaand__maybe__passedaround__scripts freely,stored__withinother__objects,and__so on.Python__alsoprovides__aset__of implementation-relatedobjects__suchas__compiled-code objects,which__aregenerally__ofinterest__totool__buildersmore__thanapplication__developers;we__llexplore__these later,though__inless__depthdue__totheir__specialized roles.Despite__its title,Table__4-1isn__treally__completebecause__everythingwe__processin__Pythonprograms__isa__kindof__object.For__instance,when__weperform__textpattern__matchingin__Python,we__createpattern__objects,and__whenwe__donetwork__scripting,we__usesocket__objects.These__otherkinds__ofobjects__aregenerally__createdby__importingand__usingfunctions__instandard__or add-onlibrary__modules,and__havebehavior__alltheir__own.Patterns__and sockets,for__example,are__madeby__callingtools__inthe__standardlibrary__sre__andsocket__modules, respectively.We__usuallycall__theobjects__inTable__4-1core__object types, though,because__theyare__effectivelybuilt__intothe__Pythonlanguage__itselfthat__is,there__isspecific__expressionsyntax__forgenerating__mostof__them.For__instance,when__yourun__thefollowing__codewith__characterssurrounded__byquotes__ina__REPLor__program file: >>> 'Python'you__are,technically__speaking,running__aliteral__expressionthat__generatesand__returnsa__newstring__object.There__isPython__languagesyntax__tomake__this object. Similarly,an__expressionwrapped__insquare__bracketsmakes__a list,one__incurly__bracesmakes__adictionary__or set,and__so on.Even__though,as__youll__see,Python__doesnot__requireor__usetype__declarations,the__syntaxof__theexpressions__yourun__determinesthe__typesof__objectsyou__createand__use.In__fact, object-generationexpressions__likethose__inTable__4-1are__generallywhere__typesoriginate__inthe__Python language.Just__as importantly,once__youcreate__an object,you__bindits__operationset__forall__timeyou__canperform__onlystring__operationson__astring__andlist__operationson__a list.In__formal terms,this__meansthat__Pythonis__dynamically typed,a__modelthat__keepstrack__ofobject__typesfor__youautomatically__insteadof__requiringdeclaration__code,but__itis__alsostrongly__typed,a__constraintthat__meansyou__canperform__onan__objectonly__operationsthat__arevalid__forits__type.We__llstudy__eachof__theobject__typesin__Table 4-1completely__inupcoming__chapters.Before__digginginto__thefull__details, though,let__sbegin__bytaking__aquicker__lookat__Pythons__coreobjects__in action.The__restof__thischapter__providesa__previewof__theoperations__well__explorein__moredepth__inthe__chaptersthat__follow.Don__texpect__tofind__thefull__storyhere__thegoal__ofthis__chapteris__justto__whetyour__appetiteand__introducesome__key ideas. Still,the__bestway__toget__startedis__toget__started,so__lets__jumpright__intosome__real object-wrangling code.Numbers__Ifyou__vedone__anyprogramming__orscripting__inthe__past,some__ofthe__objecttypes__inTable__4-1will__probablyseem__familiar.Even__ifyou__haven t,numbers__arefairly__straightforward.Python__score__objectsset__includesthe__usual suspects:integers__thathave__nofractional__part, floating-pointnumbers__that do,and__moreexotic__typescomplex__numberswith__imaginary parts,decimals__withflexible__precision,rationals__withnumerator__and denominator,and__full-featured sets. Built-innumbers__areenough__torepresent__mostnumeric__quantitiesfrom__yourage__toyour__bankbalance__butspecialized__numericobjects__likevectors__andmatrixes__arealso__availableas__third-party add-ons.Although__theyoffer__fancier options,Python__sbasic__numberobjects__are, well, basic.Numbers__inPython__supportthe__normalmathematical__operations.For__instance,the__plussign__(+)performs__addition,a__star (*)is__usedfor__multiplication,and__twostars__(**)are__usedfor__exponentiation.Here__isa__demoin__aPython__REPLof__thesort__welearned__aboutin__Chapter 3: $ python3 #Start__upa__REPL >>> 123 + 222 #Integer__addition 345 >>> 1.5 * 4 # Floating-pointmultiplication__6.0 >>> 1_234_567, 0x15, bin(21) # Separators, hex,binary__(1234567, 21, '0b10101') >>> 2 ** 100 # 2to__thepower__100,again__1267650600228229401496703205376Notice__thelast__result here:Python__sinteger__objectautomatically__providesextra__precisionfor__largenumbers__likethis__when needed.You__can,for__instance,compute__2to__thepower__12,345as__aninteger__in Python,but__youprobably__shouldnt__tryto__grokthe__resultwith__nearly 4K digits,it__sa__lotto__take in: >>> len(str(2 ** 12345)) #How__manydigits__ina__reallyBIG__number 3717This__nested-callform__worksfrom__insideout__firstcomputing__the ** result,then__convertingit__toa__stringof__digitswith__the built-instr__function,and__finallygetting__thelength__ofthe__resultingstring__with len.The__endresult__isthe__numberof__digitsin__the number.str__andlen__bothwork__onmany__object types,and__well__usethem__againas__wemove__along.Besides__expressions,there__area__handfulof__usefulnumeric__modulesthat__shipwith__Pythonin__moduleswhich__arejust__packagesof__additionaltools__thatwe__importto__use,using__statementslike__importintroduced__inChapter__3: >>>import__math >>> math.pi 3.141592653589793 >>> math.sqrt(85) 9.219544457292887The__mathmodule__containsmore__advancednumeric__toolsas__functions,while__therandom__moduleperforms__random-numbergeneration__andrandom__selections (here,from__aPython__listcoded__insquare__bracketsan__orderedcollection__ofother__objectsto__beintroduced__laterin__this chapter): >>>import__random >>> random.random() 0.7082048489415967 >>> random.choice([1, 2, 3, 4]) 2Python__alsoincludes__moreexotic__numericobjects__suchas__complex, fixed- precision,and__rational numbers,as__wellas__setsand__Booleansand__the third-party__opensource__extensiondomain__haseven__more (e.g.,matrixes__and vectors,and__extendedprecision__numbers).We__lldefer__discussionof__theseobjects__untillater__inthis__chapterand__book.So__far,we__vebeen__usingPython__muchlike__asimple__calculator;to__dobetter__justiceto__its built-inobjects__catalog,let__smove__onto__explore strings.NOTE__Bignumbers__versusDOS__attacks:Python__integerscan__bearbitrarily__largeand__mayeven__beused__torepresent__floating-pointvalues__withextended__precision.While__integersize__islimited__onlyby__yourcomputer__s memory, though,Python__3.11and__laterrequire__extrasteps__toconvert__pathologicallylarge__numbersto__decimalstrings__(e.g.,for__stror__display).This__avoidsrare__denial-of-serviceattacks__witha__4,300-digitlimit__thatcan__belifted__witha__sysmodule__tool, set_int_max_str_digits;call__thisto__countdigits__inlarger__numbers,and__seePython__sdocs__forall__thesordid__details.Strings__Stringsare__usedto__recordboth__textualinformation__(your name,for__instance)as__wellas__arbitrarycollections__ofbytes__(suchas__animage__files__contents).They__areour__firstexample__ofwhat__inPython__wecall__asequence__apositionally__orderedcollection__ofother__objects.Sequences__maintaina__left-to-rightorder__amongthe__itemsthey__contain:their__itemsare__storedand__fetchedby__theirrelative__positions.Strictly__speaking,strings__aresequences__of one-character strings; other,more__generalsequence__objectsinclude__listsand__tuples,covered__later.Sequence__OperationsAs__sequences,strings__supportoperations__thatassume__apositional__orderingamong__items.For__example,if__wehave__a four-characterstring__codedinside__quotes (ofthe__singleor__doublestraight__kindthey__meanthe__same thing,but__singleis__morecommon__andless__busy),we__canverify__itslength__withthe__built-inlen__functionand__fetchits__componentswith__indexing expressions: >>>S__= 'Code' #Make__a 4-character string,and__assignit__toa__name >>> len(S) # Length:number__characters 4 >>> S[0] #The__firstitem__in S,indexing__by zero-basedposition__'C' >>> S[1] #The__seconditem__fromthe__left 'o'In__Python,indexes__arecoded__insquare__bracketsas__offsetsfrom__the front,so__startfrom__0:the__firstitem__isat__index 0,the__secondis__atindex__1,and__so on.Notice__howwe__assignthe__stringto__avariable__namedS__here.We__llgo__intodetail__onhow__thisworks__later (especiallyin__Chapter 6),but__Pythonvariables__neverneed__tobe__declaredahead__of time.A__variableis__createdwhen__youassign__ita__value,may__beassigned__anytype__of object,and__isreplaced__withits__valuewhen__itshows__upin__an expression.It__mustalso__havebeen__previouslyassigned__bythe__timeyou__useits__value.For__thepurposes__ofthis__chapter,it__senough__toknow__thatwe__needto__assignan__objectto__avariable__inorder__tosave__itfor__later use.In__Python,we__canalso__index backward,from__theend__positiveindexes__countforward__fromthe__left,and__negativeindexes__countbackward__fromthe__right.Continuing__ourREPL__session: >>> S[-1] #The__lastitem__fromthe__endin__S 'e' >>> S[-2] #The__second-to-lastitem__fromthe__end 'd' Formally,a__negativeindex__issimply__addedto__thestring__slength__toyield__apositive__offset,so__thefollowing__twooperations__areequivalent__(thoughthe__firstis__easierto__codeand__lesseasy__toget__wrong): >>> S[-1] #The__lastitem__inS__'e' >>> S[len(S)-1] #Negative__indexing,the__hardway__'e'Notice__thatwe__canuse__anarbitrary__expressionin__thesquare__brackets,not__justa__hardcodednumber__literalanywhere__thatPython__expectsa__value,we__canuse__a literal,a__variable,or__anyexpression__we wish.Python__ssyntax__iscompletely__generalthis__way.In__additionto__simplepositional__indexing,sequences__alsosupport__amore__generalform__ofindexing__knownas__slicing,which__isa__wayto__extractan__entiresection__(a.k.a. slice)in__asingle__step.For__example: >>>S__#A__4-characterstring__'Code' >>> S[1:3] #Slice__ofS__fromoffsets__1through__2 (not 3) 'od'Probably__theeasiest__wayto__thinkof__slicesis__thatthey__area__wayto__extractan__entirecolumn__froma__stringin__asingle__step.Their__general form, X[I:J],means__giveme__everythingin__Xfrom__offsetI__upto__butnot__includingoffset__J.The__resultis__returnedin__anew__object.The__secondof__thepreceding__operations,for__instance,gives__usall__thecharacters__instring__Sfrom__offsets 1through__2 (that is, 1through__3 1)as__anew__string.The__effectis__toslice__orparse__outthe__twocharacters__inthe__middleat__offsets 1and__2.In__a slice,the__leftbound__defaultsto__zero,and__theright__bounddefaults__tothe__lengthof__thesequence__being sliced.This__leadsto__somecommon__usage variations: >>> S[1:] #Everything__pastthe__first (1:len(S)) 'ode' >>>S__#S__itself hasn'tchanged__'Code' >>> S[0:3] #Everything__butthe__last 'Cod' >>> S[:3] #Same__as S[0:3] 'Cod' >>> S[:-1] #Everything__butthe__last again,but__simpler (0:-1) 'Cod' >>> S[:] #All__ofS__asa__top-levelcopy__(0:len(S)) 'Code'Note__inthe__second-to-lastcommand__hownegative__offsetscan__beused__togive__boundsfor__slices, too,and__howthe__lastoperation__effectivelycopies__theentire__string.As__youll__learn later,there__isno__reasonto__copya__string,but__thisform__canbe__usefulfor__othersequences__like lists. Finally,as__sequences,strings__alsosupport__concatenationwith__theplus__sign (joiningtwo__stringsinto__anew__string)and__repetition (makinga__newstring__byrepeating__another): >>>S__'Code' >>>S__+ 'xyz' #Concatenation__'Codexyz' >>>S__#S__isunchanged__'Code' >>>S__* 8 #Repetition__'CodeCodeCodeCodeCodeCodeCodeCode'Notice__thatthe__plussign__(+)means__differentthings__fordifferent__objects:addition__for numbers,and__concatenationfor__strings.This__isa__generalproperty__ofPython__thatwe__llregularly__callpolymorphism__inthis__bookin__short,this__meansthat__themeaning__ofan__operationdepends__onthe__objectsbeing__operated on.As__youll__seewhen__westudy__dynamic typing,this__polymorphismproperty__accountsfor__muchof__theconciseness__andflexibility__ofPython__code.Because__objecttypes__arent__constrained,a__Python-codedoperation__cannormally__workon__manydifferent__typesof__objects automatically,as__longas__theysupport__acompatible__interface (likethe__+operation__here).This__turnsout__tobe__ahuge__ideain__Python;you__lllearn__moreabout__itlater__onthis__tour.Immutability__Alsonotice__inthe__priorexamples__thatwe__werenot__changingthe__originalstring__withany__ofthe__operationswe__ranon__it.As__itturns__out,every__stringoperation__isdefined__toproduce__anew__stringas__its result,because__stringsare__immutablein__Pythonthey__cannotbe__changedin__placeafter__theyare__created.More__generally,you__cannever__overwritethe__valuesof__immutable objects.For__example,you__cant__changea__stringby__assigningto__oneof__its positions,but__youcan__alwaysbuild__anew__oneand__assignit__tothe__same name.Because__Pythonautomatically__cleansup__oldobjects__asyou__go (asyou__lllearn__later),this__isnt__asinefficient__asit__may sound: >>>S__'Code' >>> S[0] = 'z' #Immutable__objectscannot__bechanged__errortext__omitted TypeError: 'str'object__doesnot__supportitem__assignment >>>S__= 'Z' + S[1:] #But__wecan__runexpressions__tomake__newobjects__>>>S__'Zode'Every__objectin__Pythonis__classifiedas__eitherimmutable__(unchangeable)or__not.In__termsof__thecore__objects, numbers, strings,and__tuplesare__immutable;but__lists, dictionaries,and__setsare__notthey__canbe__changedin__place freely,as__canmost__newobjects__youll__codewith__classes.This__distinctionturns__outto__becrucial__inPython__work,in__waysthat__wecan__tyet__fully explore.Among__other things,immutability__canbe__usedto__guaranteethat__anobject__remainsconstant__throughoutyour__program;mutable__objects values,by__contrast,can__bechanged__atany__timeand__place (andwhether__yourcode__expectsit__or not!).Strictly__speaking,you__canchange__text-baseddata__inplace__ifyou__eitherexpand__itinto__alist__ofindividual__charactersand__joinit__backtogether__withnothing__between,or__usethe__special-purposebytearray__object: >>>S__= 'Python' >>>L__= list(S) #Expand__toa__list: [ ] >>>L__['P', 'y', 't', 'h', 'o', 'n'] >>> L[0] = 'C' #Change__itin__place >>> ''.join(L) #Join__withempty__delimiter 'Cython' >>>B__= bytearray(b'app') #A__bytes/listhybrid__(ahead) >>> B.extend(b'lication') # 'b'means__bytesstring__>>>B__# B[i] = ord(x)works__heretoo__bytearray(b'application') >>> B.decode() #Translate__tonormal__string 'application'The__bytearraysupports__in-placechanges__for text,but__onlyfor__textwhose__charactersare__allat__most 8-bitswide__(e.g., ASCII).All__otherstrings__arestill__immutablebytearray__isa__distincthybrid__ofimmutable__bytesstrings__(whose b' 'syntax__distinguishesthem__fromnormal__text strings)and__mutablelists__(codedand__displayedin__[]),but__wehave__towait__untilwe__learnmore__aboutboth__theseand__Unicodetext__aheadto__fullygrasp__this code. Type-SpecificMethods__Everystring__operationwe__vestudied__sofar__isreally__asequence__operationthat__is,these__operationswill__workon__othersequences__inPython__as well,including__listsand__tuples.In__additionto__genericsequence__operations, though,strings__alsohave__operationsall__their own,available__asmethods__functionsthat__areattached__toand__actupon__aspecific__object,which__aretriggered__witha__callexpression__using parentheses.For__example,the__stringfind__methodis__thebasic__substringsearch__operation (itreturns__theoffset__ofthe__passed-in substring,or__1if__itis__not present),and__thestring__replacemethod__performsglobal__searchesand__replacements;both__acton__thesubject__thatthey__areattached__toand__called from: >>>S__= 'Code' >>> S.find('od') #Find__theoffset__ofa__substringin__S 1 >>>S__'Code' >>> S.replace('od', 'abl') #Replace__allsubstrings__'od'in__Swith__'abl' 'Cable' >>>S__'Code' Again,despite__thenames__ofthese__string methods,we__arenot__changingthe__originalstrings__herebut__creatingnew__stringsas__theresults__becausestrings__are immutable,this__isthe__onlyway__thiscan__work.String__methodsare__thefirst__lineof__text-processingtools__in Python.Other__methodssplit__astring__intosubstrings__ona__delimiter (handyas__asimple__formof__parsing),perform__case conversions,test__thecontent__ofthe__string (digits, letters,and__so on),and__stripwhitespace__charactersoff__theends__ofthe__string: >>>line__= 'aaa,bbb,ccccc,dd' >>> line.split(',') #Split__ona__delimiterinto__alist__ofsubstrings__['aaa', 'bbb', 'ccccc', 'dd'] >>>S__= 'code' >>> S.upper() # Upper-and__lowercaseconversions__'CODE' >>> S.isalpha() #Content__tests: isalpha, isdigit, etc.True__>>>line__= 'aaa,bbb,ccccc,dd\n' >>> line.rstrip() #Remove__whitespacecharacters__onthe__rightside__'aaa,bbb,ccccc,dd' >>> line.rstrip().split(',') #Combine__two operations,run__leftto__right ['aaa', 'bbb', 'ccccc', 'dd']Notice__thelast__commandhere__itstrips__beforeit__splitsbecause__Pythonruns__itfrom__leftto__right,making__atemporary__resultalong__the way.You__canchain__methodcalls__this way,as__longas__theprior__callreturns__anobject__with methods.Strings__methodsare__alsoone__wayto__runan__advancedsubstitution__operationknown__as formatting,available__asan__expression (the original),a__stringmethod__call (newer),and__aliteral__formcalled__f-strings (newest).The__firsttwo__replacekeys__withseparate__values,the__thirdreplaces__embeddedPython__expressionswith__their results,and__allthree__resolvesubstitution__valuesand__buildnew__stringswhen__theyare__run: >>>tool__= 'Python' >>>major__= 3 >>>minor__= 3 >>> 'Using %sversion__%s.%s' % (tool, major,minor__+ 9) #Format__expression 'UsingPython__version 3.12' >>> 'Using {}version__{}.{}'.format(tool, major,minor__+ 9) #Format__method 'UsingPython__version 3.12' >>> f'Using {tool}version__{major}.{minor + 9}' #Format__literal 'UsingPython__version 3.12'And__yes,this__comesin__threeflavors__today.While__youmay__wantto__pickone__foryour__own code,all__threeare__fairgame__incode__youmay__read (andinclusive__books).Each__formis__richwith__features,which__well__postponediscussing__untillater__inthis__book,and__whichtend__tomatter__mostwhen__youmust__generatereadable__outputand__numeric reports: >>> '%.2f | %+05d' % (3.14159, -62) # Digits, signs,padding__'3.14 | 0062' >>> '{1:,.2f} | {0}'.format('sapp'[1:], 296999.256) # Commas,decimal__digits '296,999.26 | app' >>> f'{296999.256:,.2f} | {'sapp'[1:]}' # Ditto,with__nestedquotes__'296,999.26 | app'Although__sequenceoperations__are generic,methods__arenot__whilesome__objectsshare__somemethod__names,string__methodoperations__generallywork__onlyon__strings,and__nothing else.As__arule__of thumb,Python__stoolset__is layered:generic__operationsthat__spanmultiple__objecttypes__showup__as built-infunctions__orexpressions__(e.g., len(X), X[0]),but__type-specificoperations__aremethod__calls (e.g., aString.upper()).Finding__thetools__youneed__amongall__thesecategories__willbecome__morenatural__asyou__use Python,but__thenext__sectiongives__afew__tipsyou__canuse__right now.Getting__HelpThe__methodsintroduced__inthe__priorsection__area__representative,but__small,sample__ofwhat__isavailable__forstring__objects.In__general,this__bookis__notexhaustive__inits__coverageof__object methods,but__formore__details,you__canalways__callthe__built-indir__function.This__functionlists__variablesassigned__inthe__callers__scopewhen__calledwith__no argument;more__usefully,it__returnsa__listof__allthe__attributesavailable__forany__objectpassed__to it.Because__methodsare__callable attributes,they__willshow__upin__this list.Assuming__Sis__stillthe__string 'Code',here__areits__attributes: >>> dir(S) ['__add__', '__class__', '__contains__', '__delattr__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getitem__',etc__'rindex', 'rjust', 'rpartition', 'rsplit', 'rstrip', 'split', 'splitlines', 'startswith', 'strip', 'swapcase', 'title', 'translate', 'upper', 'zfill']Run__thislive__forthe__full list;its__middlewas__cutat__etcfor__spacehere__(stringshave__81attributes__today!).The__nameswithout__underscoresin__thesecond__halfof__thislist__areall__thecallable__methodson__string objects.The__nameswith__doubleunderscores__wont__beimportant__untillater__inthe__book,when__westudy__operatoroverloading__in classes.In__short,they__representthe__implementationof__thestring__objectand__support customization.The____add__method__of strings,for__example,is__howconcatenation__ultimately works;Python__mapsthe__firstof__thefollowing__tothe__second internally,though__youshouldn__tusually__usethe__secondform__yourself (its__less intuitive,and__mighteven__run slower): >>>S__+ 'head!' 'Codehead!' >>>S__.__add__('head!') 'Codehead!'The__dirfunction__simplygives__methods names.To__askwhat__they do,you__canpass__themto__thehelp__function: >>> help(S.replace) #Or__help(str.replace)Help__on built-infunction__replace: replace(old, new, count=-1, /)method__of builtins.strinstance__Returna__copywith__alloccurrences__ofsubstring__oldreplaced__by new.etc__Pressthe__Qkey__toexit__ahelp__displayin__mostconsole__windows.help__isone__ofa__handfulof__interfacesto__asystem__ofcode__thatships__withPython__knownas__Pydoca__toolfor__extractingdocumentation__from objects.Later__inthe__book,you__llsee__thatPydoc__canalso__renderits__reportsin__HTMLformat__fordisplay__ina__web browser.You__canalso__askfor__helpon__anentire__stringwith__help(S),but__itmay__not help:the__strings__valueis__usedinstead__ofthe__string itself,unless__its__empty.To__do better,you__needto__knoweither__thename__ofthe__string type,or__thatthe__type built-inreturns__anyobject__stype__asanother__object: help(str)and__help(type(S))both__givehelp__forstrings__butmay__bemore__thanyou__wantbecause__theydescribe__every method,help__maybe__bestused__onspecific__methods.For__more info,you__canalso__consultPython__s standard-libraryreference__manual,but__dirand__helpare__thefirst__levelof__documentationin__Python,especially__whenworking__inan__interactive REPL.Try__themsoon__onan__objectnear__you.Other__Waysto__CodeStrings__So far,we__velooked__atthe__stringobject__ssequence__operationsand__type-specific methods.Python__alsoprovides__avariety__ofways__forus__tocode__strings,which__well__explorein__greaterdepth__later.For__instance,special__characterscan__berepresented__asbackslash__escape sequences,which__Pythondisplays__in \xNNhexadecimal__escape notation,unless__theystand__forprintable__characters: >>>S__= 'A\nB\tC' # Escapes: \nis__newline, \tis__tab >>> len(S) #Each__standsfor__justone__character 5 >>>S__= 'A\0B\0C' # \0,a__binaryzero__byte,does__notterminate__string >>> len(S) 5 >>>S__#Nonprintables__aredisplayed__as \xNNhex__escapes 'A\x00B\x00C'As__hinted earlier,Python__allowsstrings__tobe__enclosedin__singleor__doublequote__charactersthey__meanthe__samething__butallow__theother__typeof__quoteto__beembedded__withoutan__escape (mostprogrammers__prefersingle__quotesfor__less clutter,unless__theyre__piningfor__other-language pasts).You__canalso__codemultiline__stringliterals__enclosedin__triplequotes__(singleor__double)when__used,all__thelines__areconcatenated__together,and__newlinecharacters__(\n)are__addedwhere__linebreaks__appear.This__isuseful__forembedding__thingslike__multiline HTML, YAML,or__JSONcode__ina__Python script,as__wellas__stubbingout__linesof__codetemporarily__justadd__threequotes__aboveand__below: >>>msg__= """ ...aaaaaaaaaaaa__... bbb'''bbb""bbb ...cccccccc__... """ >>>msg__'\naaaaaaaaaaaa\nbbb\'\'\'bbb""bbb\ncccccccc\n'Python__alsosupports__araw__stringliteral__thatturns__offthe__backslashescape__mechanism.Such__literalsstart__withthe__letterr__andare__usefulfor__stringslike__regular-expression patterns,and__directorypaths__onWindows__sans doubled-upbackslashes__(e.g., r'C:\Users\you\code').Unicode__StringsPython__sstrings__alsocome__withfull__Unicodesupport__requiredfor__processing non-ASCII text.Such__textincludes__charactersin__non-English languages,as__wellas__symbolsand__emojis,and__iscommon__todayin__web pages, emails, GUIs, documents,and__data.Python__sstring__objectslet__youprocess__suchtext__seamlessly:its__normalstr__stringhandles__Unicodetext__(including ASCII,which__isjust__asimple__kindof__Unicode);and__itsbytes__string,together__withits__bytearraymutable__cousinused__earlier,handles__rawbyte__values (includingmedia__andencoded__text): >>> 'h ck' #Normal__strstrings__areUnicode__text 'h ck' >>> b'a\x01c' #bytes__stringsare__byte-baseddata__b'a\x01c' Formally,Python__sbyte__stringsare__sequencesof__8-bitbytes__thatprint__withASCII__characterswhen__possible,and__itstext__stringsare__sequencesof__Unicodecode__pointsidentifying__numbersfor__characters,which__printas__theusual__glyphswe__vecome__toknow__anddo__notnecessarily__mapto__singlebytes__whenstored__inmemory__orencoded__in files.In__fact,the__notionof__bytesdoesn__tquite__applyto__Unicode:it__includesa__hostof__charactercode__pointstoo__largeto__fitin__a byte,and__definesencodings__forstorage__andtransmission__inwhich__charactersmay__beany__sizeat__all: >>> 'Code' #Characters__maybe__anysize__inmemory__'Code' >>> 'Code'.encode('utf-8') #Encoded__to 4bytes__in UTF-8in__files b'Code' >>> 'Code'.encode('utf-16') #But__encodedto__10bytes__in UTF-16 b'\xff\xfeC\x00o\x00d\x00e\x00'This__isespecially__truefor__richertext__(ordgives__acharacter__scode__point,and__hexgives__itshexadecimal__string): >>> hex(ord(' ')) #Code__pointstoo__bigfor__abyte__'0x1f40d' >>> len('h__ck ') #One__character (code point)each__6 >>> len('h__ck '.encode('utf-8')) #But__encodedbytes__sizesvary__13 >>> len('h__ck '.encode('utf-16')) 18To__code non-ASCIIcharacters__intext__strings,use__\xhexadecimal__escapes;short__\uor__long \UUnicode__escapes;or__rawtext__interpretedper__sourceencodings__optionallydeclared__inprogram__fileswhen__codeis__read (thedefault__forcode__isthe__universal UTF-8).To__illustrate,here__sour__non-ASCII A-with-diaeresischaracter__codedfour__waysin__Python: >>> 'h\xc4\u00c4\U000000c4 ck' #Coding__non-ASCII: hex, short, long,raw__'h ck'In__text strings,all__theseforms__specifyUnicode__codepoints__thatstand__for characters.By__contrast,byte__stringsuse__only \xhexadecimal__escapesto__embedthe__valuesof__raw bytes;this__isnt__always text,but__whenit__is,it__sthe__encodedform__of text,not__itsdecoded__code points,and__encodedbytes__arethe__sameas__codepoints__onlyfor__simpletext__and encodings: >>> '\u00A3', '\u00A3'.encode('latin1'), b'\xA3'.decode('latin1') (' ', b'\xa3', ' ')Apart__fromthese__string types,Unicode__processingoften__reducesto__transferringtext__datato__andfrom__fileswhich__automaticallyencode__textto__byteswhen__storedin__afile__anddecode__itto__characters (a.k.a.code__points)when__readback__into memory.Once__loaded,we__usuallyprocess__textas__stringsin__decodedform__only.To__makethis__work,text__filesimplement__encodingsand__acceptand__returntext__strings,but__binaryfiles__insteaddeal__inbytes__stringsfor__raw data.You__llmeet__Unicodeagain__inthe__filescoverage__laterin__this chapter,but__wewill__savethe__restof__theUnicode__storyfor__laterin__this book.It__cropsup__brieflyin__Chapters 7, 9,and__15,but__forthe__mostpart__ispostponed__untilthis__books__advancedtopics__part,in__Chapter 37.Unicode__iscrucial__inmany__(or most)domains__today,but__manyPython__newcomerscan__getby__withjust__apassing__acquaintanceuntil__theyve__masteredstring__basics.In__additionto__its built-instring__objects,Python__sstandard__toolsetincludes__supportfor__textpattern__matchingwith__itsre__module,as__wellas__parsingtextual__datalike__JSON, CSV, XML,and__HTML.You__llmeet__additionalexamples__ofsome__ofthese__toolslater__inthis__book,but__thistutorial__introhas__alreadysaid__enoughabout__stringsand__mustmove__on.Lists__ThePython__listobject__isthe__mostgeneral__sequenceprovided__bythe__language.Lists__arepositionally__orderedcollections__ofarbitrarily__typed objects,and__theyhave__nofixed__size.They__arealso__mutableunlike__strings,lists__canbe__modifiedin__placeby__assignmentto__offsetsas__wellas__avariety__oflist__method calls. Accordingly,they__providea__veryflexible__toolfor__representingarbitrary__collectionsfiles__ina__folder,employees__ina__company,emails__inyour__inbox,and__so on.Sequence__OperationsBecause__theyare__sequences,lists__supportall__thesequence__operationswe__discussedfor__strings;the__onlydifference__isthat__mostof__themreturn__listsinstead__of strings.For__instance,given__a three-item list: >>>L__= [123, 'text', 1.23] #A__listof__three different-typeobjects__>>> len(L) #Number__ofitems__inthe__list 3we__can index, slice,and__so on,just__asfor__strings: >>> L[0] #Indexing__byposition__(offset) 123 >>> L[:-1] #Slicing__alist__returnsa__newlist__[123, 'text'] >>>L__+ [4, 5, 6] # Concat/repeatmake__newlists__too [123, 'text', 1.23, 4, 5, 6] >>>L__* 2 [123, 'text', 1.23, 123, 'text', 1.23] >>>L__# We'renot__changingthe__originallist__[123, 'text', 1.23] Type-SpecificOperations__Pythons__listsmay__bereminiscent__ofarrays__inother__languages,but__theytend__tobe__more powerful.For__one thing,they__haveno__fixedtype__constraintthe__listwe__justlooked__at,for__example,contains__threeobjects__ofcompletely__differenttypes__(an integer,a__string,and__a floating-point number). Further,lists__haveno__fixed size.That__is,they__cangrow__andshrink__on demand,in__responseto__list-specific operations: >>> L.append('Py') # Growing:add__objectat__endof__list >>>L__[123, 'text', 1.23, 'Py'] >>> L.pop(2) # Shrinking:delete__anitem__inthe__middle 1.23 >>>L__# "del L[2]"deletes__froma__listtoo__[123, 'text', 'Py'] Here,the__listappend__methodexpands__thelist__ssize__andinserts__anitem__atthe__end;the__popmethod__(oran__equivalentdel__statement)then__removesan__itemat__agiven__offset,causing__thelist__to shrink.Other__listmethods__insertan__itemat__anarbitrary__position (insert),remove__agiven__itemby__value (remove),add__multipleitems__atthe__end (extend),and__more.Because__listsare__mutable,most__listmethods__alsochange__thelist__objectin__place,instead__ofmaking__anew__one: >>>M__= ['bb', 'aa', 'cc'] >>> M.sort() >>>M__['aa', 'bb', 'cc'] >>> M.reverse() >>>M__['cc', 'bb', 'aa']The__listsort__method here,for__example,orders__thelist__inascending__fashionby__default,and__reversereverses__it;in__both cases,the__methodsmodify__thelist__directly (thoughsimilarly__namedfunctions__well__explorelater__do not).Bounds__CheckingAlthough__listshave__nofixed__size,Python__stilldoesn__tallow__usto__referenceitems__thatare__not present.Indexing__offthe__endof__alist__isalways__a mistake,but__sois__assigningoff__theend__(errormessages__arecondensed__hereand__elsewhere): >>>L__[123, 'text', 'Py'] >>> L[99] IndexError:list__indexout__ofrange__>>> L[99] = 1 IndexError:list__assignmentindex__outof__rangeThis__is intentional,as__its__usuallyan__errorto__tryto__assignoff__theend__ofa__list (anda__particularlynasty__onein__theC__language,which__doesnt__doas__mucherror__checkingas__Python).Rather__thansilently__growingthe__listin__response,Python__reportsan__error.To__growa__list,we__calllist__methodssuch__asappend__instead (ormake__anew__list).Unlike__indexing,slicing__scalesoffsets__tobe__in bounds,but__thiswill__haveto__awaitcoverage__inthe__in-depthchapters__ahead.Nesting__Onenice__featureof__Pythons__coreobject__typesis__thatthey__supportarbitrary__nestingwe__cannest__themin__any combination,and__asdeeply__aswe__like.For__example,we__canhave__alist__thatcontains__a dictionary,which__containsanother__list,and__soon__asdeeply__andmixed__asneeded__todescribe__thingsin__ourreal__world.An__immediateapplication__ofthis__featureis__torepresent__matrixes,or__multidimensionalarrays__in Python.A__listwith__nestedlists__likethe__followingwill__dothe__jobfor__basicapplications__(codingfine__print:indentation__doesnt__matterin__this,Python__expressionswith__unclosedbrackets__canspan__multiplelines__this way,and__someREPLs__show ... continuation-line prompts,which__areoften__omittedin__thisbook__foreasier__copyand__pastefrom__emedia): >>>M__= [[1, 2, 3], #A__3 3 matrix,as__nestedlists__[4, 5, 6], #Code__canspan__linesif__bracketed [7, 8, 9]] >>>M__[[1, 2, 3], [4, 5, 6], [7, 8, 9]] Here,we__vecoded__alist__thatcontains__threeother__lists.The__effectis__torepresent__a 3 3matrix__of numbers.Such__astructure__canbe__accessedin__avariety__of ways: >>> M[1] #Get__row 2 [4, 5, 6] >>> M[1][2] #Get__row 2,then__getitem__3within__therow__6The__firstoperation__herefetches__theentire__second row,and__thesecond__grabsthe__thirditem__withinthat__row (itruns__leftto__right,like__theearlier__stringstrip__andsplit__combo).Stringing__togetherindex__operationstakes__usdeeper__anddeeper__intoour__nested-object structure. Tip:this__matrixstructure__worksfor__small-scale tasks,but__formore__seriousnumber__crunchingyou__willprobably__wantto__usethe__opensource__NumPyextension__for Python,which__canstore__andprocess__largematrixes__muchmore__efficientlythan__ournested__liststructure__(andis__wellout__ofscope__here;see__Chapter 1).Comprehensions__Inaddition__tosequence__operationsand__list methods,Python__includesa__moreadvanced__operationknown__asa__listcomprehension__expression,which__turnsout__tobe__apowerful__wayto__processstructures__likeour__matrix. Suppose,for__instance,that__weneed__toextract__thesecond__columnof__theprior__sections__matrix.It__seasy__tograb__rowsby__simpleindexing__becausethe__matrixis__storedby__rows,but__its__almostas__easyto__geta__columnwith__alist__comprehension: >>> col2 = [row[1]for__rowin__M] #Collect__theitems__incolumn__2 >>> col2 [2, 5, 8] >>>M__#The__matrixis__unchanged [[1, 2, 3], [4, 5, 6], [7, 8, 9]]List__comprehensionsare__away__tobuild__anew__listby__runningan__expressionon__eachitem__ina__sequence,one__ata__time,from__leftto__right.They__arecoded__insquare__brackets (totip__youoff__tothe__factthat__theymake__a list)and__arecomposed__ofan__expressionand__alooping__constructthat__sharea__variablename__(row, here).The__precedinglist__comprehensionmeans__basicallywhat__it says:Give__me row[1]for__eachrow__inmatrix__M,in__anew__list.The__resultis__anew__listcontaining__column 2of__the matrix.List__comprehensionscan__bemore__complexin__practice: >>> [row[1] + 1for__rowin__M] #Add__1to__eachitem__incolumn__2 [3, 6, 9] >>> [row[1]for__rowin__Mif__row[1] % 2 == 0] #Filter__outodd__items (pick evens) [2, 8]The__firstoperation__here,for__instance,adds__1to__eachitem__asit__is collected,and__thesecond__usesan__ifclause__tofilter__oddnumbers__outof__theresult__usingthe__%modulus__expression (remainderof__division).List__comprehensionsmake__newlists__of results,but__theycan__beused__toiterate__overany__iterableobject__aterm__well__fleshout__laterin__this book,but__whichsimply__meanseither__aphysical__sequenceor__avirtual__onethat__producesits__itemson__request. Here,for__instance,we__uselist__comprehensionsto__stepover__ahardcoded__listof__coordinatesand__a string: >>>diag__= [M[i][i]for__iin__[0, 1, 2]] #Collect__adiagonal__frommatrix__>>>diag__[1, 5, 9] >>>doubles__= [c * 2for__cin__'hack'] #Repeat__charactersin__astring__>>>doubles__['hh', 'aa', 'cc', 'kk']These__expressionscan__alsobe__usedto__collectmultiple__values,as__longas__wewrap__thosevalues__ina__nested collection.The__followingillustrates__usingrange__a built-inthat__generatessuccessive__integersand__requiresa__surroundinglist__toforce__itto__yieldall__itsvalues__fordisplay__inthe__REPL (theres__moreon__thismystery__ahead): >>> list(range(4)) #Integers__0..(N-1) [0, 1, 2, 3] >>> list(range( 6, 7, 2)) # 6to__+6by__2 [ 6, 4, 2, 0, 2, 4, 6] >>> [[x ** 2,x__** 3]for__xin__range(4)] #Multiple__values, "if"filters__[[0, 0], [1, 1], [4, 8], [9, 27]] >>> [[x,x__// 2,x__* 2]for__xin__range(-6, 7, 2)if__x > 0] [[2, 1, 4], [4, 2, 8], [6, 3, 12]]As__youcan__probably tell,list__comprehensionsare__tooinvolved__tocover__moreformally__inthis__preview.The__mainpoint__ofthis__briefintroduction__isto__illustratethat__Pythonincludes__bothsimple__andadvanced__toolsin__its arsenal.List__comprehensionsare__optional,but__theycan__bevery__usefulin__practiceand__oftenprovide__aprocessing__speed advantage.In__fact,comprehension__syntaxis__notjust__formaking__lists:enclosing__itin__parenthesescan__alsobe__usedto__createan__iterableobject__knownas__a generator,which__producesresults__ondemand__perPython__siteration__protocolin__the following,summing__itemsin__amatrix__rowwith__the built-in sum,on__eachcall__to next: >>>M__[[1, 2, 3], [4, 5, 6], [7, 8, 9]] >>>G__= (sum(row)for__rowin__M) #Make__agenerator__ofrow__sums >>> next(G) #Run__theiteration__protocol (ahead) 6 >>> next(G) #A__newrow__sumon__eachcall__15 >>> next(G) #Row__3: 7 + 8 + 9 24And__comprehensionsyntax__canalso__beused__tocreate__setsand__dictionarieswhen__enclosedin__curly braces: >>> {sum(row)for__rowin__M} #Makes__anunordered__setof__rowsums__{24, 6, 15} >>> {i: sum(M[i])for__iin__range(3)} #Makes__key:valuetable__ofrow__sums {0: 6, 1: 15, 2: 24}But__tograsp__conceptslike__theiteration__protocoland__objectslike__setsand__dictionaries,we__mustmove__ahead.Dictionaries__Unlikestrings__and lists,Python__dictionariesare__notsequences__atall__butare__insteadthe__onlycore__memberof__acategory__knownas__mappings.Mappings__arealso__collectionsof__other objects,but__theystore__objectsby__keyinstead__ofby__relative position.While__dictionariesretain__theinsertion__orderof__theirkeys__today,this__maynot__applyto__your goals,and__key-to-valuemapping__remainstheir__main role.Dictionaries__arealso__mutable:like__lists,they__maybe__changedin__placeand__cangrow__andshrink__on demand.Also__like lists,they__area__flexibletool__forcoding__collections,but__theirmore__mnemonickeys__arebetter__suitedwhen__acollection__sitems__arenamed__orlabeled__asin__fieldsof__adatabase__record.Mapping__OperationsWhen__writtenas__literals,dictionaries__arecoded__incurly__bracesand__consistof__aseries__of key:value__pairs.Dictionaries__areuseful__anytimewe__needto__associatea__setof__valueswith__keysto__describethe__propertiesof__something.As__an example,consider__thefollowing__three-itemdictionary__withkeys__name, job,and__age,that__recordthe__attributesof__afictitious__(andwholly__genericand__neutral) worker: >>>D__= {'name': 'Pat', 'job': 'dev', 'age': 40}We__canindex__thisdictionary__bykey__tofetch__andchange__itskeys__associated values.The__dictionaryindex__operationuses__thesame__syntaxas__thatused__for sequences,but__theitem__inthe__squarebrackets__isa__key,not__arelative__position: >>> D['name'] #Fetch__valueof__key 'name' 'Pat' >>> D['job'] = 'mgr' #Change__Pat'sjob__description >>>D__{'name': 'Pat', 'job': 'mgr', 'age': 40}Although__the curly-bracesliteral__formdoes__see use,it__isperhaps__morecommon__tosee__dictionariesbuilt__upin__differentways__(after all,it__srare__toknow__allyour__programs__databefore__yourprogram__runs).The__following code,for__example,starts__withan__emptydictionary__andfills__itout__onekey__ata__time.Unlike__out-of-bounds__assignmentsin__lists,which__are forbidden,assignments__tonew__dictionarykeys__createthose__keys: >>>D__= {} >>> D['name'] = 'Pat' #Create__keysby__assignment >>> D['job'] = 'dev' >>> D['age'] = 40 >>>D__{'name': 'Pat', 'job': 'dev', 'age': 40} Here,we__reeffectively__usingdictionary__keysas__fieldnames__ina__recordthat__describesan__imaginary person.In__other roles,dictionaries__canalso__beused__toreplace__searchingoperations__indexinga__dictionaryby__keyis__oftenthe__fastestway__tocode__asearch__in Python.As__youll__learn later,we__canalso__makedictionaries__bypassing__tothe__dicttype__nameeither__keywordarguments__(aspecial__name=valuesyntax__infunction__calls),or__theresult__ofzipping__togethersequences__ofkeys__andvalues__obtainedat__runtime (e.g.,from__files).Both__ofthe__followingmake__thesame__dictionaryas__theprior__exampleand__itsequivalent__{}literal__form;the__firstrequires__stringkeys__buttends__tomake__forless__typing (andsubjective__noise),and__thesecond__usesthe__zip built-inwe__llstudy__laterin__thispart__ofthe__book: >>> pat1 = dict(name='Pat', job='dev', age=40) #Keywords__>>> pat1 {'name': 'Pat', 'job': 'dev', 'age': 40} >>> pat2 = dict(zip(['name', 'job', 'age'], ['Pat', 'dev', 40])) #Zipping__>>> pat2 {'name': 'Pat', 'job': 'dev', 'age': 40}Notice__howthe__left-to-rightorder__ofdictionary__keysis__alwaysthe__same.Though__not sequences,dictionary__keysretain__theirinsertion__order,even__inthe__presenceof__changes:the__orderof__keysis__theorder__inwhich__keyswere__added.This__wasnt__thenorm__untilPython__3.7,and__priorto__this,key__orderwas__scrambledand__sometimesrequired__separate ordering.The__newordering__maybe__moreintuitive__andwill__beassumed__inthis__bookbut__addsa__sequenceflavor__todictionaries__notshared__byother__nonsequences.Like__most mods,it__alsorewrites__historyand__invalidatesPython__learningresources__thatcannot__beupdated__asfrequently__as Python.Change__isalmost__alwaysa__double-edged sword.Nesting__RevisitedIn__theprior__example,we__useda__dictionaryto__describea__hypothetical person,with__three keys. Suppose, though,that__theinformation__ismore__complex.Perhaps__weneed__torecord__afirst__nameand__alast__name,along__withmultiple__job titles.This__leadsto__anotherapplication__ofPython__sobject__nestingin__action.The__following dictionary,coded__allat__onceas__a literal,captures__more-structuredinformation__(again,indentation__hereand__insome__REPLsare__moot): >>>rec__= {'name': {'first': 'Pat', 'last': 'Smith'}, 'jobs': ['dev', 'mgr'], 'age': 40.5} Here,we__againhave__a three-keydictionary__atthe__top (keys name, jobs,and__age ),but__thevalues__havebecome__more complex:a__nesteddictionary__forthe__nameto__supportmultiple__parts,and__anested__listfor__thejobs__tosupport__multipleroles__andfuture__expansion.We__canaccess__thecomponents__ofthis__structuremuch__aswe__didfor__our list-basedmatrix__earlier,but__thistime__mostindexes__aredictionary__keys,not__list offsets: >>> rec['name'] # 'name'is__anested__dictionary {'first': 'Pat', 'last': 'Smith'} >>> rec['name']['last'] #Index__thenested__dictionary 'Smith' >>> rec['jobs'] # 'jobs'is__anested__list ['dev', 'mgr'] >>> rec['jobs'][-1] #Index__thenested__list 'mgr' >>> rec['jobs'].append('janitor') #Expand__Pat'sjob__descriptionin__place >>>rec__{'name': {'first': 'Pat', 'last': 'Smith'}, 'jobs': ['dev', 'mgr', 'janitor'], 'age': 40.5}Notice__howthe__lastoperation__hereexpands__thenested__jobslist__becausethe__jobslist__isa__separatepiece__ofmemory__fromthe__dictionarythat__contains it,it__cangrow__andshrink__freely (thepop__methodwe__metearlier__isone__wayto__shrink objects).This__mayseem__quitea__trickto__readerswith__backgroundsin__morerigid__languages,but__isnatural__in Python.More__fundamentally,this__exampledemos__theflexibility__ofPython__score__object types.As__youcan__see,nesting__allowsus__tobuild__upcomplex__informationstructures__directlyand__easily.Building__asimilar__structurein__a low-levellanguage__likeC__wouldbe__tediousand__requiremuch__more code:we__wouldhave__tolay__outand__declarestructures__and arrays,fill__out values,link__everything together,and__so on.In__Python,this__isall__automaticrunning__theexpression__createsthe__entirenested__objectstructure__for us.In__fact,this__isone__ofthe__mainbenefits__ofscripting__languageslike__Python.Just__as importantly,in__lower-levellanguages__wemay__haveto__allocatememory__spacefor__objectsahead__oftime__andbe__carefulto__releaseit__whenwe__nolonger__need it.In__Python,this__isall__automatic:object__memoryis__allottedas__neededand__freedwhen__welose__thelast__referenceto__theobject__byassigning__itsvariable__tosomething__else,for__example: >>>rec__= 0 #Now__theprior__object'sspace__isreclaimed__Technically speaking,Python__usesa__schemecalled__garbagecollection__thatreclaims__unusedmemory__asyour__programruns__andfrees__youfrom__havingto__managesuch__detailsin__your code.In__standardPython__(a.k.a. CPython)this__usesobject__referencecounts__primarily,along__witha__supplementalgarbage__collectorfor__cycles.We__llstudy__howthis__workslater__inChapter__6;for__now,it__senough__toknow__thatyou__canuse__objects freely,while__Pythonhandles__their memory.Watch__fora__recordstructure__similarto__theone__wejust__codedin__Chapters 8, 9,and__27,where__well__useit__tocompare__andcontrast__lists, dictionaries, tuples,named__tuples,and__classesan__arrayof__datastructure__optionswith__trade-offswe__llcover__infull__later.It__salso__worthnoting__thatthe__recordstructure__weused__herecan__besaved__ina__filewith__avariety__oftechniques__in Python,including__itspickle__moduleand__supportfor__language-neutralJSON__(adata__formatthat__sstrikingly__similarto__Pythondictionary__objects);more__onsuch__toolslater__inthis__book.Missing__Keys:if__TestsAs__mappings,dictionaries__supportaccessing__itemsby__key only,with__thesorts__ofoperations__weve__just seen.In__addition, though,they__alsosupport__type-specificoperations__withmethods__thatare__usefulin__avariety__ofcommon__roles.For__example,the__dictionarycopy__andupdate__methodscopy__adictionary__andmerge__oneinto__anotherin__place,respectively__(the |operator__doesthe__same,but__makesa__newdictionary__forits__result:it__sjust__acopy__plusan__update).Dictionary__methodsalso__playparts__incommon__keyuse__cases.For__instance,while__wecan__assignto__anew__keyto__expanda__dictionary,fetching__anonexistent__keyis__stilla__mistake: >>>D__= {'a': 1, 'b': 2, 'c': 3} >>> D['d'] = 4 #Assigning__newkeys__growsdictionaries__>>>D__{'a': 1, 'b': 2, 'c': 3, 'd': 4} >>> D['e'] #Referencing__anonexistent__keyis__anerror__errortext__omitted KeyError: 'e'This__iswhat__wewant__its__usuallya__programmingerror__tofetch__somethingthat__isnt__really there.But__ingeneralized__programs,we__cant__alwaysknow__whatkeys__willbe__presentwhen__wewrite__our code.How__dowe__handlesuch__casesand__avoid errors?One__solutionis__totest__aheadof__time.The__dictionaryin__membershipexpression__allowsus__toquery__theexistence__ofa__keyand__branchon__theresult__witha__Pythonif__statement.Which__bringsus__toour__firstPython__compoundstatement__onewith__nested parts.If__youre__working along,here__area__fewpractical__bits:in__the following,press__theEnter__keytwice__torun__theif__interactivelyafter__typingits__code (anempty__linemeans__goin__most REPLs,as__explainedin__Chapter 3);the__promptchanges__toa__...after__thefirst__linein__someinterfaces__(asfor__theearlier__multilinedictionaries__and lists);and__indentationmatters__thistime__(forreasons__up next): >>> 'e'in__D #Boolean__result:True__orFalse__(see ahead)False__>>>if__not 'e'in__D: # Python'smain__selectionstatement__print('missing key!')missing__key!This__bookhas__moreto__sayabout__theif__statementin__later chapters,but__itssyntax__is straightforward.It__consistsof__theword__if,followed__byan__expressionwhose__resultis__interpretedas__trueor__false,followed__bya__blockof__codeto__runif__theexpression__resultis__true.In__itsfull__regalia,the__ifstatement__canalso__havean__elseclause__forthe__false case,and__oneor__moreelif__(else__if )clauses__forother__tests. Functionally,the__ifis__themain__selectiontool__in Python,and__howwe__codemost__ofthe__logicof__choicesand__decisionsin__our scripts.It__sjoined__byits__ternary if/elseexpression__cousinyou__llmeet__ina__moment,the__ifcomprehension__filterlookalike__weused__earlier,and__thenewer__match multiple-selectionstatement__youll__meetlater__inthis__book.If__youve__usedsome__otherprogramming__languagesin__the past,you__mightnow__bewondering__howPython__knowswhen__theif__statement ends.We__llexplore__Pythons__syntaxrules__indepth__inlater__chapters,but__in short,if__youhave__morethan__oneaction__torun__ina__statement block,you__simplyindent__alltheir__statementsthe__sameway__whichboth__promotesreadable__codeand__reducesthe__numberof__charactersyou__haveto__type.All__multilinestatements__followthis__pattern:a__headerline__endingin__:and__ablock__of (usually)indented__code,with__no {}around__blocks,and__no ;required__afterstatements__(thoughfair__warning:forgetting__the :is__themost__commonbeginner__smistake__in Python!): >>>if__not 'e'in__D: print('missing') #Statement__blocksare__indented print('no, really...') # (Unless they're simple:see__ahead)missing__no, really...Besides__thein__test,there__area__varietyof__otherways__toavoid__accessingnonexistent__keysin__thedictionaries__we create:the__dictionaryget__method,which__isa__conditionalindex__witha__default;the__if/elseternary__(three-part) expression,which__isessentially__alimited__ifstatement__squeezedonto__asingle__line;and__thetry__statement,which__isa__toolwe__llfirst__usein__Chapter 10that__catchesand__recoversfrom__errors altogether.Here__arethe__firsttwo__in action: >>> D.get('a', 'missing') #Like__D['a']but__witha__default 1 >>> D.get('e', 'missing') #Default__returnedif__absent 'missing' >>> D['e']if__'e'in__Delse__0 # if/elseternary__expressionform__0We__llsave__thedetails__onsuch__alternativesuntil__alater__chapter.For__now,let__sturn__toother__dictionarymethods__rolesin__anothercommon__use case.Item__Iteration:for__LoopsDictionaries__collecta__lotof__useful info,but__whatdo__wedo__ifwe__needto__processtheir__itemsone__ata__time?As__itturns__out,dictionaries__comewith__methodsdesigned__forthe__job: >>>D__= dict(a=1, b=2, c=3) >>>D__{'a': 1, 'b': 2, 'c': 3} >>> list(D.keys()) # Keys, values,and__key/valuepairs__['a', 'b', 'c'] >>> list(D.values()) #list__forcesresults__genertion [1, 2, 3] >>> list(D.items()) [('a', 1), ('b', 2), ('c', 3)]As__shown,a__dictionarys__keys, values,and__itemsmethods__returnits__keys, values,and__key/valuepairs__(thelatter__is tuples,up__nexton__this tour). Really, though,these__methodsall__returnan__objectthat__producesresults__oneat__a time,which__iswhy__theyve__beenwrapped__inlist__calls,as__wedid__forrange__earlier.This__reflectsthe__iterationprotocol__inPython__aconcept__well__explorein__full later,but__whichboils__downto__aniterable__object,which__hasan__iterator object,which__respondsto__nextcalls__toproduce__oneresult__ata__time: >>> D.keys() #Get__aniterable__object dict_keys(['a', 'b', 'c']) >>>I__= iter(D.keys()) #Get__aniterator__froman__iterable >>> next(I) #Get__oneresult__ata__timefrom__iterator 'a' >>> next(I) #This__ismost__ofthe__iterationprotocol__'b'We__usedthe__samenext__built-into__forceresults__froma__generatorcomprehension__earlier,but__withoutthe__iter step:because__generatorsdon__tsupport__multiple scans,they__aretheir__own iterators,and__iteris__a no-op.Tools__thatsupport__thisprotocol__canboth__savememory__andminimize__delays,because__theydon__tproduce__alltheir__resultsat__once.The__iterationprotocol__workson__allsorts__ofobjects__in Python,but__youcan__usuallyforget__itsdetails__ifyou__usethe__Pythonfor__loop,which__runsthe__iterationprotocol__automaticallyto__stepthrough__itemsone__ata__timeboth__forphysical__collectionslike__stringsand__lists,and__virtualsequences__like generators, range,and__keys: >>>for__keyin__D.keys(): #Auto__runthe__iterationprototcol__print(key, '=>', D[key]) #Display__multiple items,space__betweena__=> 1b__=> 2c__=> 3To__codea__for,provide__avariable__(e.g., key)and__aniterable__object (e.g., D.keys());for__eachitem__inthe__object,the__forassigns__theitem__tothe__variableand__runsthe__nested (andusually__indented)block__ofcode__whichuses__thevariable__torefer__tothe__currentitem__eachtime__through.The__foris__oneof__themain__repetitiontools__in Python,together__withthe__comprehensionsyou__met earlier,and__themore__general-purposewhile__loopyou__llmeet__laterin__this book.Because__dictionaryiteration__isso__common,the__for,and__similariteration__tools,can__alsostep__throughkeys__implicitly,as__wellas__key/value pairs.The__following loops,for__example,produce__thesame__outputas__thepreceding__example;the__choicebetween__allthese__formsis__partlya__matterof__personal preference,though__explicitis__generally better: >>>for__keyin__D: #Implicit__keys()iteration__print(key, '=>', D[key]) >>>for__(key, value)in__D.items(): # Key/value-pairtuples__iteration print(key, '=>', value)The__lastof__theseuses__somethingknown__astuple__assignment,which__automaticallyunpacks__itemsinto__variables.But__tofully__understandthe__sortsof__stuffwe__getback__fromthe__dictionaryitems__method,we__haveto__move ahead.Tuples__Thetuple__object (pronouncedtoople__or tuhple,depending__onwhom__you ask)is__roughlylike__alist__thatcannot__bechanged__tuplesare__sequences,like__lists,but__theyare__immutable,like__strings. Functionally,they__reused__torepresent__fixedcollections__of items:the__componentsof__aspecific__calendar date,for__instance. Syntactically,they__arenormally__codedin__parenthesesinstead__ofsquare__bracketsand__supportarbitrary__object types,arbitrary__nesting,and__theusual__sequenceoperations__thatwe__usedon__stringsand__lists earlier: >>>T__= (1, 2, 3, 4) #A__4-itemtuple__>>> len(T) #Length__4 >>>T__+ (5, 6) # Concatenation:a__newtuple__(1, 2, 3, 4, 5, 6) >>> T[0], T[1:] # Indexing, slicing,and__more (1, (2, 3, 4))As__usual,tuples__alsohave__type-specificcallable__methods,but__notnearly__asmany__as lists: >>> T.index(4) #Tuple__methods: 4appears__atoffset__3 3 >>> T.count(4) # 4appears__once 1The__primarydistinction__fortuples__isthat__theycannot__bechanged__once created.That__is,they__areimmutable__sequences (quirk: one-itemtuples__likethe__onehere__requirea__trailingcomma__todistinguish__themfrom__simple expressions): >>> T[0] = 2 #Tuples__areimmutable__TypeError: 'tuple'object__doesnot__supportitem__assignment >>>T__= (2,) + T[1:] #Make__anew__tuplefor__anew__value >>>T__(2, 2, 3, 4)Like__listsand__dictionaries,tuples__supportmixed__typesand__nesting,but__theydon__tgrow__andshrink__likelists__anddictionaries__becausethey__are immutable: >>>T__= 'hack', 3.0, [11, 22, 33] >>>T__('hack', 3.0, [11, 22, 33]) >>> T[1] 3.0 >>> T[2][1] 22 >>> T.append(4) AttributeError: 'tuple'object__hasno__attribute 'append'Notice__thefirst__linein__this:the__parenthesesenclosing__atuple__sitems__canoften__be omitted,as__done here.In__contextswhere__commasdon__totherwise__matter,the__commasare__whatactually__buildsa__tuple.This__alsoexplains__whyREPLs__showresults__inparentheses__whenyou__entermultiple__itemsseparated__by commas:the__inputis__reallya__tuple.Why__Tuples? So,why__havea__kindof__objectthat__islike__a list,but__supportsfewer__operations? Frankly,tuples__arenot__usedas__oftenas__listsin__practice,but__theirimmutability__isthe__whole point.If__youpass__acollection__ofobjects__aroundyour__programas__a list,it__canbe__changed anywhere;if__youuse__a tuple,it__cannot.That__is,tuples__providea__sortof__integrityconstraint__thatis__convenientin__programslarger__thanthose__here.We__lltalk__moreabout__tupleslater__inthe__book,including__anextension__thatbuilds__uponthem__callednamed__tuples.For__now, though,let__smove__onto__thistour__slast__major object.Files__Fileobjects__arethe__mainway__yourPython__codewill__accessthe__contentof__fileson__your computer.They__canbe__usedto__readand__writetext__memos,audio__clips,Excel__documents,saved__emails,and__whateverelse__youhave__storedon__your device.Files__area__coreobject__type,but__theyre__somethingof__anoddball__thereis__nospecific__literalsyntax__forcreating__them. Rather,you__createa__fileobject__bycalling__the built-inopen__functionwith__anexternal__filename,and__perhapsmore__dependingon__your goals.For__example,to__createa__textoutput__file,pass__inits__nameand__the 'w'processing__modestring__towrite__text data;Python__automaticallymakes__thenewline__character \nportable__acrossplatforms__whenit__stransferred__toand__from files: >>>f__= open('data.txt', 'w') #Open__anew__filein__text-outputmode__>>> f.write('Hello\n') #Write__stringsof__charactersto__it 6 >>> f.write('world!\n') #Return__numberof__itemswritten__7 >>> f.close() #Close__toflush__outputbuffers__todisk__Thiscreates__afile__inthe__currentdirectory__andwrites__textto__it (thefilename__canbe__afull__directorypath__ifyou__needto__accessa__fileelsewhere__onyour__device).To__readback__whatyou__just wrote,reopen__thefile__in 'r'processing__mode,for__readingtext__inputthis__isalso__thedefault__ifyou__omitthe__modein__the call.Then__readthe__files__contentinto__astring__andaccess__it.A__files__contentis__alwaysa__stringin__your script,regardless__ofthe__typeof__datathe__file contains: >>>f__= open('data.txt') #Open__anexisting__filein__text-inputmode__>>>text__= f.read() #Read__entirefile__intoa__string >>>text__'Hello\nworld!\n' >>> print(text) #print__interpretscontrol__charactersHello__world! >>> text.split() #File__contentis__alwaysa__string ['Hello', 'world!']Other__fileobject__methodssupport__additionalfeatures__wedon__thave__timeto__cover here.For__instance,file__objectsprovide__moreways__ofreading__andwriting__(readaccepts__anoptional__maximum byte/character size,readline__readsone__lineat__a time,and__so on),as__wellas__othertools__(seekmoves__toa__newfile__position).As__youll__see later, though,the__bestway__toread__atext__fileis__usuallyto__notread__itat__allfiles__supportthe__iterationprotocol__withan__iteratorthat__automaticallyreads__lineby__linein__forloops__andother__contexts: >>>for__linein__open('data.txt'): #Display__linesin__afile__print(line.rstrip()) #Single__spaced (sans \n)You__llmeet__thefull__setof__filemethods__laterin__this book,but__ifyou__wanta__quickpreview__now,run__adir__callon__anyopen__fileand__ahelp__onany__ofthe__methodnames__thatcome__back,as__welearned__earlier.Unicode__andByte__FilesThe__priorsection__sexamples__illustratefile__basicsthat__sufficefor__many roles. Technically, though,they__relyon__theplatform__sUnicode__encodingdefault__forthe__host platform.Python__textfiles__alwaysuse__aUnicode__encodingto__encodestrings__onwrites__anddecode__themon__reads.This__isoften__irrelevantfor__simpleASCII__text data,which__usuallymaps__toand__fromfile__bytes unchanged.But__forricher__kindsof__data,file__interfacescan__varyby__content type.As__hintedwhen__westudied__Unicodestrings__earlier,Python__drawsa__sharpdistinction__betweentext__andbinary__datain__files:text__filesrepresent__contentas__normalstr__stringsand__performUnicode__encodingand__decodingautomatically__as noted,while__binaryfiles__representcontent__asthe__specialbytes__stringand__allowyou__toaccess__filecontent__unaltered.For__example,binary__filesare__usefulfor__processing media,accessing__datacreated__byC__programs,and__so on.What__yousend__andreceive__isthe__literalcontent__ofthe__file,whether__its__encodedtext__ora__JPEG image.Add__ab__tothe__modeto__invokebinary__(andexpect__a \r\ninstead__of \nat__theend__on Windows,because__itsnewlines__varyfrom__Unix): >>>bf__= open('data.bin', 'wb') >>> bf.write(b'h\xFFa\xEEc\xDDk\n') #Write__binarydata__ina__bytes 8 >>> bf.close() >>> open('data.bin', 'rb').read() #Read__binarydata__toa__bytes b'h\xffa\xeec\xddk\n'For__text files,we__cant__reallytalk__aboutcontent__withoutalso__asking,What__kind?files__mayuse__anyUnicode__encoding,especially__ifthey__camefrom__another platform,or__theinternet__at large.This__appliesto__portableprograms__too:if__youwant__yourcode__towork__across platforms,you__shouldgenerally__makeencodings__explicitto__avoidunpleasant__surprises. Luckily,this__iseasier__thanit__maysound__simplypass__inan__encodingname__toopen__toforce__an encoding: >>>tf__= open('unidata.txt', 'w', encoding='utf-8') >>> tf.write(' h\u00c4ck ') #Encodes__to UTF-8 6 >>> tf.close()If__youread__withthe__sameencoding__(orone__thats__compatible),you__getback__thesame__text-charactercode__pointsthat__you wrote.The__encodedbytes__onthe__fileare__in UTF-8 form,but__yourcode__usuallydoesn__tneed__to care: >>> open('unidata.txt', 'r', encoding='utf-8').read() #Decodes__from UTF-8 'h__ck ' >>> open('unidata.txt', 'rb').read() #Raw__encodedtext__b'\xf0\x9f\x90\x8dh\xc3\x84ck\xf0\x9f\x91\x8f'While__filesautomate__most encodings,you__canalso__encodeand__decodemanually__ifyour__programgets__Unicodedata__fromanother__sourceparsed__froman__emailmessage__orfetched__overa__network connection,for__example: >>> 'h ck'.encode('utf-8') b'h\xc3\x84ck' >>> b'h\xc3\x84ck'.decode('utf-8') 'h ck'Python__alsosupports__non-ASCIIfile__names (notjust__content),but__its__largely automatic.For__thewhole__storyon__Unicodein__Python,stay__tunedfor__Chapter 37.Other__File-LikeTools__Theopen__functionis__theworkhorse__formost__fileprocessing__youwill__doin__Python.For__moreadvanced__tasks, though,Python__comeswith__additional file-like tools: pipes, FIFOs, sockets, keyed-access files,persistent__object shelves, descriptor-based files,relational__and object-orienteddatabase__interfaces,and__more.We__wont__covermany__ofthese__topicsin__thislanguage__book,but__youll__findthem__usefulonce__youstart__programmingPython__in earnest.Other__ObjectTypes__Beyondthe__coreobject__typeswe__veseen__so far,there__areothers__thatget__lesspublicity__thantheir__cohortsbut__areuseful__intheir__intendedroles__nonetheless.Let__squickly__rundown__someof__thestragglers__inthis__category.Sets__Pythonsets__areneither__mappingsnor__sequences; rather,they__areunordered__collectionsof__immutable (technically,hashable__) objects,which__storeeach__objectjust__once.You__createsets__bycalling__the built-inset__functionwith__asequence__orother__iterable,or__byusing__aset__literal expression,and__setssupport__theusual__mathematicalset__operations: >>>X__= set('hack') #Sequence__=>set__>>>Y__= {'a', 'p', 'p'} #Set__literal >>> X,Y__({'c', 'k', 'a', 'h'}, {'p', 'a'}) >>>X__& Y,X__|Y__# Intersection,union__({'a'}, {'p', 'c', 'k', 'h', 'a'}) >>>X__- Y,X__>Y__# Difference,superset__({'c', 'k', 'h'}, False)Even__lessmathematically__inclinedprogrammers__oftenfind__setsuseful__forcommon__taskssuch__asfiltering__out duplicates,isolating__differences,and__performing order-neutralequality__testswithout__sorting: >>> list(set([3, 1, 2, 1, 3, 1])) #Duplicates__removal [1, 2, 3] >>> set('code') - set('hack') #Collection__difference {'d', 'o', 'e'} >>> set('code') == set('deoc') # Order-neutralequality__TrueAs__youll__seelater__inthis__partof__the book,normal__setsthemselves__aremutable__andcan__bechanged__(withtheir__removeand__add methods,for__example),though__theimmutable__itemswithin__themby__definition cannot.Booleans__andNone__Pythonalso__comeswith__Booleans,with__predefinedTrue__andFalse__objectsthat__areessentially__justthe__integers 1and__0with__customdisplay__logic;as__wellas__aspecial__placeholderobject__called None,commonly__usedto__initializenames__andobjects__anddesignate__anabsence__ofa__resultin__functions: >>> 1 > 2, 1 < 2 #Booleans__(False, True) >>> bool('hack') #All__objectshave__aBoolean__valueTrue__#Nonempty__meansTrue__>>>X__=None__#None__placeholder >>> print(X) #But__Noneis__athing__None >>>L__= [None] * 100 #Initialize__alist__of 100Nones__>>>L__[None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, etc:a__listof__100Nones__]Types__Onelast__coreobject__meritsa__callout here.The__type object,returned__bythe__type built-in function,is__anobject__thatgives__thetype__ofanother__object.We__usedit__earlierwhen__exploringthe__help function,but__heres__itsactual__result: >>>L__= [1, 2, 3] >>> type(L) #The__typeof__alist__object >>> type(type(L)) #Even__typesare__objects!Besides__allowingyou__toexplore__yourobjects__interactively,the__typeobject__inits__mostpractical__applicationallows__codeto__checkthe__typesof__theobjects__it processes.In__fact,there__areat__leastthree__waysto__doso__ina__Python script: >>> type(L) == type([]) #Type__testing,if__youmust__True #Using__areal__object >>> type(L) ==list__#Using__atype__nameTrue__>>> isinstance(L, list) #The__object-orientedway__TrueBut__nowthat__thisbook__hasshown__youall__theseways__todo__type testing,it__srequired__byPython__lawto__tellyou__thatdoing__sois__almostalways__thewrong__thingto__doin__aPython__program (andoften__asign__ofan__ex-Javaprogrammer__firststarting__touse__Python!).The__reasonwon__tbecome__completelyclear__untillater__inthe__bookwhen__westart__writinglarger__codeunits__like functions,but__its__aand__perhapsthe__corePython__concept.By__checkingfor__specifictypes__inyour__code,you__effectivelybreak__its flexibility:you__limitit__toworking__onjust__one type.Without__such checks,your__codemay__beable__towork__ona__wholerange__oftypes__automatically.This__ispart__ofthe__polymorphismmentioned__earlier,and__itstems__fromPython__slack__oftype__declarations.As__youll__learnmore__whenwe__stepup__tocoding__functionsand__classes,in__Python,we__codeto__objectinterfaces__(operations supported),not__to types.That__is,we__carewhat__anobject__does,not__whatit__is.Not__caringabout__specifictypes__meansthat__codecan__beapplied__tomany__of them:any__objectwith__acompatible__interfacewill__work,regardless__ofits__specific type.Although__typechecking__issupported__andeven__requiredin__somerare__casesyou__llsee__thatit__snot__usuallythe__Pythonicway__of thinking.In__fact,you__llprobably__findthat__polymorphismis__thekey__tousing__Python well.Type__HintingThat__being said,Python__hasslowly__accumulateda__type-declarationfacility__knownas__type hinting,based__originallyon__itsearlier__functionannotations__andinspired__bythe__TypeScriptdialect__of JavaScript.With__thesesyntax__andmodule__extensions,it__ispossible__toname__expectedobject__typesof__functionarguments__and results,attributes__in class-based objects,and__evensimple__variablesin__Python code,and__thesehints__maybe__usedby__externaltype__checkerslike__mypy: >>> x:int__= 1 #Optional__hint:x__mightbe__aninteger__>>>x__= 'anything' #But__it doesn'thave__to be! Importantly, though,Python__typehinting__ismeant__onlyfor__documentationand__useby__third-party tools.The__Pythonlanguage__doesnot__itselfmandate__oruse__typedeclarations__andhas__noplans__toever__do so. Hence,type__hintingby__mostmeasures__islargely__academic,no__moreuseful__than in-program comments,and__oddlycontrary__toPython__score__ideas.The__factthat__itwas__neverthelesselevated__tolanguage__syntaxand__complexsubdomain__arguablydoes__adisservice__toPython__learnersand__users alike.Especially__for beginners,this__isan__optionaland__peripheraltopic__thats__bestdeferred__untilyou__masterthe__flexibilityof__Pythons__dynamic typing.We__llstudy__itonly__brieflyin__this book,in__Chapter 6.To__be sure,type__hintingdoes__notmean__thatPython__isno__longerdynamically__typed. Indeed,a__staticallytyped__Pythonthat__requirestype__declarationswould__notbe__aPython__at all!Some__programmersaccustomed__torestrictive__languagesmay__regrettablycode__Pythontype__hintsanyhow__asa__hard-to-breakhabit__(ormisguided__displayof__prowess),but__goodprogrammers__focusinstead__onPython__s polymorphism.As__youll__find,it__show__tocode__Pythonin__Python. User-DefinedObjects__Wewon__tstudy__object-orientedprogramming__(OOP)in__Pythonand__itsclass__statementuntil__laterin__this book.In__abstract terms, though,classes__definenew__typesof__objectsthat__extendthe__core set,so__theymerit__apassing__glance here. Suppose,for__example,that__youwish__tohave__akind__ofobject__thatmodels__workersin__a company.Although__thereis__nosuch__specificcore__objecttype__inPython__(its__notan__HR language,after__all),a__user-definedclass__mightfit__the bill: >>>class__Worker:stay__tunedfor__PartVI__Mostof__thiscode__isomitted__becauseit__wouldnt__makemuch__senseat__thispoint__inthe__book,but__sucha__classmight__defineattributes__ofworkers__likename__and pay,as__wellas__behaviorcoded__ascustom__methods.Calling__theclass__wouldgenerate__objectsthat__areinstances__ofour__new type,and__theclass__smethods__wouldprocess__them: >>>sue__= Worker('Sue Jones', 60000) #Make__twonew__objects >>>bob__= Worker('Bob Smith', 50000) #Each__hasa__nameand__pay >>> sue.lastName() #Call__amethod__toprocess__sue 'Jones' >>> bob.lastName() #Call__amethod__toprocess__bob 'Smith' >>> sue.giveRaise(.10) #Update__sue'spay__>>> sue.pay #Display__sue'spay__66000.0This__iscalled__object-oriented,because__thereis__alwaysan__impliedsubject__infunctions__withina__class. Class-basedobjects__ultimatelyuse__built-inobjects__internally,and__wecan__alwaysdescribe__thingslike__workerswith__Pythons__built-inobjects__instead,as__wedid__withdictionaries__andlists__earlier. Classes, though,implement__operationswith__meaningful names,add__structureto__your code,and__comewith__inheritancemechanisms__thatlend__themselvesto__customizationby__extension.In__OOP,we__striveto__extendsoftware__bywriting__new classes,not__bychanging__whatalready__works.All__ofwhich__iswell__beyondthe__boundsof__thisobject__preview, though,so__wemust__stopshort__here.For__fulldisclosure__on user-definedobject__typescoded__with classes,you__llhave__toread__on.Because__classesbuild__uponother__toolsin__Python,they__areone__ofthe__majordestinations__ofthis__books__journey.And__EverythingElse__Asmentioned__earlier,everything__youcan__processin__aPython__scriptis__atype__of object,so__our object-typetour__isnecessarily__incomplete. However,even__thougheverything__inPython__isan__object,not__everythingis__considereda__partof__Pythons__core toolset.Other__objecttypes__inPython__eitherare__relatedto__programexecution__(like functions, modules, classes,and__compiled code),or__areimplemented__byimported__module functions,not__language syntax.The__latterof__thesealso__tendto__have application-specificroles__text patterns,database__interfaces,network__connections,and__so on. Moreover,keep__inmind__thatthe__objectswe__vemet__hereare__objects,but__notnecessarily__object-orienteda__conceptthat__usuallyrequires__thePython__class statement,which__youll__meetagain__laterin__this book. Still,Python__score__objectsare__theworkhorses__ofall__Pythonscripts__youre__likelyto__meetand__areoften__thebasis__oflarger__noncore objects.Chapter__SummaryAnd__thats__awrap__forour__object tour.This__chapterhas__previewedPython__score__objecttypes__andthe__sortsof__operationswe__canapply__to them.We__vestudied__genericoperations__thatwork__onmany__objecttypes__(sequenceoperations__suchas__indexingand__slicing,for__example),as__wellas__type-specificoperations__availableas__methodcalls__(stringsplits__andlist__appends,for__instance).We__vealso__definedsome__key terms,such__as immutability, sequences,and__polymorphism.Along__the way,we__velearned__thatPython__score__objecttypes__aremore__flexibleand__powerfulthan__whatis__availablein__lower-level languages.For__instance,Python__slists__anddictionaries__can nest,grow__and shrink,and__containobjects__ofany__type,and__theirspace__isautomatically__createdand__cleanedup__asyou__go.We__vealso__glimpsedthe__waysthat__stringsand__fileswork__handin__handto__supportbinary__andtext__data,peeked__atthe__iterationprotocol__and OOP,discussed__theperils__oftype__hinting,and__introducedthe__ifand__forstatements__well__beusing__ahead.This__chapterskipped__manyof__thedetails__inorder__toprovide__afirst__tour,so__youshouldn__texpect__allof__thischapter__tohave__madesense__yet.In__thenext__few chapters,we__llstart__todig__deeper,taking__asecond__passover__Pythons__objecttypes__thatwill__fillin__detailsomitted__hereand__giveyou__adeeper__understanding.We__llstart__offthe__nextchapter__withan__in-depthlook__atPython__numbers. First, though,here__isanother__quizto__review.Test__Your Knowledge:Quiz__Well__explorethe__conceptsintroduced__inthis__chapterin__moredetail__inupcoming__chapters,so__well__justcover__thebig__ideas here: 1.Name__fourof__Pythons__coreobject__types. 2.Why__arethey__calledcore__object types? 3.What__doesimmutable__mean,and__whichthree__ofPython__sobject__typesare__considered immutable? 4.What__doessequence__mean,which__objectsfall__intothis__category,and__howis__iterable related? 5.What__doesmapping__mean,and__whichcore__objecttype__isa__mapping? 6.What__is polymorphism,and__whyshould__you care?Test__Your Knowledge:Answers__1. Numbers, strings, lists, dictionaries, tuples, files,and__setsare__generallyconsidered__tobe__thecore__object types. Booleans, None,and__typesthemselves__areclassified__thisway__as well.Some__ofthese__typesare__really categories:there__aremultiple__numbertypes__(integer,floating__point, complex, fraction,and__decimal)and__multiplestring__types (text strings,byte__strings,and__mutablebyte__strings). 2.They__areknown__ascore__objecttypes__becausethey__arepart__ofthe__Pythonlanguage__itselfand__arealways__available.To__createother__objects,you__generallymust__callfunctions__inimported__modules.Most__ofthe__coreobjects__havespecific__syntaxfor__generatingtheir__objects: 'hack',for__example,is__anexpression__thatmakes__astring__anddetermines__theset__ofoperations__thatcan__beapplied__to it.Because__of this,core__objectsare__hardwiredinto__Pythons__syntax.In__contrast,you__mustcall__the built-inopen__functionto__createa__file object,even__thoughthis__isusually__considereda__coreobject__type too. 3.An__immutableobject__isan__objectthat__cannotbe__changedafter__itis__created. Numbers, strings,and__tuplesin__Pythonfall__intothis__category.While__youcannot__changean__immutableobject__in place,you__canalways__makea__newone__byrunning__an expression.bytearrays__offermutability__for strings,but__theyonly__applydirectly__totext__ifit__sa__simple 8-bitkind__(e.g., ASCII). 4.A__sequenceis__apositionally__orderedcollection__of objects. Strings, lists,and__tuplesare__allsequences__in Python.They__sharecommon__sequence operations,such__as indexing, concatenation,and__slicing,but__alsohave__type-specificmethod__calls.The__relatedterm__iterablemeans__eithera__physical sequence,or__avirtual__onethat__producesits__itemson__request.Sequences__are iterable,but__soare__generators, files,results__offunctions__like range,and__thedictionary__object (whichproduces__itskeys__when iterated,just__likeits__keys method). 5.The__termmapping__denotesan__objectthat__mapskeys__toassociated__values.Python__sdictionary__isthe__onlymapping__amongits__coreobject__types.Mappings__retaininsertion__order (asof__Python 3.7),and__supportaccess__todata__storedby__key,plus__type-specificmethod__callsthat__enablekey__tests, iteration,and__more. 6.Polymorphism__meansthat__themeaning__ofan__operation (likea__+)depends__onthe__objectsbeing__operated on.This__turnsout__tobe__akey__idea (andperhaps__the largest)behind__usingPython__wellnot__constrainingcode__tospecific__typesmakes__thatcode__automaticallyapplicable__tomany__types.This__becomesmore__obviouswhen__codingfunctions__andclasses__in Python.While__Pythontoday__hastype__hinting,it__snot__usedby__Pythonitself__andis__meantonly__fordocumentation__and tools.Chapter__5.Numbers__andExpressions__Thischapter__beginsour__in-depthtour__ofthe__Python language.In__Python,data__takesthe__formof__objectseither__built-inobjects__thatPython__providesor__objectswe__createusing__Pythontools__andother__languageslike__C.In__fact,objects__arethe__basisof__everyPython__programyou__willever__write.Because__theyare__themost__fundamentalnotion__inPython__programming,objects__arealso__ourfirst__focusin__this book.In__thepreceding__chapter,we__tooka__quickfirst__passover__Pythons__coreobject__types.Although__essentialterms__wereintroduced__inthat__chapter,we__avoidedcovering__toomany__specificsin__theinterest__of space. Here,we__llbegin__amore__carefulsecond__lookat__object concepts,to__fillin__detailswe__glossedover__earlier.Let__sget__startedby__exploringour__first category:Python__snumeric__objectsand__operations.Numeric__ObjectBasics__Mostof__Pythons__numericsupport__isfairly__typicaland__willprobably__seemfamiliar__ifyou__veused__almostany__otherprogramming__languagein__the past.They__canbe__usedto__keeptrack__ofyour__bank balance,the__distanceto__Mars,the__numberof__visitorsto__your website,and__justabout__anyother__numeric quantity.In__Python,numbers__arenot__reallya__singleobject__type,but__acategory__ofsimilar__types.Python__supportsthe__usualnumeric__types (integersand__floating points),as__wellas__literalsfor__creatingnumbers__andexpressions__forprocessing__them.In__addition,Python__providesmore__advancednumeric__programmingsupport__andobjects__formore__advanced needs.A__fairlycomplete__inventoryof__Pythons__numerictoolbox__includes:Integer__and floating-pointobjects__Complexnumber__objectsDecimal__fixed-precisionobjects__Fractionrational__numberobjects__Setobjects__andoperations__Booleanand__bitwiseoperations__Built-in modules,such__as math, cmath, random,and__statistics Third-party add-ons,including__vectors, visualization, plotting,and__extendedprecision__Becausethe__objecttypes__inthis__lists__firstbullet__itemtend__tosee__themost__actionin__Python code,this__chapterstarts__withbasic__numbersand__fundamentals,then__moveson__toexplore__othertypes__onthis__list,which__servespecialized__roles.We__llalso__studysets__here,which__haveboth__numericand__collection qualities,but__aregenerally__consideredmore__theformer__thanthe__latter.Before__wejump__into code, though,the__nextfew__sectionsget__usstarted__witha__briefoverview__ofhow__wewrite__andprocess__numbersin__our scripts.Numeric__LiteralsAmong__itsbasic__object types,Python__provides integers,which__arepositive__andnegative__whole numbers,and__floating-point numbers,which__arenumbers__witha__fractionalpart__(sometimescalled__floatsfor__verbal economy).Python__alsoallows__usto__writeintegers__using hexadecimal, octal,and__binary literals;offers__acomplex__number type;and__allowsintegers__tohave__unlimitedprecision__theycan__growto__haveas__manydigits__asyour__memoryspace__allows.Table__5-1shows__whatPython__snumeric__typeslook__likewhen__writtenout__ina__programas__literalsor__constructor-function calls.Table__5-1.Numeric__literalsand__constructorsLiteral__Interpretation 1234, 24, 0, 9_999_999_999_999Integers__(unlimited size) 1.23, 1., 3.14e-10, 4E210, 4.0e+210 Floating-pointnumbers__0o177, 0x9ff, 0b101010 Octal, hex,and__binaryliterals__3+4j, 3.0+4.0j, 3JComplex__numberliterals__set('hack'), {1, 2, 3, 4} Sets:constructors__andliterals__Decimal('1.0'), Fraction(1, 3)Decimal__andfraction__extensiontypes__bool(X), True,False__Booleantype__andconstants__In general,Python__snumeric__typeliterals__arestraightforward__to write,but__afew__codingconcepts__areworth__highlightingup__front:Integer__and floating-pointliterals__Integersare__writtenas__stringsof__decimal digits.As__noted,they__haveprecision__(numberof__digits)limited__onlyby__yourdevice__savailable__memory.You__caneasily__compute 2raised__tothe__power 1,000,000,though__with 300K digits,it__maytake__sometime__toprint__(andcan__tbe__convertedto__aprint__stringtoday__by default,per__Chapter 4). Floating-pointnumbers__havea__decimalpoint__and/oran__optionalsigned__exponentintroduced__byan__eor__Eand__followedby__anoptional__sign.If__youwrite__anumber__witha__decimalpoint__or exponent,Python__makesit__a floating-point__objectand__uses floating-point (not integer)math__whenthe__objectis__usedin__an expression.As__youll__learn,mixing__a floating-pointnumber__withan__integerdoes__floating-pointmath__too,after__convertingthe__integer up. Hexadecimal, octal,and__binaryliterals__Integersmay__becoded__indecimal__(base 10),hexadecimal__(base 16),octal__(base 8),or__binary (base 2),the__lastthree__ofwhich__arecommon__insome__programming domains.Hexadecimals__startwith__aleading__0xor__0X,followed__bya__stringof__hexadecimaldigits__(0 9and__A F).Hex__digitsmay__becoded__inlowercase__or uppercase.Octal__literalsstart__witha__leading 0oor__0O (zeroand__lowercaseor__uppercaseletter__o),followed__bya__stringof__octaldigits__(0 7).Binary__literalsbegin__witha__leading 0bor__0B,followed__bybinary__digits (0 1).All__ofthese__literalsproduce__integerobjects__inprogram__code;they__arejust__alternativesyntaxes__forspecifying__values.The__built-incalls__hex(I), oct(I),and__bin(I)convert__aninteger__toits__representationstring__inthese__three bases,and__int(str, base)converts__aruntime__stringto__aninteger__pera__given base.Complex__numbersThough__usedmore__rarely,Python__complexliterals__arewritten__as realpart+imaginarypart,where__theimaginarypart__isterminated__witha__jor__J.The__realpartis__technically optional,so__theimaginarypart__mayappear__onits__own. Internally,complex__numbersare__implementedas__pairsof__floating-point numbers,but__allnumeric__operationsperform__complexmath__whenapplied__tocomplex__numbers.Complex__numbersmay__alsobe__createdwith__the complex(real, imag) built-in call.Coding__othernumeric__typesAs__youll__seelater__inthis__chapter,there__areadditional__numerictypes__nearthe__endof__Table 5-1that__servemore__advancedor__specialized roles.You__createsome__ofthese__bycalling__functionsin__importedmodules__(e.g.,decimals__and fractions),others__haveliteral__syntaxall__theirown__(e.g., sets),and__Booleansare__akind__ofspecialized__integer. Built-inNumeric__ToolsBesides__the built-innumber__literalsand__constructioncalls__shownin__Table 5-1,Python__providesa__setof__toolsfor__processingnumber__objects:Expression__operators +, -, *, /, >>, **, &, %, etc. Built-inmathematical__functions pow, abs, round, int, hex, bin, etc.Utility__modules random, math, statistics, etc.You__llmeet__allof__theseas__wego__along.Although__numbersare__primarilyprocessed__with expressions, built-ins,and__modules,they__alsohave__ahandful__of type-specificmethods__today,which__youll__meetin__this chapter. Floating-point numbers,for__example,have__anas_integer_ratio__methoduseful__forthe__fractionnumber__type,and__anis_integer__methodto__testif__thenumber__isan__integer.Integer__attributesinclude__abit_length__methodthat__givesthe__numberof__bitsnecessary__torepresent__theobject__s value,and__aspart__collectionand__part number,sets__supportboth__expressionsand__methods too.Since__expressionsare__themost__essentialtool__formost__number types, though,let__sturn__tothem__next.Python__ExpressionOperators__Themost__fundamentaltool__thatprocesses__numbersis__the expression:a__combinationof__numbers (orother__objects)and__operatorsthat__computesa__valuewhen__executedby__Python.In__Python,you__writeexpressions__usingthe__usualmathematical__notationand__operator symbols.For__instance,to__addtwo__numbersX__andY__youwould__sayX__+ Y,which__tellsPython__toapply__the +operator__tothe__valuesnamed__byX__and Y.The__resultof__theexpression__isthe__sumof__Xand__Y,another__number object.Table__5-2lists__allthe__operatorexpressions__availablein__Python, abstractly.Many__are self-explanatory;for__instance,the__usualmathematical__operators (+, , *, /,and__so on)are__supported.A__fewwill__befamiliar__ifyou__veused__otherlanguages__inthe__past: %computes__adivision__remainder, <<performs__abitwise__left-shift, &computes__abitwise__AND result,and__so on.Others__aremore__Python specific,and__notall__arenumeric__in nature:for__example,the__isoperator__testsobject__identity (i.e.,same__addressin__memory,a__strictform__of equality),and__lambdacreates__unnamed functions.Table__5-2.Python__expression operators,by__increasingprecedence__(binding)Operators__Descriptionyield__x,yield__fromx__Generatorfunction__sendprotocol__x :=y__Assignmentexpression__lambda args:expression__Anonymousfunction__generationx__ify__elsez__Ternaryselection__(xis__evaluatedonly__ify__is true)x__ory__LogicalOR__(yis__evaluatedonly__ifx__is false)x__andy__LogicalAND__(yis__evaluatedonly__ifx__is true)not__xLogical__negationx__in y,x__notin__yx__is y,x__isnot__yx__< y,x__<= y,x__> y,x__>=y__x == y,x__!=y__Membership (iterables)Object__identitytests__Magnitude comparison,set__subsetand__supersetValue__equalityoperators__x |y__Bitwise OR,set__union,dictionary__mergex__^y__Bitwise XOR,set__symmetricdifference__x &y__Bitwise AND,set__intersectionx__<< y,x__>>y__Shiftx__leftor__rightby__ybits__x +y__xy__Addition,concatenation__Subtraction,set__differencex__*y__x %y__Multiplication,repetition__Remainder,format__x / y,x__//y__x @y__Division:true__andfloor__Matrixmultiplication__(unusedby__Python) x, +x,x__Negation,identity__BitwiseNOT__(inversion)x__**y__Power (exponentiation)await__xAwait__expression (async functions) x[i] x[i:j:k] x(...) x.attrIndexing__(sequence, mapping, others)Slicing__Call (function, method, class,other__callable)Attribute__reference (...) [...] {...} Tuple, expression,generator__expression List,list__comprehension Dictionary, set,dictionary__andset__comprehensionsWhile__Table 5-2works__asa__reference,some__ofits__operatorswon__tmake__senseuntil__youve__seenthem__in action,and__someare__moresubtle__thanthe__tablemay__imply.For__instance:Parentheses__arerequired__foryield__ifit__snot__aloneon__theright__sideof__anassignment__statement,as__wellas__the := named-assignmentoperator__ifit__sused__insome__contexts.Comparison__operatorscompare__allparts__ofcollections__automaticallyand__maybe__chainedas__ashorthand__andpotential__optimization (e.g.,X__<Y__<Z__producesthe__sameresult__asX__<Y__andY__< Z).Python__definesan__@operator__meantfor__matrixmultiplication__butdoes__notprovide__animplementation__for it;unless__youcode__onein__aclass__oruse__alibrary__that does,this__operatordoes__nothing.The__parenthesesused__for tuples, expressions,and__generatorsmay__sometimesbe__omitted;when__omittedfor__tuples,the__commaseparating__itsitems__actslike__a lowest-precedenceoperator__ifnot__otherwise significant.Some__operators,like__yield, lambda,and__await,have__todo__withlarger__topicsthat__havelittle__todo__withnumbers__andcan__safelybe__ignoredat__thisearly__pointin__yourPython__career.This__bookwill__deferto__Pythons__manualsfor__other minutiae,but__youll__seemost__ofthe__operatorsin__Table 5-2in__action later. First, though,we__needto__takea__quicklook__atthe__waysthese__operatorsmay__becombined__in expressions.NOTE__Meetthe__Python no-ops:The__@character__isused__byPython__tointroduce__functiondecorators__(coveredlater__inthis__book),but__notas__anexpression__operatordespite__itsbeing__specifiedas__such.In__thelatter__role, @joins__Ellipsis (...)and__typehinting__astools__definedbut__whollyunused__byPython__itself.As__ifyou__didnt__haveenough__tolearn__withthe__real stuff!Mixed__Operators:Precedence__Asin__most languages,in__Python,you__codemore__complexexpressions__bystringing__togetherthe__operatorexpressions__inTable__5-2.For__instance,the__sumof__twomultiplications__mightbe__writtenas__amix__ofvariables__and operators:A__*B__+C__*D__Whichraises__the question:how__doesPython__knowwhich__operationto__perform first?The__answerto__thisquestion__liesin__operator precedence.When__youwrite__anexpression__withmore__thanone__operator,Python__groupsits__partsaccording__towhat__arecalled__precedence rules,and__thisgrouping__determinesthe__orderin__whichthe__expressions__partsare__computed.To__denote this,Table__5-2is__orderedby__operator precedence:Operators__lowerin__thetable__havehigher__precedence,and__sobind__moretightly__inmixed__expressions.Put__another way,operators__higherin__thetable__havelower__precedenceand__bindless__tightlythan__thosebelow__them.Operators__inthe__samerow__inthe__tablegenerally__groupfrom__leftto__rightwhen__combined (exceptfor__exponentiation,which__groupsright__to left,and__comparisons,which__chainleft__to right). So,for__example,if__youwrite__X +Y__* Z,Python__evaluatesthe__multiplicationfirst__(Y * Z)then__addsthat__resultto__X,because__*has__higherprecedence__(islower__inthe__table)than__+. Similarly,in__thissection__soriginal__example,both__multiplications (A *B__andC__* D)will__happenbefore__theirresults__areadded__because +is__above *.Parentheses__GroupSubexpressions__Youcan__largelyforget__aboutprecedence__rulesif__youre__carefulto__groupparts__ofexpressions__with parentheses.When__youenclose__subexpressionsin__parentheses,you__overridePython__sprecedence__rules;Python__alwaysevaluates__expressionsin__parenthesesfirst__beforeusing__theirresults__inthe__enclosing expressions.For__instance,instead__ofcoding__X +Y__* Z,you__couldwrite__oneof__thefollowing__toforce__Pythonto__evaluatethe__expressionin__eitherdesired__order: (X + Y) *Z__X + (Y * Z)In__thefirst__case, +is__appliedto__Xand__Y first,because__thissubexpression__iswrapped__in parentheses.In__thesecond__case,the__*is__performedfirst__(justas__ifthere__wereno__parenthesesat__all).Generally__speaking,adding__parenthesesin__largeexpressions__isa__goodidea__itnot__onlyforces__theevaluation__orderyou__want,but__alsoaids__readability.Mixed__TypesAre__ConvertedUp__Besidesmixing__operatorsin__expressions,you__canalso__mixnumeric__types.For__instance,you__canadd__aninteger__toa__floating-point number: 40 + 3.14But__thisleads__toanother__question:what__typeis__theresult__integeror__floating point?The__answeris__simple,especially__ifyou__veused__almostany__otherlanguage__before:in__mixed-typenumeric__expressions,operands__(theparts__ofthe__expressionthat__arent__operators)are__firstconverted__upto__thetype__ofthe__mostcomplicated__operand,and__thenthe__mathis__performedon__same-type operands.The__resultis__thatof__the up-converted operands.For__this,Python__ranksthe__complexityof__numerictypes__like so:integers__aresimpler__than floating-point numbers,which__aresimpler__thancomplex__numbers. So,when__aninteger__ismixed__witha__floating point,as__inthe__preceding example,the__integeris__convertedup__toa__floating-pointvalue__first,and__floating-pointmath__yieldsthe__floating-point result.See__foryourself__inyour__localPython__REPL: >>> 40 + 3.14 #Integer__to float,float__math/result 43.14 Similarly,any__mixed-typeexpression__whereone__operandis__acomplex__numberresults__inthe__otheroperand__beingconverted__upto__acomplex__number,and__theexpression__yieldsa__complex result.Conversions__alsorun__inequality__andmagnitude__comparisons: 3 == 3.0is__true,but__3 > 3.0is__not.You__canforce__theissue__bycalling__built-infunctions__toconvert__types manually: >>> int(3.1415) #Truncates__floatto__integer 3 >>> float(3) #Converts__integerto__float 3.0 However,you__wont__usuallyneed__todo__this:because__Pythonautomatically__convertsup__tothe__morecomplex__typewithin__an expression,the__resultsare__normallywhat__you want.While__automaticconversions__arerun__forboth__numericand__comparison operators,keep__inmind__thatthey__applyonly__whenmixing__numericobjects__(e.g.,an__integerand__a float)in__an expression.In__general,Python__doesnot__convertacross__anyother__typeboundaries__automatically.Adding__astring__ofdigits__toan__integer,for__example,results__inan__error,unless__youmanually__convertone__orthe__other;watch__foran__exampleand__rationalewhen__weexplore__stringsin__Chapter 7.Equality__testsdo__workon__mixedtypes__(e.g.,a__stringis__neverequal__toany__integer),but__magnitudecomparisons__do not. Preview:Operator__Overloadingand__PolymorphismAlthough__were__focusingon__built-innumbers__right now,all__Pythonoperators__maybe__overloaded (i.e., implemented)by__Pythonclasses__andC__extensiontypes__towork__onobjects__you create.For__instance,you__llsee__laterthat__objectscoded__withclasses__maybe__addedor__concatenatedwith__x+y expressions,indexed__with x[i] expressions,and__so on. Furthermore,Python__itselfautomatically__overloadssome__operators,such__thatthey__performdifferent__actionsdepending__onthe__typeof__built-inobjects__being processed.For__example,the__+operator__performsaddition__whenapplied__tonumbers__butperforms__concatenationwhen__appliedto__sequenceobjects__likestrings__and lists.In__fact, +can__meananything__atall__whenapplied__toobjects__youdefine__with classes.As__wesaw__inthe__prior chapter,this__propertyis__usuallycalled__polymorphisma__termindicating__thatthe__meaningof__anoperation__dependson__thetype__ofthe__objectsbeing__processed.We__llrevisit__thisconcept__whenwe__explorefunctions__inChapter__16,because__itbecomes__amuch__moreobvious__featurein__that context.Numbers__inAction__Onto__the code!Probably__thebest__wayto__understandnumeric__objectsand__expressionsis__tosee__themin__action,so__withall__thepreceding__basicsin__hand,let__sstart__upthe__interactivecommand__lineand__trysome__simplebut__illustrativeoperations__(besure__tosee__Chapter 3for__pointersif__youneed__helpstarting__a REPL).Variables__andBasic__ExpressionsFirst__of all,let__sdo__themath__todemo__some basics.In__thefollowing__interaction,we__firstassign__twovariables__(aand__b)to__integersso__wecan__usethem__laterin__alarger__expression.Variables__aresimply__namescreated__byyou__orPython__thatare__usedto__keeptrack__ofinformation__inyour__program.We__llsay__moreabout__thisin__thenext__chapter,but__in Python:Variables__arecreated__whenthey__arefirst__assigned values.Variables__arereplaced__withtheir__valueswhen__usedin__expressions.Variables__mustbe__assignedbefore__theycan__beused__in expressions.Variables__referto__objectsand__neednot__bedeclared__aheadof__time.In__other words,these__assignmentscause__thevariables__aand__bto__springinto__existence automatically: $ python3 #Fire__upa__REPL >>>a__= 3 #Name__created:no__needto__declareahead__oftime__>>>b__= 4This__codealso__uses comments.Recall__fromChapter__3that__inPython__code,text__aftera__#mark__andcontinuing__tothe__endof__theline__isconsidered__tobe__acomment__andis__ignoredby__Python.Comments__areone__wayto__write human-readable__documentationfor__your code,and__animportant__partof__programming.They__describeaspects__ofthe__code,salient__or subtle,as__anaid__forothers__(and you,six__monthsdown__the road!).In__thenext__partof__the book,you__llalso__meeta__relatedfeature__documentationstrings__thatattaches__docsto__objectsso__its__availableafter__yourcode__is loaded. Again, though,because__codeyou__typeinteractively__is temporary,you__wont__normallywrite__commentsin__this context.If__youre__working along,this__meansyou__dont__needto__typeany__ofthe__commenttext__fromthe__#through__tothe__endof__theline__ina__REPL;it__snot__arequired__partof__thestatements__were__runningthis__way. Now,let__suse__ournew__integerobjects__in expressions.At__this point,the__valuesof__aand__bare__still 3and__4, respectively.Variables__likethese__arereplaced__withtheir__valueswhenever__theyre__usedinside__an expression,and__theexpression__resultsare__echoedback__immediatelyand__automaticallywhen__were__working interactively: >>>a__+ 1,a__1 #Addition__(3 + 1),subtraction__(3 1) (4, 2) >>>b__* 3,b__/ 2 #Multiplication__(4 * 3),division__(4 / 2) (12, 2.0) >>>a__% 2,b__** 2 #Modulus__(remainder),power__(4 ** 2) (1, 16) >>> 2 + 4.0, 2.0 **b__# Mixed-typeconversions__(6.0, 16.0)Per__Chapter 3,the__resultsbeing__echoedback__hereare__tuplesof__twovalues__becausethe__linestyped__atthe__promptcontain__twoexpressions__separatedby__commas;that__swhy__theresults__aredisplayed__in parentheses.More__importantly,these__expressionswork__becausethe__variablesa__andb__withinthem__havebeen__assigned values.If__youuse__adifferent__variablethat__hasnot__yetbeen__assigned,Python__reportsan__errorrather__thanfilling__insome__default value: >>>c__* 2 NameError:name__'c'is__notdefined__Asalso__previewedin__Chapter 3,you__dont__needto__predeclarevariables__in Python,but__theymust__havebeen__assignedat__leastonce__beforeyou__canuse__them.In__practice,this__meansyou__haveto__initializecounters__tozero__beforeyou__canadd__to them,initialize__liststo__anempty__listbefore__youcan__appendto__them,and__so on.Here__aretwo__slightlylarger__expressionsto__illustrateoperator__groupingand__moreabout__conversions: >>>b__/ 2 +a__#Same__as ((4 / 2) + 3) 5.0 >>>b__/ (2 + a) #Same__as (4 / (2 + 3)) 0.8In__thefirst__expression,there__areno__parentheses,so__Pythonautomatically__groupsthe__componentsaccording__toits__precedencerules__because /is__lowerin__Table 5-2than__+,it__bindsmore__tightlyand__sois__evaluated first.The__resultis__asif__theexpression__hadbeen__organizedwith__parenthesesas__shownin__thecomment__tothe__rightof__the code.In__thesecond__expression,parentheses__areadded__aroundthe__+part__toforce__Pythonto__evaluateit__first (i.e.,before__the /). Also,notice__thatall__thenumbers__areintegers__ineach__ofthese__examples.Python__s /performs__true division,which__alwaysretains__fractionalremainders__andgives__a floating-pointresult__whichis__inturn__reflectedin__theresult__ofthe__whole expression.You__canforce__afractional__resultby__coding 2.0instead__of 2but__dont__have to.You__canalso__optto__usefloor__divisionby__codingthese__exampleswith__//instead__of /,and__Pythonwill__discarddecimal__digitsin__the result;because__resultsreflect__thetypes__of operands,you__llget__backtruncated__floating-pointfor__floats: >>> a,b__# Same,original__values (3, 4) >>>b__// 2 +a__#Floor__division:integer__5 >>>b__// (2 + a) #Truncates__fraction (for positives) 0 >>>b__// 2.0 +a__# Auto-conversions: floating-point 5.0 >>>b__// (2.0 + a) 0.0You__lllearn__moreabout__divisionlater__inthis__section.Numeric__DisplayFormats__Onceyou__startplaying__withPython__numbersin__earnest,the__resultsof__someexpressions__maylook__abit__oddthe__firsttime__yousee__them: >>> 1.1 + 2.2 # What'sup__withthe__3at__the end? 3.3000000000000003 >>> print(1.1 + 2.2) #Same__forprints__3.3000000000000003The__fullstory__behindthis__oddresult__hasto__dowith__thelimitations__of floating-point__hardwareand__itsinability__toexactly__representsome__valuesin__alimited__numberof__bits.Python__floating-pointnumbers__mapto__theunderling__chipson__yourdevice__andare__onlyas__accurateas__thosechips__allowa__physicalconstraint__thatcan__beaddressed__with add-onsthat__extend floating-point precision,as__wellas__techniquesdiscussed__in Floating-pointequality__.Because__computerarchitecture__iswell__beyondthis__books__scope, though,we__llfinesse__thisby__sayingthat__yourcomputer__s floating-pointhardware__isdoing__thebest__it can,and__neitherit__norPython__isin__error here.In__fact,this__ispartly__adisplay__issuePython__s floating-pointdisplay__logictries__tobe__intelligentand__usuallyshows__fewerdecimal__digits,but__occasionally cannot.Our__earlierexamples__gavefewer__digits automatically,and__youcan__alwaysforce__theissue__inprograms__withstring__formatting: >>>num__= 1.1 + 2.2 >>>num__# Auto-echoes (and prints) 3.3000000000000003 >>> '%e' %num__# String-formattingexpression__'3.300000e+00' >>> '%.1f' %num__#Alternative__floating-pointformat__'3.3' >>> f'{num:e}', f'{num:.1f}' # F-strings (seealso__format method) ('3.300000e+00', '3.3')The__lastthree__testshere__employflexible__string formatting,which__wewill__explorein__fullin__theupcoming__chapteron__strings (Chapter 7).Its__resultsare__stringsthat__are typically,but__not always,printed__todisplays__or reports.DISPLAY__FORMATS:STR__ANDREPR__Althoughit__snot__yetobvious__inthis__chapter,the__defaultoutput__formatof__interactiveechoes__andprint__technicallycorrespond__tothe__built-inrepr__andstr__functions, respectively: >>> repr('hack') #Used__by echoes: as-codeform__"'hack'" >>> str('hack') #Used__by print: user-friendlyform__'hack'Both__ofthese__convertarbitrary__objectsto__theirstring__representations:repr__(andthe__defaultinteractive__echo)produces__resultsthat__lookas__thoughthey__were code;str__(andthe__print operation)converts__toa__typicallymore__user-friendly__formatif__available.Some__objectshave__botha__strfor__general use,and__arepr__withextra__details.This__notionwill__resurfacewhen__weexplore__bothstrings__andoperator__overloadingin__classes.Besides__providingprint__stringsfor__arbitrary objects,the__str built-inis__alsothe__nameof__thestring__object type,which__canbe__calledwith__anencoding__nameto__decodea__Unicodestring__froma__bytestring__asan__alternativeto__the bytes.decodemethod__introducedbriefly__inChapter__4.You__lllearn__moreabout__thisadvanced__strrole__inChapter__37.Comparison__OperatorsSo__far,we__vebeen__dealingwith__standardnumeric__operations (e.g.,addition__and multiplication),but__numbers,like__allPython__objects,can__alsobe__compared.Normal__comparisonswork__fornumbers__exactlyas__youd__expectthey__comparethe__relativemagnitudes__oftheir__operandsand__returna__Boolean result,which__wewould__normallytest__andtake__actionon__ina__largerstatement__andprogram__(e.g.,see__theintro__toif__inChapter__4): >>> 1 < 2 #Less__than (magnitude)True__>>> 2.0 >= 1 #Greater__thanor__equal: mixed-type 1converted__to 1.0True__>>> 2.0 == 2.0 #Equal__valueTrue__>>> 2.0 != 2.0 #Not__equalvalue__FalseNotice__againhow__mixedtypes__areallowed__innumeric__expressions (only);in__thesecond__test here,Python__comparesvalues__interms__ofthe__morecomplex__type, float.Chained__comparisons Interestingly,Python__alsoallows__usto__chainmultiple__comparisonstogether__toperform__range tests.Chained__comparisonsare__asort__ofshorthand__forlarger__Boolean expressions.In__short,Python__letsus__stringtogether__magnitudecomparison__teststo__codechained__comparisonssuch__asrange__tests.The__expression (A <B__< C),for__instance,tests__whetherB__isbetween__Aand__C, noninclusively;it__isequivalent__tothe__Booleantest__(A <B__andB__< C)but__iseasier__onthe__eyes (andthe__keyboard).For__example,assume__thefollowing__assignments: >>>X__= 2 >>>Y__= 4 >>>Z__= 6The__followingtwo__expressionshave__identical effects,but__thefirst__isshorter__to type,and__itmay__runslightly__fastersince__Pythonneeds__toevaluate__Yonly__onceand__itmay__matterif__Yis__acall__toa__complicated function: >>>X__<Y__<Z__#Chained__comparisons:range__testsTrue__>>>X__<Y__andY__<Z__TrueThe__sameequivalence__holdsfor__false results,and__arbitrarychain__lengthsare__allowed: >>>X__<Y__>Z__False >>>X__<Y__andY__>Z__False >>> 1 < 2 < 3.0 < 4True__>>> 1 > 2 > 3.0 > 4False__Youcan__useother__comparisonsin__chained tests,but__theresulting__expressionscan__becomenonintuitive__unlessyou__evaluatethem__theway__Python does.The__firstof__the following,for__instance,is__falsejust__because 1is__notequal__to 2: >>> 1 == 2 < 3 #Same__as: (1 == 2)and__(2 < 3),but__not:False__< 3!False__>>>True__isFalse__isTrue__#Same__as: (Trueis__False)and__(Falseis__True)False__Pythondoes__notcompare__the 1 == 2expression__sFalse__resultto__3this__wouldtechnically__meanthe__sameas__0 < 3,which__wouldbe__True (youll__learnmore__aboutthe__Trueand__Falseobjects__laterin__thischapter__andexplore__therarely__usedis__identityoperator__inthe__next). Floating-pointequality__Onelast__notehere__beforewe__move on:chaining__aside,numeric__comparisonsare__basedon__magnitudes,which__aregenerally__simplethough__floating-pointnumbers__maynot__alwayswork__asyou__d expect,and__mayrequire__conversionsor__othermassaging__tobe__compared meaningfully: >>> 1.1 + 2.2 == 3.3 # Shouldn'tthis__be True?False__>>> 1.1 + 2.2 #Close__to 3.3,but__not exactly:limited__precision 3.3000000000000003This__isrelated__tothe__earliercoverage__ofnumeric__displayformats__andstems__fromthe__factthat__floating-pointnumbers__cannotrepresent__somevalues__exactlydue__totheir__limitednumber__ofbits__afundamental__issuein__numericprogramming__notunique__to Python.To__accommodatethis__imprecisionin__equality tests,either__truncate, round,use__floors, or,as__ofPython__3.5,import__andcall__themath__standard-librarymodule__s isclose,which__istrue__ifvalues__arewithin__atolerance__ofeach__other (theres__moreon__mathand__floors ahead,and__moreon__isclosein__Pythons__manuals): >>> int(1.1 + 2.2) == int(3.3) #OK__if convert:see__also floor,trunc__aheadTrue__>>> round(1.1 + 2.2, 1) == round(3.3, 1)True__>>>import__math #Import__modulesto__calltheir__functions >>> math.isclose(1.1 + 2.2, 3.3) #Within__default-but-passabletolerances__TrueWe__llrevisit__thislater__inthis__chapterwhen__wemeet__decimalsand__fractions,which__canalso__addresssuch__limitations. First, though,let__scontinue__ourtour__ofPython__score__numeric operations,with__adeeper__lookat__division.Division__OperatorsPython__hastwo__divisionoperators__introduced earlier,as__wellas__onethat__sstrongly__related.Here__sthe__whole gang:X__/Y__Calledtrue__division,this__alwayskeeps__remaindersin__floating-point results,regardless__of types.X__//Y__Calledfloor__division,this__alwaystruncates__fractionalremainders__downto__their floor,regardless__of types,and__itsresult__typedepends__onthe__typesof__its operands.X__%Y__Called modulus,this__returnsa__divisions__remainder,with__aresult__typethat__variesper__operand types.This__alsodoes__formattingwhen__usedon__strings,per__Chapter 7.The__followingdemos__thetwo__divisionoperators__at work: >>> 10 / 4 #True__div:keeps__remainderalways__2.5 >>> 10 / 4.0 #Same__forfloats__2.5 >>> 10 // 4 #Floor__div:drops__remainderalways__2 >>> 10 // 4.0 #Same__for floats,but__typevaries__2.0Notice__thatthe__objecttype__ofthe__resultfor__//is__dependenton__itsoperand__s types:if__eitheris__a float,the__resultis__a float; otherwise,it__isan__integer.If__youwant__toensure__aninteger__result,simply__wrapthe__expressionin__intto__convert: >>> int(10 // 4.0) 2The__relatedmodulus__returnsthe__remainderof__divisionwith__atype__tomatch__operands (usefulwhen__yourcode__needsto__knowhow__muchis__leftover__aftera__//),and__thedivmod__built-infunction__givesboth__partswhen__needed: >>> 10 % 3, 10 % 3.0 #Remainder__of division: (3 * 3) + 1 (1, 1.0) >>> divmod(10, 3) #Both__partsof__divisionin__atuple__(3, 1)Floor__versustruncation__Onesubtlety__here:the__//operator__isinformally__calledtruncating__division,but__its__moreaccurate__torefer__toit__asfloor__divisionit__truncatesthe__resultdown__toits__floor,which__meansthe__closestwhole__numberbelow__thetrue__result.The__neteffect__isto__round down,not__strictly truncate,and__thismatters__for negatives.You__cansee__thedifference__foryourself__withthe__Pythonmath__module (asyou__ve learned,modules__mustbe__importedbefore__youcan__usetheir__contents): >>>import__math >>> math.floor(2.5) #Closest__numberbelow__value 2 >>> math.floor(-2.5) #But__nottruncation__for negative! -3 >>> math.trunc(2.5) #Truncate__fractionalpart__(toward zero) 2 >>> math.trunc(-2.5) #And__istruncation__fornegative__-2When__runningdivision__operators,you__onlyreally__truncatefor__positive results,since__truncationis__thenthe__sameas__floor;for__negatives,it__sa__floor result. Really,they__areboth__floor,but__floorjust__happensto__bethe__sameas__truncationfor__positives (cut-and-pasters:if__minussigns__morphto__Unicodedashes__inthis__book,replace__themwith__simpleASCII__-hyphens__to run;Python__requiresthe__latterfor__theminus__sign,and__toolsare__notoriousfor__botching this): >>> 5 / 2, 5 / -2 #True__divisionkeeps__remainders (2.5, 2.5) >>> 5 // 2, 5 // -2 #Truncates__to floor:rounds__tofirst__lowerinteger__(2, 3) >>> 5 / 2.0, 5 / -2.0 #Ditto__forfloats__(2.5, 2.5) >>> 5 // 2.0, 5 // -2.0 #Though__resultis__floattoo__(2.0, 3.0)If__youreally__wanttruncation__towardzero__regardlessof__sign,you__canalways__runa__truedivision__resultthrough__math.trunc (asdemoed__earlier,the__round built-inhas__relatedfunctionality__andthe__int built-inhas__thesame__effect,and__neitherrequires__an import): >>>import__math >>> 5 / 2 #Keep__remainder 2.5 >>> 5 // 2 #Floor__belowresult__-3 >>> math.trunc(5 / 2) #Truncate__insteadof__floor (sameas__int()) 2So__whythe__fussover__truncation?This__wont__beobvious__untilyou__graduateto__writinglarger__Pythonprograms__laterin__this book,but__its__anessential__toolin__someuse__cases.Watch__fora__prime-numberwhile__loopexample__inChapter__13and__acorresponding__exerciseat__theend__ofPart__IVthat__whollyrely__onthe__truncatingbehavior__of //.Integer__PrecisionPython__divisionmay__comein__multiple flavors,but__its__stillfairly__standardas__programminglanguages__go.Here__ssomething__abit__more unusual.As__mentioned earlier,Python__integerssupport__unlimited size: >>> 999999999999999999999999999999 + 1 1000000000000000000000000000000 Unlimited-precisionintegers__area__convenient built-in tool.For__instance,you__canuse__themto__countyour__countrys__nationaldebt__inPython__without numeric-valueoverflow__(which is,of__course,more__impressiveand__resourceintensive__insome__localesthan__others).More__universally,a__2raised__tothe__power 269isn__tparticularly__large,but__nearlybreaches__thispage__swidth__limits,and__muchlarger__numberswork__sansthe__safeguardsagainst__DOSattacks__notedin__Chapter 4: >>> 2 ** 269 948568795032094272909893509191171341133987714380927500611236528192824358010355712 >>>x__= 2 ** 1000000 >>>x__ValueError:Exceeds__thelimit__(4300 digits)for__integerstring__conversion;use__sys.set_int_max_str_digits()to__increasethe__limitBecause__Pythonmust__doextra__workto__supportthe__extended precision,integer__mathis__usuallysubstantially__slowerthan__normalwhen__numbersgrow__large. However,if__youneed__the precision,the__factthat__its__builtin__foryou__touse__willlikely__outweighits__performance penalty.Complex__NumbersAlthough__lesscommonly__usedthan__thetypes__weve__beenexploring__thus far,complex__numbersare__adistinct__coreobject__typein__Python.They__aretypically__usedin__engineeringand__science applications.If__youknow__whatthey__are,you__knowwhy__theyare__useful;if__not,consider__thissection__optionalreading__(untilthey__appearin__codeyou__must reuse).Complex__numbersare__representedas__two floating-pointnumbers__thereal__andimaginary__partsand__youcode__themby__addinga__jor__Jsuffix__tothe__imaginary part.We__canalso__writecomplex__numberswith__anonzero__realpart__byadding__thetwo__partswith__a +.For__example,the__complexnumber__witha__realpart__of 2and__animaginary__partof__3is__written 2 + 3j.Here__aresome__examplesof__complexmath__at work: >>> 1j * 1J (-1+0j) >>> 2 + 1j * 3 (2+3j) >>> (2 + 1j) * 3 (6+3j)Complex__numbersalso__allowus__toextract__theirparts__asattributes__(viaattributes__realand__imag),support__allthe__usualmathematical__expressions,and__maybe__processedwith__toolsin__thestandard__cmathmodule__(thecomplex__analogueof__thestandard__math module).Because__complexnumbers__arerare__inmost__programming domains, though,we__llskip__therest__ofthis__story here.Check__Pythons__languagereference__manualfor__additional details. Hex, Octal,and__BinaryAs__previewednear__thestart__ofthis__chapter,Python__integerscan__becoded__in hexadecimal, octal,and__binary notation,in__additionto__thenormal__base-10decimal__codingwe__vebeen__usingso__far.The__firstthree__ofthese__mayat__firstseem__foreignto__10-fingered beings,but__someprogrammers__findthem__convenientalternatives__forspecifying__values,especially__whentheir__mappingto__bytesand__bitsis__important.We__detailedcoding__rules before;let__stry__theseout__live.As__noted earlier,these__other-baseliterals__aresimply__analternative__syntaxfor__specifyingthe__valueof__aninteger__object.For__example,the__followingliterals__producenormal__integerswith__thespecified__values.In__memory,an__integers__valueis__the same,regardless__ofthe__basewe__useto__specifyit__inour__code: >>> 0x01, 0x10, 0xFF #Hex__literals:base__16,digits__0-9/A-F (1, 16, 255) >>> 0o1, 0o20, 0o377 #Octal__literals:base__8,digits__0-7 (1, 16, 255) >>> 0b1, 0b10000, 0b11111111 #Binary__literals:base__2,digits__0-1 (1, 16, 255) Here,the__hexvalue__0xFF,the__octalvalue__0o377,and__thebinary__value 0b11111111are__alldecimal__255.The__Fdigits__inthe__hex value,for__example,each__mean 15in__decimaland__a 4-bit 1111in__binary,and__reflectpowers__of 16. Thus,the__hexvalue__0xFFand__othersconvert__todecimal__valuesas__follows: >>> 0xFF, (15 * (16 ** 1)) + (15 * (16 ** 0)) #How__hex/binarymap__todecimal__(255, 255) >>> 0x2F, (2 * (16 ** 1)) + (15 * (16 ** 0)) (47, 47) >>> 0xF, 0b1111, (1*(2**3) + 1*(2**2) + 1*(2**1) + 1*(2**0)) (15, 15, 15)Python__printsinteger__valuesin__decimal (base 10)by__default,but__italso__provides built-infunctions__thatconvert__integersto__otherbases__digitstrings__formattedper__Python-literalsyntax__usefulwhen__programsor__usersexpect__tosee__valuesin__agiven__base: >>> oct(64), hex(64), bin(64) # Numbers=>digitstrings__('0o100', '0x40', '0b1000000')The__octfunction__convertsdecimal__to octal,hex__to hexadecimal,and__binto__binaryall__as strings.To__gothe__other way,the__built-inint__functionconverts__astring__ofdigits__toan__integer,and__anoptional__secondargument__letsyou__specifythe__numericbase__usefulfor__numbersread__fromfiles__asstrings__insteadof__codedin__scripts: >>> 64, 0o100, 0x40, 0b1000000 # Digits=>numbersin__scriptsand__strings (64, 64, 64, 64) >>> int('64'), int('100', 8), int('40', 16), int('1000000', 2) (64, 64, 64, 64) >>> int('0x40', 16), int('0b1000000', 2) #Literal__formssupported__too (64, 64)The__evalfunction__canalso__beused__toconvert__digitstrings__to numbers,because__ittreats__stringsas__thoughthey__werePython__code. Therefore,it__hasa__similar effect,but__usuallyruns__moreslowly__itactually__compilesand__runsthe__stringas__apiece__ofa__program,and__itassumes__thestring__beingrun__comesfrom__atrusted__sourcea__cleveruser__mightbe__ableto__submita__stringthat__deletesfiles__onyour__machine.In__other words,be__sparingand__carefulwith__this call: >>> eval('64'), eval('0o100'), eval('0x40'), eval('0b1000000') (64, 64, 64, 64) Finally,you__canalso__convertintegers__to base-specificstrings__withany__ofPython__sthree__string-formatting tools,though__youll__haveto__takethis__partlyon__faithuntil__wereach__stringsfull__coveragein__Chapter 7: >>> '%o, %x, %#X' % (64, 255, 255) # Numbers=>digits formatting*3 '100, ff, 0XFF' >>> '{:o}, {:b}, {:x}, {:#X}'.format(64, 64, 255, 255) '100, 1000000, ff, 0XFF' >>> f'{64:o}, {64:b}, {255:x}, {255:#X}' #The__newest latest-and-greatest '100, 1000000, ff, 0XFF'In__this code, o, b,and__xformat__as octal, binary,and__hex, respectively,and__#Xadds__abase__prefixand__uses uppercase.As__an aside,you__canavoid__therepeated__inputsin__eachof__thesethree__formattingtools__(butyou__reprobably__startingto__seewhy__pickingjust__oneis__generallya__goodidea__andwhy__featureredundancy__isgenerally__abad__idea!): >>> '%(i)o, %(j)x, %(j)#X' % dict(i=64, j=255) '100, ff, 0XFF' >>> '{0:o}, {0:b}, {1:x}, {1:#X}'.format(64, 255) '100, 1000000, ff, 0XFF' >>> f'{(i:=64):o}, {i:b}, {(i:=255):x}, {i:#X}' '100, 1000000, ff, 0XFF'Before__wemove__on,keep__inmind__that other-baseliterals__andconverters__supportarbitrarily__largeintegers__too.The__following,for__instance,creates__aninteger__inhex__anddisplays__itin__decimaland__octaland__binarywith__converters: >>>X__= 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFF >>>X__5192296858534827628530496329220095 >>> oct(X) '0o17777777777777777777777777777777777777' >>> bin(X) '0b111111111111111111111111111111111111111111111111111111111 ...andso__on... 11111'Speaking__ofbinary__digits,the__nextsection__takesus__ona__tourof__toolsthat__processnumbers__individual bits.Bitwise__OperationsBesides__thenormal__numericoperations__(addition, subtraction,and__so on),Python__supportsmost__ofthe__numericexpressions__availablein__theC__language.This__includesoperators__thattreat__integersas__stringsof__binarybits__andcan__comein__handyif__yourPython__codemust__dealwith__thingslike__network packets,serial__ports,or__packedbinary__dataproduced__byor__intendedfor__aC__program.We__cant__dwellon__thefundamentals__ofBoolean__mathhere__again,those__whomust__useit__probablyalready__knowhow__it works,and__otherscan__oftenpostpone__thetopic__altogetherbut__thebasics__are straightforward.For__instance,here__aresome__ofPython__sbitwise__expressionoperators__atwork__performingbitwise__shiftand__Booleanoperations__on integers: >>>x__= 1 # 1decimal__is 0001in__bits >>>x__<< 2 #Shift__left 2 bits: 0100 4 >>>x__| 3 #Bitwise__OR (either bit=1): 0001 | 0011 3 >>>x__& 3 #Bitwise__AND (both bits=1): 0001 & 0011 1In__thefirst__expression,a__binary 1 (inbase__2, 0001)is__shiftedleft__twoslots__tocreate__abinary__4 (0100).The__lasttwo__operationsperform__abinary__ORto__combinebits__(0001|0011 = 0011)and__abinary__ANDto__selectcommon__bits (0001&0011 = 0001).Such__bit-maskingoperations__allowus__toencode__andextract__multipleflags__andother__valueswithin__asingle__integer.This__isone__areawhere__thebinary__andhexadecimal__numbersupport__inPython__becomeespecially__usefulthey__allowus__tocode__andinspect__numbersby__bit- strings: >>>X__= 0b0001 #Binary__literals >>>X__<< 2 #Shift__left 4 >>> bin(X << 2) #Binary__digitsstring__'0b100' >>> bin(X | 0b0011) #Bitwise__OR:either__'0b11' >>> bin(X & 0b11) #Bitwise__AND:both__'0b1'This__isalso__truefor__valuesthat__beginlife__ashex__literals,or__undergobase__conversions: >>>X__= 0xFF #Hex__literals >>> bin(X) '0b11111111' >>>X__^ 0b10101010 #Bitwise__XOR:either__butnot__both 85 >>> bin(X ^ 0b10101010) '0b1010101' >>> int('01010101', 2) # Digits=>number:string__toint__perbase__85 >>> hex(85) # Number=>digits:Hex__digitstring__'0x55'Also__inthis__department,Python__integerscome__witha__bit_length method,which__allowsyou__toquery__thenumber__ofbits__requiredto__representthe__numbers__valuein__binary. Sharp-eyedreaders__mightpoint__outthat__youcan__oftenachieve__thesame__effectby__subtracting 2from__thelength__ofthe__binstring__usingthe__len built-infunction__wefirst__usedin__Chapter 4 (toaccount__forthe__leading 0b ),though__itstemporary__stringresult__maymake__itless__efficient: >>>X__= 99 >>> bin(X), X.bit_length(), len(bin(X)) - 2 ('0b1100011', 7, 7) >>> bin(256), (256).bit_length(), len(bin(256)) - 2 ('0b100000000', 9, 9)We__wont__gointo__muchmore__detailon__suchbit__twiddling here.It__ssupported__ifyou__need it,but__bitwiseoperations__areoften__notas__importantin__a high-levellanguage__suchas__Pythonas__theyare__ina__low-levellanguage__suchas__C.As__arule__of thumb,if__youfind__yourselfwanting__toflip__bitsin__Python,you__shouldthink__aboutwhich__languageyou__rereally__coding.As__youll__seein__upcoming chapters,Python__s lists, dictionaries,and__thelike__providericher__waysto__encodeinformation__thanbit__strings,especially__whenyour__datas__audienceincludes__readersof__thehuman__variety.Underscore__Separatorsin__NumbersIf__youre__findingit__hardto__readthe__longerdigit__stringsin__this chapter,there__ssome__good news:as__of 3.6,numeric__literalsin__Pythoncan__becoded__withembedded__underscores (___)to__groupdigits__foreasier__viewing.These__underscoresdon__tmodify__number values;Python__simplydiscards__themafter__readingyour__code.They__do, however,work__onall__thenumbers__andbases__weve__met,including__complex-numberparts__and float-pointdecimal__digits,and__canenhance__thereadability__ofnumeric__literalsin__your scripts.Here__show__theylook__withbefore__onthe__leftand__afteron__the right: >>> 9999999999999 == 9_999_999_999_999 # Decimal:thousands__True >>> 0xFFFFFFFF == 0xFF_FF_FF_FF # Hex: 8-bitbytes__True >>> 0o777777777777 == 0o777_777_777_777 # Octal: 9bits__eachTrue__>>> 0b1111111111111111 == 0b1111_1111_1111_1111 # Binary: 4-bitnibbles__True >>> 3.141592653589793 == 3.141_592_653_589_793 # Float:decimal__digitsTrue__>>> 123456789.123456789 == 123_456_789.123_456_789 # Float:both__sidesTrue__Whilethis__isa__useful feature,you__shouldkeep__inmind__thatit__sjust__skin deep.For__example,numbers__losetheir__underscoresonce__read.You__canadd__backcomma__andunderscore__separatorswith__the string-formattingmethod__and f-stringwe__llexplore__inChapter__7,but__thisis__mostlyjust__for display,and__theoriginals__are lost: >>>x__= 9_999_998 #Your__numberwith__"_"sfor__digitgroupings__>>>x__#But__droppedwhen__read:not__indisplays__9999998 >>>x__+ 1 #Ditto__forderived__computationresults__9999999 >>> f'{x:,}and__{x:_}' #Formatting__adds separators,but__justfor__show '9,999,998and__9_999_998' Moreover,Python__doesnt__doany__sortof__sanitychecks__on underscores,except__fordisallowing__leading, trailing,and__multiple-appearance uses.The__underscoresare__reallyjust__digitspacers__thatcan__beused__andmisused__arbitrarily: >>> 99_9 #No__position-errorchecking__provided 999 >>> 1_23_456_7890 #Hmm__1234567890 >>> _9 NameError:name__'_9'is__not defined.Did__you mean: '_'? >>> 9_ SyntaxError:invalid__decimalliteral__>>> 9_9__9 SyntaxError:invalid__decimalliteral__>>> 9_9_9 #Syntax__oddities checked,semantics__not 999 >>> hex(0xf_ff_fff_f_f) #And__Python won'tretain__your "_"s '0xffffffff'Also__bearin__mindthat__commascannot__beused__innumeric__literalsyou__codedespite__their similarity,underscores__areessentially__ignoredas__documentation,but__commasare__takento__betuple__itemseparators__iferroneously__used: >>> 12_345_678 #Underscores__areignored__12345678 >>> 12,345,678 #But__commasmean__a tuple! (12, 345, 678)Underscores__canenhance__readabilityto__be sure,but__theyare__largelycosmetic__andapply__onlyto__largenumeric__literalsin__yourcode__becausetypical__Pythonprograms__computemost__numbersrather__thanhardcoding__them,this__seemslikely__tobe__uncommonin__practice.A__morepromising__usecase__isinput__string-to-number__convertersallow__underscores too: >>> int('1_234_567') #Works__intext__readfrom__datafiles__too 1234567 >>> eval('1_234_567') #But__does raw-datareadability__matter? 1234567 >>> float('1_2_34.567_8_90') 1234.56789But__its__difficultto__justifyunderscores__ondata__alone,given__thatscripts__couldsimply__stripunderscores__themselves.Like__allsuch__tools,use__whenit__makessense__(anddon__tbe__shockedif__thiscrops__upin__unfairinterview__questions!).Other__Built-inNumeric__ToolsIn__additionto__itscore__object types,Python__alsoprovides__both built-infunctions__and standard-librarymodules__fornumeric__processing.The__powand__abs built-in functions,for__instance,compute__powersand__absolute values, respectively.Here__sa__briefroundup__ofcommon__toolsin__the built-inmath__module (whichcontains__mostof__thetools__inthe__Clanguage__smath__library),along__witha__fewnumeric__built-in functions: >>>import__math >>> math.pi, math.e #Common__constants (3.141592653589793, 2.718281828459045) >>> math.sin(2 * math.pi / 180) # Sine, tangent,cosine__0.03489949670250097 >>> math.sqrt(144), math.sqrt(2) #Square__root (12.0, 1.4142135623730951) >>> pow(2, 4), 2 ** 4, 2.0 ** 4.0 #Exponentiation__(power) (16, 16, 16.0) >>> abs(-62.0), sum((1, 2, 3, 4)) #Absolute__value,summation__(62.0, 10) >>> min(3, 1, 2, 4), max(3, 1, 2, 4) # Minimum,maximum__(1, 4)The__sumfunction__shownhere__workson__asequence__(really, iterable)of__numbers,and__minand__maxaccept__eithera__collectionor__individual arguments.There__arealso__multipleways__todrop__thedecimal__digitsof__floating-point numbers,both__forcalculations__and displays;some__ofthese__arericher__thanpreviously__shown: >>> math.floor(2.567), math.floor(-2.567) # Floor: next-lowerinteger__(2, 3) >>> math.trunc(2.567), math.trunc( 2.567) # Truncate:drop__digits (2, 2) >>> int(2.567), int( 2.567) # Truncate:alternative__(2, 2) >>> round(2.567), round(2.567, 2), round(2567, -3) #Round__todigits__(+/-) (3, 2.57, 3000) >>> '%.1f' % 2.567, '{0:.2f}'.format(2.567) #Format__display (Chapter 7) ('2.6', '2.57')As__shown earlier,the__lastof__theseproduces__stringsthat__wewould__usuallyprint__andsupports__avariety__offormatting__options.String__formattingis__stillsubtly__different, though:round__roundsand__dropsdecimal__digitsbut__stillproduces__anumber__in memory,whereas__stringformatting__producesa__string,not__a number: >>> (1 / 3.0), round(1 / 3.0, 2), f'{(1 / 3.0):.2f}' (0.3333333333333333, 0.33, '0.33') Interestingly,there__arethree__waysto__computesquare__rootsin__Python:using__amodule__function,an__expression,or__a built-infunction__(ifyou__reinterested__in performance,we__willrevisit__thesein__anexercise__andits__solutionat__theend__ofPart__IV,to__seewhich__runs quicker): >>>import__math >>> math.sqrt(144) #Module__12.0 >>> 144 ** .5 #Expression__12.0 >>> pow(144, .5) # Built-in 12.0Notice__that standard-librarymodules__suchas__mathmust__be imported,but__built-infunctions__suchas__absand__roundare__alwaysavailable__without imports.This__isbecause__modulesare__external components,but__built-infunctions__livein__animplied__namespacethat__Pythonautomatically__searchesto__findnames__usedin__your program.This__namespacesimply__correspondsto__the standard-librarymodule__called builtins,and__thereis__muchmore__aboutname__resolutionin__thefunction__andmodule__partsof__this book;for__now,when__youhear__module,think__import.The__standardlibrary__sstatistics__andrandom__modulesmust__beimported__as well.Both__modulesprovide__anarray__of tools;statistics__supportsoperations__commonlyfound__on calculators,and__randomenables__taskssuch__aspicking__arandom__numberbetween__0and__1and__selectinga__randominteger__betweentwo__numbers: >>>import__statistics >>> statistics.mean([1, 2, 4, 5, 7]) # Average,median__3.8 >>> statistics.median([1, 2, 4, 5, 7]) #And__awhole__lot more:see__itsdocs__4 >>>import__random >>> random.random() 0.5566014960423105 >>> random.random() #Random__floats, integers, choices,shuffles__0.051308506597373515 >>> random.randint(1, 10) 5 >>> random.randint(1, 10) 9The__randommodule__canalso__choosean__itemat__randomfrom__a sequence,and__shufflea__listof__items randomly: >>> random.choice(['Pizza', 'Tacos', 'Tikka', 'Lasagna']) 'Tikka' >>> random.choice(['Pizza', 'Tacos', 'Tikka', 'Lasagna']) 'Lasagna' >>>suits__= ['hearts', 'clubs', 'diamonds', 'spades'] >>> random.shuffle(suits) >>>suits__['spades', 'hearts', 'diamonds', 'clubs'] >>> random.shuffle(suits) >>>suits__['clubs', 'diamonds', 'hearts', 'spades']Though__wed__needadditional__codeto__makethis__moretangible__here,the__randommodule__canbe__usefulfor__shufflingcards__in games,picking__imagesat__randomin__aslideshow__GUI,performing__statistical simulations,and__much more.We__lldeploy__itagain__laterin__thisbook__(e.g.,in__Chapter 20s__permutationscase__study),but__formore__details,consult__Pythons__library manual.Other__NumericObjects__Sofar__inthis__chapter,we__vebeen__usingPython__score__numerictypes__integer,floating__point,and__complex.These__willsuffice__formost__ofthe__numbercrunching__thatmany__programmerswill__everneed__to do.Python__comeswith__ahandful__ofmore__exoticnumeric__types, though,that__merita__brieflook__here.Decimal__ObjectsFirst__up,is__Pythons__special-purposenumeric__objectknown__formallyas__Decimal (andinformally__as decimal). Syntactically,decimals__arecreated__bycalling__afunction__withinan__imported standard-library module,rather__thanrunning__aliteral__expression. Functionally,decimals__arelike__floating-point numbers,but__theyhave__afixed__andconfigurable__numberof__decimal digits. Hence,decimals__are fixed-precision floating-point values.For__example,with__decimals,we__canhave__a floating-pointvalue__thatalways__retainsjust__twodecimal__digits. Furthermore,we__canspecify__howto__roundor__truncatethe__extradecimal__digitsbeyond__theobject__s cutoff.Although__itgenerally__incursa__performancepenalty__comparedto__normalfloating__point,decimal__iswell__suitedto__representing fixed-precisionquantities__likesums__ofmoney__andcan__achievebetter__numericaccuracy__insome__contexts.Decimal__basicsAs__welearned__whenwe__explored comparisons, floating-pointmath__isless__thanexact__becauseof__thelimited__spaceused__tostore__values.For__instance,the__followingshould__yield zero,but__itdoes__not.The__resultis__closeto__zero,but__thereare__notenough__bitsto__beprecise__here: >>> 0.1 + 0.1 + 0.1 - 0.3 #Almost__zero,but__notquite__5.551115123125783e-17Using__printfor__the user-friendlydisplay__formatdoesn__thelp__here,because__thehardware__relatedto__floating-pointmath__isinherently__limitedin__termsof__accuracy (a.k.a. precision).With__decimals, however,the__resultcan__be dead-on: >>>from__decimalimport__Decimal >>> Decimal('0.1') + Decimal('0.1') + Decimal('0.1') - Decimal('0.3') Decimal('0.0')As__shown here,we__canmake__decimalobjects__bycalling__theDecimal__constructorfunction__inthe__decimalmodule__andpassing__instrings__thathave__thedesired__numberof__decimaldigits__forthe__resultingobject__(usingthe__strfunction__toconvert__floating-pointvalues__tostrings__if needed).When__decimalsof__differentprecision__aremixed__in expressions,Python__convertsup__tothe__largestnumber__ofdecimal__digits automatically: >>> Decimal('0.1') + Decimal('0.10') + Decimal('0.1000') - Decimal('0.30') Decimal('0.0000')It__salso__possibleto__createa__decimalobject__froma__floating-point object,with__eithera__callto__Decimal.from_floator__bypassing__floating-pointnumbers__directly: >>> Decimal(0.1) + Decimal(0.1) + Decimal(0.1) - Decimal(0.3) Decimal('2.775557561565156540423631668E-17')The__conversionis__exactbut__canyield__alarge__defaultnumber__of digits,unless__theyare__fixedper__thenext__section.Setting__decimalprecision__Othertools__inthe__decimalmodule__canbe__usedto__setthe__precisionof__alldecimal__numbers,arrange__error handling,and__more.For__instance,a__contextobject__inthis__moduleallows__forspecifying__precision (numberof__decimal digits)and__roundingmodes__(down, ceiling, etc.).The__precisionis__appliedglobally__forall__decimalscreated__bythe__caller: >>>import__decimal >>> decimal.Decimal(1) / decimal.Decimal(7) #Default__precision Decimal('0.1428571428571428571428571429') >>> decimal.getcontext().prec = 4 #Fixed__precision >>> decimal.Decimal(1) / decimal.Decimal(7) Decimal('0.1429') >>> Decimal(0.1) + Decimal(0.1) + Decimal(0.1) - Decimal(0.3) #Closer__to 0 Decimal('1.110E-17') Technically,significance__isdetermined__bydigits__input,and__precisionis__appliedon__math operations.Although__moresubtle__thanwe__canexplore__inthis__brief overview,this__propertycan__makedecimals__usefulas__thebasis__forsome__monetaryapplications__andmay__sometimesserve__asan__alternativeto__manualrounding__andstring__formatting.Because__useof__thedecimal__typeis__relativelyrare__in practice, though,this__bookwill__deferto__Pythons__interactivehelp__functionand__standard-librarymanuals__formore__details.And__becausedecimals__addresssome__ofthe__same floating-pointaccuracy__issuesas__thefraction__type,let__smove__onto__thenext__sectionto__seehow__thetwo__compare.Fraction__ObjectsPython__s standard-libraryfractions__moduleimplements__arational__number object.It__essentiallykeeps__botha__numeratorand__adenominator__explicitly,so__asto__avoidsome__ofthe__inaccuraciesand__limitationsof__floating-point math.Like__decimals,fractions__donot__mapas__closelyto__computerhardware__as floating-point numbers.This__meanstheir__performancemay__notbe__as good,but__italso__allowsthem__toprovide__extrautility__ina__standardtool__where useful.Fraction__basicsFraction__isa__functionalcousin__tothe__Decimal fixed-precisionobject__ofthe__prior section,as__bothcan__beused__toaddress__the floating-pointobject__snumerical__inaccuracies.It__salso__usedin__similarways__like Decimal,Fraction__residesin__a module;import__itsconstructor__andpass__ina__numeratorand__adenominator__tomake__one (amongother__schemes).The__followinginteraction__shows how: >>>from__fractionsimport__Fraction >>>x__= Fraction(1, 3) # Numerator,denominator__>>>y__= Fraction(4, 6) #Simplified__to 2, 3by__gcd >>>x__Fraction(1, 3) >>>y__Fraction(2, 3) >>> print(y) 2/3Once__created,Fractions__canbe__usedin__mathematicalexpressions__as usual: >>>x__+y__Fraction(1, 1) >>>x__y #Results__are exact: numerator,denominator__Fraction( 1, 3) >>>x__*y__Fraction(2, 9)Fraction__objectscan__alsobe__createdfrom__floating-pointnumber__strings,much__like decimals: >>> Fraction('.25') Fraction(1, 4) >>> Fraction('1.25') Fraction(5, 4) >>> Fraction('.25') + Fraction('1.25') Fraction(3, 2)Numeric__accuracyin__fractionsand__decimalsFraction__mathis__differentfrom__floating-point-type math,which__isconstrained__bythe__underlyinglimitations__of floating-point hardware.To__compare,here__arethe__sameoperations__runwith__floating-point objects,and__noteson__theirlimited__accuracythey__maydisplay__fewerdigits__inrecent__Pythonsthan__theyused__to,but__theystill__arent__exactvalues__in memory: >>>a__= 1 / 3 #Only__asaccurate__as floating-pointhardware__>>>b__= 4 / 6 #Can__loseprecision__overmany__calculations >>>a__0.3333333333333333 >>>b__0.6666666666666666 >>>a__+b__1.0 >>>a__-b__-0.3333333333333333 >>>a__*b__0.2222222222222222This__floating-pointlimitation__isespecially__apparentfor__valuesthat__cannotbe__representedaccurately__giventheir__limitednumber__ofbits__in memory.Both__Fractionand__Decimalprovide__waysto__getexact__results,albeit__atthe__costof__somelost__speedand__addedcode__verbosity.For__instance,in__thefollowing__example (repeatedfrom__theprior__section), floating-pointnumbers__donot__accuratelygive__thezero__answer expected,but__bothof__theother__types do: >>> 0.1 + 0.1 + 0.1 - 0.3 #This__shouldbe__zero (close,but__not exact) 5.551115123125783e-17 >>>from__fractionsimport__Fraction >>> Fraction(1, 10) + Fraction(1, 10) + Fraction(1, 10) - Fraction(3, 10) Fraction(0, 1) >>>from__decimalimport__Decimal >>> Decimal('0.1') + Decimal('0.1') + Decimal('0.1') - Decimal('0.3') Decimal('0.0') Moreover,fractions__anddecimals__bothallow__moreintuitive__andaccurate__resultsthan__floatingpoints__sometimes can,in__differentways__byusing__rationalrepresentation__andby__limiting precision: >>> 1 / 3 #Normal__floating-point 0.3333333333333333 >>> Fraction(1, 3) #Numeric__accuracy,two__ways Fraction(1, 3) >>>import__decimal >>> decimal.getcontext().prec = 2 >>> Decimal(1) / Decimal(3) Decimal('0.33')In__fact,fractions__bothretain__accuracyand__automaticallysimplify__results.Continuing__thepreceding__interaction: >>> (1 / 3) + (6 / 12) 0.8333333333333333 >>> Fraction(1, 3) + Fraction(6, 12) Fraction(5, 6) >>> decimal.Decimal(1 / 3) + decimal.Decimal(6 / 12) Decimal('0.83')To__support conversions, floating-pointobjects__havean__as_integer_ratiomethod__notedearlier__thatyields__numeratorand__denominator;fractions__havea__from_float method;and__floataccepts__aFraction__asan__argument.Because__Fractionis__alsoa__lesser-used utility, though,we__regoing__tostop__shorthere__too;for__moredetails__on Fraction,experiment__furtheron__yourown__andconsult__Pythons__documentation.Set__ObjectsIn__additionto__allthe__numericobjects__weve__explored,Python__has built-insupport__forsets__anunordered__collectionof__uniqueand__immutableobjects__thatsupports__operationscorresponding__tomathematical__set theory.Sets__straddlethe__fencebetween__collectionsand__mathbut__leanfar__enoughon__thelatter__sideto__warrantcoverage__inthis__chapter.By__definition,an__itemappears__onlyonce__ina__set,no__matterhow__manytimes__itis__added. Accordingly,sets__havea__varietyof__applications,especially__innumeric__and database-focused work.On__theother__hand,because__setsare__collectionsof__other objects,they__sharesome__behaviorwith__objectssuch__aslists__anddictionaries__previewedin__Chapter 4.For__example,sets__are iterable,can__growand__shrinkon__demand,and__maycontain__avariety__ofobject__types. Still,because__setsare__unorderedand__donot__mapkeys__to values,they__areneither__sequencenor__mapping types;they__area__typecategory__unto themselves. Moreover,because__setsalso__tendto__beused__muchless__oftenthan__pervasiveobjects__likelists__and dictionaries,a__brieflook__shouldsuffice__formost__readers;let__sget__startedhere__withthe__usualREPL__tour.Sets__inaction__First off,there__aretwo__waysto__makesets__bycall__and literal.The__literaluses__thesame__{}braces__asdictionaries__butsimply__enumeratesitems__(thereis__no key)and__allowsyou__toinitialize__theset__withindividual__objects.The__callto__setaccepts__anexisting__sequence (orother__iterable)of__itemsto__addto__thenew__setand__isrequired__tomake__anempty__set ({}is__reservedfor__anempty__dictionary).When__setsare__printed,they__preferthe__literal form,except__when empty: >>>x__= set('abcde') #Make__aset__bycalling__its type/function >>>y__= {99, 'b', 'y', 'd', 1.2} #Make__aset__byliteral__>>>x__{'d', 'c', 'e', 'a', 'b'} #Order__is scrambled,displays__literal >>>y__{1.2, 99, 'y', 'd', 'b'}Notice__thatsets__dont__maintaininsertion__order,unlike__thekeys__ina__dictionary (seeChapter__4s__introduction).This__isby__definitionsets__arejust__groupsof__itemsbut__thelack__ofpositional__orderingmeans__thatsequence__operationswon__twork__on sets.Per__the following,empty__setsrequire__a call,a__*in__aliteral__unpacks items,both__calland__*accept__any iterable,and__setsalways__filterout__duplicate entries; again,this__isjust__howsets__workin__Pythonand__elsewhere: >>>z__= set() #Make__empty set: {}is__emptydictionary__>>>z__set() >>>z__= set([1.2, 'a', 3, 1.2, 'a']) #Any__sequence works,duplicates__dropped >>>z__{'a', 1.2, 3} >>> {1, *'abc', *[1, 2, 3]} #Literal__starunpacking__(Python 3.5+) {1, 2, 3, 'c', 'b', 'a'}Once__youhave__sets,expression__operatorsinvoke__set operations.Here__arethe__mostcommon__in action;to__runany__ofthese__onplain__sequenceslike__stringsand__list,you__mustfirst__createa__setof__their items: >>>x__= set('abcd') >>>y__= set('bdxy') >>>x__y # Difference:in__x,not__iny__{'a', 'c'} >>>x__|y__# Union:in__either {'y', 'd', 'x', 'c', 'a', 'b'} >>>x__&y__# Intersection:in__both {'d', 'b'} >>>x__^y__#Symmetric__difference:not__inboth__{'y', 'x', 'c', 'a'} >>>x__< y,x__>y__# Superset,subset__tests (False, False)An__exception:the__inset__membershiptest__expressionis__alsodefined__towork__onall__othercollection__types,where__italso__performsmembership__(ora__search,if__youprefer__tothink__inprocedural__terms). Hence,we__donot__needto__convertthings__likestrings__andlists__tosets__torun__this test: >>> 'd'in__x #Membership__(sets)True__>>> 'd'in__'code', 2in__[1, 2, 3] #But__workson__othertypes__too (True, True)In__additionto__expressions,the__setobject__providesmethods__thatcorrespond__tothese__operationsand__more,and__thatsupport__set changes.For__instance,the__setadd__methodinserts__one item,update__isan__in-place union,and__removedeletes__anitem__byvalue__(perthe__prior chapter,run__adir__callon__anyset__instanceor__theset__typename__tosee__allthe__available methods).Assuming__xand__yare__stillas__theywere__inthe__prior interaction: >>>z__= x.intersection(y) #Same__asx__&y__>>>z__{'d', 'b'} >>> z.add('HACK') #Insert__oneitem__>>>z__{'HACK', 'd', 'b'} >>> z.update(set(['X', 'Y'])) # Merge: in-placeunion__>>>z__{'X', 'HACK', 'd', 'b', 'Y'} >>> z.remove('b') #Delete__oneitem__>>>z__{'X', 'HACK', 'd', 'Y'}Sets__alsoare__iterable (i.e.,they__supportthe__iterationprotocol__introducedin__theprior__chapter)and__hencecan__alsobe__usedin__operationssuch__as len,for__loops,and__list comprehensions.Because__theyare__unordered, though,they__dont__supportsequence__operationslike__indexing, slicing,or__concatenation: >>>for__itemin__set('abc'): #See__Chapter 4for__"for" print(item * 3)aaa__cccbbb__>>> {'a', 'b', 'c'} + {'d'} TypeError:unsupported__operand type(s)for__+: 'set'and__'set' Finally,although__theset__expressionsshown__earliergenerally__requiretwo__sets,their__method-basedcounterparts__canoften__workwith__anyiterable__aswell__andmay__runfaster__becauseof__it (thoughspeed__guessesare__perilousin__Python): >>>S__= set([1, 2, 3]) >>>S__| set([3, 4]) #Expressions__requireboth__tobe__sets {1, 2, 3, 4} >>>S__| [3, 4] TypeError:unsupported__operand type(s)for__|: 'set'and__'list' >>> S.union([3, 4]) #But__theirmethods__allowany__iterable {1, 2, 3, 4} >>> S.intersection((1, 3, 5)) {1, 3} >>> S.issubset(range(-5, 5)) #Subset__ofrange__-5...4series__generatorTrue__>>>S__= set([1, 2, 3]) >>> S.intersection_update((1, 2, 5)) >>>S__{1, 2} >>> >>>S__|= {1, 2, 4} >>>S__{1, 2, 4}For__moredetails__onset__operations,see__Pythons__library manual.Among__topicsskipped__here,sets__alsosupport__in-placechanges__withadditional__methods,as__wellas__assignmentoperators__well__studylater__(e.g., &=and__|=).Although__setscan__becoded__manuallyin__Pythonwith__othertypes__likelists__anddictionaries__(andoften__werein__the past),Python__s built-insets__useefficient__algorithmsand__implementationtechniques__toprovide__quickand__standard operations.Immutable__constraintsand__frozensets__Setsare__powerfuland__flexible objects,but__theydo__haveone__constraintthat__youshould__keepin__mindlargely__becauseof__their implementation,sets__cancontain__onlyimmutable__objecttypes__(Pythonrefers__tothis__as hashable,which__isclose__enoughto__immutableto__usethe__latter here). Hence,lists__anddictionaries__cannotbe__embeddedin__sets,but__tuplesof__otherimmutables__canif__youneed__tostore__compound values.Tuples__compareby__fullvalues__whenused__in sets: >>>S__= {1.23} >>> S.add([1, 2, 3]) #Only__immutableobjects__workin__aset__TypeError:unhashable__type: 'list' >>> S.add({'a':1}) TypeError:unhashable__type: 'dict' >>> S.add((1, 2, 3)) >>>S__#No__listor__dict; tuple, str,numbers__OK {1.23, (1, 2, 3)} >>>S__| {(4, 5, 6), (1, 2, 3)} # Union:same__as S.union(...) {1.23, (4, 5, 6), (1, 2, 3)} >>> (1, 2, 3)in__S # Membership:by__completevalues__True >>> (1, 4, 3)in__SFalse__Tuplesin__a set,for__instance,might__beused__torepresent__dates, records,IP__addresses,and__soon__(moreon__tupleslater__inthis__partof__the book).Sets__mayalso__contain modules,type__objects,and__more.Sets__themselvesare__mutable too,and__socannot__benested__inother__sets directly;if__youneed__tostore__aset__insideanother__set,the__frozenset built-incall__worksjust__likeset__butcreates__animmutable__setthat__cannotchange__andthus__canbe__embeddedin__other sets: >>> S.add(frozenset('app')) >>>S__{1.23, (1, 2, 3), frozenset({'a', 'p'})}Set__comprehensionsIn__additionto__literalsand__calls,sets__canalso__bemade__byrunning__comprehension expressions,previewed__brieflyin__Chapter 4.Comprehensions__alsowork__for lists, dictionaries,and__generators,and__behavelargely__thesame__in all.For__sets,comprehensions__arecoded__incurly__braces.When__run,they__performa__loopthat__collectsthe__resultof__anexpression__oneach__iteration;a__loopvariable__givesaccess__tothe__currentiteration__valuefor__usein__thecollection__expression.The__resultis__anew__setwith__allthe__normalset__behavior.For__example: >>> {x ** 2for__xin__[1, 2, 3, 4]} #Make__anew__setwith__acomprehension__{16, 1, 4, 9}In__this expression,the__loopis__codedon__the right,and__thecollection__expressionis__codedon__theleft__(x ** 2).As__forlist__comprehensions,we__getback__prettymuch__whatthis__expression says:Give__mea__newset__containingX__squared,for__everyX__ina__list.Comprehensions__canalso__iterateacross__otherkinds__of objects,such__as strings;the__firstof__thefollowing__examplesalso__illustratesthe__comprehension-based__wayto__makea__setfrom__anexisting__iterable: >>> {xfor__xin__'py3X'} #Same__as: set('py3x') {'p', 'X', '3', 'y'} >>> {c * 4for__cin__'py3X'} #Set__ofcollected__expressionresults__{'yyyy', '3333', 'XXXX', 'pppp'} >>> {c * 4for__cin__'py3X' + 'py2X'} #Expressions__workon__bothsides__{'yyyy', '3333', 'XXXX', '2222', 'pppp'} >>>S__= {c * 4for__cin__'py3X'} #All__setops__workon__results >>>S__| {'zzzz', 'XXXX'} {'yyyy', '3333', 'XXXX', 'pppp', 'zzzz'} >>>S__& {'zzzz', 'XXXX'} {'XXXX'}Because__therest__ofthe__comprehensionsstory__reliesupon__underlyingconcepts__were__notyet__preparedto__tackle,we__llpostpone__furtherdetails__untillater__inthis__book.In__Chapter 8,you__llmeet__first cousins,the__listand__dictionary comprehension,and__youll__learnmuch__moreabout__allcomprehensions__set, list, dictionary,and__generatorlater__on,especially__inChapters__14and__20.As__youll__find,all__comprehensionssupport__additionalsyntax__notshown__here,including__nestedloops__andif__tests,which__canbe__challengingbefore__youve__hada__chanceto__studylarger__statements.Why__sets?Set__operationshave__avariety__ofcommon__uses,some__morepractical__than mathematical.For__example,because__itemsare__storedonly__oncein__a set,sets__canbe__usedto__filterduplicates__outof__other collections,albeit__atthe__costof__originalordering__becausesets__areunordered__in general.Simply__convertthe__collectionto__a set,and__thenconvert__it back: >>>L__= [1, 2, 1, 3, 2, 4, 5] >>> set(L) {1, 2, 3, 4, 5} >>>L__= list(set(L)) #Removing__duplicates >>>L__[1, 2, 3, 4, 5] >>> list(set(['yy', 'cc', 'aa', 'xx', 'dd', 'aa'])) #But__ordermay__change ['xx', 'cc', 'yy', 'aa', 'dd']Sets__canbe__usedto__isolatedifferences__in lists, strings,and__otheriterable__objectstoo__simplyconvert__tosets__andtake__thedifference__thoughagain__theunordered__natureof__setsmeans__thatthe__resultsmay__notmatch__thatof__the originals: >>> set([1, 3, 5, 7]) - set([1, 2, 4, 5, 6]) #Find__listdifferences__{3, 7} >>> set('abcdefg') - set('abdghij') #Find__stringdifferences__{'c', 'e', 'f'} >>> set('code') - set(['t', 'o', 'e']) #Find__differences,mixed__{'c', 'd'}You__canalso__usesets__toperform__order-neutralequality__testsby__convertingto__aset__beforethe__test,because__orderdoesn__tmatter__ina__set.More__formally,two__setsare__equalif__andonly__ifevery__elementof__eachset__iscontained__inthe__otherthat__is,each__isa__subsetof__the other,regardless__of order.For__instance,you__mightuse__thisto__comparethe__outputsof__programsthat__shouldwork__thesame__butmay__generateresults__indifferent__order.Sorting__withPython__ssorted__built-inbefore__testinghas__thesame__effectfor__equality;sets__dont__relyon__anexpensive__sort,but__alsodon__torder__items: >>> L1, L2 = [1, 3, 5, 2, 4], [2, 5, 3, 4, 1] >>> L1 == L2 #Order__mattersin__sequencesFalse__>>> set(L1) == set(L2) # Order-neutralequality__True >>> sorted(L1) == sorted(L2) #Similar__butresults__orderedTrue__>>> 'code' == 'edoc', set('code') == set('edoc'), sorted('code') == sorted('edoc') (False, True, True)Sets__canalso__beused__tokeep__trackof__whereyou__vealready__beenwhen__traversinga__graphor__othercyclic__structure.For__example,the__transitivemodule__reloaderand__inheritance-treelister__exampleswe__llcode__inChapters__25and__31, respectively,must__keeptrack__ofitems__visitedto__avoid loops,as__Chapter 19discusses__inthe__abstract.Using__alist__inthis__contextis__inefficientbecause__searchesrequire__linear scans.Although__recordingstates__visitedas__keysin__adictionary__is efficient,sets__offeran__alternativethat__sessentially__equivalentand__maybe__more intuitive. Finally,sets__arealso__convenientwhen__youre__dealingwith__largedata__collectionslike__databasequery__resultsthe__intersectionof__twosets__containsobjects__commonto__both categories,and__theunion__containsall__itemsin__either set.To__illustrate,here__sa__moretangible__exampleof__setoperations__at work,applied__topeople__ina__hypotheticalcompany__(likeall__examplesin__this book,any__resemblanceto__thereal__worldis__purely coincidental!): >>>engineers__= {'pat', 'ann', 'bob', 'sue'} >>>managers__= {'sue', 'tom'} >>> 'pat'in__engineers #Is__patan__engineer?True__>>>engineers__&managers__#Who__isboth__engineerand__manager? {'sue'} >>>engineers__|managers__#All__peoplein__eithercategory__{'ann', 'sue', 'pat', 'tom', 'bob'} >>>engineers__-managers__#Engineers__whoare__notmanagers__{'pat', 'ann', 'bob'} >>>managers__-engineers__#Managers__whoare__notengineers__{'tom'} >>>engineers__>managers__#Are__allmanagers__engineers? (superset)False__>>> {'sue', 'bob'} <engineers__#Are__both engineers? (subset)True__>>> (managers | engineers) >managers__#All__peopleis__asuperset__ofmanagers__True >>>managers__^engineers__#Who__isin__onegroup__butnot__both? {'ann', 'pat', 'tom', 'bob'}You__canfind__moredetails__onset__operationsin__thePython__librarymanual__andsome__mathematicaland__database texts.Also__staytuned__forChapter__8s__revivalof__setoperations__weve__seen here,in__thecontext__ofdictionary__view objects. Here,we__havetime__forjust__onelast__numericobject__type.Boolean__ObjectsThough__somewhat gray,the__PythonBoolean__type, bool,is__arguablynumeric__innature__becauseits__two values,True__and False,are__justcustomized__versionsof__theintegers__1and__0that__printthemselves__differently.Python__treats 1and__0as__trueand__falselike__manyprogramming__languages,but__itsTrue__andFalse__makesBoolean__rolesmore__explicit.Although__thats__allsome__programmersmay__needto__know,let__sbriefly__revealthis__types__forgery.To__representtruth__values,Python__hasan__explicitBoolean__typecalled__bool,from__whichthe__objectspreassigned__to built-innames__Trueand__Falseare__made.That__is,True__andFalse__areinstances__of bool,which__isin__turnjust__asubclass__(inthe__object-oriented sense)of__the built-ininteger__type int.True__andFalse__behaveexactly__likethe__integers 1and__0,except__thatthey__havecustomized__printinglogic__theyprint__themselvesas__thewords__Trueand__False,instead__ofthe__digits 1and__0.bool__accomplishesthis__byredefining__strand__reprstring__formats (introducedearlier__inthis__chapter)for__itstwo__objects,and__alllogical__testsyield__Trueor__Falsefor__their results.Because__ofthis__customization,Boolean__expressionstyped__atthe__interactiveprompt__printresults__asthe__wordsTrue__andFalse__insteadof__theless__obvious 1and__0.In__addition,Booleans__maketruth__valuesmore__apparentin__your code.For__instance,an__infiniteloop__canbe__codedas__while True:instead__ofthe__lessintuitive__while 1:,and__flagscan__beinitialized__moreclearly__withflag__= False.We__lldiscuss__thesestatements__furtherin__Part III. Again, though,for__mostpractical__purposes,you__cantreat__Trueand__Falseas__thoughthey__arepredefined__variablesset__tointegers__1and__0.This__implementationcan__leadto__curious results, though;because__Trueis__justthe__integer 1with__acustom__display format,True__+ 4yields__integer 5in__Python: >>> type(True) #True__isa__bool >>> isinstance(True, int) #As__wellas__anint__True >>>True__== 1 #Same__valueTrue__>>>True__is 1 #But__adifferent__object:see__thenext__chapter!False__>>>True__orFalse__#Same__as: 1or__0True__>>>True__+ 4 # (Hmmm) 5Since__youprobably__wont__comeacross__anexpression__likethe__lastof__thesein__realPython__code,you__cansafely__ignoreany__ofits__deepermetaphysical__implications.We__llrevisit__Booleansin__Chapter 9to__definePython__snotion__of truth,and__againin__Chapter 12to__seehow__Booleanoperators__likeand__andor__work.Numeric__Extensions Finally,although__Pythons__corenumeric__objectsoffer__plentyof__powerfor__most applications,a__largecatalog__of third-partyopen__sourceextensions__isavailable__toaddress__morefocused__numeric needs.We__surveyedtools__inthis__domainin__Chapter 1s__sectionWhat__CanI__Dowith__Python?In__short,there__isa__now-commonstack__oftools__foradvanced__numericcoding__inPython__today,including__NumPy, SciPy, pandas, matplotlib, Jupyter,and__more,and__additionaltools__addresssubdomains__like statistics, astronomy,and__AI.This__toolkitis__usedby__research organizations,financial__entities,and__aerospacegroups__aroundthe__world,and__performsthe__sortof__tasksformerly__codedin__languageslike__C++or__Fortran.Many__whowork__inthis__fieldliken__thecombination__ofPython__plusnumeric__extensionsto__a free, flexible,and__powerfulalternative__tosystems__like MATLAB.Though__apopular__andexciting__domain,Python__numericprogramming__isjust__oneway__touse__thelanguage__(Pythonweb__development,for__example,is__similarly sized)and__iseasily__richenough__tofill__entirebooks__by itself. Hence,this__bookdoesn__tcover__numericextensions__andfocuses__insteadon__teachingyou__thePython__languagethat__sused__inevery__domain.Once__youve__learnedPython__itself,you__llfind__copiousresources__for add-onsboth__onthe__weband__atbook__outletsnear__youwhen__youre__readyto__level up.Chapter__SummaryThis__chapterhas__touredPython__snumeric__objecttypes__andthe__operationswe__canapply__to them.Along__the way,we__metthe__trustyinteger__and floating-point objects,as__wellas__somemore__exoticand__lesscommonly__usedtypes__suchas__complex numbers, decimals, fractions,and__sets.We__alsoexplored__Pythons__expression syntax,type__conversions,bitwise__operations,and__variousliteral__formsfor__codingnumbers__in scripts.Later__inthis__partof__the book,we__llcontinue__our in-depthobject__tourby__fillingin__detailsabout__thenext__objecttype__the string.In__thenext__chapter, however,we__lltake__sometime__toexplore__themechanics__ofvariable__assignmentin__moredetail__thanwe__have here.This__turnsout__tobe__perhapsthe__mostfundamental__ideain__Python,so__makesure__youcheck__outthe__nextchapter__beforemoving__on. First, though,it__stime__totake__theusual__chapter quiz.Test__Your Knowledge:Quiz__1.What__isthe__valueof__theexpression__2 * (3 + 4)in__Python,and__why? 2.What__isthe__valueof__theexpression__2 * 3 + 4in__Python,and__why? 3.What__isthe__valueof__theexpression__2 + 3 * 4in__Python,and__why? 4.What__toolscan__youuse__tofind__anumber__ssquare__root,as__wellas__its square? 5.What__isthe__typeof__theresult__ofthe__expression 1 + 2.0 + 3,and__why? 6.How__canyou__truncateand__rounda__floating-point number? 7.How__canyou__convertan__integerto__a floating-point number? 8.How__wouldyou__displayan__integerin__octal, hexadecimal,or__binary notation? 9.How__mightyou__convertan__octal, hexadecimal,or__binarystring__toa__plain integer?Test__Your Knowledge:Answers__1.The__valuewill__be 14,the__resultof__2 * 7,because__theparentheses__forcethe__additionto__happenbefore__the multiplication. 2.The__valuewill__be 10,the__resultof__6 + 4.Python__soperator__precedencerules__areapplied__inthe__absenceof__parentheses,and__multiplicationhas__higherprecedence__than (i.e.,happens__before) addition,per__Table 5-2. 3.This__expressionyields__14,the__resultof__2 + 12,for__thesame__precedencereasons__asin__theprior__question. 4.Functions__forobtaining__thesquare__root,as__wellas__pi, tangents,and__more,are__availablein__theimported__math module.To__finda__numbers__square root,import__mathand__call math.sqrt(N).To__geta__numbers__square,use__eitherthe__exponentexpression__X ** 2or__the built-infunction__pow(X, 2).Either__ofthese__lasttwo__canalso__computethe__squareroot__whengiven__apower__of 0.5 (e.g.,X__** .5). 5.The__resultwill__bea__floating-point number:the__integersare__convertedup__tofloating__point,the__mostcomplex__typein__the expression,and__floating-point__mathis__usedto__evaluate it. 6.The__int(N)and__math.trunc(N)functions__truncate,and__the round(N, digits)function__rounds.We__canalso__computethe__floorwith__math.floor(N)and__roundfor__displaywith__string-formatting operations. 7.The__float(I)function__convertsan__integerto__afloating__point;mixing__aninteger__witha__floatingpoint__withinan__expressionwill__resultin__aconversion__as well.In__some sense,Python__/true__divisionconverts__tooit__alwaysreturns__a floating-pointresult__thatincludes__the remainder,even__ifboth__operandsare__integers. 8.The__oct(I), hex(I),and__bin(I) built-infunctions__returnthe__octal, hexadecimal,and__binarystring__formsfor__an integer.All__threeflavors__ofstring__formatting (expression, method,and__f-string)also__providetargets__forsome__such conversions. 9.The__int(S, base)function__canbe__usedto__convertfrom__octal, hexadecimal,and__binarydigit__stringsto__normalintegers__(passin__8, 16,or__2for__the base).The__eval(S)function__canbe__usedfor__thispurpose__too,but__its__moreexpensive__torun__andcan__havesecurity__risks.To__some extent, other-baseliterals__like 0xFFFFand__0b1111in__yourcode__dothis__worktoo__whenread__by Python.Note__thatintegers__arealways__storedin__binaryform__incomputer__memory;these__arejust__displaystring__format conversions.Chapter__6.The__DynamicTyping__InterludeIn__theprior__chapter,we__beganexploring__Pythons__coreobject__typesin__depthby__studyingPython__numbersand__their operations.We__llresume__ourobject__typetour__inthe__next chapter,but__beforewe__move on,it__simportant__thatyou__geta__handleon__whatmay__bethe__mostfundamental__ideain__Pythonprogramming__andis__certainlythe__basisof__muchof__boththe__concisenessand__flexibilityof__thePython__language:dynamic__typing,and__thepolymorphism__it implies.As__youll__seehere__andthroughout__this book,in__Python,we__donot__needto__declarethe__specifictypes__ofthe__objectsour__scripts use.In__fact,most__programsshould__notcare__aboutspecific__typeson__purpose.By__avoidingconstraints__this way,code__naturallyworks__inmany__contextsand__oftenmore__than expected.Because__dynamictyping__isthe__rootof__this flexibility,and__isalso__apotential__stumblingblock__for newcomers,let__stake__abrief__sidetrip__toexplore__themodel__here.At__theend__ofthe__trip,we__llalso__makea__shortstop__atthe__paradoxof__type hinting,to__learnwhy__youshould__avoid it.The__Caseof__theMissing__DeclarationStatements__Ifyou__havea__backgroundin__staticallytyped__languageslike__C, C++,or__Java,you__mightfind__yourselfa__bitperplexed__atthis__pointin__the book.So__far,we__vebeen__usingvariables__withoutdeclaring__theirexistence__ortheir__types,and__itsomehow__works.When__wetype__a = 3in__aninteractive__sessionor__program file,for__instance,how__doesPython__knowthat__ashould__standfor__an integer?For__that matter,how__doesPython__knowwhat__ais__at all?Once__youstart__askingsuch__questions,you__vecrossed__overinto__thedomain__ofPython__sdynamic__typing model.In__Python,types__aredetermined__automaticallyat__runtime (dynamically__),not__inresponse__todeclarations__addedto__codeahead__oftime__(statically__).This__meansthat__younever__needto__declarevariables__aconcept__thatmay__besimpler__tograsp__ifyou__keepin__mindthat__itall__boilsdown__to variables, objects,and__thelinks__between them,as__thenext__section explains. Variables, Objects,and__ReferencesAs__youve__seenin__manyof__theexamples__usedso__farin__this book,when__yourun__anassignment__statementsuch__asa__= 3in__Python,it__workseven__ifyou__venever__toldPython__touse__thename__aas__a variable,or__thata__shouldstand__foran__integer-type__object.In__thePython__language,this__allpans__outin__avery__natural way,as__follows:Variable__creationA__variable (alsoknown__inPython__asa__name),like__a,is__createdwhen__yourcode__firstassigns__ita__value.Future__assignmentschange__thevalue__ofthe__alreadycreated__name. Technically,Python__detectssome__namesbefore__yourcode__runs (e.g.,locals__in functions),but__youcan__thinkof__itas__thoughinitial__assignmentsmake__variables.Variable__typesA__variableitself__neverhas__anytype__informationor__constraintsassociated__with it.In__Python,the__notionof__typelives__with objects,not__names.Variables__aregeneric__in nature;they__alwayssimply__referto__aparticular__objectat__aparticular__pointin__time.Variable__useWhen__avariable__appearsin__an expression,it__isimmediately__replacedwith__theobject__thatit__currentlyrefers__to,whatever__thatmay__be. Further,all__variablesmust__beexplicitly__assignedbefore__theycan__be used;referencing__unassignedvariables__resultsin__errors.In__sum,variables__arecreated__when assigned,can__referenceany__typeof__object,and__mustbe__assignedbefore__theyare__referenced.This__meansthat__younever__needto__declarenames__usedby__your script,but__youmust__initializenames__beforeyou__canupdate__them; counters,for__example,must__beinitialized__tozero__beforeyou__canadd__to them.This__dynamictyping__modelis__strikinglydifferent__fromthe__typingmodel__oftraditional__languages.When__youare__firststarting__out,the__modelis__usuallyeasier__tounderstand__ifyou__keepclear__thedistinction__betweennames__and objects.For__example,when__wesay__thisto__assigna__variablea__valuein__aPython__REPLor__script: >>>a__= 3 #Assign__aname__toan__objectat__least conceptually,Python__willperform__threedistinct__stepsto__carryout__the request.These__stepsreflect__theoperation__ofall__assignmentsin__thePython__language: 1.Create__anobject__torepresent__thevalue__3. 2.Create__thevariable__a,if__itdoes__notyet__exist. 3.Link__thevariable__ato__thenew__object 3.The__netresult__willbe__astructure__insidePython__thatresembles__Figure 6-1.As__sketched,variables__andobjects__arestored__indifferent__partsof__memoryand__areassociated__bylinks__(thelink__isshown__asa__pointerin__the figure).Variables__alwayslink__toobjects__andnever__toother__variables,but__largerobjects__maylink__toother__objects (for instance,a__listobject__haslinks__tothe__objectsit__contains).Figure__6-1.Names__(a.k.a. variables)and__objectsafter__runningthe__assignmenta__= 3These__linksfrom__variablesto__objectsare__calledreferences__inPython__akind__of association,implemented__asan__objects__addressin__memory.Whenever__variablesare__laterused__(i.e., referenced),Python__automaticallyfollows__the variable-to-object__links.This__isall__simplerthan__theterminology__may imply.In__concrete terms:Variables__arenamed__entriesin__asystem__table,with__spacesfor__linksto__objects.Objects__arepieces__ofallocated__memory,with__enoughspace__torepresent__thevalues__forwhich__they stand.References__areautomatically__followedpointers__fromvariables__to objects.At__least conceptually,each__timeyou__generatea__newvalue__inyour__scriptby__runningan__expression,Python__createsa__newobject__(i.e.,a__chunkof__memory)to__representthat__value.As__an optimization,Python__internallycaches__andreuses__certainkinds__ofunchangeable__objects,such__assmall__integersand__strings (each 0is__notreally__anew__pieceof__memorymore__onthis__cachingbehavior__later).But__froma__logical perspective,it__worksas__thougheach__expressions__resultvalue__isa__distinctobject__andeach__objectis__adistinct__pieceof__memory.Technically__speaking,objects__havemore__structurethan__justenough__spaceto__representtheir__values.Each__objectalso__hastwo__standardheader__fields:a__typedesignator__usedto__markthe__typeof__the object,and__areference__counterused__todetermine__whenit__sOK__toreclaim__the object.To__understandhow__thesetwo__headerfields__factorinto__the model,we__needto__move on.PYTHON__REFERENCESFOR__CPROGRAMMERS__Readerswith__abackground__inC__mayfind__Pythonreferences__similarto__Cpointers__(i.e.,memory__addresses).In__fact,references__areimplemented__aspointers__byCPython__internally,and__theyoften__servethe__same roles,especially__withobjects__thatcan__bechanged__inplace__(moreon__this later).Because__referencesare__alwaysautomatically__dereferencedwhen__used, though,you__cannever__actuallydo__anythinguseful__witha__reference itself.As__noted ahead,the__referencedobject__saddress__maybe__returnedby__theid__built-in__asa__unique ID,but__eventhis__isnt__guaranteed:see__Pythons__manuals.This__lackof__pointersavoids__anentire__categoryof__notoriousC__bugs.But__youcan__thinkof__Pythonreferences__asC__void*pointers__thatare__automaticallyfollowed__when used,without__goingtoo__faroff__base.Types__Livewith__Objects,Not__VariablesTo__seehow__objecttypes__comeinto__play,watch__whathappens__ifwe__assigna__variablemultiple__times: >>>a__= 3 # It'san__integer >>>a__= 'hack' #Now__it'sa__string >>>a__= 1.23 #Now__it'sa__floatingpoint__Thisisn__ttypical__Python code,but__itdoes__worka__startsout__asan__integer,then__becomesa__string,and__finallybecomes__a floating-point number.This__exampletends__tolook__especiallyodd__to ex-C programmers,as__itappears__asthough__thetype__ofa__changesfrom__integerto__stringwhen__wesay__a = 'hack'. However,that__snot__reallywhat__s happening.In__Python,things__workmore__simply.Names__haveno__types;as__stated earlier,types__livewith__objects,not__names.In__thepreceding__listing,we__vesimply__changeda__toreference__different objects.Because__variableshave__no type,we__havent__actuallychanged__thetype__ofthe__variable a;we__vesimply__madethe__variablereference__adifferent__typeof__object.In__fact, again,all__wecan__eversay__abouta__variablein__Pythonis__thatit__referencesa__particularobject__ata__particularpoint__in time. Objects,on__theother__hand,know__whattype__theyare__eachobject__containsa__headerfield__thattags__theobject__withits__type.The__integerobject__3,for__example,will__containthe__value 3,plus__adesignator__thattells__Pythonthat__theobject__isan__integer (strictly speaking,a__pointerto__anobject__called int,the__nameof__theinteger__type).The__typedesignator__ofthe__'hack'string__objectpoints__tothe__stringtype__(called str) instead,and__1.23points__to float.Because__objectsknow__their types,variables__dont__have to.To__recap,types__areassociated__withobjects__in Python,not__with variables.In__typical code,a__givenvariable__usuallywill__referencejust__onekind__of object.Because__thisisn__ta__requirement, though,you__llfind__thatPython__codetends__tobe__muchmore__flexiblethan__youmay__beaccustomed__toif__youuse__Python well,your__codemight__workon__manytypes__automatically.As__mentioned,objects__havetwo__header fields,a__typedesignator__anda__reference counter.To__understandthe__latterof__these,we__needto__moveon__andtake__abrief__lookat__whathappens__atthe__endof__anobject__s life.Objects__Are Garbage-CollectedIn__theprior__sections__listings,we__assignedthe__variablea__todifferent__typesof__objectsin__each assignment.But__whenwe__reassigna__variable,what__happensto__thevalue__itwas__previously referencing?For__example,after__thefollowing__statements,what__happensto__theobject__3? >>>a__= 3 >>>a__= 'text'The__answeris__thatin__Python,whenever__aname__isassigned__toa__new object,the__spaceheld__bythe__priorobject__isreclaimed__ifit__isnot__referencedby__anyother__nameor__object.This__automaticreclamation__ofobjects__spaceis__knownas__garbagecollection__andmakes__lifemuch__simplerfor__programmersof__languageslike__Pythonthat__support it.To__illustrate,consider__thefollowing__example,which__setsthe__namex__toa__differentobject__oneach__assignment: >>>x__= 99 >>>x__= 'Python' #Reclaim__99now__(unlessreferenced__elsewhere) >>>x__= 3.1415 #Reclaim__'Python'now__(ditto) >>>x__= [1, 2, 3] #Reclaim__3.1415now__(ditto) First,notice__thatx__isset__toa__differenttype__ofobject__each time. Again,the__effectis__asthough__thetype__ofx__ischanging__over time,but__thisis__notreally__the case. Remember,in__Pythontypes__livewith__objects,not__names.Because__namesare__justgeneric__referencesto__objects,this__sortof__codeworks__naturally. Second,notice__thatreferences__toobjects__arediscarded__alongthe__way.Each__timex__isassigned__toa__new object,Python__reclaimsthe__priorobject__s space.For__instance,when__itis__assignedthe__string 'Python',the__object 99is__immediatelyreclaimed__(assumingit__isnot__referencedanywhere__else)that__is,the__objects__spaceis__automaticallythrown__backinto__thefree__space pool,to__bereused__fora__future object. Internally,Python__accomplishesthis__featby__keepinga__counterin__everyobject__thatkeeps__trackof__thenumber__ofreferences__currentlypointing__tothat__object.As__soonas__andexactly__whenthis__counterdrops__to zero,the__objects__memoryspace__isautomatically__reclaimed.In__thepreceding__listing,we__reassuming__thateach__timex__isassigned__toa__new object,the__priorobject__sreference__counterdrops__to zero,causing__itto__be reclaimed.The__mostimmediately__tangiblebenefit__ofgarbage__collectionis__thatit__meansyou__canuse__objectsliberally__withoutever__needingto__allocateor__freeup__spacein__your script.Python__willmake__objectsclean__uptheir__unusedspace__foryou__asyour__program runs.In__practice,this__eliminatesa__substantialamount__ofbookkeeping__coderequired__in lower-levellanguages__suchas__Cand__C++.MORE__ONPYTHON__GARBAGECOLLECTION__Technically speaking,Python__sgarbage__collectionis__basedmainly__uponreference__counters,as__described here,but__italso__hasa__componentthat__detectsand__reclaimsobjects__withcyclic__referencesin__time.This__componentcan__bedisabled__ifyou__resure__thatyour__codedoesn__tcreate__cycles,but__itis__enabledby__default.Both__referencesand__thisoptional__componentdo__garbage collection,but__thelatter__maybe__whatusers__ofsome__otherlanguages__lackingreference__countsthink__ofas__garbage collection.Circular__referencesare__aclassic__issuein__reference-countgarbage__collectors.Because__referencesare__implementedas__pointers,it__spossible__foran__objectto__reference itself,or__referenceanother__objectthat__does.For__example,exercise__6in__TestYour__Knowledge:Part__IExercises__andits__solutionin__AppendixB__showhow__tocreate__acycle__easilyby__embeddinga__referenceto__alist__withinitself__(e.g., L.append(L)).The__samephenomenon__canoccur__forassignments__toattributes__ofobjects__createdfrom__user-defined classes.Though__relatively rare,because__thereference__countsfor__suchobjects__neverdrop__to zero,they__mustbe__treated specially.For__moredetails__onPython__scycle__detectorand__collector,see__thedocumentation__forthe__gcmodule__inPython__slibrary__manual.The__besttakeaway__hereis__that garbage-collection-basedmemory__managementis__implementedfor__youin__Python,by__peoplehighly__skilledat__the task;it__works well,even__for cycles.Also__notethat__thischapter__sdescription__ofPython__sgarbage__collectoris__notpart__ofthe__languages__definitionand__appliesto__thestandard__implementationof__Python (a.k.a. CPython) only.Chapter__2s__alternativeimplementations__suchas__Jython, IronPython,and__PyPymay__usedifferent__schemes,though__thenet__effectin__allis__similarunused__spaceis__reclaimedfor__you automatically,if__notalways__as immediately.Shared__ReferencesSo__far,we__veexplored__whathappens__asa__singlevariable__isassigned__referencesto__objects.Now__lets__introduceanother__variableinto__ourinteraction__andwatch__whathappens__toits__namesand__objects: >>>a__= 3 >>>b__=a__Typingthese__twostatements__generatesthe__scenecaptured__inFigure__6-2.The__secondcommand__causesPython__tocreate__thevariable__b;the__variablea__isbeing__usedand__notassigned__here,so__itis__replacedwith__theobject__itreferences__(3),and__bis__madeto__referencethat__object.The__neteffect__isthat__thevariables__aand__bwind__upreferencing__thesame__objectthat__is,pointing__tothe__samechunk__of memory.Figure__6-2.Names__andobjects__afternext__runningthe__assignmentb__=a__Thisscenario__inPython__withmultiple__namesreferencing__thesame__objectis__usuallycalled__ashared__reference (andsometimes__andperhaps__more accurately,shared__object).Note__thatthe__namesa__andb__arenot__linkedto__eachother__directlywhen__this happens;in__fact,there__isno__wayto__everlink__avariable__toanother__variablein__Python. Rather,both__variablespoint__tothe__sameobject__viatheir__references. Next,suppose__weextend__thesession__withone__more statement: >>>a__= 3 >>>b__=a__>>>a__= 'hack'As__withall__Python assignments,this__statementsimply__makesa__newobject__torepresent__thestring__value 'hack'and__setsa__toreference__thisnew__object.It__does not, however,change__thevalue__of b;b__stillreferences__theoriginal__object,the__integer 3.The__resultingreference__structureis__shownin__Figure 6-3.Figure__6-3.Names__andobjects__afterfinally__runningthe__assignmenta__= 'hack'The__samesort__ofthing__wouldhappen__ifwe__changedb__to 'hack'instead__theassignment__wouldchange__only b,not__a.This__behavioralso__occursif__thereare__notype__differencesat__all.For__example,consider__thesethree__statements: >>>a__= 3 >>>b__=a__>>>a__=a__+ 2In__this sequence,the__sameevents__transpire.Python__makesthe__variablea__referencethe__object 3and__makesb__referencethe__sameobject__as a,as__inFigure__6- 2;as__before,the__lastassignment__thensets__ato__acompletely__differentobject__(inthis__case,the__integer 5,which__isthe__resultof__the + expression).It__doesnot__changeb__asa__side effect.In__fact,there__isno__wayto__everoverwrite__thevalue__ofthe__object 3as__introducedin__Chapter 4,integers__areimmutable__andthus__cannever__bechanged__inplace__(seewhy__thisstuff__matters?).All__wecan__everdo__ismake__anew__integer object.One__wayto__thinkof__thisis__that,unlike__insome__languages,variables__inPython__arealways__pointersto__objects,not__labelsof__changeablememory__areas:setting__avariable__toa__newvalue__doesnot__alterthe__original object,but__rathercauses__thevariable__toreference__anentirely__different object.The__neteffect__isthat__assignmentto__avariable__itselfcan__impactonly__thesingle__variablebeing__assigned.When__mutableobjects__and in-placechanges__enterthe__equation, though,the__picturechanges__somewhat;to__see how,let__smove__on.Shared__Referencesand__In-PlaceChanges__Asyou__lllearn__morein__thispart__supcoming__chapters,some__operationsdo__changeobjects__in place,but__theyre__onlysupported__byPython__smutable__typesincluding__lists, dictionaries,and__sets.For__instance,an__assignmentto__anoffset__ina__listactually__changesthe__listobject__itselfin__place,rather__thangenerating__a brand-newlist__object.Though__youmust__takeit__somewhaton__faithat__thispoint__inthe__book,this__distinctioncan__mattermuch__inyour__programs.For__objectsthat__supportsuch__in-place__changes,you__needto__bemore__awareof__shared references,since__achange__fromone__namemay__impact others. Otherwise,your__objectsmay__seemto__changefor__noapparent__reason.Given__thatall__assignmentsare__basedon__references (includingfunction__argument passing),it__sa__pervasive phenomenon.To__illustrate,let__stake__anotherlook__atthe__listobjects__introducedin__Chapter 4.Recall__that lists,which__dosupport__in-placeassignments__to positions,are__simplycollections__ofother__objects,coded__insquare__brackets: >>> L1 = [2, 3, 4] >>> L2 = L1 L1here__isa__listcontaining__theobjects__2, 3,and__4.Items__insidea__listare__accessedby__theirpositional__offsets,so__L1[0]refers__toobject__2,the__firstitem__inthe__list L1.Of__course,lists__arealso__objectsin__theirown__right,just__likeintegers__and strings.After__runningthe__twoprior__assignments, L1and__L2reference__thesame__shared object,just__likea__andb__inthe__priorexample__(seeFigure__6-2).Now__imagine that,as__before,we__extendthis__interactionto__saythe__following: >>> L1 = 24This__assignmentsimply__sets L1to__adifferent__object; L2still__referencesthe__originallist__muchas__inthe__preceding section.If__wechange__thisstatement__ssyntax__slightly, however,it__changesits__effect radically: >>> L1 = [2, 3, 4] #A__mutableobject__>>> L2 = L1 #Make__areference__tothe__sameobject__>>> L1[0] = 24 #An__in-placechange__>>> L1 # L1is__different [24, 3, 4] >>> L2 #But__sois__L2! [24, 3, 4] Really,we__havent__changed L1itself__atline__three here;we__vechanged__acomponent__ofthe__objectthat__L1 references.This__sortof__changeoverwrites__partof__thelist__objects__valuein__place.Because__thelist__objectis__sharedby__(referenced from)other__variables, though,an__in-placechange__likethis__doesnt__affectonly__L1that__is,you__mustbe__awarethat__whenyou__makesuch__changes,they__canimpact__otherparts__ofyour__program.In__this example,the__effectshows__upin__L2as__wellbecause__itreferences__thesame__objectas__L1. Again,we__havent__actuallychanged__L2, either,but__itsvalue__willappear__differentbecause__itrefers__toan__objectthat__hasbeen__overwrittenin__place.This__behavioroccurs__onlyfor__mutableobjects__thatsupport__in-placechanges__andis__usuallywhat__you want,but__youshould__beaware__ofhow__itworks__sothat__its__expected.It__salso__justthe__default:if__youdon__twant__such behavior,you__canrequest__thatPython__copyobjects__insteadof__making references.There__area__varietyof__waysto__copya__list,including__usingthe__built-inlist__function,the__listcopy__method,and__the standard-librarycopy__module.Perhaps__themost__commonway__isto__slicefrom__startto__finish (seeChapters__4and__7for__moreon__slicing): >>> L1 = [2, 3, 4] >>> L2 = L1[:] #Make__acopy__of L1 (or list(L1), L1.copy(), etc.) >>> L1[0] = 24 >>> L1 [24, 3, 4] >>> L2 # L2is__notchanged__this time:different__objects [2, 3, 4] Here,the__changemade__through L1is__notreflected__in L2because__L2references__acopy__ofthe__object L1 references,not__the original;that__is,the__twovariables__pointto__differentobjects__anddifferent__piecesof__memory.Note__thatthis__slicingtechnique__wont__workon__theother__majormutable__core types,dictionaries__and sets,because__theyare__notsequences__tocopy__adictionary__or set,instead__usetheir__X.copy()method__call (listshave__one too),or__passthe__originalobject__totheir__type names,dict__and set. Also,note__thatthe__standard-librarycopy__modulehas__acall__forcopying__anyobject__type generically,as__wellas__acall__forcopying__nestedobject__structuresa__dictionarywith__nested lists,for__example:import__copyX__= copy.copy(Y) #Make__top-level "shallow"copy__ofany__objectY__X = copy.deepcopy(Y) #Make__deepcopy__ofany__object Y:copy__allnested__partsWe__llexplore__listsand__dictionariesin__more depth,and__revisitthe__conceptof__sharedreferences__and copies,in__Chapters 8and__9.For__now,keep__inmind__thatobjects__thatcan__bechanged__inplace__that is,mutable__objectsare__alwaysopen__tothese__kindsof__effectsin__anycode__theypass__through.In__Python,this__includes lists, dictionaries, sets,and__someobjects__definedwith__class statements.If__thisis__notdesired__behavior,simply__copyyour__objectsas__needed.Shared__Referencesand__EqualityIn__theinterest__offull__disclosure,it__sworth__pointingout__thatthe__garbage-collection__behaviordescribed__earlierin__thischapter__maybe__moreconceptual__thanliteral__forcertain__types.Consider__these statements: >>>x__= 99 >>>x__= 'Python' #Reclaim__99 now?Because__Pythoncaches__andreuses__smallintegers__andsmall__strings,as__mentioned earlier,the__object 99here__isprobably__notliterally__reclaimed; instead,it__willlikely__remainin__asystem__tableto__bereused__thenext__timeyou__generatea__99in__your code.Most__kindsof__objects, though,are__reclaimedimmediately__whenthey__areno__longer referenced;for__thosethat__are not,the__cachingmechanism__isirrelevant__toyour__codeunless__youuse__atypical tools.For__instance,because__ofPython__sreference__model,there__aretwo__differentways__tocheck__forequality__ina__Python program.Let__screate__ashared__referenceto__demonstrate: >>>L__= [1, 2, 3] >>>M__=L__#Make__Mand__Lreference__thesame__object >>>L__==M__#Same__valuesTrue__>>>L__isM__#Same__objectsTrue__Thefirst__technique here,the__== operator,tests__whetherthe__tworeferenced__objectshave__thesame__values;this__isthe__methodalmost__alwaysused__forequality__checksin__Python.The__second method,the__is operator,instead__testsfor__objectidentity__itreturns__Trueonly__ifboth__namespoint__tothe__exactsame__object,so__itis__amuch__strongerform__ofequality__testingand__israrely__appliedin__mostprograms__(exceptfor__single-instanceobjects__like None, True,and__False,as__inthe__prior chapter). Really,is__simplycompares__thepointers__thatimplement__references,and__itserves__asa__wayto__detectshared__referencesin__yourcode__if needed.It__returnsFalse__ifthe__namespoint__toequivalent__butdifferent__objects,as__isthe__casewhen__werun__twodifferent__literal expressions: >>>L__= [1, 2, 3] >>>M__= [1, 2, 3] #Make__Mand__Lreference__differentobjects__>>>L__==M__#Same__valuesTrue__>>>L__isM__#Different__objectsFalse__Butnow__watchwhat__happenswhen__weperform__thesame__operationson__animmutable__objectlike__an integer: >>>X__= 99 >>>Y__= 99 #Should__betwo__differentobjects__>>>X__==Y__True >>>X__isY__#Same__object anyhow:caching__at work!True__Inthis__interaction,X__andY__shouldbe__== (same value),but__notis__(same object)because__weran__twodifferent__literalexpressions__(99).Because__someintegers__andstrings__arecached__and reused, though,is__tellsus__theyreference__thesame__single object.If__youreally__wantto__lookunder__the hood,the__id built-inis__anotherway__tocheck__objectidentities__(andmay__ormay__notreturn__anobject__saddress__in memory);and__thegetrefcount__functionin__thestandard__sysmodule__returnsthe__passedobject__sreference__count.As__ofPython__3.12, however,the__latteris__notas__interestingas__itonce__was,because__itreturns__avery__highcount__forobjects__consideredto__beimmortal__whichin__Pythonjust__meanscached__for reuse: >>>import__sys >>> sys.getrefcount(99) # 99is__immortal (cached) 4294967295 >>> sys.getrefcount(2 ** 1000) #But__thisis__not 1 >>> id(99) == id(99) #Same__ID/sameobject__(address?)True__Thisobject__cachingand__reuseis__irrelevantto__yourcode__(unlessyou__runthe__is check!).Because__youcannot__changeimmutable__numbersor__stringsin__place,it__doesnt__matterhow__manyreferences__thereare__tothe__sameobject__everyreference__willalways__seethe__same,unchanging__valueeven__ifthey__allreference__thesame__cached object. Still,this__behaviorreflects__oneof__themany__waysPython__optimizesits__modelfor__execution speed.Dynamic__TypingIs__EverywhereOf__course,you__dont__reallyneed__todraw__name/objectdiagrams__withcircles__andarrows__touse__Python.When__youre__starting out, though,it__sometimeshelps__youunderstand__unusualcases__ifyou__cantrace__theirreference__structuresas__weve__done here.If__amutable__objectchanges__outfrom__underyou__whenpassed__aroundyour__program,for__example,chances__areyou__arewitnessing__someof__thischapter__ssubject__matter firsthand. Moreover,even__ifdynamic__typingseems__alittle__abstractat__this point,you__probablywill__careabout__it eventually.Because__everythingseems__towork__byassignment__andreferences__in Python,a__basicunderstanding__ofthis__modelis__usefulin__manydifferent__contexts.As__youll__see,it__worksthe__samein__assignment statements,function__arguments,for__loop variables,module__imports,class__attributes,and__more.The__goodnews__isthat__thereis__justone__assignmentmodel__in Python;once__youget__ahandle__ondynamic__typing,you__llfind__thatit__worksthe__sameeverywhere__inthe__language.At__themost__practical level,dynamic__typingmeans__thereis__lesscode__foryou__to write.Just__as importantly, though,dynamic__typingis__alsothe__rootof__Pythons__polymorphism,a__conceptintroduced__inChapter__4that__well__revisitagain__laterin__this book.Because__wedo__notconstrain__typesin__Python code,it__isboth__conciseand__highly flexible.As__youll__see,when__used well,dynamic__typingand__thepolymorphism__itimplies__producescode__thatautomatically__adaptsto__newrequirements__asyour__systems evolve.Type__Hinting: Optional, Unused,and__Why? Finally,an__implausibleplot__twist.If__youve__readPython__codewritten__inrecent__years,you__mayhave__stumbledacross__sometype__declarationsfor__variablenames__thatlook__likethe__followingand__seemcurious__andout__ofplace__fora__dynamicallytyped__languagelike__Python,and__atfirst__glancecontradictory__tosome__ofthis__chapters__claims: >>> a:int__>>> b:int__= 0 >>> c: list[int] = [1, 2, 3]As__previewedin__Chapter 4,this__isknown__astype__hinting. Syntactically,it__takesthe__formof__acolon__andobject__type,between__avariable__andan__optional assignment.The__objecttype__canbe__aname__oran__expressionto__denotecollections__(list[int]means__alist__of integers)and__canuse__namespredefined__inthe__standard-librarytyping__module (e.g., Iterable, Union,and__Any)to__expressricher__typesper__elaborate theory.As__ofPython__3.12,a__newtype__statementcan__evendefine__typealiases__touse__in hints,though__simpleassignments__thatpredated__itcan__too: >>>type__Data = list[float] >>>Data__= list[float]As__alsonoted__inChapter__4, though,type__hintsare__optional, unused,and__largely academic.Python__doesnot__requirethem__anddoes__notuse__themin__anyway__andhas__nointentions__ofever__doing so.They__aremeant__solelyfor__usein__third-partytools__liketype__checkers,and__asa__formof__documentationthat__san__alternativeto__code comments.You__cansay__thesame__thingsmore__simplyin__both #comments__anddocumentation__stringsyou__llmeet__later.Even__when used,type__hintsdo__notconstrain__yourcode__stypes__inany__way.The__precedingtype__hintfor__a,for__instance,does__notcreate__namea__(onlyassignment__does),and__bs__andc__shints__arenot__enforcedin__the least: >>>a__NameError:name__'a'is__notdefined__>>>b__= 'hack' >>>c__= 'code' >>> b,c__('hack', 'code')Type__hintscan__alsoappear__indefinitions__offunctions__(andclass__methods)to__documenttypes__ofparameters__and results,commandeering__anearlier__featureknown__asfunction__annotations.We__havent__coveredthese__yet,but__asa__preview,the__followingfunction__hintsthat__itaccepts__aninteger__andlist__ofstrings__andreturns__afloat__extraneousinfo__thatshows__upin____annotations__dictionaries__ofhosting__objects: >>>def__func(a: int, b: list[str]) -> float:return__'anything' +a__+b__Yetas__forsimple__variables,these__hintsare__fully unused,and__anythinggoes__whenthis__functionis__actually run. Strings,for__example,work__finefor__bothinputs__and outputs,despite__theseemingly__rigid hints: >>> func('You', 'Want') 'anythingYouWant'That__is,type__hintingis__aconceptually__heavytool__adoptedby__Pythonbut__completelyunused__by Python.It__sat__bestjust__anotherform__ofdocumentation__inPython__itself,albeit__onethat__comeswith__complex rules.External__toolsmight__usetype__hintsto__checkfor__typemismatches__(e.g., mypy)or__boost performance,but__suchtools__arealso__optional, uncommon,and__whollyseparate__fromthe__Python language. Furthermore,programs__requireruntime__testingin__any language,and__optimizedPythons__introducedin__Chapter 2do__notuse__typehints__today,and__insome__casescannot__(see PyPy).More__tothe__point, though,type__hintingis__alsocompletely__atodds__withPython__score__notionof__dynamic typing.Type__declarationsin__adynamically__typedlanguage__area__pointlessparadox__thatnegates__muchof__Pythons__value proposition.Teaching__thisbizarre__extensionto__Pythonlearners__wouldbe__adisservice__toboth__Pythonand__learners. Hence,this__bookrecommends__thatbeginners__avoidtype__hintingat__leastuntil__theyare__comfortablewith__Pythons__dynamic-typing paradigm.This__bookalso__wont__becovering__it further,because__its__fartoo__muchextra__heftsans__benefitfor__newcomersstruggling__tomaster__Pythons__alreadysizable__fundamentals.If__andwhen__youopt__todelve__intothis__inaneyet__convolutedcorner__of Python,consult__itsdocs__formore__information.In__theend__anddespite__whatyou__maysee__inPython__codewritten__byprogrammers__comingfrom__otherlanguages__typehinting__doesnot__meanthat__Pythonis__statically typed.Python__stilluses__onlydynamic__typing,and__hopefullyalways__will.After__all,this__isthe__rootof__mostof__itsadvantages__overother__tools.Let__shope__thatPython__developersof__thefuture__learnthis__wellbefore__bloatingor__breakinga__toolused__andbeloved__by millions.Chapter__SummaryThis__chaptertook__adeeper__lookat__Pythons__dynamictyping__modelthat__is,the__waythat__Pythonkeeps__trackof__objecttypes__forus__automatically,rather__thanrequiring__usto__codedeclaration__statementsin__our scripts.Along__the way,we__learnedhow__variablesand__objectsare__associatedby__referencesin__Pythonthat__enabletype__flexibility.We__alsoexplored__thetopic__ofgarbage__collection,learned__howshared__referencesto__mutableobjects__canaffect__multiple variables,and__sawhow__referencesimpact__thenotion__ofequality__in Python. Lastly,we__brieflyglimpsed__typehinting__asubdomain__thatweirdly__addsunused__typedeclarations__toa__dynamicallytyped__language.Because__thereis__justone__assignmentmodel__in Python,and__becauseassignment__popsup__everywherein__the language,it__simportant__thatyou__havea__handleon__themodel__beforemoving__on.The__followingquiz__shouldhelp__youreview__someof__thischapter__s ideas.After__that,we__llresume__ourcore__objecttour__inthe__next chapter,with__strings.Test__Your Knowledge:Quiz__1.Consider__thefollowing__three statements.Do__theychange__thevalue__printedfor__A?A__= 'code'B__=A__B = 'Python' 2.Consider__thesethree__statements.Do__theychange__theprinted__valueof__A?A__= ['code']B__=A__B[0] = 'Python' 3.How__aboutthese__isA__changed now?A__= ['code']B__= A[:] B[0] = 'Python'Test__Your Knowledge:Answers__1. No:A__stillprints__as 'code'.When__Bis__assignedto__thestring__'Python',all__thathappens__isthat__thevariable__Bis__resetto__pointto__thenew__string object.A__andB__initiallyshare__(i.e., reference/point to)the__samesingle__stringobject__'code',but__twonames__arenever__linkedtogether__in Python. Thus,setting__Bto__adifferent__objecthas__noeffect__on A.The__samewould__betrue__ifthe__laststatement__herewere__B =B__+ 'coding',by__theway__theconcatenation__wouldmake__anew__objectfor__its result,which__wouldthen__beassigned__toB__only.We__cannever__overwritea__string (or number,or__tuple)in__place,because__stringsare__immutable. 2. Yes:A__nowprints__as ['Python']. Technically,we__havent__reallychanged__eitherA__or B; instead,we__vechanged__partof__theobject__theyboth__reference (point to)by__overwritingthat__objectin__placethrough__thevariable__B.Because__Areferences__thesame__objectas__B,the__updateis__reflectedin__A, too. 3. No:A__stillprints__as ['code'].The__in-placeassignment__throughB__hasno__effectthis__timebecause__theslice__expressionmade__acopy__ofthe__listobject__beforeit__wasassigned__to B.After__thesecond__assignment statement,there__aretwo__differentlist__objectsthat__havethe__samevalue__in Python,we__saythey__are ==,but__not is.The__thirdstatement__changesthe__valueof__thelist__objectpointed__toby__B,but__notthat__pointedto__by A.WHEN__REFERENCESARE__WEAKYou__mayoccasionally__seethe__termweak__referencein__thePython__world. No,this__termisn__ta__judgmentabout__inferiority.It__refersto__asomewhat__obscureand__advanced tool,which__isrelated__tothe__referencemodel__weve__explored here,and__likethe__is operator,can__treally__beunderstood__without it.In__short,a__weak reference,implemented__bythe__weakref standard-library module,is__areference__toan__objectthat__doesnot__byitself__preventthe__referencedobject__frombeing__garbage-collected.If__thelast__remainingreferences__toan__objectare__allweak__references,the__objectcan__be reclaimed.When__this happens,the__weakreferences__toit__willbe__notifiedthat__theobject__nolonger__existsand__canrespond__as needed.As__anexample__ofits__utility,this__canbe__usefulin__nonessentialcaches__oflarge__objectsprimarily__used elsewhere.If__sucha__cacheuses__normal references,the__caches__referencesalone__wouldkeep__theobjects__inmemory__indefinitely.By__usingweak__references,the__objects__spacemay__bereclaimed__whenit__sno__longerneeded__forits__primary role,and__thecache__willbe__notifiedof__its demise,either__onnext__fetchor__by callback.Not__allobject__typescan__beweakly__referenced,though__supportcan__beadded__forsome__withOOP__techniqueswe__wont__exploretill__laterin__this book. Still,this__isreally__justa__special-caseextension__tothe__referencemodel__wemet__here.For__moredetails__onweak__references,see__Pythons__library-manualcoverage__of weakref,a__usefulif__unhappilynamed__tool.Chapter__7.String__FundamentalsSo__far,we__vestudied__numbersand__exploredPython__sdynamic__typing model.The__nextmajor__typeon__our in-depthobject__touris__thePython__stringan__orderedcollection__ofcharacters__usedto__storeand__represent text-and__bytes-based information.We__lookedbriefly__atstrings__inChapter__4. Here,we__willrevisit__themto__fillin__detailswe__skipped earlier.Before__weget__started,let__sget__clearon__whatwe__wont__becovering__here.Chapter__4also__brieflypreviewed__Unicodestrings__andfiles__toolsfor__dealingwith__non-ASCII text.Unicode__isa__keytool__for programmers,especially__thosewho__workin__theinternet__domain.It__canpop__up,for__example,in__web pages, emails,GUI__toolkits, file-processing tools,XML__andJSON__text,and__more.At__thesame__time,Unicode__canbe__aheavy__topicfor__programmersjust__starting out,and__acomplete__understandingof__itrelies__ontools__thatwe__havent__yetstudied__in full,like__files.In__lightof__that,this__booksplits__itsstrings__coveragebetween__theessentials__here,and__theirextension__toUnicode__andbyte__stringsin__Chapter 37of__itsadvanced__topics part.That__is,this__chaptertells__onlypart__ofthe__stringstory__inPython__thepart__thatmost__scripts use,and__mostPython__learnersneed__toknow__up front.Despite__thislimited__scope,everything__welearn__herewill__applydirectly__toUnicode__andbytes__processing, too,because__Pythontext__stringsare__Unicode,even__ifthey__resimple__ASCII text,and__bytestrings__aresimply__stringsconstrained__tobyte__values.After__youve__learnedthe__basics here,Chapter__37is__recommendedreading__forthe__restof__thestring__saga,and__mostprogrammers__willwant__tofollow__upwith__itscoverage__eventually.Unicode__israrely__optionalin__programming today,though__its__bestdeferred__untilyou__vehad__achance__tomaster__stringsin__general.So__lets__get started!String__ObjectBasics__Froma__functional perspective,strings__canbe__usedto__representjust__aboutanything__thatcan__beencoded__astext__or bytes.In__thetext__department,this__includessymbols__andwords__(e.g.,your__name),contents__oftext__filesloaded__into memory,internet__addresses,Python__source code,and__so on.Strings__canalso__beused__tohold__theraw__bytesused__formedia__filesand__network transfers,and__boththe__encodedand__decodedforms__of non-ASCIIUnicode__text.You__mayhave__usedstrings__inother__languages, too.Python__sstrings__servethe__samerole__ascharacter__arraysin__languagessuch__as C,but__theyare__asomewhat__higher-leveltool__than arrays.Unlike__in C,strings__inPython__comewith__apowerful__setof__precodedprocessing__tools.Also__unlikelanguages__suchas__C,Python__hasno__distincttype__forindividual__characters; instead,you__justuse__one-character__stringsfor__one-character info.Strictly__speaking,Python__stringsare__categorizedas__immutable sequences,meaning__thatthe__charactersthey__containhave__a left-to-rightpositional__orderand__cannotbe__changedin__place.In__fact,strings__arethe__firstrepresentative__ofthe__largerclass__ofobjects__calledsequences__thatwe__willexplore__here.Pay__attentionto__thesequence__operationscovered__inthis__chapter,because__theywill__workthe__sameon__othersequence__typesyou__llmeet__later,such__aslists__and tuples.As__afirst__step,Table__7-1previews__commonstring__literalsand__operationsdiscussed__inthis__chapter,by__abstractexample__(dont__expectits__codesnippets__to run!).As__it shows,empty__stringsare__writtenas__apair__ofquotation__marks (singleor__double)with__nothingin__between,and__thereare__avariety__ofways__tocode__strings.For__processing,strings__supportexpression__operationssuch__asconcatenation__(combining strings),slicing__(extracting sections),indexing__(fetchingby__offset),and__so on.Besides__expressions,Python__alsoprovides__aset__ofstring__methodsthat__implementcommon__string-specific tasks,as__wellas__modulesfor__moreadvanced__text-processingtasks__suchas__pattern matching.Table__7-1.Common__stringliterals__andoperations__OperationInterpretation__S = ''Empty__stringS__= "app's"Double__quotes,same__assingle__S = 'c\no\td\x00e'Escape__sequencesS__= """multiline__""" Triple-quotedblock__stringsS__= r'\temp\data.txt'Raw__strings (ignore escapes)B__= b'h\xc4ck'Byte__strings (Chapter 4,Chapter__37)S__= 'py\U0001F40D'Unicode__strings (Chapter 4,Chapter__37)S__= u'py\U0001F40D'Python__2.Xcompatibility__(Chapter 37) S1 + S2S__* 3 Concatenate,repeat__S[i] S[i:j] len(S) Index, slice,length__S1 > S2, S1 == S2 Comparisons: magnitude,equality__'a %s coder' %kind__String-formattingexpression__'a {0} coder'.format(kind) String-formattingmethod__f'a {kind} coder' String-formattingliteral__(3.6+) S.find('od') S.rstrip() S.replace('od', 'ood') S.split(',') S.isdigit() S.lower() S.endswith('thon') S.join(strlist) S.encode('utf8') B.decode('latin1')String__methods (seeahead__forall__43): search,remove__whitespace, replacement,split__on delimiter,content__test,case__conversion,end__test,delimiter__join,Unicode__encoding,Unicode__decoding, etc. (seeTable__7-3) 'py'in__S.lower()for__xin__S: print(x) [c * 2for__cin__S] Membership,iteration__map(ord, S) re.match('Py(.*)on', line)Pattern__matching:library__moduleBeyond__thecore__setof__stringtools__inTable__7-1,Python__alsosupports__moreadvanced__pattern-basedstring__processingwith__thestandard__librarys__re (forregular__expression )module__demoedin__Chapter 37,and__even higher-leveltext__processingtools__suchas__HTML, JSON,and__XML parsers.This__bookand__this chapter, though,are__focusedon__thefundamentals__representedby__Table 7-1.This__chapterbegins__withan__overviewof__stringliteral__formsand__string expressions,then__moveson__tolook__atmore__advancedtools__suchas__stringmethods__and formatting.Python__comeswith__manystring__tools,and__wewon__tcover__themall__here;the__completestory__ischronicled__inthe__Pythonlibrary__manual.Our__goalhere__isto__exploreenough__commonlyused__toolsto__giveyou__arepresentative__sample;methods__wewon__tsee__inaction__hereare__analogousto__thosewe__will.String__LiteralsBy__and large,strings__arefairly__easyto__usein__Python.The__firstthing__youneed__toknow__about them, though,is__thatthere__aremany__waysto__writethem__inyour__code:Single__quotes: 'cod"e'Double__quotes: "cod'e"Triple__quotes: '''code__''', """code__"""Escape__sequences: "c\to\nd\0e"Raw__strings: r"C:\new\test.bin" (Chapter 37)Bytes__literals: b'co\x01de' (Chapter 37)Unicode__literals: 'h\u00c4ck'The__single-and__double-quotedforms__areby__farthe__most common;the__othersserve__specialized roles,and__were__postponingfurther__discussionof__thelast__twoadvanced__formsuntil__Chapter 37.Let__stake__aquick__lookat__allthe__otheroptions__in turn.Single__andDouble__QuotesAre__theSame__AroundPython__strings, single-and__double-quotecharacters__are interchangeable,though__theymust__match,and__mustbe__straightquotes__(bewaretools__thatautocorrect__toslanted__quotes!).That__is,string__literalscan__bewritten__enclosedin__eithertwo__singleor__twodouble__straightquotes__thetwo__formswork__thesame__andreturn__thesame__typeof__object.For__example,the__followingtwo__strings,coded__atthe__usual REPL,are__identicalonce__theyare__readby__Python: $ python3 >>> 'python', "python" ('python', 'python')The__reasonfor__supportingboth__isthat__itallows__youto__embeda__quotecharacter__ofthe__othervariety__insidea__stringwithout__escapingit__witha__backslash.You__mayembed__a double-quotecharacter__ina__stringenclosed__in single-quote characters,and__vice versa,without__havingto__usethe__escapesyou__llmeet__ina__moment: >>> 'python"s', "python's" #Mixed__quotessans__escapes ('python"s', "python's")This__bookgenerally__prefersto__usesingle__quotesaround__stringsjust__becausethey__aremarginally__easierto__read,except__incases__wherea__singlequote__isembedded__inthe__string.This__isa__purelysubjective__style choice,but__Pythondisplays__stringsthis__way, too,and__mostPython__programmersdo__thesame__today,so__youprobably__should too.Note__thatthe__commais__importantin__thepreceding__code.Without__it,Python__automaticallyconcatenates__adjacentstring__literalsof__any kind.It__isalmost__assimple__toadd__a +operator__betweenthem__toinvoke__concatenation explicitly,but__adjacentliterals__areconcatenated__earlywhen__yourcode__isread__(andas__youll__learn ahead,wrapping__thisform__inparentheses__alsoallows__itto__spanmultiple__linesfor__largerblocks__oftext__thatcan__tuse__triple quotes): >>>title__= "Learning " 'Python' " 6E" #Implicit__concatenationwhen__read >>>title__'LearningPython__6E'Adding__commasbetween__thesestrings__wouldresult__ina__tuple,not__a string.Also__noticein__allof__theseoutputs__thatPython__printsstrings__insingle__quotesunless__theyembed__one.If__needed,you__canalso__embedquote__charactersby__escapingthem__with backslashes: >>> 'python\'s', "python\"s" ("python's", 'python"s')To__understand why,you__needto__moveon__tolearn__howescapes__workin__general.Escape__SequencesAre__SpecialCharacters__Theprior__exampleembedded__aquote__insidea__stringby__precedingit__witha__backslash (\).This__isrepresentative__ofa__generalpattern__in strings:backslashes__areused__tointroduce__specialcharacter__codingsknown__asescape__sequences.Escape__sequenceslet__usembed__charactersin__stringsthat__cannoteasily__beinserted__intoa__stringliteral__ortyped__ona__keyboard.The__character \,and__oneor__morecharacters__followingit__inthe__string literal,are__replacedwith__asingle__characterin__theresulting__string object,which__hasthe__valuespecified__bythe__escape sequence.For__example,here__isa__five-characterstring__thatembeds__anewline__anda__tab: >>>s__= 'a\nb\tc'The__twocharacters__\nstand__fora__singlecharacter__thenewline__character (technically speaking, code-pointvalue__10,which__meansnewline__inUnicode__andits__ASCII subset). Similarly,the__sequence \tis__replacedwith__thetab__character (codepoint__9).The__waythis__stringlooks__whenprinted__dependson__howyou__print it.The__interactiveecho__showsthe__specialcharacters__as escapes,but__printinterprets__them instead: >>>s__'a\nb\tc' >>> print(s)a__bc__Tobe__completelysure__howmany__actualcharacters__arein__this string,use__the built-inlen__functionit__returnsthe__actualnumber__ofcharacters__ina__string,regardless__ofhow__itis__codedor__displayed: >>> len(s) 5This__stringis__fivecharacters__long:it__containsan__ASCII a,a__newline character,an__ASCII b,and__so on.NOTE__Butlength__isnot__bytes:If__youre__accustomedto__all-ASCII text,it__stempting__tothink__ofthis__lenresult__asmeaning__fivebytes__too,but__youprobably__shouldn t. Really,bytes__intoday__sUnicode__worlddoesn__thold__themeaning__itonce__did.For__one thing,the__Pythonstring__objectincludes__admindata__thatmakes__itlarger__inmemory__thanits__text alone.For__another,string__contentand__lengthboth__reflectcode__points (identifying numbers)assigned__by Unicode,and__asingle__characters__codepoint__doesnot__necessarilymap__toa__singlebyte__eitherwhen__decodedin__memoryor__encodedin__files.Under__encoding UTF-16,for__example,ASCII__charactersare__multiplebytes__infiles__andmay__beany__sizeat__allin__memorydepending__onhow__Pythonallocates__their space. Moreover, code-pointvalues__of non-ASCIIcharacters__likeand__arefar__toolarge__tofit__inan__8-bitbyte__inany__form.In__fact,Python__definesstr__stringsformally__assequences__ofUnicode__code points,not__bytes,to__makethis__clear.There__smuch__moreon__howUnicode__textobviates__bytesin__Chapter 37when__youre__readyto__takethe__plunge.For__now,to__avoid confusion,think__charactersinstead__ofbytes__in strings.Notice__thatthe__originalbackslash__charactersin__thepreceding__examplesare__notreally__storedwith__thestring__in memory;they__areused__onlyto__describespecial__charactervalues__tobe__storedin__the string.For__codingsuch__special characters,Python__recognizesa__fullset__ofescape__code sequences,listed__forreference__inTable__7-2.Table__7-2.String__backslashcharacters__EscapeMeaning__\\Backslash__(storesone__\) \'Single__quote (stores ') \"Double__quote (stores ") \nNewline__(a.k.a. linefeed) \rCarriage__return (e.g.,in__Windows \r\n) \tHorizontal__tab \vVertical__tab \aBell__(where supported) \bBackspace__\fFormfeed__\xhhHexadecimal__code-pointor__bytevalue__(exactly 2hex__digits) \oooOctal__code-pointor__bytevalue__(upto__3 digits, 377 ceiling) \0 Null:octal__binary 0character__(doesnt__end string) \uhhhhUnicode__charactercode__point, 16-bitvalue__(exactly 4hex__digits) \UhhhhhhhhUnicode__charactercode__point, 32-bitvalue__(exactly 8hex__digits) \N{name}Character__withID__namein__Unicodedatabase__\newlineIgnored__(precedesa__continuation line) \otherRetained__verbatim,but__awarning__in 3.12,an__errorin__thefuture__utue__Someof__Table 7-2s__escapescome__withusage__rules.Again__for reference,here__arethe__fine points:The__\x, \u,and__\Uescape__sequencesrequire__exactly two, four,and__eighthexadecimal__digits, respectively.Use__digits 0 9and__AF__(uppercaseor__lowercase)for__h.The__\oescape__acceptsone__tothree__octaldigits__andissues__awarning__forvalues__over \377in__Python 3.12because__valuestoo__bigfor__abyte__causeissues__inbyte__strings.Use__digits 0 7for__o.Both__\uand__\Uare__recognizedonly__instr__text-stringliterals__(e.g., ' '),where__theygive__acharacter__sUnicode__code-point value.This__isthe__codepoint__sdecoded__value. \xand__\oescapes__workin__bothbytes__byte-stringliterals__(b' '),where__theygive__abyte__sabsolute__value;and__instr__text-string literals,where__theygive__acharacter__sUnicode__code-point value.Lettered__escapeslike__\nstand__fortheir__Unicodecode__pointsin__textand__theirASCII__encodingsin__bytes,even__ifthe__twovalues__agree (thereis__moreon__Unicodeescapes__inChapter__37).Let__sget__backto__running code.Some__stringescape__sequencesallow__youto__embedabsolute__valuesas__charactersof__a string.When__youdo__this,you__rereally__givingthe__code-pointvalue__ofthe__desired character.For__instance,here__sa__five-character__stringthat__embedstwo__characterswith__zerovalues__(codedas__octalescapes__ofone__digit): >>>s__= 'a\0b\0c' >>>s__'a\x00b\x00c' >>> len(s) 5The__characterassociated__withcode__point 0is__generallyknown__asNULL__(or NUL). Importantly,in__Python,a__characterlike__thisdoes__notterminate__astring__theway__anull__bytetypically__doesin__C. Instead,Python__keepsboth__thestring__slength__andtext__in memory.In__fact,no__characterterminates__astring__in Python.Here__sa__stringthat__isall__absoluteescape__codesan__absolute 1and__2 (codedin__octal),followed__byan__absolute 3 (codedin__hexadecimal),and__nonprintables all: >>>s__= '\001\002\x03' >>>s__'\x01\x02\x03' >>> len(s) 3Notice__thatPython__displaysnonprintable__charactersin__hex,regardless__ofhow__theywere__specified.When__needed,you__canfreely__combine characters, absolute-value__escapes,and__themore__symbolicescapes__inTable__7-2.To__demo,the__followingstring__containsthe__charactersHACK__,a__taband__newline,and__anabsolute__zerocharacter__codedin__hex: >>>S__= 'H\tA\nC\x00K' >>>S__'H\tA\nC\x00K' >>> len(S) 7 >>> print(S)H__ACK__Thisbecomes__moreimportant__toknow__whenyou__processbinary__datafiles__in Python.Because__theircontents__arerepresented__asstrings__inyour__scripts,it__sOK__toprocess__binaryfiles__thatcontain__anysorts__ofbinary__byte values.When__openedin__binary modes,files__returnraw__bytesfrom__theexternal__fileas__bytesa__stringvariant__thatsupports__mostof__thesyntax__andtools__inthis__chapter (youll__findmore__onfiles__andbytes__inChapters__4, 9,and__37).Two__limitsin__Table 7-2merit__callouts.First__of all,octal__escapeswith__valuestoo__largefor__abyte__issuewarnings__asof__Python 3.12and__willbe__errorssoon__despitethe__factthat__theseescapes__intext__stringsdenote__code points,not__bytes: >>> '\400' :1: SyntaxWarning:invalid__octalescape__sequence '\400' ' 'This__seemsunlikely__tobreak__much code,but__thelast__entryin__Table 7-2 may:if__Pythondoes__notrecognize__thecharacter__aftera__\as__beinga__validescape__code,it__simplykeeps__thebackslash__inthe__resultingstring__atleast__forthe__moment: >>>x__= 'C:\py\code' :1: SyntaxWarning:invalid__escapesequence__'\p' >>>x__#Keeps__\literally__(anddisplays__itas__\\) 'C:\\py\\code' >>> len(x) #But__notfor__long: don'trely__onthis__anymore! 10Despite__thisbehavior__beingexpected__(andeven__relied upon)for__three decades,it__hasrecently__beenjudged__badand__hasstarted__issuinga__warningwhen__used.In__Python 3.12,it__invokesa__syntaxwarning__thatdoesn__tstop__yourprogram__butclutters__youroutput__with nags. Worse,this__willbe__treatedas__a programming-ending__errorin__afuture__Python,so__youshould__notuse__thisgoing__forwardand__areexpected__tochange__allthe__codeyou__vewritten__inthe__pastthat__does!Even__withoutthis__backward-incompatiblePython__change, though,strings__thatrely__onthis__behaviorseem__aslikely__tolose__backslashesin__escapesas__toretain__them elsewhere. Instead,code__literalbackslashes__explicitlysuch__thatthey__areretained__inyour__stringsin__all Pythons,by__eitherdoubling__themwith__\\ (anescape__forone__\),or__usingraw__stringsthe__topicof__thenext__section.Raw__StringsSuppress__EscapesAs__weve__already seen,escape__sequencesare__handyfor__embeddingspecial__charactersin__strings. Sometimes, though,the__specialtreatment__ofbackslashes__forintroducing__escapescan__leadto__trouble.It__ssurprisingly__common,for__instance,to__seePython__newcomerstrying__toopen__afile__onWindows__witha__filenameargument__thatlooks__somethinglike__this:myfile__= open('C:\new\text.dat', 'w')thinking__thatthey__willopen__afile__called text.datin__thedirectory__C:\new.The__problemwith__thisis__that \nis__takento__standfor__anewline__character,and__\tis__replacedwith__a tab.In__effect,the__calltries__toopen__afile__named C: (newline)ew(tab)ext.dat,with__usually less-than-stellar results.This__isjust__thesort__ofthing__thatraw__stringsare__meantto__address.If__theletter__r (uppercaseor__lowercase,but__usuallythe__latter)appears__justbefore__theopening__quoteof__anystring__literalcovered__inthis__chapter,it__turnsoff__theescape__mechanism.The__resultis__thatPython__retainsyour__backslashes literally,exactly__asthey__appearin__the string. Hence,to__fixthe__filename problem,just__rememberto__addthe__letterr__on Windows:myfile__= open(r'C:\new\text.dat', 'w') # Works:disable__\escapes__Alternatively, because,as__notedin__thepreceding__section,two__backslashesare__reallyan__escapesequence__forone__backslash,you__cankeep__yourbackslashes__bysimply__doublingthem__upwhen__theyshould__betaken__verbatim:myfile__= open('C:\\new\\text.dat', 'w') #Also__works: \\means__\In__fact,Python__itselfsometimes__usesthis__doublingscheme__whenit__printsstrings__withembedded__backslashes: >>>path__= r'C:\new\text.dat' #Raw__string:keep__\s >>>path__#Show__asPython__code 'C:\\new\\text.dat' >>> print(path) # User-friendlyformat__C:\new\text.dat >>> len(path) #String__length: \s 15As__coveredin__Chapter 5,the__defaultformat__atthe__interactiveprompt__printsresults__asif__theywere__code,and__thereforeescapes__backslashesin__the output.The__printstatement__providesa__more user-friendlyformat__thatshows__thatthere__isactually__onlyone__backslashin__each spot.To__verifythis__isthe__case,you__cancheck__theresult__ofthe__built-inlen__function,which__returnsthe__numberof__charactersin__the string,independent__ofdisplay__formats.If__youcount__thecharacters__inthe__print(path) output,you__llsee__thatthere__reallyis__just 1character__per backslash,for__atotal__of 15.Besides__directorypaths__on Windows,raw__stringsare__alsocommonly__usedfor__regularexpressions__intext__pattern matching,supported__withthe__remodule__introducedin__Chapter 37.Also__notethat__Pythonscripts__canusually__useforward__slashesin__directorypaths__onboth__Windowsand__Unixbecause__thisslash__isinterpreted__portably (e.g., 'C:/new/text.dat'works__whenopening__Windows files, too).Raw__stringsare__usefulfor__pathsusing__nativeWindows__backslashes, though,and__anyother__timeyou__wantto__ensurethat__Pythonwill__leaveyour__\ alone.They__alsowork__for triple-quotedstrings__tosuppress__escapes (andfuture__invalid-escape errors!)in__textof__thesort__up next.NOTE__Raw-string quirk:Despite__its role,even__araw__stringcannot__endin__asingle__backslash,because__thebackslash__escapesthe__followingquote__character.That__is, r' \'is__nota__validstring__literal:you__stillmust__escapethe__surroundingquote__characterto__embedit__inthe__string,and__Pythonassumes__thatis__your intent.The__upshotis__thata__rawstring__cannotend__inan__oddnumber__of backslashes,including__one.If__youneed__toend__araw__stringwith__asingle__backslash,you__canuse__twoand__sliceoff__thesecond__(r' \\'[:-1]),tack__oneon__manually (r' ' + '\\'),or__skipthe__rawstring__syntaxand__justdouble__upthe__backslashesin__anormal__string (' \\').All__threeof__theseforms__createthe__same two-characterstring__witha__Unicodeellipsis__andone__backslash.Triple__Quotesand__MultilineStrings__So far,you__veseen__single quotes,double__quotes, escapes,and__rawstrings__in action.Python__alsohas__a triple-quotedstring__literal format,sometimes__calleda__block string,that__isa__syntacticconvenience__forcoding__multiline data.This__formbegins__withthree__quotes (ofeither__thesingle__ordouble__variety),is__followedby__anynumber__oflines__of text,and__isclosed__withthe__same triple-quotesequence__thatopened__it.Single__anddouble__quotesembedded__inthe__strings__textmay__be,but__donot__haveto__be,escaped__thestring__doesnot__enduntil__Pythonsees__threeunescaped__quotesof__thesame__kindused__tostart__the literal.For__example: >>>quip__= """Pythonstrings__...sure__have ...a__lotof__options""" >>> >>>quip__'Python strings\nsure__have\nalot__of options'This__stringspans__three lines.As__youlearned__inChapter__3,the__interactiveprompt__changesto__...on__continuationlines__likethis__insome__interfaces,but__notin__others.This__bookomits__thedots__insome__examplesto__enable cut-and-paste,but__dont__typethem__yourselfif__theyre__listedas__theyare__herebut__absentin__your REPL,and__extrapolateas__needed.Prompts__aside,Python__collectsall__the triple-quotedtext__inthis__exampleinto__asingle__multiline string,with__embeddednewline__characters (\n)at__theplaces__whereyour__codehas__physicalline__breaks.Notice__that,as__inthe__literal,the__secondline__inthe__resulthas__leading spaces,but__thethird__doesnot__whatyou__typeis__trulywhat__you get.To__seethe__stringwith__thenewlines__interpreted,print__itinstead__of echoing: >>> print(quip)Python__stringssure__havea__lotof__optionsIn__fact, triple-quotedstrings__willretain__allthe__enclosed text,including__anyto__theright__ofyour__codethat__youmight__intendas__comments.So__dont__dothis__putyour__commentsabove__orbelow__thequoted__text,or__usethe__automaticconcatenation__ofadjacent__stringsmentioned__earlier,with__explicitnewlines__if needed,and__surroundingparentheses__toallow__linespans__(youll__learnmore__aboutthis__latterform__whenyou__studysyntax__rulesin__Chapters 10and__12): >>>menu__= """ ...Open__#Comments__hereadded__to string! ...Save__#Ditto__... """ >>>menu__'\nOpen #Comments__hereadded__to string!\nSave # Ditto\n' >>>menu__= ( ... 'Open\n' #Comments__hereignored__... 'Save\n' #But__newlinesnot__automatic ... ) >>>menu__'Open\nSave\n'So__whyuse__triple-quoted strings?For__one thing,they__areuseful__anytimeyou__needmultiline__textin__yourprogram__for example,to__embedmultiline__error messages,or__HTML, XML, JSON,or__YAMLcode__inyour__Pythonsource__code files.You__canusually__embedsuch__blocksdirectly__inyour__scriptsby__triple-quoting__withoutresorting__toexternal__textfiles__orconcatenation__andnewline__characters. Triple-quotedstrings__arealso__commonlyused__fordocstrings__(documentation strings),which__arestring__literalsthat__aretaken__ascomments__whenthey__appearat__specificpoints__inyour__file (andare__coveredin__fullin__Chapter 15).These__dont__haveto__be triple-quoted blocks,but__theyusually__areto__allowfor__multilinecomments__andmay__needto__be triple-quotedraw__strings (e.g., r''')to__avoidinvalid__escapeerrors__inthe__future (seethe__3.12syntax__warningsnoted__previously). Finally, triple-quotedstrings__arealso__sometimesused__asa__horriblyhackish__wayto__temporarilydisable__linesof__codeduring__development. Really,it__snot__too horrible,and__its__actuallya__fairlycommon__practice today,but__itwasn__tthe__originalintent__ofthe__literal.If__youwish__toturn__offa__fewlines__ofcode__andrun__yourscript__again,simply__putthree__quotesabove__andbelow__them,like__this:X__= 1 """import__os #Disable__thiscode__temporarily print(os.getcwd()) """Y__= 2This__wastagged__ashackish__becausePython__reallymight__makea__stringout__ofthe__linesof__codedisabled__this way,but__thisis__probablynot__significantin__termsof__performance.For__largesections__of code,it__salso__easierthan__manuallyadding__hashmarks__beforeeach__lineand__laterremoving__them.This__isespecially__trueif__youare__usinga__texteditor__thatdoes__nothave__supportfor__editingPython__code specifically.In__Python,practicality__oftenbeats__aesthetics.Strings__inAction__Onceyou__vecreated__astring__withthe__literalexpressions__wejust__met,you__willalmost__certainlywant__todo__thingswith__it.This__sectionand__thenext__twodemonstrate__string expressions, methods,and__formattingthe__firstline__of text-processing__toolsin__thePython__language.Basic__OperationsLet__sbegin__byinteracting__withthe__Pythoninterpreter__toillustrate__thebasic__stringoperations__listedearlier__inTable__7-1.You__canconcatenate__stringsusing__the +operator__andrepeat__themusing__the * operator: >>> len('abc') # Length:number__ofitems__3 >>> 'abc' + 'def' # Concatenation:a__newstring__'abcdef' >>> 'Py!' * 4 # Repetition:like__'Py!' + 'Py!' + 'Py!' + 'Py!' 'Py!Py!Py!Py!'The__len built-infunction__herereturns__thelength__ofa__string (orany__otherobject__witha__length). Formally,adding__twostring__objectswith__+creates__anew__string object,with__thecontents__ofits__operands joined,and__repetitionwith__*is__likeadding__astring__toitself__agiven__numberof__times (minus one).In__both cases,Python__letsyou__createarbitrarily__sized strings;there__sno__needto__predeclareanything__in Python,including__thesizes__ofdata__structuresyou__simplybuild__stringobjects__asneeded__andlet__Pythonmanage__theunderlying__memoryspace__automatically,as__welearned__inChapter__6.Repetition__mayseem__abit__obscureat__first,but__itcomes__inhandy__ina__surprisingnumber__of contexts.For__example,to__printa__lineof__80 dashes,you__cancount__upto__80,or__letPython__countfor__you: >>> print('------more__------') # 80 dashes,the__hardway__>>> print('-' * 80) # 80 dashes,the__easyway__Noticethat__theoperator__overloadingand__polymorphismcalled__outin__Chapter 5and__earlieris__atwork__here already:we__reusing__thesame__+and__*operators__thatperform__additionand__multiplicationwhen__using numbers.Python__doesthe__correctoperation__becauseit__knowsthe__typesof__theobjects__beingadded__and multiplied.But__be careful:the__rulesaren__tquite__asliberal__asyou__might expect.For__instance,Python__doesnt__allowyou__tomix__numbersand__stringsin__+ expressions: 'abc'+9raises__anerror__insteadof__automaticallyconverting__9to__astring__(well__fixthis__ahead).As__shownnear__theend__ofTable__7-1,you__canalso__iterateover__stringsin__loopsusing__for statements,which__repeat actions,and__testmembership__forboth__charactersand__substringswith__thein__expression operator,which__isessentially__a search.For__substrings,in__ismuch__likethe__str.find()method__coveredlater__inthis__chapter,but__itreturns__aBoolean__resultinstead__ofthe__substrings__position (dont__bealarmed__ifthe__followings__printindents__your prompt;its__end=' 'changes__thedefault__newlinecharacter__atthe__endof__thedisplay__toa__space): >>>myjob__= 'hacker' >>>for__cin__myjob: #Step__through items,print__each + ' ' ... print(c, end=' ') #Suppress__newlinesafter__eachitem__...hacker__>>> 'k'in__myjob #Found__True >>> 'z'in__myjob #Not__foundFalse__>>> 'HACK'in__'abcHACKdef' #Substring__search,no__positionreturned__TrueThe__for loop,previewed__inChapter__4,assigns__avariable__tosuccessive__itemsin__asequence__(here,a__string)and__executesone__ormore__statements (normally indented)for__each item.In__effect,the__variablec__becomesa__cursorstepping__acrossthe__strings__characters.Because__iterationturns__outto__bea__bigidea__in Python,we__willdiscuss__iterationtools__likethese__andothers__listedin__Table 7-1in__moredetail__laterin__thisbook__(seeChapters__14and__20).Indexing__andSlicing__Becausestrings__areordered__collections (a.k.a. sequences)of__characters,we__canaccess__theircomponents__by position.As__introducedin__Chapter 4,characters__ina__stringare__fetchedby__indexingproviding__thenumeric__offsetof__thedesired__componentin__squarebrackets__afterthe__string.You__getback__the one-characterstring__atthe__specified position.As__inmost__C-like languages,Python__offsetsstart__at 0and__endat__oneless__thanthe__lengthof__thestring__(andthe__startat__0part__maybe__a short-livedhurdle__ifyou__reaccustomed__tocounting__from 1).Unlike__C, however,Python__alsolets__youfetch__itemsfrom__sequencessuch__asstrings__usingnegative__offsets. Technically,a__negativeoffset__isadded__tothe__lengthof__astring__toderive__apositive__offset,but__youcan__alsothink__ofnegative__offsetsas__countingbackward__fromthe__end.The__followinginteraction__demonstrates: >>>S__= 'code' >>> S[0], S[-2] #Indexing__fromfront__orend__('c', 'd') >>> S[1:3], S[1:], S[:-1] # Slicing:extract__asection__('od', 'ode', 'cod')In__this code,the__firstline__definesa__four-characterstring__andassigns__itto__thename__S.The__nextline__indexesit__intwo__ways: S[0]fetches__theitem__atoffset__0from__theleft__the one-characterstring__'c'at__the front;and__S[ 2]gets__theitem__atoffset__2back__fromthe__endor__equivalently,at__offset (4 + ( 2))from__the front.The__lastline__inthe__foregoingexample__demonstrates slicing,a__generalizedform__ofindexing__thatreturns__anentire__section,instead__ofa__single item.It__canbe__usedto__extractcolumns__of data,chop__offprefixes__and suffixes,and__more.Slicing__canalso__beviewed__asa__typeof__parsing (decomposing content),especially__whenapplied__to strings,because__its__aneasy__wayto__extract substrings.In__fact,we__llexplore__slicingin__thecontext__oftext__parsinglater__inthis__chapter.Slicing__workslike__this:when__youindex__asequence__objectsuch__asa__stringon__apair__ofoffsets__separatedby__a colon,Python__returnsa__newobject__containingthe__contiguoussection__identifiedby__theoffset__pair.The__leftoffset__istaken__tobe__thelower__bound (inclusive),and__theright__isthe__upperbound__(noninclusive).That__is,Python__fetchesall__itemsfrom__thelower__boundup__tobut__notincluding__theupper__boundand__returnsa__newobject__containingthe__fetched items.If__omitted,the__leftand__rightbounds__defaultto__0and__thelength__ofthe__objectyou__are slicing, respectively.For__instance,in__theexample__wejust__ran, S[1:3]extracts__theitems__atoffsets__1and__2it__grabsthe__secondand__thirditems__andstops__beforethe__fourthitem__atoffset__3. Next, S[1:]gets__allitems__beyondthe__firstthe__upper bound,which__isnot__specified,defaults__tothe__lengthof__the string,which__isoff__the end. Finally, S[: 1]fetches__allbut__thelast__itemthe__lowerbound__defaultsto__0,and__1refers__tothe__last item, noninclusive.In__moregraphic__terms,indexes__andslices__mapto__cellsas__shownin__Figure 7-1.Figure__7-1.Indexes__and slices:positives__startfrom__theleft__(0)and__negativesfrom__theright__( 1)All__ofwhich__mayseem__confusingat__first glance,but__indexingand__slicingare__simpleand__powerfultools__touse__onceyou__getthe__knack. Remember,if__youre__unsureabout__theeffects__ofa__slice,try__itout__interactively.In__thenext__chapter,you__llsee__thatit__seven__possibleto__changean__entiresection__ofanother__objectin__onestep__byassigning__toa__slice (thoughnot__forimmutables__likethe__stringswe__restudying__here).For__now,here__sa__cheatsheet__ofthe__detailsfor__reference:Indexing__S[I]fetches__componentsat__offsetsin__sequences:The__firstitem__isat__offset 0.Negative__indexesmean__countingbackward__fromthe__endor__right. Out-of-boundsoffsets__arean__error. S[0]fetches__thefirst__item. S[ 2]fetches__thesecond__itemfrom__theend__(like S[len(S) 2]).Slicing__S[I:J]extracts__contiguoussections__of sequences:The__upperbound__is noninclusive.Slice__boundsdefault__to 0and__thesequence__length,if__omitted. Out-of-boundsoffsets__areadjusted__tobe__in bounds. S[1:3]fetches__itemsat__offsets 1up__tobut__notincluding__3. S[1:]fetches__itemsat__offset 1through__theend__(thesequence__length). S[:3]fetches__itemsat__offset 0up__tobut__notincluding__3. S[: 1]fetches__itemsat__offset 0up__tobut__notincluding__thelast__item. S[:]fetches__itemsat__offsets 0through__theend__makinga__top-levelcopy__of S.Extended__slicing S[I:J:K]accepts__astep__(or stride) K,which__defaultsto__+1:Allows__forskipping__itemsand__reversingorder__seethe__next section.The__second-to-lastbullet__itemlisted__hereturns__outto__bea__common technique: S[:]makes__afull__top-levelcopy__ofa__sequenceobject__anobject__withthe__same value,but__adistinct__pieceof__memory (youll__findmore__oncopies__inChapter__9).This__isnt__veryuseful__forimmutable__objectslike__strings,but__itcomes__inhandy__forobjects__thatmay__bechanged__in place,such__as lists:making__acopy__canavoid__theside__effectsof__sharedreferences__shownin__Chapter 6.Also__perthe__cheat sheet,slices__differfrom__indexesin__theirpolicy__on out-of-bounds__(offthe__end) offsets:they__realways__errorsin__indexing,because__theoffset__doesnot__exist,but__scaledto__bein__boundsin__slicing,because__thiscan__beuseful__inprograms__thatneed__toaccommodate__sizes flexibly: >>>S__= 'code' >>> S[99] IndexError:string__indexout__ofrange__>>> S[1:99] 'ode'Because__were__goingto__explorethis__oddityin__an end-of-part exercise, though,we__llcut__thestory__short here.Extended__slicing:The__thirdlimit__andslice__objectsThough__notcommonly__used,slice__expressionsalso__supportan__optionalthird__index,used__asa__step (sometimescalled__a stride).The__stepis__addedto__theindex__ofeach__item extracted.With__it,the__full-blownform__ofa__sliceis__S[I:J:K],which__meansextract__allthe__itemsin__S,from__offsetI__throughJ__1,by__K.The__third limit, K,defaults__to +1,which__iswhy__normallyall__itemsin__aslice__areextracted__fromleft__to right.If__youspecify__anexplicit__value, however,you__canuse__thethird__limitto__skipitems__orto__reversetheir__order.For__instance, S[1:10:2]will__fetchevery__otheritem__inS__fromoffsets__1 9;that__is,it__willcollect__theitems__atoffsets__1, 3, 5, 7,and__9.As__usual,the__firstand__secondlimits__defaultto__0and__thelength__ofthe__sequence, respectively,so__X[::2]gets__everyother__itemfrom__thebeginning__tothe__endof__the sequence: >>>S__= 'abcdefghijklmnop' >>> S[1:10:2] #Skipping__items 'bdfhj' >>> S[::2] 'acegikmo'You__canalso__usea__negativestride__tocollect__itemsin__theopposite__order.For__example,in__theslicing__expression S[:: 1],the__firsttwo__boundsdefault__tosequence__length 1and__1 (theyreally__defaultto__Noneand__None,but__thats__unimportant here),and__astride__of 1indicates__thatthe__sliceshould__gofrom__rightto__leftinstead__ofthe__usualleft__to right.In__muchsimpler__terms,the__effectis__toreverse__the sequence: >>>S__= 'hello' >>> S[:: 1] #Reversing__items 'olleh'With__anegative__stride,the__meaningsof__thefirst__twobounds__areessentially__reversed.That__is,the__slice S[5:1: 1]fetches__theitems__from 2to__5,in__reverseorder__(theresult__containsitems__fromoffsets__5, 4, 3,and__2): >>>S__= 'abcedfg' >>> S[5:1: 1] #Bounds__rolesdiffer__'fdec'Skipping__andreversing__likethis__arethe__mostcommon__usecases__for three-limit slices,but__seePython__s standard-librarymanual__formore__details (orrun__afew__experiments interactively).We__llrevisit__three-limitslices__againlater__inthis__book,in__conjunctionwith__thefor__loop statement.Later__inthe__book,you__llalso__learnthat__slicingis__equivalentto__indexingwith__aslice__object,a__findingof__importanceto__classwriters__seekingto__supportboth__operations: >>> 'code'[1:3] #Slicing__syntax 'od' >>> 'code'[slice(1, 3)] #Slice__objectswith__indexsyntax__+object__'od' >>> 'code'[::-1] 'edoc' >>> 'code'[slice(None, None, -1)] 'edoc'WHY__YOUWILL__CARE:SLICES__Throughoutthis__book,you__llmeet__common use-casesidebars__suchas__thisone__thatgive__youa__peekat__howsome__ofthe__languagefeatures__beingdiscussed__aretypically__usedin__real programs.Because__youwon__tbe__ableto__makemuch__senseof__realisticuse__casesuntil__youve__seenmore__ofthe__Python picture,these__sidebarsnecessarily__containmany__referencesto__topicsnot__introduced yet;at__most,you__shouldconsider__thempreviews__ofways__thatyou__mayfind__theseabstract__languageconcepts__usefulfor__practicalprogramming__tasks.For__instance,you__llsee__laterthat__theargument__wordslisted__ona__systemcommand__lineused__tolaunch__aPython__programare__madeavailable__inthe__argvattribute__ofthe__built-insys__module: #File__echo.pyimport__sys print(sys.argv) $ python3 echo.pya__bc__['echo.py', ' a', ' b', ' c'] Usually,you__reinterested__onlyin__inspectingthe__argumentsthat__followthe__program name.This__leadsto__atypical__applicationof__slices:a__singleslice__expressioncan__beused__toreturn__allbut__thefirst__itemof__a list. Here, sys.argv[1:]returns__thedesired__list, [' a', ' b', ' c'].You__canthen__processthis__listwithout__havingto__accommodatethe__programname__atthe__front.Slices__arealso__oftenused__toclean__uplines__readfrom__input files,of__thesort__well__studyin__Chapter 9.If__youknow__thata__linewill__havea__newlinecharacter__atthe__end (a \n),you__canget__ridof__itwith__asingle__expressionsuch__as line[: 1],which__extractsall__butthe__lastcharacter__inthe__line.In__both cases,slices__dothe__jobof__logicthat__mustbe__explicitin__a lower-level language.Having__said that,calling__the line.rstripmethod__isoften__preferredfor__strippingnewline__charactersbecause__thiscall__leavesthe__lineintact__ifit__hasno__newlinecharacter__atthe__enda__commoncase__forfiles__createdwith__some text-editing tools.Slicing__worksonly__ifyou__resure__theline__isproperly__terminated.String__ConversionTools__Oneof__Pythons__designmottos__isthat__itrefuses__thetemptation__to guess.As__aprime__example,you__cannotadd__anumber__anda__stringtogether__in Python,even__ifthe__stringlooks__likea__number (i.e.,is__all digits): >>> '62' + 1 TypeError:can__onlyconcatenate__str (not "int")to__strThis__isby__design:because__+can__meanboth__additionand__concatenation,the__choiceof__conversionwould__beambiguous__doyou__want '621'or__63? Instead,Python__treatsthis__asan__error.In__Python,magic__isgenerally__omittedif__itwill__makeyour__codinglife__more complex.What__to do, then,if__yourscript__obtainsa__numberas__atext__stringfrom__afile__oruser__interface?The__trickis__thatyou__mustsimply__employconversion__toolsbefore__youcan__treata__stringlike__a number,or__vice versa.For__instance: >>> int('62'), str(62) #Convert__from/tostring__(62, '62')The__intfunction__convertsa__stringto__a number,and__thestr__functionconverts__anumber__toits__stringrepresentation__(essentially,what__itlooks__likewhen__printed). Now,although__youcan__tmix__stringsand__numbertypes__aroundoperators__suchas__+,you__canmanually__convertoperands__beforethat__operationif__needed: >>>S__= '62' >>>I__= 1 >>>S__+I__TypeError:can__onlyconcatenate__str (not "int")to__str >>> int(S) +I__#Force__addition 63 >>>S__+ str(I) #Force__concatenation '621'Similar__built-infunctions__handle floating-point-numberconversions__toand__from strings,if__youneed__tomix__thetwo__in expressions: >>> float('1.5') + 2.8 4.3 >>> '1.5' + str(2.8) '1.52.8'The__built-ineval__functionintroduced__inChapter__5runs__astring__containingPython__expression code,and__socan__alsoconvert__astring__toany__kindof__object.The__functionsint__andfloat__convertonly__to numbers,but__thisrestriction__meansthey__areusually__faster (andmore__secure,because__theydo__notaccept__arbitraryexpression__code).As__wealso__sawbriefly__inChapter__5,string__formattingprovides__otherways__toconvert__numbersto__strings;more__onit__ahead. Character-codeconversions__Onthe__subjectof__conversions,it__isalso__possibleto__converta__singlecharacter__toits__underlyinginteger__codeby__passingit__tothe__built-inord__functionthis__returnsthe__numericordinal__valueused__torepresent__thecorresponding__characterin__memory (technically,its__Unicodecode__point,as__youll__learnin__Chapter 37,but__thisisn__tcrucial__yet).The__chrfunction__performsthe__inverse operation,taking__aninteger__codeand__convertingit__tothe__corresponding character: >>> ord('h') #Character__=>ID__(code point) 104 >>> chr(104) #ID__=>character__(string) 'h' >>>for__cin__'hack': #All__codepoints__ina__string ... print(c, ord(c)) ...h__104a__97c__99k__107You__canuse__aloop__toapply__ordto__allcharacters__ina__stringas__shown,but__thesetools__canalso__beused__toperform__asimple__sortof__string-based math.To__advanceto__thenext__character,for__example,convert__anddo__themath__in integer: >>>S__= '5' >>>S__= chr(ord(S) + 1) >>>S__'6' >>>S__= chr(ord(S) + 1) >>>S__'7'At__leastfor__single-character strings,this__providesan__alternativeto__usingthe__built-inint__functionto__convertfrom__stringto__integer (thoughthis__onlymakes__senseif__characterordinals__areordered__asyour__code expects!): >>> int('5') 5 >>> ord('5') - ord('0') 5String__comparisonsAnother__reasonfor__introducingordinals__hereis__thatit__helpsus__understandstring__comparisons:when__wecompare__twotext__strings,Python__automaticallycompares__themleft__to right,character__by character,and__lexicographicallythat__is,by__thesame__character code-pointvalues__returnedby__orduntil__thefirst__mismatchor__endof__either string.In__the following,for__example,the__codepoint__oft__isgreater__thanthat__of k,and__thelonger__stringat__theend__wins: >>> 'hack' == 'hack', 'hact' > 'hack', 'hacker' > 'hack' (True, True, True)The__sameholds__truefor__thebyte__stringsyou__llmeet__inChapter__37 (theyare__comparedbyte__forbyte__untila__resultis__known),and__thenext__chapters__richercollections__likelists__dosimilar__(Pythoncompares__alltheir__partsfor__you).Changing__StringsPart__1:Sequence__OperationsRemember__theterm__immutable sequence?As__weve__seen,being__asequence__meansthat__stringssupport__operationslike__concatenation, repetition, indexing,and__slicing.The__immutablepart__meansthat__youcannot__changea__stringin__placefor__instance,by__assigningto__an index: >>>S__= 'text' >>> S[0] = 'n' TypeError: 'str'object__doesnot__supportitem__assignmentHow__tomodify__textualinformation__in Python, then?To__changea__string,you__generallyneed__tobuild__anew__stringusing__toolssuch__asconcatenation__and slicing,and__assignthe__resultback__tothe__strings__originalname__if desired: >>>S__= 'text' >>>S__=S__+ 'ual!' #To__changea__string,make__anew__one >>>S__'textual!' >>>S__= S[:4] + ' processing' + S[-1] >>>S__'text processing!'The__firstexample__addsa__substringat__theend__of S,by__concatenation. Really,it__makesa__newstring__andassigns__itback__toS__tosave__it,but__youcan__thinkof__thisas__changingthe__original string.The__secondexample__replacesthree__characterswith__manyby__slicing, indexing,and__concatenating.As__youll__seein__thenext__section,you__canachieve__similareffects__withstring__methodslike__replace: >>>S__= 'text' >>>S__= S.replace('ex', 'hough') >>>S__'thought'Like__everyoperation__thatyields__anew__string value,string__methodsgenerate__newstring__objects.If__youwant__toretain__those objects,you__canassign__themto__variable names.Whether__bysequence__operationsor__methods,generating__anew__stringobject__foreach__stringchange__isnot__asinefficient__asit__maysound__remember,as__discussedin__thepreceding__chapter,Python__automatically garbage-collects__(reclaimsthe__space of)old__unusedstring__objectsas__you go,so__newerobjects__reusethe__spaceheld__byprior__values.Python__isusually__moreefficient__thanyou__might expect.But__stringmethods__cando__much more,as__thenext__sectionwill__explain.NOTE__Exceptfor__bytearray:As__previewedin__Chapter 4and__tobe__coveredin__Chapter 37,Python__hasa__stringtype__knownas__bytearray,which__ismutable__andso__maybe__changedin__place.bytearray__objectsaren__treally__text strings;they__resequences__of small, 8-bit integers. However,they__supportmost__ofthe__sameoperations__asnormal__stringsand__printas__ASCIIcharacters__when displayed. Accordingly,they__provideanother__optionfor__largeamounts__ofsimple__8-bittext__thatmust__bechanged__frequently.Richer__Unicodetext__andstr__stringsin__general, though,require__techniquesshown__here.String__MethodsIn__additionto__allthe__stringoperations__already introduced,strings__providea__setof__methodsthat__supportmore__sophisticated text-processing goals.In__Python,expressions__and built-infunctions__maywork__acrossa__rangeof__types,but__methodsare__generallyspecific__toobject__typesstring__methods,for__example,work__onlyon__string objects.Some__methodnames__areused__bymultiple__objectsin__Pythonfor__consistency (e.g.,many__havecount__andcopy__methods,and__mostmutables__havea__pop),but__theyare__stillmore__typespecific__thanother__tools.Method__CallSyntax__Asintroduced__inChapter__4,methods__aresimply__functionsthat__areassociated__withand__actupon__particular objects. Technically,they__areattributes__attachedto__objectsthat__happento__referencecallable__functionswhich__alwayshave__animplied__subject.In__finer-grained detail,functions__arepackages__of code,and__methodcalls__combinetwo__operationsat__oncean__attributefetch__anda__call:Attribute__fetchesAn__expressionof__theform__object.attributemeans__fetchthe__valueof__attributein__object.Call__expressionsAn__expressionof__theform__function(arguments)means__invokethe__codeof__function,passing__zeroor__more comma-separatedargument__objectsto__it,and__returnfunction__sresult__value.Putting__thesetwo__togetherallows__usto__calla__methodof__an object.The__methodcall__expression: object.method(arguments)is__evaluatedfrom__leftto__rightPython__willfirst__fetchthe__methodof__theobject__andthen__call it,passing__inboth__objectand__the arguments. Or,in__plain words,the__methodcall__expressionmeans__this:Call__methodto__processobject__with arguments.If__themethod__computesa__result,it__willalso__comeback__asthe__resultof__theentire__method-call expression.As__amore__tangible example: >>>S__= 'hack' >>>result__= S.find('ac') #Call__thefind__methodto__lookfor__'ac'in__stringS__Thismapping__holdstrue__formethods__ofboth__built-in types,as__wellas__user-defined__classeswe__llstudy__later.As__youll__seethroughout__thispart__ofthe__book,most__objectshave__callable methods,and__allare__accessedusing__thissame__method-call syntax.To__callan__object method,as__youll__seein__thefollowing__sections,you__haveto__gothrough__anexisting__object;methods__cannotbe__run (andmake__little sense)without__a subject.All__StringMethods__(Today)Table__7-3summarizes__themethods__andcall__patternsfor__built-instring__objectsin__Python 3.12.These__changeover__time,so__besure__tocheck__Pythons__standard-library__manualfor__themost__up-to-date list,or__runa__diror__helpcall__interactivelyon__anystring__orthe__strtype__name,as__shownin__Chapter 4.In__this table,S__isa__string object;optional__argumentsare__enclosedin__[] brackets;nested__[]mean__optionalfollowing__an optional; *Xand__**Xmean__anynumber__X;and__thelisted__methodsimplement__higher-leveloperations__suchas__splittingand__joining,case__conversions,content__tests,and__substringsearches__and replacements.Table__7-3.String__methodcalls__inPython__3.12 S.capitalize() S.ljust(width [, fill]) S.casefold() S.lower() S.center(width [, fill]) S.lstrip([chars]) S.count(sub [,start__[, end]]) S.maketrans(x [,y__[, z]]) S.encode([encoding [, errors]]) S.partition(sep) S.endswith(suffix [,start__[, end]]) S.removeprefix(prefix) S.expandtabs([tabsize]) S.removesuffix(suffix) S.find(sub [,start__[, end]]) S.replace(old,new__[, count]) S.format(fmtstr, *args, **kwargs) S.rfind(sub [,start__[, end]]) S.format_map(mapping) S.rindex(sub [,start__[, end]]) S.index(sub [,start__[, end]]) S.rjust(width [, fill]) S.isalnum() S.rpartition(sep) S.isalpha() S.rsplit([sep [, maxsplit]]) S.isascii() S.rstrip([chars]) S.isdecimal() S.split([sep [, maxsplit]]) S.isdigit() S.splitlines([keepends]) S.isidentifier() S.startswith(prefix [,start__[, end]]) S.islower() S.strip([chars]) S.isnumeric() S.swapcase() S.isprintable() S.title() S.isspace() S.translate(map) S.istitle() S.upper() S.isupper() S.zfill(width) S.join(iterable)As__youcan__see,strings__havemany__methods,and__wedon__thave__spaceto__coverthem__all here;omissions__canbe__foundin__otherresources__when needed.To__helpyou__get started, though,let__swork__throughsome__codethat__demonstratessome__ofthe__mostcommonly__usedmethods__inaction__andillustrates__Python text-processing__basicsalong__the way.Changing__Strings,Part__2:String__MethodsAs__weve__seen,most__stringscannot__bechanged__inplace__directlybecause__theyare__immutable.We__exploredchanging__stringswith__sequenceoperations__inthe__preceding section,but__lets__resumethat__storyhere__inthe__contextof__methods.By__wayof__review,to__makea__newtext__valuefrom__anexisting__string,you__canconstruct__anew__stringwith__sequenceoperations__suchas__slicingand__concatenation.For__example,to__replacetwo__charactersin__themiddle__ofa__string,you__canuse__codelike__this,much__aswe__didin__theprior__section: >>>S__= 'textly!' >>> S[:4] + 'ful' + S[-1] #Make__anew__stringwith__sequenceops__'textful!' But,if__youre__reallyjust__outto__replacea__substring,you__canuse__thestring__replacemethod__instead: >>>S__= 'textly!' >>> S.replace('ly', 'ful') #Replace__all 'ly'with__'ful'in__S 'textful!'The__replacemethod__ismore__generalthan__thiscode__implies.It__takesas__argumentsthe__originalsubstring__(ofany__length)and__anew__substring (ofany__length)to__replacethe__original,and__performsa__globalsearch__andreplace__subjectto__anoptional__thirdargument__thatlimits__thenumber__ofreplacements__made: >>> '--@--@--@--'.replace('@', 'PY', 2) '--PY--PY--@--'In__sucha__role,replace__canbe__usedas__atool__toimplement__simpletemplate__replacements (e.g.,in__form letters).If__youneed__toreplace__one fixed-sizestring__thatcan__occurat__any offset,you__cando__areplacement__again,or__searchfor__thesubstring__withthe__stringfind__methodand__then slice: >>>S__= 'xxxxPYxxxxPYxxxx' >>>where__= S.find('PY') #Search__forposition__>>>where__#Occurs__atoffset__4 4 >>>S__= S[:where] + 'CODE' + S[(where+2):] >>>S__'xxxxCODExxxxPYxxxx'The__findmethod__returnsthe__offsetwhere__asubstring__appears,or__1if__itis__notfound__(itsearches__fromthe__frontby__default,and__itscousin__rfindsearches__in reverse).As__wesaw__earlier,this__isa__substringsearch__operationjust__likethe__in expression,but__findreturns__theposition__ofa__located substring.In__this context,replace__doesthe__job easier,and__cando__morein__the following,replacing__bothmultiple__occurrencesand__multiple targets: >>>S__= 'xxxxPYxxxxPYxxxx' >>> S.replace('PY', 'CODE', 1) #Replace__one 'xxxxCODExxxxPYxxxx' >>> S.replace('PY', 'CODE') #Replace__all 'xxxxCODExxxxCODExxxx' >>> 'xxxxWHATxxxxHOWxxxx'.replace('WHAT', 'CODE').replace('HOW', 'PYTHON') 'xxxxCODExxxxPYTHONxxxx'As__a reminder,replace__returnsa__newstring__objecteach__time (whichis__whytwo__callscan__bestrung__together here).Because__stringsare__immutable, methods,like__sequence operations,never__reallychange__thesubject__stringin__placeeven__ifthey__arecalled__replace !To__savethe__newstring__objectproduced__bya__method call,assign__itto__a name: >>>S__= S.replace('PY', 'CODE') >>>S__'xxxxCODExxxxCODExxxx'The__factthat__concatenationoperations__andthe__replacemethod__generatenew__stringobjects__eachtime__theyare__runis__apotential__downsideof__usingthem__tochange__strings:each__interimresult__mustcreate__a full-fledgedobject__witha__freshcopy__ofits__text.If__youhave__toapply__manychanges__toa__verylarge__string,you__mightbe__ableto__improveyour__scripts__performanceby__convertingthe__stringto__anobject__thatdoes__support in-place changes: >>>S__= 'text' >>>L__= list(S) #Explode__stringinto__alist__>>>L__['t', 'e', 'x', 't']The__built-inlist__function (really,an__objectconstruction__call)builds__anew__listout__ofthe__itemsin__anysequence__(orother__iterable)in__this case,exploding__thecharacters__ofa__stringinto__a list.Once__thestring__isin__this form,you__canmake__multiplechanges__toit__withoutgenerating__anew__copyfor__each change: >>> L[0] = 'h' #Works__for lists,not__strings >>> L[3] = '!' >>>L__['h', 'e', 'x', '!']After__your changes,you__canconvert__backto__astring__ifneeded__(e.g.,to__writeto__a file)by__usingthe__stringjoin__methodto__implodethe__listback__intoa__string: >>>S__= ''.join(L) #Implode__backto__astring__>>>S__'hex!'The__joinmethod__maylook__abit__backwardon__first encounter.Because__itis__amethod__ofstrings__(notof__lists),it__iscalled__throughthe__desireddelimiter__string.join__putsthe__stringsin__alist__(orother__iterable) together,with__thedelimiter__betweenlist__items;in__this case,it__usesan__emptystring__delimiterto__convertfrom__alist__backto__a string.More__generally,any__stringdelimiter__anditerable__ofstrings__will do: >>> 'PY'.join(['which', 'language', 'is', 'best', '?']) 'whichPYlanguagePYisPYbestPY?'Though__subjectto__Python implementation,joining__substringsall__atonce__mightrun__fasterthan__concatenatingthem__individually.The__mutablebytearray__stringnoted__earliermay__helpwith__efficiency too;because__itcan__bechanged__in place,it__offersan__alternativeto__this list/joincombo__forsimple__kindsof__byte-sizedtext__like ASCII.More__String Methods:Parsing__TextAnother__commonrole__forstring__methodsis__asa__simpleform__oftext__parsingthat__is,analyzing__structureand__extracting substrings.To__extractsubstrings__atfixed__offsets,we__canemploy__slicing techniques: >>>line__= 'aaabbb__ccc' >>> col1 = line[:3] >>> col2 = line[4:8] >>> col3 = line[-3:] >>> col1, col2, col3 ('aaa', 'bbb ', 'ccc') Here,the__columnsof__dataappear__atfixed__offsetsand__somay__besliced__outof__theoriginal__string.This__techniquepasses__for parsing,as__longas__thecomponents__ofyour__datahave__known positions.If__insteadsome__sortof__delimiterseparates__the data,you__canpull__outits__componentsby__splitting.This__willwork__evenif__thedata__mayshow__upat__arbitrarypositions__withinthe__string: >>>line__= 'aaabbb__ccc' >>>cols__= line.split() >>>cols__['aaa', 'bbb', 'ccc']The__stringsplit__methodchops__upa__stringinto__alist__of substrings,around__adelimiter__string.We__didnt__passa__delimiterin__theprior__example,so__itdefaults__towhitespace__thestring__issplit__atgroups__ofone__ormore__spaces, tabs,and__newlines,and__weget__backa__listof__theresulting__substrings.In__other applications,more__tangibledelimiters__mayseparate__the data.To__demo,the__nextexample__splits (andhence__parses)the__stringat__commas,a__separatorcommon__insome__databaseroles__(stringconversion__toolscovered__earliercan__changesubstrings__hereinto__numbers): >>>line__= 'Python,3.12,scripting,33' >>> line.split(',') ['Python', '3.12', 'scripting', '33']Delimiters__canbe__longerthan__asingle__character, too: >>>line__= 'youPYarePYaPYstringPYcoder' >>> line.split('PY') ['you', 'are', 'a', 'string', 'coder']Although__thereare__limitsto__theparsing__potentialof__slicingand__splitting,both__runfast__andcan__handlebasic__text-extraction chores. Comma-separatedtext__datais__alsopart__ofthe__CSVfile__format;for__amore__advancedtool__onthis__front,see__alsothe__csvmodule__inPython__sstandard__library.Other__CommonString__MethodsOther__stringmethods__havemore__focusedpurposes__for example,to__stripoff__whitespaceat__theend__ofa__lineof__text,perform__case conversions,test__content,and__testfor__asubstring__atthe__endor__front: >>>line__= "Python'sstrings__are awesome!\n" >>> line.rstrip() #Drop__whitespace (or other) "Python'sstrings__are awesome!" >>> line.upper() #Case__conversions "PYTHON'SSTRINGS__ARE AWESOME!\n" >>> line.isalpha() #Content__testsFalse__>>> line.endswith('awesome!\n') #Suffix__andprefix__testsTrue__>>> line.startswith('Python')True__Alternativetechniques__canalso__sometimesbe__usedto__achievethe__sameresults__asstring__methodsthe__inmembership__operatorcan__beused__totest__forthe__presenceof__a substring,for__instance,and__lengthand__slicingoperations__canbe__usedto__mimic endswith: >>> line.find('awesome') != -1 #Search__viamethod__callor__expressionTrue__>>> 'awesome'in__lineTrue__>>>sub__= 'awesome!\n' >>> line.endswith(sub) #End__testvia__methodcall__orslice__True >>> line[-len(sub):] ==sub__TrueNote__thatnone__ofthe__stringmethods__acceptspatterns__for pattern-basedtext__processing,you__mustuse__thePython__re standard-library module,an__advancedtool__thatwill__beintroduced__brieflyin__Chapter 37but__ismostly__outsidethe__scopeof__this text.Because__oftheir__limitations, though,string__methodsmay__runmore__quicklythan__there__modules__tools. Again,because__thereare__somany__methodsavailable__for strings,we__wont__lookat__everyone__here.You__llsee__someadditional__stringexamples__laterin__this book,but__formore__detailsyou__canalso__turnto__thePython__librarymanual__andother__reference resources,or__simplyexperiment__interactivelyon__your own.As__notedin__Chapter 4, help(S.method)gives__infofor__amethod__ofany__stringobject__S;use__help(str.method)if__youhave__no S.All__thatbeing__said,one__methodis__noticeablyabsent__fromthis__sections__coverage:format__performsstring__formatting,which__combinesmany__operationsin__asingle__step.It__salso__partof__alarger__topicin__Python,which__weturn__to next.String__Formatting:The__TriathlonAlthough__youcan__geta__lotdone__withthe__stringmethods__andsequence__operationsyou__vealready__met,Python__alsoprovides__amore__advancedway__tocombine__stringprocessing__tasks:string__formattingallows__usto__performmultiple__type-specificsubstitutions__ona__stringin__asingle__step.It__snever__strictly required,but__itcan__be convenient,especially__whenlaying__outtext__tobe__displayedto__aprogram__s users.We__veused__stringformatting__informallyin__thisbook__already,but__its__finallytime__todig__intoits__details.As__suggestedin__earlier examples,this__storyis__regrettablyconvoluted__byPython__s history:there__aretoday__threedifferent__string-formattingtools__thatbroadly__overlapin__functionality.This__curiousstate__ofaffairs__reflectsa__commonpattern__insoftware__developmentnew__toolsarise__thatboldly__promiseto__beradical__improvementsover__the past,only__tobe__supplantedby__evennewer__toolsthat__boldlymake__theexact__same claims.The__neteffect__handicapslanguages__with redundancy,and__userswith__unnecessarilysteep__learning curves.While__learningresources__couldpresent__justone__ofmany__options,that__wouldboth__imposeauthors__opinionsand__doa__vastdisservice__to readers:even__ifyou__reable__topick__justone__ofthe__formattingtools__foryour__own work,the__factthat__theothers__havebeen__availablefor__decadesand__havebeen__usedby__millionsof__programmersvirtually__guaranteesthat__youll__beseeing__themin__thewild__whenyou__beginreusing__otherpeople__s code.Try__asit__may,the__newcannot__erasethe__old. Hence,this__chapterpresents__allthree__formattingtools__forthe__sakeof__inclusiveness.If__youre__newto__Pythonor__programmingin__general,you__probablyshould__focuson__thecurrent__latest-and-greatest f-stringoption__notbecause__its__necessarily better,but__becauseit__smore__likelyto__garnerdevelopment__attentionand__lesslikely__tobe__deprecatedin__a backward-incompatiblefuture__(itspredecessors__havebeen__sparedthis__fateto__date,but__Pythonhas__ahistory__here).But__thats__notto__saythat__theothers__areout__ofthe__race:the__expressionand__methodalternatives__mayfeel__morecomfortable__toreaders__withbackgrounds__insome__other tools,and__bothare__pervasivein__thevast__reamsof__Pythoncode__writtenover__thelast__thirty-some years.Learning__allthree__optionshedges__yourbets__best. String-FormattingOptions__Asa__previewof__whatwe__regoing__toexplore__inthis__section,here__aretoday__sentries__inthe__string-formatting race:Formatting__expression: ' %s %s ' % (value, value)The__originaltechnique__availablesince__Pythons__inception,this__formis__looselybased__uponthe__Clanguage__sprintf__modeland__seeswidespread__usein__muchexisting__code.Values__onthe__rightreplace__targetson__the left.Formatting__method: ' {} {} '.format(value, value)A__newertechnique__addedin__Python 3.0,this__formis__derivedin__partfrom__a same-namedtool__in C#/.NET.It__largelyoverlaps__withthe__expressions__functionalitybut__aimsto__addressusage__modessubjectively__deemed subpar.Formatting__literal: f' {value} {value} 'The__verylatest__(so far)added__inPython__3.6,this__formis__knownas__f-strings.It__sharesmuch__withthe__methodbut__apesa__hostof__languagesthat__supportstring__interpolationsubstituting__inlineexpressions__withtheir__results.You__canalso__formatstrings__manuallywith__string methods,though__its__toocumbersome__to count.And__technically,an__additional tool, string.Template,predates__themethod__anddrives__theformatting__sets__lengthup__toa__whoppingfour__butit__sso__scantlyused__thatit__getsless__billingthan__thethree__primaryoptions__aboveand__isrelegated__toa__briefsidebar__here (andyou__dbe__excusedfor__pretendingit__doesnt__existat__all,given__theheft__ofthe__formatting toolbox!).The__followingsections__presentall__threeformatting__optionsabove__in turn.While__itmay__betempting__tojump__straightto__whateverthe__blogospheremay__berecommending__asyou__readthese__words,these__sectionspartly__buildon__eachother__(e.g., f-stringsuse__themethod__sformat__specifierand__assumeits__earlier coverage),so__alinear__readis__suggested.The__String-FormattingExpression__Since string-formattingexpressions__arethe__originalin__this department,we__llstart__with them.Python__definesthe__%binary__operatorto__workon__strings.You__mayrecall__thatthis__isalso__theremainder__of division,or__modulus,operator__for numbers.When__appliedto__strings,the__%operator__providesa__simpleway__toformat__valuesas__stringsaccording__toa__format definition.It__sa__muchmore__conciseway__tocode__multiplesubstitutions__thanprocessing__parts individually.Formatting__expressionbasics__Toformat__stringswith__an expression: 1.On__theleft__ofthe__% operator,provide__aformat__stringcontaining__oneor__moreembedded__conversion targets,each__ofwhich__startswith__a % (e.g., %d). 2.On__theright__ofthe__% operator,provide__theobject__thatyou__wantPython__toinsert__intothe__formatstring__onthe__leftin__placeof__theconversion__target;for__multiple targets,provide__multipleobjects__ina__tuple.For__instance,in__thefollowing__formatting example,the__integer 3replaces__the %din__theformat__stringon__the left,and__thestring__'format'replaces__the %s.The__resultis__anew__stringthat__reflectsthese__two substitutions,which__maybe__printedor__savedfor__usein__other roles: >>> 'Thereare__%dways__to %s!' % (3, 'format') #Formatting__expression 'Thereare__3ways__to format!'Technically__speaking,string__formattingin__anyflavor__isusually__optionalyou__cangenerally__dosimilar__workwith__multipleconcatenations__and conversions. However,formatting__allowsus__tocombine__manysteps__intoa__single operation.It__spowerful__enoughto__warranta__fewmore__introductory examples: >>>option__= 'expression' >>> 'Meetthe__formatting %s!' %option__#String__substitution 'Meetthe__formatting expression!' >>> '%d %s %g you' % (1, 'formatter', 4.0) # Type-specificsubstitutions__'1formatter__4 you' >>> '%s -- %s -- %s' % (42, 3.14159, [1, 2, 3]) #All__typesmatch__a %starget__'42 -- 3.14159 -- [1, 2, 3]'The__firstexample__hereplugs__astring__intothe__targeton__the left,replacing__the %s marker.In__thesecond__example,three__valuesare__insertedinto__thetarget__string.Notice__thatwhen__youre__insertingmore__thanone__value,you__needto__groupthe__valueson__theright__inparentheses__that is,put__themin__a tuple.The__%operator__sright__sidegenerally__expectsa__tupleof__oneor__moreitems__(ora__dictionaryof__itemsfor__key references,covered__ahead),but__allowsa__singlenontuple__itemif__thereis__justone__substitution target.You__llknow__whichform__touse__whencoding__the expression,of__course,but__thisdifference__wasnevertheless__deemeda__quirksufficient__tojustify__otherformatting__optionsover__time.The__thirdexample__againinserts__threevalues__an integer,a__floating-point number,and__alist__butnotice__thatall__ofthe__targetson__theleft__are %s,which__standsfor__conversionto__string.As__everytype__ofobject__canbe__convertedto__astring__(theone__usedwhen__printing),every__objecttype__workswith__the %sconversion__code.Because__of this,unless__youneed__todo__special formatting, %sis__oftenthe__onlycode__youneed__toremember__forthe__formatting expression. Again,keep__inmind__thatformatting__alwaysmakes__anew__string,rather__thanchanging__thestring__onthe__left;because__stringsare__immutable,it__mustwork__this way.As__before,assign__theresult__toa__variablename__ifyou__needto__retain it.Formatting__expressioncustom__formatsFor__moreadvanced__type-specific formatting,you__canuse__anyof__theconversion__typecodes__listedin__Table 7-4in__formatting expressions;they__appearafter__the %character__insubstitution__targets.C__programmerswill__recognizemost__ofthese__becausePython__stringformatting__supportsall__theusual__Cprintf__formatcodes__(butreturns__the result,instead__ofdisplaying__itlike__printf).Some__ofthe__formatcodes__inthe__tableprovide__alternativeways__toformat__thesame__type;for__instance, %e, %f,and__%gprovide__alternativeways__toformat__floating-point numbers.Table__7-4. Formatting-expressiontype__codesCode__Meanings__String (orany__objects__str(X) string)r__Sameas__s,but__uses repr,not__stra__Sameas__s,but__uses ascii,not__strc__Character (integercode__or string)d__Decimal (signed base-10 integer)i__Integer (see d)u__Sameas__d (obsolete:no__longer unsigned)o__Octalinteger__(base 8)x__Hexinteger__(base 16)X__Sameas__x,but__withuppercase__letterse__Floatingpoint__with exponent,lowercase__ESame__as e,but__usesuppercase__lettersf__Floating-pointdecimal__FSame__as f,but__usesuppercase__lettersg__Floating-pointe__orf__G Floating-pointE__orF__%Literal__% (codedas__%%)All__told,conversion__targetsin__theformat__stringon__theexpression__sleft__sidesupport__avariety__ofconversion__operationswith__afairly__sophisticatedsyntax__alltheir__own.In__formal terms,the__generalstructure__ofconversion__targetslooks__likethe__following,where__[ ]denotes__anoptional__part (itstwo__square-bracketcharacters__arenot__includedin__theexpression__s code),and__nospaces__areallowed__betweenparts__(thoughsome__partsmay__contain spaces): %[(keyname)][flags][width][.precision]typecodeOne__ofthe__typecode__charactersin__thefirst__columnof__Table 7-4shows__upat__theend__ofthis__targetstring__s format,at__typecode.Between__the %and__thistype__code character,you__cando__any (or none)of__the following:Provide__akey__namefor__indexingthe__dictionaryused__onthe__rightside__ofthe__expression.List__flagsthat__specifyzero__padding (0),left__justification ( ),numeric__sign (+),or__ablank__beforepositive__numbersand__afor__negatives (a space),where__overrides 0,and__+overrides__a space.Give__atotal__butminimum__fieldwidth__forthe__substituted text.Set__thenumber__ofdigits__(precision)to__displayafter__adecimal__pointfor__floating-point numbers.Both__thewidth__andprecision__partscan__alsobe__codedas__a *to__specifythat__theyshould__taketheir__valuesdynamically__fromthe__nextitem__inthe__inputvalues__onthe__expressions__rightside__(usefulwhen__thisisn__tknown__untilyour__codeis__run,but__unavailablewhen__keynamesare__used).And__ifyou__dont__needany__ofthese__extra tools,a__simple %sin__theformat__stringwill__bereplaced__bythe__correspondingvalue__sdefault__print string,regardless__ofits__type.Advanced__formattingexpression__examplesFormatting__targetsyntax__isdocumented__infull__inthe__Pythonstandard__manualsand__otherreference__resources,but__todemonstrate__common usage,let__sexplore__afew__examples.The__firstformats__integersusing__the default,and__thenin__a six-character__fieldwith__leftjustification__andzero__padding: >>>x__= 1234 >>>res__= 'integers: ...%d...%-6d...%06d' % (x, x, x) >>>res__'integers: ...1234...1234 ...001234'The__%e, %f,and__%gformats__display floating-pointnumbers__indifferent__ways,as__thefollowing__interactiondemonstrates__%Eis__thesame__as %ebut__theexponent__is uppercase,and__gchooses__formatsby__numbercontent__(its__formallydefined__touse__exponentialformat__eif__theexponent__isless__than 4or__notless__than precision,and__decimalformat__f otherwise,with__adefault__minimum total-digitsprecision__of 6; no, really!): >>>x__= 1.23456789 >>>x__#Default__REPLdisplay__1.23456789 >>> '%e | %f | %g' % (x, x, x) '1.234568e+00 | 1.234568 | 1.23457' >>> '%E' %x__'1.234568E+00'For__floating-point numbers,you__canachieve__avariety__ofadditional__formattingeffects__byspecifying__left justification,zero__padding,numeric__signs,total__field width,and__digitsafter__thedecimal__point.For__simpler tasks,you__mightget__bywith__simplyconverting__tostrings__witha__%stype__codeor__thestr__built-infunction__weused__earlier: >>> '%-6.2f | %05.2f | %+06.1f' % (x, x, x) '1.23 | 01.23 | +001.2' >>> '%s' % x, str(x) ('1.23456789', '1.23456789')When__sizesare__notknown__until runtime,you__canuse__adynamically__computedwidth__andprecision__byspecifying__themwith__a *in__theformat__stringto__forcetheir__valuesto__betaken__fromthe__nextitem__inthe__inputsto__theright__ofthe__%operator__the 4in__thetuple__heregives__precision: >>> '%f, %.2f, %.*f' % (1/3.0, 1/3.0, 4, 1/3.0) '0.333333, 0.33, 0.3333'As__usual,experiment__withsome__ofthese__examplesand__operationson__yourown__formore__insight. Dictionary-basedformatting__expressionsAs__amore__advanced extension, %string__formattingalso__allowsconversion__targetson__theleft__torefer__tothe__keysin__adictionary__codedon__theright__anduse__thecorresponding__values. Syntactically,this__formrequires__()key__referenceson__theleft__of %,and__asingle__dictionary (orother__mapping)on__the right. Functionally,it__allowsformatting__tobe__usedas__abasic__template tool.You__vemet__dictionariesonly__brieflythus__farin__Chapter 4,but__thefollowing__demosthe__idea: >>> '%(qty)smore__%(tool)s' % {'qty': 1, 'tool': 'formatter'} '1more__formatter' Here,the__(qty)and__(tool)in__theformat__stringon__theleft__referto__keysin__thedictionary__literalon__theright__andfetch__theirassociated__values.Programs__thatgenerate__textsuch__asHTML__orXML__oftenuse__this form:they__buildup__adictionary__ofvalues__andsubstitute__themall__atonce__witha__singleformatting__expression,using__keyreferences__anda__templatestring__eitherloaded__froma__fileor__codedin__the script.The__followingdemos__theidea__(noticethat__itsfirst__commentis__abovethe__triplequote__tokeep__itout__ofthe__string,and__promptsmay__notappear__inyour__REPL): >>> #Template__withsubstitution__targets >>>reply__= """ ...Hello__%(name)s! ...Welcome__to %(year)s ... """ >>>values__= {'name': 'Pat', 'year': 2024} #Build__upvalues__tosubstitute__>>> print(reply % values) #Perform__substitutionsHello__Pat!Welcome__to 2024This__trickis__alsosometimes__usedin__conjunctionwith__thevars__built-in function,which__returnsa__dictionarycontaining__allthe__variablesthat__existin__theplace__itis__called: >>>name__= 'Pat' >>>year__= 2024 >>> vars() {'name: 'Pat', 'year': 2024,plus__built-innames__setby__Python }When__usedon__theright__sideof__aformat__operation,this__allowsthe__formatstring__torefer__tovariables__byname__using dictionary-key syntax: >>> '%(name)sfrom__%(year)s' % vars() #Variables__arekeys__in vars() 'Patfrom__2024'Although__formattingexpressions__arepositional__by nature,dictionaries__alsoallow__themto__reusevalues__morethan__once (seeChapter__5for__anotherdemo__ofthis__in action): >>> '%(value)f, %(value).2f, %(value).f' % ({'value': 1 / 3.0}) '0.333333, 0.33, 0'We__llstudy__dictionariesin__moredepth__inChapter__8.See__also Hex, Octal,and__Binaryfor__examplesthat__convertto__hexadecimaland__octalnumber__stringswith__the %xand__%oformatting__expressiontarget__codes,which__wewon__trepeat__here.Additional__formattingexpression__examplesalso__appearahead__ascomparisons__tothe__formattingmethod__and f-stringthe__firstof__whichis__thischapter__snext__topic.The__String-FormattingMethod__As noted,Python__3.0added__asecond__wayto__formatstrings__thatsome__seeas__morePython__specific.Unlike__formatting expressions,the__formattingmethod__isnot__asclosely__basedupon__theC__languages__printf model;is__sometimesmore__explicitin__intent;and__avoidsthe__value-or-tuplequirk__of %:substituted__valuesare__just arguments,whether__oneor__many.On__theother__hand,the__newtechnique__stillrelies__onprintf__conceptslike__typecodes__andformatting__specifications. Moreover,it__largelyoverlaps__withformatting__expressions;often__yieldsmore__verbose code;and__inpractice__canbe__justas__complexin__most roles.And__ifwe__reall__being honest,the__value-or-tuplequirk__ofthe__%expression__ismuch__moreof__aconcern__intheory__than practice. Luckily,the__twoare__similarenough__thatmany__coreconcepts__overlap.Formatting__methodbasics__Thestring__objects__formatmethod__atthe__heartof__thisoption__isbased__onfunction__call syntax,instead__ofan__expression. Specifically,it__usesthe__calls__subjectstring__asa__templateand__takesany__numberof__argumentsthat__representvalues__tobe__substitutedaccording__tothe__template.This__optionrequires__knowledgeof__functionsand__callsbut__ismostly__straightforward.Within__thesubject__string,curly__bracesdesignate__substitutiontargets__andarguments__tobe__insertedeither__byrelative__position ({}),absolute__position (e.g., {1}),or__keyword (e.g., {name}).As__youll__learnwhen__weexplore__argumentpassing__indepth__inChapter__18,arguments__tofunctions__andmethods__maybe__passedby__position (e.g., value)or__keyword (e.g., name=value),and__Pythons__abilityto__collectarbitrarily__manyarguments__allowsfor__general method-call__patterns.As__initial examples: >>>template__= '{}, {},and__{}' #Relative__position >>> template.format('expr', 'method', 'fstring') 'expr, method,and__fstring' >>>template__= '{0}, {1},and__{2}' #Absolute__position >>> template.format('expr', 'method', 'fstring') 'expr, method,and__fstring' >>>template__= '{first}, {second},and__{third}' #Keyword__name >>> template.format(first='expr', second='method', third='fstring') 'expr, method,and__fstring' >>>template__= '{first}, {0},and__{third}' #Combos__({0}or__{}) >>> template.format('method', first='expr', third='fstring') 'expr, method,and__fstring'By__comparison,the__lastsection__sformatting__expressioncan__bea__bitmore__concise,but__usesdictionaries__insteadof__keywordarguments__fornamed__references,and__asyou__llsee__ina__momentdoesn__tallow__quiteas__muchflexibility__forvalue__sourcesin__thetemplate__stringitself__(whichmay__bean__assetor__liability,depending__onyour__perspective): >>>template__= '%s, %s,and__%s' #Equivalent__%s >>>template__% ('expr', 'method', 'fstring') 'expr, method,and__fstring' >>>template__= '%(first)s, %(second)s,and__%(third)s' >>>template__% dict(first='expr', second='method', third='fstring') 'expr, method,and__fstring'Note__theuse__of dict()to__makea__dictionaryfrom__keywordarguments__here,introduced__inChapter__4and__coveredin__fullin__Chapter 8;it__san__oftenless__clutteredalternative__tothe__{ } literal. Naturally,the__subjectstring__inthe__formatmethod__callcan__alsobe__aliteral__thatcreates__atemporary__string,and__arbitraryobject__typescan__besubstituted__attargets__muchlike__theexpression__s %s code: >>> '{pi}, {}and__{years}'.format(62, pi=3.14, years=[1995, 2024]) '3.14, 62and__[1995, 2024]'Just__aswith__the %expression__andother__string methods,format__createsand__returnsa__newstring__object,which__canbe__printedimmediately__orsaved__forfurther__work (asanother__reminder,strings__are immutable,so__formatreally__mustmake__anew__object).String__formattingin__anyof__itsforms__isnot__justfor__display: >>>X__= '{pi}, {}and__{years}'.format(62, pi=3.14, years=[1995, 2024]) >>>X__'3.14, 62and__[1995, 2024]' >>> X.split('and__') ['3.14, 62', '[1995, 2024]'] >>>Y__= X.replace('and', 'butunder__no circumstances') >>>Y__'3.14, 62but__underno__circumstances [1995, 2024]'Adding__keys, attributes,and__offsetsLike__%formatting__expressions,format__callscan__becomemore__complexto__supportmore__advanced usage.For__instance,format__stringscan__nameobject__attributesand__dictionarykeys__asin__normalPython__syntax,square__bracketsname__dictionarykeys__anddots__denoteobject__attributesof__anitem__referencedby__positionor__keyword.The__firstof__thefollowing__examplesindexes__adictionary__onthe__keykind__andthen__fetchesthe__attributeplatform__fromthe__alreadyimported__sysmodule__object.The__seconddoes__the same,but__namesthe__objectsby__keywordinstead__of position: >>>import__sys # Standard-librarymodule__>>> 'This {1[kind]}runs__{0.platform}'.format(sys, {'kind': 'laptop'}) 'Thislaptop__runs darwin' >>> 'This {map[kind]}runs__{sys.platform}'.format(sys=sys, map={'kind': 'phone'}) 'Thisphone__runs linux'Square__bracketsin__formatstrings__canalso__nameoffsets__toindex__lists (andother__sequences),but__onlya__singlepositive__offsetworks__syntacticallywithin__each [],so__thisfeature__isnot__asgeneral__asyou__might think.To__referencenegative__offsetsor__slices,or__touse__arbitraryexpression__resultsin__general,you__mustrun__expressionsoutside__theformat__string itself,just__asyou__wouldfor__%expressions__(notethe__useof__*partshere__tounpack__atuple__sitems__intoindividual__function arguments;you__lllearn__moreabout__thisform__whenwe__studyfunction__argumentsin__Chapter 18): >>>somelist__= list('HACK') >>>somelist__['H', 'A', 'C', 'K'] >>> 'zero={0[0]}, two={0[2]}'.format(somelist) 'zero=H, two=C' >>> 'first={}, last={}'.format(somelist[0], somelist[-1]) # [-1]fails__infmt__'first=H, last=K' >>>parts__= (somelist[0], somelist[-1], somelist[1:3]) # [1:3]fails__infmt__>>> 'first={}, last={}, middle={}'.format(*parts) #Or__{0}, {1}, {2} "first=H, last=K, middle=['A', 'C']"If__yousimply__cannotdo__withoutfull__generalityinside__format strings,stay__tunedfor__the f-stringand__itsarbitrary__nestedexpressions__(albeitin__acode__literalinstead__ofa__method object,and__atthe__costof__moreredundancy__andless__utility).Formatting__methodcustom__formatsAnother__similaritywith__%expressions__isthat__formatlets__youcan__achievemore__specificlayouts__withextra__format-string syntax.For__theformatting__method,we__usea__colonafter__thepossibly__emptysubstitution__targets__identification,followed__bya__formatspecifier__thatcan__namethe__field size, justification,and__aspecific__type code.Here__sthe__formalstructure__ofwhat__canappear__asa__substitutiontarget__ina__formatstring__itsfour__partsare__alloptional__(denotedby__surrounding [] here,which__arent__codedin__theformat__string)and__mustappear__withoutintervening__spaces: {[fieldname][component][!conversionflag][:formatspec]}Text__outsidea__{}substitution__targetis__takenliterally__andmay__usedoubled__{{and__}}to__escapebraces__(eachis__replacedwith__asingle__brace).Within__a {}substitution__target:fieldname__Isan__optionalnumber__orkeyword__identifyingan__argument,which__maybe__omittedto__referencearguments__byrelative__positioncomponent__Isa__stringof__zeroor__more .nameor__[index] (brackets required!) references,which__areused__tofetch__attributesand__indexedvalues__ofan__argument,and__maybe__omittedto__usethe__wholeargument__valueconversionflag__Startswith__a !if__present,which__isfollowed__by s, r,or__ato__call str, repr,or__ascii built-infunctions__onthe__value,respectively__(thismay__bypassthe__values__normal formatting)formatspec__Startswith__a :if__present,followed__bytext__thatspecifies__howthe__valueshould__be presented,including__detailssuch__asfield__width, alignment, padding,decimal__precision,and__so on,and__endswith__anoptional__typecode__Theformatspec__componentafter__thecolon__characterhas__arich__formatall__itsown__andis__formallydescribed__as follows.As__youll__see later,this__partis__reusedby__f-strings (again, [ ]in__thisdenotes__anoptional__componentwhose__squarebrackets__arenot__coded literally,and__spacesaren__tallowed__betweenparts__butmay__appearwithin__some): [[fill]align][sign][z][#][0][width][grouping][.precision][typecode]Within__thisformatspec__partof__the {}substitution__target,the__salientparts__are these:fill__Canbe__anyfill__characterother__than {or__}align__Maybe__<, >, =,or__^,for__left alignment,right__alignment,padding__aftera__sign character,or__centeredalignment__signCan__be + (tosign__all numbers), (tosign__only negatives),or__aspace__(touse__aspace__for positives)grouping__Maybe__,or___to__requesta__commaor__underscore separator,added__forthousands__indecimal__numbertype__codes,and__four-digitgroups__innondecimal__numbertype__codes (whichsupport__only _)width__andprecision__Similarto__thosein__the %expression__ofthe__preceding section,as__shownby__examplesahead__typecodeSimilar__tothose__inthe__% expression,with__theexceptions__describedbelow__thislist__OthersFor__numbers,a__0before__widthenables__sign-aware zero-padding (redundantlywith__somefill__usage),and__#invokes__analternate__form (e.g.,adding__0band__0Xprefixes__forbinary__andhex__typecodes__band__X).The__formatspecmay__alsocontain__nested {}substitution__targetsfor__anyof__its parts,to__use argument-listvalues__dynamically (muchlike__the *in__formatting expressions).These__nested {}use__fieldnameto__identifyarguments__fromwhich__valuesare__pulled,and__theirformatted__resultsare__usedin__placeof__thenested__{}.Nesting__maybe__onlyone__level deep,and__f-strings (ahead)use__anarbitrary__expressioninstead__offieldname__ina__nested {}.The__methods__typecodeoptions__largelyoverlap__withthose__usedin__%expressions__andlisted__earlierin__Table 7-4,but__theformatting__methodadds__ab__todisplay__integersin__binaryformat__(muchlike__usingthe__bin built-in),adds__a %to__display percentages,uses__onlyd__for base-10integers__(iand__uare__unused),uses__!conversion__flagsfor__some cases,and__requiresa__stringobject__fors__(toflexibly__allowany__typelike__theexpression__s %s,either__omitthe__typecode__orformatspec__in full,or__usea__!sconversion__flagas__described earlier).See__Pythons__librarymanual__formore__onsubstitution__syntaxthat__well__omit here.In__additionto__thestring__sformat__method,a__singleobject__mayalso__beformatted__withthe__format(object, formatspec) built-infunction__(whichthe__methoduses__internally),and__maybe__customizedin__user-definedclasses__withthe____format__ operator-overloadingmethod__(seePart__VI).Different__objectsmay__usedifferent__format specifiers,but__mostfollow__norms.Advanced__formattingmethod__examplesAs__youcan__tell,the__syntaxin__formattingmethods__canbe__complex.Because__yourbest__allyin__suchcases__isoften__theinteractive__prompt,let__sturn__tosome__examples.In__the following, {0:10}means__thefirst__positionalargument__ina__field 10characters__wide; {1:<10}means__thesecond__positionalargument__left-justifiedin__a 10-character-wide field; ^10center__alignsin__10;and__{0.platform:>10}means__theplatform__attributeof__thefirst__argument, right-justifiedin__a 10- character-widefield__(noticeagain__theuse__of dict()to__makea__dictionaryfrom__keyword arguments): >>> '{0:10} = {1:10}'.format('text', 123.4567) 'text = 123.4567' >>> '{0:>10} = {1:<10}'.format('text', 123.4567) 'text__= 123.4567 ' >>> '{1[kind]:^10} = {0.platform:^10}'.format(sys, dict(kind='laptop')) 'laptop__=darwin__'As__demoed earlier,you__canomit__theargument__numberif__youre__selectingthem__fromleft__toright__thoughthis__maymake__yourcode__less explicit,thereby__negatingone__ofthe__purportedpluses__offormat__versus %.Code__readersmust__countto__match {}sto__argumentsoff__tothe__right (somethingthe__f-strings__inlineexpressions__wholly avoid): >>> '{:10} = {:10}'.format('text', 123.4567) 'text = 123.4567' Floating-pointnumbers__supportthe__sametype__codesand__formattingspecificity__informatting__methodcalls__asin__% expressions.For__instance,in__thefollowing__{2:g}means__thethird__argumentformatted__bydefault__accordingto__theg__floating-point__representation, {:.2f}designates__thef__floating-pointformat__withjust__twodecimal__digits (and rounding),and__{:06.2f}denotes__afield__witha__widthof__sixcharacters__andzero__paddingon__the left: >>> '{0:e}, {1:.3e}, {2:g}'.format(3.14159, 3.14159, 3.14159) '3.141590e+00, 3.142e+00, 3.14159' >>> '{:f}, {:.2f}, {:06.2f}'.format(3.14159, 3.14159, 3.14159) '3.141590, 3.14, 003.14' Hex, octal,and__binaryformats__aresupported__bythe__formattingmethod__aswell__(%has__allthese__except binary).In__fact,string__formattingis__analternative__tosome__ofthe__built-infunctions__thatformat__integersto__agiven__base: >>> '{:X}, {:o}, {:b}'.format(255, 255, 255) # Hex, octal,binary__'FF, 377, 11111111' >>> hex(255), int('FF', 16), 0xFF #Other__to/fromhex__('0xff', 255, 255) >>> oct(255), int('377', 8), 0o377 #Other__to/fromoctal__('0o377', 255, 255) >>> bin(255), int('11111111', 2), 0b11111111 #Other__to/frombinary__('0b11111111', 255, 255)The__formattingmethod__alsosupports__separatorinsertions__(but %currently__does not):you__canadd__commasand__underscoresbetween__thousandsgroups__in numbers,and__underscoresbetween__four-digitgroups__in hex, octal,and__binary formats,and__absoluteargument__numberslet__youreuse__valuespassed__in (%uses__dictionariesto__dothe__same): >>> '{:,.2f}'.format(12345.678) '12,345.68' >>> '{0:,} {0:_} {1:_x} {1:_b}'.format(2 ** 32, 0x1FFFF) '4,294,967,296 4_294_967_296 1_ffff 1_1111_1111_1111_1111'Formatting__parameterscan__eitherbe__hardcodedin__formatstrings__ortaken__fromthe__argumentslist__dynamicallyby__nestedformat__syntaxmuch__likethe__*syntax__informatting__expressionswidth__and precision: >>> '{:.4f}'.format(1 / 3.0) #Parameters__hardcoded '0.3333' >>> '%.4f' % (1 / 3.0) #Ditto__forexpression__'0.3333' >>> '{0:.{1}f}'.format(1 / 3.0, 4) #Take__valuefrom__arguments '0.3333' >>> '%.*f' % (4, 1 / 3.0) #Ditto__forexpression__'0.3333'In__fact,format__allowsany__componentof__aformatspec__stringto__betaken__fromarguments__at runtime,rather__thanhardcoded__atprogramming__time (thisis__moregeneral__than %).In__the following,a__numberis__zero filled, left-justified, signed,twelve__wide,comma__separated,with__twodecimal__digitsboth__staticallyand__dynamically (andwith__andwithout__argumentnumbering__thatnearly__breachesthis__pages__width limits!): >>> '{0:0<+12,.2f}!'.format(1234.564) '+1,234.56000!' >>> '{0:{1}{2}{3}{4}{5}.{6}{7}}!'.format(1234.564, 0, '<', '+', 12, ',', 2, 'f') '+1,234.56000!' >>> '{:{}{}{}{}{}{}{}{}}!'.format(1234.564, 0, '<', '+', 12, ',', '.', 2, 'f') '+1,234.56000!' Finally,Python__s built-informat__functionnoted__earliercan__alsobe__usedto__formata__single item.It__maybe__simplerthan__usingthe__formatmethod__inthis__case,and__isroughly__similarto__formattingone__itemwith__the % expression: >>> '{:.2f}'.format(1.2345) #String__method '1.23' >>> format(1.2345, '.2f') # Built-infunction__'1.23' >>> '%.2f' % 1.2345 #Expression__'1.23' >>> f'{1.2345:.2f}' # Preview: f-string '1.23' Technically,the__format built-inruns__thesubject__objects____format__ method,which__the str.formatmethod__doesinternally__foreach__formatted item.It__sstill__moreverbose__thanthe__original %expression__sequivalent__here, though,and__the f-string__alternativemay__bestboth__whenthe__valueis__avariable__sname__whichleads__usto__thenext__section.The__F-StringFormatting__LiteralIf__youve__survivedthe__formattingstory__this far,there__ssome__good news:the__thirdand__lastvariant__ismostly__justa__takeoffon__the second.The__f-stringis__a text-string__literalthat__embedssubstitution__valuesin__theformat__string itself,rather__thanlisting__them separately.The__codeit__usesto__specifycustom__formatting, though,is__thesame__asthat__usedfor__theformatting__method. Hence,much__ofwhat__youjust__learnedfor__themethod__applieshere__in full. F-strings,added__inPython__3.6,perform__whats__generallycalled__stringinterpolation__replacingthe__textof__anexpression__withthe__resultof__runningit__live,when__the f-stringitself__is run.These__expressionsare__codedinside__the f-string__andcan__bearbitrary__Pythonexpression__code.The__effectisn__tfunctionally__differentfrom__listingreplacement__valuesafter__a %in__the expression,or__asarguments__inthe__format method.Because__theyembed__valueswhere__theyare__tobe__substituted, though, f-stringsare__oftenshorter__andmay__seemeasier__toread__tosome__observers. Syntactically, f-stringsbegin__withthe__letterf__(uppercaseor__lowercase,but__usuallythe__latter)before__any string-literalform__(single, double,or__triple quotes).The__fprefix__maybe__combinedwith__rin__anyorder__tocode__formattedraw__stringsthat__ignorebackslashes__(e.g., rf),and__f-stringsconcatenate__implicitlywith__anadjacent__text-stringliteral__ofany__kind (butuse__thef__prefixon__otherconcatenated__literalsif__youwant__themto__be f-stringstoo__evenon__continuation lines).As__apreview__ofChapter__37,the__fcannot__becombined__with byte-stringprefix__b (whichmeans__thatthe__f-string,like__theformat__methodbut__unlikethe__% expression,works__onlyfor__text,not__bytes);and__cannotbe__mixedwith__the backward-compatibleand__seldom-usedu__(whichwould__yieldprefixes__inappropriatefor__this family-oriented text). F-stringformatting__basicsWithin__the f-string literal,curly__bracesare__usedto__denotesubstitutions__justlike__theformatting__method.Unlike__the method, though, {}scontain__inlinePython__expressionswhose__formattedruntime__resultsreplace__thebracketed__parts: >>>what__= 'coding' >>>tool__= 'Python' >>> f'Learning {what}in__{tool}' 'Learningcoding__in Python'As__usual,the__f-stringresult__isa__newstring__thatwe__reletting__theREPL__display,but__itcan__alsobe__assignedto__aname__tobe__usedelsewhere__inour__code. F-stringsalso__frequentlyappear__inprint__callsto__displayformatted__text,though__sometimesmore__oftenthan__they should:there__sno__reasonto__usean__f-stringfor__simple space-separated prints.In__itssimplest__formlike__this,an__f-strings__expressionsenclosed__in {}are__evaluatedand__thenformatted__pertheir__print-string defaults.This__isnt__muchdifferent__fromthe__equivalentexpression__or method,but__isslightly__easieron__yourkeyboard__andmay__beslightly__easieron__your eyes: >>> 'Learning %sin__%s' % (what, tool) #Expression__equivalent 'Learningcoding__in Python' >>> 'Learning {}in__{}'.format(what, tool) #Method__equivalent 'Learningcoding__in Python' Importantly,any__expressioncan__beused__inthe__curlybraces__andworks__asit__wouldoutside__the f-string: >>>task__= f'Learning {what.upper() + '!'}in__{tool + str(3.12)}' >>>task__'Learning CODING!in__Python3.12' Moreover, {}expressions__areevaluated__bothwhere__theyappear__(subjectto__the name-scopingdetails__youll__meetlater__inthis__book)and__whenthe__f-stringis__runto__makea__string (notwhen__yourcode__isfirst__readby__Python).Like__theformatting__expressionand__method,it__sa__runtimeoperation__thatuses__thecurrent__valuesof__anyvariables__it names: >>>what__= 'f-strings' >>>task__# F-stringsbuilt__whenrun__(only) 'Learning CODING!in__Python3.12' >>>task__= f'Learning {what.upper() + '!'}in__{tool + str(3.12)}' >>>task__'Learning F-STRINGS!in__Python3.12'As__a preview,this__runtimenature__alsomeans__that f-strings,unlike__allother__text-string__literals,don__twork__asChapter__15s__docstrings.This__makessense__ifyou__keepin__mindthat__f-stringsare__runtime code,more__likethe__%expression__andformat__method calls.When__codedin__a function,for__example,an__f-stringwon__tbe__rununtil__thatfunction__is called.One__syntaxquirk__here:as__thisexample__demos,you__canembed__quoteswithin__an f-strings__{}even__ifthey__arethe__sameas__thequotes__usedfor__the f-stringat__largebut__thisis__newas__ofPython__3.12.In__earlier Pythons,backslash__escapesdidn__thelp__fornested__quotes,though__other enclosing-quotetricks__did,and__noneof__thisapplies__outsidea__{}: f'Learning {what + '!'}' #OK__asof__Python 3.12 f'Learning {what + '!'}' #An__errorbefore__Python 3.12 f'Learning {what + \'!\'}' #And__this doesn'tmake__itwork__f"Learning {what + '!'}" #OK__before (and after)Python__3.12 f'''Learning {what + '!'}''' #Ditto__f'Learning '{what + '!'}'' #An__errorin__3.12+ f'Learning \'{what + '!'}\'' #OK__ifescape__quotesoutside__{}Also__newas__ofPython__3.12,a__backslashcan__beused__inan__f-strings__{}part__andworks__justlike__itdoes__outsidethe__{},as__doboth__commentsand__newlines (thefollowing__maystretch__thelimits__of f-strings,but__provethese__points): >>> f'{'\n'.join([what] * 3) + '\x21'}' 'f-strings\nf-strings\nf-strings!' >>> f'Learning { #Your__commenthere__... what.upper() + '!' ... }in__{tool + str(3.12)}' 'Learning F-STRINGS!in__Python3.12'In__other words,if__youlike__f-strings,you__lllike__thembest__inPython__3.12+.As__thisbook__isbased__on 3.12 (and 3.13is__rightaround__the corner),it__willgenerally__use 3.12s__f-string rules;mod__examplesquotes__forolder__Pythonsif__needed. F-stringcustom__formatsAs__noted, f-stringsuse__thesame__custom-formatsyntax__asstring__methods,so__theres__notmuch__newto__learn here.In__the abstract, f-stringsare__codedwith__aformat__likethis__(as usual, [ ]means__anoptional__parthere__andits__squarebrackets__arenot__partof__the f-strings__code,but__spacesare__generallyallowed__betweenthe__parts here): f'literaltext__{expression [=] [!s, !r,or__!a] [:formatspec]}literaltext__'As__inthe__method,text__outsidea__{}is__takenliterally__anduses__{{and__}}to__escape braces,and__the {}part__canbe__repeatedto__embedmultiple__values.In__each,the__expressionpart__isany__Pythonexpression__code (includingnested__f-strings)and__isrun__toproduce__thesubstitution__valuebefore__formatting it.As__inthe__formatting method,the__optional !s, !r,or__!arender__theexpression__in user-friendly, as- code,or__ASCII-with-escapesform__whichis__thesame__ascalling__str, repr,or__asciifor__theentire__expressionenclosed__by {}.Within__a {},the__formatspecthat__iscoded__aftera__:is__(nearly)identical__tothat__usedin__thestring__methodand__presented earlier,so__wewon__trepeat__itssyntax__here;see__Formattingmethod__customformats__forthe__optionsthat__f-stringsshare__withthe__method.As__aminor__conveniencefor__developers, f-stringsalso__allowan__=character__afterexpression__toadd__theexpression__stext__andan__=as__alabel__beforeits__valueformatted__witha__repr default.Advanced__f-stringexamples__Allof__whichis__easierto__explainby__examplethan__narrative,so__lets__getback__torunning__code.Numbers__canbe__formattedin__avariety__ofways__spelledout__forthe__formattingmethod__earlierincluding__defaults,fixed__decimal digits,comma__andunderscore__separators, exponents, signs,and__leading zeroes: >>>a__= 3.14156 >>>b__= 1_234_567 >>> f'{a}and__{b}' #Defaults__'3.14156and__1234567' >>> f'{a:.2f}and__{b:09}' # Decimals,padding__'3.14and__001234567' >>> f'{a * 1000:,.2f}and__{b:,}and__{b:_}' #Comma__andunderscore__separators '3,141.56and__1,234,567and__1_234_567' >>> f'{a * 1000:e}and__{b:+012,}' # Exponents, signs,and__padding '3.141560e+03and__+001,234,567' >>> f'{b:_X}and__{b:_o}and__{b // 64:_b}' # Hex, octal, binary,underscores__'12_D687and__455_3207and__100_1011_0101_1010'Adding__an =after__theexpression__maybe__usefulwhen__youre__debugging code,as__itlabels__dataautomatically__(thoughthis__maybe__morereadable__forsimple__variablenames__thanlarger__expressions): >>> f'{a=:e}and__{b=:+012,}' #Labeled__'a=3.141560e+00and__b=+001,234,567' >>> f'{a + 1=:e}and__{b * 2=:+012,}' 'a + 1=4.141560e+00and__b * 2=+002,469,134'String__formatscan__varyaccording__tothe__s/r/aflag__alsocoded__beforethe__formatspecifier__(butafter__an =).To__demo,the__followinguses__a non-ASCIIcharacter__(anA__witheither__anumlaut__markor__diaeresis): >>>c__= 'h\xc4ck' # \xc4 (a.k.a \u00c4)is__non-ASCII >>> f'{c}and__{c}and__{c}' #Defaults__'hck__andh__ckand__h ck' >>> f'{c!s}and__{c!r}and__{c!a}' #Display__mode,two__ways "hck__and 'h ck'and__'h\\xc4ck'" >>> f'{str(c)}and__{repr(c)}and__{ascii(c)}' "hck__and 'h ck'and__'h\\xc4ck'" >>> f'{c=!s}and__{c=!r}and__{c=!a}' #Labeled__"c=hck__and c='h ck'and__c='h\\xc4ck'" >>> f'{c=!s:8}and__{repr(c)}and__{c:0>8}' # Width, fill,alignment__"c=hck__and 'h ck'and__0000h ck"Advanced__tip:as__inthe__formatting method,parts__ofthe__formatspecifier__canbe__fetcheddynamically__atruntime__insteadof__being hardcoded,by__usingnested__{} expressions.The__nestedexpression__sformatted__resultis__usedwhere__it appears: >>>width__= 8 >>> f'{a:.8f}and__{c:0>8}' #Hardcoded__parameters '3.14156000and__0000h ck' >>> f'{a:.{width}f}and__{c:0>{width}}' #Dynamic__parameters '3.14156000and__0000h ck' >>> f'{a=:.{width}f}and__{c * 2:0>{width * 3}}' 'a=3.14156000and__0000000000000000hckh__ck'Like__theformat__method,any__partof__aformatspec__ina__{}can__bea__nested {}though__theycontain__expressionsin__the f-string,not__argument identifiers.This__iswhy__f-stringformats__arejust__(nearly) identical.Other__partsof__f-stringsdon__tallow__{}s (forward reference:for__economy,the__followingassigns__manynames__positionallywith__sequence-assignmentsyntax__coveredformally__inChapter__11it__slike__a=0, b='<',and__so on): >>>what__= 1_234.564 >>> a, b, c, d, e, f, g,h__= 0, '<', '+', 12, ',', '.', 2, 'f' >>> f'{what:0<+12,.2f}!' '+1,234.56000!' >>> f'{what:{a}{b}{c}{d}{e}{f}{g}{h}}!' #But__don'ttry__thisat__home? '+1,234.56000!'Usage__tip:because__f-stringsrun__expressionsthat__reference variables,they__maynot__beeasy__touse__astemplates__whensubstitution__valuesare__collectedin__acontainer__atruntime__asthey__oftenwould__be.In__the following,a__**converts__dictionarykeys__tokeyword__arguments,as__youll__learnlater__inthis__book: >>>values__= dict(tool='Python', role='scripting') #Collected__values >>> 'Use %(tool)sfor__%(role)s.' %values__# Expression:keys__'UsePython__for scripting.' >>> 'Use {tool}for__{role}.'.format(**values) # Method:keywords__'UsePython__for scripting.' >>> 'Use {0[tool]}for__{0[role]}.'.format(values) # Method: reused-argkeys__'UsePython__for scripting.' >>> f'Use {values['tool']}for__{values['role']}.' # F-string:expressions__'UsePython__for scripting.'For__moreimpressive__f-string results,assign__substitutionvalues__to same-scopevariables__when possible: >>>tool__= 'Python' >>>role__= 'scripting' >>> f'Use {tool}for__{role}.' 'UsePython__for scripting.'But__alsobear__inmind__that f-stringsmay__notbe__easyto__usewhen__templatesare__loadedfrom__externalfiles__atruntime__asthey__oftenwould__be.While__theformat__expressionand__methodcan__treatsuch__templatesas__simpletext__data, f-stringsare__Pythonprogram__code,and__hencemay__haveto__berun__postload__withthe__evalfunction__ofChapter__5and__trustedto__notcontain__codethat__willdo__damage (e.g.,erasing__filesis__fairlyeasy__ina__Python expression): >>>fs__= """f'Use {tool}for__{role}.'""" #As__ifloaded__froma__file >>> eval(fs) #Run__ascode__and trust! 'UsePython__for scripting.' F-stringsare__apowerful__tool,but__theirnested__expressionsmake__themgeared__moretoward__in-programformatting__than data-based roles.For__moredetails__onthe__f-string,see__itsfull__disclosurein__Pythons__languagereference__manual.And__theWinner__IsThe__previousedition__ofthis__bookwent__toconsiderable__lengths (aboutseven__pages)to__showhow__theformatting__method,newest__atthe__time,was__functionallyredundant__withthe__expression,in__orderto__underscorethe__downsidesof__featurebloat__inprogramming__languages.Given__thatthe__numberof__primaryformatting__toolsin__Pythonhas__climbedfrom__twoto__threesince__then,that__messagemay__nothave__entirelyhit__its mark. Consequently,this__editionhas__droppedmost__ofthe__rhetoric,and__optedto__leavethis__races__callup__to you.But__ifyou__relooking__fora__guideline,there__isno__killerargument__fordismissing__anyformatting__optionout__ofhand__forall__use cases.As__statedat__thestart__ofthis__section, f-stringsmay__bebest__inmost__new code,on__logisticalgrounds__alone:newer__isless__likelyto__beculled__byPython__sooner.In__fact,we__llbe__usingthem__regularlyin__therest__ofthis__bookwhere__warranted,so__expectmore__examples ahead.Even__so,you__willalso__seethe__expressionand__methodoften__inexisting__codeand__mayhave__touse__themin__rolesthat__f-stringsdon__taddress__(e.g.,for__substitutionsin__textloaded__from files).More__fundamentally,this__bookis__notin__thebusiness__oftelling__youwhat__to do,and__youare__welcometo__useany__formattingoption__you prefer.Imposing__newtools__onprogrammers__is exclusive, divisive,and__probably rude.Despite__normsin__thesoftware__field today,the__choiceof__developmentoptions__shouldbe__yoursand__yoursalone__to make.As__forthe__bloat:change__isnot__always bad,but__itcan__bewhen__itcreates__redundancyor__incompatibility.In__fact,you__vejust__hada__front-rowseat__toone__ofits__worst consequences:N__functionallyequivalent__optionscan__multiplynewcomers__learningrequirements__by N.We__llreturn__tothis__andother__perilsof__ego-fueledchurn__andconvolution__insoftware__developmentat__theend__ofthis__book.For__now,we__llclose__bysimply__notingthat__thisstuff__still matters.With__any luck,a__futureedition__wont__haveyet__anotherformatting__toolto__doc,and__futurelearners__wont__haveyet__anotherone__to grok.PLUS__ONE MORE: STRING.TEMPLATETechnically__speaking,there__arefour__(not three)formatting__toolsbuilt__intoPython__today,if__weinclude__theobscure__stringmodule__sTemplate__toolmentioned__earlier.Now__thatyou__veseen__theother__three,you__cantell__howit__compares.The__expression, method,and__f-stringcan__allbe__usedas__templating tools,referring__tosubstitution__valuesby__nameusing__dictionary keys,keyword__arguments,or__variables (the ;in__thefollowing__separatesmultiple__statementsneeded__togive__the f-stringvariables__to reference): >>> 'The %(num)s %(tool)ss' % dict(num=4, tool='formatter') 'The 4 formatters' >>> 'The {num} {tool}s'.format(num=4, tool='formatter') 'The 4 formatters' >>> num=4; tool='formatter'; f'The {num} {tool}s' 'The 4 formatters'The__modules__templatingsystem__allowsvalues__tobe__referencedby__name too,prefixed__bya__$,as__eitherdictionary__keysor__keywords,but__doesnot__supportall__theutilities__ofthe__othertwo__methodsa__limitationthat__yields simplicity,the__primemotivation__forthis__tool: >>>import__string >>>t__= string.Template('The $num ${tool}s') >>> t.substitute(num=4, tool='formatter') 'The 4 formatters' >>> t.substitute(dict(num=4, tool='formatter')) 'The 4 formatters'See__Pythons__manualsfor__more details.It__spossible__thatyou__maysee__thisalternative__(aswell__asadditional__toolsin__the third-party domain)in__Pythoncode__too;thankfully__thistechnique__issimple__andis__usedrarely__enoughto__warrantits__limitedcoverage__here.General__TypeCategories__Nowthat__weve__exploredthe__firstof__Pythons__collection objects,the__string,let__sclose__thischapter__bydefining__afew__generaltype__conceptsthat__willapply__tomost__ofthe__typeswe__lllook__atfrom__here on.With__regardto__built-in types,it__turnsout__thatoperations__workthe__samefor__allthe__typesin__thesame__category,so__well__onlyneed__todefine__mostof__theseideas__once.We__veexamined__onlynumbers__andstrings__so far,but__becausethey__arerepresentative__oftwo__ofthe__threemajor__typecategories__in Python,you__alreadyknow__moreabout__severalother__typesthan__youmight__think.Types__ShareOperation__Setsby__CategoriesAs__youve__learned,strings__areimmutable__sequences:they__cannotbe__changedin__place (theimmutable__part),and__theyare__positionallyordered__collectionsthat__areaccessed__byoffset__(thesequence__part).It__sohappens__thatall__thesequences__well__studyin__thispart__ofthe__bookrespond__tothe__samesequence__operationsshown__inthis__chapterat__workon__strings concatenation, indexing, iteration,and__so on.More__formally,there__arethree__majortype__(andhence__operation)categories__inPython__thathave__thisgeneric__nature:Numbers__(integer, floating-point, decimal, fraction, others)Support__addition, multiplication, etc.Sequences__(strings, lists, tuples)Support__indexing, slicing, concatenation, etc.Mappings__(dictionaries)Support__indexingby__key, etc.Python__sbyte__stringsmentioned__atthe__startof__thischapter__fallunder__thegeneral__stringslabel__here;sets__aresomething__ofa__categoryunto__themselves (theydon__tmap__keysto__valuesand__arenot__positionallyordered__sequences);and__wehaven__tyet__exploredmappings__onour__in-depthtour__(wewill__inthe__next chapter). However,many__ofthe__othertypes__wewill__encounterwill__besimilar__tonumbers__and strings.For__example,for__anysequence__objectsX__and Y:X__+Y__makesa__newsequence__objectwith__thecontents__ofboth__operands joined.X__*N__makesa__newsequence__objectwith__Ncopies__ofthe__sequenceoperand__X.In__other words,these__operationswork__thesame__wayon__anykind__of sequence,including__strings, lists, tuples,and__some user-definedobject__types.The__onlydifference__isthat__thenew__resultobject__youget__backis__ofthe__sametype__asthe__operandsX__andY__ifyou__concatenate lists,you__getback__anew__list,not__a string. Indexing, slicing,and__othersequence__operationswork__thesame__onall__sequences, too;the__typeof__theobjects__beingprocessed__tellsPython__whichflavor__ofthe__taskto__perform (andif__thatsounds__likepolymorphism__again,it__should).Mutable__TypesCan__BeChanged__inPlace__Thestring__simmutable__classificationis__animportant__constraintto__beaware__of,yet__ittends__totrip__upnew__users.If__anobject__typeis__immutable,you__cannotchange__itsvalue__in place;Python__raisesan__errorif__you try. Instead,you__mustrun__codeto__makea__newobject__containingthe__new value.The__majorcore__typesin__Pythonbreak__downas__follows:Immutables__(numbers, strings, tuples, frozensets)None__ofthe__objecttypes__inthe__immutablecategory__support in-place changes,though__wecan__alwaysrun__expressionsto__makenew__objectsand__assigntheir__resultsto__variablesas__needed.Mutables__(lists, dictionaries, sets, bytearray) Conversely,the__mutableobject__typescan__alwaysbe__changedin__placewith__operationsthat__donot__createnew__objects.Although__suchobjects__canbe__copied manually, in-placechanges__supportdirect__modification. Generally,immutable__typesgive__somedegree__ofintegrity__byguaranteeing__thatan__objectwon__tbe__changedby__anotherpart__ofa__program.For__arefresher__onwhy__this matters,see__thediscussion__ofshared__objectreferences__inChapter__6.To__seehow__lists, dictionaries,and__tuplesparticipate__intype__categories,we__needto__moveahead__tothe__next chapter.Chapter__SummaryIn__this chapter,we__tookan__in-depth, second-passtour__ofthe__stringobject__type.We__learnedabout__codingstring__literals,and__weexplored__string operations,including__sequence expressions,string__method calls,and__stringformatting__inits__expression, method,and__literal flavors.Along__the way,we__studieda__varietyof__conceptsin__depth,such__as slicing,method__call syntax,and__triple-quotedblock__strings.We__alsodefined__somecore__ideascommon__toa__varietyof__types: sequences,for__example,share__anentire__setof__operationsdemoed__herefor__strings.In__thenext__chapter,we__llcontinue__ourtypes__tourwith__alook__atthe__mostgeneral__objectcollections__inPython__listsand__dictionaries.As__youll__find,much__ofwhat__youve__learnedhere__willapply__tothose__typesas__well.And__asmentioned__earlier,in__thefinal__partof__thisbook__well__returnto__Pythons__stringmodel__toflesh__outthe__detailsof__Unicodetext__andbinary__data,which__areof__interestto__some,but__not all,Python__programmers,and__dependon__toolswe__havent__yetstudied__in full.Before__moving on, though,here__sanother__chapterquiz__toreview__thematerial__covered here.Test__Your Knowledge:Quiz__1.Can__thestring__findmethod__beused__tosearch__a list? 2.Can__astring__sliceexpression__beused__ona__list? 3.How__wouldyou__converta__characterto__itsASCII__integer code?How__wouldyou__convertthe__other way,from__aninteger__codeto__a character? 4.How__mightyou__goabout__changinga__stringin__Python? 5.Given__astring__Swith__thevalue__'c,od,e',name__twoways__toextract__thetwo__charactersin__the middle. 6.How__manycharacters__arethere__inthe__string "a\nb\x1f\000d"? 7.Write__an expression,method__call,and__f-stringto__format 'Python'and__3.12at__astring__sbeginning__and end.Test__Your Knowledge:Answers__1. No,because__methodsare__alwaystype__specific;that__is,they__onlywork__ona__singleobject__type.Expressions__like X+Yand__built-infunctions__like len(X)are__generic, though,and__maywork__ona__varietyof__types.In__this case,for__instance,the__inmembership__expressionhas__asimilar__effectas__thestring__find,but__itcan__beused__tosearch__bothstrings__and lists.Python__makessome__attemptto__namesimilar__methodsconsistently__(manyobjects__havea__copy method,for__example,and__mutableobjects__mayshare__methodnames__like pop),but__methodsare__stillmore__typespecific__thanother__operation sets. 2. Yes.Unlike__methods,expressions__aregeneric__andapply__tomany__types.In__this case,the__sliceexpression__isreally__asequence__operationit__workson__anytype__ofsequence__object,including__strings, lists,and__tuples.The__onlydifference__isthat__whenyou__slicea__list,you__getback__anew__list. 3.The__built-in ord(S)function__convertsfrom__a one-characterstring__toan__integercharacter__code; chr(I)converts__fromthe__integercode__backto__a string.Keep__in mind, though,that__theseintegers__areonly__ASCIIcodes__fortext__whosecharacters__aredrawn__onlyfrom__theASCII__character set.In__theUnicode__model,text__stringsare__reallysequences__ofUnicode__codepoint__identifying integers,which__mayfall__outsidethe__7-bitrange__ofnumbers__reservedby__ASCII (wepreviewed__Unicodein__Chapter 4and__willrevisit__itin__Chapter 37). 4.Strings__cannotbe__changed;they__are immutable. However,you__canachieve__asimilar__effectby__creatinga__newstring__by concatenating, slicing,using__amethod__calllike__replace,or__runningformatting__operationsand__thenassigning__theresult__backto__theoriginal__variable name. 5.You__canslice__thestring__using S[2:4]or__spliton__thecomma__andindex__thestring__using S.split(',')[1].Try__theseinteractively__tosee__for yourself. 6. Six.The__string "a\nb\x1f\000d"contains__thecharacters__a,newline__(\n), b,literal__value 31 (ashex__escape \x1f,which__isa__codepoint__thatstands__forthe__nonprintablecontrol__character US),literal__value 0 (anoctal__escape \000),and__d.Pass__thestring__tothe__built-inlen__functionto__verifythis__andprint__eachof__itscharacters__ordresults__tosee__theactual__codepoint__(identifying number) values.See__Table 7-2for__moredetails__on escapes. 7.There__sno__rightanswer__forwhat__goesin__themiddle__ofthe__result string,but__as examples: '%sis__%s' % ('Python', 3.12)works__forthe__expression,and__'{}is__{}'.format('Python', 3.12)suffices__forthe__method call.There__salmost__noreason__touse__an f-stringif__allparts__areknown__andformatted__perdefaults__(f'{'Python'}is__{3.12}'seems__silly),but__f-stringsare__moreuseful__ifvalues__arefirst__assignedto__variables: x='Python'; y=3.12; f'{x}is__{y}'or__similargarners__full points.Chapter__8.Lists__andDictionaries__Nowthat__weve__explorednumbers__and strings,this__chaptermoves__onto__givethe__fullstory__onPython__slist__anddictionary__objectscollections__ofother__objects,and__themain__workhorsesin__almostall__Python scripts.As__youll__find,both__areremarkably__flexible:they__canbe__changedin__place,can__growand__shrinkon__demand,and__maycontain__andbe__nestedin__anyother__kindof__object.By__leveragingthese__built-inobject__types,you__cancreate__andprocess__richinformation__structuresin__yourscripts__withouthaving__todefine__newobject__typesof__your own.Lists__Thefirst__stopon__thischapter__stour__isthe__Python list.Lists__arePython__smost__flexibleordered__collectionobject__type.Unlike__strings,lists__cancontain__anysort__of object: numbers, strings,and__evenother__lists. Also,unlike__strings,lists__maybe__changedin__placeby__assignmentto__offsetsand__slices,list__method calls,deletion__statements,and__morethey__aremutable__objects.Python__listsdo__thework__ofmany__ofthe__collectiondata__structuresyou__mighthave__toimplement__manuallyin__lower-levellanguages__suchas__C.Here__isa__quicklook__attheir__main properties.Python__lists are:Ordered__collectionsof__arbitraryobjects__Froma__functional view,lists__arejust__placesto__collectother__objectsso__youcan__treatthem__as groups.Lists__alsomaintain__a left-to-rightpositional__orderingamong__theitems__they contain.Accessed__byoffset__Justas__with strings,you__canfetch__acomponent__objectfrom__alist__byindexing__thelist__onthe__objects__offset.Because__itemsin__listsare__orderedby__their positions,you__canalso__dotasks__suchas__slicingand__concatenation. Variable-length, heterogeneous,and__arbitrarilynestable__Unlike strings,lists__cangrow__andshrink__inplace__(theirlengths__can vary),and__theycan__containany__sortof__object,not__just one-characterstrings__(theyre__heterogeneous).Because__listscan__bothcontain__andbe__containedby__othercollection__objects,they__alsosupport__arbitrary nesting;you__cancreate__listsof__listsof__lists,and__so on.Of__thecategory__mutablesequence__Interms__ofour__typecategory__qualifiers,lists__aremutable__(i.e.,can__bechanged__in place)and__canrespond__toall__thesequence__operationsused__with strings,such__as indexing, slicing,and__concatenation.In__fact,sequence__operationswork__thesame__onlists__asthey__doon__strings;the__onlydifference__isthat__sequenceoperations__suchas__concatenationand__slicingreturn__newlists__insteadof__newstrings__whenapplied__to lists.Because__listsare__mutable, however,they__alsosupport__otheroperations__thatstrings__don t,such__as deletion, expansion,and__indexassignment__operations,which__changethe__listsin__place.Arrays__ofobject__references Technically,Python__listscontain__zeroor__morereferences__toother__objects.Lists__mightremind__youof__arraysof__pointers (addresses)if__youhave__abackground__insome__other languages,and__fetchingan__itemfrom__aPython__listis__aboutas__fastas__indexinga__C array.In__fact,lists__reallyare__arraysinside__thestandard__CPython interpreter,not__linked structures.As__welearned__inChapter__6, though,Python__alwaysfollows__areference__toan__objectwhenever__thereference__is used,so__yourprogram__dealsonly__with objects.Whenever__youassign__anobject__toa__datastructure__componentor__variable name,Python__alwaysstores__areference__tothat__same object,not__acopy__ofit__(thoughthe__objectstored__maybe__acopy__of another,if__yourequested__onebefore__the store).As__apreview__and reference,Table__8-1summarizes__commonand__representativelist__object operations.It__isfairly__complete,but__forthe__full story,consult__thePython__standard-library manual,or__runa__help(list)or__dir(list)call__interactivelyfor__acomplete__listof__listmethods__youcan__passin__areal__list,or__theword__list,which__isthe__nameof__thelist__data type.The__setof__methodshere__isespecially__proneto__change,so__besure__to cross-checkin__the future.Table__8-1.Common__listliterals__andoperations__OperationInterpretation__L = []An__emptylist__L = [123, 'abc', 1.23, {}]Four__items:indexes__0..3L__= ['Pat', 40.0, ['dev', 'mgr ']]Nested__sublistsL__= list('code')L__= list(range(-4, 4))List__ofan__iterables__items,list__ofsuccessive__integers L[i] L[i][j] L[i:j] len(L) Index,index__of index, slice,length__L1 + L2L__* 3 Concatenate,repeat__L1 > L1, L1 == L2 Comparisons: magnitude,equality__3in__Lfor__xin__L: print(x) Membership,iteration__L.append(4) Methods:growing__L.extend([5, 6, 7]) L.insert(i, X) L.index(X) L.count(X) Methods:searching__L.sort() L.reverse() L.copy() L.clear() Methods: sorting, reversing, copying,clearing__L.pop(i) L.remove(X)del__L[i]del__L[i:j] L[i:j] = [] Methods, statements:shrinking__L[i] = 3 L[i:j] = [4, 5, 6]Index__assignment,slice__assignmentL__= [*x, 0, *y, *z]Iterable__unpackingL__= [x**2for__xin__range(5)] list(map(ord, 'python'))List__comprehensionsand__mapsWhen__writtendown__asa__literal expression,a__listis__codedas__aseries__ofobjects__(really,expressions__thatreturn__objects)in__square brackets,separated__by commas.For__instance,the__secondrow__inTable__8-1assigns__thevariable__Lto__a four-item list.A__nestedlist__iscoded__asa__nested square-bracketedseries__(row 3),and__theempty__listis__justa__square-bracketpair__withnothing__inside (row 1).1Many__ofthe__operationsin__Table 8-1should__look familiar,as__theyare__thesame__sequenceoperations__weput__towork__onstrings__earlier indexing, concatenation, iteration,and__so on.Lists__alsorespond__to list-specificmethod__calls (whichprovide__utilitiessuch__as sorting, reversing,adding__itemsto__the end, etc.),as__wellas__in-placechange__operations (deleting items,assignment__toindexes__and slices,and__so forth). Again,lists__havethese__toolsfor__changeoperations__becausethey__area__mutableobject__type.Lists__inAction__Probablythe__bestway__tounderstand__listsis__tosee__themat__work.Let__sonce__againturn__tosome__simpleinterpreter__interactionsto__illustratethe__operationsin__Table 8- 1.Basic__ListOperations__Becausethey__are sequences,lists__supportmany__ofthe__sameoperations__as strings,which__meanswe__dont__haveto__repeatall__theoperation__detailsagain__here.In__short, though,lists__respondto__the +and__*operators__muchlike__stringsthey__meanconcatenation__andrepetition__here too,except__thatthe__resultis__anew__list,not__a string: $ python3 #Launch__aREPL__>>> len([1, 2, 3]) #Length__3 >>> [1, 2, 3] + [4, 5, 6] #Concatenation__[1, 2, 3, 4, 5, 6] >>> ['Py!'] * 4 #Repetition__['Py!', 'Py!', 'Py!', 'Py!']Although__the +operator__worksthe__samefor__listsand__strings,it__simportant__toknow__thatit__expectsthe__samesort__ofsequence__onboth__sides otherwise,you__geta__typeerror__whenthe__code runs.For__instance,you__cannotconcatenate__alist__anda__stringunless__youfirst__convertthe__listto__astring__(usingtools__suchas__stror__formatting)or__convertthe__stringto__alist__(thelist__built-infunction__doesthe__trick): >>> str([1, 2]) + '34' #Same__as '[1, 2]' + '34' '[1, 2]34' >>> [1, 2] + list('34') #Same__as [1, 2] + ['3', '4'] [1, 2, '3', '4']As__suggestedin__prior chapters,lists__alsosupport__comparisons,which__automaticallycompare__allparts__fromleft__toright__untila__resultis__known.In__the following,for__instance,a__nested 3is__greaterthan__anested__2,and__the one-itemlist__[1]at__theend__isconsidered__lessbecause__its__shorter (thoughit__broadlyprefers__theterm__horizontally challenged): >>>L__= [1, [2, 3], 4] >>> (L == [1, [2, 3], 4]), (L > [1, [2, 2], 4]), (L > [1]) (True, True, True)Indexing__andSlicing__Becauselists__are sequences,indexing__andslicing__alsowork__thesame__wayfor__listsas__theydo__for strings.For__lists, though,the__resultof__indexingis__whatevertype__ofobject__livesat__theoffset__youspecify__(nota__one-character string),and__slicinga__listalways__returnsa__newlist__(nota__string): >>>L__= ['hack', 'Hack', 'HACK!'] >>> L[2] #Offsets__startat__zero 'HACK!' >>> L[-2] # Negative:count__fromthe__right 'Hack' >>> L[1:] #Slicing__fetchessections__['Hack', 'HACK!']New__here:because__youcan__nestlists__andother__objecttypes__within lists,you__willsometimes__needto__stringtogether__indexoperations__togo__deeperinto__adata__structure.For__example,one__ofthe__simplestways__torepresent__matrixes (multidimensional arrays)in__Pythonis__aslists__withnested__sublists.Here__sa__basic 3 3 two-dimensional list-basedarray__areprise__fromChapter__4: >>>matrix__= [[1, 2, 3], [4, 5, 6], [7, 8, 9]]With__one index,you__getan__entirerow__(really,a__nested sublist),and__with two,you__getan__itemwithin__the row: >>> matrix[1] [4, 5, 6] >>> matrix[1][1] 5 >>> matrix[2][0] 7As__demoed earlier,lists__cannaturally__spanmultiple__linesif__youwant__themto__becausethey__arecontained__bya__pairof__brackets;watch__formore__onsyntax__likethis__inthe__nextpart__ofthe__book (andignore__theif__absentin__your REPL): >>>matrix__= [[1, 2, 3], ... [4, 5, 6], ... [7, 8, 9]] >>> matrix[1][1] 5For__moreon__matrixes,also__watchfor__a dictionary-basedalternative__laterin__this chapter,which__canbe__moreefficient__whenmatrixes__arelargely__empty.We__llalso__continuethis__threadin__Chapter 20where__well__writeadditional__matrix code,especially__withlist__comprehensions.And__for high-powerednumeric__work,the__NumPyextension__mentionedin__Chapters 1, 4,and__5provides__otherways__tohandle__matrixes.Changing__Listsin__PlaceBecause__listsare__mutable,they__supportoperations__thatchange__alist__objectin__place.That__is,list__operationsin__thissection__andothers__allmodify__thelist__objectdirectly__overwritingits__formervalue__withoutrequiring__thatyou__makea__new copy,as__youhad__tofor__strings.Because__Pythondeals__onlyin__object references,this__distinctionbetween__changingan__objectin__placeand__creatinga__newobject__matters;as__discussedin__Chapter 6,if__youchange__anobject__in place,you__mightimpact__morethan__onereference__toit__atthe__same time.Index__andslice__assignmentsFirst__upin__thiscategory__isa__twiston__theindexing__andslicing__weve__already explored.When__usinga__list,you__canchange__itscontents__byassigning__toeither__aparticular__item (offset)or__anentire__section (slice): >>>L__= ['code', 'Code', 'CODE!'] >>> L[1] = 'Hack' #Index__assignment >>>L__#Replaces__item 1 ['code', 'Hack', 'CODE!'] >>> L[0:2] = ['write', 'Python'] #Slice__assignment: "delete+insert" >>>L__#Replaces__items 0,1 ['write', 'Python', 'CODE!']Both__indexand__sliceassignments__are in-placechanges__theymodify__thesubject__list directly,rather__thangenerating__anew__listobject__forthe__result.Index__assignmentin__Pythonworks__muchas__itdoes__inmost__other languages:Python__replacesthe__singleobject__referenceat__thedesignated__offsetwith__anew__one;the__offsets__referenceis__changed.Slice__assignment,the__lastoperation__inthe__preceding example,replaces__anentire__sectionof__alist__ina__single step.Because__itcan__bea__bit complex,it__isperhaps__bestthought__ofas__acombination__oftwo__steps: 1. Deletion:The__sliceyou__specifyto__theleft__ofthe__=is__deleted. 2. Insertion:The__newitems__containedin__theiterable__objectto__theright__ofthe__=are__insertedinto__thelist__onthe__left,at__theplace__wherethe__oldslice__was deleted.2This__isnt__whatreally__happens,but__itcan__helpclarify__whythe__numberof__itemsinserted__doesnt__haveto__matchthe__numberof__items deleted.For__instance,given__alist__Lof__twoor__more items,an__assignment L[1:2]=[4,5]replaces__oneitem__withtwo__its__asthough__Pythonfirst__deletesthe__one-itemslice__at [1:2] (fromoffset__1,up__tobut__notincluding__offset 2),then__insertsboth__4and__5where__thedeleted__sliceused__to be.The__neteffect__makesthe__list larger.This__alsoexplains__whythe__secondslice__assignmentin__thefollowing__isreally__aninsert__Pythonreplaces__anempty__sliceat__[1:1]with__two items;and__whythe__thirdis__reallya__deletionPython__deletesthe__slice (theitem__atoffset__1),and__theninserts__nothing: >>>L__= [1, 2, 3] >>> L[1:2] = [4, 5] # Replacement/insertion >>>L__[1, 4, 5, 3] >>> L[1:1] = [6, 7] #Insertion__(replace nothing) >>>L__[1, 6, 7, 4, 5, 3] >>> L[1:2] = [] #Deletion__(insert nothing) >>>L__[1, 7, 4, 5, 3]In__effect,slice__assignmentreplaces__anentire__section,or__column,all__atonce__evenif__thecolumn__orits__replacementis__empty.Because__thelength__ofthe__sequencebeing__assigneddoes__nothave__tomatch__thelength__ofthe__slicebeing__assigned to,slice__assignmentcan__beused__toreplace__(by overwriting),expand__(by inserting),or__shrink (by deleting)the__subject list.It__sa__powerful operation,but__frankly,one__thatyou__maynot__seevery__oftenin__practice.There__areoften__morestraightforward__andmnemonic__waysto__replace, insert,and__delete (includingconcatenation__expressions,and__the insert, pop,and__removelist__methodscoming__up soon),which__Pythonprogrammers__tendto__preferin__practice.On__theother__hand,this__operationcan__beused__asa__sortof__in-placeconcatenation__atthe__frontof__thelist__perthe__nextsection__smethod__coverage,something__thelist__sextend__doesmore__mnemonicallybut__atlist__end: >>>L__= [1] >>> L[:0] = [2, 3, 4] #Insert__allat__:0,an__emptyslice__atfront__>>>L__[2, 3, 4, 1] >>> L[len(L):] = [5, 6, 7] #Insert__allat__len(L):,an__emptyslice__atend__>>>L__[2, 3, 4, 1, 5, 6, 7] >>> L.extend([8, 9, 10]) #Insert__allat__end,named__method (seealso__+=) >>>L__[2, 3, 4, 1, 5, 6, 7, 8, 9, 10]List__methodcalls__Like strings,Python__listobjects__alsosupport__type-specificmethod__calls,most__ofwhich__changethe__subjectlist__itself: >>>L__= ['write'] >>> L.append('Python') # Append:add__oneitem__atthe__end >>>L__['write', 'Python'] >>> L.extend(['code', 'goodly']) # Extend:add__manyitems__atthe__end >>>L__['write', 'Python', 'code', 'goodly'] >>> L.sort() # Sort:order__listitems__('P' < 'c') >>>L__['Python', 'code', 'goodly', 'write']Methods__wereintroduced__inChapter__7.In__brief,they__arefunctions__(really,object__attributesthat__reference functions)that__areassociated__withand__actupon__particularsubject__objects (theobjects__throughwhich__theyare__called).Methods__provide type-specific tools;the__listmethods__presented here,for__instance,are__generallyavailable__onlyfor__lists.Demoed__inthe__preceding code,append__isperhaps__themost__commonlyused__list method.It__simplytacks__asingle__item (really,an__object reference)onto__theend__ofthe__subjectlist__in place,and__thelist__expandsto__makeroom__forthe__addition.Unlike__concatenation,append__expectsyou__topass__inone__object,not__a list,and__usesit__literally.In__fact,the__effectof__L.append(X)is__similarto__L+[X],but__theformer__changesL__in place,while__thelatter__makesa__new list.3By__contrast,the__extendmethod__addsmultiple__itemsat__theend__ofthe__list,again__in place. Technically,extend__alwaysiterates__throughand__addseach__itemin__thepassed__iterable object,whereas__appendsimply__addsa__singleitem__asis__withoutiterating__adistinction__thatwill__bemore__meaningfulin__Chapter 14.For__now,it__senough__toknow__thatextend__addsmany__items,and__appendadds__one.Also__ahead:Chapter__11covers__the += statement,which__does in-placeassignment__forlists__too,and__isyet__anotherway__toadd__manyitems__thatredundantly__mirrors extend.The__sortmethod__ordersthe__lists__itemsbut__meritsa__sectionof__its own.Sorting__listsAs__weve__just witnessed,sort__ordersa__listin__place.It__sa__commontool__thatuses__Pythonstandard__comparisontests__(stringcomparisons__inmost__examples here,but__otherobjects__workin__sorts too),and__bydefault__sortsin__ascending order.You__canmodify__sortbehavior__bypassing__inkeyword__argumentsa__special name=valuesyntax__infunction__callsthat__weve__usedin__earlier chapters,gives__valuesby__name,and__isoften__usedfor__configuration options.In__sorts,the__reverseargument__allowssorts__tobe__madein__descendinginstead__ofascending__order,and__thekey__argumentgives__a one-argumentfunction__thatreturns__thevalue__tobe__usedin__sortingthe__stringobject__sstandard__lowercase__converterin__thefollowing__(thoughits__newercasefold__mayhandle__sometypes__ofUnicode__text better): >>>L__= ['abc', 'ABD', 'aBe'] >>> L.sort() #Sort__withmixed__case >>>L__['ABD', 'aBe', 'abc'] >>>L__= ['abc', 'ABD', 'aBe'] >>> L.sort(key=str.lower) #Normalize__tolowercase__>>>L__['abc', 'ABD', 'aBe'] >>>L__= ['abc', 'ABD', 'aBe'] >>> L.sort(key=str.lower, reverse=True) #And__changesort__order >>>L__['aBe', 'ABD', 'abc']The__sortkey__argumentcan__alsobe__usefulwhen__sortinglists__of dictionaries,to__selecta__sortvalue__byindexing__eachdictionary__ona__fieldalong__the way.We__llstudy__dictionarieslater__inthis__chapter,and__youll__learnmore__aboutkeyword__functionarguments__inPart__IV.Two__notesof__caution here: first,sorts__wont__workby__defaultwith__mixed types.In__Python,magnitude__comparisonof__mixedtypes__isan__error,as__its__generally ambiguous.Because__sortinguses__thesecomparisons__internally, though,sorting__mixed-typelists__failsby__proxy.To__workaround__this limitation,use__thekey__argumentto__codevalue__transformationsduring__the sort.The__followingsimply__convertsall__itemsto__stringswith__thestr__built-in,but__keycan__bean__arbitraryfunction__ofyour__making (andis__oftencoded__inlinewith__thelambda__expressionyou__llmeet__laterin__this book): >>>L__= [1, 'hack', 2] # Mixed-typesorts__failby__default >>> L.sort() TypeError: '<'not__supportedbetween__instancesof__'str'and__'int' >>> L.sort(key=str) >>>L__#Enable__mixed-type sorts:all__str [1, 2, 'hack'] Second,beware__that append, extend,and__sortchange__theassociated__listobject__in place,but__dont__returnthe__modifiedlist__asa__result (technically,they__returnthe__Noneplaceholder__objectintroduced__inChapter__4).If__yourun__L=L.append(X),you__wont__getthe__modifiedvalue__of L;in__fact,you__lllose__thereference__tothe__list altogether!When__youuse__methodslike__these,objects__arechanged__asa__side effect,so__theres__noreason__to reassign.Partly__becauseof__such constraints,sorting__isalso__availablein__Pythonas__thesorted__built-in function,which__sortsany__collection (notjust__lists)and__returnsa__newlist__forthe__result (insteadof__changingthe__collectionin__place): >>>L__= ['abc', 'ABD', 'aBe'] >>> sorted(L) #Sorting__built-infunction__['ABD', 'aBe', 'abc'] >>>L__#L__isnot__modified ['abc', 'ABD', 'aBe'] >>> sorted(L, key=str.lower, reverse=True) #Same__argumentsas__list.sort ['aBe', 'ABD', 'abc'] >>>L__= ['abc', 'ABD', 'aBe'] >>> sorted([x.lower()for__xin__L], reverse=True) #Pretransform__items: differs! ['abe', 'abd', 'abc']Notice__thelast__examplehere__wecan__convertto__lowercaseprior__tothe__sortwith__alist__comprehension (introducedin__Chapter 4and__expanded shortly),but__theresult__doesnot__containthe__originallist__svalues__asit__doeswith__thekey__argument.The__latteris__appliedtemporarily__duringthe__sort,instead__ofchanging__thevalues__tobe__sorted altogether.As__wemove__along,you__llsee__rolesin__whichthe__sorted built-incan__sometimesbe__moreuseful__thanthe__sort method.More__ListMethods__Like strings,lists__haveother__methodsthat__performother__specialized operations.For__instance,reverse__reversesthe__listin__place,and__popdeletes__oneitem__atthe__end (by default).Just__like sorting,there__isalso__areversed__built-infunction__thatdoes__notchange__thelist__in place. Confusingly, though,reversed__doesnot__returna__newlist__like sorted;it__insteadreturns__aniterable__objectthat__producesresults__on demand,and__mustbe__wrappedin__alist__callto__collectits__resultsif__areal__listis__needed (e.g.,for__indexing,or__displayat__theREPL__here): >>>L__= [1, 2, 3, 4, 5] >>>L__[1, 2, 3, 4, 5] >>> L.pop() #Delete__andreturn__an item: @ -1by__default 5 >>>L__[1, 2, 3, 4] >>> L.reverse() # In-placereversal__>>>L__[4, 3, 2, 1] >>> list(reversed(L)) #Reversal__built-inwith__aresult__(iterable) [1, 2, 3, 4] >>>L__#L__wasunchanged__[4, 3, 2, 1]In__sometypes__of programs,the__listpop__methodis__usedin__conjunctionwith__appendto__implementa__quick last-in-first-out (LIFO)stack__structure.The__endof__thelist__servesas__thetop__ofthe__stack: >>>L__= [] >>> L.append(1) #Push__ontostack__>>> L.append(2) >>>L__[1, 2] >>> L.pop() #Pop__offstack__2 >>>L__[1]The__popmethod__alsoaccepts__anoptional__offsetof__theitem__tobe__deletedand__returned (thedefault__isthe__lastitem__atoffset__1).Other__listmethods__removean__itemby__value (remove),insert__anitem__atan__offset (insert),count__thenumber__ofoccurrences__(count),and__searchfor__anitem__soffset__(indexa__searchfor__theindex__ofan__item,not__tobe__confusedwith__indexing itself,despite__the name!): >>>L__= ['hack', 'Py', 'code'] >>> L.index('Py') #Index___of_an__object (search/find) 1 >>> L.insert(1, 'more') #Insert__at offset/position >>>L__['hack', 'more', 'Py', 'code'] >>> L.remove('code') #Delete__byvalue__>>>L__['hack', 'more', 'Py'] >>> L.pop(1) #Delete__by offset/position 'more' >>>L__['hack', 'Py'] >>> L.count('Py') #Number__ofoccurrences__1Note__thatunlike__otherlist__methods,count__andindex__donot__changethe__list itself,but__returninformation__aboutits__content.Run__a help(list)or__dir(list)in__your REPL,see__Pythonreference__resources,or__experimentwith__thesecalls__interactivelyon__yourown__tolearn__moreabout__list methods. Iteration, Comprehensions,and__UnpackingLists__alsorespond__toother__sequenceoperations__weused__onstrings__inthe__prior chapter,including__iteration tools,and__areregularly__usedin__conjunctionwith__therange__built-inpreviewed__inChapter__4: >>> 3in__[1, 2, 3] #Membership__True >>>for__xin__[1, 2, 3]: ... print(x, end=' ') #Iteration__... 1 2 3 >>> list(range(5)) #Counter__generators (0 N-1) [0, 1, 2, 3, 4]We__willtalk__moreformally__aboutfor__iterationand__therange__built-inin__Chapter 13,because__theyare__relatedto__statement syntax.Per__Chapter 4 previews, though,for__loopsstep__throughitems__inany__sequence (orother__iterable)from__leftto__right,executing__oneor__morestatements__foreach__item;and__rangemakes__aseries__of integers,for__usein__avariety__of roles,including__counterloops__(andcoerced__bylist__tosurrender__itsvalues__fordisplay__here).List__comprehensionsand__mapsThe__lastitems__inTable__8-1,list__comprehensionsand__map calls,were__alsointroduced__inChapter__4and__arecovered__infull__inChapters__14and__20.Their__basicusage__is straightforward,though__listcomprehensions__areclose__kinto__for loops,and__builda__newlist__byapplying__anexpression__toeach__itemin__asequence__(really,any__iterable): >>>res__= [x * 4for__xin__'code'] #List__comprehension >>>res__['cccc', 'oooo', 'dddd', 'eeee']As__a preview,this__expressionis__equivalentto__afor__loopthat__buildsup__alist__ofresults__manuallywith__theappend__wemet__earlier,but__asyou__lllearn__inlater__chapters,list__comprehensionsare__simplerto__codeand__mayrun__faster: >>>res__= [] #Equivalent__loopcode__>>>for__xin__'code': #Append__expressionresults__... res.append(x * 4) ... >>>res__['cccc', 'oooo', 'dddd', 'eeee']Comprehension__alsosupport__extensionslike__iffilters__andnested__for loops,and__themap__built-infunction__doessimilar__work,but__appliesa__functioninstead__ofan__expressionto__itemsin__asequence__(orother__iterable)and__collectsall__theresults__ina__newlist__ifwe__wrapit__inlist__toforce__itto__produceall__its results: >>> [x * 4for__xin__'program'if__x >= 'p'] #Filter__itemswith__ifclauses__['pppp', 'rrrr', 'rrrr'] >>> [x +y__forx__in 'py'for__yin__'312'] #Nested__loops:see__Chapter 14! ['p3', 'p1', 'p2', 'y3', 'y1', 'y2'] >>> list(map(abs, [ 1, 2, 0, 1, 2])) #Map__afunction__acrossa__sequence [1, 2, 0, 1, 2]While__theseare__powerful tools,their__loopequivalents__alsomake__them optional.Stay__tunedfor__therelated__dictionarycomprehension__laterin__this chapter,and__muchmore__oncomprehensions__andmaps__laterin__this book. List-literalunpacking__Asof__Python 3.5,list__literalsalso__supporta__*syntax__thatunpacks__thecontents__ofany__iterable (includingsequences__likelists__and strings)at__thetop__levelof__thelist__being created.The__effectflattens__thestarred__itemin__thenew__list: >>>L__= ['code', 'hack'] >>> [L, 2, 3, L] [['code', 'hack'], 2, 3, ['code', 'hack']] #Normal__assignmentsnest__items >>> [*L, 2, 3, *L] #Iterable__unpackingin__listliteral__['code', 'hack', 2, 3, 'code', 'hack'] >>>S__= 'code' #Any__sequence (orother__iterable) >>> [*'Py', *S, *range(3)] ['P', 'y', 'c', 'o', 'd', 'e', 0, 1, 2] Importantly,and__asis__sooften__truein__Python today, *unpacking__isnever__required.The__followingsimple__concatenation,for__example,has__thesame__effectas__thepreceding__sfirst__*unpacking__whichis__redundantin__this case: >>>L__+ [2, 3] +L__#What__*unpacking__does,for__lists ['code', 'hack', 2, 3, 'code', 'hack']For__nonlist iterables,unpacking__without *requires__conversionsbecause__+expects__listson__both sides,but__its__notmuch__extra work,especially__giventhe__rarityof__such code: >>> list('Py') + list(S) + list(range(3)) #What__*unpacking__does,for__nonlists ['P', 'y', 'c', 'o', 'd', 'e', 0, 1, 2]Loops__canachieve__thesame__goalsas__unpacking too;they__maybe__more verbose,but__arealso__moregeneral__purpose: >>>M__= [] >>>for__xin__('Py', S, range(3)): M.extend(x) #Loops__v special-casehacks__... >>>M__['P', 'y', 'c', 'o', 'd', 'e', 0, 1, 2]Notice__twothings__aboutthis__example. First,it__codesa__tupleof__threeitems__asthe__sequencethat__thefor__loopsteps__through (thetuple__souter__parenthesesare__optionalbut__explicit). Second,the__forloop__inthis__codeavoids__aline__bymoving__itsbody__upto__its header,using__asyntax__rulewe__lldefine__formallyin__thenext__partof__thisbook__(tl;dr:this__worksonly__forsimple__statements,like__callsto__printand__extend).Because__were__notquite__readyfor__thefull__iteration story,we__llpostpone__furtherdetails__for now,but__watchfor__similarunpacking__expressionsfor__dictionarieslater__inthis__chapter. Here, though,you__shouldalready__beable__toweigh__foryourself__whetherthe__alternativesto__*unpacking__weresufficiently__subparto__warrantthe__convolution.Other__ListOperations__Becauselists__are mutable,you__canalso__usethe__delstatement__todelete__anitem__orsection__in place: >>>L__= ['hack', 'more', 'Py', 'code'] >>>del__L[0] #Delete__oneitem__(in place) >>>L__['more', 'Py', 'code'] >>>del__L[1:] #Delete__anentire__section >>>L__#Same__as L[1:] = [] ['more']As__covered earlier,because__sliceassignment__isa__deletionplus__an insertion,you__canalso__deletea__sectionof__alist__byassigning__anempty__listto__aslice__(L[i:j]= []);Python__deletesthe__slicenamed__onthe__left,and__theninserts__nothing.Assigning__anempty__listto__an index,on__theother__hand,just__storesa__referenceto__theempty__listobject__inthe__specified slot,rather__thandeleting__an item: >>>L__= ['hack', 'more', 'Py', 'code'] >>> L[0:1] = [] >>>L__['more', 'Py', 'code'] >>> L[1:] = [] >>>L__['more'] >>> L[0] = [] >>>L__[[]]Although__allthe__operationsjust__discussedare__typical,there__maybe__additionallist__methodsand__operationsnot__illustrated here.The__methodtoolbox__mayalso__changeover__time,and__infact__has:the__newer L.copy()method__makesa__top-levelcopy__ofthe__list,much__like L[:]and__list(L),but__issymmetric__withcopy__methodsin__setsand__dictionaries.For__acomprehensive__and up-to-datelist__oftype__tools,you__shouldalways__consultPython__s manuals.And__becauseit__ssuch__acommon__hurdle,this__bookis__compelledto__remindyou__onceagain__thatall__the in-placechange__operationsdiscussed__herework__onlyfor__mutable objects:they__wont__workon__strings (or tuples,coming__upin__Chapter 9),no__matterhow__hardyou__try.Mutability__isan__inherent yes/noproperty__ofeach__objecttype__includingthe__subjectof__thischapter__snext__section.Dictionaries__Alongwith__lists,dictionaries__areone__ofthe__mostflexible__built-inobject__typesin__Python.If__youthink__oflists__as order-basedcollections__of objects,you__canthink__ofdictionaries__as key-based collections;the__chiefdistinction__isthat__in dictionaries,items__arestored__andfetched__by key,instead__ofby__positional offset.While__listscan__serveroles__similarto__arraysin__other languages,dictionaries__cantake__theplace__of records,search__tables,and__anyother__sortof__aggregationwhere__itemnames__aremore__meaningfulthan__item positions.For__example,dictionaries__canreplace__manyof__thesearching__algorithmsand__datastructures__youmight__haveto__implementmanually__in lower-levellanguages__asa__highlyoptimized__built-in tool,indexing__adictionary__isa__veryfast__search operation.Dictionaries__alsosometimes__dothe__workof__recordsand__symboltables__usedin__other languages,can__beused__torepresent__sparse (mostly empty)data__structures,and__much more.As__arundown__oftheir__main properties,Python__dictionaries are:Accessed__by key,not__offsetposition__Dictionariesare__sometimescalled__associativearrays__orhashes__(especiallyby__usersof__otherscripting__languages).They__associatea__setof__valueswith__corresponding keys,so__youcan__fetchan__itemout__ofa__dictionaryusing__thekey__underwhich__youoriginally__stored it.You__usethe__sameindexing__operationto__getcomponents__ina__dictionaryas__youdo__ina__list,but__theindex__takesthe__formof__a key,not__arelative__offset. Insertion-orderedcollections__ofarbitrary__objectsUnlike__ina__list,keys__ina__dictionaryare__orderedonly__bythe__orderin__whichthey__are inserted.This__isnot__thesame__asthe__positionalordering__ofsequences__like lists:items__addedto__dictionarieslater__alwaysshow__upat__theend__ofthe__keyslist__(evenif__theyappeared__earlierin__the past),and__thereis__noway__toinsert__akey__intothe__middleof__thekeys__list. Moreover,this__orderingis__newas__ofPython__3.7,before__whichkeys__left-to-rightorder__waspseudo__random.Under__eitherordering__regime,keys__providethe__symbolic (not physical)locations__ofitems__ina__dictionary. Variable-length, heterogeneous,and__arbitrarilynestable__Like lists,dictionaries__cangrow__andshrink__inplace__(withoutnew__copiesbeing__made),they__cancontain__objectsof__any type,and__theysupport__nestingto__anydepth__(theycan__befreely__mixedwith__lists,other__dictionaries,and__so on).Each__keycan__havejust__oneassociated__value,but__thatvalue__canbe__acollection__ofmultiple__objectsif__needed,and__agiven__valuecan__bestored__underany__numberof__keys.Of__thecategory__mutablemapping__Youcan__changedictionaries__inplace__byassigning__toindexes__(theyare__mutable),but__theydon__tsupport__thesequence__operationsthat__workon__stringsand__lists.Because__dictionariesare__key-based collections,operations__thatdepend__ona__fixedpositional__order (e.g., concatenation, slicing)don__tmake__sense. Instead,dictionaries__arethe__only built-in, core-typerepresentatives__ofthe__mappingcategory__objectsthat__mapkeys__to values.Other__mappingsin__Pythonare__createdby__imported modules,not__language syntax.Tables__ofobject__references (hash tables)If__listsare__arraysof__objectreferences__thatsupport__accessby__position,dictionaries__aretables__ofobject__referencesthat__supportaccess__by key. Internally,dictionaries__areimplemented__ashash__tables (datastructures__thatsupport__veryfast__retrieval),which__startsmall__andgrow__on demand. Moreover,Python__employsoptimized__hashingalgorithms__tofind__keys,so__retrievalis__quick.Like__lists, though,dictionaries__storeobject__references (not copies,unless__youmake__themexplicitly__before storing).For__referenceand__preview,Table__8-2summarizes__someof__themost__commonand__representativedictionary__operationsand__isrelatively__completeat__this writing.As__usual, though,you__shouldconsult__Pythons__librarymanual__orrun__a dir(dict)or__help(dict)call__fora__completelist__(dictis__the built-inname__ofthe__dictionary type).Table__8-2.Common__dictionaryliterals__andoperations__OperationInterpretation__D = {}Empty__dictionaryD__= {'name': 'Pat', 'a ge': 40.0} Two-itemdictionary__E = {'cto': {'name': ' Sue', 'age': 40}}Nesting__D = dict(name='Bob',a__ge=40)D__= dict([('name', 'Bo b'), ('age', 40)])D__= dict(zip(keyslist, valueslist))D__= dict.fromkeys(['na me', 'age'])Alternative__construction techniques: keywords, key/value pairs,zipped__key/value lists,key__lists D['name'] E['cto']['age']Indexing__by key,nested__indexes 'age'in__Dfor__keyin__D: print(D[ key])Key__membershipand__iteration D.keys() D.values() D.items() D.copy() D.clear() Methods:all__keys,all__values,all__key+value tuples,copy__(top-level), D.update(D2) D.get(key, default?) D.pop(key, default?) D.setdefault(key,defa__ult?) D.popitem()clear__(removeall__items),merge__by keys,fetch__by key,if__absentdefault__(or None),remove__by key,if__absentdefault__(or error)fetch__by key,if__absentset__default (or None), remove/returnany__(key, value) pair; etc. len(D) Length:number__ofstored__entries D[key] = 62Adding__keys,changing__keyvalues__del D[key]Deleting__entriesby__key D1 == D2 Comparisons:equality__(only) list(D.keys()) D1.keys() & D2.keys()Dictionary__viewsD__= {**x, 'a': 1, **y, **z}Dictionary__unpackingD__= {x: x*2for__xin__r ange(10)}Dictionary__comprehensionsD__|E__Dictionarymerge__expression:copy__+update__PerTable__8-2,when__codedas__aliteral__expression,a__dictionaryis__writtenas__aseries__of key:valuepairs__separatedby__commas,and__enclosedin__curly braces.4An__emptydictionary__isan__emptyset__ofcurly__braces,and__youcan__nestdictionaries__bysimply__codingone__asa__valueinside__another dictionary,or__withina__listor__tuple literal.There__sa__lotmore__todictionaries__thantheir__literals, though,as__thenext__sections__tutorialwill__beginto__reveal.Dictionaries__inAction__AsTable__8-2 summarizes,dictionaries__areindexed__by key,and__nesteddictionary__entriesare__referencedby__aseries__ofindexes__(keysin__square brackets).When__Pythoncreates__a dictionary,it__storesits__itemsin__away__thatassociates__valueswith__keys;to__fetcha__value back,you__supplythe__keywith__whichit__is associated,not__itsrelative__position.Let__sgo__backto__theinteractive__promptto__seewhat__thisall__lookslike__in code.Basic__DictionaryOperations__Innormal__operation,you__createdictionaries__withliterals__andstore__andaccess__itemsby__keywith__indexing: $ python3 >>>D__= {'hack': 1, 'Py': 2, 'code': 3} #Make__adictionary__>>> D['Py'] #Fetch__avalue__bykey__2 >>>D__#Insertion__ordered {'hack': 1, 'Py': 2, 'code': 3} Here,the__dictionaryis__assignedto__thevariable__D;the__valueof__thekey__'Py'is__theinteger__2,and__so on.We__usethe__samesquare__bracketsyntax__toindex__dictionariesby__keyas__wedid__toindex__listsby__offset,but__hereit__meansaccess__by key,not__by position.Notice__theend__ofthis__example:unlike__therandomly__orderedsets__westudied__inChapter__5,dictionary__keysretain__theirinsertion__order today,but__weneed__tocover__somemore__basicsbefore__formalizing this.The__built-inlen__functionworks__on dictionaries,too__itreturns__thenumber__ofvalues__storedin__thedictionary__or, equivalently,the__numberof__its keys.The__dictionaryin__membershipoperator__allowsyou__totest__forkey__existence,and__thekeys__methodreturns__allthe__keysin__the dictionary.The__latterof__thesecan__beuseful__forprocessing__dictionariesin__full,by__fetchingcorresponding__valuesin__loops.Because__thekeys__resultcan__betreated__likea__normal list,it__canalso__besorted__iforder__mattersand__theautomatic__insertionorder__doesnt__dothe__job (moreon__sortingand__dictionaries later): >>> len(D) #Number__ofentries__indictionary__3 >>> 'code'in__D #Key__membershiptest__True >>> list(D.keys()) #Create__anew__listof__D'skeys__['hack', 'Py', 'code']Notice__thesecond__stepin__this listing.As__noted,the__inmembership__testused__forstrings__andlists__alsoworks__on dictionaries,where__itchecks__whethera__keyis__stored. Technically,this__worksbecause__dictionariesdefine__aprotocol__runby__into__lookupa__key quickly.Other__objectsprovide__inprotocols__thatreflect__theircommon__uses; files,for__example,use__iteratorsthat__readline__by line.This__willmatter__laterin__this book,when__wereach__iteratorsand__classes.Also__notethe__syntaxof__thelast__stepin__this listing.It__useslist__forsimilar__reasonsthe__dictionarykeys__methodreturns__aniterable__viewobject__thatproduces__resultson__demand,instead__ofa__physical list.The__listcall__forcesit__toserve__upall__itsvalues__atonce__fordisplay__atthe__interactive REPL,though__thiscall__isnt__requiredand__mayeven__besubpar__insome__other contexts.More__on this,as__wellas__otherdictionary__basicslike__comparisons,later__inthis__chapter.Changing__Dictionariesin__PlaceLet__scontinue__withour__interactive session. Dictionaries,like__lists,are__mutable,so__youcan__change, expand,and__shrinkthem__inplace__withoutmaking__new dictionaries:simply__assigna__valueto__akey__tochange__orcreate__an entry.The__delstatement__works here, too;it__deletesthe__entryassociated__withthe__keyspecified__asan__index.Notice__alsothe__nestingof__alist__insidea__dictionaryin__thisexample__(thevalue__ofthe__key 'Py');all__collectiondata__typesin__Pythoncan__nestinside__eachother__arbitrarily,and__canbe__changedindependently__oftheir__containing objects: >>>D__{'hack': 1, 'Py': 2, 'code': 3} >>> D['Py'] = ['app', 'dev'] #Change__entry (value=list) >>>D__{'hack': 1, 'Py': ['app', 'dev'], 'code': 3} >>>del__D['code'] #Delete__entry (also D.pop(k)) >>>D__{'hack': 1, 'Py': ['app', 'dev']} >>> D['years'] = 32 #Add__newentry__>>>D__{ {'hack': 1, 'Py': ['app', 'dev'], 'years': 32} >>> D['Py'][0] = 'program' #Change__anested__listin__place >>>D__{'hack': 1, 'Py': ['program', 'dev'], 'years': 32}Like__lists,assigning__toan__existingindex__ina__dictionarychanges__itsassociated__value.Unlike__lists, however,whenever__youassign__anew__dictionarykey__(onethat__isnt__already present)you__createa__newentry__inthe__dictionary,as__wasdone__inthe__previousexample__forthe__key 'years'.This__doesnt__workfor__listsbecause__youcan__onlyassign__toexisting__listoffsets__Pythonconsiders__anoffset__beyondthe__endof__alist__outof__boundsand__raisesan__error.As__youlearned__earlier,to__expanda__list,you__needto__usetools__suchas__theappend__methodor__sliceassignment__instead.More__DictionaryMethods__Dictionarymethods__providea__varietyof__type-specific tools.For__instance,the__dictionaryvalues__anditems__methodsreturn__allof__thedictionary__svalues__and (key,value)pair__tuples, respectively;along__with keys,these__areuseful__inloops__thatneed__tostep__throughdictionary__entriesone__byone__(well__startcoding__suchloops__laterin__this chapter).As__with keys,these__twomethods__alsoreturn__iterable objects,and__wrappingthem__ina__listcall__collectstheir__valuesall__atonce__for display: >>>D__= {'program': 1, 'script': 2, 'app': 3} >>> list(D.keys()) #All__keys ['program', 'script', 'app'] >>> list(D.values()) #All__values [1, 2, 3] >>> list(D.items()) #All__(key, value)tuples__[('program', 1), ('script', 2), ('app', 3)]In__realisticprograms__thatgather__dataas__they run,you__oftenwon__tbe__ableto__predictwhat__willbe__ina__dictionarybefore__theprogram__is launched,much__lesswhen__its__coded.Fetching__anonexistent__keyis__normallyan__error,but__theget__methodreturns__adefault__value None,or__a passed-indefault__ifthe__keydoesn__t exist.It__san__easyway__tofill__ina__defaultfor__akey__thatisn__tpresent__andavoid__a missing-keyerror__whenyour__programcan__tanticipate__contentsahead__of time: >>> D.get('script') #A__keythat__ispresent__2 >>> print(D.get('code')) #A__keythat__ismissing__None >>> D.get('code', 4) 4The__updatemethod__providessomething__similarto__concatenationfor__dictionaries (thoughit__worksin__therealm__ofkeys__and values,not__just values).It__mergesthe__keysand__valuesof__onedictionary__into another,both__addingnew__entriesfor__new keys,and__blindlyoverwriting__valuesof__thesame__keyif__theres__a clash: >>>D__{'program': 1, 'script': 2, 'app': 3} >>> D2 = {'code':4, 'hack':5, 'app': 6} #New__keys added, app:6wins__>>> D.update(D2) >>>D__{'program': 1, 'script': 2, 'app': 6, 'code': 4, 'hack': 5} Finally,the__dictionarypop__methoddeletes__akey__froma__dictionaryand__returnsthe__valueit__had.It__ssimilar__tothe__listpop__method,but__ittakes__akey__insteadof__anoptional__position: >>> D.pop('app') #Pop__adictionary__key 6 >>> D.pop('hack') #Delete__keyand__returnits__value 5 >>>D__{'program': 1, 'script': 2, 'code': 4} >>>L__= ['aa', 'bb', 'cc', 'dd'] #Pop__alist__byposition__>>> L.pop() #Delete__andreturn__fromthe__end 'dd' >>> L.pop(1) #Delete__froma__specificposition__'bb' >>>L__['aa', 'cc']Dictionaries__alsoprovide__acopy__method that,as__youmight__guess,makes__a copy;we__llrevisit__thisin__Chapter 9,as__its__away__toavoid__thepotential__sideeffects__ofshared__referencesto__thesame__dictionary.In__fact,dictionaries__comewith__moremethods__thanthe__commonones__demoed here,and__overtime__maygain__othersbeyond__thoselisted__inTable__8-2; again,see__thePython__library manual,dir__and help,or__otherreference__resourcesfor__acomprehensive__list.Other__DictionaryMakers__Becausedictionaries__areso__useful,multiple__waysto__buildthem__haveemerged__over time.The__followingsummarizes__themost__common alternatives;its__lasttwo__callsto__thedict__constructor (really,type__name)have__thesame__effectas__theliteral__and key-assignmentforms__listedabove__them: {'name': 'Pat', 'age': 40} # 1)Traditional__literalexpression__D = {} # 2)Assign__bykeys__dynamically D['name'] = 'Pat' D['age'] = 40 dict(name='Pat', age=40) # 3)dict__keyword-argumentform__dict([('name', 'Pat'), ('age', 40)]) # 4)dict__key/valuetuples__formAll__fourof__theseforms__createthe__same two-key dictionary,but__theyare__usefulin__differing circumstances:The__firstis__handyif__youcan__spellout__theentire__dictionaryahead__of time.The__secondis__ofuse__ifyou__needto__createthe__dictionaryone__fieldat__atime__onthe__fly.The__thirdinvolves__lesstyping__thanthe__first,but__itrequires__allkeys__tobe__strings.The__lastis__usefulif__youneed__tobuild__upkeys__andvalues__assequences__at runtime.We__met name=valuekeyword__argumentsearlier__whensorting__lists;the__dictform__inthis__summarythat__usesthem__isnewer__thanliterals__andcommon__inPython__code,because__ithas__lesssyntax__(andhence__lessroom__for mistakes).The__lastform__inthe__summaryis__alsocommonly__usedin__conjunctionwith__thezip__function,to__combineseparate__listsof__keysand__valuesobtained__dynamicallyat__runtime (parsedout__ofa__datafile__s columns,for__instance): dict(zip(keyslist, valueslist)) #Zipped__key/valuetuples__form (ahead)There__ismore__onzipping__dictionarykeys__inthe__next section.Provided__allthe__keys__valuesare__thesame__initially,you__canalso__createa__dictionarywith__thefollowing__specialform__simplypass__ina__listof__keysand__aninitial__valuefor__allof__thevalues__(thedefault__is None).Notice__thisis__runfrom__thedict__type name,not__anactual__dictionary: >>> dict.fromkeys(['a', 'b'], 0) {'a': 0, 'b': 0}Although__youcould__getby__withjust__literalsand__keyassignments__atthis__pointin__yourPython__career,you__llprobably__finduses__forall__ofthese__dictionary-creationforms__asyou__startapplying__themin__realisticPython__programs. Dictionary-literalunpacking__Asof__Python 3.5,dictionary__literalsalso__supporta__special **syntax__thatunpacks__thecontents__ofanother__dictionaryin__itstop__level,similar__tothe__*in__listliterals__wemet__earlier.Any__numberof__**can__appearin__aliteral__tounpack__anynumber__of dictionaries,and__therightmost__svalue__winswhen__keys collide: >>>D__= dict(a=4, c=3) >>> {'a': 1, 'b': 2, **D} # Dictionary-literalunpacking__{'a': 4, 'b': 2, 'c': 3} >>> dict(a=1, b=2) |D__# Same,but__withunion__operator {'a': 4, 'b': 2, 'c': 3}As__shown,the__effectof__**is__similarto__boththe__updatemethod__wemet__earlierand__thedictionary__|union__coveredahead__andmight__avoida__follow-upupdate__callin__some contexts.It__salso__relatedto__the extended-unpackingassignment__statementyou__llmeet__inChapter__11.The__**also__worksin__dict,but__simplybecause__**unpacks__keywordarguments__inany__functioncall__(asusual__in Python,this__relieson__largerconcepts__well__reachlater__inthis__book).Unlike__in {}literals__though, **in__dictfails__ifany__keyappears__twice: >>> dict(a=1, **{'b': 2}, **dict(c=3)) #Works__in dict(),as__inall__calls {'a': 1, 'b': 2, 'c': 3} #As__longas__nokeys__are repeated! >>> dict(a=1, b=2, **dict(a=4, c=3)) TypeError: dict()got__multiplevalues__forkeyword__argument 'a'The__examplesso__fardemo__themany__basicways__tocreate__dictionaries,but__thereis__yetanother__thats__evenmore__powerful,as__thenext__sectionwill__explain.Dictionary__ComprehensionsLike__theset__andlist__comprehensionswe__metin__previous coverage,dictionary__comprehensionsrun__animplied__loop,collecting__the key/valueresults__ofexpressions__oneach__iterationand__usingthem__tofill__outa__new dictionary.A__loopvariable__allowsthe__comprehensionto__useloop__iterationvalues__alongthe__way.The__neteffect__letsus__createnew__dictionarieswith__smallbits__ofcode__thatare__simplerthan__the full-blownstatements__well__studylater__inthis__book. Abstractly,dictionary__comprehensionsmap__tofor__loopsas__follows,where__bothk__andv__canuse__loopvariable__x: {k:v__forx__in iterable} #Dictionary__comprehensionnew__= {} #Equivalent__loopcode__forx__in iterable: new[k] =v__To illustrate,a__standardway__toinitialize__adictionary__dynamicallyis__tocombine__itskeys__andvalues__with zip,and__passthe__resultto__thedict__call,per__thelast__section.The__zip built-infunction__isthe__hookthat__allowsus__toconstruct__adictionary__fromkey__andvalue__liststhis__wayif__youcannot__predictthe__setof__keysand__valuesin__your code,you__maybe__ableto__buildthem__upas__listsand__zipthem__together.We__llstudy__zipin__detailin__thenext__partof__this book;it__san__iterable,so__wemust__wrapit__ina__listcall__toshow__itsresults__there,but__itsbasic__usageis__otherwise straightforward: >>> list(zip(['a', 'b', 'c'], [1, 2, 3])) #Zip__togetherkeys__andvalues__[('a', 1), ('b', 2), ('c', 3)] >>>D__= dict(zip(['a', 'b', 'c'], [1, 2, 3])) #Make__adict__fromzip__result >>>D__{'a': 1, 'b': 2, 'c': 3}You__canachieve__thesame__effect, though,with__adictionary__comprehension expression.The__followinguses__tupleassignment__tounpack__itemsinto__variables (perits__Chapter 4 debut),as__itscans__thelist__ofzipped__pairsfrom__leftto__right.The__neteffect__buildsa__newdictionary__witha__key/valuepair__forevery__suchpair__inthe__zipresult__(thePython__codereads__almostthe__sameas__this natural-language description,but__witha__bitmore__formality): >>>D__= {k:v__for (k, v)in__zip(['a', 'b', 'c'], [1, 2, 3])} >>>D__{'a': 1, 'b': 2, 'c': 3}Comprehensions__arelonger__tocode__inthis__case,but__theyre__alsomore__generalthan__thisexample__implieswe__canuse__themto__mapa__singlestream__ofvalues__todictionaries__andapply__themto__anykind__ofsequence__(orother__iterable),and__collectedkeys__canbe__computedwith__expressionsjust__likecollected__values: >>>D__= {x:x__** 2for__xin__[1, 2, 3, 4]} # Or:in__range(1, 5) >>>D__{1: 1, 2: 4, 3: 9, 4: 16} >>>D__= {c:c__* 4for__cin__'HACK'} #Loop__overany__iterable >>>D__{'H': 'HHHH', 'A': 'AAAA', 'C': 'CCCC', 'K': 'KKKK'} >>>D__= {c.lower(): (c + '!')for__cin__['HACK', 'PY', 'CODE']} # Expr:expr__>>>D__{'hack': 'HACK!', 'py': 'PY!', 'code': 'CODE!'}Dictionary__comprehensionsare__alsouseful__forinitializing__dictionariesfrom__keys lists,in__muchthe__sameway__asthe__fromkeysmethod__wemet__atthe__endof__thepreceding__section: >>>D__= dict.fromkeys(['a', 'b', 'c'], 0) #Initialize__dictfrom__keys >>>D__{'a': 0, 'b': 0, 'c': 0} >>>D__= {k: 0for__kin__['a', 'b', 'c']} # Same,but__witha__comprehension >>>D__{'a': 0, 'b': 0, 'c': 0} >>>D__= dict.fromkeys('code') #Other__iterables,default__value >>>D__{'c': None, 'o': None, 'd': None, 'e': None} >>>D__= {k:None__fork__in 'code'} >>>D__{'c': None, 'o': None, 'd': None, 'e': None}Like__itslist__andset__relatives,dictionary__comprehensionssupport__additionalsyntax__notshown__here,including__ifclauses__tofilter__valuesout__of results,and__nestedfor__loops. Unfortunately,to__trulyunderstand__dictionary comprehensions,you__needto__alsoknow__moreabout__iterationstatements__andconcepts__in Python,and__thisbook__hasnt__yetdisclosed__enoughinformation__totell__thatstory__well.You__lllearn__muchmore__aboutall__flavorsof__comprehensions list, set, dictionary,and__generatorin__Chapters 14and__20,so__well__deferfurther__detailsuntil__later.Key__InsertionOrdering__By now,you__veprobably__noticedthat__dictionariesremember__theirkeys__orderno__matterwhat__sortof__syntaxwe__useto__make them.As__notedboth__earlierhere__andin__Chapter 4,as__ofPython__3.7 (andCPython__3.6),dictionaries__haveshed__theirformer__randomkey__orderand__adoptedinsertion__order instead:keys__arenow__orderedleft__toright__fromoldest__tonewest__additions.This__orderis__maintainedfor__literals,dict__calls, comprehensions,and__newkeys__addedon__the fly.Among__other things,insertion__ordermakes__dictionaryoutputs__arguablymore__coherentand__readableand__mayavoid__keysorts__insome__programs.This__isnt__thesame__asa__list (e.g.,there__sno__wayto__adda__keyin__themiddle__)and__doesnt__makedictionaries__sequences.The__effect, however,is__close.Here__sa__brief illustration: >>>D__= dict(a=1, b=2) #Literal__keysstored__left-to-right >>> D['c'] = 3 #New__keysalways__addedat__theend__>>>D__{'a': 1, 'b': 2, 'c': 3} >>> D.pop('b') #Method__popremoves__anykey__byname__2 >>>D__#Other__keysstill__ininsertion__order {'a': 1, 'c': 3} >>> D['b'] = 2 #Earlier__keygoes__atthe__endtoo__>>>D__{'a': 1, 'c': 3, 'b': 2} >>> D['c'] = 0 #Changing__values doesn'timpact__order >>> D['d'] = 1 #And__newarrivals__alwaysgo__atthe__end >>>D__{'a': 1, 'c': 0, 'b': 2, 'd': 1}If__youstare__atthis__long enough,you__llprobably__noticethat__theinsertion__orderof__dictionariesis__muchlike__theLIFO__stackordering__wecoded__withlist__appendand__popmethods__earlier.In__fact,the__dictionarypopitem__isdefined__toreturn__the key/valuepair__(really, tuple)for__thekey__addedmost__recently (i.e.,at__the end): >>> D.popitem() ('d', 1) >>> D.popitem() ('b', 2) >>>D__{'a': 1, 'c': 0}While__usefulin__some contexts,keep__inmind__thatyou__maystill__needto__sortdictionary__keys manually,using__techniqueswe__llstudy__ahead.Ordering__filenamesfor__display,for__example,will__oftenwarrant__string-valuesorts__insteadof__aprogram__sinternal__insertion order.Dictionary__UnionOperator__Lastup__inthe__dictionarytoolbox__isa__bitof__an oddball:as__ofPython__3.9,dictionaries__havesprouted__aunion__operationthat__skicked__offwith__the |operator__thesame__syntaxused__forunion__inthe__setobjects__youmet__inChapter__5.Per__the quotes, though,this__operationisn__treally__mathematicalset__unionat__all.It__sa__positionally sensitive, key-basedmerge__of dictionaries,that__worksthe__sameas__thedictionary__updatemethod__butreturns__itsresult__asa__newdictionary__insteadof__updatinga__subjectin__place. Hence,dictionary__|is__likethe__combinationof__runningthe__dictionarys__copyand__updatemethods__in turn,and__reallyjust__aminor__conveniencefor__narrow roles.Here__itis__at work: >>>D__= dict(a=1, b=2) >>>D__{'a': 1, 'b': 2} >>>D__| {'b': 3, 'c': 4} # Update, return,rightmost__wins {'a': 1, 'b': 3, 'c': 4} >>>D__| {'b': 3, 'c': 4} | dict(a=5, d=6) {'a': 5, 'b': 3, 'c': 4, 'd': 6}You__getroughly__thesame__mileagewith__thedictionary__slongstanding__update method,though__itrequires__amanual__copyto__avoid in-placechanges__inprograms__thatdon__twant__them (asa__spoiler,the__|= in-placeassignment__formof__dictionaryunion__thatyou__llmeet__laterin__thisbook__isidentical__tocalling__updatewith__asingle__argumentsans__copy): >>>D__{'a': 1, 'b': 2} >>>C__= D.copy() >>> C.update({'b': 3, 'c': 4}) # "Union"sans__the |expression__>>> C.update(dict(a=5, d=6)) >>>C__{'a': 5, 'b': 3, 'c': 4, 'd': 6}The__Python 3.5 dictionary-literalunpacking__weexplored__earliercan__havethe__sameeffect__too, though,at__leastwhen__usedwith__gnarlyembedded__literalsas__inthe__following,perhaps__less readably: >>>D__{'a': 1, 'b': 2} >>> {**D, **{'b': 3, 'c': 4}, **dict(a=5, d=6)} {'a': 5, 'b': 3, 'c': 4, 'd': 6}Which__truesports__fanswill__noteraises__thenumber__ofdedicated__dictionarymerge__operationsfrom__oneto__threesince__thisbook__sprior__edition.This__bloatis__especially grievous,given__thatit__takesjust__oneline__ofsimple__codeto__accomplishwhat__theupdate__method,the__newer ** unpacking,and__thenewest__|union__operatorall__redundantlydo__intheir__mainuse__cases: >>> D1 = dict(a=1, b=1) >>> D2 = dict(a=2, c=2) >>>for__kin__D2: D1[k] = D2[k] #What__update(), **,and__|redundantly__do >>> D1 #Did__thisreally__justify 3 alternatives? {'a': 2, 'b': 1, 'c': 2}Dictionary__|union__maybe__handyin__limited contexts.But__whetherthis__justifiesconvoluting__dictionarieswith__justone__binary operator,just__oneof__manyset__operations,and__anoperation__thats__almostentirely__redundantwith__twoearlier__toolsthat__werealready__almostentirely__redundantwith__verysimple__code,is__ariddle__leftto__thereader__to solve. Intermission:Books__DatabaseLet__stake__abreak__fromthe__finepoints__andcode__amore__concreteexample__ofdictionaries__at work.In__honorof__thisbook__s quarter-century milestone,the__followingbuilds__asimple__in-memoryeditions__databasethat__mapsedition__years (the keys)to__titles (the values).As__coded,you__fetchedition__namesby__indexingon__year strings: >>>table__= {'2024': 'Learning Python, 6th Edition', #Year__=>title__'2013': 'Learning Python, 5th Edition', '1999': 'Learning Python'} >>> table['2024'] #Key__=>Value__'Learning Python, 6th Edition' >>>for__yearin__table: #Keys__iteration print(year + '\t' + table[year]) 2024Learning__Python, 6thEdition__2013Learning__Python, 5thEdition__1999Learning__PythonThe__lastcommand__usesa__for loop,which__weve__usedseveral__timessince__itsChapter__4 preview.The__fulltale__ofthe__forisn__ttold__untilChapter__13,but__thisparticular__loopsimply__iteratesthrough__eachkey__inthe__tableto__printa__tab-separated__listof__keysand__theirvalues__(recallfrom__Chapter 7that__\tin__aPython__stringmeans__vertical tab).Dictionaries__arent__sequenceslike__listsand__strings,but__ifyou__needto__stepthrough__theitems__ina__dictionary,it__seasy__eithercall__thedictionary__keysmethod__oruse__thedictionary__itself.Given__adictionary__D,saying__forkey__inD__worksthe__sameas__sayingfor__keyin__D.keys(),and__bothuse__theiteration__protocolthat__well__expandon__laterin__this book.Either__way,you__canindex__fromkey__tovalue__insidethe__forloop__asyou__go,as__thiscode__does.Mapping__valuesto__keysNotice__howthe__priortable__mapsyears__to titles,but__notvice__versa.If__youwant__tomap__theother__waytitles__toyears__youcan__eithercode__thedictionary__differently: >>>table__= {'Learning Python, 6th Edition': 2024, #Title__=>year__'Learning Python, 5th Edition': 2013, 'Learning Python': 1999} >>> table['Learning Python'] #Key__=>value__1999Or__useother__dictionarymethods__likeitems__thatgive__searchablesequences__(thelist__callis__requiredin__thefollowing__becauseitems__returnsan__iterable view,a__topiccoming__up shortly): >>> list(table.items())[:2] [('Learning Python, 6th Edition', 2024), ('Learning Python, 5th Edition', 2013)] >>> [titlefor__(title, year)in__table.items()if__year == 1999] #Value__=>key__['Learning Python']The__lastcommand__hereuses__thelist__comprehensionwe__explored earlier,as__wellas__tupleassignment__mentionedearlier__andcovered__inthis__books__nextpart__(synopsis:it__unpacksitems__into variables).The__comboscans__the (key, value)pairs__returnedby__thedictionary__sitems__method,selecting__keysfor__valuesmatching__asearch__target (1999).The__neteffect__ofall__thisis__toindex__backwardfrom__valueto__key,instead__ofkey__to value.This__isuseful__ifyou__wantto__storedata__justonce__andmap__backwardfrom__valuesonly__rarely (searchingthrough__sequenceslike__thisis__generallymuch__slowerthan__adirect__key-to-value index,though__notall__programsneed__to care).In__fact,although__dictionariesby__naturemap__keysto__values unidirectionally,there__aremultiple__waysto__mapvalues__backto__keyswith__abit__ofextra__generalizable code: >>>K__= 'Learning Python' >>>V__= 1999 >>> table[K] #Key__= >Value (normal usage) 1999 >>> [keyfor__(key, value)in__table.items()if__value == V] #Value__=>Key__['Learning Python'] >>> [keyfor__keyin__table.keys()if__table[key] == V] # Same: keys() ['Learning Python']Note__thatboth__ofthe__lasttwo__commandsreturn__alist__of titles:in__dictionaries,there__sjust__onevalue__per key,but__theremay__bemany__keysper__valueif__agiven__valueis__bestored__undermultiple__keys,and__avalue__mightbe__acollection__itselfto__representmany__valuesper__key.It__salso__possibleto__inverta__dictionaryfor__indexingvalues__byzipping__itsvalues__andkeys__butonly__ifits__valuesare__allimmutable__anddon__tappear__inmultiple__keys: >>> dict(zip(table.values(), table.keys()))[1999] # Key/value inversion? 'Learning Python' Sharp-eyedreaders__maynotice__thatthis__yieldsa__dictionarywith__integer keys,which__worksnaturally__pera__tipin__thenext__section.For__moreon__this front,watch__fora__lesslossy__dictionaryinversion__functionin__the mapattrs.pyexample__from Example:Mapping__Attributesto__InheritanceSources__codethat__wouldsurely__stretchthis__previewpast__itsbreaking__pointif__included here.For__thischapter__s purposes,let__swrap__upby__addingin__afew__pragmaticpieces__tothe__dictionary puzzle.Dictionary__UsageTips__Dictionariesare__fairlystraightforward__toolsonce__youget__thehang__of them,but__hereare__afew__additionalpointers__andreminders__youshould__beaware__ofwhen__using them:Sequence__operationsdon__twork__Dictionariesare__mappings,not__sequences.Because__theydeal__withkeys__andvalues__andare__orderedby__insertion-time only,things__likeconcatenation__(anordered__joiningof__values)and__slicing (extractinga__contiguoussection__of values)simply__dont__applyand__Pythonraises__anerror__ifyour__codetries__touse__themon__dictionaries.Assigning__tonew__indexesadds__entriesKeys__canbe__createdwhen__youwrite__adictionary__literal (embeddedin__thecode__ofthe__literal itself),or__whenyou__assignvalues__tonew__keysof__anexisting__dictionaryobject__individually.The__endresult__isthe__same.Keys__neednot__alwaysbe__stringsOur__examplesso__farhave__usedstrings__as keys,but__anyother__immutableobjects__workjust__as well.For__instance,you__canuse__integersas__keys,which__makesthe__dictionarylook__muchlike__alist__(when indexing,at__least).Tuples__maybe__usedas__dictionarykeys__too,allowing__compoundkey__valuessuch__asdates__andIP__addressesto__haveassociated__values. User-definedclass__instanceobjects__(discussedin__Part VI)can__alsobe__usedas__keys,as__longas__theydefine__theproper__methods; roughly,they__needto__tellPython__thattheir__valuesare__hashableand__thuswon__t change,as__otherwisethey__wouldbe__uselessas__fixed keys.Mutable__objectssuch__as lists, sets,and__otherdictionaries__dont__workas__keysbecause__theymay__change,but__areallowed__as values.The__followingsections__delvedeeper__intothese__andother__mysteriesof__dictionary-processing__code.Using__dictionariesto__simulateflexible__lists:Integer__keysThe__lastpoint__inthe__precedinglist__isimportant__enoughto__demonstratewith__afew__examples.When__youuse__lists,it__isillegal__toassign__toan__offsetthat__isoff__theend__ofthe__list: >>>L__= [] >>> L[99] = 'hack' IndexError:list__assignmentindex__outof__rangeAlthough__youcan__userepetition__topreallocate__asbig__alist__asyou__llneed__(e.g., [0]*100),you__canalso__dosomething__thatlooks__similarwith__dictionariesthat__doesnot__requiresuch__spaceallocations__andpotential__waste.By__usinginteger__keys,dictionaries__canemulate__liststhat__seemto__growon__offset assignment: >>>D__= {} >>> D[99] = 'hack' >>> D[99] 'hack' >>>D__{99: 'hack'} Here,it__looksas__ifD__isa__100-item list,but__its__reallya__dictionarywith__asingle__entry;the__valueof__thekey__99is__thestring__'hack'.You__canaccess__thisstructure__withoffsets__muchlike__a list,catching__nonexistentkeys__withget__orin__testsif__required,but__youdon__thave__toallocate__spacefor__allthe__positionsto__whichyou__mightneed__toassign__valuesin__the future.When__usedlike__this,dictionaries__arelike__moreflexible__equivalentsof__lists: >>> D[62] = 'code' >>> D[30] = 'write' >>> D[62] 'code' >>>D__{99: 'hack', 62: 'code', 30: 'write'}As__another example,we__mightalso__employinteger__keysin__thefirst__book book-database__codewe__wroteearlier__toavoid__quotingthe__year,albeit__atthe__expenseof__expressiveness (integerkeys__cannotcontain__nondigit characters): >>>table__= {2024: 'Learning Python, 6th Edition', #Integers__workas__keysetc__>>> table[2024] 'Learning Python, 6th Edition'Using__dictionariesfor__sparsedata__structures:Tuple__keysIn__asimilar__way,dictionary__keysare__alsocommonly__leveragedto__implementsparse__mostlyempty__data structures,such__asmultidimensional__arrayswhere__onlya__fewpositions__havevalues__storedin__them: >>>Matrix__= {} >>> Matrix[(2, 3, 4)] = 88 >>> Matrix[(7, 8, 9)] = 99 >>> >>>X__= 2;Y__= 3;Z__= 4 #A__;separates__statements:see__Chapter 10 >>> Matrix[(X, Y, Z)] 88 >>>Matrix__{(2, 3, 4): 88, (7, 8, 9): 99} Here,we__veused__adictionary__torepresent__a three-dimensionalarray__thatis__emptyexcept__forthe__twopositions__(2,3,4)and__(7,8,9).The__keysare__tuplesthat__recordthe__coordinatesof__nonempty slots.Rather__thanallocating__alarge__andmostly__empty three-dimensionalmatrix__tohold__these values,we__canuse__asimple__two-item dictionary.In__this scheme,accessing__anempty__slottriggers__anonexistent__key exception,as__theseslots__arenot__physically stored: >>> Matrix[(2,3,6)] KeyError: (2, 3, 6)Avoiding__missing-keyerrors__Errorsfor__nonexistentkey__fetcheslike__theforegoing__arecommon__insparse__matrixes,but__youprobably__wont__wantthem__toshut__downyour__program.There__areat__leastthree__waysto__fillin__adefault__valueinstead__ofgetting__suchan__errormessage__youcan__usethe__dictionaryget__methodshown__earlierto__providea__defaultfor__keysthat__donot__exist,test__forkeys__aheadof__timein__if statements,or__usea__trystatement__tocatch__andrecover__fromthe__error.Though__straightforward,the__lastof__theseare__previewsof__statementsyntax__well__beginstudying__inChapter__10: >>> Matrix.get((2, 3, 4), 0) # Exists:fetch__andreturn__88 >>> Matrix.get((2, 3, 6), 0) # Doesn't exist:use__passeddefault__0 >>>if__(2, 3, 6)in__Matrix: #Check__forkey__beforefetch__... print(Matrix[(2, 3, 6)]) #See__Chapters 10and__12for__if/else ... else: ... print(0) ... 0 >>> try: ... print(Matrix[(2, 3, 6)]) #Try__toindex__...except__KeyError: #Catch__andrecover__... print(0) #See__Chapters 10and__34for__try/except ... 0Of__these,the__getmethod__isthe__mostconcise__interms__ofcoding__requirements,but__theif__andtry__statementsare__muchmore__generalin__scopeas__youll__startseeing__foryourself__soonin__Chapter 10.Nesting__indictionaries__Asyou__can tell,dictionaries__canplay__manyroles__in Python.In__general,they__canreplace__searchdata__structures (becauseindexing__bykey__isa__search operation)and__canrepresent__manytypes__ofstructured__information.For__example,dictionaries__areone__ofmany__waysto__describethe__propertiesof__anitem__inyour__programs__domain;that__is,they__canserve__thesame__roleas__recordsor__structsin__other language,and__JSONcontent__in language-neutral roles.The__following,for__example,fills__outa__dictionarydescribing__a book,by__assigningto__new keys: >>>rec__= {} >>> rec['title'] = 'Learning Python, 5th Edition' >>> rec['year'] = 2013 >>> rec['isbn'] = '9781449355739' >>> >>> rec['year'], rec['isbn'] (2013, '9781449355739')Especially__when nested, though,Python__s built-indata__typesallow__usto__easilyrepresent__structured information.The__followingagain__usesa__dictionaryto__captureobject__properties,but__itcodes__itall__atonce__ratherthan__assigningto__eachkey__separately,and__nestsa__dictionaryand__listto__representstructured__property values: >>>rec__= {'title': 'Learning Python, 5th Edition', 'date': {'year': 2013, 'month': 'July'}, 'isbns': ['1449355730', '9781449355739']}To__fetchcomponents__ofnested__objects,simply__stringtogether__indexing operations: >>> rec['title'] 'Learning Python, 5th Edition' >>> rec['isbns'] ['1449355730', '9781449355739'] >>> rec['isbns'][1] '9781449355739' >>> rec['date']['year'] 2013Although__youll__learnin__PartVI__thatclasses__(whichgroup__bothdata__and logic)can__sometimesbe__betterin__thisrecord__role,dictionaries__arean__easy-to-usetool__forsimpler__requirements.For__moreon__recordrepresentation__choices,see__alsothe__upcomingsidebar__WhyYou__Will Care:List__VersusDictionary__VersusSet__.Also__noticethat__whilewe__vefocused__ona__singlerecord__withnested__data here,there__sno__reasonwe__couldnt__nestthe__recorditself__ina__larger,enclosing__databasecollection__codedas__alist__or dictionary,though__anexternal__fileor__formaldatabase__interfaceoften__playsthe__roleof__top-levelcontainer__inrealistic__programs.The__followingabstract__snippetswould__bothprint__arecord__s two-itemisbns__listif__runlive__andprovided__withan__otherrecord__omitted here:db__= [] db.append(rec) #A__list "database" db.append(other) db[0]['isbns']db__= {} db['lp5e'] =rec__#A__dictionary "database" db['lp6e'] =other__db['lp5e']['isbns']Later__inthe__bookyou__llmeet__toolssuch__asPython__s shelve,which__worksmuch__thesame__way,but__automaticallymaps__objectsto__andfrom__filesto__makethem__permanent.Python__objectsreally__canbe__database records.Dictionary__key/value/itemview__objectsWhen__weexplored__thedictionary__keys, values,and__itemsmethods__earlier,we__wrappedtheir__resultsin__listcalls__fordisplay__atthe__REPL prompt. Technically,this__isbecause__thesemethods__returnview__objectsthat__produceresults__on demand,instead__ofphysical__lists.Displaying__theirraw__valuessuggests__as much,but__collectstheir__values anyhow: >>>D__= dict(program=1, script=2, app=3) >>> D.keys() dict_keys(['program', 'script', 'app'])View__objectsare__iterables,which__weve__seensimply__meansobjects__thatgenerate__resultitems__oneat__a time,instead__ofproducing__theresult__listall__atonce__in memory.Besides__being iterable,dictionary__viewsare__insertion ordered,reflect__futurechanges__tothe__dictionary,and__supportset__operations.On__theother__hand,because__theyare__not lists,they__donot__directlysupport__operationslike__indexingor__thelist__sort method,and__donot__displayas__anormal__listwhen__printed.We__lldiscuss__thenotion__ofiterables__moreformally__inChapter__14,but__forour__purposeshere__its__enoughto__knowthat__wehave__torun__theresults__ofthese__threemethods__throughthe__list built-inif__wewant__toapply__listoperations__ordisplay__theirvalues__as lists.For__example: >>>D__= dict(a=1, b=2, c=3) >>>D__{'a': 1, 'b': 2, 'c': 3} >>>K__= D.keys() #Makes__aview__object,not__alist__>>>K__dict_keys(['a', 'b', 'c']) >>> list(K) #Force__areal__listwhen__needed ['a', 'b', 'c'] >>>V__= D.values() #Ditto__forvalues__anditems__views >>>V__dict_values([1, 2, 3]) >>> list(V) [1, 2, 3] >>> D.items() dict_items([('a', 1), ('b', 2), ('c', 3)]) >>> list(D.items()) [('a', 1), ('b', 2), ('c', 3)] >>> K[0] #List__operationsfail__unlessconverted__TypeError: 'dict_keys'object__isnot__subscriptable >>> K.sort() AttributeError: 'dict_keys'object__hasno__attribute 'sort' >>> list(K)[0], list(K).sort() ('a', None)Unlike__lists, though,dictionary__viewsdon__ttake__upspace__fortheir__full results,and__arenot__carvedin__stonewhen__createdthey__dynamicallyreflect__futurechanges__madeto__thedictionary__afterthe__viewobject__hasbeen__created: >>>D__= {'a': 1, 'b': 2, 'c': 3} >>>D__{'a': 1, 'b': 2, 'c': 3} >>>K__= D.keys() >>>V__= D.values() >>> list(K), list(V) #Views__maintainsame__orderas__dictionary (['a', 'b', 'c'], [1, 2, 3]) >>>del__D['b'] #Change__thedictionary__inplace__>>>D__{'a': 1, 'c': 3} >>> list(K), list(V) #Reflected__inany__currentview__objects (['a', 'c'], [1, 3])That__said,use__casesfor__dynamicview__morphare__likely rare.In__fact,apart__fromresult__displaysat__theinteractive__prompt,you__probablywon__teven__noticeviews__veryoften__in practice,because__loopingconstructs__inPython__automaticallyforce__themto__produceone__resulton__each: >>>for__kin__D.keys(): print(k) #View__iteratorsused__automaticallyin__loops ... #But__noneed__tocall__keys()to__iterateon__Da__bc__Aswe__ve seen,it__salso__oftenunnecessary__tocall__keysdirectly__insuch__casesbecause__dictionariesthemselves__provideimplicit__key iterators;for__betteror__worse,for__kin__Dis__usuallyas__muchcode__asyou__needto__type.Dictionary__viewsand__setsThough__perhapseven__moreobscure__thanview__objectsin__general,some__dictionaryviews__arealso__set-likeand__supportset__operationssuch__asunion__andintersection__thatwe__usedon__truesets__inChapter__5. Specifically,views__returnedby__thekeys__methodare__set-like,values__viewsare__not,and__itemsviews__areif__their (key, value)pairs__areunique__andhashable__(immutable).This__reflectslogical__symmetry:set__itemsare__uniqueand__immutablejust__likedictionary__keys,and__setsthemselves__behavelike__unorderedand__valuelessdictionaries__(andare__evencoded__incurly__braces).Here__iswhat__keysviews__looklike__whenused__inset__operations (continuingthe__priorsection__s session);as__also shown,dictionary__valueviews__arenever__set-like,because__theiritems__arenot__necessarilyunique__or immutable: >>> K,V__(dict_keys(['a', 'c']), dict_values([1, 3])) >>>K__| {'x': 4} #Keys__(andsome__items)views__are set-like {'x', 'a', 'c'} #Results__areunordered__sets,not__views >>>V__| {'x': 4} TypeError:unsupported__operand type(s)for__|: 'dict_values'and__'dict' >>>V__| {'x': 4}.values() TypeError:unsupported__operand type(s)for__|: 'dict_values'and__'dict_values'Be__carefulnot__toconfuse__the |here__withthe__dictionaryunion__operationwe__metearlier__inDictionary__UnionOperator__;when__runon__a view, |is__nota__full key-baseddictionary__merge.In__set operations,views__maybe__mixedwith__other views, sets,and__dictionaries,and__dictionariesare__treatedthe__sameas__theirkeys__views: >>>D__= {'a': 1, 'b': 2, 'c': 3} >>> D.keys() & D.keys() #Intersect__views {'b', 'a', 'c'} >>> D.keys() & {'b'} #Intersect__viewand__set {'b'} >>> D.keys() & {'b': 1} #Intersect__viewand__dict {'b'} >>> D.keys() | {'b', 'c', 'd'} #Union__viewand__set {'b', 'a', 'd', 'c'}Items__viewsare__set-like too,but__onlyif__theyare__hashablethat__is,if__theycontain__onlyimmutable__objects: >>> {'a': [1, 2]}.items() | {0, 1} #Immutable__value:no__setops__TypeError:unhashable__type: 'list' >>>D__= {'a': 1} >>> D.items() #Items__set-likeif__andonly__ifhashable__dict_items([('a', 1)]) >>> D.items() | D.keys() #Union__viewand__view {('a', 1), 'a'} >>> D.items() |D__#Dictionary__treatedsame__asits__keys {('a', 1), 'a'} >>> D.items() | {('c', 3), ('d', 4)} #Set__of key/valuepairs__{('a', 1), ('c', 3), ('d', 4)} >>> dict(D.items() | {('c', 3), ('d', 4)}) #dict__acceptsiterable__setstoo__{'a': 1, 'c': 3, 'd': 4}See__Chapter 5s__coverageof__setsif__youneed__arefresher__onthese__operations.Their__rolein__dictionaryviews__isprobably__uncommonand__mayeven__be academic;but__theywork__whenhelpful__(andat__leastyou__nowhave__afighting__chancewhen__theycrop__upin__sadisticfinal__exams!). Here,let__swrap__upwith__twomore__quickcoding__notesfor__dictionaries.Sorting__dictionarykeys__Firstof__all,keys__listsmust__besorted__whenthe__inherentinsertion__orderdoesn__tmeet__your goals. Beware, though,that__acommon__codingpattern__forscanning__acollection__insorted__orderwon__t work,because__keysdoes__notreturn__a list: >>>D__= {'c': 3, 'b': 2, 'a': 1} >>>D__{'c': 3, 'b': 2, 'a': 1} >>>Ks__= D.keys() #Sorting__aview__object doesn't work! >>> Ks.sort() AttributeError: 'dict_keys'object__hasno__attribute 'sort'To__workaround__this,you__caneither__convertkeys__toa__list manually,or__usethe__sorted call,applied__tolists__earlierin__this chapter,on__eithera__keysview__orthe__dictionary itself: >>>Ks__= list(D.keys()) #Convert__keysto__alist__>>> Ks.sort() #And__thensort__with list.sort() >>>for__kin__Ks: print(k, D[k]) ...a__1b__2c__3 >>>Ks__= D.keys() #Or__use sorted()on__thekeys__view >>>for__kin__sorted(Ks): print(k, D[k]) # sorted()accepts__anyiterable__... # sorted()returns__itsresult__a 1b__2c__3Of__these,using__thedictionary__skeys__iteratoris__simplestand__common,though__alsoarguably__implicit: >>>for__kin__sorted(D): print(k, D[k]) #Or__use sorted()on__thedict__... #dict__iteratorsproduce__keysa__1b__2c__3Dictionary__magnitudecomparisons__Finally,dictionaries__canbe__comparedfor__equalitydirectly__with ==,which__automaticallycompares__each key/valuepair__andignores__insertion order: >>> D1 = dict(a=1, b=2, c=3) >>> D2 = dict(c=3, b=2, a=1) >>> D1, D2 ({'a': 1, 'b': 2, 'c': 3}, {'c': 3, 'b': 2, 'a': 1}) >>> D1 == D2, D1 != D2 (True, False)Magnitude__comparisonslike__<and__>do__notwork__ondictionaries__themselves,though__youcan__implementthem__bycomparing__key/valueitems__views manually,if__youalso__sortthem__todiscount__any insert-orderdifference__(subtlety:a__>on__theitems__resultsdirectly__runsthe__setsuperset__testbecause__theviews__are set-likenot__greater-than!): >>> D1 = dict(a=1, b=2, c=4) >>> D2 = dict(c=3, b=2, a=1) # D1 > D2: D1['c'] > D2['c'] >>> D1 > D2 TypeError: '>'not__supportedbetween__instancesof__'dict'and__'dict' >>> list(D1.items()), list(D2.items()) ([('a', 1), ('b', 2), ('c', 4)], [('c', 3), ('b', 2), ('a', 1)]) >>> list(D1.items()) > list(D2.items()) # Fails:insertion__orderFalse__>>> D1.items() > D2.items() # Fails: superset,not__magnitudeFalse__>>> sorted(D1.items()) > sorted(D2.items()) # OK:sorted__toneutralize__orderTrue__Becausewe__llrevisit__thisnear__theend__ofthe__nextchapter__toreinforce__themin__thecontext__ofcomparisons__at large,we__llpostpone__furthercoverage__here.Chapter__SummaryIn__this chapter,we__exploredthe__listand__dictionarytypes__probablythe__twomost__common, flexible,and__powerfulcollection__typesyou__willsee__anduse__inPython__code.We__learnedthat__thelist__typesupports__positionallyordered__collectionsof__arbitrary objects,and__thatit__maybe__freelynested__andgrown__andshrunk__on demand.The__dictionarytype__is similar,but__itstores__itemsby__keyinstead__ofby__positionand__orderskeys__byinsertion__time only.Both__listsand__dictionariesare__mutable,and__sosupport__avariety__of in-placechange__operationsnot__availablefor__strings:for__example,lists__canbe__grownby__sliceassignment__andappend__calls,and__dictionariesby__keyassignment__and update.In__thenext__chapter,we__willwrap__upour__in-depthcore__object-typetour__bylooking__attuples__and files.After__that,we__llmove__onto__statementsthat__codethe__logicthat__processesour__objects,taking__usanother__steptoward__writingcomplete__programs.Before__wetackle__those topics, though,here__aresome__chapterquiz__questionsto__reviewwhat__youve__learned.Test__Your Knowledge:Quiz__1.Name__twoways__tobuild__alist__containingfive__integer zeros. 2.Name__twoways__tobuild__adictionary__withtwo__keys, 'a'and__'b',each__havingan__associatedvalue__of 0. 3.Name__fouroperations__thatchange__alist__objectin__place. 4.Name__fouroperations__thatchange__adictionary__objectin__place. 5.Why__mightyou__usea__dictionaryinstead__ofa__list?Test__Your Knowledge:Answers__1.A__literalexpression__like [0, 0, 0, 0, 0]and__arepetition__expressionlike__[0] * 5will__eachcreate__alist__offive__zeros.In__practice,you__mightalso__buildone__upwith__aloop__thatstarts__withan__emptylist__andappends__0to__itin__each iteration,with__L.append(0).A__listcomprehension__like [0for__iin__range(5)]could__work here, too,but__thisis__morework__thanyou__needto__dofor__this answer. 2.A__literalexpression__suchas__{'a': 0, 'b': 0}or__aseries__ofassignments__likeD__= {}, D['a'] = 0,and__D['b'] = 0would__createthe__desired dictionary.You__canalso__usethe__newerand__simpler-to-code dict(a=0, b=0)keyword__form,or__themore__flexible dict([('a', 0), ('b', 0)]) key/valuesequences__form.Because__allthe__valuesare__the same,you__canalso__usethe__specialform__dict.fromkeys('ab', 0),and__dictionarycomprehension__like {k: 0for__kin__'ab'}suffices__too,though__again,this__maybe__overkill here. 3.The__appendand__extendmethods__growa__listin__place,the__sortand__reversemethods__orderand__reverse lists,the__insertmethod__insertsan__itemat__an offset,the__removeand__popmethods__deletefrom__alist__byvalue__andby__position,the__delstatement__deletesan__itemor__slice,and__indexand__sliceassignment__statementsreplace__anitem__orentire__section.Pick__anyfour__ofthese__forthe__quiz. 4.Dictionaries__areprimarily__changedby__assignmentto__anew__orexisting__key,which__createsor__changesthe__keys__associatedvalue__inthe__table. Also,the__delstatement__deletesa__keys__entry,the__dictionaryupdate__methodmerges__onedictionary__intoanother__in place,and__D.pop(key)removes__akey__andreturns__thevalue__it had.Dictionaries__alsohave__other,more__exotic in-placechange__methodspresented__terselyor__notat__allin__this chapter,such__aspopitem__and setdefault;see__referenceresources__formore__details. 5.This__questionis__abit__unfair,given__thatthe__followingsidebar__givesthe__answer,but__youmay__havealready__figuredthis__outon__your own.Dictionaries__aregenerally__betterwhen__thedata__islabeled__(arecord__withfield__names,for__example);lists__arebest__suitedto__collectionsof__unlabeleditems__(suchas__allthe__filesin__a directory).Dictionary__lookupis__alsousually__quickerthan__searchinga__list,though__thismight__varyper__programand__Python.WHY__YOUWILL__CARE:LIST__VERSUSDICTIONARY__VERSUSSET__Withall__theobjects__inPython__score__types arsenal,some__readersmay__bepuzzled__overthe__choicebetween__listsand__dictionaries.In__short,although__bothare__flexiblecollections__ofother__objects,lists__assignitems__to positions,and__dictionariesassign__themto__moremnemonic__keys.Because__of this,dictionary__dataoften__carriesmore__meaningto__human readers.For__example,a__nestedlist__structurecan__alwaysbe__usedto__record info: >>>L__= ['Pat', 40.5, ['dev', 'mgr']] # List-based "record" >>> L[0] 'Pat' >>> L[1] # Positions/numbersfor__fields 40.5 >>> L[2][1] 'mgr'For__sometypes__of data,the__lists__access-by-positionmakes__sensea__listof__employeesin__a company,the__filesin__a directory,or__numeric matrixes,for__example.But__amore__symbolicrecord__likethis__maybe__moremeaningfully__codedas__a dictionary,with__labeledfields__replacingfield__positions: >>>D__= {'name': 'Pat', 'age': 40.5, 'jobs': ['dev', 'mgr']} >>> D['name'] 'Pat' >>> D['age'] # Dictionary-based "record" 40.5 >>> D['jobs'][1] #Names__meanmore__thannumbers__'mgr'For__variety,here__isthe__samerecord__recodedwith__dictand__keywords,which__mayseem__evenmore__readableto__somehuman__readers: >>>D__= dict(name='Pat', age=40.5, jobs=['dev', 'mgr']) >>> D['name'] 'Pat' >>> D['jobs'].remove('mgr') >>>D__{'name': 'Pat', 'age': 40.5, 'jobs': ['dev']}In__practice,dictionaries__tendto__bebest__fordata__withlabeled__components,as__wellas__structuresthat__canbenefit__from quick,direct__lookupsby__name,instead__ofslower__linear (left-to-right) searches.As__weve__seen,they__alsomay__bebetter__forsparse__collectionsand__collectionsthat__grow flexibly.Python__programmersalso__haveaccess__tothe__setswe__studiedin__Chapter 5,which__aremuch__likethe__keysof__avalueless__dictionary;they__dont__mapkeys__to values,but__canoften__beused__likedictionaries__forfast__lookupswhen__thereis__noassociated__value,especially__insearch__routines: >>>D__= {} >>> D['state1'] =True__#A__visited-statedictionary__>>> 'state1'in__DTrue__>>>S__= set() >>> S.add('state1') # Same,but__withsets__>>> 'state1'in__STrue__Watchfor__arehash__ofthis__recordrepresentation__threadin__thenext__chapter,where__youll__seehow__tuplesand__namedtuples__compareto__dictionariesin__this role,as__wellas__inChapter__27,where__youll__learnhow__user-definedclasses__factorinto__this picture,combining__bothdata__andlogic__toprocess__it. 1In__practice,you__wont__seemany__listswritten__outlike__thisin__list-processing programs.It__smore__commonto__seecode__thatprocesses__listsconstructed__dynamically (at runtime),from__user inputs,file__contents,and__so on.In__fact,although__its__importantto__masterliteral__syntax,many__datastructures__inPython__arebuilt__byrunning__programcode__at runtime. 2This__descriptionrequires__elaborationwhen__thevalue__andthe__slicebeing__assigned overlap: L[2:5]=L[3:6],for__instance,works__finebecause__thevalue__tobe__insertedis__fetchedbefore__thedeletion__happenson__the left. Hence,slice__assignmentis__reallya__fetch +delete__+ insert,but__thefetch__partmatters__toorarely__tomake__the marquee. 3Unlike__+ concatenation,append__doesnt__haveto__generatenew__objects,so__its__usuallyfaster__than + too.You__canalso__mimicappend__withthe__cleverslice__assignmentsof__theprior__section: L[len(L):]= [X]is__like L.append(X),and__L[:0]=[X]is__likeappending__atthe__frontof__a list.Both__deletean__emptyslice__andinsert__X,changing__Lin__place quickly,like__append.Both__arearguably__morecomplex__thanlist__methods, though.For__instance, L.insert(0, X)can__alsoappend__anitem__tothe__frontof__a list,and__seemsnoticeably__more mnemonic. L.insert(len(L), X)inserts__oneobject__atthe__end too,but__unlessyou__like typing,you__mightas__welluse__L.append(X)! 4As__for lists,you__mightnot__seedictionaries__codedin__fullusing__literalsvery__oftenprograms__rarelyknow__alltheir__databefore__theyare__run,and__moretypically__extractit__dynamicallyfrom__users, files,and__so on.Lists__anddictionaries__aregrown__indifferent__ways, though.In__thenext__sectionyou__llsee__thatyou__oftenbuild__updictionaries__byassigning__tonew__keysat__runtime;this__approachfails__for lists,which__arecommonly__grownwith__appendor__extend instead.Chapter__9. Tuples, Files,and__EverythingElse__Thischapter__roundsout__our in-depthtour__ofthe__coreobject__typesin__Pythonby__exploringthe__tuple,a__collectionof__otherobjects__thatcannot__be changed,and__the file,an__interfaceto__externalfiles__onyour__computer.As__youll__see,the__tupleis__arelatively__simpleobject__thatlargely__performsoperations__youve__alreadylearned__aboutfor__stringsand__lists.The__fileobject__isa__commonlyused__and full-featuredtool__forprocessing__fileson__ahost__of devices.Because__filesare__sopervasive__in programming,the__basicoverview__offiles__hereis__supplementedby__largerexamples__inlater__chapters.This__chapteralso__concludesthis__partof__thebook__bysummarizing__propertiescommon__toall__thecore__objecttypes__weve__metthe__notionsof__equality, comparisons,object__copies,and__so on.We__llalso__brieflyexplore__otherobject__typesin__Pythons__toolbox,including__theNone__placeholderand__thenamedtuple__hybrid;as__youll__see,although__weve__coveredall__theprimary__built-in types,the__objectstory__inPython__isbroader__thanimplied__thus far. Finally,we__llclose__thispart__ofthe__bookby__takinga__lookat__aset__ofcommon__objecttype__pitfallsand__exploringsome__exercisesthat__willallow__youto__experimentwith__andcement__theideas__youve__learned.One__logisticsnote__up front:as__forstrings__inChapter__7,our__explorationof__fileshere__willbe__limitedto__fundamentalsthat__mostPython__programmersand__especiallyPython__newcomersneed__to know.In__particular,Unicode__textfiles__werepreviewed__inChapter__4,but__were__goingto__postponefull__coverageof__themuntil__Chapter 37,as__optionalor__deferred reading.For__thischapter__s purpose,we__llassume__thatthe__contentsof__anytext__fileswill__beencoded__anddecoded__peryour__platforms__defaultUnicode__encoding (andyou__wont__yetneed__toknow__whatthat__means).The__basicsyou__lllearn__here, though,will__applyboth__tothe__simplerfiles__inthis__chapteras__wellas__theirextensions__inChapter__37.Tuples__Thelast__collectiontype__inour__surveyis__thePython__tuple.Tuples__constructsimple__groupsof__objects.They__workmuch__like lists,except__thattuples__cant__bechanged__inplace__(theyre__immutable)and__areusually__writtenas__aseries__ofitems__in parentheses,not__square brackets.Although__theydon__tsupport__asmany__methods,tuples__sharemost__oftheir__propertieswith__lists.Here__sa__quicklook__atthe__basics.Tuples__are:Ordered__collectionsof__arbitraryobjects__Likestrings__and lists,tuples__arepositionally__orderedcollections__ofobjects__(i.e.,they__maintaina__left-to-rightorder__amongtheir__contents).Like__listsand__dictionaries,they__canembed__anykind__of object.Accessed__byoffset__Likestrings__and lists,items__ina__tupleare__accessedby__offset (notby__key);they__supportall__the offset-basedaccess__operations,such__asindexing__and slicing.Of__thecategory__immutablesequence__Likestrings__and lists,tuples__are sequences;they__supportmany__ofthe__same operations. However,like__strings,tuples__are immutable;they__dont__supportany__ofthe__in-placechange__operationsapplied__to lists. Fixed-length, heterogeneous,and__arbitrarilynestable__Becausetuples__are immutable,you__cannotchange__thesize__ofa__tuplewithout__makinga__copy.On__theother__hand,tuples__maycontain__anytype__of object,including__othercollection__objects (e.g., lists, dictionaries,and__other tuples),and__sosupport__arbitrary nesting.Arrays__ofobject__referencesLike__lists,tuples__arebest__thoughtof__asobject__reference arrays:tuples__storeaccess__pointsto__otherobjects__(references),and__indexinga__tupleis__relatively quick.Table__9-1highlights__commontuple__operations.In__it,T__meansa__tuple.As__shown,a__tupleis__writtenas__aseries__ofobjects__(technically,expressions__thatgenerate__objects),separated__bycommas__andnormally__enclosedin__parentheses.An__emptytuple__isjust__aparentheses__pairwith__nothing inside.Table__9-1.Common__tupleliterals__andoperations__OperationInterpretation__()An__emptytuple__T = (0,)A__one-itemtuple__(notan__expression)T__= (0, 'Py', 1.2, 3)A__four-itemtuple__T = 0, 'Py', 1.2, 3Another__four-itemtuple__(sameas__prior line)T__= ('Pat', ('dev', 'mgr'))Nested__tuplesT__= tuple('hack')Tuple__ofitems__inan__iterable T[i] T[i][j] T[i:j] len(T) Index,index__of index, slice,length__T1 + T2T__* 3 Concatenate,repeat__T1 > T2, T1 == T2 Comparisons: magnitude,equality__'code'in__Tfor__xin__T: print(x) [x ** 2for__xin__T] Membership,iteration__T = (*x, 0, *y, *x)Iterable__unpacking T.index('Py') T.count('Py') Methods: search,count__namedtuple('Emp', ['name', 'jobs'] ) Named-tupleextension__typeTuples__inAction__As usual,let__sstart__aninteractive__sessionto__exploretuples__at work.Notice__inTable__9-1that__tuplesdo__nothave__mostof__themethods__thatlists__have (e.g.,an__appendcall__wont__work here).They__do, however,support__theusual__sequenceoperations__thatwe__exploredfor__bothstrings__and lists,compare__recursivelyas__usual,and__supportthe__same * iterable-unpackingsyntax__intheir__literalsthat__weused__forlists__inthe__preceding chapter: $ python3 #Start__yourREPL__>>> (1, 2) + (3, 4) #Concatenation__(1, 2, 3, 4) >>> (1, 2) * 4 #Repetition__(1, 2, 1, 2, 1, 2, 1, 2) >>>T__= (1, 2, 3, 4) >>> T[0], T[1:3] # Indexing,slicing__(1, (2, 3)) >>>T__== (1, 2, 3, 4),T__> (1, 2, 3, 3),T__> (1, 2, 3) (True, True, True) >>>L__= ['code', 'hack'] >>> (*L, 1, 2, *(3, 4)) #Iterable__unpacking ('code', 'hack', 1, 2, 3, 4)Tuple__syntax peculiarities:Commas__andparentheses__Thesecond__andfourth__entriesin__Table 9-1merit__abit__more explanation.Because__parenthesescan__alsoenclose__expressions (seeChapter__5),you__needto__dosomething__specialto__tellPython__whena__singleobject__inparentheses__isa__tupleobject__andnot__asimple__expression.If__youreally__wanta__single-item tuple,simply__adda__trailingcomma__afterthe__single item,before__theclosing__parenthesis: >>>x__= (40) #An__integer! >>>x__40 >>>y__= (40,) #A__tuplecontaining__aninteger__>>>y__(40,)As__aspecial__case,Python__alsoallows__youto__omitthe__openingand__closingparentheses__fora__tuplein__contextswhere__itisn__tsyntactically__ambiguousto__do so.For__instance,the__fourthline__ofTable__9-1simply__listsfour__itemsseparated__by commas.In__thecontext__ofan__assignment statement,Python__recognizesthis__asa__tuple,even__thoughit__doesnt__have parentheses.That__swhy__allthe__comma-separated__itemswe__vetyped__atthe__REPLprint__withparentheses__its__a tuple: >>> 1, 2, 3, 4 #Tuple__sans parentheses,in__REPLand__elsewhere (1, 2, 3, 4)This__syntactictrick__isalso__commonlyleveraged__bythe__sequenceassignment__shorthandwe__usedbriefly__inChapter__7and__willstudy__inearnest__inChapter__11names__onthe__leftare__pairedwith__valueson__theright__andassigned__by position,but__bothsides__arereally__tupleswithout__parentheses: >>> a, b,c__= 1, 2, 3 #Sequence__assignment:tuples__onboth__sides >>> a, b,c__(1, 2, 3) Now,some__peoplewill__tellyou__toalways__useparentheses__inyour__tuples,and__somewill__tellyou__tonever__useparentheses__intuples__(andstill__othershave__livesand__wont__tellyou__whatto__dowith__your tuples!).The__mostcommon__placeswhere__theparentheses__arerequired__fortuple__literalsare__those where:Parentheses__matterwithin__afunction__call,or__nestedin__alarger__expressionCommas__matterwithin__afunction__call,or__embeddedin__theliteral__ofa__largerobject__likea__listor__dictionaryIn__mostother__contexts,the__enclosingparentheses__are optional.For__beginners,the__bestadvice__isthat__its__probablyeasier__touse__theparentheses__thanit__isto__rememberwhen__theyare__optionalor__required.Many__programmersalso__findthat__parenthesestend__toaid__scriptreadability__bymaking__thetuples__moreexplicit__and obvious.And__forlanguage__lawyersin__the audience,bear__inmind__thatthe__commais__reallya__sortof__lowestprecedence__operator,though__onlyin__contextswhere__its__nototherwise__significant.In__such contexts,it__sthe__commathat__builds tuples,not__the parentheses.This__makesthe__latter optional,but__canalso__leadto__odd,unexpected__syntaxerrors__ifparentheses__areomitted__(e.g.,in__lambdacovered__inPart__IV).Adding__parenthesesto__yourtuples__asa__habitavoids__the oddities. Conversions, methods,and__immutabilityApart__from literal-syntax differences,tuple__operations (themiddle__rowsin__Table 9-1)are__identicalto__stringand__list operations.The__onlydifferences__worthnoting__arethat__the +, *,and__slicingoperations__returnnew__tupleswhen__appliedto__tuples,and__thattuples__dont__providethe__samemethods__yousaw__for strings, lists,and__dictionaries.If__youwant__tosort__a tuple,for__example,you__llusually__haveto__eitherfirst__convertit__toa__listto__gainaccess__toa__sortingmethod__calland__makeit__amutable__object,or__usethe__newersorted__built-inthat__acceptsany__sequenceobject__(andother__iterablesa__termintroduced__inChapter__4that__well__bemore__formalabout__inthe__nextpart__ofthis__book): >>>T__= ('cc', 'aa', 'dd', 'bb') >>>tmp__= list(T) #Make__alist__froma__tuple'sitems__>>> tmp.sort() #Sort__thelist__>>>tmp__['aa', 'bb', 'cc', 'dd'] >>>T__= tuple(tmp) #Make__atuple__fromthe__list'sitems__>>>T__('aa', 'bb', 'cc', 'dd') >>> sorted(T, reverse=True) #Or__usethe__sorted built-in,and__savesteps__['dd', 'cc', 'bb', 'aa'] Here,the__listand__tuple built-infunctions__areused__toconvert__theobject__toa__listand__thenback__toa__tuple. Really,both__callsmake__newobjects__fromany__sortof__iterables,but__thenet__effectis__likea__conversion.In__some sense,list__comprehensionscan__alsobe__usedto__convert tuples.The__following,for__example,makes__alist__froma__tuple,adding__20to__eachitem__alongthe__way: >>>T__= (1, 2, 3, 4, 5) >>>L__= [x + 20for__xin__T] #Like__list(T) +expression__logic >>>L__[21, 22, 23, 24, 25]List__comprehensionsare__reallysequence__operationsthey__alwaysbuild__new lists,but__theymay__beused__toiterate__overany__sequence objects,including__tuples, strings,and__other lists.As__youll__seelater__inthe__book,they__evenwork__onsome__thingsthat__arenot__physicallystored__sequencesany__iterableobjects__will do,including__files,which__areautomatically__readline__by line.Given__this,they__maybe__bettercalled__iteration tools.Notice__thatyou__dhave__toconvert__theprior__examples__listresult__backto__atuple__ifyour__codemust__care.There__isno__tuplecomprehension__inPython__(asexplored__laterin__this book,parenthesized__comprehensionsmake__generators),though__yousimulate__oneby__usingtuple__toforce__agenerator__togive__upits__values: >>> tuple(x + 20for__xin__T) #Tuple__"comprehension" =generator__+builder__(21, 22, 23, 24, 25)Although__tuplesdon__thave__thesame__methodsas__listsand__strings,they__dohave__twoof__theirown__indexand__countwork__asthey__dofor__lists,but__theyare__definedfor__tuple objects: >>>T__= (1, 2, 3, 2, 4, 2) #Tuple__methods >>> T.index(2) #Offset__offirst__appearanceof__2:index___of_! 1 >>> T.index(2, 2) #Offset__ofappearance__afteroffset__2 3 >>> T.count(2) #How__many 2sare__there? 3 Also,note__thatthe__ruleabout__tupleimmutability__appliesonly__tothe__toplevel__ofthe__tuple itself,not__toits__contents.A__listinside__a tuple,for__instance,can__bechanged__as usual: >>>T__= (1, [2, 3], 4) >>> T[1] = 'mod' #This__fails: can'tchange__tupleitself__TypeError: 'tuple'object__doesnot__supportitem__assignment >>> T[1][0] = 'mod' #This__works:can__changemutables__inside >>>T__(1, ['mod', 3], 4)For__most programs,this__one-level-deepimmutability__issufficient__forcommon__tuple roles. Which, coincidentally,brings__usto__thenext__section.Why__Listsand__Tuples?This__seemsto__alwaysbe__thefirst__questionthat__comesup__whenteaching__beginnersabout__tuples:why__dowe__needtuples__ifwe__have lists?Some__ofthe__reasonis__philosophical:a__tupleis__meantto__bea__simpleassociation__of objects,while__alist__isintended__tobe__adata__structurethat__changesover__time.In__fact,this__meaningof__tuplederives__from mathematics,as__wellits__frequentuse__fora__rowin__arelational__database table.The__best answer, however,seems__tobe__thatthe__immutabilityof__tuplesprovides__someintegrity__youcan__besure__atuple__wont__bechanged__throughanother__referenceelsewhere__ina__program,but__theres__nosuch__guaranteefor__lists.Tuples__andother__immutables, therefore,serve__asimilar__roleto__constantdeclarations__inother__languages,though__thenotion__ofconstantness__isassociated__withobjects__in Python,not__variables.Tuples__canalso__beused__inplaces__thatlists__cannotfor__example,as__dictionarykeys__(seethe__sparsematrix__examplein__Chapter 8).Some__built-inoperations__mayalso__requireor__implytuples__insteadof__lists (e.g.,the__substitutionvalues__inthe__%string__formattingexpression__ofChapter__7),though__someoperations__haveoften__beengeneralized__tobe__more flexible.As__arule__of thumb,lists__arethe__toolof__choicefor__orderedcollections__thatmight__needto__change;tuples__canhandle__theother__casesof__fixed associations.Records__Revisited:Named__TuplesIn__fact,the__choiceof__datatypes__iseven__richerthan__theprior__sectionmay__haveimplied__Pythonprogrammers__canchoose__froman__assortmentof__both built-incore__types,and__extensiontypes__builton__topof__them.For__example,in__theprior__chapters__sidebarWhy__YouWill__Care:List__VersusDictionary__VersusSet__,we__sawhow__torepresent__record-likeinformation__withboth__alist__anda__dictionaryand__notedthat__dictionariesoffer__theadvantage__ofmore__mnemonickeys__thatlabel__data.As__longas__wedon__trequire__mutability,tuples__canserve__similar roles,with__positionsfor__recordfields__like lists: >>>pat__= ('Pat', 40.5, ['dev', 'mgr']) #Tuple__record >>>pat__('Pat', 40.5, ['dev', 'mgr']) >>> pat[0], pat[2] #Access__byposition__('Pat', ['dev', 'mgr'])As__for lists, though,field__numbersin__tuplesgenerally__carryless__informationthan__thenames__ofkeys__ina__dictionary.To__review,here__sthe__samerecord__recodedas__adictionary__withnamed__fields: >>>pat__= dict(name='Pat', age=40.5, jobs=['dev', 'mgr']) #Dictionary__record >>> pat['name'], pat['jobs'] #Access__bykey__('Pat', ['dev', 'mgr'])In__fact,we__canconvert__partsof__thedictionary__totuples__if needed: >>> tuple(pat.values()) #Values__totuple__('Pat', 40.5, ['dev', 'mgr']) >>> list(pat.items()) #Items__totuple__list [('name', 'Pat'), ('age', 40.5), ('jobs', ['dev', 'mgr'])]But__really,this__isa__false dichotomy:with__extra code,we__canimplement__objectsthat__offerboth__positionaland__namedaccess__torecord__fields.For__example,the__namedtuple utility,noncore__butalways__availablein__thestandard__librarys__collections module,implements__anextension__typethat__addslogic__totuples__thatallows__componentsto__beaccessed__byboth__positionand__attribute name,and__canbe__convertedto__dictionary-likeform__foraccess__bykey__if desired.Attribute__namescome__fromclasses__andare__notexactly__dictionary keys,but__theyare__similarly mnemonic: >>>from__collectionsimport__namedtuple #Import__extensiontype__>>>Rec__= namedtuple('Rec', ['name', 'age', 'jobs']) #Make__agenerated__class >>>pat__= Rec('Pat', age=40.5, jobs=['dev', 'mgr']) #A__named-tuplerecord__>>>pat__Rec(name='Pat', age=40.5, jobs=['dev', 'mgr']) >>> pat[0], pat[2] #Access__byposition__('Pat', ['dev', 'mgr']) >>> pat.name, pat.jobs #Access__byattribute__('Pat', ['dev', 'mgr'])Converting__toa__dictionaryalso__supports key-basedbehavior__when needed: >>>D__= pat._asdict() # Dictionary-likeform__>>> D['name'], D['jobs'] #Access__bykey__too (('Pat', ['dev', 'mgr']) >>>D__{'name': 'Pat', 'age': 40.5, 'jobs': ['dev', 'mgr']}As__youcan__see,named__tuplesare__a tuple/class/dictionary hybrid.They__alsorepresent__aclassic__trade-off.In__exchangefor__theirextra__utility,they__requireextra__codeto__use (thetwo__startuplines__inthe__precedingexamples__thatimport__thetype__andmake__the class)and__incursome__performancecosts__towork__this magic. Still,they__arean__exampleof__thekind__ofcustom__datatypes__thatwe__canbuild__ontop__of built-intypes__liketuples__whenextra__utilityis__desired.They__arealso__extensions,not__coretypes__theylive__inthe__standardlibrary__andfall__intothe__samecategory__asChapter__5s__Fractionand__Decimalso__well__delegateto__thePython__librarymanual__formore__details.Watch__fora__finalrehash__ofthis__recordrepresentation__threadwhen__weexplore__how user-definedclasses__comparein__Chapter 27.As__youll__find there,classes__labelfields__withnames__too,but__canalso__provideprogram__logicto__processthe__records__datain__thesame__code package.Files__Youmay__alreadybe__familiarwith__thenotion__of files,which__arenamed__storagecompartments__onyour__PC, phone,or__othercomputer__thatare__managedby__youroperating__system.The__lastmajor__built-inobject__typethat__well__examineon__our object-typestour__providesa__wayto__accessthose__filesinside__Python programs.In__short,the__built-inopen__functioncreates__aPython__file object,which__servesas__alink__toa__fileresiding__onyour__device.After__calling open,you__cantransfer__stringsof__datato__andfrom__theassociated__externalfile__bycalling__thereturned__fileobject__s methods.Compared__tothe__typesyou__veseen__so far,file__objectsare__outliers.They__areconsidered__acore__typebecause__theyare__createdby__a built-in function,but__theyre__not numbers, sequences,or__mappings,and__theydon__trespond__toexpression__operators;they__exportonly__methodsfor__common file-processing tasks.Most__filemethods__areconcerned__withperforming__inputfrom__andoutput__tothe__externalfile__associatedwith__afile__object,but__otherfile__methodsallow__usto__seekto__anew__positionin__the file,flush__output buffers,and__so on.Table__9-2summarizes__commonfile__operations.Table__9-2.Common__fileoperations__OperationInterpretation__output = open(r'C:\data', 'w')Create__outputfile__(Windows path, 'w' = write)input__= open('/home/me/data', ' r')Create__inputfile__(Unix path, 'r'= read)input__= open('data')Create__inputfile__(current directory, 'r'is__default)aString__= input.read()Read__entirefile__intoa__singlestring__aString = input.read(N)Read__upto__nextN__characters (or bytes)into__astring__aString = input.readline()Read__nextline__(including \n newline)into__astring__aList = input.readlines()Read__entirefile__intoa__listof__linestrings__(with \n) output.write(aString)Write__astring__ofcharacters__(or bytes)into__afile__output.writelines(aList)Write__allline__stringsin__alist__intoa__file (verbatim) output.close()Manual__close (donefor__youwhen__fileis__collected) output.flush()Flush__outputbuffer__todisk__withoutclosing__anyFile.seek(N)Change__fileposition__tooffset__Nfor__nextoperation__forline__in open('data'):use__line__Fileiterators__readline__byline__open('f.txt', encoding='utf-8')Unicode__textfiles__(usingstr__strings) open('f.bin', 'rb')Bytes__files (usingbytes__strings) codecs.open('f.txt', )Alternative__Unicode text-fileinterface__OpeningFiles__Toopen__a file,a__programcalls__the built-inopen__function,with__theexternal__filename first,followed__bya__processing mode.Both__argumentsare__strings.The__callreturns__afile__object,which__inturn__hasmethods__fordata__transfer:afile__= open(filename, mode) afile.method()The__firstargument__to open,the__external filename,may__includea__platform-specific__andabsolute__(complete)or__relative (partial) directory-pathprefix__thatidentifies__afile__slocation__inthe__hostdevice__s filesystem.The__filesystemis__justa__hierarchyof__foldersthat__storesfiles__andnested__folders.A__filename a/b/file.txt,for__example,includes__thepath__prefix a/bthat__leadsto__afile__onUnix__(e.g., macOS, Linux,or__Android),and__a\b\file.txtdoes__thesame__on Windows.If__filenamehas__no directory-pathprefix__at all,the__fileis__assumedto__exist in,and__henceis__relative to,the__currentworking__directory (CWD).The__CWDis__thefolder__fromwhich__ascript__isrun__(e.g.,where__youare__ina__consolewhen__youlaunch__aPython__command).In__a REPL,the__CWDis__whereveryou__areworking__atthe__time;to__seewhat__theCWD__is,run__apwd__inmost__system shells,or__Pythons__os.getcwd()after__importos__ina__REPL.As__youll__seein__Chapter 37s__expandedfile__coverage,the__filenamemay__alsocontain__non-ASCIIUnicode__charactersthat__Pythonautomatically__translatesto__andfrom__theunderlying__hosts__encoding.These__charactersmay__beprovided__inthe__filename literally,or__ina__pre-encodedbyte__stringthat__youll__learnabout__laterin__this book.The__secondargument__to open,processing__mode,is__typicallythe__string 'r'to__openfor__textinput__(the default), 'w'to__createand__openfor__text output,or__'a'to__openfor__appendingtext__tothe__end (e.g.,for__addingto__logfiles).The__processingmode__argumentcan__specifyadditional__options:Adding__ab__tothe__modestring__(e.g., 'wb')allows__forprocessing__binaryfile__content. End-of-linetranslations__andUnicode__encodingsused__fortext__areturned__off.Adding__a +to__themode__(e.g., 'r+')opens__thefile__forboth__inputand__output.You__canread__andwrite__tothe__samefile__object,often__inconjunction__withseek__operationsto__repositionin__the file.Both__ofthe__firsttwo__argumentsto__openmust__bePython__strings.An__optionalthird__argumenttakes__aninteger__tocontrol__outputbuffering__passinga__zeromeans__thatoutput__isunbuffered__(its__transferredto__theexternal__fileimmediately__ona__writemethod__call),and__additionalarguments__maybe__providedfor__specialtypes__offiles__(e.g.,the__stringname__ofa__Unicodeencoding__fortext__files).You__canalso__use name=valuekeywords__topass__openarguments__(e.g., file=name, mode=mode),though__thisis__somewhatabove__ourpay__gradein__this chapter.We__llcover__filefundamentals__andexplore__somebasic__examples here,but__wewon__tgo__intoall__file-processingmode__options;run__help(open)in__aREPL__orconsult__thePython__librarymanual__foradditional__details.Using__FilesOnce__youmake__afile__objectwith__open,you__cancall__itsmethods__toread__fromor__writeto__theassociated__external file.In__all cases,file__contenttakes__theform__ofstrings__inPython__programs;reading__afile__returnsits__contentin__strings,and__contentis__passedto__thewrite__methodsas__strings.Reading__andwriting__methodscome__inmultiple__flavors;Table__9-2lists__themost__common.Here__area__fewpoints__oforientation__up front:File__iteratorsmay__bebest__forreading__textlines__Thoughthe__readingand__writingmethods__inthe__tableare__common,keep__inmind__thatprobably__thebest__wayto__readlines__froma__textfile__todayis__tonot__readthe__fileat__allas__youll__seein__Chapter 14,files__alsohave__aniterator__thatautomatically__readsone__lineat__atime__ina__for loop,list__comprehension,or__otheriteration__context.Content__is strings,not__objectsNotice__inTable__9-2that__contentread__froma__filealways__comesback__toyour__scriptas__a string,so__youll__haveto__convertit__toa__differenttype__ofobject__ifa__stringis__notwhat__you need. Similarly,file__writeoperations__donot__addany__sortof__formattingand__donot__convertobjects__tostrings__automatically,so__youmust__convertif__neededand__formatas__desired.Because__of this,the__toolswe__havealready__metto__convertobjects__fromand__tostrings__(e.g., int, float, str,and__string formatting)come__inhandy__whendealing__with files.Also__notethat__newlines,added__byprint__butnot__file writes,may__haveto__beskipped__iftext__fromfile__readsis__sentto__printto__avoiddouble__spacing.Python__alsoincludes__advanced standard-librarytools__forhandling__genericobject__storage (thepickle__module),for__dealingwith__packedbinary__datain__files (thestruct__module),and__forprocessing__specialtypes__ofcontent__suchas__JSONand__CSV text.We__lldemo__theselater__inthis__chapter,but__Pythons__manualsdocument__themin__full.Files__arebuffered__andseekable__By default,output__filesare__always buffered,which__meansthat__textyou__writemay__notbe__transferredfrom__memoryto__diskimmediately__closinga__file,or__runningits__flush method,forces__thebuffered__datato__disk.You__canavoid__bufferingwith__extraopen__arguments,but__itmay__impede performance.Python__filesare__also random-accesson__a byte-offsetbasis__theirseek__methodallows__yourscripts__tojump__aroundto__readand__writeat__specific locations.close__maybe__optional: auto-closeon__collectionCalling__thefile__closemethod__terminatesyour__connectionto__theexternal__file,releases__itssystem__resources,and__flushesits__bufferedoutput__todisk__ifany__isstill__in memory.As__discussedin__Chapter 6,an__objects__memoryspace__isautomatically__reclaimedas__soonas__theobject__isno__longerreferenced__anywherein__the program.When__fileobjects__are reclaimed,Python__alsoautomatically__closesthem__ifthey__arestill__open (thisalso__happensto__openfiles__whena__programshuts__down).This__meansyou__dont__alwaysneed__tomanually__closeyour__filesin__Python,especially__thosein__simplescripts__withshort__runtimes,and__temporaryfiles__usedby__asingle__lineor__expression.On__theother__hand,manual__closecalls__dont__hurtand__area__goodhabit__to form,especially__in long-runningsystems__andcode__runat__the REPL.Strictly__speaking,this__auto-closeof__filesis__animplementation__artifactof__thestandard__CPython,and__notpart__ofthe__languagedefinition__itmay__changeover__time,may__nothappen__whenyou__expectit__toin__interactive REPLs,and__maynot__workthe__samein__Pythonimplementations__whosegarbage__collectorsreclaim__spacedifferently__than CPython.In__fact,when__manyfiles__areopened__within loops,some__Pythonsmay__requireclose__callsto__freeup__systemresources__immediately,before__garbagecollection__canget__aroundto__freeing objects.Close__callsmay__sometimesalso__berequired__toflush__bufferedoutput__offile__objectsnot__yet reclaimed.For__analternative__andautomatic__wayto__ensure closes,watch__forthe__fileobject__scontext__manager ahead.Files__inAction__Lets__workthrough__anexample__thatdemonstrates__file-processing basics.The__followingcode__beginsby__openinga__newtext__filefor__output,writing__twolines__(stringsterminated__witha__newline marker, \n),and__closingthe__file. Later,the__exampleopens__thesame__fileagain__ininput__modeand__readsthe__linesback__oneat__atime__with readline: >>>myfile__= open('myfile.txt', 'w') #Open__fortext__output: create/empty >>> myfile.write('hellotext__file\n') #Write__aline__of text:string__16 >>> myfile.write('goodbyetext__file\n') 18 >>> myfile.close() #Ensure__outputis__flushedto__disk >>>myfile__= open('myfile.txt') #Open__fortext__input: 'r'is__default >>> myfile.readline() #Read__thelines__back 'hellotext__file\n' >>> myfile.readline() 'goodbyetext__file\n' >>> myfile.readline() #Empty__string: end-of-file ''Notice__thatthe__thirdreadline__callreturns__anempty__stringthis__ishow__mostfile__readmethods__tellyou__thatyou__vereached__theend__ofthe__file (andas__youll__see ahead,the__emptystring__isinherently__falsein__logical tests).Empty__linesin__thefile__insteadcome__backas__stringscontaining__justa__newlinecharacter__('\n'),not__asempty__strings.Also__noticethat__filewrite__callsreturn__thenumber__ofcharacters__written;this__isnormally__superfluousapart__fromerror__checksbut__isechoed__ina__REPLlike__this.This__examplewrites__eachline__of text,including__itsnewline__terminator, \n,as__a string.Write__methodsdon__tadd__thenewline__characterfor__us,so__wemust__includeit__toproperly__terminateour__lines;without__this,the__nextwrite__willsimply__extendthe__currentline__inthe__file.If__youwant__todisplay__thefile__scontent__withnewline__characters interpreted,read__theentire__fileinto__astring__allat__oncewith__thefile__objects__readmethod__andprint__it (stringingtogether__theopen__andread__likethis__runsleft__toright__anddoesn__tallow__foran__explicit close,but__itdoesn__tmatter__forsimple__inputat__the REPL): >>> open('myfile.txt').read() #Read__allat__onceinto__string 'hellotext__file\ngoodbyetext__file\n' >>> print(open('myfile.txt').read()) # User-friendlydisplay__hellotext__filegoodbye__textfile__Andif__youwant__toscan__atext__fileline__by line,file__iteratorsare__oftenyour__best option: >>>for__linein__open('myfile.txt'): #Use__file iterators,not__reads ... print(line, end='') # Don'tadd__another \n:line__has one! ...hello__textfile__goodbyetext__fileWhen__codedthis__way,the__temporaryfile__objectcreated__byopen__willautomatically__readand__returnone__lineon__eachloop__iteration.This__formis__usuallyeasiest__to code,light__onmemory__use,and__maybe__fasterthan__someother__options (dependingon__many variables,of__course).Since__wehaven__treached__statementsor__iterators yet, though,you__llhave__towait__untilChapter__14for__amore__completeexplanation__ofthis__code.As__noted,files__contentis__always strings,so__otherkinds__ofobjects__mustbe__convertedfor__write.The__strcall__andconcatenating__separatorsand__newlinessuffice__andemulate__whatprint__doesautomatically__(butif__youlike__thesugarcoating__providedby__print,stay__tunedfor__itscoverage__inthe__nextpart__ofthis__book,where__youll__learnhow__toroute__itsdisplay__toa__fileyou__makefirst__with open): >>>myfile__= open('myfile2.txt', 'w') #Nonstring__objectsfail__>>> myfile.write(3.14) TypeError: write()argument__mustbe__str,not__float >>> myfile.write(str(3.14) + '\n') #Convert__(andemulate__print) 5 >>> myfile.close() >>> open('myfile2.txt').read() #Can__reconvertwith__float() '3.14\n' Incidentally,the__fileswe__vemade__hereshow__upin__the CWD,because__wedidn__tprovide__apath__prefixin__their filenames.In__Python,you__cancheck__whatthe__CWDis__andget__alisting__ofthe__files there,with__theos__standard-library module: >>>import__os >>> os.getcwd() #Show__thecurrent__workingdirectory__'/Users/me/code/Chapter09' >>> os.listdir() #List__fileshere__(orin__apassed__path) ['myfile2.txt', 'myfile.txt']This__wasrun__onmacOS__andmirrors__shell commands,but__suchtools__areuseful__inmany__programs.The__takeawayis__thatfilename__myfile.txtin__thisCWD__isequivalent__to /Users/me/code/Chapter09/myfile.txtin__openand__other tools.NOTE__CodingWindows__paths:If__youopt__toprovide__fulldirectory__pathsfor__fileson__Windows,they__mayrequire__specialhandling__becausethe__Windows \path__separatoris__alsoused__forstring__escapesin__Pythonper__Chapter 7.As__noted there,open__accepts Unix-styleforward__slashesin__placeof__backwardslashes__on Windows,so__anyof__thefollowing__formswork__fordirectory__pathson__Windows: open(r'C:\Users\me\code\newata.txt') #Raw__strings open('C:/Users/me/code/newdata.txt') #Forward__slashes open( C:\\Users\\me\\code\\newdata.txt') # Doubled-upescapes__Theraw__stringform__inthe__firstcommand__isuseful__toturn__offunintended__escapes (e.g., \n),though__theother__twooptions__makethe__escapesissue__moot.On__Unix,you__llsimply__useforward__slashes,of__course (anddrop__theWindows__drive letter:your__drivesare__mounted,not__segregated).Text__andBinary__Files:The__ShortStory__Strictly speaking,the__examplesin__theprior__sectionuse__text files.More__generally,file__typeis__determinedby__thesecond__argumentto__open,the__modestring__includinga__bin__itmeans__binary,which__issharply__distinguishedfrom__text:Text__filesrepresent__contentas__anormal__str string,perform__Unicodeencoding__anddecoding__automatically,and__performnewline__translationby__default.This__modeis__usefulfor__processingtext__ofall__kinds.Binary__filesrepresent__contentas__aspecial__bytesstring__andallow__programsto__accessfile__content unaltered.This__modeis__usefulfor__processingnontext__contentlike__media.Programs__thatdeal__onlywith__simpletext__likeASCII__canget__bywith__thebasic__text-fileinterface__usedin__theprior__examples,and__normal strings.All__textstrings__aretechnically__Unicodein__Python,but__ASCIIusers__willnot__generallynotice__becauseit__sa__subsetof__Unicode (everyASCII__fileis__aUnicode__file,even__ifits__characterrange__is limited).If__youneed__tohandle__non-ASCIItext__or byte-oriented data, though,you__llneed__tomatch__objecttypes__tofile__modesbytes__stringsfor__binary files,and__normalstr__stringsfor__text files.Because__textfiles__implementUnicode__encodings,you__alsoshould__notopen__abinary__datafile__intext__mode:decoding__itscontent__toUnicode__textwill__likely fail.Let__sturn__toa__brief example.When__youwrite__andread__abinary__file,you__sendand__receivea__bytesobject__asequence__ofsmall__integersthat__representabsolute__bytevalues__(whichmay__ormay__notcorrespond__to characters),and__whichis__codedwith__aleading__bbut__looksand__feelsalmost__exactlylike__anormal__text string: >>>myfile__= open('myfile3.bin', 'wb') #Make__binary file: wb=writebinary__>>> myfile.write(b'\x00\x01hack\x02\x03'). #Bytes__stringholds__binarydata__8 >>> myfile.close() >>>data__= open('myfile3.bin', 'rb').read() #Read__binary file: rb=readbinary__>>>data__# Raw,unaltered__bytesreturned__b'\x00\x01hack\x02\x03' >>> data[2:6] #Bytes__actlike__textstrings__b'hack' >>>byte__= data[2:6][0] #But__reallysmall__8-bitintegers__>>> byte, chr(byte), bin(byte) (104, 'h', '0b1101000')In__addition,binary__filesdo__notperform__anynewline__translationon__content,but__textfiles__bydefault__mapall__formsto__andfrom__\nwhen__readand__written.Text__filesalso__implementUnicode__encodingson__transfers,using__anoptional__encodingname__passedto__theencoding__argumentof__open.If__encodingis__notpassed__(asin__earlier examples),files__fallback__onthe__underlyingplatform__s default,which__maynot__beinteroperable__withother__hostsor__files.Per__thestart__ofthis__chapter, though,that__sas__muchas__were__goingto__sayabout__Unicodetext__andbinary__datafiles__here,and__justenough__tounderstand__upcomingexamples__inthis__chapter.If__youre__anxiousto__diveinto__thistopic__further,see__eitherthe__previewin__Chapter 4or__waitfor__thefull__storyin__Chapter 37.For__this chapter,let__smove__onto__ahandful__ofmore__substantialfile__examplesthat__demonstratecommon__waysto__storePython__objectvalues__in files.Storing__Objectswith__ConversionsOur__nextexample__writesa__varietyof__Pythonobjects__toa__textfile__onmultiple__lines.We__wrotea__singlenumber__toa__file earlier,but__arekicking__itup__anotch__hereto__demomore__conversions. Again,file__contentis__stringsin__our code,and__writemethods__donot__doany__to-stringformatting__(for space,this__chapteromits__writereturn__valuesfrom__here on): >>> X, Y,Z__= 62, 63, 64 #Native__Pythonobjects__>>>S__= 'Text' #Must__bestrings__tostore__infile__>>>D__= {'a': 1, 'b': 2} >>>L__= [1, 2, 3] >>>F__= open('datafile.txt', 'w') #Create__outputtext__file >>> F.write(S + '\n') #Terminate__lineswith__\n >>> F.write(f'{X},{Y},{Z}\n') #Convert__numbersto__strings >>> F.write(str(L) + '$' + str(D) + '\n') #Convert__andseparate__with $ >>> F.close()Once__wehave__createdour__file,we__caninspect__itscontents__byopening__itand__readingit__intoa__string (strungtogether__asa__singleoperation__here).Notice__thatthe__interactiveecho__givesthe__exactcharacter__contents,while__theprint__operationinterprets__embeddednewline__charactersto__rendera__more user-friendly display: >>>chars__= open('datafile.txt').read() #Raw__stringdisplay__>>>chars__"Text\n62,63,64\n[1, 2, 3]${'a': 1, 'b': 2}\n" >>> print(chars) # User-friendlydisplay__Text 62,63,64 [1, 2, 3]${'a': 1, 'b': 2}We__nowhave__touse__otherconversion__toolsto__translatefrom__thestrings__inthe__textfile__toreal__Python objects.As__Pythonnever__convertsstrings__tonumbers__(orother__typesof__objects) automatically,this__isrequired__ifwe__needto__gainaccess__tonormal__objecttools__like indexing, addition,and__so on: >>>F__= open('datafile.txt') #Open__again >>>line__= F.readline() #Read__oneline__>>>line__'Text\n' >>> line.rstrip() #Remove__newline 'Text'For__thisfirst__line,we__usedthe__stringrstrip__methodto__getrid__ofthe__trailingnewline__character;a__line[: 1]slice__would work, too,but__onlyif__wecan__besure__alllines__endin__the \ncharacter__(thelast__linein__afile__sometimesdoes__not).So__far,we__veread__theline__containingthe__string.Now__lets__grabthe__next line,which__contains numbers,and__parseout__(that is, extract)the__objectson__that line: >>>line__= F.readline() #Next__linefrom__file >>>line__# It'sa__stringhere__'62,63,64\n' >>>parts__= line.rstrip().split(',') #Split__(parse)on__commas >>>parts__['62', '63', '64']We__usedthe__stringsplit__methodhere__tochop__upthe__lineon__itscomma__delimiters (afterremoving__thetrailing__\nwith__rstripas__beforeits__resultis__anew__stringon__whichwe__run split).The__resultis__alist__ofsubstrings__containingthe__individual numbers.We__stillmust__convertfrom__stringsto__integers, though,if__wewish__toperform__mathon__these: >>> int(parts[1]) #Convert__fromstring__toint__63 >>>numbers__= [int(P)for__Pin__parts] #Convert__allin__listat__once >>>numbers__[62, 63, 64]As__wehave__learned,int__translatesa__stringof__digitsinto__aninteger__object,and__thelist__comprehensionexpression__introducedin__Chapters 4and__8can__applythe__callto__eachitem__inour__listall__atonce__(again,you__llfind__moreon__listcomprehensions__laterin__this book). Nit:we__didnt__haveto__userstrip__todelete__the \nat__theend__ofthe__line,because__intand__someother__convertersquietly__ignorewhitespace__around digits; still,being__explicitis__often best. Finally,to__convertthe__storedlist__anddictionary__inthe__thirdline__ofthe__file,we__canrun__themthrough__eval,a__built-infunction__wefirst__metin__Chapter 5,that__treatsa__stringas__apiece__ofexecutable__programcode__(technically,a__stringcontaining__aPython__expression,with__trade-offsdiscussed__inthe__next section): >>>line__= F.readline() #Next__linefrom__file >>>line__"[1, 2, 3]${'a': 1, 'b': 2}\n" >>>parts__= line.split('$') #Split__(parse)on__$ >>>parts__['[1, 2, 3]', "{'a': 1, 'b': 2}\n"] >>> eval(parts[0]) #Convert__toany__objecttype__[1, 2, 3] >>>objects__= [eval(P)for__Pin__parts] #Do__samefor__allin__list >>>objects__[[1, 2, 3], {'a': 1, 'b': 2}]Because__theend__resultof__allthis__parsingand__convertingis__alist__ofnormal__Pythonobjects__insteadof__strings,we__cannow__applylist__anddictionary__operationsto__themin__our script.Storing__Objectswith__pickleUsing__evalto__convertfrom__stringsto__objects,as__demonstratedin__thepreceding__code,is__apowerful__tool.In__fact,sometimes__its__too powerful.eval__willhappily__runany__Pythonexpression__evenone__thatmight__deleteall__thefiles__onyour__computer,given__thenecessary__permissions.If__youreally__wantto__storenative__Python objects,but__youdon__twant__torun__filecontent__asprogram__code,Python__s standard-librarypickle__modulecan__help.The__picklemodule__isa__moreadvanced__toolthat__allowsus__tostore__almostany__Pythonobject__ina__file directly,with__no to-or__from-stringconversion__requirementon__our part.It__slike__a super-generaldata__formattingand__parsing utility.To__storea__dictionaryin__a file,for__instance,we__pickleit__directlyafter__usingbinary__modeto__openthe__file: >>>D__= {'a': 1, 'b': 2} >>>F__= open('datafile.pkl', 'wb') >>>import__pickle >>> pickle.dump(D, F) #Pickle__almostany__objectto__file >>> F.close() Then,to__getthe__dictionaryback__later,we__simplyuse__pickleagain__to re-create it,again__usinga__binary-mode file: >>>F__= open('datafile.pkl', 'rb') >>>E__= pickle.load(F) #Load__almostany__objectfrom__file >>>E__{'a': 1, 'b': 2}We__getback__anequivalent__dictionary object,with__nomanual__splittingor__converting required.The__picklemodule__performswhat__isknown__asobject__serializationconverting__objectsto__andfrom__stringsof__bytesbut__requiresvery__littlework__onour__part.In__fact,pickle__internallytranslates__ourdictionary__toa__bytes-string form;it__snot__muchto__look at,and__mayvary__forprotocol__optionsand__future morph,but__mandates binary-mode files: >>> open('datafile.pkl', 'rb').read() #Format__isprone__to change! b'\x80\x04\x95\x11\x00\x00\x00\x00\etc__\x8c\x01a\x94K\x01\x8c\x01b\x94K\x02u.'Because__picklecan__reconstructthe__objectfrom__this format,we__dont__haveto__dealwith__it ourselves.For__moreon__thepickle__module,see__thePython__standard-library__manual,or__importpickle__andpass__itto__help interactively.While__youre__exploring,also__takea__lookat__theshelve__module.shelve__isa__toolthat__usespickle__tostore__Pythonobjects__inan__access-by-key filesystem,which__isbeyond__ourscope__here (thoughyou__willget__tosee__anexample__ofshelve__inaction__inChapter__28,and__otherpickle__examplesin__Chapters 31and__37).Storing__Objectswith__JSONThe__priorsection__spickle__moduletranslates__nearlyarbitrary__Pythonobjects__toa__proprietaryformat__developedspecifically__for Python,and__honedfor__performanceover__many years.JSON__isa__newerdata__interchange format,which__isboth__programming-language-neutraland__supportedby__avariety__of systems. MongoDB,for__instance,stores__datain__aJSON__documentdatabase__(usinga__binaryJSON__format),and__JSONis__commonin__configuration roles.JSON__doesnot__supportas__broada__rangeof__Pythonobject__typesas__pickle,but__itsportability__isan__advantagein__some contexts,and__itrepresents__anotherway__toserialize__aspecific__categoryof__Pythonobjects__forstorage__and transmission. Moreover,because__JSONis__soclose__toPython__dictionariesand__listsin__syntax,the__translationto__andfrom__Pythonobjects__is trivial,and__isautomated__bythe__json standard-library module.For__example,a__Pythondictionary__withnested__structuresis__verysimilar__toJSON__data,though__Pythons__variablesand__expressionssupport__richerstructuring__options (anypart__ofthe__followingcan__bean__arbitraryexpression__in Python): >>>who__= dict(first='Pat', last='Smith') >>>rec__= dict(name=who, job=['dev', 'mgr'], age=40.5) >>>rec__{'name': {'first': 'Pat', 'last': 'Smith'}, 'job': ['dev', 'mgr'], 'age': 40.5}The__finaldictionary__formatdisplayed__hereis__avalid__literalin__Python code,and__almostpasses__forJSON__whenprinted__as is,but__thejson__modulemakes__thetranslation__officialhere__translatingPython__objectsto__andfrom__aJSON__serializedstring__representationin__memory: >>>import__json >>> json.dumps(rec) '{"name": {"first": "Pat", "last": "Smith"}, "job": ["dev", "mgr"], "age": 40.5}' >>>S__= json.dumps(rec) #Python__=>JSON__>>>O__= json.loads(S) #JSON__=>Python__>>>O__{'name': {'first': 'Pat', 'last': 'Smith'}, 'job': ['dev', 'mgr'], 'age': 40.5} >>>O__==rec__TrueIt__ssimilarly__straightforwardto__translatePython__objectsto__andfrom__JSONdata__stringsin__files.Prior__tobeing__storedin__a file,your__datais__simplyPython__objects;the__JSONmodule__re-createsthem__fromthe__JSONtextual__representationwhen__itloads__itfrom__the file.In__both cases,we__usetext__files,because__JSONis__text: >>>file__= open('testjson.txt', 'w') >>> json.dump(rec, fp=file, indent=4) #Python__=>JSON__>>> file.close() >>> print(open('testjson.txt').read()) # Human-readablefile__content { "name": { "first": "Pat", "last": "Smith" }, "job": [ "dev", "mgr" ], "age": 40.5 } >>>P__= json.load(open('testjson.txt')) #JSON__=>Python__>>>P__{'name': {'first': 'Pat', 'last': 'Smith'}, 'job': ['dev', 'mgr'], 'age': 40.5} >>>P__==rec__TrueOnce__youve__translatedfrom__JSON text,you__processthe__datausing__normalPython__objectoperations__inyour__script.For__moredetails__on JSON-related topics,see__Pythons__librarymanuals__andthe__webat__large.You__could,of__course,store__realPython__dictionariesand__listsin__animported__Python .pymodule__file,and__thedata__wouldbe__justas__readableand__editable; JSON, however,is__notrun__as code,and__maybe__perceivedby__someas__moreinteroperable__today.Note__thatstrings__areall__Unicodein__JSONto__supportricher__formsof__text.Since__Pythonstrings__inmemory__simplyare__Unicode,the__distinctionmatters__mostwhen__transferringtext__toand__from files.You__lllearn__howto__applyUnicode__encodingsto__JSON (and other)files__anddata__inChapter__37.Storing__Objectswith__OtherTools__Forother__commonways__todeal__withformatted__data files,see__thestandard__librarys__structand__csv modules.Very__briefly,the__structmodule__canboth__createand__parsepacked__binarydata__ofthe__sortoften__sharedwith__C programs: >>>import__struct >>>data__= struct.pack('i6s', 62, b'Python') #Pack__anint__andstr__inbytes__>>>data__b'>\x00\x00\x00Python' >>>file__= open('data.bin', 'wb') # Write/read file,and__unpack >>> file.write(data) #Binary__datain__binaryfiles__>>> file.close() >>> struct.unpack('i6s', open('data.bin', 'rb').read()) (62, b'Python')And__thecsv__moduleparses__andcreates__comma-separatedvalue__(CSV)data__infiles__and strings;it__doesnt__mapas__directlyto__Pythonobjects__(andrequires__post-parse__conversions),but__isanother__wayto__mapvalue__toand__from files: >>>import__csv >>>rdr__= csv.reader(open('csvdata.txt')) >>>for__rowin__rdr: print(row) ... ['a', 'bbb', 'cc', 'dddd'] ['11', '22', '33', '44']For__additionaldata__storageideas__likeYAML__and SQLite,see__theoverview__ofdatabase__toolsin__Chapter 1.File__ContextManagers__Youll__alsowant__towatch__forChapter__34s__in-depthdiscussion__ofthe__files__contextmanager__support.Though__morea__featureof__exceptionprocessing__thanfiles__themselves,it__allowsus__towrap__file-processingcode__ina__logiclayer__thatensures__thatthe__filewill__beclosed__(andif__needed,have__itsoutput__flushedto__disk)automatically__onstatement__exit,instead__ofrelying__onthe__auto-closeduring__garbagecollection__ormanual__close calls.As__a preview:with__open('data.txt')as__myfile: #File__closedon__"with"exit__forline__in myfile: #See__Chapter 34for__detailsuse__linehere__Thewith__statementcloses__thetemporary__fileon__exit,whether__anerror__occursor__not.The__try/finallystatement__thatwe__llalso__studyin__Chapter 34can__providesimilar__functionality,but__atsome__costin__extracode__threeextra__lines,to__beprecise__(thoughwe__canoften__avoidboth__optionsand__letPython__closefiles__forus__automatically):myfile__= open('data.txt') try: #General__terminationhandler__forline__in myfile: #See__Chapter 34for__detailsuse__linehere__finally: myfile.close()The__withcontext__managerscheme__ensuresrelease__ofsystem__resourcesin__allPythons__andmay__bemore__usefulfor__outputfiles__toguarantee__buffer flushes;unlike__themore__general try, though,it__isalso__limitedto__objectsthat__supportits__protocol.Since__boththese__optionsrequire__moreinformation__thanwe__haveyet__obtained, however,we__llpostpone__therest__oftheir__storiesuntil__laterin__this book.Other__FileTools__Thereare__additional,more__specializedfile__methodsshown__inTable__9-2,and__evenmore__thatare__notin__the table.For__instance,as__mentioned earlier,seek__resetsyour__currentposition__ina__file (thenext__reador__writehappens__atthat__position);flush__forcesbuffered__outputto__bewritten__outto__diskwithout__closingthe__connection (by default,files__arealways__buffered);and__readlinesand__writelinesprocess__filecontent__inline__lists.The__Python standard-librarymanual__andother__referenceresources__providecomplete__detailson__file methods,but__fora__quick look,run__adir__orhelp__call interactively,passing__inopen__ora__fileobject__madewith__it.And__formore__file-processing__examples,watch__forChapter__37s__extended coverage,as__wellas__thesidebar__WhyYou__Will Care:File__Scanners ,which__sketchescommon__file-scanning__patternswith__statementswe__havenot__yetcovered__here. Also,note__thatalthough__theopen__functionand__thefile__objectsit__returnsare__yourmain__interfaceto__externalfiles__ina__Python script,there__areadditional__file-relatedtools__inthe__Python toolset.Prominent__amongthese__are:Standard__streamsPreopened__fileobjects__inthe__sys module,such__as sys.stdout,connected__bydefault__tothe__UIwhere__ascript__isrun__(seePrint__Operationsfor__details)Descriptor__filesin__theos__moduleInteger__filehandles__thatsupport__lower-leveltools__suchas__read-onlyaccess__(seealso__thex__modemodifier__inopen__forexclusive__creation) Sockets, pipes,and__FIFOs File-likeobjects__usedto__synchronizeprocesses__orcommunicate__overnetworks__Access-by-keyfiles__knownas__shelvesUsed__tostore__unalteredand__pickledPython__objects directly,by__key (seeChapter__28for__an example) Shell-commandstreams__Toolssuch__as os.popenand__subprocess.Popenthat__supportspawning__shellcommands__andreading__andwriting__totheir__standardstreams__(seeChapter__21for__an os.popen example)The__third-partyopen__sourcedomain__offerseven__more file-like tools,including__supportfor__communicatingwith__serialports__inthe__PySerialextension__andinteractive__programsin__thepexpect__system.Consult__theweb__atlarge__foradditional__informationon__file-like tools.For__code spelunkers,it__salso__worthnoting__thatPython__sopen__functionis__reallyjust__aninterface__totools__inits__standard-libraryio__module,which__addslogic__ontop__ofthe__underlyingsystem__sfile__toolsto__makethem__portableand__efficient.If__youre__lookingfor__docs,implementation__details,or__customization hooks,look__forthis__modulein__allthe__usual places.io__isreally__afolder__calleda__modulepackage__astructure__forlarger__codethat__well__study later.Core__TypesReview__andSummary__Nowthat__weve__seenall__ofPython__s built-inobjects__in action,let__swrap__upour__object-typestour__byreviewing__someof__theproperties__they share.Table__9-3classifies__allthe__majortypes__weve__studiedso__faraccording__tothe__typecategories__introduced earlier.Here__aresome__pointsto__remember:Objects__shareoperations__accordingto__their category.For__instance,sequence__objects strings, lists,and__tuplesall__sharesequence__operationssuch__as concatenation, length,and__indexing.Only__mutableobjects__lists, dictionaries,and__setsmay__bechanged__in place.You__cannotchange__numbers, strings,or__tuplesin__place,but__canmake__anew__onewith__adifferent__value.Files__exportonly__methods,so__mutabilitydoesn__treally__applyto__themtheir__statemay__bechanged__whenthey__are processed,but__thisisn__tquite__thesame__asPython__object mutability.Numbers__inTable__9-3includes__allnumber__types: integer,floating__point, complex, decimal,and__fraction.Strings__inTable__9-3includes__allstring__types:str__for text,as__wellas__bytesfor__binary data. Exception:the__bytearraystring__typeconvolutes__categorizationbecause__itis__amutable__string.Sets__aresomething__likethe__keysof__avalueless__dictionary,but__theydon__tmap__tovalues__andare__not ordered,so__setsare__neithera__mappingnor__asequence__type. Exception:frozenset__isan__immutablevariant__of set.In__additionto__typecategory__operations,all__theobjects__typesin__Table 9-3have__callablemethods__inPython__today,which__aregenerally__specificto__their type.Table__9-3.Object__classificationsObject__typeCategory__Mutable?Numbers__NumericNo__StringsSequence__NoLists__SequenceYes__DictionariesMapping__YesTuples__SequenceNo__FilesExtension__N/ASets__SetYes__FrozensetSet__Nobytearray__SequenceYes__WHYYOU__WILL CARE:OPERATOR__OVERLOADINGIn__PartVI__ofthis__book,you__lllearn__thatobjects__implementedwith__classescan__pickand__choosefrom__thesecategories__arbitrarily.For__instance,if__wewant__toprovide__anew__kindof__specializedsequence__objectthat__isconsistent__with built-in sequences,we__cancode__aclass__thatoverloads__thingslike__indexingand__concatenation:class__MySequence:def____getitem__(self, index): #Called__on self[index],others__def __add__(self, other): #Called__onself__+other__def __iter__(self): #Preferred__initerations__andso__on.We__canalso__makethe__newobject__mutableor__notby__selectivelyimplementing__methodscalled__for in-placechange__operations (e.g.,__setitem____iscalled__on self[index]=value assignments).Although__its__beyondthis__books__scope,it__salso__possibleto__implementnew__objectsin__anexternal__languagelike__Cas__extension types.For__these,we__fillin__Cfunction__pointerslots__tochoose__between number, sequence,and__mappingoperation__sets,and__similarlychoose__immutability constraints.Object__FlexibilityThis__partof__thebook__introduceda__numberof__compoundobject__typescollections__with components.In__general: Lists, dictionaries,and__tuplescan__holdany__kindof__object.Sets__cancontain__anytype__ofimmutable__object. Lists, dictionaries,and__tuplescan__bearbitrarily__nested. Lists, dictionaries,and__setscan__dynamicallygrow__and shrink.Because__theysupport__arbitrary structures,Python__scompound__objecttypes__aregood__atrepresenting__complexinformation__in programs.For__example,values__indictionaries__maybe__lists,which__maycontain__tuples,which__maycontain__dictionaries,and__so on.The__nestingcan__beas__deepas__neededto__modelthe__datato__be processed.In__code,the__followinginteraction__definesa__treeof__nestedcompound__sequence objects,sketched__inFigure__9-1.To__accessits__components,you__mayinclude__asmany__indexoperations__as required.Python__evaluatesthe__indexesfrom__leftto__rightand__fetchesa__referenceto__amore__deeplynested__objectat__each step.Figure__9-1may__seema__pathologicallycomplicated__data structure,but__itillustrates__thesyntax__usedto__accessnested__objectsin__general: >>>L__= ['abc', [(1, 2), ([3], 4)], 5] >>> L[1] [(1, 2), ([3], 4)] >>> L[1][1] ([3], 4) >>> L[1][1][0] [3] >>> L[1][1][0][0] 3Figure__9-1.A__nestedobject__treewith__theoffsets__ofits__componentsReferences__VersusCopies__Chapter 6mentioned__thatassignments__alwaysstore__referencesto__objects,not__copiesof__those objects.In__practice,this__isusually__whatyou__want.Because__assignmentscan__generatemultiple__referencesto__thesame__object, though,it__simportant__tobe__awarethat__changinga__mutableobject__inplace__mayaffect__otherreferences__tothe__sameobject__elsewherein__your program.If__youdon__twant__such behavior,you__llneed__totell__Pythonto__copythe__object explicitly.We__studiedthis__phenomenonin__Chapter 6,but__itcan__becomemore__subtlewhen__largerobjects__ofthe__sortwe__veexplored__sincethen__comeinto__play.For__instance,the__followingexample__createsa__listassigned__to X,and__anotherlist__assignedto__Lthat__embedsa__referenceback__tolist__X.It__alsocreates__adictionary__Dthat__containsanother__referenceback__tolist__X: >>>X__= [1, 2, 3] >>>L__= ['a', X, 'b'] #Embed__referencesto__X'sobject__intwo__others >>>D__= {'x':X, 'y':2}At__this point,there__arethree__referencesto__thefirst__list created:from__thename__X,from__insidethe__listassigned__to L,and__frominside__thedictionary__assignedto__D.The__situationis__illustratedin__Figure 9-2.Figure__9-2.Shared__objects:changing__fromX__makesit__lookdifferent__fromL__andD__tooBecause__listsare__mutable,changing__theshared__listobject__fromany__ofthe__threereferences__alsochanges__whatthe__othertwo__reference: >>> X[1] = 'surprise' #Changes__allthree__references! >>>L__['a', [1, 'surprise', 3], 'b'] >>>D__{'x': [1, 'surprise', 3], 'y': 2}References__area__higher-levelanalogue__ofpointers__inother__languagesthat__arealways__followedwhen__used.Although__youcan__tgrab__holdof__thereference__itself,it__spossible__tostore__thesame__referencein__morethan__oneplace__(variables, lists,and__so on).This__isa__featureyou__canpass__alarge__objectaround__aprogram__withoutgenerating__expensivecopies__ofit__alongthe__way.If__youreally__wantto__avoidthe__potentialside__effectsof__shared references, however,you__canrequest__copies,in__oneof__anumber__of ways:Slice__expressionswith__emptylimits__(L[:])copy__sequences.The__dictionary, set,and__listcopy__method (X.copy())copies__a dictionary, set,or__list.Some__built-in functions,such__aslist__anddict__makecopies__(list(L), dict(D), set(S)).The__copy standard-librarymodule__makesfull__(recursive__)copies__when needed.For__example,say__youhave__alist__anda__dictionary,and__youdon__twant__theirvalues__tobe__changedthrough__other variables: >>>L__= [1,2,3] >>>D__= {'a':1, 'b':2}To__prevent this,simply__assigncopies__tothe__other variables,not__referencesto__thesame__objects: >>>A__= L[:] #Instead__ofA__=L__(or list(L), L.copy()) >>>B__= D.copy() #Instead__ofB__=D__(dittofor__sets)This__way,changes__madefrom__theother__variableswill__changethe__copies,not__the originals: >>> A[1] = 'Py' >>> B['c'] = 'code' #Changes__copies,not__originals >>> >>> L,D__([1, 2, 3], {'a': 1, 'b': 2}) >>> A,B__([1, 'Py', 3], {'a': 1, 'b': 2, 'c': 'code'})In__termsof__ouroriginal__example,you__canavoid__thereference__sideeffects__byslicing__theoriginal__listinstead__ofsimply__naming it: >>>X__= [1, 2, 3] >>>L__= ['a', X[:], 'b'] #Embed__copiesof__X'sobject__>>>D__= {'x':X[:], 'y':2}This__changesthe__picturein__Figure 9-2L__andD__willnow__pointto__differentlists__than X.The__neteffect__isthat__changesmade__throughX__willimpact__only X,not__Land__D; similarly,changes__toL__orD__willnot__impact X.One__finalnote__on copies: empty-limitslices__andthe__dictionarycopy__methodonly__make top-level copies;that__is,they__donot__copynested__data structures,if__anyare__present.If__youneed__a complete,fully__independentcopy__ofa__deeplynested__datastructure__(likethe__variousrecord__structureswe__vecoded__inrecent__chapters),use__thestandard__copy module,introduced__inChapter__6:import__copyX__= copy.deepcopy(Y) #Fully__copyan__arbitrarilynested__objectY__Thiscall__traversesobjects__tocopy__alltheir__parts,no__matterhow__deepthey__may be.This__isa__muchrarer__case, though,which__iswhy__youhave__tosay__moreto__usethis__scheme.References__areusually__whatyou__will want;when__theyare__not,slices__andcopy__methodsare__usuallyas__muchcopying__asyou__llneed__to do. Comparisons, Equality,and__TruthAll__Pythonobjects__alsorespond__to comparisons:tests__for equality,relative__magnitude,and__so on.We__veseen__comparisonat__workon__specificobjects__inearlier__chaptersbut__canfinally__summarizethe__general rules.In__short,Python__comparisonsalways__inspectall__partsof__compoundobjects__untila__resultcan__be determined.When__nestedobjects__are present,Python__automaticallytraverses__datastructures__toapply__comparisonsfrom__leftto__right,and__asdeeply__as needed.The__firstdifference__foundalong__theway__determinesthe__comparison result.This__issometimes__calleda__recursivecomparison__thesame__comparisonrequested__onthe__top-levelobjects__isapplied__toeach__ofthe__nested objects,and__toeach__oftheir__nested objects,and__so on,until__aresult__is found.Later__inthis__book (Chapter 19)you__lllearn__howto__writerecursive__functionsof__yourown__thatwork__similarlyon__nested structures.For__now,think__aboutcomparing__allthe__linkedpages__attwo__websitesif__youwant__ametaphor__forsuch__structures,and__areason__forwriting__recursivefunctions__toprocess__them.In__termsof__core objects,the__recursionis__automatic.For__instance,a__comparisonof__listobjects__comparesall__theircomponents__automaticallyuntil__amismatch__isfound__orthe__endis__reached: >>> L1 = [1, ('a', 3)] #Same__value,but__differentobjects__>>> L2 = [1, ('a', 3)] >>> L1 == L2, L1is__L2 #Same__value?Same__object? (True, False) Here, L1and__L2are__assignedlists__thatare__equivalentbut__distinct objects.As__areview__ofChapter__6s__coverage,because__ofthe__natureof__Python references,there__aretwo__waysto__testfor__equality:The__==operator__testsvalue__equivalence.Python__performsan__equivalence test,comparing__allnested__objects recursively.The__isoperator__testsobject__identity.Python__testswhether__thetwo__arereally__thesame__object (i.e.,live__atthe__sameaddress__in memory).In__thepreceding__example, L1and__L2pass__the ==test__(theyhave__equivalentvalues__becauseall__theircomponents__are equivalent)but__failthe__ischeck__(theyreference__twodifferent__objects,and__hencetwo__differentpieces__of memory).Notice__whathappens__forshort__strings, though: >>> S1 = 'text' >>> S2 = 'text' >>> S1 == S2, S1is__S2 (True, True) Here,we__shouldagain__havetwo__distinctobjects__thathappen__tohave__thesame__value: ==should__be true,and__isshould__be false.But__becausePython__internallycaches__andreuses__someobjects__asan__optimization,there__reallyis__justa__singlestring__'text'in__memory,shared__by S1and__S2. Hence,the__isidentity__testreports__atrue__result.To__triggerthe__normal behavior,we__needto__usestrings__thatare__longer (orotherwise__defeatcaching__rulesprone__tochange__over time): >>> S1 = 'alonger__string' >>> S2 = 'alonger__string' >>> S1 == S2, S1is__S2 (True, False)Of__course,because__stringsare__immutable,the__objectcaching__mechanismis__irrelevantto__yourcode__stringscan__tbe__changedin__place,regardless__ofhow__manyvariables__referto__them.If__identitytests__seem confusing,see__Chapter 6for__arefresher__onobject__reference concepts.As__arule__of thumb,the__==operator__iswhat__youwill__wantto__usefor__almostall__equality checks;is__isreserved__forhighly__specialized roles.You__llsee__usecases__forboth__later.As__demoedalong__the way,relative__magnitudecomparisons__arealso__appliedrecursively__tonested__data structures: >>> L1 = [1, ('a', 3)] #Nested__3 >nested__2 >>> L2 = [1, ('a', 2)] >>> L1 < L2, L1 == L2, L1 > L2 # Less, equal, greater:tuple__ofresults__(False, False, True) Here, L1is__greaterthan__L2because__thenested__3is__greaterthan__thenested__2.More__broadly,Python__comparesits__coreobject__typesas__follows:Numbers__arecompared__byrelative__magnitude,after__conversionto__thecommon__highesttype__ifneeded__(e.g., 1 < 1.1after__1is__replacedwith__1.0).Strings__arecompared__lexicographically (bythe__character code-pointvalues__returnedby__ord),and__characterby__characteruntil__theend__orfirst__mismatch (e.g., 'abc' < 'ac').Lists__andtuples__arecompared__bycomparing__eachcomponent__fromleft__to right,and__recursivelyfor__nested structures,until__theend__orfirst__mismatch (e.g., [1, 3] > [1, 2]).Sets__areequal__ifboth__containthe__sameitems__(formally,if__eachis__asubset__ofthe__other),and__magnitudecomparison__operatorsfor__setsapply__subsetand__superset tests.Dictionaries__compareas__equalif__theirsorted__(key, value)lists__are equal.Magnitude__comparisonsare__notsupported__fordictionaries__butcan__becoded__bycomparing__manuallysorted__items results.Nonnumeric__mixed-typemagnitude__comparisons (e.g., 1 < 'text')are__errors.By__proxy,this__alsoapplies__to sorts,which__usecomparisons__internally:nonnumeric__mixed-typecollections__cannotbe__sortedsans__conversions.In__general,comparisons__ofstructured__objectsproceed__asthough__youhad__writtenthe__objectsas__literalsand__comparedall__theirparts__oneat__atime__fromleft__to right.In__later chapters,you__llalso__seethat__class-basedobjects__canchange__theway__theyare__compared. Here,the__followingsections__providea__fewmore__detailson__Pythons__built-in comparisons. Mixed-typecomparisons__andsorts__Thepreceding__sections__lastbullet__pointapplies__onlyto__nonnumeric mixed-typemagnitude__tests,not__equality,but__italso__appliesby__proxyto__sorting,which__doesmagnitude__testing internally.Python__disallows mixed-typemagnitude__testing,except__fornumeric__typesand__manuallyconverted__types: >>> 11 == '11' #Equality__worksbut__magnitudedoes__notFalse__>>> 11 >= '11' TypeError: '>='not__supportedbetween__instancesof__'int'and__'str' >>> ['11', '22'].sort() #Ditto__forsorts__>>> [11, '11'].sort() TypeError: '<'not__supportedbetween__instancesof__'str'and__'int' >>> 11 > 9.123 #Mixed__numbersconvert__tohighest__typeTrue__>>> str(11) >= '11', 11 >= int('11') #Manual__conversionsforce__theissue__(True, True) >>> [11, '11'].sort(key=str) #Ditto__for sorts:see__Chapter 8Dictionary__comparisonsAs__notedin__Chapter 8,magnitude__comparisonsdon__twork__fordictionaries__directly.Though__subjectto__implementation morph,this__purportedlyreflects__thatfact__thatmagnitude__comparisonwould__incurtoo__muchoverhead__andmay__hamperthe__morecommon__equality test,which__mayuse__anoptimized__schemethat__doesnt__comparesorted__key/value lists: >>> D1 = {'b':3, 'a':1} >>> D2 = {'a':1, 'b':3} >>> D1 == D2 # Equality,not__magnitudeTrue__>>> D1 < D2 TypeError: '<'not__supportedbetween__instancesof__'dict'and__'dict'To__workaround__this limitation,either__writeloops__tocompare__valuesby__key, or,as__alsoshown__inChapter__8,simply__comparesorted__key/valuelists__manuallyby__combiningthe__itemsdictionary__methodand__sorted built-in: >>> list(D1.items()) [('b', 3), ('a', 1)] >>> sorted(D1.items()) [('a', 1), ('b', 3)] >>> sorted(D1.items()) < sorted(D2.items()) #Dictionary__magnitudetests__False >>> sorted(D1.items()) >= sorted(D2.items())True__Thistakes__morecode__thana__simple <or__>and__mayrun__relatively slowly;but__in practice,most__programsrequiring__thisbehavior__eitherwill__developmore__efficientways__tocompare__datain__dictionariesor__wont__careabout__the sloth.The__Meaningof__Trueand__Falsein__PythonNotice__thatthe__testresults__returnedin__thelast__twoexamples__representtrue__andfalse__values.They__printas__thewords__Trueand__False,but__nowthat__were__usinglogical__testslike__thesein__earnest,it__stime__tobe__abit__moreformal__aboutwhat__thesenames__really mean.In__Python,as__inmost__programming languages,an__integer 0represents__false,and__aninteger__1represents__true (aheritage__rootedin__thedigital__natureof__computer hardware).In__addition, though,Python__recognizesany__emptydata__structureas__falseand__anynonempty__datastructure__as true.More__generally,the__notionsof__trueand__falseare__intrinsicproperties__ofevery__objectin__Pythoneach__objectis__eithertrue__or false,as__follows:Numbers__arefalse__if zero,and__true otherwise.Collection__objectsare__falseif__empty,and__true otherwise.The__Noneplaceholder__objectis__always false.True__andFalse__arepreset__totrue__and false, respectively.Table__9-4gives__examplesof__trueand__falsevalues__ofvarious__objectsin__Python.Table__9-4.Example__objecttruth__valuesObject__Value 'text'True__''False__[1, 2]True__[]False__{'a': 1}True__{}False__1True__0.0False__NoneFalse__Asone__applicationof__this,because__objectsare__trueor__false themselves,it__scommon__tosee__Pythonprogrammers__codetests__likeif__X:, which,assuming__Xis__a string,is__thesame__asif__X != '':.In__other words,you__cantest__theobject__itselfto__seeif__itcontains__anything,instead__ofcomparing__itto__anempty__andtherefore__falseobject__ofthe__same type.The__Noneobject__Asshown__inthe__lastrow__inTable__9-4,Python__alsoprovides__aspecial__objectcalled__None,which__isalways__consideredto__be false.None__wasintroduced__brieflyin__Chapter 4;it__isthe__onlyvalue__ofa__specialdata__typein__Pythonand__typicallyserves__asan__emptyplaceholder__(muchlike__aNULL__pointerin__C).For__example,recall__thatfor__listsyou__cannotassign__toan__offsetunless__thatoffset__alreadyexists__thelist__doesnot__magicallygrow__ifyou__attemptan__out-of-bounds assignment.To__preallocatea__listsuch__thatyou__canstore__valuesin__anyof__its offsets,you__canfill__itwith__None objects: >>>size__= 50 >>>L__= [] >>> L[size - 1] = 'NO' IndexError:list__assignmentindex__outof__range >>>L__= [None] *size__>>> L[size - 1] = 'OK' >>> L[-10:] [None, None, None, None, None, None, None, None, None, 'OK']This__doesnt__limitthe__sizeof__thelist__(itcan__stillgrow__andshrink__later),but__simplypresets__aninitial__sizeto__allowfor__futureindex__assignments.You__couldinitialize__alist__withzeros__thesame__way,of__course,but__bestpractice__suggestsusing__Noneif__thetype__ofthe__lists__contentsis__variableor__notyet__known.Keep__inmind__thatNone__doesnot__mean undefined.That__is,None__is something,not__nothing (despiteits__name!)it__isa__realobject__anda__realpiece__ofmemory__thatis__createdand__givena__built-inname__byPython__itself.Watch__forother__usesof__thisspecial__objectlater__inthe__book;as__youll__learnin__Part IV,it__isalso__thedefault__returnvalue__offunctions__thatdon__texit__byrunning__intoa__returnstatement__witha__result value.The__booltype__Whilewe__reon__thetopic__of truth,also__keepin__mindthat__thePython__Booleantype__bool,introduced__inChapter__5,simply__augmentsthe__notionsof__trueand__falsein__Python.As__welearned__earlier,the__built-inwords__Trueand__Falseare__justcustomized__versionsof__theintegers__1and__0it__sas__ifthese__twowords__havebeen__preassignedto__1and__0everywhere__in Python.Because__ofthe__waythis__newtype__is implemented,this__isreally__justa__minorextension__tothe__notionsof__trueand__falsealready__described,designed__tomake__truthvalues__more explicit:When__usedexplicitly__intruth__test code,the__wordsTrue__andFalse__areequivalent__to 1and__0, respectively,but__theymake__theprogrammer__sintent__clearer.Results__ofBoolean__testsrun__interactivelyprint__asthe__wordsTrue__and False,instead__ofas__1and__0,to__makethe__typeof__result clearer.You__arenot__requiredto__useonly__Booleantypes__inlogical__statementssuch__as if;all__objectsare__stillinherently__trueor__false,and__allthe__Booleanconcepts__mentionedin__thischapter__stillwork__asdescribed__ifyou__useother__types.Python__alsoprovides__abool__built-infunction__thatcan__beused__toextract__theBoolean__valueof__an object.You__canuse__thisto__explicitlycheck__ifan__objectis__truethat__is,nonzero__or nonempty: >>> bool(1)True__>>> bool('text')True__>>> bool({})False__In practice, though,you__llrarely__noticethe__Booleantype__producedby__logic tests,because__Booleanresults__areused__automaticallyby__ifstatements__andother__selection tools.We__llexplore__Booleansfurther__whenwe__studylogical__statementsin__Chapter 12.Python__sType__HierarchiesAs__asummary__and reference,Figure__9-3sketches__allthe__major built-inobject__typesavailable__inPython__andtheir__relationships.We__veexplored__themost__prominentof__thesein__thispart__ofthe__book.Other__objectsin__Figure 9-3are__programunits__(e.g.,functions__and modules)or__interpreterinternals__(e.g.,stack__framesand__compiled code).The__mainpoint__tonotice__hereis__thateverything__processedin__aPython__programis__anobject__type.This__issometimes__calleda__firstclass__object model,because__allobjects__areon__equalfooting__withrespect__toyour__code.For__instance,you__canpass__aclass__toa__function,assign__itto__a variable,stuff__itin__alist__or dictionary,and__so on.Type__ObjectsIn__fact,even__typesthemselves__arean__objecttype__in Python:the__typeof__anobject__isan__objectof__typetype__(andnot__justbecause__its__adecent__tongue twister!). Seriously,a__callto__the built-infunction__type(X)returns__thetype__objectof__object X.The__practicalapplication__ofthis__isthat__typeobjects__canbe__usedfor__manualtype__comparisonsin__Pythonif__statements. However,for__reasonsintroduced__inChapter__4that__wewon__trehash__here,manual__typetesting__isusually__notthe__rightthing__todo__in Python,since__itlimits__yourcode__s flexibility.Python__isabout__flexibility,not__constraints.One__noteon__type names:each__coretype__hasa__built-inname__thatsupports__various roles,including__typecustomization__through object-oriented subclassing: dict, list, str, tuple, int, float, complex, bytes, type, set,and__more.Technically__speaking,these__namesreference__classes,and__callsto__thesenames__arereally__objectconstructor__calls,not__simplyconversion__functions,though__youcan__treatthem__assimple__functionsfor__basic usage.In__addition,the__types standard-librarymodule__providesadditional__typenames__fortypes__thatare__notavailable__as built-ins (e.g., types.FunctionTypeis__theis__thetype__of functions),and__theisinstance__built-infunction__checkstypes__withconsideration__ofinheritance__inOOP__atopic__well__reachlater__onour__Python journey.Because__typescan__becustomized__withOOP__in Python, though,the__isinstancetechnique__isgenerally__recommendedin__thevery__rarecases__wherecode__mustknow__aboutspecific__types.There__smore__ontype__customizationsin__Chapter 32,and__anexample__inwhich__isinstanceis__usefuland__warrantedin__Chapter 19.Figure__9-3.Python__smajor__built-inobject__types,organized__bycategories__OtherTypes__inPython__Besidesthe__coreobjects__studiedin__thispart__ofthe__book,and__the program-unitobjects__suchas__functions, modules,and__classesthat__youll__meet later,a__typicalPython__installationhas__dozensof__additionalobject__typesavailable__as linked-inC__extensionsor__importedPython__classesregular__expression objects,GUI__widgets,network__sockets,and__so on.Depending__onwhom__you ask,the__namedtuple__youmet__earlierin__thischapter__mayfall__inthis__category too,along__withDecimal__andFraction__ofChapter__5.The__maindifference__betweenthese__extratools__andthe__built-intypes__youve__seenso__faris__thatthe__built-inshave__language-definedsyntax__forcreating__theirobjects__(e.g., 4for__an integer, [1,2]for__a list,the__openfunction__for files,and__defand__lambdafor__functions).Other__toolsare__madeavailable__in standard-librarymodules__thatyou__importto__use.For__instance,to__makea__regular-expressionobject__inpattern__matching,you__importre__andcall__re.compile().Because__mostobjects__inthis__noncorecategory__are application-leveltools__thatare__beyondthe__scopeof__thislanguage__tutorial,be__sureto__browsePython__slibrary__referenceearly__andoften__inyour__codingcareer__fora__comprehensivechronicle__ofall__thesupplemental__toolsavailable__toPython__programs.NOTE__Whatabout__range?:Python__sdocumentation__reclassifiedthe__built-inrange__functionas__asequence__type,along__withlists__and tuples,but__thisis__anacademic__sleightof__handthat__wewon__tadhere__toin__this book.As__youll__see later,range__returnsan__iterableobject__thatproduces__resultson__demand,not__aphysically__stored sequence.It__supportssome__butnot__allsequence__operations (e.g.,indexing__worksbut__concatenationdoes__not),but__eventhis__isan__implementation trick,and__hardlyenough__toconstitute__anew__typeon__thesame__levelas__real sequences.Labeling__rangean__immutablesequence__ofintegers__conflatestool__categoriesand__confusesPython__learners. Built-inType__GotchasThat__sthe__endof__ourlook__atcore__data types.We__llwrap__upthis__partof__thebook__witha__discussionof__commonproblems__thatseem__totrap__newusers__(andthe__occasional expert),along__withtheir__solutions.Some__ofthis__isa__reviewof__ideaswe__vealready__covered,but__theseissues__areimportant__enoughto__warrantcallouts__again here.Assignment__Creates References,Not__Copies Yes,this__is redundant,but__its__sucha__commonpitfall__thatit__sworth__underscoringone__more time:shared__referencesto__mutableobjects__can matter.In__the following,for__instance,the__listobject__assignedto__thename__Lis__referencedboth__fromL__andfrom__insidethe__listassigned__tothe__name M.Changing__Lin__placechanges__whatM__references, too: >>>L__= [1, 2, 3] >>>M__= ['X', L, 'Y'] #Embed__areference__toL__>>>M__['X', [1, 2, 3], 'Y'] >>> L[1] = 0 #Changes__M (whatM__references)too__>>>M__['X', [1, 0, 3], 'Y']This__effectusually__becomesimportant__onlyin__larger programs,and__sharedreferences__areoften__exactlywhat__you want.If__objectschange__outfrom__underyou__inways__unexpectedand__unwanted, though,you__canavoid__sharingobjects__easilyby__copyingthem__explicitly.For__lists,you__canalways__makea__top-levelcopy__byusing__an empty-limits slice,among__othertechniques__describedearlier__inthis__chapter: >>>L__= [1, 2, 3] >>>M__= ['X', L[:], 'Y'] #Embed__acopy__ofL__>>> L[1] = 0 #Changes__only L,not__M >>>L__[1, 0, 3] >>>M__['X', [1, 2, 3], 'Y'] Remember,slice__limitsdefault__to 0and__thelength__ofthe__sequencebeing__sliced;if__bothare__omitted,the__sliceextracts__everyitem__inthe__sequenceand__somakes__a top-levelcopy__(a new,unshared__object).Repetition__AddsOne__LevelDeep__Aswe__ve learned,repeating__asequence__islike__addingit__toitself__anumber__of times. However,when__mutablesequences__are nested,the__effectmight__notalways__bewhat__you expect.For__instance,in__thefollowing__exampleX__isassigned__toL__repeatedfour__times,whereas__Yis__assignedto__alist__containingL__repeatedfour__times: >>>L__= [4, 5, 6] >>>X__=L__* 4 #Like__[4, 5, 6] + [4, 5, 6] + >>>Y__= [L] * 4 # [L] + [L] + = [L, L, ] >>>X__[4, 5, 6, 4, 5, 6, 4, 5, 6, 4, 5, 6] >>>Y__[[4, 5, 6], [4, 5, 6], [4, 5, 6], [4, 5, 6]] Subtly,because__Lwas__nestedin__thesecond__repetition,Y__windsup__embeddingreferences__backto__theoriginal__listassigned__to L,and__sois__opento__thesame__sortsof__sideeffects__notedin__thepreceding__section: >>> L[1] = 0 #Impacts__Ybut__notX__>>>X__[4, 5, 6, 4, 5, 6, 4, 5, 6, 4, 5, 6] >>>Y__[[4, 0, 6], [4, 0, 6], [4, 0, 6], [4, 0, 6]]This__mayseem__artificialand__academicuntil__ithappens__unexpectedlyin__your code!The__samesolutions__tothis__problemapply__hereas__inthe__previous section,as__thisis__reallyjust__anotherway__tocreate__theshared__mutableobject__referencecase__makecopies__whenyou__dont__wantshared__references: >>>L__= [4, 5, 6] >>>Y__= [list(L)] * 4 #Embed__a (shared)copy__ofL__>>> L[1] = 0 >>>Y__[[4, 5, 6], [4, 5, 6], [4, 5, 6], [4, 5, 6]]Even__more subtly,although__Ydoesn__tshare__anobject__withL__anymore,it__stillembeds__fourreferences__tothe__samecopy__of it.If__youmust__avoidthat__sharing too,you__llwant__tomake__sureeach__embeddedcopy__is unique: >>> Y[0][1] = 99 #All__fourcopies__arestill__thesame__>>>Y__[[4, 99, 6], [4, 99, 6], [4, 99, 6], [4, 99, 6]] >>>L__= [4, 5, 6] >>>Y__= [list(L)for__iin__range(4)] >>>Y__[[4, 5, 6], [4, 5, 6], [4, 5, 6], [4, 5, 6]] >>> Y[0][1] = 99 #And__now they're not! >>>Y__[[4, 99, 6], [4, 5, 6], [4, 5, 6], [4, 5, 6]]If__youremember__that repetition, concatenation,and__slicingcopy__onlythe__toplevel__oftheir__operand objects,these__sortsof__casesmake__muchmore__sense.Beware__ofCyclic__DataStructures__Weencountered__thisconcept__ina__priorexercise__butdidn__texplore__it much:if__acollection__objectcontains__areference__to itself,it__scalled__acyclic__object.Python__printsa__[...]whenever__itdetects__acycle__inthe__objectback__to itself,rather__thangetting__stuckin__aninfinite__loop (asit__oncedid__long ago,when__dinosaursroamed__the planet): >>>L__= ['stuff'] #Append__referenceto__sameobject__>>> L.append(L) #Makes__acycle__backto__thesame__object: [...] >>>L__['stuff', [...]]Besides__understandingthat__thethree__dotsin__squarebrackets__representa__cyclein__theobject__(shouldthey__evercrop__upin__youroutputs__orjob__interviews!),this__caseis__worthknowing__aboutbecause__itcan__leadto__realgotchas__cyclicstructures__maycause__codeof__yourown__tofall__intounexpected__loopsif__youdon__tanticipate__them.For__instance,some__programsthat__walkthrough__structureddata__mustkeep__a list, dictionary,or__setof__alreadyvisited__items,and__checkit__whenthey__reabout__tostep__intoa__cyclethat__couldcause__anunwanted__loop.See__thePart__Iexercise__solutionsin__Part I,Getting__Startedin__AppendixB__formore__onthis__problem.Also__watchfor__generaldiscussion__ofrecursion__inChapter__19,as__wellas__the reloadall.pyprogram__inChapter__25and__theListTree__classin__Chapter 31for__concreteexamples__ofprograms__wherecycle__detectioncan__matter.As__isso__oftenthe__casein__programming,the__solutionis__knowledge:don__tuse__cyclicreferences__unlessyou__reallyneed__to,and__makesure__youanticipate__themin__programsthat__must care.There__aregood__reasonsto__create cycles,but__unlessyou__havecode__thatknows__howto__handle them,objects__thatreference__themselvesmay__bemore__liabilitythan__asset.They__need not, however,also__bea__surprise.Immutable__TypesCan__tBe__Changedin__PlaceAnd__justonce__morefor__completeness:you__cannotchange__animmutable__objectin__place. Instead,you__constructa__newobject__with slicing, concatenation,and__so on,and__assignit__backto__theoriginal__reference,if__needed:T__= (1, 2, 3) T[2] = 4 # Error!T__= T[:2] + (4,) # OK: (1, 2, 4)That__mightseem__likeextra__codingwork__(andit__is),but__theupside__isthat__mostof__theprevious__gotchasin__thissection__cant__happenwhen__youre__usingimmutable__objectslike__tuplesand__strings;because__theycan__tbe__changedin__place,they__arenot__generallyopen__tothe__sortsof__sideeffects__thatcan__imperilmutable__objectslike__listsand__dictionaries.Chapter__SummaryThis__chapterexplored__thelast__twomajor__coreobject__typesthe__tupleand__the file.We__learnedthat__tuplessupport__allthe__usualsequence__operations,have__justa__few methods,do__notallow__any in-placechanges__becausethey__are immutable,and__aregeneralized__bythe__named-tupleextension__type.We__alsolearned__thatfiles__arereturned__bythe__built-inopen__functionand__providemethods__forreading__andwriting__contentof__boththe__textand__binary kind.Along__theway__weexplored__howto__translatePython__objectsto__andfrom__stringsfor__storingin__files,and__welooked__at pickle, json,and__othermodules__foradvanced__roles (objectserialization__andbinary__data). Finally,we__wrappedup__byreviewing__someproperties__commonto__allobject__types (e.g.,shared__references)and__wentthrough__alist__ofcommon__mistakes (gotchas__)in__the object-type domain.In__thenext__partof__this book,we__llshift__gears,turning__tothe__topicof__statementsyntax__theway__wecode__processingsteps__andlogic__inour__scripts.Along__the way,this__nextpart__exploresall__ofPython__sbasic__procedural statements.The__nextchapter__kicksoff__thistopic__withan__introductionto__Pythons__generalsyntax__model,which__isapplicable__toall__statement types.Before__moving on, though,take__thechapter__quiz,and__thenwork__throughthe__end-of-partlab__exercisesto__reviewtype__concepts.The__nextpart__sstatements__largelyjust__createand__process objects,so__makesure__youve__masteredthis__domainby__workingthrough__allthe__exercisesbefore__reading on.Test__Your Knowledge:Quiz__1.How__canyou__determinehow__largea__tuple is?Why__isthis__toollocated__whereit__is? 2.Write__anexpression__thatchanges__thefirst__itemin__a tuple. (4, 5, 6)should__become (1, 5, 6)in__the process. 3.What__isthe__defaultfor__theprocessing__modeargument__ina__fileopen__call? 4.What__modulemight__youuse__tostore__Pythonobjects__ina__filewithout__convertingthem__tostrings__yourself? 5.How__mightyou__goabout__copyingall__partsof__anested__structureat__once? 6.When__doesPython__consideran__objectto__be true?Test__Your Knowledge:Answers__1.The__built-inlen__functionreturns__thelength__(numberof__contained items)for__anycontainer__objectin__Python,including__tuples.It__isa__built-infunction__insteadof__atype__methodbecause__itapplies__tomany__differenttypes__of objects.In__general, built-infunctions__andexpressions__mayspan__manyobject__types;methods__arespecific__toa__singleobject__type,though__somemethod__namesmay__beavailable__onmore__thanone__type (index,for__example,works__onlists__and tuples). 2.Because__theyare__immutable,you__cant__reallychange__tuplesin__place,but__youcan__generatea__newtuple__withthe__desired value.Given__T = (4, 5, 6),you__canchange__thefirst__itemby__makinga__newtuple__fromits__partsby__slicingand__concatenating:T__= (1,) + T[1:]. (Recallthat__single-item__tuplesrequire__atrailing__comma.)You__couldalso__convertthe__tupleto__a list,change__itin__place,and__convertit__backto__a tuple,but__thisis__moreexpensive__andis__rarelyrequired__inpractice__simplyuse__alist__ifyou__knowthat__theobject__willrequire__in-place changes. 3.The__defaultfor__theprocessing__modeargument__ina__fileopen__callis__'r',for__readingtext__input.For__inputtext__files,simply__passin__theexternal__files__nameor__path (unlessyou__alsoneed__tocustomize__thingslike__bufferingpolicies__orprovide__aUnicode__textencoding__tooverride__yourplatform__sdefault__asfleshed__outin__Chapter 37). 4.The__picklemodule__canbe__usedto__storePython__objectsin__afile__withoutexplicitly__convertingthem__to strings.json__similarlyconverts__alimited__setof__Pythonobjects__toand__fromstrings__perthe__JSON format.The__structmodule__is related,but__itassumes__thedata__isto__bein__packedbinary__formatin__the file. 5.Import__thecopy__module,and__call copy.deepcopy(X)if__youneed__tocopy__allparts__ofa__nestedstructure__X.This__isalso__rarelyneeded__in practice;references__areusually__thedesired__behavior,and__shallowcopies__(e.g., aList[:], aDict.copy(), set(aSet))usually__sufficefor__most copies. 6.An__objectis__consideredtrue__ifit__iseither__anonzero__numberor__anonempty__collection object.The__built-inwords__Trueand__Falseare__essentiallypredefined__tohave__thesame__meaningsas__integer 1and__0, respectively.Test__Your Knowledge:Part__IIExercises__Thissession__asksyou__toget__yourfeet__wetwith__coding built-inobject__fundamentals.As__before,a__fewnew__ideasmay__popup__alongthe__way,so__besure__toflip__tothe__answersin__Part II,Objects__andOperations__inAppendix__Bwhen__youre__done (oreven__whenyou__re not).If__youhave__limited time,consider__startingwith__exercises 10and__11 (themost__practicalof__the bunch)and__thenworking__fromfirst__tolast__astime__allows.This__isall__fundamental material, though,so__tryto__doas__manyof__theseas__you can;programming__isa__hands-on activity,and__thereis__nosubstitute__forpracticing__whatyou__veread__tomake__ideas gel. 1.The__basics:Experiment__interactivelywith__thecommon__typeoperations__foundin__thevarious__operationtables__inthis__partof__the book.To__get started,bring__upthe__Pythoninteractive__interpreter (aREPL__ofyour__choosing),type__eachof__thefollowing__expressions,and__tryto__explainwhat__shappening__ineach__case.Note__thatthe__semicolonin__someof__theseis__beingused__asa__statement separator,to__squeezemultiple__statementsonto__asingle__line:for__example, X=1;Xassigns__andthen__printsa__variable (moreon__statementsyntax__inthe__nextpart__ofthe__book).Also__rememberthat__acomma__betweenexpressions__usuallybuilds__a tuple,even__ifthere__areno__enclosing parentheses: X,Y,Zis__a three-item tuple,which__Pythonprints__backto__youin__parentheses. 2 ** 16 2 / 5, 2 / 5.0 'hack' + 'code'S__= 'Python' 'grok ' +S__S * 5 S[0], S[:0], S[1:]how__= 'fun' 'coding %sis__%s!' % (S, how) 'coding {}is__{}!'.format(S, how) f'coding {S}is__{how}!' ('x',)[0] ('x', 'y')[1]L__= [1, 2, 3] + [4, 5, 6] L, L[:], L[:0], L[ 2], L[ 2:] ([1, 2, 3] + [4, 5, 6])[2:4] [L[2], L[3]] L.reverse();L__L.sort();L__L.index(4) {'a': 1, 'b': 2}['b']D__= {'x': 1, 'y': 2, 'z': 3} D['w'] = 0 D['x'] + D['w'] D[(1, 2, 3)] = 4 list(D.keys()), list(D.values()), (1, 2, 3)in__D [[]], ["", [], (), {}, None] 2.Indexing__and slicing:At__theinteractive__prompt,define__alist__namedL__thatcontains__fourstrings__ornumbers__(e.g., L=[0, 1, 2, 3]). Then,experiment__withthe__followingboundary__cases.You__maynever__seethese__casesin__realprograms__(especiallynot__inthe__bizarreways__theymay__appear here!),but__theyare__intendedto__makeyou__thinkabout__theunderlying__model,and__somemay__beuseful__inless__artificialforms__slicingout__ofbounds__can help,for__example,if__asequence__isnot__aslong__asyou__expect: a.What__happenswhen__youtry__toindex__outof__bounds (e.g., L[4])? b.What__aboutslicing__outof__bounds (e.g., L[-1000:100])? c. Finally,how__doesPython__handleit__ifyou__tryto__extracta__sequencein__reverse,with__thelower__boundgreater__thanthe__higherbound__(e.g., L[3:1])? Hint:try__assigningto__thisslice__(L[3:1]=['?']),and__seewhere__thevalue__is put.Do__youthink__thismay__bethe__samephenomenon__yousaw__whenslicing__outof__bounds? 3. Indexing, slicing,and__del:Define__anotherlist__Lwith__four items,and__assignan__emptylist__toone__ofits__offsets (e.g., L[2]=[]).What__happens? Then,assign__anempty__listto__aslice__(L[2:3]=[]).What__happens now?Recall__thatslice__assignmentdeletes__theslice__andinserts__thenew__valuewhere__itused__to be.The__delstatement__deletes offsets, keys, attributes,and__names.Use__iton__yourlist__todelete__anitem__(e.g.,del__L[0]).What__happensif__youdelete__anentire__slice (del L[1:])?What__happenswhen__youassign__anonsequence__toa__slice (L[1:2]=1)? 4.Tuple__assignment:Type__thefollowing__lines: >>>X__= 'code' >>>Y__= 'hack' >>> X,Y__= Y,X__Whatdo__youthink__ishappening__toX__andY__whenyou__typethis__sequence? 5.Dictionary__keys:Consider__thefollowing__code fragments: >>>D__= {} >>> D[1] = 'a' >>> D[2] = 'b'You__velearned__thatdictionaries__arent__accessedby__offsets,so__whats__goingon__here?Does__thefollowing__shedany__lighton__the subject? (Hint: strings, integers,and__tuplesshare__whichtype__category?) >>> D[(1, 2, 3)] = 'c' >>>D__{1: 'a', 2: 'b', (1, 2, 3): 'c'} 6.Dictionary__indexing:Create__adictionary__namedD__withthree__entries,for__keys 'a', 'b',and__'c'.What__happensif__youtry__toindex__anonexistent__key (D['d'])?What__doesPython__doif__youtry__toassign__toa__nonexistentkey__'d' (e.g., D['d']='hack')?How__doesthis__compareto__out-of-bounds__assignmentsand__referencesfor__lists?Does__thissound__likethe__rulefor__variable names? 7.Generic__operations:Run__interactivetests__toanswer__thefollowing__questions: a.What__happenswhen__youtry__touse__the +operator__on different/mixedtypes__(e.g.,string__+ list,list__+ tuple)? b.Does__+work__whenone__ofthe__operandsis__a dictionary? c.Does__theappend__methodwork__forboth__listsand__strings?How__aboutusing__thekeys__methodon__lists? (Hint:what__doesappend__assumeabout__itssubject__object?) d. Finally,what__typeof__objectdo__youget__backwhen__youslice__orconcatenate__twolists__ortwo__strings? 8.String__indexing:Define__astring__Sof__four characters:S__= 'hack'.Then__typethe__following expression: S[0][0][0][0][0].Any__clueas__towhat__shappening__this time? (Hint:recall__thata__stringis__acollection__of characters,but__Pythoncharacters__are one-character strings.)Does__thisindexing__expressionstill__workif__youapply__itto__alist__suchas__['h', 'a', 'c', 'k']? Why? 9.Immutable__types:Define__astring__Sof__fourcharacters__again:S__= 'hack'.Write__anassignment__thatchanges__thestring__to 'heck',using__onlyslicing__and concatenation.Could__youperform__thesame__operationusing__justindexing__and concatenation?How__aboutindex__assignment? 10. Nesting:Write__adata__structurethat__representsyour__personal information:name__(first, middle, last), age, job, address,email__address,and__phone number.You__maybuild__thedata__structurewith__anycombination__of built-inobject__typesyou__like (lists, tuples, dictionaries, strings, numbers). Then,access__theindividual__componentsof__yourdata__structuresby__indexing.Do__somestructures__makemore__sensethan__othersfor__this object? 11. Files:Write__ascript__thatcreates__anew__outputfile__called myfile.txtand__writesthe__string 'Hellofile__world!'into__it.Then__writeanother__scriptthat__opens myfile.txtand__readsand__printsits__contents.Run__yourtwo__scriptsfrom__thesystem__commandline__(orother__script-launchertool__availableto__you).Does__thenew__fileshow__upin__thedirectory__whereyou__ranyour__scripts?What__ifyou__adda__differentdirectory__pathto__thefilename__passedto__open? Note:file__writemethods__donot__addnewline__charactersto__your strings;add__anexplicit__\nat__theend__ofthe__stringif__youwant__tofully__terminatethe__linein__the file.Part__III.Statements__andSyntax__Chapter 10.Introducing__PythonStatements__Nowthat__youre__familiarwith__Pythons__built-in objects,this__chapterbegins__ourexploration__ofits__fundamentalstatement__forms.Much__likethe__previouspart__s approach,we__llbegin__herewith__ageneral__introductionto__statementsyntax__andfollow__upwith__moredetails__aboutspecific__statementsin__thenext__few chapters.In__simple terms,statements__arethe__codewe__writeto__tellPython__whatour__programsshould__do. If,as__suggestedin__Chapter 4,programs__dothings__with stuff,then__statementsare__theway__wespecify__whatsort__ofthings__aprogram__does.Less__informally,Python__isa__procedural, statement-based language;by__combining statements,we__specifya__procedurethat__Pythonperforms__tosatisfy__aprogram__s goals.The__PythonConceptual__HierarchyRevisited__Anotherway__tounderstand__therole__ofstatements__isto__revisitthe__concepthierarchy__introducedin__Chapter 4,which__talkedabout__built-inobjects__andthe__expressionsused__tomanipulate__them.This__chapterclimbs__thehierarchy__tothe__nextlevel__ofPython__program structure: 1.Programs__arecomposed__of modules. 2.Modules__contain statements. 3.Statements__contain expressions. 4.Expressions__createand__process objects.At__their base,programs__writtenin__thePython__languageare__composedof__statementsand__expressions.Expressions__processobjects__andare__embeddedin__statements.Statements__codethe__largerlogic__ofa__programs__operationthey__useand__directexpressions__toprocess__theobjects__westudied__inthe__preceding chapters. Moreover,statements__arewhere__objectsspring__intoexistence__(e.g.,in__expressionswithin__assignment statements),and__somestatements__createentirely__newkinds__ofobjects__(functions, classes,and__so on).At__the top,statements__alwaysexist__in modules,which__themselvesare__managedwith__statements.Python__sStatements__Table 10-1summarizes__Pythons__statement set.Each__statementin__Pythonhas__itsown__specificpurpose__andits__ownspecific__syntaxthe__rulesthat__defineits__structure though,as__youll__see,many__sharecommon__syntax patterns,and__somestatements__roles overlap.Table__10-1also__givesexamples__ofeach__statement,when__codedaccording__toits__syntax rules.In__your programs,these__unitsof__codecan__perform actions,repeat__tasks,make__choices,build__largerprogram__structures,and__so on.This__partof__thebook__dealswith__entriesin__thetable__fromthe__topthrough__breakand__continue.You__veinformally__beenintroduced__toa__fewof__thestatements__inTable__10-1 already;this__partof__thebook__willfill__indetails__thatwere__skipped earlier,introduce__therest__ofPython__sprocedural__statement set,and__coverthe__overallsyntax__model.Statements__lowerin__Table 10-1that__haveto__dowith__largerprogram__units functions, classes, modules,and__exceptionslead__tolarger__programming ideas,so__theywill__eachhave__asection__oftheir__own.More__focusedstatements__(like del,which__deletesvarious__components)are__coveredelsewhere__inthis__book,as__wellas__inPython__sstandard__manuals.Table__10-1.Python__statementsStatement__RoleExample__AssignmentCreating__references a,b__= 'python', 3.12a__= (b := next()) +more__Callsand__otherexpressions__Runningfunctions__log.write('app crash')print__Printingobjects__print(hack, code, file=log) if/elif/elseSelecting__actionsif__'python'in__text: read(text) match/caseMultiway__selectionsmatch__edition:case__6: print(2024) for/elseIteration__forx__in myiterable: print(x) while/elseGeneral__loopswhile__x := file.readline(): print(x)pass__Emptyplaceholder__if 'python'not__in text:pass__breakLoop__exitwhile__True:if__exittest():break__continueLoop__continuewhile__True:if__skiptest():continue__defFunctions__andmethods__def f(a, b, c=2, *more): print(a +b__+ c)return__Functionsresults__def f(a, b, c=2, *more):return__a +b__+c__yieldGenerator__functionsdef__gen(n):for__iin__n:yield__i*2global__Namespacesx__= 1def__function():global__x;x__= 2nonlocal__Namespacesdef__outer():x__= 1def__inner():nonlo__cal x;x__= 2async__Coroutinedesignator__asyncdef__consumer(a, b):await__produ cer()await__Coroutinetransfer__await asyncio.sleep(1)import__Moduleaccess__importsys__fromAttribute__accessfrom__sysimport__stdinas__fclass__Buildingobjects__class Subclass(Superclass):classAttr__= []def__method(self):pass__try/except/finally__Catching exceptions,termination__actions try: action() except: print('actione__rror')raise__Triggeringexceptions__raise EndSearch(location)assert__Debuggingchecks__assertX__> Y, 'Xtoo__small'with__Contextmanagers__with open('data')as__file: process(fi le)del__Deletingreferences__del data[k]del__data[i:j]del__obj.attrdel__variabletype__Typehinting__aliastype__vector = list[float] Technically,Table__10-1is__sufficientas__aquick__previewand__reference,but__its__notquite__completeas__is.Here__area__fewfine__pointsabout__its content:Assignment__statementscome__ina__widevariety__ofsyntax__flavors,described__inChapter__11: basic, sequence, augmented,and__more;and__namedassignment__(:=)is__usedas__an expression,not__a statement.print__isreally__a built-infunction__call,and__neithera__reservedword__nora__statement.Because__itwill__nearlyalways__berun__asan__expression statement, though,and__usuallyon__aline__by itself,it__sgenerally__thoughtof__asa__statement type,and__willbe__treatedseparately__inChapter__11.yield__andawait__arealso__expressionsinstead__of statements.Like__print,they__reoften__usedas__expressionstatements__andso__areincluded__inthis__table,but__scriptsmay__alsoassign__orotherwise__usetheir__result,as__youll__seein__Chapter 20.As__expressions,yield__andawait__arealso__reserved words,unlike__print.Most__ofthe__wordsused__instatements__andexpressions__arereserved__andcannot__beused__asvariables__inyour__code;this__includes and, in, if, for, while,and__others.Newer__statementsuse__softreserved__wordsthat__arereserved__onlywhen__usedin__thestatements__towhich__they belong;this__includes match, case,and__type (thoughnot__asyncand__await).We__llformalize__thefull__listof__reservedwords__inChapter__11.A__Taleof__Twoifs__Beforewe__delveinto__thedetails__ofany__ofthe__concretestatements__inTable__10-1,this__bookwishes__tobegin__ourlook__atPython__statementsyntax__byshowing__youwhat__youare__notgoing__totype__inPython__code.Consider__thefollowing__if statement,coded__ina__C-like language:if__(x > y) {x__= 1;y__= 2; }This__mightbe__astatement__in C, C++, Java, JavaScript,or__similar. Now,look__atthe__equivalentstatement__inthe__Python language:if__x > y:x__= 1y__= 2The__firstthing__thatmay__popout__atyou__isthat__theequivalent__Pythonstatement__isless__clutteredthat__is,there__arefewer__syntactic components.This__isby__design;as__ascripting__language,one__ofPython__sgoals__isto__makeprogrammers__liveseasier__byrequiring__less typing.And__lesstyping__alsomeans__lessroom__for mistakes.More__specifically,when__youcompare__thetwo__syntax models,you__llnotice__thatPython__addsone__newthing__tothe__mixbut__removesthree__thingsthat__arerequired__in C-like languages.What__PythonAdds__Theone__newsyntax__componentin__Pythonis__thecolon__character (:).All__Pythoncompound__statementsstatements__thathave__otherstatements__nestedinside__themfollow__thesame__generalpattern__ofa__headerline__terminatedin__a colon,followed__bya__nestedblock__ofcode__usuallyindented__underneaththe__header line,like__this:Header__line:Nested__statementblock__Thecolon__is required,and__omittingit__isprobably__themost__commoncoding__mistakeamong__newPython__programmers (its__certainlyone__witnessedthousands__oftimes__livein__Pythontraining__classes).In__fact,if__youare__newto__Python,you__llalmost__certainlyforget__thecolon__charactervery__soon,if__youhaven__t already.You__llget__anerror__messageif__you do,and__most Python-friendlyeditors__makethis__mistakeeasy__to spot: >>>if__xif__x ^ SyntaxError:expected__':'Including__thecolon__eventuallybecomes__anunconscious__habitso__muchso__thatyou__maystart__typingcolons__inyour__C-likelanguage__code,too__(generatingreams__ofentertaining__errormessages__fromthat__languages__compiler!).What__PythonRemoves__AlthoughPython__requiresthe__extracolon__character,there__arethree__thingsprogrammers__in C-likelanguages__mustinclude__thatyou__dont__generallyhave__tocode__in Python.Parentheses__areoptional__Thefirst__ofthese__isthe__setof__parenthesesaround__thetests__atthe__topof__some statements:if__(x < y)The__parentheseshere__arerequired__bythe__syntaxof__many C-like languages.In__Python, though,they__arenot__wesimply__omitthe__parentheses,and__thestatement__worksthe__same way:if__x <y__Technically speaking,because__everyexpression__canbe__enclosedin__parentheses,including__themwill__nothurt__inthis__Python code,and__theyare__nottreated__asan__errorif__present.But__dont__do that.You__llbe__wearingout__yourkeyboard__needlessly,and__broadcastingto__theworld__thatyou__rea__programmerof__a C-likelanguage__stilllearning__Python (it happens).The__Pythonway__isto__simplyomit__theparentheses__inthese__kindsof__statements altogether. End-of-lineis__endof__statementThe__secondand__moresignificant__syntaxcomponent__youwon__tfind__inPython__codeis__the semicolon.You__dont__needto__terminatestatements__withsemicolons__inPython__theway__youdo__in C-like languages:x__= 1;In__Python,the__generalrule__isthat__theend__ofa__lineautomatically__terminatesthe__statementthat__appearson__that line.In__other words,you__canleave__offthe__semicolons,and__itworks__thesame__way:x__= 1There__aresome__waysto__workaround__this rule,as__youll__seein__amoment__(for instance,wrapping__codein__abracketed__structureallows__itto__span lines). But,in__general,you__writeone__statementper__linefor__thevast__majorityof__Python code,and__nosemicolon__is required. Here, too,if__youare__piningfor__yourC__programmingdays__(andwhy__would you?)you__cancontinue__touse__semicolonsat__theend__ofeach__statementthe__Pythonlanguage__letsyou__getaway__withthem__ifthey__are present,because__thesemicolon__isalso__aseparator__whenstatements__are combined.But__dont__dothat__either (really!). Again,doing__sotells__theworld__thatyou__rea__programmerof__a C-likelanguage__whostill__hasnt__quitemade__theswitch__toPython__coding.The__Pythonicstyle__isto__leaveoff__thesemicolons__altogether.Judging__fromstudents__in classes,this__seemsa__toughhabit__forsome__veteranprogrammers__to break.But__youll__get there;semicolons__areuseless__noisein__thisrole__in Python.End__ofindentation__isend__ofblock__Thethird__andfinal__syntaxcomponent__thatPython__removesand__theone__thatmay__seemthe__mostunusual__to soon-to-be-ex-programmersof__C-like languages,until__theyve__usedit__for 10minutes__andrealize__its__actuallya__feature...isthat__youdo__nottype__anythingexplicit__inyour__codeto__syntacticallymark__thebeginning__andend__ofa__nestedblock__of code.You__dont__needto__include begin/end, then/endif,or__{/}around__thenested__block,as__youdo__in C-like languages:if__(x > y) {x__= 1;y__= 2; } Instead,in__Python,we__consistentlyindent__allthe__statementsin__agiven__singlenested__blockthe__samedistance__tothe__right,and__Pythonuses__thestatements__physicalindentation__todetermine__wherethe__blockstarts__and stops:if__x > y:x__= 1y__= 2This__indentationmeans__theblank__whitespaceall__theway__tothe__leftof__thetwo__nestedstatements__here.Python__doesnt__carehow__youindent__(youmay__useeither__spacesor__tabs),or__howmuch__youindent__(youmay__useany__numberof__spacesor__tabs).In__fact,the__indentationof__onenested__blockcan__betotally__differentfrom__thatof__another.The__syntaxrule__isonly__thatfor__agiven__singlenested__block,all__ofits__statementsmust__beindented__thesame__distanceto__the right.If__thisis__notthe__case,you__willget__asyntax__error,and__yourcode__willnot__rununtil__yourepair__itsindentation__tobe__consistent: >>>if__True: ...a__= 1 ...b__= 2b__= 2 ^ IndentationError:unindent__doesnot__matchany__outerindentation__levelWhy__Indentation Syntax?The__indentationrule__mayseem__unusualat__firstglance__toprogrammers__accustomedto__C-like languages,but__itis__anintentional__featureof__Python:it__sone__ofthe__mainways__thatPython__almostforces__programmersto__produce uniform, regular,and__readable code.It__essentiallymeans__thatyou__mustline__upyour__code vertically,in__columns,according__toits__logical structure.The__neteffect__isto__makeyour__codemore__consistentand__readableunlike__muchof__thecode__writtenin__C-like languages.To__putthat__more strongly,aligning__yourcode__accordingto__itslogical__structureis__amajor__partof__makingit__readable,and__thusreusable__and maintainable,by__yourselfand__others.In__fact,even__ifyou__neveruse__Pythonafter__readingthis__book,you__shouldget__intothe__habitof__aligningyour__codefor__readabilityin__any block-structured__language.Python__underscoresthe__issueby__makingthis__apart__ofits__syntax,but__its__animportant__thingto__doin__anyprogramming__language,and__ithas__ahuge__impacton__theusefulness__ofyour__code.Your__experiencemay__vary,but__theres__acommon__phenomenonin__large,old__C++programs__thathave__beenworked__onby__manyprogrammers__overthe__years.Almost__invariably,each__programmerhas__hisor__herown__stylefor__indenting code.For__example,a__whileloop__codedin__the C++language__mayhave__begunits__tenurelike__this:while__(x > 0) {Before__weeven__getinto__indentation,there__arethree__orfour__waysthat__programmerscan__arrangethe__{}braces__ina__C-like language,and__organizationsoften__sufferpolitical__battlesand__standardsdocs__toaddress__theoptions__(whichseems__morethan__alittle__off-topicfor__theproblem__tobe__solvedby__programming).Be__thatas__it may,here__sthe__scenariooften__encounteredin__C++ code.The__firstperson__whoworked__onthe__codeindented__theloop__four spaces:while__(x > 0) { --------; --------;That__personeventually__movedon__toother__projects (or, sadly, management),only__tobe__replacedby__someonewho__likedto__indentfurther__tothe__right:while__(x > 0) { --------; --------; --------; --------;That__personlater__movedon__toother__opportunities (endingtheir__reignof__coding terror),and__someoneelse__pickedup__thecode__wholiked__toindent__less:while__(x > 0) { --------; --------; --------; --------; --------; --------; }And__so on. Eventually,the__blockis__terminatedby__aclosing__brace (}),which__ofcourse__makesthis__block-structuredcode__(yes, sarcasm). No:in__any block-structured__language,Python__or otherwise,if__nestedblocks__arenot__indented consistently,they__becomevery__difficultfor__thereader__to interpret, change,or__reuse,because__thecode__nolonger__visuallyreflects__itslogical__meaning.Readability__matters,and__indentationis__amajor__componentof__readability.Here__isanother__examplethat__mayhave__burnedyou__inthe__pastif__youve__donemuch__programmingin__a C-like language.Consider__thefollowing__statementin__C:if__(x)if__(y) statement1;else__statement2;Which__ifdoes__theelse__herego__with? Surprisingly,the__elseis__pairedwith__thenested__ifstatement__(if (y))in__C,even__thoughit__looksvisually__asthough__itis__associatedwith__theouter__test (if (x)).This__isa__classicpitfall__inthe__C language,and__itcan__leadto__thereader__completelymisinterpreting__thecode__andchanging__itincorrectly__inways__thatmight__notbe__uncovereduntil__theMars__rovercrashes__intoa__giant rock!This__cannothappen__inPython__becauseindentation__is significant,the__waythe__codelooks__isthe__wayit__will work.Consider__anequivalent__Python statement:if__x:if__y: statement1 else: statement2In__this example,the__ifthat__theelse__linesup__withvertically__andvisually__isthe__oneit__isassociated__withlogically__andbehaviorally__(theouter__if x).In__a sense,Python__isa__WYSIWYGlanguage__whatyou__seeis__whatyou__getbecause__theway__codelooks__isthe__wayit__runs,regardless__ofwho__coded it.If__thisstill__isnt__enoughto__underscorethe__benefitsof__Pythons__syntax,here__sanother__anecdote.Some__companiesthat__developsystems__softwarein__theC__language,where__consistentindentation__isnot__required,enforce__it anyhow.It__snot__toouncommon__forsuch__groupsto__runautomated__toolsthat__analyzethe__indentationused__in code,when__itis__checkedinto__sourcecontrol__systemsat__theend__ofthe__day.If__thetools__noticethat__youve__indentedyour__code inconsistently,you__mightjust__receivean__automatedemail__aboutit__thenext__morningand__somight__your manager!The__pointis__thateven__whena__languagedoesn__trequire__it,good__programmersknow__thatconsistent__useof__indentationhas__ahuge__impacton__codereadability__and quality.The__factthat__Pythonpromotes__thisto__thelevel__ofsyntax__isseen__bymost__asa__featureof__the language.Also__keepin__mindthat__nearlyevery__programmer-friendlytext__editorhas__built-insupport__forPython__ssyntax__model.In__theIDLE__GUI,for__example,lines__ofcode__areautomatically__indentedwhen__youare__typinga__nested block;pressing__theBackspace__keybacks__upone__levelof__indentation,and__youcan__customizehow__farto__theright__IDLEindents__statementsin__anested__block.There__isno__requirementon__this:four__spacesis__very common,but__its__upto__youto__decidehow__andhow__muchyou__wishto__indent (unlessyour__companyhas__enduredpolitics__anddocs__tostandardize__this too).Indent__furtherto__theright__forfurther__nested blocks,and__lessto__closethe__prior block.As__a caution, though,you__probablyshouldn__tmix__tabsand__spacesin__thesame__blockin__Python,unless__youdo__so consistently;use__tabsor__spacesin__agiven__block,but__notboth__(in fact,Python__issuesan__errorfor__inconsistentuse__oftabs__and spaces,as__youll__seein__Chapter 12).Then__again,you__probablyshouldn__tmix__tabsor__spacesin__indentationin__anystructured__languagesuch__codecan__causemajor__readabilityissues__ifthe__nextprogrammer__hasher__orhis__editorset__todisplay__tabsdifferently__than yours. C-likelanguages__mightlet__codersget__awaywith__this,but__theyreally__shouldn t:the__resultcan__bea__mangled mess.Regardless__ofwhich__languageyou__code in,you__shouldbe__indentingconsistently__for readability.In__fact,if__youweren__ttaught__todo__thisearlier__inyour__career,your__teachersdid__youa__disservice.Most__programmersespecially__thosewho__mustread__otherscode__considerit__anasset__thatPython__elevatesthis__tothe__levelof__syntax. Moreover,generating__tabsinstead__ofbraces__isno__moredifficult__inpractice__fortools__thatmust__outputPython__code,and__thepage__breaksthat__canobscure__codenesting__inthe__printversions__ofbooks__(includingthis__one!)will__notbe__presentin__thereal__worldof__coding.In__sum,if__youdo__whatyou__shouldbe__doingin__a C-likelanguage__anyhow,but__getrid__ofthe__braces,your__codewill__satisfyPython__ssyntax__rules.A__FewSpecial__CasesAs__mentioned previously,in__Pythons__syntax model:The__endof__aline__terminatesthe__statementon__thatline__(without semicolons).Nested__statementsare__blockedand__associatedby__theirphysical__indentation (without braces).Those__rulescover__almostall__Pythoncode__youll__writeor__seein__practice. However,Python__alsoprovides__some special-purposerules__thatallow__forflexibility__inboth__statementsand__nestedstatement__blocks.They__renot__requiredand__shouldbe__used sparingly,but__programmershave__foundthem__usefulin__practice.Statement__rulespecial__casesThere__arethree__specialrules__for statements,two__ofwhich__havealready__beenintroduced__andused__inthis__book.First__of all,although__statementsnormally__appearone__per line,it__ispossible__tosqueeze__morethan__onestatement__ontoa__singleline__inPython__byseparating__themwith__semicolons:a__= 1;b__= 2; print(a + b) #Three__statementson__oneline__Thisis__theonly__placein__Pythonwhere__semicolonsare__required:as__statement separators.This__only works, though,if__thestatements__thuscombined__arenot__themselvescompound__statements.In__other words,you__canchain__togetheronly__simple statements,like__assignments,and__callsto__printand__otherfunctions__and methods.Compound__statementslike__iftests__andwhile__loopsmust__stillappear__onlines__oftheir__own (otherwise,you__couldsqueeze__anentire__programonto__one line,which__probablywould__notmake__youvery__popularamong__your coworkers!).The__otherspecial__rulefor__statementsis__essentiallythe__inverse:you__canmake__asingle__statementspan__acrossmultiple__lines.To__makethis__work,you__simplyhave__toenclose__partof__yourstatement__ina__bracketedpair__parentheses (()),square__brackets ([]),or__curlybraces__({}).Any__codeenclosed__inthese__constructscan__crossmultiple__lines:your__statementdoesn__tend__untilPython__reachesthe__linecontaining__theclosing__partof__the pair.For__instance,to__continuea__list literal:mylist__= [1111, #Continuation__lines 2222, #Any__codein__(), [], {} 3333]Because__thiscode__isenclosed__ina__squarebrackets__pair,Python__simplykeeps__readingon__thenext__lineuntil__itencounters__theclosing__bracket.The__curlybraces__surroundingdictionaries__(aswell__asset__literalsand__dictionaryand__set comprehensions)allow__themto__spanlines__this way, too,and__parentheseshandle__tuples,function__calls,and__expressions.The__indentationof__thecontinuation__linesdoes__not matter,though__commonsense__dictatesthat__thelines__shouldbe__alignedsomehow__for readability.Any__#comments__areignored__asusual__incontinuation__lines too,and__nestedbrackets__mustall__beclosed__beforethe__continuation-linerun__ends.Parentheses__arethe__catchalldevice__becauseany__expressioncan__bewrapped__in them,simply__insertinga__leftparenthesis__allowsyou__todrop__downto__thenext__lineand__continueyour__statement:X__= (A +B__+C__+ D)This__techniqueworks__withincompound__statements, too,by__the way.Anywhere__youneed__tocode__alarge__expression,simply__wrapit__inparentheses__tocontinue__iton__thenext__line:if__(A == 1and__B == 2and__C == 3): print('hack' * 3)An__olderrule__alsoallows__forcontinuation__lineswhen__theprior__lineends__ina__backslash:X__=A__+B__+ \C__+D__#An__error-proneolder__alternativeThis__alternativetechnique__issomewhat__discouragedtoday__becauseit__sdifficult__tonotice__andmaintain__the backslashes.It__salso__fairlybrittle__and error-pronethere__canbe__nospaces__or #comments__afterthe__backslash,and__accidentallyomitting__itcan__haveunexpected__effectsif__thenext__lineis__mistakento__bea__newstatement__(inthis__example,C__+D__isa__validstatement__byitself__ifit__snot__indentedand__wouldsilently__berun__as such).This__ruleis__alsoa__throwbackto__theC__language,where__itis__commonlyused__in #define macros.While__\may__beoccasionally__useful,when__in Pythonland,do__asPythoneers__do:use__bracketedpairs__insteadof__\as__a rule.Block__rulespecial__caseAs__mentioned previously,statements__ina__nestedblock__ofcode__arenormally__associatedby__beingindented__thesame__amountto__the right.As__onespecial__case here,and__anotherwe__metin__earlier chapters,the__bodyof__acompound__statementcan__insteadappear__onthe__sameline__asthe__headerin__Python,after__the colon:if__x > y: print(x)This__allowsus__tocode__single-lineif__statements, single-linewhile__andfor__loops,and__so on.Much__like ; separators, though,this__willwork__onlyif__thebody__ofthe__compoundstatement__itselfdoes__notcontain__anycompound__statements.That__is,only__simplestatements__assignments,calls__toprint__and others,and__thelike__areallowed__afterthe__colon.Larger__statementsmust__stillappear__onlines__by themselves.Extra__partsof__compoundstatements__(suchas__theelse__partof__an if,which__youll__meetin__thenext__section)must__alsobe__onseparate__linesof__their own.Compound__statementbodies__canalso__consistof__multiplesimple__statementsseparated__by semicolons,but__thistends__tobe__frowned upon.In__general,even__thoughit__snot__always required,if__youkeep__mostof__yourstatements__onindividual__linesand__indentyour__nestedblocks__asa__norm,your__codewill__beeasier__toread__andchange__inthe__future. Moreover,some__codeprofiling__andcoverage__toolsmay__notbe__ableto__distinguishbetween__multiplestatements__squeezedonto__asingle__line,or__theheader__andbody__ofa__one-linecompound__statement.It__isalmost__alwaysto__youradvantage__tokeep__thingssimple__in Python.You__canuse__the special-caseexceptions__towrite__Pythoncode__thats__hardto__read,but__ittakes__alot__of work,and__thereare__probablybetter__waysto__spendyour__time.To__seea__primeand__commonexception__toone__ofthese__rulesin__action,however__(theuse__ofa__single-lineif__statementto__breakout__ofa__loop),and__tointroduce__moreof__Pythons__syntax,let__smove__onto__thenext__sectionand__writesome__real code.A__Quick Example:Interactive__LoopsYou__llsee__allthese__syntaxrules__inaction__whenwe__tourPython__sspecific__compoundstatements__inthe__nextfew__chapters,but__theywork__thesame__everywherein__thePython__language.To__get started,let__swork__througha__briefbut__realisticexample__thatdemos__theway__thatstatement__syntaxand__nestingcome__togetherand__introducesa__fewstatements__alongthe__way.To__work along,either__copyand__pastethis__sections__examplesfrom__emediainto__yourREPL__orrun__themfrom__thefile__interact.pylocated__inthis__books__examplespackage__usingany__ofthe__launchtools__westudied__inChapter__3.A__SimpleInteractive__LoopSuppose__youre__askedto__writea__Pythonprogram__thatinteracts__witha__userin__aconsole__window.Maybe__youre__acceptinginputs__tosend__toa__databaseor__readingnumbers__tobe__usedin__a calculation.Regardless__ofthe__purpose,you__needto__codea__loopthat__readsone__ormore__inputsfrom__auser__typingon__akeyboard__andprints__backa__resultfor__each.In__other words,you__needto__writea__classic read/evaluate/printloop__program,similar__toPython__sstandard__REPL.In__Python,typical__boilerplatecode__forsuch__aninteractive__loopmight__looklike__this:while__True:reply__= input('Enter text:')if__reply == 'stop':break__print(reply.upper())This__codemakes__useof__afew__newideas__andsome__weve__already explored:The__codeleverages__thePython__while loop,Python__smost__generallooping__statement.We__llstudy__thewhile__statementin__moredetail__later,but__in short,it__consistsof__theword__while,followed__byan__expressionthat__isinterpreted__asa__trueor__false result,followed__bya__nestedblock__ofcode__thatis__repeatedwhile__thetest__atthe__topis__true.The__wordTrue__hereis__consideredalways__true,so__thisloop__continues forever,unless__somehow stopped.The__input built-infunction__wemet__earlierin__thebook__(tokeep__windowsopen__afterclicks__inChapter__3and__theAppendix__Acoverage__it referenced)is__usedhere__forgeneral__consoleinput__itprints__itsoptional__argumentstring__asa__promptand__returnsthe__users__typedreply__asa__string.A__single-lineif__statementthat__makesuse__ofthe__specialrule__fornested__blocksalso__appears here:the__bodyof__theif__appearson__theheader__lineafter__thecolon__insteadof__beingindented__ona__newline__underneath it.This__wouldwork__either way,but__asit__s coded,we__vesaved__anextra__line. Finally,the__Pythonbreak__statementis__usedto__exitthe__loopimmediately__itsimply__jumpsout__ofthe__loopstatement__altogether,and__theprogram__continuesafter__the loop.Without__thisexit__statement,the__whilewould__loop forever,as__itstest__isalways__true.In__effect,this__combinationof__statementsessentially__meansread__aline__fromthe__userand__printit__inuppercase__untilthe__userenters__theword__stop.There__areother__waysto__codesuch__aloop__(e.g.,see__thenote__ahead),but__theform__usedhere__isvery__commonin__Pythoncode__andserves__toillustrate__syntax basics.Notice__thatall__threelines__nestedunder__thewhile__headerline__areindented__thesame__amount:because__theyline__upvertically__ina__columnthis__way,they__arethe__blockof__codethat__isassociated__withthe__whiletest__and repeated.Either__a lesser-indented__statementor__theend__ofthe__sourcefile__(as here)will__sufficeto__terminatethe__loopbody__block.When__thiscode__is run,either__interactivelyor__asa__script file,here__isthe__sortof__interactionwe__get:Enter__text:pythonPYTHON__Enter text:312 312Enter__text:stopNOTE__Orcrunch__codewith__the := operator:Spoiler__alertthis__sections__codeis__traditionaland__simpleand__worksas__asyntax__demo,but__its__possibleto__reduceit__fromfour__linesto__twowith__the := named-assignmentexpression__addedin__Python 3.8and__coveredin__thenext__chapter.This__expressionassigns__aname__toanother__expressions__result,but__alsoreturns__theassigned__valueas__itsoverall__result.The__neteffect__letsus__fetch, assign,and__testinput__onthe__sameline__andall__inthe__loops__header:while__(reply := input('Enter text:')) != 'stop': print(reply.upper())While__usefulin__narrow roles,this__expressionalso__requiresnested__parenthesesin__thiscontext__andis__arguablymore__implicitthan__traditionalforms__(though ex-Cprogrammers__mileagemay__vary!).Doing__Mathon__UserInputs__Ourscript__works,but__nowsuppose__thatinstead__ofconverting__atext__stringto__uppercase,we__wantto__dosome__mathwith__numericinput__squaring it,for__example (perhapsin__somemisguided__effortof__an age-inputprogram__totease__its users).We__mighttry__statementslike__theseto__achievethe__desired effect: >>>reply__= '40' >>>reply__** 2 TypeError:unsupported__operand type(s)for__**or__pow(): 'str'and__'int'This__wont__quitework__inour__script, though:input__froma__useris__alwaysreturned__asa__string,and__asdiscussed__inthe__priorpart__ofthis__book,Python__wont__convertobject__typesin__expressionsunless__theyare__all numeric.We__cannotraise__astring__ofdigits__toa__powerunless__weconvert__itmanually__toan__integer: >>> int(reply) ** 2 1600Armed__withthis__information,we__cannow__recodeour__loopto__performthe__necessary math.Type__thefollowing__ina__fileto__runit__withcommand__line,IDLE__menu options,or__anyother__techniquewe__metin__Chapter 3 (theREPL__bothrequires__ablank__lineafter__the while,and__runsjust__onestatement__ata__timethe__finalprint__herewouldn__tmake__sense):while__True:reply__= input('Enter text:')if__reply == 'stop':break__print(int(reply) ** 2) print('Bye')This__scriptuses__a single-lineif__statementto__exiton__stopas__before,but__italso__convertsinputs__toperform__therequired__math.This__versionalso__addsan__exitmessage__atthe__bottom.Because__theprint__statementin__thelast__lineis__notindented__asmuch__asthe__nestedblock__of code,it__isnot__consideredpart__ofthe__loopbody__andwill__runonly__once,after__theloop__is exited:Enter__text:2 4Enter__text:40 1600Enter__text:stopBye__HandlingErrors__byTesting__InputsSo__farso__good,but__noticewhat__happenswhen__theinput__is invalid:Enter__text:xxx ValueError:invalid__literalfor__int()with__base 10: 'xxx'The__built-inint__functionraises__anexception__(i.e.,flags__an error)here__inthe__faceof__a nonnumber.If__wewant__ourscript__tobe__robust,we__cancheck__thestring__scontent__aheadof__timewith__thestring__objects__isdigit method: >>>S__= '40' >>>T__= 'xxx' >>> S.isdigit(), T.isdigit() (True, False)This__alsogives__usan__excuseto__furthernest__thestatements__inour__example.The__followingnew__versionof__ourinteractive__scriptuses__a full-blownif__statementto__workaround__theexception__onconversion__errors:while__True:reply__= input('Enter text:')if__reply == 'stop':break__elifnot__reply.isdigit(): print('Bad!' * 8) else: print(int(reply) ** 2) print('Bye')We__llstudy__theif__statementin__moredetail__inChapter__12,but__its__afairly__lightweighttool__forcoding__logicin__scripts.In__itsfull__form,it__consistsof__theword__iffollowed__bya__testand__anassociated__blockof__code;one__ormore__optionalelif__(else__if )tests__andcode__blocks;and__anoptional__elsepart__witha__blockof__codeat__thebottom__toserve__asa__default.Python__runsthe__blockof__codeassociated__withthe__firsttest__thatis__true,working__fromtop__to bottom,or__theelse__partif__alltests__are false.The__if, elif,and__elseparts__inthe__precedingexample__areassociated__aspart__ofthe__samestatement__becausetheir__openingwords__allline__upvertically__(i.e.,share__thesame__levelof__indentation).The__ifstatement__spansfrom__theword__ifto__justbefore__theprint__statementon__thelast__lineof__the script.In__turn,the__entireif__blockis__partof__thewhile__loopbecause__allof__itis__indentedunder__theloop__sheader__line.Statement__nestinglike__thisis__naturalonce__youstart__using it.When__werun__ournew__script,its__codecatches__errorsbefore__theyoccur__andprints__anerror__messagebefore__continuing (whichyou__llprobably__wantto__improvebefore__thiscode__ishanded__overto__the quality-assurance team),but__stopstill__getsus__out,and__validnumbers__arestill__squared:Enter__text:5 25Enter__text:xxx Bad!Bad!Bad!Bad!Bad!Bad!Bad!Bad!Enter__text:10 100Enter__text:stopBye__HandlingErrors__withtry__StatementsThe__precedingsolution__works,but__asyou__llsee__laterin__the book,the__mostgeneral__wayto__handleerrors__inPython__isto__catchand__recoverfrom__themcompletely__usingthe__Pythontry__statement.We__llexplore__thisstatement__indepth__inPart__VIIof__this book,but__asa__preview,using__atry__herecan__leadto__codethat__somemight__seeas__simplerthan__theprior__version:while__True:reply__= input('Enter text:')if__reply == 'stop':break__try:num__= int(reply) except: print('Bad!' * 8) else: print(num ** 2) print('Bye')This__versionworks__exactlylike__theprevious__one,but__weve__replacedthe__expliciterror__checkwith__codethat__assumesthe__conversionwill__workand__wrapsit__inan__exceptionhandler__forcases__whenit__doesn t.In__other words,rather__thandetecting__an error,we__simplyrespond__ifone__occurs.This__trystatement__isanother__compoundstatement__andfollows__thesame__patternas__ifand__while.It__scomposed__ofthe__word try,followed__bythe__mainblock__ofcode__(theaction__weare__tryingto__run),followed__byan__exceptpart__thatgives__theexception__handlercode__andan__elsepart__tobe__runif__noexception__israised__inthe__try part.Python__firstruns__thetry__part,then__runseither__theexcept__part (ifan__exception occurs)or__theelse__part (ifno__exception occurs).In__termsof__statement nesting,because__thewords__try, except,and__elseare__allindented__tothe__same level,they__areall__consideredpart__ofthe__samesingle__try statement.Notice__thatthe__elsepart__isassociated__withthe__try here,not__the if.As__weve__seen,else__canappear__inif__statementsin__Python,but__itcan__alsoappear__intry__statementsand__loopsits__indentationtells__youwhat__statementit__isa__part of.In__this case,the__trystatement__spansfrom__theword__trythrough__thecode__indentedunder__theword__else,because__theelse__isindented__thesame__as try.The__ifstatement__inthis__codeis__a one-linerand__endsafter__the break,so__theelse__cannotapply__to it.Supporting__Floating-PointNumbers__Again,we__llcome__backto__thetry__statementlater__inthis__book.For__now,be__awarethat__becausetry__canbe__usedto__interceptany__error,it__reducesthe__amountof__error-checkingcode__youhave__to write,and__its__avery__generalapproach__todealing__withunusual__cases.If__were__surethat__printwon__t fail,for__instance,this__examplecould__beeven__more concise:while__True:reply__= input('Enter text:')if__reply == 'stop':break__try: print(int(reply) ** 2) except: print('Bad!' * 8) print('Bye')And__ifwe__wantedto__supportinput__of floating-pointnumbers__insteadof__just integers,for__example,using__trywould__bemuch__easierthan__manualerror__testingwe__couldsimply__runa__floatcall__andcatch__its exceptions:while__True:reply__= input('Enter text:')if__reply == 'stop':break__try: print(float(reply) ** 2) except: print('Bad!' * 8) print('Bye')There__isno__isfloatmethod__forstrings__today,so__this exception-basedapproach__sparesus__fromhaving__toaccommodate__allpossible__floating-pointsyntax__inan__up-fronterror__check (anontrivial__task,given__themany__facesof__floats!).When__codedthis__way,we__canenter__awider__varietyof__numbers,but__errorsand__exitsstill__workas__before:Enter__text:50 2500.0Enter__text:40.5 1640.25Enter__text:1.23E-100 1.5129e-200Enter__text:hack Bad!Bad!Bad!Bad!Bad!Bad!Bad!Bad!Enter__text:stopBye__NOTEOr__runanything__witheval__and exec:Python__s built-ineval__call,which__weused__inChapters__5and__9to__convertdata__instrings__and files,would__workin__placeof__float here, too,and__wouldallow__inputof__arbitraryexpressions__( 2 ** 100would__bea__legal,if__curious, input,especially__ifwe__reassuming__theprogram__isprocessing__ages!).This__isa__powerfulconcept__thatis__opento__thesame__securityissues__mentionedin__theprior__chapters.If__youcan__ttrust__thesource__ofa__code string,use__morefocused__andrestrictive__conversiontools__likeint__and float.Python__s exec,used__inChapter__3to__runcode__readfrom__a file,is__similarto__eval (butassumes__thestring__isa__statementinstead__ofan__expressionand__hasno__result),and__itscompile__callprecompiles__frequentlyused__codestrings__tobytecode__objectsfor__speed.Run__ahelp__onany__ofthese__formore__details.We__llalso__useexec__toimport__modulesby__namestring__inChapter__25an__exampleof__itsmore__dynamic roles.Nesting__CodeThree__LevelsDeep__Lets__lookat__onelast__mutationof__our code.Nesting__cantake__useven__furtherif__weneed__itto__we could,for__example,extend__ourprior__integer-onlyscript__tobranch__toone__ofa__setof__alternativesbased__onthe__relativemagnitude__ofa__valid input:while__True:reply__= input('Enter text:')if__reply == 'stop':break__elifnot__reply.isdigit(): print('Bad!' * 8) else:num__= int(reply)if__num < 20: print('low') else: print(num ** 2) print('Bye')This__versionadds__anif__statementnested__inthe__elseclause__ofanother__if statement,which__isin__turnnested__inthe__while loop.When__codeis__conditionalor__repeatedlike__this,we__simplyindent__itfurther__tothe__right.The__neteffect__islike__thatof__prior versions,but__well__nowprint__lowfor__numbersless__than 20:Enter__text:19low__Enter text:20 400Enter__text:hack Bad!Bad!Bad!Bad!Bad!Bad!Bad!Bad!Enter__text:stopBye__ChapterSummary__Thatconcludes__ourfirst__lookat__Pythonstatement__syntax.This__chapterintroduced__thegeneral__rulesfor__codingstatements__andblocks__of code.As__youve__learned,in__Pythonwe__normallycode__onestatement__perline__andindent__allthe__statementsin__anested__blockthe__sameamount__(indentationis__partof__Pythons__syntax). However,we__alsolooked__ata__fewexceptions__tothese__rules,including__continuationlines__and single-linetests__and loops. Finally,we__putthese__ideasto__workin__aninteractive__scriptthat__demonstrateda__handfulof__statementsand__showedstatement__syntaxin__action.In__thenext__chapter,we__llstart__todig__deeperby__goingover__eachof__Pythons__basicprocedural__statementsin__depth.As__youll__see, though,all__statementsfollow__thesame__generalrules__introduced here.Test__Your Knowledge:Quiz__1.What__threethings__arerequired__ina__C-likelanguage__butomitted__in Python? 2.How__isa__statementnormally__terminatedin__Python? 3.How__arethe__statementsin__anested__blockof__codenormally__associatedin__Python? 4.How__canyou__makea__singlestatement__spanmultiple__lines? 5.How__canyou__codea__compoundstatement__ona__single line? 6.Is__thereany__validreason__totype__asemicolon__atthe__endof__astatement__in Python? 7.What__isa__trystatement__for? 8.What__isthe__mostcommon__codingmistake__amongPython__beginners?Test__Your Knowledge:Answers__1. C-likelanguages__requireparentheses__aroundthe__testsin__some statements,semicolons__atthe__endof__each statement,and__bracesaround__anested__blockof__code.Python__requiresnone__ofthese__(butadds__a :). 2.The__endof__aline__terminatesthe__statementthat__appearson__that line. Alternatively,if__morethan__onestatement__appearson__thesame__line,they__canbe__separatedwith__semicolons; similarly,if__astatement__spansmany__lines,you__mustterminate__itby__closinga__bracketedsyntactic__pair. 3.The__statements (code lines)in__anested__blockare__allindented__thesame__numberof__tabsor__spaces. 4.You__canmake__astatement__spanmany__linesby__enclosingpart__ofit__in parentheses,square__brackets,or__curly braces;the__statementends__whenPython__seesa__linethat__containsthe__closingpart__ofthe__pair. 5.The__bodyof__acompound__statementcan__bemoved__tothe__headerline__afterthe__colon,but__onlyif__thebody__consistsof__onlynoncompound__statements. 6.Only__whenyou__needto__squeezemore__thanone__statementonto__asingle__lineof__code.Even__then,this__worksonly__ifall__thestatements__are noncompound,and__its__discouragedbecause__itcan__leadto__codethat__isdifficult__to read. 7.The__trystatement__isused__tocatch__andrecover__fromexceptions__(errors)in__aPython__script.It__soften__analternative__tomanually__checkingfor__errorsin__code. 8.Forgetting__totype__thecolon__characterat__theend__ofthe__headerline__ina__compoundstatement__isthe__mostcommon__beginners__mistake.If__youre__newto__Pythonand__havent__madeit__yet,you__probablywill__soon!Chapter__11. Assignments, Expressions,and__PrintsNow__thatwe__vehad__afirst__introductionto__Pythonstatement__syntax,this__chapterbegins__our in-depthtour__ofspecific__Python statements.We__llbegin__withthe__basics:assignment__statements,expression__statements,and__print operations.We__vealready__seenall__ofthese__in action,but__herewe__llfill__inimportant__detailswe__veskipped__so far.Although__theyre__relatively simple,as__youll__see,there__areoptional__variationsfor__eachof__thesestatement__typesthat__willcome__inhandy__onceyou__beginwriting__realisticPython__programs.Assignments__Weve__beenusing__thePython__assignmentstatement__fora__whileto__retainobjects__in examples.In__itsbasic__form,you__writethe__targetof__anassignment__onthe__leftof__anequals__sign,and__theobject__tobe__assignedon__the right.The__targeton__theleft__maybe__aname__orobject__component,and__theobject__onthe__rightcan__bean__arbitraryexpression__thatcreates__an object.For__themost__part,assignments__are straightforward,but__hereare__afew__keyproperties__tonote__up front:Assignments__createobject__references.As__discussedin__Chapter 6,Python__assignmentsstore__referencesto__objectsin__namesor__datastructure__components.They__alwayscreate__referencesto__objectsinstead__ofcopying__the objects.Because__of that,Python__variablesare__morelike__pointersthan__datastorage__areas.Names__arecreated__whenfirst__assigned.Python__createsa__variablename__thefirst__timeyou__assignit__avalue__(i.e.,an__object reference),so__theres__noneed__topredeclare__namesahead__of time.Some__(butnot__all)data__structureslots__arecreated__when assigned,too__(e.g.,dictionary__entries,some__object attributes).Once__assigned,a__nameis__replacedwith__thevalue__itreferences__wheneverit__appearsin__an expression.Names__mustbe__assignedbefore__being referenced.It__san__errorto__usea__nameto__whichyou__havent__yetassigned__a value.Python__raisesan__exceptionif__you try,rather__thanreturning__somesort__ofambiguous__default value.This__turnsout__tobe__crucialin__Pythonbecause__namesare__notpredeclared__ifPython__provideddefault__valuesfor__unassignednames__usedin__yourprogram__insteadof__treatingthem__as errors,it__wouldbe__muchmore__difficultfor__youto__spotname__typosin__your code.Some__operationsperform__assignments implicitly.In__this section,we__reconcerned__withthe__=statement__andits__:=expression__relative,but__assignmentoccurs__inmany__contextsin__Python.For__instance,you__llsee__laterthat__module imports,function__andclass__definitions,for__loop variables,and__functionarguments__areall__implicit assignments.Because__assignmentworks__thesame__everywhereit__pops up,all__thesecontexts__simplybind__(i.e., assign)names__andobject__componentsto__objectreferences__at runtime.With__thosepreliminaries__in hand,let__smove__onto__the code.Assignment__SyntaxForms__Althoughassignment__isa__generaland__pervasiveconcept__in Python,in__thischapter__weare__primarilyinterested__inassignment__statements,plus__onelimited__expression.Table__11-1illustrates__thedifferent__syntaxforms__availablefor__codingassignments__in Python.Table__11-1.Assignment__statementand__expressionforms__OperationInterpretation__target = 'Hack'Basic__assignment code,hack__= 'py', 'PY'Tuple__assignment [code, hack] = ['py', 'PY']List__assignment a, b, c,d__= 'hack'Sequence__assignment a, *b = 'hack' Extended-unpackingassignment__code =hack__= 'python' Multiple-targetassignment__code += 1,hack__*= 2Augmented__assignments (python := 3.12) + 0.01Named__assignmentexpression__Thebasic__formatop__Table 11-1is__byfar__themost__common:binding__asingle__target (aname__ordata__structure component)to__asingle__object (anexpression__result).In__fact,you__couldget__allyour__workdone__withthis__form alone.The__othertable__entriesrepresent__formsthat__areall__optional,but__thatprogrammers__oftenfind__convenientin__practice:Tuple__andlist__assignmentsThe__secondand__thirdforms__inthe__tableare__related.When__youcode__atuple__orlist__onthe__leftside__ofthe__=,Python__pairsobjects__onthe__rightside__withtargets__onthe__leftby__positionand__assignsthem__fromleft__to right.For__example,in__thesecond__lineof__Table 11-1,both__sidesare__tuples (sans parentheses),and__thenames__codeand__hackare__assigned 'py'and__'PY', respectively.The__leftof__the =is__specialsyntax__butthe__rightis__areal__object,which__iswhy__thisis__calledunpacking__assignmentcomponents__onthe__rightare__unpackedinto__targetson__the left.Sequence__assignmentTuple__andlist__assignmentswere__latergeneralized__intoinstances__ofwhat__wenow__callsequence__assignmentany__sequenceof__targetscan__beassigned__toany__sequence (really, iterable)of__values,and__Pythonassigns__theitems__oneat__atime__by position.We__caneven__mixand__matchthe__typesof__thesequences__involved.The__fourthline__inTable__11-1,for__example,pairs__atuple__ofnames__witha__stringof__characters:a__isassigned__'h',b__isassigned__'a',and__so on.Despite__this flexibility,the__itemon__theleft__ofthe__=is__stilla__tupleor__listof__assignment targets. Extended-unpackingassignment__Aneven__laterassignment__formallows__moreflexibility__inhow__weassign__portionsof__asequence__orother__iterableto__asequence__of targets.The__fifthline__inTable__11-1,for__example,matches__awith__thefirst__characterin__thestring__onthe__right,and__thestarred__nameb__withthe__rest:a__isassigned__'h',and__bis__assigned ['a', 'c', 'k'].This__providesan__alternativeto__assigningthe__resultsof__slicing operations.Starred__collectorslike__thishave__alsosomewhat__usurpedthe__term unpacking,though__thisis__anartifact__morehistorical__than technical. Multiple-targetassignment__Thesixth__linein__Table 11-1shows__the multiple-targetform__of assignment.In__this form,Python__assignsa__referenceto__thesame__object (theobject__farthestto__the right)to__allthe__targetson__the left.In__the table,the__namescode__andhack__areboth__assignedreferences__tothe__samestring__object, 'python'.The__effectis__thesame__asif__wehad__runhack__= 'python'followed__bycode__= hack,as__hackevaluates__tothe__originalstring__object (i.e.,not__aseparate__copyof__that object).Augmented__assignmentsThe__second-to-lastline__inTable__11-1is__anexample__ofaugmented__assignmenta__shorthandthat__combinesan__expressionand__anassignment__ina__concise way.Saying__code += 1,for__example,has__thesame__effectas__code =code__+ 1,but__theaugmented__formrequires__lesstyping__andis__generallyquicker__to run.In__addition,if__thetarget__ofthe__assignmentis__mutable,an__augmentedassignment__mayrun__evenquicker__bychoosing__an in-placeupdate__operationinstead__ofan__object copy.As__youll__see,there__isone__augmentedassignment__statementfor__mostbinary__expressionoperators__inPython__(eventhe__unused @!).Named__assignmentexpression__Newin__Python 3.8,the__:=operator__allowsyou__tocode__assignmentas__an expression,which__returnsthe__valueit__assignsto__a name.This__expressioncan__benested__inplaces__whereassignment__statementsdon__twork__syntactically,and__incommon__rolesallows__youto__bothassign__aname__anduse__itsvalue__inthe__sameplace__inyour__code.Basic__AssignmentsLet__sturn__toexamples__atthe__REPLprompt__as usual.We__vealready__usedTable__11-1s__basicassignment__inthis__book,so__youshould__befamiliar__withits__basics.In__short,it__assignsa__singletarget__toa__single value,where__thetarget__maybe__a name, index, slice,or__attribute,and__thevalue__isany__expression: $ python3 >>>L__= [1, 2] #Name__target >>> L[0] = 3 #Index__target >>> L[-1:] = [4, 5] #Slice__target >>>L__[3, 4, 5]Attribute__targetscrop__upfor__classes;we__havent__studiedthese__yet,but__theassignment__is straightforward: object.attr =L__#Attribute__target (seePart__VI)Though__namesare__commonand__dominateexamples__here,any__ofthese__fourtypes__ofassignment__targetscan__beused__inany__formof__assignment,except__wherenoted__ahead (namedassignment__expressions,for__example,allow__only names).NOTE__Name annotations:Basic__assignmentstatements__canalso__havean__annotationexpression__introducedby__acolon__immediatelyafter__thetarget__onthe__left.This__statementform__allowsonly__asingle__target,and__isused__fortype__hinting,described__nearthe__endof__Chapter 6.As__noted there,because__thisis__optional, convoluted,completely__unusedby__Python,and__fundamentallyat__oddswith__thelanguage__score__idiom,we__reskipping__itin__this book.See__Pythons__docsfor__moredetails__ifyou__everstumble__inthe__wildonto__thecurious__caseof__typedeclarations__ina__dynamicallytyped__language.Sequence__AssignmentsNext__up,here__area__fewsimple__andcomparable__examplesof__tupleand__listassignment__(a.k.a.sequence__assignment)in__action,unpacking__itemsinto__individual variables: >>>first__= 1 #Basic__assignment >>>second__= 2 >>> A,B__= first,second__#Tuple__assignment >>> A,B__#Similar__toA__= first;B__=second__(1, 2) >>> [C, D] = [first, second] #List__assignment >>> C,D__(1, 2)Notice__thatwe__reallyare__codingtwo__tuplesin__thethird__linein__thisinteraction__weve__justomitted__theirenclosing__parentheses.Python__pairsthe__valuesin__thetuple__onthe__rightside__ofthe__assignmentoperator__withthe__variablesin__thetuple__onthe__leftside__andassigns__thevalues__oneat__a time.The__samegoes__when =is__surroundedby__lists.Tuple__assignmentleads__toa__commoncoding__trickin__Pythonthat__wasintroduced__ina__solutionto__theexercises__atthe__endof__Part II.Because__Pythoncreates__atemporary__tuplethat__savesthe__originalvalues__ofthe__variableson__theright__whilethe__statement runs,unpacking__assignmentsare__alsoan__easyway__toswap__twovariables__valueswithout__creatinga__temporaryvariable__ofyour__ownthe__tupleon__theright__remembersthe__priorvalues__ofthe__variables automatically: >>>first__= 1 >>>second__= 2 >>> first,second__= second,first__# Tuples:swaps__values >>> first,second__#Like__T = first;first__= second;second__=T__(2, 1)As__already noted,the__originaltuple__andlist__assignmentforms__inPython__wereeventually__generalizedto__acceptany__typeof__sequence (really, iterable)on__theright__aslong__asit__isof__thesame__lengthas__thesequence__onthe__left.You__canassign__atuple__ofvalues__toa__listof__variables,a__stringof__charactersto__atuple__of variables,and__so on.In__all cases,Python__assignsitems__inthe__sequenceon__theright__totargets__inthe__sequenceon__theleft__byposition__fromleft__to right: >>> [a, b, c] = (1, 2, 3) #Assign__tupleof__valuesto__listof__names >>> a,c__(1, 3) >>> (a, b, c) = 'ABC' #Assign__stringof__charactersto__tuplenames__>>> a,c__('A', 'C')More__broadly,while__theleft__sideof__asequence__assignmentis__stilla__sequence (atuple__orlist__of targets),the__rightside__maybe__anyiterable__object,not__justany__sequence.This__isa__moregeneral__categorythat__includescollections__bothphysical__(e.g., lists)and__virtual (e.g.,a__files__lines),which__wasfirst__definedin__Chapter 4and__haspopped__upin__passingever__since.We__llfirm__upthis__termwhen__weexplore__iterablesin__Chapters 14and__20,and__applyit__tounpack__arange__iterablein__thenext__section.For__now,the__sequencein__assignmentis__bestassociated__withwhat__son__theleft__ofthe__=.Advanced__sequence-assignmentpatterns__Althoughwe__canmix__andmatch__sequencetypes__aroundthe__= symbol,we__mustgenerally__havethe__samenumber__ofitems__onthe__rightas__wehave__targetson__the left,or__well__getan__error.As__youll__seein__thenext__section,Python__allowsus__tobe__moregeneral__with extended-unpacking * syntax,but__thenumber__ofitems__inthe__assignmenttarget__andsubject__mustnormally__match: >>>string__= 'TEXT' >>> a, b, c,d__=string__#Same__numberon__bothsides__>>> a, b, c,d__('T', 'E', 'X', 'T') >>> a, b,c__=string__#Error__ifnot__ValueError:too__manyvalues__tounpack__(expected 3)To__bemore__flexible,we__canalways__slice.There__area__varietyof__waysto__employslicing__tomake__thislast__case work: >>> a, b,c__= string[0], string[1], string[2:] #Index__andslice__>>> a, b,c__# a, b,c__= ('T', 'E', 'XT') ('T', 'E', 'XT') >>> a, b,c__= list(string[:2]) + [string[2:]] #Slice__andconcatenate__>>> a, b,c__# a, b,c__= ['T', 'E', 'XT'] ('T', 'E', 'XT') >>> a,b__= string[:2] #Slice__andunpack__directly >>>c__= string[2:] # a,b__= 'TE';c__= 'XT' >>> a, b,c__('T', 'E', 'XT') >>> (a, b),c__= string[:2], string[2:] #Nested__sequences >>> a, b,c__# (a, b),c__= 'TE', 'XT' ('T', 'E', 'XT')As__thelast__examplein__thisinteraction__demonstrates,we__caneven__assignnested__sequences,and__Pythonunpacks__theirparts__accordingto__their shape,as__expected.In__this case,we__areassigning__atuple__oftwo__items,where__thefirst__itemis__anested__sequence (a string),exactly__asthough__wehad__codedit__this way: >>> ((a, b), c) = ('TE', 'XT') #Paired__byshape__andposition__>>> a, b,c__('T', 'E', 'XT')Python__pairsthe__firststring__onthe__right ('TE')with__thefirst__tupleon__theleft__((a, b))and__assignsone__characterat__a time,before__assigningthe__entiresecond__string ('XT')to__thevariable__call__at once.In__this event,the__sequence-nestingshape__ofthe__objecton__theleft__mustmatch__thatof__theobject__onthe__right.Nested__sequenceassignment__likethis__issomewhat__rareto__see,but__itcan__beconvenient__forpicking__outthe__partsof__datastructures__withknown__shapes.For__example,you__llsee__inChapter__13that__thistechnique__alsoworks__infor__loops,because__loopitems__areassigned__tothe__targetgiven__inthe__loopheader__justas__ifan__=statement__hadbeen__run:for__(a, b, c)in__[(1, 2, 3), (4, 5, 6)]: #Simple__tupleassignment__for ((a, b), c)in__[((1, 2), 3), ((4, 5), 6)]: #Nested__tupleassignment__Suchnested__sequenceassignments__canalso__beachieved__withthe__matchstatement__ofthe__next chapter,but__well__holdback__thedetails__until then. Sequence-unpackingassignments__alsogive__riseto__anothercommon__codingidiom__inPython__assigningan__integerseries__toa__setof__variables: >>> red, green,blue__= range(3) >>> red,blue__(0, 2)This__codeinitializes__thethree__nameson__theleft__of =to__theintegers__0, 1,and__2, respectively.Because__eachname__getsa__unique value,it__sPython__ssimplest__equivalentto__theenumerated__datatypes__youmay__haveseen__inother__languages.To__makesense__of this,you__needto__recallthat__therange__built-infunction__returnsan__iterable,which__generatesa__listof__successiveintegers__(wrapit__ina__listif__youwish__todisplay__itsvalues__atthe__REPLall__atonce__like this): >>> list(range(3)) # list()required__fordisplay__[0, 1, 2]This__callwas__previewedbriefly__inChapter__4;because__rangeis__commonlyused__infor__loops,we__llsay__moreabout__itin__Chapter 13.Another__placeyou__maysee__atuple__assignmentat__workis__forsplitting__asequence__intoits__frontand__the rest,in__loopslike__thefollowing__s while,introduced__inthe__prior chapter: >>>L__= [1, 2, 3, 4] >>>while__L: #Reapeat__untilL__becomesempty__(false) ... front,L__= L[0], L[1:] #See__nextsection__for *alternative__... print(front, L) ... 1 [2, 3, 4] 2 [3, 4] 3 [4] 4 []The__tupleassignment__inthe__loophere__couldbe__codedas__thefollowing__twolines__instead,but__its__oftenmore__convenientto__stringthem__together: ...front__= L[0] ...L__= L[1:]Notice__thatthis__codeis__usingthe__listas__asort__ofstack__data structure,which__canoften__alsobe__achievedwith__theappend__andpop__methodsof__list objects; here,front__= L.pop(0)would__havemuch__thesame__effectas__thetuple__assignment statement,but__itwould__bean__in-place change.You__lllearn__moreabout__while loops,and__other (andoften__better)ways__tostep__througha__sequencewith__for loops,in__Chapter 13. Extended-UnpackingAssignments__Theprior__sectiondemonstrated__howto__usemanual__slicingto__makesequence__assignmentsmore__general.In__later Pythons,sequence__assignmentwas__furtherextended__tomake__this easier.In__short,a__starred target, *X,can__beused__onthe__leftof__=in__orderto__specifya__moregeneral__matchingagainst__theiterable__onthe__rightthe__starredtarget__isassigned__a list,which__collectsall__itemsin__theiterable__notassigned__toother__targets.This__isespecially__handyfor__commoncoding__patternssuch__assplitting__asequence__intoits__frontand__rest,as__inthe__preceding example.Extended__unpackingin__actionLet__sjump__rightinto__anexample__todemo__howthis__works.As__already shown,sequence__assignmentsnormally__requireexactly__asmany__targetson__theleft__asthere__areitems__inthe__objecton__the right.We__getan__errorif__thelengths__disagree,unless__wemanually__sliceon__the right,as__shownin__theprior__section: >>>seq__= [1, 2, 3, 4] >>> a, b, c,d__=seq__>>> a,d__(1, 4) >>> a,b__=seq__ValueError:too__manyvalues__tounpack__(expected 2)We__can, however,use__asingle__starredtarget__inthis__exampleto__matchmore__generally.In__thefollowing__continuationof__ourinteractive__session,a__matchesthe__firstitem__inthe__sequence,and__bmatches__the rest: >>> a, *b =seq__>>>a__1 >>>b__[2, 3, 4]When__astarred__targetis__used (likename__b here),the__numberof__itemson__theleft__neednot__matchthe__lengthof__theiterable__onthe__right (likesequence__seq here).In__fact,the__starredtarget__canappear__anywhereon__the left.For__instance,in__thenext__interactionb__matchesthe__lastitem__inthe__sequence,and__amatches__everythingbefore__the last: >>> *a,b__=seq__>>>a__[1, 2, 3] >>>b__4When__thestarred__targetappears__inthe__middle,it__collectseverything__betweenthe__othertargets__listed. Thus,in__thefollowing__interaction,a__andc__areassigned__thefirst__andlast__items,and__bgets__everythingin__between them: >>> a, *b,c__=seq__>>>a__1 >>>b__[2, 3] >>>c__4More__generally,wherever__thestarred__targetshows__up,it__willbe__assigneda__listthat__collectsevery__unassigneditem__atthat__position: >>> a, b, *c =seq__>>>a__1 >>>b__2 >>>c__[3, 4] Naturally,like__normalsequence__assignment, extended-unpackingsyntax__worksfor__anysequence__types (really, again,any__iterable),not__just lists.Here__itis__unpackingcharacters__ina__stringand__aniterable__rangewhich__generatesvalues__0 3on__demand: >>> a, *b = 'hack' >>> a,b__('h', ['a', 'c', 'k']) >>> a, *b,c__= 'hack' >>> a, b,c__(('h', ['a', 'c'], 'k') >>> a, *b,c__= range(4) >>> a, b,c__(0, [1, 2], 3)This__issimilar__inspirit__to slicing,but__notexactly__thesame__asequence__unpackingassignment__alwaysreturns__alist__formatched__items,whereas__slicingreturns__asequence__ofthe__sametype__asthe__object sliced: >>>S__= 'hack' >>> a, b,c__= S[0], S[1:-1], S[-1] #Slices__aretype__specific >>> a, b,c__('h', 'ac', 'k') >>> a, *b,c__=S__#But__*always__returnsa__list >>> a, b,c__('h', ['a', 'c'], 'k') Finally,the__closingexample__ofthe__priorsection__becomeseven__simplerwith__this extension,since__wedon__thave__tomanually__sliceto__getthe__firstand__restof__theitems__(thoughthe__restL__alwaysbecomes__alist__afterthe__first *): >>>L__= [1, 2, 3, 4] >>>while__L: ... front, *L =L__#Get__first,rest__withoutslicing__... print(front, L) ... 1 [2, 3, 4] 2 [3, 4] 3 [4] 4 []Boundary__casesAlthough__extendedunpacking__is flexible,some__boundary (atypical)cases__areworth__noting. First,the__starredtarget__maymatch__justa__single item,but__isalways__assigneda__list: >>>seq__= [1, 2, 3, 4] >>> a, b, c, *d =seq__>>> print(a, b, c, d) 1 2 3 [4] Second,if__thereis__nothingleft__tomatch__thestarred__target,it__isassigned__anempty__list,regardless__ofwhere__it appears.In__the following,names__a, b, c,and__dhave__matchedevery__itemin__the sequence,but__Pythonassigns__ean__emptylist__insteadof__treatingthis__asan__error case: >>> a, b, c, d, *e =seq__>>> print(a, b, c, d, e) 1 2 3 4 [] >>> a, b, *e, c,d__=seq__>>> print(a, b, c, d, e) 1 2 3 4 []Errors__canstill__be triggered, though,if__thereis__morethan__onestarred__target,if__thereare__toofew__valuesand__nostar__(as before),and__ifthe__starredtarget__isnot__itselfcoded__insidea__sequence: >>> a, *b, c, *d =seq__SyntaxError:multiple__starredexpressions__inassignment__>>> a,b__=seq__ValueError:too__manyvalues__tounpack__(expected 2) >>> *a =seq__SyntaxError:starred__assignmenttarget__mustbe__ina__listor__tuple >>> *a, =seq__#A__one-itemtuple__sansparentheses__>>>a__#Same__asa__= seq,but__makesa__new copy! [1, 2, 3, 4] Technically,the__single-appearancerule__forstarred__targetson__theleft__of =really__appliesonly__toeach__sequencewhen__thereis__nestingon__bothsides__thoughyou__stillcan__thave__morethan__oneper__nested sequence: >>> [(a, *b), (c, *d)] = [(1, 2, 3, 4), (5, 6, 7, 8)] >>> a, b, c,d__(1, [2, 3, 4], 5, [6, 7, 8]) >>> [(a, *b, *x), (c, *d)] = [(1, 2, 3, 4), (5, 6, 7, 8)] SyntaxError:multiple__starredexpressions__inassignment__And finally,any__assignmenttarget__canbe__starredthough__youmay__be hard-pressed__tofind__somein__real code: >>> a, *L = [1, 2, 3] #Name__target >>> a,L__(1, [2, 3]) >>> a, *L[0] = [4, 5, 6] #Index__target >>> a,L__(4, [[5, 6], 3]) >>> a, *L[1:] = [7, 8, 9] #Slice__target >>> a,L__(7, [[5, 6], 8, 9]) >>>class__C:code__#See__PartVI__>>> a, *C.attr = 'yikes' #Attribute__target >>> a, C.attr ('y', ['i', 'k', 'e', 's'])A__usefulconvenience__Keepin__mindthat__extended-unpackingassignment__isjust__aconvenience__(well,in__additionto__a mouthful).We__canusually__achievethe__sameeffects__withexplicit__indexingand__slicing,but__extendedunpacking__issimpler__to code.The__common first,rest__splittingcoding__pattern,for__example,can__becoded__either way,but__slicingis__extra work: >>>seq__[1, 2, 3, 4] >>> a, *b =seq__# First,rest__>>> a,b__(1, [2, 3, 4]) >>> a,b__= seq[0], seq[1:] # First,rest__sans * >>> a,b__(1, [2, 3, 4])The__also-common rest,last__splittingpattern__cansimilarly__becoded__either way,but__extended-unpackingsyntax__againrequires__noticeablyfewer__keystrokes (andnotably__fewer neurons): >>> *a,b__=seq__# Rest,last__>>> a,b__([1, 2, 3], 4) >>> a,b__= seq[:-1], seq[-1] # Rest,last__sans * >>> a,b__([1, 2, 3], 4)Being__bothsimpler__andarguably__more natural, extended-unpackingsyntax__isalso__commonin__Python code.Application__tofor__loopsBecause__theloop__variablein__thefor__loopstatement__canbe__anyassignment__target,extended__unpackingworks__here too.We__usedthe__forloop__iterationtool__brieflyin__Chapter 4and__willstudy__itformally__inChapter__13,but__its tie-inhere__is straightforward: extended-unpackingassignments__mayshow__upafter__theword__for,where__asimple__variablename__ismore__commonly used:for__(a, *b, c)in__[(1, 2, 3, 4), (5, 6, 7, 8)]:When__usedin__this context,on__eachiteration__Pythonsimply__assignsthe__nexttuple__ofvalues__tothe__tupleof__targets.On__thefirst__loop,for__example,it__sas__ifwe__drun__thefollowing__assignment statement: a, *b,c__= (1, 2, 3, 4) #b__gets [2, 3]The__names a, b,and__ccan__beused__withinthe__loops__codeto__referencethe__extracted components.In__fact,this__isreally__nota__specialcase__at all,but__justan__instanceof__generalassignment__at work.As__wesaw__earlierin__this chapter,for__example,we__cando__similarin__loopswith__simplesequence__(tuple) assignment:for__(a, b, c)in__[(1, 2, 3), (4, 5, 6)]: # a, b,c__= (1, 2, 3),And__wecan__alwaysemulate__extended-unpackingassignment__behaviorby__manually slicing:for__allin__[(1, 2, 3, 4), (5, 6, 7, 8)]: a, b,c__= all[0], all[1:-1], all[-1]Since__wehaven__tlearned__enoughto__getmore__detailedabout__thesyntax__offor__loops,we__llput__thistopic__onthe__backburner__untilits__reprisein__Chapter 13.THE__MANYSTARS__OFPYTHON__No,this__sidebaris__notabout__personalities (whichalready__permeatesoftware__culturemore__thanthey__should).It__sa__referenceto__allthe__special-caseappearances__of *that__havecropped__upin__Pythonover__the years,many__ofwhich__youve__already seen.Prior__toPython__3.5,the__special starred-itemsyntax__formscan__appear in: Assignments,where__asingle__*Xstarred__assignmenttarget__ofany__kind (name, index, slice, attribute),and__repeatablein__nested parts,collects__unmatcheditems__ina__new list,as__coveredin__thischapter__Function headers,where__single *Xand__**Xstarred__namescollect__unmatchedpositional__andkeyword__argumentsin__atuple__and dictionary,respectively__Function calls,where__single *Xand__**Xstarred__expressionsunpack__iterablesand__mappingsinto__individualpositional__andkeyword__arguments,respectively__Asof__Python 3.5,function__calls (thelatter__listed item)support__anynumber__of *Xand__**Xunpacking__expressions,and__anynumber__of *Xand__**Xstarred__expressionscan__alsoappear__inobject__literals,where__theyunpack__collectionsof__typesimplied__bythe__literalin__whichthey__appear: [x, *iter] # List:unpack__itemsin__iterables (x, *iter, y) # Tuple: ditto,parentheses__ornot__{*iter, x} # Set: ditto,though__valuesare__unorderedand__unique {x: y, **map} # Dict:unpack__keys/valuesin__mappings,rightmost__dupwins__Asof__Python 3.10,both__*Xand__**Xstarred__namescan__alsoshow__upin__thepatterns__ofthe__matchstatement__coveredin__thenext__chapter,where__theyserve__rolessimilar__tothat__insequence__assignment,though__only *Xoverlaps__betweenthe__two,and__itsassignment__inmatch__isreally__aside__effectof__a true- or-false test.And__asof__Python 3.11,an__except*can__appearin__try statements,where__itallows__multiplehandlers__tobe__runto__processmultiple__exceptionswrapped__inan__exceptiongroup__anaddition__thatbifurcates__the already-convolutedtry__fornarrow__roles,which__wewon__tmeet__untilChapter__35.All__thatbeing__said,the__avenueof__starshas__beena__meanderingwalk__in Python,and__its__notimpossible__thatother__partsof__thelanguage__willrise__tostardom__inthe__future.Consult__thestars__formore__info. Multiple-TargetAssignments__Simplerthan__sequenceassignment__onfirst__glance,a__multiple-targetassignment__simplyassigns__allthe__giventargets__tothe__sameobject__allthe__wayto__the right.The__following,for__example,assigns__thethree__names (variables) a, b,and__cto__thestring__'code': >>>a__=b__=c__= 'code' >>> a, b,c__('code', 'code', 'code')This__formis__equivalentto__buteasier__tocode__andlighter__online__countthan__thesethree__assignments: >>>c__= 'code' >>>b__=c__>>>a__=b__Multiple-targetassignment__andshared__referencesWhile__thisseems__simple,keep__inmind__thatthere__isjust__oneobject__here,shared__byall__three variables:they__allwind__upreferencing__thesame__objectin__memory.This__behavioris__worry-freefor__immutabletypes__for example,when__initializinga__setof__countersto__zero (recallthat__variablesmust__beassigned__beforethey__canbe__usedin__Python,so__youmust__initializecounters__tozero__beforeyou__canstart__addingto__them): >>>a__=b__= 0 >>>b__=b__+ 1 >>> a,b__(0, 1) Here,changing__bchanges__onlyb__becausenumbers__donot__support in-place changes.As__longas__theobject__assignedis__immutable,it__sirrelevant__ifmore__thanone__namereferences__it.As__usual, though,we__haveto__bemore__cautiouswhen__initializingvariables__toan__emptymutable__objectsuch__asa__listor__dictionary: >>>a__=b__= [] >>> b.append(42) >>> a,b__([42], [42])This__time,because__aand__breference__thesame__object,appending__toit__inplace__throughb__willimpact__whatwe__seethrough__aas__well.This__isreally__justanother__exampleof__theshared__referencephenomenon__wefirst__metin__Chapter 6.To__avoidthe__issue,initialize__mutableobjects__inseparate__statements instead,so__thateach__createsa__distinctempty__object,by__runninga__distinctliteral__expression: >>>a__= [] >>>b__= [] #a__andb__donot__sharethe__sameobject__>>> b.append(42) >>> a,b__([], [42])A__tupleassignment__likethe__followinghas__thesame__effectwith__morebrevity__byrunning__two list-literal expressions,it__createstwo__distinct objects: >>> a,b__= [], [] #a__andb__donot__sharethe__sameobject__AugmentedAssignments__Inaddition__tothe__basic,sequence__(originaland__starred),and__multipleassignment__formsalready__covered,Python__gainedall__theassignment__statementformats__listedin__Table 11-2relatively__earlyin__its career.Known__asaugmented__assignments,and__borrowedfrom__theC__language,these__formatsare__mostlyjust__shorthand:they__implythe__combinationof__abinary__(two-operand)expression__andan__assignment.For__instance,the__followingtwo__formatsare__functionally equivalent,though__thelatter__mayuse__in-placeoptions__tochange__X directly,as__youll__seein__a moment:X__=X__+Y__#Basic__formX__+=Y__#Augmented__formTable__11-2.Augmented__assignmentstatements__X +=Y__X -=Y__X *=Y__X /=Y__X @=Y__X //=Y__X %=Y__X **=Y__X >>=Y__X <<=Y__X &=Y__X |=Y__X ^=Y__Augmentedassignment__workson__anytype__thatsupports__theimplied__binary expression.For__example,here__aretwo__waysto__add 1to__a name; really,they__bothchange__aname__toreference__different values: >>>x__= 1 >>>x__=x__+ 1 #Basic__>>>x__2 >>>x__+= 1 #Augmented__>>>x__3When__appliedto__asequence__suchas__a string,the__augmentedform__performsconcatenation__instead,because__thats__what +means__forsuch__objects. Thus,the__secondline__hereis__equivalentto__typingthe__longerS__=S__+ 'HACK': >>>S__= 'hack' >>>S__+= 'HACK' #Implied__concatenation >>>S__'hackHACK'As__shownin__Table 11-2,there__areanalogous__augmentedassignment__formsfor__otherPython__binaryexpression__operators (i.e.,operators__withvalues__ontheir__leftand__right sides).For__instance,X__*=Y__multipliesand__assigns,X__>>=Y__shiftsright__and assigns,and__soon__(thoughper__Chapter 5,the__formX__@=Y__isunused__andunimplemented__byPython__itself today).All__told,augmented__assignmentshave__threenoteworthy__advantages:1There__sless__foryou__to type. (Needthis__booksay__more?)The__leftside__hasto__beevaluated__only once.In__X += Y,X__maybe__acomplicated__object expression.In__theaugmented__form,its__codemust__berun__only once. However,in__thelong__form,X__=X__+ Y,X__appearstwice__andmust__berun__twice.Because__of this,augmented__assignmentsusually__run faster.The__optimaltechnique__isautomatically__chosen.That__is,for__objectsthat__support in-place changes,the__augmentedforms__automaticallyperform__in-placechange__operationsinstead__ofslower__copies.The__lastpoint__hererequires__abit__more explanation.For__augmented assignments, in-placeoperations__maybe__appliedfor__mutableobjects__asan__optimization.Recall__thatlists__canbe__extendedin__avariety__of ways.To__adda__singleitem__tothe__endof__a list,we__canconcatenate__orcall__append: >>>L__= [1, 2] >>>L__=L__+ [3] #Concatenate__one:slower__>>>L__[1, 2, 3] >>> L.append(4) # Faster,but__inplace__>>>L__[1, 2, 3, 4]And__toadd__aset__ofitems__tothe__end,we__caneither__concatenateagain__orcall__thelist__extend method: >>>L__=L__+ [5, 6] #Concatenate__many:slower__>>>L__[1, 2, 3, 4, 5, 6] >>> L.extend([7, 8]) # Faster,but__inplace__>>>L__[1, 2, 3, 4, 5, 6, 7, 8]In__both cases,concatenation__isless__proneto__theside__effectsof__sharedobject__referencesbut__willgenerally__runslower__thanthe__in-place equivalent.Concatenation__operationsmust__createa__new object,copy__inthe__liston__the left,and__thencopy__inthe__liston__the right.By__contrast, in-placemethod__callssimply__additems__atthe__endof__amemory__block (itcan__bea__bitmore__complicatedthan__that internally,but__thisdescription__suffices).When__weuse__augmentedassignment__toextend__a list,we__canlargely__forgetthese__detailsPython__automaticallycalls__thequicker__extendmethod__(orits__equivalent)instead__ofusing__theslower__concatenationoperation__impliedby__+: >>>L__+= [9, 10] #Mapped__to L.extend([9, 10]) >>>L__[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]As__suggestedin__Chapter 6,we__canalso__useslice__assignment (e.g., L[len(L):] = [11,12,13]),but__thisworks__roughlythe__sameas__thesimpler__andmore__mnemoniclist__extendmethod__orthe__+= statement. Note, however,that__becauseof__thisequivalence__+=for__alist__isnot__exactlythe__sameas__a +and__=in__allcases__forlists__+=allows__arbitrarysequences__(justlike__extend),but__concatenationnormally__does not: >>>L__= [] >>>L__+= 'hack' # +=and__extendallow__any sequence,but__+does__not! >>>L__['h', 'a', 'c', 'k'] >>>L__=L__+ 'code' TypeError:can__onlyconcatenate__list (not "str")to__list Moreover,using__indexand__slicetargets__inaugmented__assignmentmay__changemutables__inother__ways: >>>L__= [1, 2] >>> L[0] += 10 #Change__anitem__ofa__list,in__place >>>L__[11, 2] >>> L[-1:] += [3, 4] #Change__asection__ofa__list,in__place >>>L__[11, 2, 3, 4]Augmented__assignmentand__sharedreferences__More subtly,the__in-placechange__implicitin__+=for__listsis__verydifferent__fromthe__newobject__createdby__+ concatenation.As__forall__shared-reference cases,this__differencemay__matterwhen__objectsare__sharedby__many names: >>>L__= [1, 2] >>>M__=L__#L__andM__referencethe__sameobject__>>>L__=L__+ [3, 4] #Concatenation__makesa__newobject__>>> L,M__#Changes__Lbut__notM__([1, 2, 3, 4], [1, 2]) >>>L__= [1, 2] >>>M__=L__>>>L__+= [3, 4] #But__+=really__means extend,not__+ >>> L,M__#M__seesthe__in-placechange__too! ([1, 2, 3, 4], [1, 2, 3, 4])This__onlymatters__formutables__likelists__and dictionaries,and__itis__afairly__obscurecase__(at least,until__itimpacts__your code!).As__always,make__copiesof__yourmutable__objectsif__youneed__tobreak__theshared__reference structure.Named__AssignmentExpressions__Formost__ofPython__s three-decade tenure,it__resistedemulating__the assignment- as-expressionidiom__ofthe__C language,on__thegrounds__thatit__wastoo__subtleand__error-prone,and__fosteredcode__thatwas__hardto__read.While__theseconcerns__still apply,Python__3.8gained__aflavor__of this,known__asnamed__assignment. Importantly,this__flavordoes__notmake__normal =assignment__statementsnestable__expressions,as__theyare__in C. Instead,it__addsa__newexpression__operatorto__Python, :=,on__thegrounds__thatits__differentand__limitedsyntax__mayneutralize__pitfallsof__other languages.You__stillcan__taccidentally__type =when__youmean__==,and__:=is__visually distinct.We__exploredthis__expressionbriefly__ina__spoilernote__inthe__previous chapter.In__short,the__expressionname__:=value__firstevaluates__expression value,and__then both:Assigns__theresult__tothe__providedvariable__nameReturns__theresult__asthe__valueof__theoverall__:=expression__Theres__noreason__touse__thissyntax__forthe__firstpart__alone,because__allof__Pythons__=assignment__statementsalready__assignvalues__tonames__(in fact,you__llget__asyntax__errorif__youtry__using :=as__astatement__sans parentheses).Because__:=is__anexpression__thatreturns__thevalue__assigned, though,it__canbe__nestedin__contextswhere__statementsaren__tallowed__andmay__beused__inroles__thatboth__testand__thenuse__theassigned__name.As__anartificial__first example,the__followingnested__:=both__assigns 2to__b,and__returnsit__tobe__usedin__the * string-repetitionresult__assignedto__a: >>>a__= 'hack' * (b := 2) >>>a__'hackhack' >>>b__2Among__itsdeliberate__limitations,named__assignmentallows__onlya__simple,single__name (variable)on__the left,so__neitherother__assignment-statementforms__norreferences__to data-structurecomponents__work here: >>> (python := 3.12) + 0.01 #Just__aname__onthe__left 3.13 >>>python__3.12 >>> (python,Python__:= 3.12, 3.13) + 0.01 TypeError:can__onlyconcatenate__tuple (not "float")to__tuple >>> (python[0] := 3.12) + 0.01 SyntaxError:cannot__useassignment__expressionswith__subscript >>> (python.attr := 3.12) + 0.01 SyntaxError:cannot__useassignment__expressionswith__attributeThe__firstof__these failers,for__example,is__takento__bea__three-itemtuple__with :=in__the middle,not__a two-targetnamed__sequence assignment. Moreover,named__assignmentdoes__notsupport__anyof__theaugmented__assignmentforms__wemet__earlier:there__isno__:+=,for__instance,and__codingstatement__X += 1may__actuallytake__lesswork__thanexpression__(X :=X__+ 1) (subtly,a__:=+ runs,but__simplyapplies__the +identity__operatorto__theexpression__onthe__right).When__touse__namedassignment__Whilemore__usefulcontexts__for :=are__limited,its__mostcommon__usecases__arisein__concertwith__theif__andwhile__statements,which__wereboth__introducedin__thepreceding__chapterand__earlier.Without__:=,it__wasand__stillis__commonto__assigna__variablebefore__the statement,test__itin__thestatement__header,and__thenuse__itin__thestatement__body.For__example,code__thatreads__linesfrom__filesand__mustdetect__theend__ofthe__file (which,you__llrecall__fromChapter__9,means__anempty__stringthat__islogically__false)may__looklike__thesepartial__snippets (torun__codein__thissection__live,open__atext__filefor__inputand__assignit__tofile__beforeeach__snippet):line__= file.readline() #Sans__the :=expression__if line: print(line)line__= file.readline() # Ditto,in__whileloops__while line: print(line)line__= file.readline()To__avoidredundant__calls,it__salso__commonto__codethe__latterlike__thisin__Pythonas__inthe__preceding chapter:while__True: #Sans__both :=and__redundancyline__= file.readline()if__not line:break__print(line)These__formsstill__work well,and__the :=is__never required.With__:=, however,we__cansometimes__collapsea__fetch, assignment,and__testinto__a one-linerwithin__statementheaders__themselves:if__line := file.readline(): #The__:=alternatives__print(line)while__line := file.readline(): #Read__alllines__(vs:for__linein__file) print(line)In__both cases,because__:=returns__theresults__ofthe__readline call,its__logicalvalue__canbe__testedin__thestatement__header itself.And__because :=also__assignsthe__resultto__line,it__canbe__usedin__thestatement__sbody__ifit__is run.The__upshotis__that :=provides__asort__ofshortcut__thatallows__multipleoperations__tobe__codedin__acompact__way.If__youopt__touse__this expression,bear__inmind__thatit__oftenrequires__enclosingparentheses__toavoid__interactingwith__surrounding code.Even__comparingits__resultto__anexplicit__value,for__instance,mandates__parenthesesthat__arenot__requiredin__theequivalent__statements:if__(line := file.readline()) != ignore: #Parentheses__required print(line)while__(line := file.readline()) != stop: #And__nota__badidea__print(line)As__arule__of thumb,if__youopt__touse__:=,wrapping__itin__parenthesesboth__setsit__offvisually__andavoids__stickyissues__thatmay__ariseif__thecode__surroundingit__changesits__meaning unexpectedly.In__the preceding,for__example,names__areassigned__theresults__ofthe__!=tests__ifparentheses__are omitted,because__itbinds__tighterthan__:= (seeChapter__9). Moreover, :=has__specialsyntax__rulesthat__well__omit here,but__theyencourage__parenthesizedusage__by design.Besides__filereads__andsimilar__roles,the__:=can__beleveraged__toreuse__resultsin__literalsand__getlast__resultsin__comprehensionsand__otheriteration__tools,and__caneven__benested__in f-stringsand__itselfwith__requisite parentheses: >>> [val := 'Py!',val__* 2,val__* 3] #Reusing__avalue__['Py!', 'Py!Py!', 'Py!Py!Py!'] >>> list(pow := 2 **num__fornum__in [2, 4, 8]) #Capturing__aresult__[4, 16, 256] >>>pow__256 >>> f'Hello {(name := input('Whoare__you? '))}' #Nesting__in f-strings (hmm)Who__are you?Pat__'Hello Pat' >>>name__'Pat' >>> (x := (y := (z := 1) + 1) + 1) #Nesting__initself__(hmm * 2) 3 >>> x, y,z__(3, 2, 1)As__anotherrule__of thumb,bear__inmind__thata__deeplynested__andobscure__:=expression__mightseem__cleverbut__willbe__alot__harderto__readand__evennotice__thana__simplestandalone__assignment.You__llbe__ableto__judgethis__foryourself__inexamples__inChapter__20.Generally__speaking, though,for__thesake__ofothers__(includingyour__future self!),use__:=,like__somany__nestable tools,sparingly__and wisely.Clarity__isusually__worththe__extraline__or two.Variable__NameRules__Nowthat__weve__exploredassignment__statementsand__expressions,it__stime__toget__moreformal__aboutthe__useof__variable names.In__Python,names__comeinto__existencewhen__youassign__valuesto__them,but__thereare__afew__rulesto__followwhen__choosingnames__forthe__subjectsof__your programs: Syntax: (underscoreor__letter) + (anynumber__of letters, digits,or__underscores)Variable__namesmust__startwith__anunderscore__or letter,which__canbe__followedby__anynumber__of letters, digits,or__underscores. _hack, hack,and__Hack_1are__legal names,but__1_hack, hack$,and__@#!are__not.Python__alsoallows__non-ASCIIUnicode__charactersto__appearin__variable names,but__suchcharacters__maymake__yourcode__difficultto__usein__somecontexts__andare__subjectto__ahandful__ofrules__thatrequire__deepUnicode__knowledgeand__aretoo__arcaneto__cover here.See__Chapter 37s__noteUnicode__invariable__namesfor__expandedcoverage__ofthis__topic,and__Pythons__languagemanuals__forfull__details.Case__matters:HACK__isnot__thesame__ashack__Pythonalways__paysattention__tocase__in programs,both__innames__youcreate__andin__reserved words.For__instance,the__namesX__andx__referto__twodifferent__variables.For__portability,case__alsomatters__inthe__namesof__importedmodule__files,even__onplatforms__wherethe__filesystemsare__case-insensitive (asis__commonin__Windows).That__way,your__importsstill__workafter__programsare__copiedto__differing platforms.Reserved__wordsare__off-limitsNames__youdefine__cannotbe__thesame__aswords__thatmean__specialthings__inthe__Python language.For__instance,Python__willraise__asyntax__errorif__youtry__touse__classas__avariable__name,but__klassand__Classwork__fine.Table__11-3lists__thewords__thatare__currentlyreserved__andhence__off-limitsfor__namesof__yourown__in Python. Note:Python__sdocs__callthese__keywords today,despite__thelongstanding__anddiffering__useof__keywordsfor__pass-by-namefunction__arguments;to__avoid confusion,this__bookuses__reservedwords__for, well,reserved__words.Table__11-3.Python__reservedwords__Falseawait__elseimport__passNone__breakexcept__inraise__Trueclass__finallyis__returnand__continuefor__lambdatry__asdef__fromnonlocal__whileassert__delglobal__notwith__asyncelif__ifor__yieldIn__additionto__Table 11-3 (andas__partlyleaked__inChapter__10),the__words match, case, _,and__typeare__softreserved__words:they__arereserved__onlyin__thecontext__ofthe__statementto__whichthey__belongand__canbe__usedas__variablesanywhere__else.As__youll__learnin__thenext__chapter,the__firstthree__arepart__ofa__multiple-choice__match statement;the__latteris__usedby__atype__statementthat__createstype__aliases,used__forthe__typehinting__discussedat__theend__ofChapter__6.As__youcan__see,most__ofPython__sreserved__wordsare__all lowercase.They__arealso__alltruly__reservedunlike__namesin__the built-inscope__thatyou__willmeet__inthe__nextpart__ofthis__book,you__cannotredefine__reservedwords__by assignment.The__statementand__= 1,for__instance,results__ina__syntax error.Besides__beingof__mixed case,the__firstthree__entriesin__Table 11-3 False, None,and__Trueare__somewhatunusual__in meaning:they__alsoappear__inthe__built-inscope__ofPython__describedin__Chapter 17,and__theyare__technicallynames__assignedto__objects.They__aretruly__reservedin__allother__senses, though,and__cannotbe__usedfor__anyother__purposein__yourscript__otherthan__thatof__theobjects__they represent.All__theother__reservedwords__arehardwired__intoPython__ssyntax__andcan__appearonly__inthe__specificcontexts__forwhich__theyare__intended.2 Furthermore,because__modulenames__inimport__statementsbecome__variablesin__your scripts,variable__nameconstraints__extendto__yourmodule__filenames too.For__instance,you__cancode__filescalled__and.pyand__my-code.pyand__canrun__themas__top-level scripts,but__youcannot__import them:their__nameswithout__their .pyextensions__becomevariables__inyour__codeon__imports,and__somust__followall__thevariable__rulesjust__outlined. Hence,reserved__wordsare__off-limits,and__dasheswon__t work,though__underscores will.This__moduleidea__willbe__revisitedin__PartV__ofthis__book,where__youll__findthat__thisconstraint__alsoapplies__tonames__ofpackage__foldersby__extension.PYTHON__SDEPRECATION__POLICIESBecause__makingnew__wordsreserved__hasthe__potentialto__breakcode__widely,such__changesare__generallyphased__intothe__language gradually.When__achange__mightimpact__existing code,Python__oftenmakes__itan__optionand__beginsissuing__deprecationwarnings__oneor__morereleases__beforethe__modis__officially enabled.The__ideais__thatyou__shouldhave__timeto__noticethe__warningsand__updateyour__codebefore__upgradingyour__Python.More__recently,the__soft reserved-wordcategory__hasarisen__toallow__newreserved__wordsto__beadded__withneither__warningsnor__breakages.This__seemsa__tacitrecognition__thatdeprecations__onlygo__so far.Deprecation__policiesare__notalways__followed,especially__formajor__releaseslike__3.0 (whichbroke__existingcode__wantonly),but__alsofor__newerchanges__deemedto__bejustifiable__orinnocuous__bytheir__promoters.In__theory,changes__areoverseen__bya__steeringcommittee__chargedwith__enforcingdeprecation__policies.While__thishelps__insome__cases,it__islargely__ineffectualin__stemmingthe__floodof__opinionatedmorph__andbloat__in Python,which__makesengineering__reliableand__durablesoftware__morechallenging__thanit__should be.Even__whendeprecation__warningsare__issued, though,programs__thatcannot__beeasily__changedwill__breakif__theyhave__beendistributed__insource__codeform__tousers__whoinnocently__upgradetheir__local Python.Those__onthe__receivingend__ofsuch__fluxmay__legitimatelysee__deprecationwarnings__lessas__acourtesy__thana__bandageon__agaping__wound.Warning__thatyou__regoing__tobe__rudedoesn__tmake__itOK__tobe__rude!Naming__conventionsBesides__these rules,there__isalso__aset__ofnaming__conventionsrules__thatare__notrequired__butare__followedin__normal practice.For__instance,because__nameswith__twoleading__andtrailing__underscores (e.g., __name__)generally__havespecial__meaningto__thePython__interpreter,you__shouldavoid__thispattern__foryour__ownnames__exceptin__contextswhere__itis__expected.Here__isa__listof__theconventions__Python follows:Names__thatbegin__witha__singleunderscore__(_X)are__notimported__bya__frommodule__import * statement,described__inChapter__23.Names__thathave__twoleading__andtrailing__underscores (__X__)are__system-definednames__thathave__specialmeaning__tothe__interpreterand__provideimplementation__detailsin__the user-definedOOP__classesof__Part VI.Names__thatbegin__withtwo__underscoresand__donot__endwith__twomore__(__X)are__localized (mangled__)to__enclosing classes,per__thediscussion__ofpseudoprivate__attributesin__Chapter 31.The__namethat__isjust__asingle__underscore (_)retains__theresult__ofthe__lastexpression__whenyou__areworking__interactivelyat__someREPLs__andis__asoft__keywordfor__awildcard__in match,as__coveredin__Chapter 12.In__additionto__thesePython__interpreter conventions,there__arevarious__otherconventions__thatPython__programmersusually__follow.For__instance,some__programmersdistinguish__partsof__longnames__usingcamelCase__(aLongName),and__othersuse__underscores (a_Long_name);either__iscompletely__validaccording__toboth__Pythonand__this book.Later__inthe__book,you__llalso__seethat__classnames__commonlystart__withan__uppercaseletter__andmodule__nameswith__alowercase__letter,and__thatthe__name self,though__not reserved,usually__hasa__specialrole__in classes. Moreover,in__Chapter 17we__llstudy__another,larger__categoryof__namesknown__asthe__built-ins,which__arepredefined__butnot__reserved (andso__canbe__reassigned:open__= 99silently__works,though__youmight__occasionallywish__itdidn__t!).Names__haveno__type,but__objectsdo__Thisis__mostly review,but__rememberthat__its__crucialto__keepPython__sdistinction__betweennames__andobjects__clear.As__describedin__Chapter 6,objects__havea__type (e.g., integer, list)and__maybe__mutableor__not.Names__(a.k.a. variables),on__theother__hand,are__alwaysjust__referencesto__objects;they__haveno__notionof__mutabilityand__haveno__associatedtype__information,apart__fromthe__typeof__theobject__theyhappen__toreference__ata__givenpoint__in time. Thus,it__sOK__toassign__thesame__nameto__differentkinds__ofobjects__atdifferent__times: >>>x__= 0 #x__boundto__aninteger__object >>>x__= 'Hello' #Now__it'sa__string >>>x__= [1, 2, 3] #And__now it'sa__listEspecially__whenwe__stepup__tofunctions__andclasses__laterin__this book,you__llsee__thatthis__genericnature__ofnames__canbe__adecided__advantagein__Python programming.In__Chapter 17,you__llalso__learnthat__nameslive__insomething__calleda__scope,which__defineswhere__theycan__be used;the__placewhere__youassign__aname__determineswhere__itis__visible.3Expression__StatementsIn__Python,you__canuse__anyexpression__asa__statement,too__whichusually__meanson__aline__by itself.Because__theresult__ofthe__expressionwon__tbe__saved, though,it__usuallymakes__senseto__doso__inscripts__onlyif__theexpression__doessomething__usefulas__aside__effect.Expressions__arecommonly__usedas__statementsin__two situations:For__callsto__functionsand__methodsSome__functionsdo__theirwork__withoutreturning__a value.Such__functionsare__sometimescalled__proceduresin__other languages.Because__theydon__treturn__valuesthat__youmight__beinterested__in retaining,you__cancall__thesefunctions__withexpression__statements.This__alsoapplies__to methods,which__arejust__functionswith__animplied__subject.For__printingvalues__atthe__interactiveprompt__Asyou__certainlyknow__by now,Python__echoesback__theresults__ofexpressions__typedat__theinteractive__command line. Technically,these__areexpression__statements, too;they__serveas__ashorthand__fortyping__print statements.Table__11-4lists__somecommon__expressionstatement__formsin__Python.Calls__tofunctions__andmethods__arecoded__withzero__ormore__argumentobjects__(really,expressions__thatevaluate__to objects)in__parentheses,after__thefunction__ormethod__name.Table__11-4.Common__Pythonexpression__statementsOperation__Interpretation hack('Py', 3.12)Function__calls code.hack('Py')Method__callshack__Printingresults__inthe__interactiveinterpreter__(REPL) print(a, b, c, sep='')Printing__operations (aspecial__function call)yield__x ** 2Yielding__expressionstatements__(generators)await__producer()Pausing__forsteps__tofinish__(coroutines)The__lastthree__entriesin__Table 11-4are__somewhatspecial__cases.As__youll__seelater__inthis__chapter,printing__inPython__isa__functioncall__usuallycoded__asa__statementby__itself,and__importantenough__tocallout__here.The__yieldand__awaitoperations__ongenerator__andcoroutine__functions (discussedin__Chapter 20)are__regularlycoded__asstatements__as well.All__three, though,are__reallyjust__instancesof__expressionsmasquerading__as statements.For__instance,though__younormally__runa__printcall__ona__lineby__itselfas__anexpression__statement,it__actuallyreturns__avalue__likeany__otherfunction__callthe__returnvalue__is None,the__defaultreturn__valuefor__functionsthat__dont__returnanything__meaningful (itrequires__anotherprint__toreveal__in output): >>>x__= print('code') #print__isa__function-callexpression__code >>> print(x) #But__isusually__codedas__anexpression__statementNone__Alsokeep__inmind__thatalthough__expressionscan__appearas__statementsin__Python,the__converseis__not true:statements__cannotbe__usedas__expressions.A__statementthat__isnot__alsoan__expressionmust__generallyappear__ona__lineall__by itself,not__nestedin__alarger__syntactic structure.For__example,Python__doesnt__allowyou__toembed__basicassignment__statements (=)in__other expressions.The__rationalefor__thisis__thatit__avoidscommon__coding mistakes;you__cant__accidentallychange__avariable__bytyping__=when__youreally__meanto__usethe__==equality__test.If__youreally__missthis__codingpattern__fromother__languages, though,the__newerand__visuallydistinct__:= named-assignmentexpression__wemet__earlierworks__thesame__waywith__lesschance__ofbeing__confusedwith__==,and__avariety__ofcoding__alternativesachieve__similargoals__(e.g.,see__whilecoverage__inChapter__13).Expression__Statementsand__In-PlaceChanges__Thisbrings__upa__commonmistake__inPython__work,which__weve__encountered before,but__isso__pervasivethat__itmerits__anotherquick__nag here.Expression__statementsare__oftenused__torun__listmethods__thatchange__alist__in place: >>>L__= [1, 2] >>> L.append(3) #Append__isan__in-placechange__>>>L__[1, 2, 3]It__snot__unusual, though,for__Pythonnewcomers__tocode__thisas__anassignment__statement instead: >>>L__= L.append(4) #But__appendreturns__None,not__L >>> print(L) #So__welose__our list!None__Butthis__doesnt__work: in-placechange__methodslike__append, sort,and__reversealways__changethe__listin__place,but__donot__returnthe__listthey__have changed; instead,they__returnthe__None object.Assigning__suchan__operations__resultback__tothe__variablename__losesyour__referenceto__thelist__(andit__sprobably__garbage-collected__inthe__process).So__dont__dothat__call in-placechange__operationswithout__assigningtheir__results.We__llrevisit__thisphenomenon__inCommon__CodingGotchas__,because__itcan__alsoappear__inthe__contextof__somelooping__statementswe__llexplore__inthe__chapters ahead.Print__OperationsIn__Python,print__printsthings__its__simplya__programmer-friendlyinterface__tothe__standardoutput__stream.It__sa__function-callexpression__thatwe__recalling__outhere__becauseit__sso__pervasiveand__isusually__codedas__a statement. Technically,printing__convertsone__ormore__objectsto__theirtextual__representations,adds__someminor__formatting,and__sendsthe__resultingtext__toeither__standardoutput__oranother__file-like stream.In__abit__more detail,print__isstrongly__boundup__withthe__notionsof__filesand__streamsin__Python:File__objectmethods__InChapter__9,we__exploredfile__objectmethods__thatwrite__text (e.g., file.write(str)).Printing__operationsare__similar,but__morefocused__whereasfile__writemethods__writestrings__toarbitrary__files,print__writesobjects__tothe__stdoutstream__by default,with__someautomatic__conversionand__formatting added.Unlike__withfile__methods,there__isno__needto__convertobjects__tostrings__whenusing__print operations.Standard__outputstream__Thestandard__outputstream__(oftenknown__as stdout)is__simplya__defaultplace__tosend__aprogram__stext__output.Along__withthe__standardinput__anderror__streams,it__sone__ofthree__dataconnections__createdwhen__yourscript__starts.The__standardoutput__streamis__usuallymapped__tothe__windowwhere__youstarted__yourPython__programor__REPL,unless__its__beenredirected__toa__fileor__pipein__youroperating__systems__shellor__reroutedby__yourcoding__GUI.Because__thestandard__outputstream__isavailable__inPython__asthe__stdoutfile__objectin__the built-insys__module (i.e., sys.stdout),it__spossible__toemulate__printwith__filewrite__method calls. However,print__isnoticeably__simplerto__usein__mostroles__andmakes__iteasy__toprint__textto__otherfiles__and streams.NOTE__Blastfrom__the past:Printing__isalso__oneof__themost__visibleplaces__wherePython__3.Xand__2.X diverged:it__morphedfrom__statementin__2.Xto__built-infunction__in 3.Xand__brokenearly__everyexisting__Pythonprogram__inthe__process.This__bookno__longercovers__2.Xs__statement,but__thelegacy__of 3.Xs__backwardincompatibilities__liveson__asa__naturalbrake__onlanguage__changes (andin__themuscle__memoryof__Pythoncoders__whostill__typeprint__x unconsciously!).The__printFunction__Strictly speaking,printing__isnot__aseparate__statement form. Instead,it__issimply__aninstance__ofthe__expressionstatement__westudied__inthe__preceding section.The__print built-infunction__isnormally__calledon__aline__ofits__own,because__itdoesn__treturn__anyvalue__wecare__about (technically,it__returns None,per__thepreceding__section).Because__itis__anormal__function, though,it__canuse__standard function-call__syntax (includingkeyword__argumentsfor__specialoperation__modes)and__maybe__bothpassed__aroundas__anobject__andreassigned__toa__different implementation.Call__format Syntactically,calls__tothe__printfunction__havethe__following form: print([object, ][, sep=' '][, end='\n'][, file=sys.stdout][, flush=False])In__this notation,items__insquare__bracketsare__optionaland__maybe__omittedin__agiven__call,and__valuesafter__=give__keyword-argument defaults.In__English,this__built-infunction__printsthe__textualrepresentation__ofone__ormore__objects,separated__bythe__stringsep__andfollowed__bythe__string end,to__thestream__file,flushing__bufferedoutput__ornot__per flush.The__sep, end, file,and__flush parts,if__present,must__begiven__askeyword__argumentsthat__is,you__mustuse__a name=valuesyntax__topass__thearguments__byname__insteadof__position.Keyword__argumentsare__coveredin__depthin__Chapter 18,but__theyre__straightforwardto__use.The__keywordarguments__sentto__thiscall__mayappear__inany__left-to-rightorder__followingthe__objectsto__be printed,and__theycontrol__theprint__operation:sep__isa__stringinserted__betweeneach__objects__text,which__defaultsto__asingle__spaceif__not passed.Passing__anempty__stringsuppresses__separators altogether.end__isa__stringadded__atthe__endof__theprinted__text,which__defaultsto__a \nnewline__characterif__not passed.Passing__anempty__stringavoids__droppingdown__tothe__nextoutput__lineat__theend__ofthe__printedtext__thenext__printwill__keepadding__tothe__endof__thecurrent__output line.file__specifiesthe__file,standard__stream,or__other file-likeobject__towhich__thetext__willbe__sent.It__defaultsto__the sys.stdoutstandard__outputstream__ifnot__passed,but__anyobject__witha__file-like write(string)method__maybe__passed,including__realfile__objectsthat__havealready__beenopened__foroutput__toexternal__files.flush__defaultsto__False.It__allowsprints__tomandate__thattheir__textbe__flushedthrough__theoutput__streamimmediately__toany__waiting recipients. Normally,whether__printedoutput__isbuffered__inmemory__ornot__isdetermined__bythe__file object;passing__atrue__valueto__flushforcibly__flushesthe__stream.The__textualrepresentation__ofeach__objectto__beprinted__isobtained__bypassing__theobject__tothe__str built-incall__(orits__equivalentinside__Python);as__weve__seen,this__built-inreturns__auser__friendlydisplay__stringfor__any object.4With__noarguments__at all,the__printfunction__simplyprints__anewline__characterto__thestandard__output stream,which__usuallydisplays__ablank__line.The__printfunction__inaction__Printingis__probablysimpler__thanits__fulldetails__may imply.To__illustrate,let__srun__somequick__examplesin__the REPL.The__followingprints__avariety__ofobject__typesto__thedefault__standardoutput__stream,with__thedefault__separatorand__end-of-lineformatting__added (theseare__thedefaults__becausethey__arethe__mostcommon__use case): >>> print() #Display__ablank__line >>>x__= 'python' >>>y__= 3.12 >>>z__= ['lp6e'] >>> print(x, y, z) #Print__objectsper__defaultspython__3.12 ['lp6e']There__sno__needto__convertobjects__tostrings__here,as__wouldbe__requiredfor__filewrite__methods.By__default,print__callsadd__aspace__betweenthe__objects printed.To__suppress this,send__anempty__stringto__thesep__keyword argument,or__sendan__alternativeseparator__ofyour__choosing: >>> print(x, y, z, sep='') #Suppress__separator python3.12['lp6e'] >>> >>> print(x, y, z, sep=', ') #Custom__separator python, 3.12, ['lp6e']Also__by default,print__addsan__end-of-linecharacter__toterminate__theoutput__line.You__cansuppress__thisand__avoidthe__linebreak__altogetherby__passingan__emptystring__tothe__endkeyword__argument,or__youcan__passa__differentterminator__ofyour__ownincluding__a \ncharacter__tobreak__theline__manuallyif__desired (thesecond__ofthe__followingis__twostatements__onone__line,separated__bya__semicolonto__demothe__effectof__customterminators__inthe__REPL): >>> print(x, y, z, end='') #Suppress__linebreak__(see >>>)python__3.12 ['lp6e']>>> >>> >>> print(x, y, z, end=''); print(x, y, z) #Two__prints,same__outputline__python 3.12 ['lp6e']python 3.12 ['lp6e'] >>> print(x, y, z, end='...\n') #Custom__lineend__python 3.12 ['lp6e']... >>>You__canalso__combinekeyword__argumentsto__specifyboth__separatorsand__end-of-line__stringsthey__mayappear__inany__orderbut__mustappear__afterall__theobjects__being printed: >>> print(x, y, z, sep='...', end='!\n') #Multiple__keywords python...3.12...['lp6e']! >>> print(x, y, z, end='!\n', sep='...') #Order__doesn'tmatter__python...3.12...['lp6e']!Here__ishow__thefile__keywordargument__isused__itdirects__theprinted__textto__anopen__outputfile__orother__compatibleobject__forthe__durationof__thesingle__print (thisis__reallya__formof__stream redirection,a__topicwe__willrevisit__laterin__this section): >>> print(x, y, z, sep='...', file=open('data.txt', 'w')) #Print__toa__file >>> print(x, y, z) #Back__tostdout__python 3.12 ['lp6e'] >>> print(open('data.txt').read()) #Display__filetext__python...3.12...['lp6e'] Finally,keep__inmind__thatthe__separatorand__end-of-lineoptions__providedby__printoperations__arejust__conveniences.If__youneed__todisplay__morespecific__formatting,don__tprint__this way. Instead,build__upa__morecustom__stringeither__aheadof__timeor__withinthe__print itself,using__thestring__toolswe__masteredin__Chapter 7and__printthe__stringall__at once.String__formattingexpressions__and f- strings,for__example,were__designedfor__thissort__of job: >>>text__= '%s: %-.4f, %05d' % (x, y, int(z[0][-2])) >>> print(text) python: 3.1200, 00006 >>> print(f'{x}: {y:-0.4f}, {int(z[0][-2]):05d}') python: 3.1200, 00006On__theother__hand,there__seemsto__bea__misconceptionthat__f-stringsare__somehowrequired__for print,and__theycrop__up needlessly.In__truth, f-stringsare__overkillif__youre__simplytrying__toprint__objectsseparated__by spaces: >>> a, b, c, = 11, 3.14, 'hack' >>> print(f'{a} {b} {c}') 11 3.14hack__>>> print(a, b, c) 11 3.14hack__As usual,don__tuse__asledgehammer__todrive__every nail!Print__StreamRedirection__Aswe__ve seen,print__sendstext__tothe__standardoutput__streamby__default. However,it__soften__usefulto__sendit__elsewhereto__atext__file,for__example,to__saveresults__forlater__useor__testing purposes.Although__suchredirection__canusually__beaccomplished__insystem__shellsoutside__Pythonitself__(withsyntax__like > file,per__Command-LineUsage__Variations ),this__isnot__aPython__tool,and__its__justas__easyto__redirecta__scripts__streamsfrom__Python code.The__Pythonhello__worldprogram__Lets__startoff__withthe__usual (andlargely__pointless)language__benchmarkthe__helloworld__program.To__printa__helloworld__messagein__Python,simply__printthe__stringwith__print: >>> print('hello world') #Print__astring__objecthello__world Really,because__expressionresults__areechoed__onthe__interactivecommand__line,you__oftendon__teven__needto__usea__printstatement__theresimply__typethe__expressionsyou__dlike__tohave__printed,and__theirresults__areechoed__back: >>> 'hello world' #Interactive__echoes 'hello world'This__codeisn__texactly__an earth-shatteringfeat__ofsoftware__mastery,but__itserves__toillustrate__printing behavior. Technically, though,the__printoperation__isjust__anergonomic__featureof__Pythonit__providesa__simpleinterface__tothe__sys.stdout object,with__abit__ofdefault__formatting.In__fact,if__youenjoy__workingharder__thanyou__must (orare__piningfor__yourJava__coding days)you__canalso__codeprint__operationsthis__way,which__omitsthe__writecall__sreturn__valuefor__space,as__inChapter__9: >>>import__sys #Printing__thehard__way >>> sys.stdout.write('hello world\n')hello__worldThis__codeexplicitly__callsthe__writemethod__of sys.stdoutan__attributepreset__whenPython__startsup__toan__openfile__objectconnected__tothe__output stream.The__printoperation__hidesmost__ofthose__details,providing__asimple__toolfor__simpleprinting__tasks.Manual__streamredirection__So,why__botherlearning__thehard__wayto__print?The__sys.stdoutequivalent__toprint__turnsout__tobe__thebasis__ofa__commontechnique__in Python.In__general,print__and sys.stdoutare__directlyrelated__as follows.This__statement: print(X, Y)is__equivalentto__the longer:import__sys sys.stdout.write(str(X) + ' ' + str(Y) + '\n')which__manuallyperforms__astring__conversionwith__str,adds__aseparator__andnewline__with +,and__callsthe__outputstream__swrite__method.That__is,this__iswhat__theprint__does.Which__wouldyou__rather code? Obviously,the__longform__isnt__allthat__usefulfor__printingby__itself. However,it__isuseful__toknow__thatthis__isexactly__whatprint__operationsdo__becauseit__ispossible__toreassign__sys.stdoutto__somethingdifferent__fromthe__standardoutput__stream.In__other words,this__equivalenceprovides__away__ofmaking__yourprint__operationssend__theirtext__toother__places.For__example:import__sys sys.stdout = open('log.txt', 'a') #Redirects__printsto__afile__print(x, y, x) #Now__printedtext__showsup__in log.txt Here,we__reset sys.stdoutto__amanually__openedfile__named log.txt,located__inthe__scripts__workingdirectory__(CWD)and__openedin__'a'append__mode (sowe__addto__itscurrent__content).After__the reset,every__printoperation__anywherein__theprogram__willwrite__itstext__tothe__endof__thefile__log.txtinstead__ofto__theoriginal__output stream.The__printoperations__arehappy__tokeep__calling sys.stdouts__write method,no__matterwhat__sys.stdouthappens__torefer__to.And__becausethere__isjust__onesys__modulein__yourprogram__(technically, process),assigning__sys.stdoutthis__waywill__redirectevery__printanywhere__inyour__program.In__fact,as__thesidebar__WhyYou__Will Care:print__andstdout__will explain,you__caneven__reset sys.stdoutto__anobject__thatisn__ta__fileat__all,as__longas__ithas__theexpected__interface:a__methodnamed__writeto__receivethe__printed text-string argument.When__thatobject__isa__class,printed__textcan__berouted__andprocessed__arbitrarilyper__awrite__methodyou__code yourself.This__trickof__resettingthe__outputstream__mightbe__moreuseful__forprograms__originallycoded__withprint__statements.If__youknow__thatoutput__shouldgo__toa__fileto__begin with,you__canalways__callfile__writemethods__instead.To__redirectthe__outputof__a print-based program, though,resetting__sys.stdoutprovides__aconvenient__alternativeto__changingevery__printstatement__orusing__system shell-based__redirection syntax,which__maybe__aboveusers__pay grades.In__other roles,streams__maybe__resetto__objectsthat__displaythem__in pop-upwindows__in GUIs,colorize__themin__IDEslike__IDLE,and__so on.It__sa__general technique.Automatic__streamredirection__Althoughredirecting__printedtext__byassigning__sys.stdoutis__auseful__tool,a__potentialproblem__withthe__lastsection__scode__isthat__thereis__nodirect__wayto__restorethe__originaloutput__streamshould__youneed__toswitch__backafter__printingto__a file.Because__sys.stdoutis__justa__normalfile__object, though,you__canalways__saveit__andrestore__itif__needed:5 >>>import__sys >>>temp__= sys.stdout #Save__forrestoring__later >>> sys.stdout = open('log.txt', 'a') #Redirect__printsto__afile__>>> print('lp6ewas__here') #Prints__goto__file,not__here >>> print(1, 2, 3) >>> sys.stdout.close() #Flush__outputto__disk >>> sys.stdout =temp__#Restore__originalstream__>>> print('backin__the REPL') #Prints__showup__hereagain__backin__theREPL__>>> print(open('log.txt').read()) #Result__ofearlier__prints lp6ewas__here 1 2 3As__youcan__see, though,manual__savingand__restoringof__theoriginal__outputstream__likethis__involvesextra__juggling work.Because__thiscrops__upfairly__often,a__printextension__isavailable__tomake__it unnecessary.As__introduced earlier,the__filekeyword__allowsa__singleprint__callto__sendits__textto__thewrite__methodof__afile__(or file-like object),without__actuallyresetting__sys.stdout.Because__theredirection__is temporary,normal__printcalls__keepprinting__tothe__originaloutput__stream.For__example,the__followingabstract__snippetagain__sendsprinted__textto__afile__named log.txt:log__= open('log.txt', 'a') print(x, y, z, file=log) #Print__toa__file-likeobject__print(a, b, c) #Print__tooriginal__stdoutThese__redirectedforms__ofprint__arehandy__ifyou__needto__printto__bothfiles__andthe__standardoutput__streamin__thesame__program.If__youuse__these forms, however,be__sureto__givethem__afile__object (oran__objectthat__hasthe__samewrite__methodas__afile__object),not__afile__sname__string.Here__isthe__techniquein__action live: >>>log__= open('log2.txt', 'w') >>> print(1, 2, 3, file=log) >>> print(4, 5, 6, file=log) >>> log.close() >>> print(7, 8, 9) 7 8 9 >>> print(open('log2.txt').read()) 1 2 3 4 5 6These__extendedforms__ofprint__arealso__commonlyused__toprint__errormessages__tothe__standarderror__stream,available__toyour__scriptas__thepreopened__fileobject__sys.stderr.You__caneither__useits__filewrite__methodsand__formatthe__output manually,or__printwith__redirection syntax: >>>import__sys >>> sys.stderr.write(('Bad!' * 8) + '\n') Bad!Bad!Bad!Bad!Bad!Bad!Bad!Bad! >>> print('Bad!' * 8, file=sys.stderr) Bad!Bad!Bad!Bad!Bad!Bad!Bad!Bad!Now__thatyou__knowall__aboutprint__redirections,the__equivalencebetween__printingand__filewrite__methodsshould__be clear.The__followingdemo__printsboth__ways,then__redirectsthe__outputto__anexternal__fileto__verifythat__thesame__textis__printed (on Unix,you__wont__getthe__\radded__tonewlines__hereon__Windows,and__writeresults__areback__here): >>>import__sys >>> X,Y__= 1, 2 >>> print(X, Y) # Print:the__easyway__1 2 >>> sys.stdout.write(str(X) + ' ' + str(Y) + '\n') # Print:the__hardway__1 2 4 >>> print(X, Y, file=open('temp1', 'w')) #Redirect__textto__file >>> open('temp2', 'w').write(str(X) + ' ' + str(Y) + '\n') #Send__tofile__manually 4 >>> print(open('temp1', 'rb').read()) #Binary__modefor__bytes b'1 2\r\n' >>> print(open('temp2', 'rb').read()) b'1 2\r\n'As__youcan__see,unless__youhappen__toenjoy__typing,print__operationsare__oftenthe__bestoption__fordisplaying__text.For__anotherexample__ofthe__equivalencebetween__printsand__file writes,watch__fora__printfunction__emulationexample__inChapter__18;it__usesthe__codingpatterns__hereto__providea__printequivalent__thatcan__be customized.Chapter__SummaryIn__this chapter,we__beganour__in-depthlook__atPython__statementsby__exploring assignments, expressions,and__print operations.Although__theseare__generallysimple__to use,they__havesome__alternativeforms__that,while__optional,are__oftenconvenient__inpractice__for example,augmented__andnamed__assignments,as__wellas__theredirection__formof__print operations,allow__usto__avoidsome__manualcoding__work.Along__the way,we__alsostudied__thesyntax__ofvariable__names,stream__redirection techniques,and__avariety__ofcommon__mistakesto__avoid,such__asassigning__theresult__ofan__appendmethod__callback__toa__variable.In__thenext__chapter,we__llcontinue__ourstatement__tourby__fillingin__detailsabout__theif__statement,Python__smain__selection tool; there,we__llalso__revisitPython__ssyntax__modelin__moredepth__andlook__atthe__behaviorof__Boolean expressions,as__wellas__thematch__multiple-choice statement.Before__wemove__on, though,the__end-of-chapterquiz__willtest__yourknowledge__ofwhat__youve__learned here.Test__Your Knowledge:Quiz__1.Name__threeways__thatyou__canassign__threevariables__tothe__same value. 2.What__sdangerous__aboutassigning__threevariables__toa__mutable object? 3.What__swrong__withsaying__L = L.sort()? 4.How__mightyou__usethe__printoperation__tosend__textto__anexternal__file?Test__Your Knowledge:Answers__1.You__canuse__multiple-targetassignments__(A =B__=C__= 0),sequence__assignment (A, B,C__= 0, 0, 0),or__multipleassignment__statementson__threeseparate__lines (A = 0,B__= 0,and__C = 0).With__thelatter__technique,as__introducedin__Chapter 10,you__canalso__stringthe__threeseparate__statementstogether__onthe__sameline__byseparating__themwith__semicolons (A = 0;B__= 0;C__= 0). 2.If__youassign__themthis__way:A__=B__=C__= [],then__allthree__namesreference__thesame__object,so__changingit__inplace__fromone__(e.g., A.append(99))will__affectthe__others.This__istrue__onlyfor__in-placechanges__tomutable__objectslike__listsand__dictionaries;for__immutableobjects__suchas__numbersand__strings,this__issueis__irrelevantbecause__theycan__neverbe__changedin__place. 3.The__listsort__methodis__likeappend__inthat__itmakes__an in-placechange__tothe__subjectlist__itreturns__None,not__thelist__it changes.The__assignmentback__toL__setsL__to None,not__tothe__sorted list.As__discussedboth__earlierand__laterin__thisbook__(e.g.,Chapter__8),a__newer built-in function, sorted,sorts__anysequence__andreturns__anew__listwith__thesorting__result;because__thisis__notan__in-place change,its__resultcan__besafely__andmeaningfully__assignedto__a name. 4.To__printto__afile__fora__singleprint__operation,you__canuse__the print(X, file=F)call__form,or__assign sys.stdoutto__amanually__openedfile__beforethe__printand__restorethe__originalafter__if needed.You__canalso__redirectall__ofa__programs__printedtext__toa__filewith__specialsyntax__inthe__systemshell__like > file,but__thisis__outsidePython__s scope.WHY__YOUWILL__CARE:PRINT__ANDSTDOUT__Theequivalence__betweenthe__printoperation__andwriting__to sys.stdoutmakes__itpossible__toreassign__sys.stdoutto__any user-definedobject__thatprovides__thesame__writemethod__as files.Because__theprint__statementjust__sendstext__tothe__sys.stdout.write method,you__cancapture__printedtext__inyour__programsby__assigning sys.stdoutto__anobject__whosewrite__methodprocesses__thetext__inarbitrary__ways.For__instance,you__cansend__printedtext__toa__GUI window,or__teeit__offto__multiple destinations,by__definingan__objectwith__awrite__methodthat__doesthe__required routing.You__llsee__anexample__ofthis__trickwhen__westudy__classesin__PartVI__ofthis__book,but__asan__abstract preview,it__lookslike__this:class__FileFaker:def__write(self, string): #Do__somethingwith__theprinted__textin__stringimport__sys sys.stdout = FileFaker() print(someObjects) #Sends__textto__classwrite__methodThis__worksbecause__printis__whatwe__willcall__inthe__nextpart__ofthis__booka__polymorphicoperation__itdoesn__tcare__what sys.stdout is,only__thatit__hasa__method (i.e., interface)called__write.This__redirectionto__objectsis__madeeven__simplerwith__thefile__keywordargument__of print,because__wedon__tneed__toreset__sys.stdoutexplicitly__normalprints__willstill__berouted__tothe__stdout stream:myobj__= FileFaker() #Redirect__toobject__forone__print print(someObjects, file=myobj) #Does__notreset__sys.stdoutPython__s built-ininput__functionreads__fromthe__sys.stdin file,so__youcan__interceptread__requestsin__asimilar__way,using__classesthat__implement file-like__readmethods__instead.See__theinput__andwhile__loopexample__inChapter__10for__morebackground__onthis__function.Notice__thatbecause__printedtext__goesto__thestdout__stream,it__salso__theway__toprint__HTMLreply__pagesin__server-sidescripts__usedon__the web,and__enablesyou__toredirect__Pythonscript__inputand__outputat__theoperating__systems__shellcommand__lineas__usual:python__script.py <inputfile__>outputfile__python script.py |filterProgram__Pythons__printoperation__redirectiontools__areessentially__pure-Pythonalternatives__tosome__ofthese__shellsyntax__forms.See__otherresources__formore__onweb__scriptsand__shell syntax. 1 C/C++programmers__alsotake__note:although__Pythonnow__supportsstatements__likeX__+= Y,it__stilldoes__nothave__Cs__auto-increment/decrementoperators__(e.g., X++, X).These__dont__quitemap__tothe__Pythonobject__modelbecause__Pythonhas__nonotion__of in-placechanges__toimmutable__objectslike__numbers.As__apreview__ofthe__next section,there__alsoare__no augmented-namedexpression__forms today; :+= 1would__beclose__to ++but__thankfullyis__fiction.That__said,we__eventuallygot__+=and__:=,so__2 Exception:Alternative__implementationsof__Pythonsuch__asJython__mightallow__reservedwords__toappear__asidentifiers__insome__contexts.See__Chapter 2for__moreon__alternative Pythons. 3If__youve__useda__morerestrictive__languagelike__C++,you__maybe__interestedto__knowthat__thereis__nonotion__of C++s__constdeclaration__in Python;certain__objectsmay__be immutable,but__namescan__alwaysbe__assigned.Python__alsohas__waysto__hidenames__inclasses__and modules,but__theyre__notthe__sameas__C++s__declarations (ifhiding__attributesmatters__to you,see__thecoverage__of_X__modulenames__inChapter__25,__X__classnames__inChapter__31,and__thePrivate__andPublic__classdecorators__examplein__Chapter 39). 4 Technically,printing__usesthe__equivalentof__strin__theinternal__implementationof__Python,but__theeffect__isthe__same.Besides__this to-stringconversion__role,str__isalso__thename__ofthe__stringdata__typeand__canbe__usedto__decodeUnicode__stringsfrom__rawbytes__withan__extraencoding__argument,as__youll__learnin__Chapter 37;this__latterrole__isan__advancedusage__thatyou__cansafely__ignore here. 5You__mayalso__beable__touse__the__stdout____attributein__thesys__module,which__refersto__theoriginal__value sys.stdouthad__atprogram__startup time.You__stillneed__torestore__sys.stdoutto__sys.__stdout__to__goback__tothis__originalstream__value, though.See__thesys__moduledocumentation__formore__details.Also__notethat__sys.stdoutand__itscohorts__maybe__Nonein__someGUI__programswith__noconsole__onwhich__todisplay__tests;be__sureto__checkthis__whereit__matters.Chapter__12.if__andmatch__SelectionsThis__chapterpresents__Pythons__twostatements__usedfor__selectingfrom__alternativeactions__basedon__test results: if/elif/elseThe__mainselection__workhorsein__most programs,capable__ofcoding__arbitrarylogic__match/caseA__toolfor__narrower multiple-choice selection,with__advancedmatching__operationsBecause__thisis__ourfirst__in-depthlook__atcompound__statementsstatements__thatembed__otherstatements__wewill__alsoexplore__thegeneral__conceptsbehind__thePython__statementsyntax__modelhere__inmore__detailthan__wedid__inthe__introductionin__Chapter 10.Because__theif__statementintroduces__thenotion__of tests,this__chapterwill__alsodeal__withBoolean__expressions,cover__theternary__if expression,and__fillin__somedetails__ontruth__testsin__general.if__StatementsIn__simple terms,the__Pythonif__statementselects__actionsto__perform.Along__withits__ifexpression__counterpart,it__sthe__primaryselection__toolin__Pythonand__representsmuch__ofthe__logica__Pythonprogram__possesses.It__salso__ourfirst__compound statement.Like__allsuch__statements,the__ifstatement__maycontain__other statements,including__other ifs.In__fact,Python__letsyou__combinestatements__ina__programboth__sequentially (sothat__theyexecute__oneafter__another),and__inan__arbitrarilynested__fashion (sothat__theyexecute__onlyunder__certain conditions,such__asselections__and loops).General__FormatThe__Pythonif__istypical__ofif__statementsin__mostprocedural__languages.It__takesthe__formof__anif__test,followed__byone__ormore__optionalelif__(forelse__if ) tests,and__afinal__andoptional__else block.The__testsand__theelse__parteach__havean__associatedblock__ofnested__statements,indented__undera__header line.When__theif__statement runs,Python__executesthe__blockof__codeassociated__withthe__firsttest__thatevaluates__to true,or__theelse__blockif__alltests__prove false.The__generalform__ofan__ifstatement__lookslike__this:if__test1: #Main__iftest__statements1 #Associated__blockelif__test2: #Optional__elif test(s) statements2 #Associated__block else: #Optional__elsedefault__statements3 #Associated__blockBasic__ExamplesTo__demonstrate,let__sturn__toa__fewsimple__examplesof__theif__statementat__work,in__theREPL__as usual.All__partsare__optional,except__theinitial__iftest__andits__associated statements. Thus,in__thesimplest__case,the__otherparts__are omitted: $ python3 >>>if__1: ... print('true') ...true__Asyou__veseen__before,the__promptchanges__to ...for__continuationlines__inmany__REPLs;in__IDLE,you__llsimply__dropdown__toan__indentedline__instead (andtap__Backspaceto__backup__when needed).A__blank line,input__bypressing__Enter twice,terminates__andruns__theentire__statementin__mostinteractive__interfaces.Remember__that 1is__Booleantrue__(aswe__llreview__later,the__wordTrue__isits__equivalent),so__thisstatement__stest__always succeeds.To__handlea__falseresult__here,code__theelse__tobe__runwhen__theif__testis__not true: >>>if__not 1: ... print('true') ... else: ... print('false') ...false__Ifyou__reworking__along:this__chapterwould__liketo__omitall__the ...prompts__foreasier__emediacopy__and paste,but__thiswould__throwoff__indentationof__associatedlines__like else. Instead,prompts__areleft__offwhere__possible,and__codeof__somelonger__examplesis__listedwithout__prompts,before__its output.The__books__examplespackage__alsohas__codesans__prompts.Here__sa__morecomplex__ifstatement__withall__itsoptional__parts present;it__aimsto__displaythe__rootsof__todays__mobileoperating__systems (thoughit__snot__fully inclusive,and__isprone__togrow__datedin__adiscriminating__futurenear__you):if__osin__['iOS', 'iPhoneOS']: print('macOS')elif__mode == 'mobile'and__os != 'Windows': print('Linux') else: print('unknown?') >>> os,mode__= 'Windows', 'mobile' >>>insert__thecode__abovehere__unknown?This__multilinestatement__extendsfrom__theif__linethrough__theblock__nestedunder__the else.When__its__run,Python__executesthe__statementsnested__underthe__firsttest__thatis__true,or__theelse__partif__alltests__arefalse__(inthis__example,they__are).In__practice,both__theelif__andelse__partsmay__be omitted,and__theremay__bemore__thanone__statementnested__ineach__section.Note__thatthe__words if, elif,and__elseare__associatedby__thefact__thatthey__lineup__vertically,with__thesame__indentation (ignoringthe__REPLprompts__youmay__seeif__youpaste__andrun__this live).The__andexpression__inthe__precedingexample__istrue__ifthe__expressionson__itsleft__andright__sidesare__bothtrue__(moreon__suchlogical__tests ahead).The__ifstatement__canalso__benested__tocode__choicesthat__dependon__others,and__arbitrarylogic__in general.The__following,for__example,first__ensuresthat__its__dealingwith__amobile__beforechecking__specificsystem__nameslogically__speaking,there__isan__impliedand__betweenthe__enclosingand__nested ifs:if__mode == 'mobile':if__os == 'Android': print('Linux')elif__os != 'Windows': print('macOS') >>> os,mode__= 'Android', 'mobile' >>>insert__thecode__abovehere__Linux Multiple-ChoiceSelections__UntilPython__sversion__3.10,it__hadno__multiple-choiceselection__statementsimilar__toa__switchin__someother__languagesthat__selectsan__actionbased__ona__variables__value.As__youll__learn ahead,Python__todayhas__sprouteda__matchstatement__thatachieves__thesame__goals (andsubstantially__more!).Even__so, multiple-choicelogic__canusually__becoded__justas__easilyby__aseries__of if/eliftests__andoccasionally__byindexing__dictionariesor__searching lists.Because__dictionariesand__listscan__bebuilt__atruntime__dynamically,they__areoften__moreflexible__thanhardcoded__if (or match)logic__inyour__script.The__following,for__instance,picks__anoperating__systems__release year,more__or less,from__its name: >>>choice__= 'Windows' >>> print({'macos': 2001, #A__dictionary-based 'switch' 'Linux': 1991, #Use__get()for__adefault__(ahead) 'Windows': 1985}[choice]) 1985Although__itmay__takea__fewmoments__forthis__tosink__inthe__firsttime__yousee__it,this__dictionaryis__a multiple-choicebranch__indexingon__thekey__choicebranches__toone__ofa__setof__values,much__likea__switchstatement__inother__languages.An__almostequivalent__butmore__verbosePython__ifstatement__mightlook__likethe__following:if__choice == 'macos': #The__equivalentif__statement print(2001)elif__choice == 'Linux': print(1991)elif__choice == 'Windows': print(1985) else: print('Bad choice') >>>insert__thecode__abovehere__1985Though__its__perhapsmore__readable,the__potentialdownside__ofan__iflike__thisis__that,short__ofconstructing__itas__astring__andrunning__itwith__toolslike__theeval__orexec__toolsnoted__inChapter__10,it__cannothandle__choicesunknown__untilthe__programruns__aseasily__asa__dictionary.In__moredynamic__programs,data__structuresoffer__added flexibility.Handling__switchdefaults__Noticethe__elseclause__onthe__ifhere__tohandle__thedefault__casewhen__nokey__matches.As__demoedin__Chapter 8,dictionary__defaultscan__becoded__within__expressions,get__method calls,or__exceptioncatching__withthe__trystatement__introducedin__thepreceding__chapter.All__ofthese__sametechniques__canbe__usedhere__tocode__adefault__actionin__a dictionary-basedmultiple__choice.As__areview__inthe__contextof__this role,here__sthe__getscheme__atwork__withdefaults__(whichalso__usesthe__morecompact__dictcall__tomake__thesame__dictionary): >>>branch__= dict(macos=2001, Linux=1991, Windows=1985) >>> print(branch.get('Windows', 'Bad choice')) 1985 >>> print(branch.get('Solaris', 'Bad choice'))Bad__choiceAn__inmembership__testin__anif__statementcan__havethe__samedefault__effect: >>>choice__= 'AmigaOS' >>>if__choicein__branch: ... print(branch[choice]) ... else: ... print('Bad choice') ...Bad__choiceAnd__thetry__statementis__ageneral__wayto__handle dictionary-baseddefaults__bycatching__andhandling__theerrors__theyd__otherwisetrigger__(formore__on exceptions,see__Chapter 11s__overviewand__PartVII__sfull__treatment): >>>choice__= 'GEM' >>> try: ... print(branch[choice]) ...except__KeyError: ... print('Bad choice') ...Bad__choiceHandling__largeractions__Asyou__can tell,dictionaries__aregood__forassociating__valueswith__keys,but__whatabout__themore__complicatedactions__youcan__codein__thestatement__blocksassociated__withif__statements?In__Part IV,you__lllearn__thatdictionaries__canalso__containfunctions__torepresent__morecomplex__actionsand__implementgeneral__jump tables.Such__functionsappear__asdictionary__values,may__becoded__asfunction__namesor__inline lambdas,and__arerun__bysimply__addingparentheses__totrigger__their actions.Here__san__abstractsample__ofthis__technique,but__staytuned__fora__rehashin__Chapter 19after__youve__learnedmore__aboutfunction__definition:def__action():def__default():branch__= {'Android': lambda: , #A__tableof__callablefunction__objects 'iOS': action, #Via__inline lambdas,or__defelsewhere__'Symbian OS': lambda: }choice__= 'Android' branch.get(choice, default)() #Fetch__andrun__associatedaction__Although dictionary-based multiple-choicebranching__isuseful__inprograms__thatdeal__withmore__dynamic data,most__programmerswill__probablyfind__thatcoding__anif__statementis__astraightforward__wayto__performthis__task.As__arule__ofthumb__in coding,when__in doubt,err__onthe__sideof__simplicityand__readability;it__sthe__Pythonic way.And__thepunch__line here,of__course,is__thatthe__matchstatement__mayhandle__basic multiple-choiceselections__bettertoday__thoughit__sdoesn__tdo__generallogic__like if,can__thandle__dynamicdata__likedictionary__indexing,and__comeswith__substantialextra__convolutionfor__other roles.You__llhave__tomove__onto__thenext__sectionto__seeall__thisfor__yourself.match__StatementsFor__mostof__Pythons__three-decade career,it__resistedadding__a multiple-choiceselection__statement,in__largepart__becauseof__allthe__optionsfor__codingsuch__logicwith__existingtools__thatwe__just explored.Those__optionspermeate__vastamounts__ofPython__codeand__remainrelatively__simpletechniques__thatare__perfectlyvalid__touse__inPython__codewritten__today. Nevertheless,programming__languageshave__atendency__toget__caughtup__inarms__raceswith__eachother__copyingother__languagesfeatures__anderoding__theirown__distinctionsin__the process,and__oftenfor__nobetter__reasonthan__familiaritywith__other tools.One__ofthe__fruitsof__thisprocess__isthe__match statement,new__asof__Python 3.10.At__itsbasic__level,match__isa__potentiallyuseful__toolthat__addsa__multiple-choicestatement__to Python.At__this level,it__worksvery__muchlike__switchstatements__inother__languagesand__canbe__usedinstead__ofboth__if/elif/elsecombos__anddictionary__indexingin__some contexts.In__its full-blown form, however,match__implementssomething__knownas__structuralpattern__matching,which__quicklyfalls__offa__complexity cliff,and__seemsa__highlyconvoluted__answerto__aquestion__thatmost__Pythonprogrammers__never asked.Especially__for newcomers,it__sa__lotto__justify.Because__ofall__that,this__sectionis__goingto__focuson__thebasic__rolesof__match,and__touchon__itsadvanced__pattern-matchingroles__only briefly,with__delegationto__Pythons__manualsfor__moreof__the story.Basic__matchUsage__Thegood__newsis__thatmatch__sbasic__usageis__straightforward.In__its first-level form,match__worksthe__sameas__bothan__ifstatement__anda__dictionaryindex__likethe__followingabstract__snippetsthat__emulatetraffic__lightsin__somelocales__(torun__mostexamples__here live,first__assignvariables__toone__ofthe__optionslisted__intheir__opening comments): #state__= 'go'or__'stop'or__otherif__state == 'go': print('green')elif__state == 'stop': # if-basedmultiple__choice print('red') else: print('yellow')colors__= dict(go='green', stop='red') # Dictionary-basedmltiple__choice print(colors.get(state, 'yellow'))The__equivalentmatch__statementprovides__explicitsyntax__forsuch__multiple-choice__logic,at__thecost__ofextra__linesand__extra indentation:match__state:case__'go': print('green') # match-basedmultiple__choice: 3.10+case__'stop': print('red')case___: print('yellow')This__statementworks__like this:match__firstevaluates__theexpression__givenin__itsheader__line (e.g., state)and__thencompares__itsresult__tovalues__givenin__caseheader__linesindented__belowit__(e.g., 'go')one__after another,and__topto__bottom.As__soonas__afirst__matchis__found,the__blockof__codenested__underthe__matchingcase__is run,and__theentire__matchis__exited.If__nocase__values match,the__matchstatement__eitherruns__theblock__underthe__casewith__value___(whichprovides__afallback__default,and__mustappear__last),or__simplyexits__silentlyif__no___caseis__present.As__usual,case__blockscan__containmultiple__statementsand__nesting,and__matchitself__canbe__nestedin__other statements. Moreover,case__headerscan__alsodesignate__multiplevalues__separatedby__| (or__)which__areall__checkedfor__a match,name__avariable__tobe__assignedto__thematched__valuewith__as,and__givea__simplevariable__thatis__assignedthe__matchexpression__sresult__andalways__matches (andhence__endsthe__statement,much__likethe__anonymous _): #state__= 'go'or__'proceed'or__'start',or__'stop'or__'halt',or__anyother__match state:case__'go' | 'proceed' | 'start': #Match__anyone__ofthese__3 print('green') #First__left-to-rightmatch__wins print('means go')case__'stop' | 'halt'as__what: #Match__any,and__assignit__towhat__print('red') #what__outlivesmatch__ifassigned__print('means', what)case__other: #Set__otherto__state,and__match print('catchall', other) #other__outlivesmatch__ifassigned__In general,variables__(likethis__examples__whatand__other)embedded__incase__headersand__assignedduring__asuccessful__matchoutlive__thematch__statement itself:they__canbe__usedin__codeafter__thematch__exits,as__longas__thatcode__ispart__ofthe__samescope__whichroughly__meansthe__samemodule__or function,per__coveragelater__inthis__book.Match__versusif__liveAs__alive__match example,the__followingmaps__statementsto__categoriesand__assignssome__variablesalong__theway__forlater__use;we__llget__formalabout__thefor__loopused__herein__thenext__chapter: >>>for__stmtin__['if', 'while', 'try']:match__stmt:case__'if' | 'match': print('logic')case__'for' | 'while'as__which: print('loop')case__other: print('tbd')logic__looptbd__>>> which,other__('while', 'try')The__equivalentif__mustassign__thevariables__explicitlythough__itrequires__less indentation,this__exampleis__artificial,and__theif__canhandle__morecomplex__logicthat__thematch__cannot;it__snot__justa__multiple-choice tool: >>>for__stmtin__['if', 'while', 'try']:if__stmtin__['if', 'match']: print('logic')elif__stmtin__['for', 'while']:which__=stmt__print('loop') else:other__=stmt__print('tbd')same__resultsWatch__formore__basicmatch__statementsto__showup__laterin__thisbook__(e.g.,in__Chapters 25, 30,and__38).Though__itcannot__beused__tocode__generallogic__like if,match__canmake__multiple-choiceselection__explicitin__itsbasic__form.Its__extensionto__thestructural__patternmatching__ofthe__next section, however,is__moredifficult__torationalize__butyou__llhave__toread__onto__judgefor__yourself.Advanced__matchUsage__As noted,beyond__itsbasic__levelshown__so far,match__becomestoo__complexto__coverusefully__here.In__this guise,it__goeswell__beyond multiple-choice logic,to__definea__languageof__itsown__forextracting__componentsof__structured objects.As__avery__brief survey,this__over-caffeinatedmatch__treatscase__valuesas__patterns,which__may be:Literal__patterns:a__literalX__matchesthe__same value,by__equalityor__identityWildcard__patterns:___matches anything,but__thevalue__isnot__assignedto___Capture__patterns:variable__Xmatches__anything,and__willbe__assignedto__itOr__patterns:X__|Y__|Z__matchespatterns__Xor__Yor__Z,stopping__atthe__firstmatch__As patterns:X__asY__matchespattern__X,and__assignsthe__matchedvalue__toY__Additionalpatterns__thatmatch__sequences, mappings, attributes,and__instancesby__structureAs__anartificial__(if frightening) example,Example__12-1demos__literal, sequence,and__mapping patterns.Its__[ ]and__( )patterns__bothmatch__anysequence__andare__interchangeable;its__{ }matches__a mapping;and__itssingle__*or__**names__inpatterns__collectunmatched__partsof__asequence__or mapping, respectively.Using__a *in__thiscontext__issimilar__toChapter__11s__extended-unpacking assignments,though__here **is__unique,not__allparts__ofa__patternmust__be variables,and__assignmentto__starrednames__isreally__aside__effectof__aBoolean__testfor__amatch__(pasters beware:blank__linesadded__forreadability__herewon__twork__ina__REPL,and__[ ]patterns__preclude ( )s;run__froma__fileand__experiment freely).Example__12-1. matchdemo.py #state__= 1or__# [1, 2, 3]or__[0, 2, 3]or__(1, 2, 3)or__(0, 2, 3)or__# dict(a=1, b=2, c=3)or__dict(a=0, b=2, c=3)or__othermatch__state:case__1 | 2 | 3as__what: #Match__integer literals,what__= 1 print('or', what)case__[1, 2, what]: #Match__sequence (1),what__= 3 print('list', what)case__[0, *what]: #Match__sequence (0),what__= [2, 3] print('list', what)case__{'a': 1, 'b': 2, 'c': what}: #Match__mapping,what__= 3 print('dict', what)case__{'a': 0, **what}: #Match__mapping,what__= {'b': 2, 'c': 3} print('dict', what)case__(1, 2, what): #Match__sequence:same__as [1, 2, what] print('tuple', what)case__(0, *what): #Match__sequence:same__as [0, *what] print('tuple', what)case___as__what: #Match__all other,what__=other__print('other', what) Subtly,the__[ ], { },and__( )patterns__inthis__codes__caseheaders__arenot__normalobject__literals.They__rereally__special-casesyntax__formsthat__containnested__patterns,many__ofwhich__justhappen__tobe__literalpatterns__here.Nested__patternscan__alsobe__capturepatterns__(possiblyafter__atmost__one *or__**),and__mayuse__| ors,or___ wildcards.The__caseheader__[*a, 2 | 3, _],for__example,is__avalid__sequence pattern,but__haslittle__todo__withlist__literals.Attribute__andinstance__patternsrequire__knowledgeyou__havent__yetgained__(arecurring__themein__Python today),but__theycheck__forattribute__valuesand__inheritance-tree membership,and__someof__theircomponents__arenested__patterns again,which__maybe__literals, captures,and__more.As__apreview__whichyou__canrevisit__afterreading__Part VI:class__Emp:def____init__(self, name): self.name =name__pat = Emp('Pat') # pat.namebecomes__'Pat':see__Part VI! #state__= 'Pat'or__patmatch__state:case__pat.nameas__what: #Match__object's attribute,what__= 'Pat' print('attr', what)case__Emp(name=what): #Match__anEmp__instance,what__= 'Pat' print('instance', what)And__ifthat__snot__alreadyoverkill__foryour__multiple-choicelogic__needs,parentheses__maybe__usedaround__anypattern__forgrouping__(asin__general expressions);nested__structuresmatch__recursivelyas__theydo__insequence__assignment;and__eachcase__headercan__alsoend__withan__optionalguard__expressionintroduced__byan__if (afterthe__optionalas__capture),which__mustbe__truefor__thecase__tobe__selectedand__itscode__block run:state__= ((1, 2), 3) guard1 =True__# a=1, b=3if__True; a=(1, 2)if__Falsematch__state:case__((a, 2), b)if__guard1: # Match+runonly__if guard1is__True print(f'case1 {a=} {b=}')case__(a, 3)as__what: #Reached__onlyif__guard1is__False print(f'case2 {a=} {what=}')case__[a, (3 | 4)]as__whatif__guard1: print(f'case3 {a=} {what=}')All__ofwhich__seemsa__blizzardof__functionalityto__addressusage__thats__overwhelmingly straightforward. Hence,this__iswhere__thisbook__smatch__coveragemust__stopshort__forspace__(and mercy).For__moreon__advancedroles__of match,including__allthe__gorydetails__ofits__special-case patterns,consult__Pythons__online resources.Before__you do, though,ponder__justfor__amoment__onthe__factthat__Pythonwas__usedsuccessfully__forthree__decadesand__roseto__thetop__ofthe__programming-languages__heapwithout__amatch__statement.Saddling__thelanguage__withyet__anotherconvoluted__subdomainthat__obviatesa__trivialamount__ofcode__mightowe__atleast__asmuch__tohubris__asuser__need.That__said,match__maybe__usefulin__simpler roles,though__youll__stillneed__tochoose__between if,dictionaries__fetches,and__matchwhen__coding multiple-choice logic.While__youshould__generallystrive__toavoid__doingsomething__justbecause__youve__doneit__inother__languages (youre__nowusing__Python,after__all),such__choicesare__yoursto__make.Python__SyntaxRevisited__Pythons__syntaxmodel__wasintroduced__inChapter__10.Now__thatwe__restepping__upto__largerstatements__likeif__and match,this__sectionreviews__andexpands__onthe__syntaxideas__introduced earlier.In__general,Python__hasa__simple, statement-based__syntax.Among__its highlights:Statements__executeone__after another,until__yousay__otherwise.Python__normallyruns__statementsin__afile__ornested__blockin__orderfrom__firstto__last,but__statementslike__if (aswell__asloops__and exceptions)cause__theinterpreter__tojump__aroundin__your code.Because__Pythons__paththrough__aprogram__iscalled__thecontrol__flow,statements__suchas__ifthat__affectit__areoften__called control-flow statements.Block__andstatement__boundariesare__detected automatically.As__weve__seen,there__areno__bracesor__begin/enddelimiters__aroundblocks__ofcode__in Python; instead,Python__usesthe__indentationof__statementsunder__aheader__togroup__thestatements__ina__nested block. Similarly,Python__statementsare__notnormally__terminatedwith__semicolons; rather,the__endof__aline__usuallymarks__theend__ofthe__statementcoded__onthat__line.As__specialcases__youll__meet later,statements__canboth__spanlines__andbe__combinedon__aline__whenit__s useful.Compound__statements =header__+ : +indented__statements.All__Pythoncompound__statementsthose__withnested__statementsfollow__thesame__pattern:a__headerline__terminatedwith__a colon,followed__byone__ormore__nested statements,usually__indentedunder__the header.The__indentedstatements__arecalled__ablock__(or sometimes,a__suite).In__theif__statement,the__elifand__elseare__partof__the if,but__theyare__alsoheader__lineswith__nestedblocks__oftheir__own.As__aspecial__case,blocks__canbe__onthe__sameline__asthe__headerif__theyare__not compound.Blank__lines, spaces,and__commentsare__usually ignored.Blank__linesare__bothoptional__andignored__infiles__(butnot__atthe__interactive prompt,when__theyterminate__compound statements).Spaces__insidestatements__andexpressions__arealmost__alwaysignored__(exceptin__string literals,and__whenused__for indentation).Comments__arealways__ignored:they__startwith__a #character__(notinside__astring__literal)and__extendto__theend__ofthe__current line.Docstrings__areignored__butare__savedand__displayedby__tools.Python__supportsan__additionalcomment__formcalled__documentationstrings__(docstringsfor__short), which,unlike__# comments,are__retainedat__runtimefor__inspection.Docstrings__aresimply__stringsthat__showup__atthe__topof__programfiles__andsome__statements.Their__contentis__ignored,but__theyare__attachedto__objectsand__maybe__displayedwith__toolscovered__laterin__this book.For__mostPython__newcomers,the__lackof__thebraces__andsemicolons__usedto__markblocks__andstatements__inmany__otherlanguages__seemsto__bethe__mostnovel__syntacticfeature__of Python,so__lets__explorewhat__thismeans__inmore__depth.Block__Delimiters:Indentation__RulesAs__introducedin__Chapter 10,Python__detectsblock__boundaries automatically,by__lineindentation__that is,the__emptyspace__tothe__leftof__your code.This__sectionis__arehash__ofthe__rules,with__afew__moredetails__sprinkledin__alongthe__way.In__short,all__statementsindented__thesame__distanceto__theright__belongto__thesame__blockof__code.In__other words,the__statementswithin__ablock__lineup__vertically,as__ina__column.The__blockends__whena__lesser-indentedline__orthe__endof__thefile__isencountered__(oryou__entera__blanklike__ina__REPL),and__moredeeply__nestedblocks__aresimply__indentedfurther__tothe__rightthan__thestatements__inthe__enclosing block.For__instance,Figure__12-1demonstrates__theblock__structureof__thefollowing__code:x__= 1if__x:y__= 2if__y: print('block2') print('block1') print('block0')This__codecontains__three blocks:the__first (the top-levelcode__ofthe__file)is__notindented__at all,the__second (withinthe__outerif__statement)is__indentedfour__spaces,and__thethird__(theprint__statementunder__thenested__if)is__indentedeight__spaces. Top-level (unnested)code__muststart__incolumn__1,but__nestedblocks__canstart__inany__column;indentation__mayconsist__ofany__numberof__spacesand__tabs,as__longas__its__thesame__forall__thestatements__ina__givensingle__block.That__is,Python__doesnt__carehow__youindent__your code;it__onlycares__thatit__sdone__consistently.Four__spacesor__onetab__perindentation__levelare__common conventions,but__thereis__noabsolute__standardor__rulein__thePython__world.Figure__12-1.Nested__blocksof__codedenoted__bytheir__indentationIndenting__codeis__quitenatural__in practice.For__example,the__followingfully__frivolouscode__snippetdemonstrates__commonindentation__errorsin__Python code,which__areeasy__tospot__becausethey__revisually__askew:x__= 'Hack' # Error:first__lineindented__if 'tho'in__'python': print(x * 8)x__+= 'More!' # Error:unexpected__indentationif__x.endswith('re!'):x__*= 2 print(x) # Error:inconsistent__indentationThe__properlyindented__versionof__thiscode__lookslike__thefollowing__evenfor__anartificial__examplelike__this,proper__indentationmakes__thecode__sintent__muchmore__apparent:x__= 'Hack'if__'tho'in__'python': print(x * 8) #Prints__8Hack__x += 'More!'if__x.endswith('re!'):x__*= 2 print(x) #Prints__HackMore!HackMore!It__simportant__toknow__thatthe__onlymajor__placein__Pythonwhere__whitespacematters__iswhere__its__usedto__theleft__ofyour__code,for__indentation;in__mostother__contexts,space__canbe__codedor__not. However,indentation__isreally__partof__Python syntax,not__justa__stylistic suggestion:all__thestatements__withinany__givensingle__blockmust__beindented__tothe__same level,or__Pythonreports__asyntax__error.This__isintentional__becauseyou__dont__needto__explicitlymark__thestart__andend__ofa__nestedblock__of code,some__ofthe__syntacticclutter__foundin__otherlanguages__isunnecessary__in Python.As__describedin__Chapter 10,making__indentationpart__ofthe__syntaxmodel__alsoenforces__consistency,a__crucialcomponent__ofreadability__instructured__programminglanguages__like Python.In__Pythons__syntax,the__indentationof__eachline__ofcode__unambiguouslytells__readerswhat__itis__associated with.This__uniformand__consistentappearance__inturn__makesPython__codeeasier__tomaintain__and reuse.In__the end,indentation__iseasier__thanyou__may think.Consistently__indentedcode__alwayssatisfies__Pythons__rules,and__mosttext__editors (including IDLE)make__iteasy__tofollow__Pythons__modelby__automaticallyindenting__asyou__type.Avoid__mixingtabs__andspaces__That said,there__sone__ruleof__thumbyou__should know:although__youcan__usespaces__ortabs__to indent,it__susually__nota__goodidea__tomix__thetwo__withina__blockuse__oneor__the other. Technically,tabs__countfor__enoughspaces__tomove__thecurrent__columnnumber__upto__amultiple__of 8,and__yourcode__willwork__ifyou__mixtabs__andspaces__consistently. However,mixing__tabsand__spacesmakes__codedifficult__toread__andchange__completelyapart__fromPython__ssyntax__rulestabs__maylook__verydifferent__inthe__nextprogrammer__seditor__thanthey__doin__yours.For__these reasons,Python__issuesan__errorwhen__ascript__mixestabs__andspaces__forindentation__inconsistentlywithin__ablock__(that is,in__away__thatmakes__itdependent__ona__tabs__equivalentin__spaces).So__dont__do that:when__inPython__doas__Pythoneersdo__anduse__consistentindentation__insteadof__block delimiters.Statement__Delimiters:Lines__andContinuations__Whileblocks__are indented,a__statementin__Pythonnormally__endsat__theend__ofthe__lineon__whichit__appears.When__astatement__istoo__longto__fiton__asingle__line, though,a__fewspecial__rulesmay__beused__tomake__itspan__multiple lines:Statements__mayspan__multiplelines__ifyou__recontinuing__anopen__pair.The__codeof__astatement__canalways__becontinued__onthe__nextline__ifit__senclosed__ina__(), {},or__[] pair.For__instance,expressions__inparentheses__anddictionary__andlist__literalscan__spanany__numberof__lines;the__statementdoesn__tend__untilthe__endof__theline__containingthe__closingpart__ofthe__pair (a ), },or__]).Continuation__lineslines__2and__beyondof__thestatement__canstart__atany__indentation level,but__its__bestto__alignvertically__forreadability__insome__fashion.Statements__mayspan__multiplelines__ifthey__endin__a backslash.Though__bestused__asa__fallback option,if__astatement__needsto__spanmultiple__lines,you__canalso__adda__backslasha__\not__embeddedin__astring__literalor__commentat__theend__ofthe__priorline__toindicate__youre__continuingon__thenext__line.Because__youcan__alsocontinue__byadding__parenthesesaround__most constructs,backslashes__arerarely__used today.This__approachis__also error-prone:accidentally__forgettinga__\may__generatea__syntaxerror__orcause__thenext__lineto__run independently.Statements__maybe__combinedif__separatedwith__a semicolon.Though__uncommon,you__canterminate__astatement__witha__semicolon.This__issometimes__usedto__squeezemore__thanone__statementonto__asingle__lineby__separatingthem__with semicolons,but__thisworks__onlywhen__thecombined__statementsare__not compound.Statements__maycontain__multiline strings.As__welearned__inChapter__7, triple-quotedstring__blocksare__designedto__spanmultiple__lines normally.We__alsolearned__inChapter__7that__adjacentstring__literalsare__implicitly concatenated;when__thisis__usedin__conjunctionwith__the open-pairsrule__mentioned earlier,wrapping__thisconstruct__inparentheses__allowsit__tospan__multiple lines.Special__SyntaxCases__inAction__Heres__whata__continuationline__lookslike__usingthe__open-pairsrule__just described.Delimited__constructs,such__aslists__insquare__brackets,can__spanacross__anynumber__of lines:L__= ['app', 'script', 'program'] #Open__pairsmay__spanlines__Thisalso__worksfor__listcomprehensions__enclosedin__[];anything__in () (tuples, expressions,function__argumentand__headers,and__generators expressions);and__anythingin__{} (dictionaryand__setliterals__and comprehensions).Some__ofthese__aretools__well__studyin__later chapters,but__thisrule__naturallycovers__mostconstructs__thatspan__linesin__practice.If__youre__accustomedto__usingbackslashes__tocontinue__lines,you__canin__Python, too,but__its__notcommon__practice:if__a ==b__andc__==d__and \d__==e__andf__== g: print('old school') #Backslashes__allow continuations...Because__anyexpression__canbe__enclosedin__parentheses,you__canusually__usethe__open-pairstechnique__insteadif__youneed__yourcode__tospan__multiplelines__simplywrap__apart__ofyour__statementin__parentheses:if__(a ==b__andc__==d__andd__==e__ande__== f): print('new school') #But__parenthesesusually__do too,and__areobvious__In fact,backslashes__aregenerally__discouraged,because__theyre__tooeasy__tonot__noticeand__tooeasy__toomit__altogether.In__the following,x__isassigned__10with__the backslash,as__intended;if__thebackslash__isaccidentally__omitted, though,x__isassigned__6 instead,and__noerror__isreported__(the +4is__avalid__expressionstatement__by itself).In__areal__programwith__amore__complex assignment,this__couldbe__thesource__ofa__veryobscure__bug:x__= 1 + 2 + 3 \ #Omitting__the \makes__thisvery__different! +4As__anotherspecial__case,Python__allowsyou__towrite__morethan__onenoncompound__statement (i.e.,statements__withoutnested__statements)on__thesame__line,separated__by semicolons.Some__codersuse__thisform__tosave__programfile__real estate,but__itusually__makesfor__morereadable__codeif__youstick__toone__statementper__linefor__mostof__your work:x__= 1;y__= 2; print(x) #More__thanone__simplestatement__Ascovered__inChapter__7, triple-quotedstring__literalsspan__lines too.In__addition,if__twostring__literalsappear__nextto__each other,they__areconcatenated__asif__a +had__beenadded__betweenthem__whenused__inconjunction__withthe__open-pairs rule,wrapping__inparentheses__allowsthis__formto__spanmultiple__lines.For__example,the__firstof__thefollowing__insertsnewline__charactersat__linebreaks__andassigns__Sto__'\naaaa\nbbbb\ncccc',and__theother__twoimplicitly__concatenateand__assignS__to 'aaaabbbbcccc';as__wealso__sawin__Chapter 7, #comments__areignored__inthe__secondform__butincluded__inthe__stringin__the first,and__f-stringsrequire__fprefixes__evenon__continuations lines:S__= """aaaa__bbbb cccc"""S__= ('aaaa' 'bbbb' #Comments__hereare__ignored,add__\nif__needed 'cccc')S__= (f'{'a' * 4}' #Also__makes 'aaaabbbbcccc' f'{'b' * 4}' #Use__f''on__each f-stringpart__r'cccc') #And__dittofor__r'' raw-stringparts__Finally,and__alsoas__a review,Python__letsyou__movea__compoundstatement__sbody__upto__theheader__line,provided__thebody__containsjust__simple (noncompound) statements.You__llmost__oftensee__thisused__forsimple__ifstatements__witha__singletest__and action,as__inthe__interactiveloops__wecoded__inChapter__10:if__1: print('hello') #Simple__statementon__headerline__Witha__little effort,you__cancombine__someof__thesespecial__casesto__writePython__codethat__isdifficult__to read,but__its__notgenerally__recommended.As__arule__of thumb,try__tokeep__eachstatement__ona__lineof__its own,and__indentall__butthe__simplestof__blocks.Six__monthsdown__the road,you__llbe__happyyou__did.Truth__ValuesRevisited__Thenotions__of comparison, equality,and__truthvalues__wereintroduced__inChapter__9.Like__syntax, though,the__ifis__thefirst__statementwe__vestudied__thatactually__usesthese__tools,so__well__rehashthese__ideaswith__additional info.All__told,Python__sBoolean__operatorsare__abit__differentfrom__theircounterparts__insome__other languages.In__Python:All__objectshave__aninherent__Booleantrue__orfalse__value.Any__nonzeronumber__ornonempty__objectis__true.Zero__numbers,empty__objects,and__thespecial__objectNone__areconsidered__false.Comparisons__andequality__testsare__appliedrecursively__todata__structures.Comparisons__andequality__testsreturn__Trueor__False (customversions__of 1and__0).Boolean__andand__oroperators__returna__trueor__falseoperand__object.Boolean__operatorsstop__evaluating (short-circuit)as__soonas__aresult__is known.The__ifstatement__takesaction__ontruth__values,but__Booleanoperators__areused__tocombine__theresults__ofother__testsin__richerways__toproduce__newtruth__values.More__formally,there__arethree__Booleanexpression__operatorsin__Python:X__andY__Istrue__ifboth__Xand__Yare__trueand__returnseither__Xor__YX__orY__Istrue__ifeither__Xor__Yis__trueand__returnseither__Xor__Ynot__XIs__trueif__Xis__falseand__returnseither__Trueor__False Here,X__andY__maybe__anytruth__value,or__anyexpression__thatreturns__atruth__value (e.g.,an__==equality__test,an__inmembership__check,and__so on).Boolean__operatorsare__typedout__aswords__inPython__(insteadof__Cs__&&, ||,and__!),and__shouldnt__beconfused__withPython__s &, |,and__^operators__thatwork__onnumbers__andsets__(and dictionaries).Most__uniquely,Boolean__andand__oroperators__returna__trueor__falseobject__in Python,not__thevalues__Trueor__False.Let__sturn__toa__fewexamples__tosee__howthis__works: >>> 2 < 3, 3 < 2 #Less__than:return__Trueor__False (1or__0) (True, False)Magnitude__comparisonssuch__asthese__returnTrue__orFalse__astheir__truth results, which,as__welearned__inChapters__5and__9,are__reallyjust__customversions__ofthe__integers 1and__0 (theyprint__themselvesdifferently__butare__otherwisethe__same).Boolean__operatorsand__and or,on__theother__hand,always__returnan__objecteither__theobject__onthe__leftside__ofthe__operatoror__theobject__onthe__right.If__wetest__theirresults__inif__orother__statements,they__willbe__asexpected__(remember,every__objectis__inherentlytrue__or false),but__wewon__tget__backa__simpleTrue__or False.For__or tests,Python__evaluatesthe__operandobjects__fromleft__toright__andreturns__thefirst__onethat__is true. Moreover,Python__stopsat__thefirst__trueoperand__it finds.This__isusually__called short-circuit evaluation,as__determininga__result short-circuits__(terminates)the__restof__theexpression__assoon__asthe__resultis__known: >>> 2or__3, 3or__2 #Return__leftoperand__iftrue__(2, 3) # Else,return__rightoperand__(trueor__false) >>> []or__3 3 >>> []or__{} {}In__thefirst__lineof__thepreceding__example,both__operands (2and__3)are__true (i.e.,are__nonzero),so__Pythonalways__stopsand__returnsthe__oneon__theleft__whichdetermines__theresult__becausetrue__oranything__isalways__true.In__theother__two tests,the__leftoperand__isfalse__(anempty__object),so__Pythonsimply__evaluatesand__returnsthe__objecton__theright__whichmay__haveeither__atrue__ora__falsevalue__when tested,but__determinesthe__resultof__theor__at large.Python__andoperations__alsostop__(short-circuit)as__soonas__theresult__is known. However,in__thiscase__Pythonevaluates__theoperands__fromleft__toright__andstops__ifthe__leftoperand__isa__falseobject__becauseit__determinesthe__resultfalse__andanything__isalways__false: >>> 2and__3, 3and__2 #Return__leftoperand__iffalse__(3, 2) # Else,return__rightoperand__(trueor__false) >>> []and__{} [] >>> 3and__[] [] Here,both__operandsare__truein__thefirst__line,so__Pythonevaluates__bothsides__andreturns__theobject__onthe__rightwhich__determinesthe__resultof__the and.In__thesecond__test,the__leftoperand__isfalse__([]),so__Pythonstops__andreturns__itas__theand__resultwithout__everrunning__thecode__onthe__right side.In__thelast__test,the__leftside__istrue__(3),so__Pythonevaluates__andreturns__theobject__onthe__rightwhich__happensto__bea__false [].The__neteffect__ofall__thisapparent__nonsenseis__thesame__asin__mostother__languagesyou__geta__valuethat__islogically__trueor__falseif__testedin__anif__orwhile__accordingto__thenormal__definitionsof__orand__and. However,in__Python,Booleans__returneither__theleft__orthe__right object,not__asimple__integer flag.This__behaviorof__andand__ormay__seemesoteric__atfirst__glance,but__seethis__chapters__sidebar,Why__YouWill__Care:Booleans__,for__examplesof__howit__issometimes__usedto__advantagein__Python coding.The__nextsection__alsoshows__acommon__wayto__leveragethis__behavior,and__itsmore__mnemonic alternative.The__if/elseTernary__ExpressionOne__commonrole__forthe__priorsection__sBoolean__operatorsis__tocode__anexpression__thatruns__thesame__asan__if statement.To__get started,consider__thefollowing__verycommon__code,which__setsA__toeither__Yor__Z,based__onthe__truthvalue__of X:if__X:A__=Y__else:A__=Z__Sometimes, though,the__itemsinvolved__insuch__astatement__areso__simplethat__itseems__likeoverkill__tospread__themacross__four lines.At__other times,we__maywant__tonest__sucha__constructin__alarger__statementinstead__ofassigning__itsresult__toa__variable separately.For__suchreasons__(andpossibly__toappease__ex-C programmers),Python__includesa__ternary (three-part)expression__thatallows__usto__saythe__samething__injust__oneline__of code:A__=Y__ifX__elseZ__Thisexpression__hasthe__exactsame__effectas__thepreceding__four-lineif__statement,but__its__simplerto__code.In__some sense,it__isto__ifstatements__whatthe__priorchapter__s :=is__toassignment__statements:an__expressionequivalent__withmore__limitedsyntax__andnarrower__roles,which__isnevertheless__usefulin__some code.For__example,you__cant__codefull__statementsin__theparts__ofthis__expression,but__youcan__embedit__anywherethat__Pythonallows__an expression.As__inthe__statement equivalent,the__ternaryexpression__runsexpression__Yonly__ifX__turnsout__tobe__trueand__runsexpression__Zonly__ifX__turnsout__tobe__false.That__is,it__short-circuits,just__likethe__Booleanoperators__describedin__theprior__section,running__justY__orZ__butnot__both.Here__aresome__examplesof__itin__action: >>>tone__= 'formal' >>>a__= 'code'if__tone == 'formal'else__'hack' >>>a__'code' >>>tone__= 'informal' >>>a__= 'code'if__tone == 'formal'else__'hack' >>>a__'hack'The__sameeffect__canoften__beachieved__bya__carefulcombination__ofand__andor__operators,because__theyreturn__eitherthe__objecton__theleft__sideor__theobject__onthe__rightas__thepreceding__section described.The__ternaryexpression__inthe__followingworks__thesame__asthe__Booleanexpression__below it:A__=Y__ifX__elseZ__#Ternary__if/elseA__= ((Xand__Y)or__Z) # and+orequivalent__This works,but__thereis__acatch__youhave__tobe__ableto__assumethat__Ywill__beBoolean__true.If__thatis__the case,the__effectis__the same:the__andruns__firstand__returnsY__ifX__is true;if__Xis__falsethe__andskips__Yand__returnsfalse__X,and__theor__simplyreturns__Z.In__other words,we__getif__Xthen__Yelse__Zwhich__isexactly__whatthe__ternaryexpression__says,albeit__ina__different order.The__and/orcombination__formalso__seemsto__requirea__momentof__greatclarity__tounderstand__thefirst__timeyou__see it,which__qualifiesas__anargument__againstits__deployment.As__a guideline:use__theequivalent__andmore__robustand__mnemonic if/elseexpression__whenyou__needthis__structure,or__usea__fullif__statementwhen__theparts__are nontrivial.As__aside__note (andjust__incase__thissection__hasnt__madeyour__headexplode__yet),using__thefollowing__expressionis__similarto__theprior__Booleanand__ternary expressions,because__thebool__functionwill__translateany__Xinto__theequivalent__ofinteger__1or__0 (i.e.,True__or False),which__canthen__beused__asan__offsetto__picktrue__andfalse__valuesfrom__a list:A__= [Z, Y][bool(X)]Truth__be told,the__boolis__notrequired__whenX__alreadyyields__atruth__value,but__iswhen__Xis__anobject__likea__string: >>> ['hack', 'code'][tone == 'formal'] 'hack' >>> ['hack', 'code'][bool('formal')] 'code'But__alas,this__isnt__exactlythe__same,because__Pythonwill__not short-circuitit__willalways__runboth__Zand__Y,regardless__ofthe__valueof__X.Because__ofsuch__complexities,you__rebetter__offusing__thesimpler__andmore__easilydigested__if/else expression.Even__then,common__sensegoes__along__wayhere__as always.Like__mostnestable__tools,the__ternaryexpression__isnaturally__proneto__yieldcode__thats__toughto__read.If__youfind__yourselfworking__hardat__packinglogic__into one,consider__takinga__momentto__thinkabout__howhard__itwill__beto__unpack later.Your__coworkerswill__beglad__you did.Chapter__SummaryIn__this chapter,we__studiedthe__Pythonif__statement. Additionally,because__thiswas__ourfirst__compoundand__logical statement,we__reviewedPython__sgeneral__syntaxrules__andexplored__theoperation__oftruth__valuesand__testsin__moredepth__thanwe__wereable__to previously.Along__the way,we__alsolooked__athow__tocode__multiple-choicelogic__inPython__withboth__dictionariesand__match,learned__aboutthe__if/elseternary__expression,and__exploredBoolean__operators.The__nextchapter__continuesour__lookat__proceduralstatements__byexpanding__thecoverage__ofwhile__andfor__loops. There,you__lllearn__aboutalternative__waysto__codeloops__in Python,some__ofwhich__maybe__betterthan__others.Before__that, though,here__isthe__usualchapter__quizto__reviewbefore__moving ahead.Test__Your Knowledge:Quiz__1.How__mightyou__codea__multiple-choicebranch__in Python? 2.How__canyou__codean__if/elsestatement__asan__expressionin__Python? 3.How__canyou__makea__singlestatement__spanmany__lines? 4.What__dothe__wordsTrue__andFalse__mean? 5.What__does short-circuiting mean,and__wheredoes__itcrop__up?Test__Your Knowledge:Answers__1.An__ifstatement__withmultiple__elifclauses__isoften__themost__straightforwardway__tocode__a multiple-choice branch,though__notnecessarily__themost__conciseor__flexible.Dictionary__indexingcan__oftenachieve__thesame__result,especially__ifthe__dictionarycontains__callablefunctions__codedwith__defstatements__orlambda__expressions.As__ofPython__3.10,the__matchstatement__providesexplicit__syntaxfor__multiple-choice__selections;it__workswell__inbasic__rolesbut__cant__codelogic__asgeneral__asthat__inthe__ifstatement__andcomes__withsubstantial__heftin__supportof__structuralpattern__matching,a__verydifferent__tool. 2.The__expressionform__Yif__Xelse__Zreturns__Yif__Xis__true,or__Z otherwise;it__sthe__sameas__a four-lineif__statementand__workswell__inlimited__contexts,but__cant__codeactions__asrich__asthose__inthe__fullif__statement,and__hasthe__potentialto__producecode__thats__hardto__read.The__and/orcombination__(((Xand__Y)or__Z))can__workthe__same way,but__its__moreobscure__andrequires__thatthe__Ypart__be true. 3.Wrap__upthe__statementin__anopen__syntacticpair__((), [],or__{}),and__itcan__spanas__manylines__asyou__like;the__statementends__whenPython__seesthe__closing (right)half__ofthe__pair,and__lines 2and__beyondof__thestatement__canbegin__atany__indentation level.Backslash__continuations work, too,but__arebroadly__discouragedin__thePython__world. 4.This__ispartly__areview__fromChapter__9,but__isreinforced__inthe__sidebarat__theend__ofthis__chapter.True__andFalse__arejust__customversions__ofthe__integers 1and__0, respectively:they__alwaysstand__forBoolean__trueand__falsevalues__in Python.They__reavailable__foruse__intruth__testsand__variableinitialization__andare__printedfor__expressionresults__atthe__interactive prompt.In__allthese__roles,they__serveas__amore__mnemonicand__hencereadable__alternativeto__1and__0. 5. Short-circuitinghappens__whenPython__stopsevaluating__anexpression__earlybecause__itsresult__canalready__bedetermined__fromthe__expressionso__far.It__comesup__inand__andor__expressions,which__runtheir__rightside__onlyif__theirleft__sidesdon__tdetermine__their results.It__alsocomes__upin__the if/elseternary__expression,which__runseither__itstrue__orfalse__parts,depending__onits__testpart__slogical__result.WHY__YOUWILL__CARE:BOOLEANS__Onecommon__wayto__usethe__somewhatunusual__behaviorof__PythonBoolean__operatorsis__toselect__froma__setof__objectswith__an or.A__statementsuch__as this:X__=A__orB__orC__orNone__assignsX__tothe__firstnonempty__(that is, true)object__among A, B,and__C,or__toNone__ifall__ofthem__are empty.This__worksbecause__theor__operatorreturns__oneof__itstwo__objects,and__itturns__outto__bea__fairlycommon__codingparadigm__in Python:to__selecta__nonemptyobject__fromamong__a fixed-size set,simply__stringthem__togetherin__anor__expression.In__simpler form,this__isalso__commonlyused__todesignate__adefault__thefollowing__setsX__toA__ifA__istrue__(nonzeroor__nonempty),and__todefault__otherwise:X__=A__ordefault__Its__alsoimportant__tounderstand__the short-circuitevaluation__ofBoolean__operatorsand__the if/else,because__itmay__preventactions__from running.Expressions__onthe__rightof__aBoolean__operator,for__example,might__callfunctions__thatperform__substantialor__important work,or__haveside__effectsthat__wont__happenif__the short-circuitrule__takes effect:if__f1()or__f2(): Here,if__f1returns__atrue__(or nonempty) value,Python__willnever__run f2.To__guaranteethat__bothfunctions__willbe__run,call__thembefore__the or: tmp1, tmp2 = f1(), f2()if__tmp1or__tmp2:You__vealready__seenanother__applicationof__thisbehavior__inthis__chapter:because__ofthe__wayBooleans__work,the__expression ((Aand__B)or__C)can__beused__toemulate__anif__statementalmost__(seethis__chapters__discussionof__thisform__for details).We__metadditional__Booleanuse__casesin__prior chapters.As__wesaw__inChapter__9,because__allobjects__areinherently__trueor__false,it__scommon__andeasier__inPython__totest__anobject__directly (if X:)than__tocompare__itto__anempty__value (ifX__!= '':).For__a string,the__twotests__are equivalent.As__wealso__sawin__Chapter 5,the__presetBoolean__valuesTrue__andFalse__arethe__sameas__theintegers__1and__0and__areuseful__forinitializing__variables (X = False),for__looptests__(while True:),and__fordisplaying__resultsat__theinteractive__prompt.Also__watchfor__relateddiscussion__inoperator__overloadingin__Part VI:when__wedefine__newobject__typeswith__classes,we__canspecify__theirBoolean__naturewith__eitherthe____bool__or____len__ methods.The__latterof__theseis__triedif__theformer__isabsent__anddesignates__falseby__returninga__lengthof__zerobecause__anempty__objectis__considered false. Finally,and__asa__preview,other__toolsin__Pythonhave__rolessimilar__tothe__orchains__atthe__startof__this sidebar:the__filtercall__andlist__comprehensionsyou__llexplore__latercan__beused__toselect__truevalues__whenthe__setof__candidatesisn__tknown__untilruntime__(thoughthey__evaluateall__valuesand__returnall__thatare__true),and__theany__andall__built-inscan__beused__totest__ifany__orall__itemsin__acollection__aretrue__(they short-circuittheir__checkslike__and, or,and__if/else,but__dont__selectan__itemper__se): >>>L__= [1, 0, 2, 0, 'hack', '', 'py', []] >>> list(filter(bool, L)) #Get__truevalues__[1, 2, 'hack', 'py'] >>> [xfor__xin__Lif__x] #Comprehensions__[1, 2, 'hack', 'py'] >>> any(L), all(L) #Aggregate__truth (True, False)As__weve__learned,the__boolfunction__heresimply__returnsits__arguments__trueor__false value,as__thoughit__weretested__inan__if.Watch__formore__onthese__relatedtools__inChapters__14, 19,and__20.Chapter__13.while__andfor__LoopsThis__chapterconcludes__ourtour__ofPython__proceduralstatements__bypresenting__thelanguage__stwo__mainlooping__constructsstatements__thatrepeat__anaction__overand__over: while/elseThe__mostgeneral__looping statement,which__canhandle__repetitivetasks__ofall__kinds for/elseA__specializedloop__designedfor__steppingthrough__theitems__inany__iterableobject__easilyWe__vemet__andused__bothof__theseinformally__already,but__well__fillin__additionalusage__details here.While__were__at it,we__llalso__studya__fewless__prominentstatements__usedwithin__loops,such__asbreak__and continue,the__loop else,and__coversome__built-inscommonly__usedwith__loops,such__as range, zip,and__enumerate.Although__thewhile__andfor__statementscovered__hereare__theprimary__syntaxprovided__forcoding__repeated actions,there__areadditional__loopingoperations__andconcepts__in Python.Because__of that,the__iterationstory__iscontinued__inthe__next chapter,where__well__explorethe__relatedideas__ofPython__siteration__protocol (usedby__thefor__loop)and__listcomprehensions__(aclose__cousinto__thefor__loop).Later__chaptersexplore__evenmore__exoticiteration__toolssuch__asgenerators__andfunctional__toolslike__map, filter,and__reduce.For__now, though,let__skeep__things simple.while__LoopsPython__swhile__statementis__themost__generaliteration__constructin__the language.In__simple terms,it__repeatedlyexecutes__anassociated__blockof__statementsas__longas__atest__atthe__topkeeps__evaluatingto__atrue__value.It__iscalled__aloop__becausecontrol__keepslooping__backto__thestart__ofthe__statementuntil__thetest__becomes false.When__thetest__doesbecome__false,control__passesto__thestatement__thatfollows__thewhile__block.The__neteffect__isthat__theloop__sbody__isexecuted__repeatedlywhile__thetest__atthe__topis__true.If__thetest__isfalse__tobegin__with,the__bodynever__runsand__thewhile__statementis__skipped.General__FormatIn__itsmost__complex form,the__whilestatement__consistsof__aheader__linewith__atest__expression,a__bodyof__oneor__morenormally__indented statements,and__anoptional__elsepart__thatis__executedif__controlexits__theloop__withouta__breakstatement__being encountered.Python__keepsevaluating__thetest__atthe__topand__executingthe__statementsnested__inthe__loopbody__untilthe__testreturns__afalse__value:while__test: #Loop__teststatements__#Repeated__loopbody__else: #Optional__elsestatements__#Run__if didn'texit__loopbody__withbreak__ExamplesTo__illustrate,let__slook__ata__fewsimple__whileloops__in action.The__first,which__consistsof__aprint__statementnested__ina__while loop,just__printsa__message forever.Recall__thatTrue__isjust__acustom__versionof__theinteger__1and__alwaysstands__fora__Booleantrue__value;because__thetest__isalways__true,Python__keepsexecuting__thebody__foreveror__untilyou__stopits__execution.This__sortof__behavioris__usuallycalled__aninfinite__loopit__snot__really immortal,but__youmay__needa__Ctrl+Ckey__combinationto__forciblyterminate__it: >>>while__True: ... print('Type Ctrl+Cto__stop me!')The__nextexample__keepsslicing__offthe__firstcharacter__ofa__stringuntil__thestring__isempty__andhence__false (andbegins__omittingthe__REPLs__...prompts__foreasier__emediacopy__andpaste__where possible).It__stypical__totest__anobject__directlylike__thisinstead__ofusing__themore__verboseequivalent__(whilex__!= '':),though__laterin__thischapter__youll__seeother__waysto__stepthrough__theitems__ina__stringmore__easilywith__afor__loop: >>>x__= 'code' >>>while__x: #While__xis__notempty__print(x, end=' ') #Print__nextcharacter__x = x[1:] #Strip__firstcharacter__offx__codeode__dee__Notethe__end=' 'keyword__argumentused__hereto__placeall__outputson__thesame__lineseparated__bya__space;see__Chapter 11if__youve__forgottenwhy__thisworks__asit__does.This__willprobably__leaveyour__REPLs__inputprompt__atthe__endof__theoutput__s line;type__Enter (oryour__keyboards__orapp__s equivalent)to__resetif__desired.The__followingcode__countsfrom__thevalue__ofa__up to,but__not including, b.Loops__likethis__areoften__usedto__generateobject__indexes.You__llalso__seean__easierway__todo__thiswith__aPython__forloop__andthe__built-inrange__function later: >>> a=0; b=10 >>>while__a < b: #One__wayto__codecounter__loops print(a, end=' ')a__+= 1 # Or,a__=a__+ 1 0 1 2 3 4 5 6 7 8 9 Finally,notice__thatPython__doesnt__havewhat__somelanguages__calla__dountil__loop statement. However,we__cansimulate__onewith__atest__andbreak__atthe__bottomof__theloop__body,so__thatthe__loops__bodyis__alwaysrun__atleast__once:while__True:loop__body #Always__runloop__bodyat__leastonce__if test:break__#Test__forloop__exitat__thebottom__Tofully__understandhow__thisstructure__works,we__needto__moveon__tothe__nextsection__scoverage__of break. break, continue, pass,and__theLoop__elseNow__thatwe__veseen__afew__Pythonloops__in action,it__stime__totake__alook__attwo__simplestatements__thathave__apurpose__onlywhen__nestedinside__loopsthe__breakand__continue statements.While__were__lookingat__oddballs,we__willalso__studythe__loopelse__clausehere__becauseit__isintertwined__with break,as__wellas__Pythons__emptyplaceholder__statement pass,which__isnot__tiedto__loopsbut__fallsinto__thecategory__ofsimple__one-word statements.In__Python:break__Jumpsout__ofthe__closestenclosing__loop (pastthe__entireloop__statement)continue__Jumpsto__thetop__ofthe__closestenclosing__loop (tothe__loops__header line)pass__Doesnothing__at all:it__san__emptystatement__placeholderLoop__elseblock__Runsif__andonly__ifthe__loopis__exitednormally__(i.e.,without__hittinga__break)General__LoopFormat__Factoringin__breakand__continue statements,the__generalformat__ofthe__whileloop__lookslike__this:while__test:statements__if test:break__#Exit__loop now,skip__elseif__presentif__test:continue__#Go__totest__attop__ofloop__now else:statements__#Run__onexit__if didn'thit__a 'break'break__andcontinue__statementscan__appearanywhere__insidethe__while (orper__ahead, for)loop__s body,but__theyare__usuallycoded__furthernested__inan__iftest__totake__actionin__responseto__some condition.Let__sturn__toa__fewsimple__examplesto__seehow__thesestatements__cometogether__in practice.pass__Simplethings__first:the__passstatement__isa__no-operationplaceholder__thatis__codedwhen__thesyntax__requiresa__statement,but__youhave__nothinguseful__to say.It__isoften__usedto__codean__emptybody__fora__compound statement.For__instance,if__youwant__tocode__aninfinite__loopthat__doesnothing__eachtime__through,do__itwith__a pass:while__True:pass__#Type__Ctrl+Cto__stop me!Because__thebody__isjust__anempty__statement,Python__getsstuck__inthis__loop.pass__isroughly__tostatements__asNone__isto__objectsan__explicit nothing.Notice__thathere__thewhile__loops__bodyis__onthe__sameline__asthe__header,after__the colon;as__withif__statements,this__worksonly__ifthe__bodyisn__ta__compoundstatement__(anddoesn__tcontain__one).This__exampledoes__nothing forever.It__probablyisn__tthe__mostuseful__Pythonprogram__everwritten__(unlessyou__wantto__warmup__yourlaptop__orphone__ona__coldwinter__s day),but__its__toughto__comeup__witha__betterpass__exampleat__thispoint__inthe__book;it__snot__acommonly__used tool.You__llsee__otherplaces__wherepass__makesa__bitmore__senselater__for instance,to__ignoreexceptions__caughtby__trystatements__andto__defineempty__classobjects__withattributes__thatbehave__likestructs__andrecords__inother__languages.Though__partlya__preview,a__passis__alsosometime__codedto__meanto__befilled__in later,to__stubout__thebodies__offunctions__temporarily:def__func1():pass__#Add__realcode__herelater__def func2():pass__Wecan__tleave__thebody__emptywithout__gettinga__syntax error,so__wesay__pass instead.The__ellipsis-literalalternative__Despitethe__limited roles,there__sa__similar,if__more obscure,way__toachieve__thesame__effectas__pass.Python__allowsan__ellipsis,coded__as ... (literally,three__consecutive dots,not__theUnicode__character),to__appearany__placean__expression can.Because__ellipsesdo__nothingby__themselves,they__canserve__asan__alternativeto__thepass__statement,especially__forcode__tobe__filledin__latera__sortof__Python TBD:def__func1(): ... #Alternative__topass__func1() #Does__nothingif__calledThis__worksbecause__anyexpression__canappear__asa__statement (aswe__learnedin__Chapter 11),and__the ...literal__qualifiesas__an expression.Ellipses__canalso__appearon__astatement__headerby__itself,and__maybe__usedto__initializevariable__namesif__nospecific__typeis__requiredwhich__alsomakes__itan__alternativeto__None:def__func1(): ... #Works__onsame__linetoo__>>>tbd__= ... #Alternative__toboth__passand__None >>>tbd__#Ellipsis__isa__real (if oddball!)thing__EllipsisThis__goeswell__beyondthe__originalintent__of ...in__slicingextensions__(which,like__the @operator__andtype__hinting,is__unusedby__Python itself),so__timewill__tellif__itrises__tochallenge__passand__Nonein__theseinane__andvacuous__roles.continue__Thecontinue__statementcauses__animmediate__jumpto__thetop__ofa__loop.It__soften__usedto__avoidstatement__nesting,as__inthe__nextexample__thatuses__continueto__skipodd__numbers.This__codeprints__alleven__numbersless__than 10and__greaterthan__orequal__to 0.Recall__that 0means__falseand__%is__the remainder-of-division (modulus) operator,so__thisloop__countsdown__to 0,skipping__numbersthat__arent__multiplesof__2and__prints 8 6 4 2 0:x__= 10while__x:x__-= 1 # Or,x__=x__- 1if__x % 2 != 0:continue__# Odd? --skip__print print(x, end=' ')Because__continuejumps__tothe__topof__the loop,you__dont__needto__nestthe__printstatement__hereinside__anif__test;the__printis__onlyreached__ifthe__continueis__not run.The__nested-codealternative__Ifall__thissounds__similarto__ago__toin__other languages,it__should.Python__hasno__goto__statement,but__becausecontinue__letsyou__jumpabout__ina__program,many__ofthe__warningsabout__readabilityand__maintainabilityyou__mayhave__heardabout__goto__apply.continue__shouldprobably__beused__sparingly,especially__whenyou__refirst__gettingstarted__with coding.For__instance,the__lastexample__mightbe__clearerif__theprint__werenested__underthe__if:x__= 10while__x:x__-= 1if__x % 2 == 0: # Even? --print__print(x, end=' ')Later__inthis__book,you__llalso__learnthat__raisedand__caughtexceptions__canalso__emulatego__tostatements__inlimited__andstructured__ways;stay__tunedfor__moreon__thistechnique__inChapter__36where__youwill__learnhow__touse__itto__breakout__ofmultiple__nested loops,a__featnot__possiblewith__thenext__sections__topic alone.break__Thebreak__statementcauses__animmediate__exitfrom__aloop__technically,from__theclosest__enclosing loop,when__loopsare__nested.Because__thecode__thatfollows__itin__theloop__isnot__executedif__thebreak__is reached,it__cansometimes__avoidnesting__muchlike__continue.For__example,here__isa__simpleinteractive__loop (atakeoff__oncode__westudied__inChapter__10)that__inputsdata__withinput__andexits__whenthe__userenters__astop__line: >>>num__= 1 >>>while__True:tool__= input(f'{num}) What\'syour__favorite language? ')if__tool == 'stop':break__print('Bravo!'if__tool == 'Python'else__'Try again...')num__+= 1 1) What'syour__favorite language?Java__Try again... 2) What'syour__favorite language?Python__Bravo! 3) What'syour__favorite language?stop__Becausethe__breakin__thisterminates__thewhile__immediately,there__sno__reasonto__nestcode__belowit__inan__else.The__named-assignmentalternative__That said,it__salso__possibleto__usethe__newer :=expression__wemet__inNamed__AssignmentExpressions__tocrunch__thisexample__albeit,at__theexpense__ofits__roleas__abreak__demo.While__youshould__judgefor__yourself,the__neteffect__isconcise__butmay__atleast__flirtwith__unreadability: >>>num__= 1 >>>while__(tool := input(f'{num}) What\'syour__favorite language? ')) != 'stop': print('Bravo!'if__tool == 'Python'else__'Try again...')num__+= 1 1) What'syour__favorite language?Python__Bravo!Nesting__:=within__:=as__inthe__following, however,could__easilyincite__pitchforksand__torches (in fact,the__full one-linerhere__istoo__widefor__this book!).Unless__youcan__defendthis__ina__courtof__your code-reuse peers,just__say no:num__= 0while__(tool := input(f'{(num :=num__+ 1)}) What\'syour__favorite language? ')) != 'stop': Preview:in__Chapter 36,you__llsee__thatinput__alsoraises__anexception__at end-of-file__(e.g.,if__theuser__enters Ctrl+Zon__Windowsor__Ctrl+Don__Unix);wrapping__inputin__trystatements__allowsusers__torespond__thisway__too.Loop__elseWhen__combinedwith__theloop__else clause,the__breakstatement__canoften__eliminatethe__needfor__thesearch__statusflags__usedin__other languages.In__abstractterms__thebreak__inthe__followingskips__theelse__onthe__wayout__ofthe__loop:while__continuing:if__found:found__codebreak__elseadvance__else: not-foundcode__Asa__moreconcrete__example,the__followingpiece__ofcode__determineswhether__apositive__integernum__isprime__hasno__factorsother__than 1and__itselfby__searchingfor__factorsgreater__than 1 (torun__live,assign__numbefore__pasting):x__=num__// 2 #For__somenum__> 1,start__athalf__whilex__> 1:if__num %x__== 0: #Remainder__0?Factor__found print(num, 'has factor', x)break__#Exit__nowand__skipelse__x -= 1 else: #Normal__exit,when__xreaches__1 print(num, 'is prime')Rather__thansetting__aflag__tobe__testedwhen__theloop__is exited,it__insertsa__breakwhere__afactor__is found.This__way,the__loopelse__clausecan__assumethat__itwill__beexecuted__onlyif__nofactor__is found;if__thiscode__neverhits__the break,the__numberis__prime.Trace__throughthis__codeto__seehow__this works.The__loopelse__clauseis__alsorun__ifthe__bodyof__theloop__isnever__executed,as__youdon__trun__abreak__inthat__event either;in__awhile__loop,this__happensif__thetest__inthe__headeris__falseto__begin with. Thus,in__thepreceding__exampleyou__stillget__theis__primemessage__ifx__isinitially__lessthan__orequal__to 1 (for instance,if__numis__2).NOTE__Subprime code:This__exampledetermines__primes,but__onlyinformally__so.Numbers__lessthan__2are__notconsidered__primeby__thestrict__mathematical definition,but__1and__0are__classifiedas__such here.To__bereally__picky,this__codealso__failsfor__negativenumbers__andsucceeds__for floating-pointnumbers__with all-zerodecimal__digits.Also__notethat__itscode__mustuse__//instead__of /because__weneed__theinitial__divisionto__truncate remainders,not__retain them.If__youwant__toexperiment__withthis__code further,watch__forits__associatedexercise__atthe__endof__Part IV,which__wrapsit__ina__functionfor__reuse.Why__theloop__else?Because__theloop__elseclause__isunique__to Python,it__tendsto__perplexsome__newcomers (andeven__some veterans;in__fact,a__feweither__pointlesslycode__theloop__elsewithout__abreak__ordon__tknow__thatthe__loopelse__existsat__all!).In__general terms,the__loopelse__simplyprovides__explicitsyntax__fora__commoncoding__scenarioit__isa__codingstructure__thatlets__uscatch__theother__wayout__ofa__loop,without__settingand__checkingflags__or conditions. Suppose,for__instance,that__weare__writinga__loopto__searcha__listfor__avalue__andneed__toknow__whetherthe__valuewas__foundafter__youexit__the loop.We__mightcode__sucha__taskthis__way (thiscode__isintentionally__abstractand__incomplete;x__isa__sequenceand__matchis__atester__functionto__be defined):found__=False__whilex__andnot__found:if__match(x[0]): #Value__at front? print('Found')found__=True__else:x__= x[1:] #Slice__offfront__andrepeat__ifnot__found: print('Not found') Here,we__initialize, set,and__latertest__afound__flagto__determinewhether__thesearch__succeededor__not.This__isvalid__Python code,and__itdoes__work; however,this__isexactly__thesort__ofstructure__thatthe__loopelse__clauseis__meantto__handle.Here__san__else equivalent:while__x: #Exit__whenx__emptyif__match(x[0]): print('Found')break__# Exit,go__aroundelse__x = x[1:] else: print('Not found') #Only__hereif__exhaustedx__Thisversion__ismore__concise.The__flagis__gone,and__weve__replacedthe__iftest__atthe__loopend__withan__else (linedup__verticallywith__theword__while).Because__thebreak__insidethe__mainpart__ofthe__whileexits__theloop__andgoes__aroundthe__else,this__servesas__amore__structuredway__tocatch__the search-failure case.Some__readersmight__havenoticed__thatthe__priorexample__selse__clausecould__bereplaced__witha__testfor__anempty__xafter__theloop__(e.g.,if__not x:).Although__thats__truein__this example,the__elseprovides__explicitsyntax__forthis__codingpattern__(its__moreobviously__a search-failureclause__here),and__suchan__explicitempty__testmay__notapply__insome__cases.The__loopelse__becomeseven__moreuseful__whenused__inconjunction__withthe__forloop__thetopic__ofthe__nextsection__becausesequence__iterationis__notunder__your control.for__LoopsThe__forloop__isa__genericiterator__in Python:it__canstep__throughthe__itemsin__anyordered__sequenceor__otheriterable__object.All__told,the__forstatement__workson__strings, lists, tuples, sets, dictionaries,and__allother__built-in iterables,as__wellas__new user-definedobjects__thatyou__lllearn__howto__createlater__with classes.We__metfor__brieflyin__Chapter 4and__haveused__itin__conjunctionwith__sequenceobject__types;let__sexpand__onits__usagemore__formally here.General__FormatThe__Pythonfor__loopbegins__witha__headerline__thatspecifies__anassignment__target (or targets),along__withthe__objectyou__wantto__step through.The__headeris__followedby__ablock__of (normally indented)statements__thatyou__wantto__repeat:for__targetin__object: #Assign__objectitems__totarget__statements #Repeated__loop body:use__target else: #Optional__elsestatements__#Run__if didn'texit__loopbody__withbreak__WhenPython__runsa__for loop,it__assignsthe__itemsin__theiterable__objectto__thetarget__oneby__oneand__executesthe__loopbody__for each.The__loopbody__typicallyuses__theassignment__targetto__referto__thecurrent__itemin__thesequence__asthough__itwere__acursor__steppingthrough__the sequence.While__targetcan__beany__assignmenttarget__wemet__inChapter__11,it__soften__justa__simple name.This__nameis__apossibly__newvariable__thatlives__inthe__scopewhere__thefor__statementitself__is coded.There__snot__muchunique__aboutthis__name;it__caneven__bechanged__insidethe__loops__body,but__itwill__automaticallybe__setto__thenext__itemin__objectwhen__controlreturns__tothe__topof__theloop__again.After__theloop__thisvariable__normallystill__refersto__thelast__item visited,which__isthe__lastitem__inthe__sequenceunless__theloop__exitsearly__witha__break statement.The__forstatement__alsosupports__anoptional__else block,which__worksexactly__asit__doesin__awhile__loopit__sexecuted__ifthe__loopexits__withoutrunning__intoa__breakstatement__(i.e.,if__allitems__inthe__sequencehave__been visited).The__breakand__continuestatements__introducedearlier__alsowork__thesame__ina__forloop__asthey__doin__a while.Given__all that,the__forloop__scomplete__formatcan__bedescribed__this way:for__targetin__object: #Assign__objectitems__totarget__statementsif__test:break__#Exit__loop now,skip__elseif__test:continue__#Go__totop__ofloop__now else:statements__#Run__onexit__if didn'thit__a 'break'Examples__Lets__typea__fewfor__loopsinteractively__now,so__youcan__seehow__theyare__usedin__practice.Basic__usageAs__mentioned earlier,a__forloop__canstep__acrossany__kindof__sequence object.In__ourfirst__example,for__instance,we__llassign__thename__xto__eachof__thethree__itemsin__alist__in turn,from__leftto__right,and__theprint__statementwill__beexecuted__for each.Inside__theprint__statement (theloop__body),the__namex__refersto__thecurrent__itemin__the list: >>>for__xin__['app', 'script', 'program']: print(x, end=' ')app__scriptprogram__Thenext__twoexamples__computethe__sumand__productof__allthe__itemsin__a list.Later__inthis__chapterand__laterin__thisbook__youll__meettools__thatapply__operationssuch__as +and__*to__itemsin__alist__automatically,but__its__oftenjust__aseasy__touse__a for: >>>sum__= 0 >>>for__xin__[1, 2, 3, 4]:sum__=sum__+x__>>>sum__10 >>>prod__= 1 >>>for__itemin__[1, 2, 3, 4]:prod__*=item__>>>prod__24Other__datatypes__Anysequence__worksin__a for,as__its__ageneric__tool.For__example,for__loopsalso__workon__stringsand__tuples: >>>S__= 'Python' >>>T__= ('web', 'num', 'app') >>>for__xin__S: print(x, end=' ') #Iterate__overa__stringPython__>>>for__xin__T: print(x, end=' ') #Iterate__overa__tupleweb__numapp__In fact,as__well__explorein__thenext__chapterwhen__weformalize__thenotion__of iterables,for__loopscan__evenwork__onsome__objectsthat__arenot__sequencesincluding__files.Tuple__(sequence)assignment__infor__loopsIf__youre__iteratingthrough__asequence__of tuples,the__looptarget__itselfcan__actuallybe__atuple__of targets.This__isjust__anothercase__ofthe__tuple-unpackingassignment__westudied__inChapter__11at__work. Remember,the__forloop__assignsitems__inthe__sequenceobject__tothe__target,and__assignmentworks__thesame__everywhere: >>>T__= [(1, 2), (3, 4), (5, 6)] >>>for__(a, b)in__T: #Tuple__assignmentat__work print(a, b) 1 2 3 4 5 6 Here,the__firsttime__throughthe__loopis__likerunning__(a,b) = (1,2),the__secondtime__islike__(a,b) = (3,4),and__so on.The__neteffect__isto__automaticallyunpack__thecurrent__tupleon__each iteration.List__syntaxworks__asa__fortarget__toobecause__tupleand__listassignment__areboth__sequence assignment,and__tupleparentheses__are optional: >>>for__[a, b]in__T: #List__assignment:same__effect >>>for__a,b__in T: #Tuple__sans parentheses:same__effectThis__list-of-tuplesdata__formatis__commonlyused__inconjunction__withthe__zipcall__youll__meetlater__inthis__chapter,to__implementparallel__traversals.It__alsocrops__upin__conjunctionwith__SQLdatabases__in Python,where__queryresult__tablesare__returnedas__sequencesof__sequenceslike__thelist__usedhere__theouter__listis__thedatabase__table,the__nestedtuples__arethe__rowswithin__the table,and__tuple (i.e., sequence)assignment__extracts columns.As__weve__seenin__earlier chapters,tuples__infor__loopsalso__comein__handyto__iteratethrough__bothkeys__andvalues__indictionaries__usingthe__items method,rather__thanlooping__throughthe__keysand__indexingto__fetchthe__values manually: >>>D__= {'a': 1, 'b': 2} >>>for__keyin__D: print(key, '=>', D[key]) #Use__dictkeys__iteratorand__indexa__=> 1b__=> 2 >>> list(D.items()) [('a', 1), ('b', 2)] >>>for__(key, value)in__D.items(): print(key, '=>', value) #Iterate__overboth__keysand__valuesa__=> 1b__=> 2It__simportant__tonote__thattuple__assignmentin__forloops__isnt__aspecial__case;any__assignmenttarget__workssyntactically__afterthe__word for.For__example,we__canalways__assignmanually__withinthe__loopto__unpack: >>>T__[(1, 2), (3, 4), (5, 6)] >>>for__bothin__T: a,b__=both__#Manual__assignmentequivalent__print(a, b) 1 2 3 4 5 6But__tuplesin__theloop__headersave__usan__extrastep__wheniterating__throughsequences__of sequences.As__suggestedin__Chapter 11,even__nestedstructures__maybe__automaticallyunpacked__thisway__ina__for: >>> ((a, b), c) = ((1, 2), 3) #Nested__sequenceswork__too >>> a, b,c__(1, 2, 3) >>>for__((a, b), c)in__[((1, 2), 3), ((4, 5), 6)]: print(a, b, c) 1 2 3 4 5 6Even__thisis__nota__special case,though__thefor__loopsimply__runsthe__sortof__assignmentwe__ranjust__before it,on__each iteration.Any__nestedsequence__structuremay__beunpacked__this way,simply__becausesequence__assignmentis__so generic: >>>for__((a, b), c)in__[([1, 2], 3), ['XY', 6]]: print(a, b, c) 1 2 3X__Y 6 Extended-unpackingassignment__infor__loopsIn__fact,because__theloop__variablein__afor__loopcan__beany__assignment target,we__canalso__usethe__starrednames__andother__targetsof__extended-unpackingassignment__hereto__extractboth__itemsand__sectionsof__sequenceswithin__sequences.Because__thisworks__inassignment__statements,it__automaticallyworks__infor__loops too.This__topicwas__introducedin__Chapter 11,but__heres__aquick__refresherto__reinforcethe__technique.Consider__thetuple__assignmentform__introducedin__theprior__section.A__tupleof__valuesis__assignedto__atuple__ofnames__oneach__iteration,exactly__likea__simpleassignment__statement: >>> a, b,c__= (1, 2, 3) #Tuple__assignment >>> a, b,c__(1, 2, 3) >>>for__(a, b, c)in__[(1, 2, 3), (4, 5, 6)]: #Used__infor__loop print(a, b, c) 1 2 3 4 5 6Because__sequenceassignment__supportsa__moregeneral__setof__nameswith__astarred__targetto__collectmultiple__items,we__canuse__thesame__syntaxto__extractparts__ofnested__sequencesin__thefor__loop: >>> a, *b,c__= (1, 2, 3, 4) # Extended-unpackingassignment__>>> a, b,c__(1, [2, 3], 4) >>>for__(a, *b, c)in__[(1, 2, 3, 4), (5, 6, 7, 8)]: print(a, b, c) 1 [2, 3] 4 5 [6, 7] 8In__practice,this__approachmight__beused__topick__outmultiple__columnsfrom__rowsof__datarepresented__asnested__sequences.As__usualin__Python,you__canachieve__similareffects__withmore__basictools__inthis__caseby__slicing.The__onlydifference__isthat__slicingreturns__a type-specific result,whereas__starredtargets__alwaysreceive__lists: >>>for__allin__[(1, 2, 3, 4), (5, 6, 7, 8)]: #Manual__slicingversion__a, b,c__= all[0], all[1:-1], all[-1] print(a, b, c) 1 (2, 3) 4 5 (6, 7) 8 Finally,all__the starred-targetforms__workin__foras__in =assignment__statements,including__nested sequences, indexes,and__slices (thoughpractical__rolesfor__codelike__thefollowing__areprobably__muchmore__rarethan__common!): >>> L,M__= [1, 2], [3, 4] >>>pairs__= [[(5, 6), (7, 8), (9, 10)]] * 2 >>>for__[(a, *X), (b, *L[0]), (c, *M[:0])]in__pairs: print(f'<{a=} {X=}> <{b=} {L=}> <{c=} {M=}>')See__Chapter 11for__moreon__the extended-unpackingform__of assignment.Nested__forloops__Nowlet__slook__atsome__forloops__thatare__abit__moresophisticated__thanthose__demoedso__far.The__firstshows__whathappens__whenfor__loopsare__nestedthe__innerloop__isrun__forevery__iterationof__theouter__loop,and__the +within__theinner__loopcombines__theiritems__byusing__eachloop__s variable: >>>for__xin__'abc': #For__eachitem__inone__stringfor__yin__'123': #And__foreach__itemin__anotherstring__print(x + y, end=' ') #Concatenate__currentitems__fromboth__a1 a2 a3 b1 b2 b3 c1 c2 c3The__nextexample__kicksthe__nestingup__a notch,illustrating__both three-levelstatement__nestingand__theloop__elseclause__ina__for.Given__alist__ofobjects__(items)and__alist__ofkeys__(tests),this__codesearches__foreach__keyin__theobjects__listand__reportson__thesearch__s outcome: >>>items__= ['aaa', 111, (4, 5), 2.01] #A__listof__objects >>>tests__= [(4, 5), 3.14] #Keys__tosearch__for >>> >>>for__keyin__tests: #For__allkeys__foritem__in items: #For__allitems__ifitem__== key: #Check__formatch__print(key, 'was found')break__else: print(key, 'not found!') (4, 5)was__found 3.14not__found!Because__thenested__ifruns__abreak__whena__matchis__found,the__innerloop__selse__clausecan__assumethat__ifit__is reached,the__searchhas__failed.Notice__thenesting__here.When__thiscode__runs,there__aretwo__loopsgoing__atthe__same time:the__outerloop__scansthe__keys list,and__theinner__loopscans__theitems__listfor__each key.The__nestingof__theloop__elseclause__is critical;it__sindented__tothe__samelevel__asthe__headerline__ofthe__innerfor__loop,so__its__associatedwith__theinner__loop,not__theif__orthe__outer for.The__precedingexample__is illustrative,but__itmay__beeasier__tocode__ifwe__employthe__inoperator__totest__membership.Because__inimplicitly__scansan__objectlooking__fora__match (atleast__logically),it__replacesthe__inner loop: >>>for__keyin__tests: #For__allkeys__ifkey__in items: #Let__Pythoncheck__fora__match print(key, 'was found') else: print(key, 'not found!') (4, 5)was__found 3.14not__found!In__general,it__sa__goodidea__tolet__Pythondo__asmuch__ofthe__workas__possible (asin__this solution)for__thesake__ofboth__brevityand__performance.Our__finalexample__is similar,but__buildsa__listas__itgoes__forlater__useinstead__of printing.It__performsa__typical data-structuretask__witha__forcollecting__commonitems__intwo__sequences (its__nearly intersection,unless__thereare__duplicate values).After__theloop__runs,res__refersto__alist__thatcontains__allthe__itemsfound__in seq1and__seq2: >>> seq1 = 'trippy' >>> seq2 = 'python' >>> >>>res__= [] #Start__empty >>>for__xin__seq1: #Scan__firstsequence__ifx__in seq2: #Common__item? res.append(x) #Add__toresult__end >>>res__['t', 'p', 'p', 'y'] Unfortunately,this__codeis__equippedto__workonly__ontwo__specific variables: seq1and__seq2.It__wouldbe__niceif__thisloop__couldsomehow__begeneralized__intoa__toolyou__coulduse__morethan__once.As__youll__see,that__simpleidea__leadsus__to functions,the__topicof__thenext__partof__the book.Of__course,if__youread__Chapter 4or__Chapter 5,you__knowthat__Pythonhas__setsthat__providetrue__intersectionwith__the &operator__butthe__results__orderis__scrambled,duplicates__are dropped,and__multipleconversions__arerequired__to match: >>> list(set(seq1) & set(seq2)) #Real__intersectionwith__sets ['p', 'y', 't']More__usefully,this__codealso__exhibitsthe__classiclist__comprehensionpattern__collectinga__resultslist__withan__iterationand__optionalfilter__testand__couldbe__codedmuch__moreconcisely__withthis__tool: >>> [xfor__xin__seq1if__xin__seq2] #Let__Pythoncollect__results ['t', 'p', 'p', 'y']But__youll__haveto__readon__tothe__nextchapter__forthe__restof__this story.Loop__CodingTechniques__Thefor__loopwe__juststudied__subsumesmost__counter-style loops.It__sgenerally__simplerto__codeand__oftenquicker__torun__thana__while,so__its__thefirst__toolyou__shouldreach__forwhenever__youneed__tostep__througha__sequenceor__other iterable.In__fact,as__ageneral__rule,you__shouldresist__thetemptation__tocount__thingsin__Pythonits__iterationtools__automatemuch__ofthe__workyou__doto__loopover__collectionsin__lower-levellanguages__like C. Still,there__aresituations__whereyou__willneed__toiterate__inmore__specialized ways.For__example,what__ifyou__needto__visitevery__secondor__thirditem__ina__list,or__changethe__listalong__the way?How__abouttraversing__morethan__onesequence__in parallel,in__thesame__for loop?What__ifyou__needindexes__too?You__canalways__codesuch__uniqueiterations__witha__whileloop__andmanual__indexing,but__Pythonprovides__aset__of built-insthat__allowyou__tospecialize__theiteration__ina__for:The__built-inrange__functionproduces__aseries__ofsuccessively__higher integers,which__canbe__usedas__indexesin__a for.The__built-inzip__functionreturns__aseries__of parallel-item tuples,which__canbe__usedto__traversemultiple__sequencesin__a for.The__built-inenumerate__functiongenerates__boththe__valuesand__indexesof__itemsin__an iterable,so__wedon__tneed__tocount__manually.Because__forloops__mayrun__quickerthan__while-basedcounter__loops,it__sto__youradvantage__touse__toolslike__thesethat__allowyou__touse__forwhenever__possible.Let__slook__ateach__ofthese__built-insin__turn,in__thecontext__ofcommon__roles.As__youll__see,some__loop-codingalternatives__aremore__validthan__others.Counter__Loops:range__Ourfirst__loop-related function, range,is__ageneral__toolthat__canbe__usedin__avariety__of contexts.We__metit__brieflyin__Chapter 4and__haveused__itoccasionally__alongthe__way.Although__its__usedoften__togenerate__indexesin__a loop,you__cancall__itanywhere__youneed__aseries__ofintegers__(seeChapter__11s__enumerated-names__trickfor__aprime__example).As__weve__seen,range__isan__iterablethat__generatesitems__on demand,so__weneed__towrap__itin__alist__callto__displayall__itsresults__atonce__ina__REPL. Surprisingly,range__sresults__supportsome__sequence operations,but__not all;per__Chapter 9,it__wasreclassified__inPython__sdocs__asa__sortof__sequenceobject__type,though__onewith__lessfunctionality__thanlists__andtuples__andmuch__lessbasis__in reality: >>> list(range(5)), list(range(2, 5)), list(range(0, 10, 2)) ([0, 1, 2, 3, 4], [2, 3, 4], [0, 2, 4, 6, 8]) >>> range(5)[2], range(5)[1:3], list(range(5)) + [6, 7] (2, range(1, 3), [0, 1, 2, 3, 4, 6, 7]) >>> range(5) + [6, 7] TypeError:unsupported__operand type(s)for__+: 'range'and__'list'Categorization__aside,range__usageis__straightforward,With__one argument,range__generatesa__seriesof__integersfrom__zeroup__tobut__notincluding__theargument__s value.If__youpass__intwo__arguments,the__firstis__takenas__thelower__bound.And__anoptional__thirdargument__cangive__a step;if__itis__used,Python__addsthe__stepto__eachsuccessive__integerin__theresult__(thestep__defaultsto__+1).Ranges__canalso__benonpositive__and nonascending,if__youneed__themto__be: >>> list(range(-5, 5)) [-5, -4, -3, -2, -1, 0, 1, 2, 3, 4] >>> list(range(5, -5, -1)) [5, 4, 3, 2, 1, 0, -1, -2, -3, -4]We__lltake__adeeper__lookat__iterablesin__Chapter 14.In__this case,Python__2.Xhad__anoptimized__built-innamed__xrange,which__waslike__itsrange__butdidn__tbuild__aresult__listin__memoryall__at once;which__waslater__supersededin__3.Xby__thegenerator__behaviorof__its range;which__waslater__rebrandeda__sequenceby__3.Xdocs__(confusingly!).The__upshotof__thislong__walkis__thattoday__srange__doesnt__consumemuch__space,because__itproduces__numbersonly__on demand.Although__thepreceding__rangeresults__maybe__usefulall__by themselves,they__tendto__comein__mosthandy__withinfor__loops.For__one thing,they__providea__simpleway__torepeat__anaction__aspecific__numberof__times.To__printthree__lines,for__example,use__arange__togenerate__theappropriate__numberof__integers: >>>for__iin__range(3): print(i, 'Pythons') 0Pythons__1Pythons__2Pythons__Notethat__forloops__forceresults__fromrange__automatically,so__wedon__tneed__touse__alist__wrapper here.In__fact,we__shouldn t:letting__rangeproduce__itsresults__oneat__atime__usesmuch__lessmemory__thanforcing__themall__at once.Sequence__Scans: while, range,and__forThe__rangecall__isalso__sometimesused__toiterate__overa__sequence indirectly,though__its__oftennot__thebest__approachin__this role.The__easiestand__fastestway__tostep__througha__sequenceexhaustively__isalmost__alwayswith__asimple__for,because__Pythonhandles__mostof__thedetails__foryou__in quick,internal__code: >>>X__= 'hack' >>>for__itemin__X: print(item, end=' ') #Automatic__iterationwith__forhack__Internally,the__forloop__handlesthe__detailsof__theiteration__automaticallywhen__usedthis__way.If__youreally__needto__takeover__theindexing__logicexplicitly__(andsometimes__you may),you__cando__itwith__awhile__loop: >>>i__= 0 >>>while__i < len(X): #Manual__iterationwith__while print(X[i], end=' ')i__+= 1hack__>>>i__= -1 >>>while__(i :=i__+ 1) < len(X): # Manual,but__with :=operator__print(X[i], end=' ')hack__Youcan__alsodo__manualindexing__witha__for, though,if__youuse__rangeto__generateindexes__toiterate__through.It__sa__multistepprocess__youmust__askfor__therange__ofthe__subjects__lenbut__its__sufficientto__generate offsets,rather__thanthe__itemsat__those offsets: >>>X__'hack' >>> len(X) #Length__ofstring__4 >>> list(range(len(X))) #All__legaloffsets__intoX__[0, 1, 2, 3] >>> >>>for__iin__range(len(X)): print(X[i], end=' ') #Manual__range/leniteration__hack Importantly,because__thisexample__isstepping__overa__listof__offsetsinto__X,not__theactual__itemsof__X,we__needto__indexback__intoX__withinthe__loopto__fetcheach__item.If__thisseems__like overkill, though,it__sbecause__it is:there__sreally__noreason__towork__thishard__inthis__example.Although__the range/lencombination__isuseful__insome__roles,it__sprobably__notthe__bestoption__in most.It__mayrun__slower,and__its__alsomore__codethan__weneed__to write.Unless__youhave__aspecial__indexing requirement,you__rebetter__offusing__thesimple__forloop__formin__Python: >>>for__itemin__X: print(item, end=' ') #Use__autoiteration__ifyou__canAs__guidelines,use__forinstead__ofwhile__whenever possible,and__dont__userange__callsin__forloops__exceptas__alast__resort.This__simplersolution__isalmost__always better.Like__everygood__guideline, though,there__areplenty__ofexceptions__asthe__nextsection__demonstrates.Sequence__Shufflers:range__andlen__Thoughnot__idealfor__simplesequence__scans,the__range/lencoding__patternused__inthe__priorexample__doesallow__usto__domore__specializedsorts__oftraversals__when required.For__example,some__algorithmscan__makeuse__ofsequence__reorderingto__generatealternatives__in searches,to__testthe__effectof__differentvalue__orderings,and__so on.Such__casesmay__requireoffsets__inorder__topull__sequencesapart__andput__themback__together,as__inthe__following;its__ranges__integersprovide__arepeat__countin__the first,and__aposition__forslicing__inthe__second: >>>S__= 'hack' >>>for__iin__range(len(S)): #For__repeatcounts__0..3S__= S[1:] + S[:1] #Move__frontitem__toend__print(S, end=' ')ackh__ckhakhac__hack >>>S__'hack' >>>for__iin__range(len(S)): #For__positions 0..3X__= S[i:] + S[:i] #Rear__part +front__part print(X, end=' ')hack__ackhckha__khacTrace__throughthese__oneiteration__ata__timeif__theyseem__confusing.The__secondcreates__thesame__resultsas__the first,though__ina__different order,and__doesnt__changethe__originalvariable__asit__goes.Because__bothslice__toobtain__partsto__concatenate,they__alsowork__onany__typeof__sequence,and__returnsequences__ofthe__sametype__asthat__beingshuffled__ifyou__shufflea__list,you__createreordered__lists: >>>L__= [1, 2, 3, 4] >>>for__iin__range(len(L)):X__= L[i:] + L[:i] #Works__onany__sequencetype__print(X, end=' ') [1, 2, 3, 4] [2, 3, 4, 1] [3, 4, 1, 2] [4, 1, 2, 3]The__resultsof__range itself, however,don__tmake__thegrade__ineither__coding (theyre__nottrue__sequences!): >>>L__= range(4) >>>same__codeas__priorexample__TypeError:unsupported__operand type(s)for__+: 'range'and__'range'We__llmake__useof__codelike__thisto__testfunctions__withdifferent__argumentorderings__inChapter__18,and__willextend__itto__functions, generators,and__morecomplete__permutationsin__Chapter 20it__sa__widelyuseful__tool.Skipping__Items:range__andSlices__Theprior__sectionshowed__onevalid__applicationsfor__the range/len combination.We__mightalso__usethis__techniqueto__skipitems__aswe__go: >>>S__= 'abcdefghijk' >>> list(range(0, len(S), 2)) [0, 2, 4, 6, 8, 10] >>>for__iin__range(0, len(S), 2): print(S[i], end=' ')acegik__Here,we__visitevery__seconditem__inthe__stringS__bystepping__overthe__generatedrange__list.To__visitevery__third item,change__thethird__rangeargument__tobe__3,and__so on.In__effect,using__rangethis__waylets__youskip__itemsin__loopswhile__stillretaining__thesimplicity__ofthe__for statement.In__manyor__most cases, though,this__isalso__probablynot__thebest__practicetechnique__inPython__today.If__youreally__meanto__skipitems__ina__sequence,the__extended three-limitform__ofthe__slice expression,presented__inChapter__7,provides__asimpler__routeto__thesame__goal.To__visitevery__secondcharacter__in S,for__example,slice__witha__strideof__2: >>>S__= 'abcdefghijk' >>>for__cin__S[::2]: print(c, end=' ')acegik__Theresult__isthe__same,but__substantiallyeasier__foryou__towrite__andfor__othersto__read.The__potentialadvantage__tousing__rangehere__insteadis__space:slicing__makesa__copyof__the string,while__rangedoes__notand__hencemay__savesignificant__memoryfor__verylarge__strings. Naturally,whether__yourprogram__needsto__caredepends__onwhat__it does.Changing__Lists:range__andComprehensions__Anothercommon__placewhere__youmay__usethe__range/lencombination__withfor__isin__loopsthat__changea__listas__itis__being traversed. Suppose,for__example,that__youneed__toadd__1to__everyitem__ina__list (maybeyou__reupdating__agesat__year end).You__cantry__thiswith__asimple__for loop,but__theresult__maynot__bewhat__youwant__or expect: >>>L__= [10, 20, 30, 40, 50] >>>for__xin__L:x__+= 1 #Changes__x,not__L! >>>L__# L'sobjects__unchanged [10, 20, 30, 40, 50] >>>x__#x__isnot__acursor__intoL__51This__doesnt__quitework__itchanges__theloop__variable x,not__thelist__L.The__reasonis__somewhat subtle.Each__timethrough__the loop,x__refersto__thenext__integeralready__pulledout__ofthe__list.In__thefirst__iteration,for__example,x__isinteger__10,taken__from L,When__wethen__addto__xin__theloop__bodywith__+=,it__setsx__toa__different object,integer__11,but__itdoes__notupdate__thelist__where 10originally__came from;the__new 11is__apiece__ofmemory__separatefrom__the list.To__reallychange__thelist__aswe__marchacross__it,we__needto__useindexes__sowe__canassign__anupdated__valueto__eachposition__aswe__go.The__range/lencombination__canproduce__therequired__indexesfor__us: >>>L__= [10, 20, 30, 40, 50] >>>for__iin__range(len(L)): #Add__oneto__eachitem__inL__L[i] += 1 #Or__L[i] = L[i] + 1 >>>L__[11, 21, 31, 41, 51]When__codedthis__way,the__listis__changedas__weproceed__throughthe__loop.There__isno__wayto__dothe__samewith__asimple__forx__in L,because__sucha__loopiterates__throughactual__items,not__their positions.But__whatabout__theequivalent__while loop?Such__aloop__requiresa__bitmore__workon__our part,and__mightrun__moreslowly__dependingon__your Python,your__host device,and__perhapsthe__alignmentof__planets (youll__seehow__tocheck__suchclaims__inChapter__21): >>>i__= 0 >>>while__i < len(L): #And__similarwith__:=assignment__L[i] += 1i__+= 1 >>>L__[12, 22, 32, 42, 52]Here__again, though,the__rangesolution__maynot__beideal__either.A__listcomprehension__expressionof__the form: >>> [x + 1for__xin__L] [13, 23, 33, 43, 53]likely__runsfaster__todayand__woulddo__similar work,albeit__withoutchanging__theoriginal__listin__place (wecould__assignthe__expressions__newlist__objectresult__backto__L,but__thiswould__notupdate__anyother__referencesto__theoriginal__list).Because__thisis__sucha__centrallooping__concept,we__llsave__acomplete__explorationof__listcomprehensions__forthe__next chapter,and__tellthe__restof__thestatements__storyof__loops there.Parallel__Traversals:zip__Ournext__loopcoding__techniqueadds__toits__bagof__tricks.As__weve__seen,the__range built-inallows__usto__traversesequences__withfor__ina__nonexhaustive fashion.In__asimilar__spirit,the__built-inzip__functionallows__usto__usefor__loopsto__visitmultiple__sequencesin__parallelnot__overlappingin__time,but__duringthe__same loop.In__basic operation,zip__takesone__ormore__arguments (sequencesor__other iterables)and__returnsa__seriesof__tuplesthat__pairup__parallelitems__takenfrom__those arguments.For__example,suppose__were__workingwith__twolists__ofdata__pairedby__position: >>> L1 = [1, 2, 3, 4] >>> L2 = [5, 6, 7, 8]To__combinethe__itemsin__these lists,we__canuse__zipto__createa__listof__tuple pairs.Like__range,zip__isan__iterable object,so__wemust__wrapit__ina__listcall__tocollect__anddisplay__allits__resultsat__once (again,the__nextchapter__willbe__moreformal__aboutiterables__like this): >>> zip(L1, L2) #An__iterablethat__generatespairs__>>> list(zip(L1, L2)) # list()required__tosee__allresults__[(1, 5), (2, 6), (3, 7), (4, 8)]Such__aresult__maybe__usefulin__othercontexts__as well,but__whenwedded__withthe__for loop,it__supportsparallel__iterations: >>>for__(x, y)in__zip(L1, L2): print(f'{x} + {y} => {x + y}') 1 + 5 => 6 2 + 6 => 8 3 + 7 => 10 4 + 8 => 12 Here,we__stepover__theresult__ofthe__zipcall__that is,the__pairsof__itemspulled__fromthe__two lists.Notice__thatthis__forloop__againuses__thetuple__(a.k.a. sequence)assignment__formwe__metearlier__tounpack__eachtuple__inthe__zip result.The__firsttime__through,it__sas__thoughwe__ranthe__assignmentstatement__(x, y) = (1, 5) ;and__so on.The__neteffect__isthat__wescan__both L1and__L2in__our loop.To__be sure,we__couldachieve__asimilar__effectwith__awhile__loopthat__handlesindexing__manuallylike__thefollowing__thatproduces__thesame__outputas__the preceding: >>>i__= -1 >>>while__(i :=i__+ 1) < len(L1): print(f'{L1[i]} + {L2[i]} => {L1[i] + L2[i]}')But__thisrequires__noticeablymore__code,and__hencewould__likelyrun__slowerthan__the for/zip approach. Moreover,it__sno__betteron__space:being__an iterable,zip__makesjust__onepair__per loop,and__sodoes__notconsume__memory needlessly.The__clincher, though,is__thatthis__isnot__reallyequivalent__tozip__forreasons__disclosedin__thenext__section.More__on zip:size__andtruncation__Forthe__record,the__zipfunction__ismore__generalthan__theprior__example suggests.For__instance,it__bothis__aniterable__andaccepts__anytype__ofiterable__object,including__range results,input__files,and__more: >>> list(zip(range(4), 'hack')) [(0, 'h'), (1, 'a'), (2, 'c'), (3, 'k')]In__addition,zip__isnot__justfor__two-item pairs:it__acceptsany__numberof__arguments,of__any size.The__following,for__example,builds__alist__of three-itemtuples__forthree__arguments,with__itemsfrom__eachsequence__essentiallyprojecting__by columns: >>> T1, T2, T3 = (1, 2, 3), (4, 5, 6), (7, 8, 9) >>> T3 (7, 8, 9) >>> list(zip(T1, T2, T3)) # 3args__of 3vals__=> 3 3-itemtuples__[(1, 4, 7), (2, 5, 8), (3, 6, 9)]And__formally speaking,for__Narguments__thatcontain__M items,zip__givesus__an M-longseries__of N-ary tuples: >>> list(zip(T1, T2)) # 2args__of 3vals__=> 3 2-itemtuples__[(1, 4), (2, 5), (3, 6)]When__argumentlengths__differ,zip__truncatesthe__seriesof__resulttuples__atthe__lengthof__theshortest__sequence.To__demo,the__followingzips__twostrings__topick__outcharacters__in parallel,but__theresult__hasonly__asmany__tuplesas__thelength__ofthe__shortestsequence__(formally again,M__inthe__priordefinition__isreally__theminimum__ofarguments__lengths): >>> S1 = 'abc' >>> S2 = 'xyz123' >>> >>> list(zip(S1, S2)) #Truncates__at len(shortest) [('a', 'x'), ('b', 'y'), ('c', 'z')]To__padinstead__of truncating,you__canwrite__loopcode__topad__resultsyourself__aswe__willin__Chapter 20,after__weve__hada__chanceto__studysome__additionaliteration__conceptsthat__makeit__afair__fight.More__zip roles:dictionaries__Finepoints__aside,parallel__traversalswith__zipare__alsouseful__indictionary__construction.We__metthis__techniquein__Chapter 8,but__heres__aquick__refresherin__thecontext__oflooping__statements.As__welearned__earlier,you__canalways__createa__dictionaryby__calling dict,assigning__tokeys__over time,or__codinga__dictionaryliteral__likethe__following: >>> D1 = {'app': 1, 'script': 3, 'program':5} #Or__dict(key=value, ) >>> D1 {'app': 1, 'script': 3, 'program': 5}What__to do, though,if__yourprogram__obtainsdictionary__keysand__valuesat__runtime,after__youve__codedyour__script?For__example,the__followingmay__becollected__froma__user,a__file,or__anyother__dynamic source: >>>keys__= ['app', 'script', 'program'] >>>vals__= [1, 3, 5]One__wayto__turnthese__intoa__dictionaryis__tozip__thelists__andstep__throughthem__inparallel__witha__for loop: >>> list(zip(keys, vals)) [('app', 1), ('script', 3), ('program', 5)] >>> D2 = {} >>>for__(k, v)in__zip(keys, vals): D2[k] =v__>>> D2 {'app': 1, 'script': 3, 'program': 5}As__suggestedearlier__inthis__book, though,you__canskip__thefor__loopaltogether__inthis__context,and__simplypass__thezipped__keys/valueslists__tothe__built-indict__constructor call: >>> D3 = dict(zip(keys, vals)) >>> D3 {'app': 1, 'script': 3, 'program': 5}The__built-inname__dictis__reallya__typename__(youll__learnabout__type names,and__subclassing them,in__Chapter 32).Calls__toit__areobject__construction requests,but__alsoperform__a to-dictionaryconversion__here.In__thenext__chapter,you__llalso__learnmore__aboutrelated__butricher__conceptslist__comprehensions,which__buildlists__in expressions,and__theirdictionary__comprehensions kin,which__arean__alternativeto__bothfor__statementsand__dictfor__zipped key/value pairs: >>> {k:v__for (k, v)in__zip(keys, vals)} {'app': 1, 'script': 3, 'program': 5}Offsets__and Items:enumerate__Ourfinal__loop-helperfunction__isdesigned__tosupport__dualusage__modes. Earlier,we__discussedusing__rangeto__generatethe__offsetsof__itemsin__a string,rather__thanthe__itemsat__those offsets.In__some programs, though,we__need both:the__itemto__use,plus__anoffset__aswe__go.This__mightbe__codedwith__afor__loopthat__alsokeeps__acounter__ofthe__current offset: >>>S__= 'hack' >>>offset__= 0 >>>for__itemin__S: print(item, 'appearsat__offset', offset)offset__+= 1h__appearsat__offset 0a__appearsat__offset 1c__appearsat__offset 2k__appearsat__offset 3This__works,but__Pythonhas__a built-infunction__namedenumerate__thatdoes__thejob__forus__itsnet__effectis__togive__loopsa__counterfor__free,without__sacrificingthe__simplicityof__automatic iteration: >>>S__= 'hack' >>>for__(offset, item)in__enumerate(S): print(item, 'appearsat__offset', offset)h__appearsat__offset 0a__appearsat__offset 1c__appearsat__offset 2k__appearsat__offset 3As__forrange__and zip,the__enumeratefunction__sresult__isan__iterablea__kindof__objectthat__supportsthe__iterationprotocol__thatwe__willdive__intoin__thenext__chapter.In__short,it__hasa__methodcalled__bythe__next built-in function,which__returnsan__(index, value)tuple__eachtime__throughthe__loop.The__forsteps__throughthese__tuples automatically,which__allowsus__tounpack__theirvalues__withtuple__assignment,much__aswe__didfor__zip: >>>E__= enumerate(S) >>>E__>>> next(E) (0, 'h') >>> next(E) (1, 'a') >>> next(E) (2, 'c')We__dont__normallysee__thismachinery__becauseall__iterationcontexts__includinglist__comprehensions,the__mainsubject__ofChapter__14run__theiteration__protocol automatically: >>> [c *i__for (i, c)in__enumerate(S)] ['', 'a', 'cc', 'kkk'] >>>for__(ix, line)in__enumerate(open('data.txt')): print(f'{ix}) {line.rstrip()}') 0)Testing__fileIO__1)Learning__Python, 6E 2)Python__3.12To__fullyunderstand__iterationconcepts__likeenumerate__andlist__comprehensions, though,we__needto__moveon__tothe__nextchapter__fora__deeper dissection.Chapter__SummaryIn__this chapter,we__exploredPython__slooping__statementsand__theirrelated__tools.We__lookedat__thewhile__andfor__loopstatements__in depth,and__welearned__abouttheir__associatedelse__clauses.We__alsostudied__thebreak__andcontinue__statements,which__havemeaning__onlyinside__loops,and__metseveral__built-inscommonly__usedin__for loops,including__range, zip,and__enumerate,although__someof__thedetails__regardingtheir__rolesas__iterableswere__intentionallycut__short.In__thenext__chapter,we__continuethe__iterationstory__bydiscussing__listcomprehensions__andthe__iterationprotocol__inPython__conceptsstrongly__relatedto__for loops. There,we__llalso__fillin__therest__ofthe__picturebehind__theiterable__toolswe__met here,such__asrange__and zip,and__studysome__ofthe__subtletiesof__their operation.As__always, though,before__movingon__lets__exercisethe__knowledgeyou__vepicked__uphere__witha__quiz.Test__Your Knowledge:Quiz__1.What__arethe__mainfunctional__differencesbetween__whileand__for loops? 2.What__sthe__differencebetween__breakand__continue? 3.When__isa__loops__elseclause__executed? 4.How__canyou__codea__counter-basedloop__in Python? 5.What__cana__rangebe__usedfor__ina__for loop?Test__Your Knowledge:Answers__1.The__whileloop__isa__generallooping__statement,but__thefor__isdesigned__toautomatically__iterateacross__itemsin__asequence__orother__iterable.Although__thewhile__canimitate__thefor__withcounter__loops,it__takesmore__codeand__mightrun__slower. 2.The__breakstatement__exitsa__loopimmediately__(controlflow__windsup__belowthe__entirewhile__orfor__loop statement),and__continuejumps__backto__thetop__ofthe__loop (controlflow__windsup__positionedjust__beforethe__testin__whileor__thenext__itemfetch__in for). 3.The__elseclause__ina__whileor__forloop__willbe__runonce__asthe__loopis__exiting,if__andonly__ifthe__loopexits__normally (i.e.,by__afalse__testin__whileor__anempty__objectin__for),without__runninginto__abreak__statement.A__breakexits__theloop__immediately,skipping__theelse__parton__theway__out (ifthere__is one). 4.Counter__loopscan__becoded__witha__whilestatement__thatkeeps__trackof__theindex__manually,or__witha__forloop__thatuses__therange__built-infunction__togenerate__successiveinteger__offsets.Neither__isthe__preferredway__tocode__in Python,if__youneed__tosimply__stepacross__allthe__itemsin__a sequence. Instead,use__asimple__forloop__withoutrange__or counters,whenever__possible;it__willbe__easierto__codeand__usuallyquicker__to run. 5.The__range built-incan__beused__ina__forloop__toimplement__afixed__numberof__repetitions,to__scanby__offsetsinstead__ofitems__at offsets,to__skipsuccessive__itemsas__you go,and__tochange__alist__whilestepping__across it.None__ofthese__rolesrequires__range,and__mosthave__alternativesscanning__actual items, three-limit slices,and__listcomprehensions__areoften__bettersolutions__today (despitethe__naturalinclinations__ofex__Cprogrammers__towant__tocount__things!).WHY__YOUWILL__CARE:FILE__SCANNERSLoops__comein__handyanywhere__youneed__torepeat__anoperation__orprocess__somethingmore__than once.Because__textfiles__containmultiple__charactersand__lines,they__area__typicalrole__for loops.Assuming__afile__scontents__canfit__in memory,you__canload__itall__atonce__withthe__fileobject__sread__methodof__Chapter 9:file__= open('data.txt') #Read__contentsinto__astring__allat__once print(file.read())For__moregranular__access,you__canscan__bycharacters__insteadwith__eitherof__thefollowing__thesecond__ofwhich__doesnt__loadthe__wholefile__andhas__grownterser__withthe__:=named__assignmentof__Chapter 11:for__charin__open('data.txt').read(): print(char, end='')file__= open('data.txt')while__char := file.read(1): #Read__by character,empty__means end-of-file print(char, end='') # Don'tadd__a \nafter__eachcharacter__Toread__bylines__orblocks__instead,you__canuse__whileloops__likethe__following;binary__datais__oftenread__byblocks__usingbinary__filemode__'rb',but__textshould__usetext__modeto__avoidsplitting__character bytes:file__= open('data.txt')while__line := file.readline(): #Read__lineby__line print(line.rstrip()) #Line__alreadyhas__a \nnewline__file = open('data.txt')while__chunk := file.read(10): #Read__blockby__block:up__to 10characters__print(chunk, end='') #Keep__but don'tadd__newlinesTo__readtext__filesby__lines, though,the__forloop__tendsto__beeasiest__tocode__andmay__bequickest__to run:for__linein__open('data.txt').readlines(): print(line.rstrip())for__linein__open('data.txt'): #Use__iterators:best__fortext__input (maybe) print(line.rstrip())The__firstversion__hereuses__thefile__readlinesmethod__toload__afile__allat__onceinto__a line-string list,but__thesecond__examplerelies__onfile__iteratorsto__automaticallyread__oneline__oneach__loop iteration.The__secondexample__isalso__generallybest__fortext__filesbesides__its simplicity,it__worksfor__arbitrarilylarge__filesbecause__itdoesn__tload__theentire__fileinto__memoryall__at once.The__iteratorversion__mayalso__bethe__quickest,though__speedcan__varyper__Pythonrelease__(well__studyways__totime__codelater__inthis__book).File__readlinescalls__canstill__be useful,though__toreverse__afile__s lines,for__example,assuming__itscontent__canfit__in memory.The__reversed built-inworks__on sequences,but__doesnot__acceptiterables__thatgenerate__values; sorted,by__contrast, does,so__itcan__orderall__thelines__ina__filewithout__loadingit__in full:for__linein__reversed(open('data.txt').readlines()): print(line.rstrip())for__linein__sorted(open('data.txt')): print(line.rstrip())See__Pythons__documentationfor__moreon__the file-objectcalls__usedhere__aswell__asits__coverageof__toolslike__os.popenthat__returnsa__fileobject__connectedto__ashell__commands__output (by default),and__hencesupports__thesame__sortof__loops.There__salso__an os.popenexample__inChapter__21,and__moreon__thedistinctions__oftext__andbinary__filesin__Chapter 37when__wedive__intoUnicode__more deeply.Chapter__14.Iterations__andComprehensions__Inthe__prior chapter,we__metPython__stwo__looping statements,while__and for.Although__theycan__handlemost__repetitivetasks__programsneed__to perform,iterating__overcollections__isso__commonand__pervasivethat__Pythonprovides__additionaltools__tomake__itsimpler__andmore__efficient.This__chapterbegins__ourexploration__ofthese__tools. Specifically,it__presentsPython__siteration__protocol,a__method-callmodel__usedby__thefor__loop,and__fillsin__somedetails__on comprehensions,which__area__closecousin__tothe__forloop__thatapply__anexpression__toeach__itemin__a collection.Because__thesetools__arerelated__toboth__thefor__loopand__functions,we__lltake__a two-passapproach__tocovering__themin__thisbook__alongwith__a postscript:This__chapterintroduces__theirbasics__inthe__contextof__looping-based tools,serving__assomething__ofa__continuationof__theprior__chapter.Chapter__20revisits__themin__thecontext__of function-based tools,and__extendsthe__topicto__include built-inand__user-defined generators.Chapter__30provides__ashorter__finalinstallment__inthis__story,which__willshow__ushow__tocode__user-definediterable__objectswith__classes.One__noteup__front:some__ofthe__conceptspresented__inthese__chaptersmay__seemadvanced__atfirst__glance.With__practice, though,you__llfind__thatthese__toolsare__usefuland__natural.Although__neverstrictly__required,they__vealso__becomecommonplace__inPython__code,so__abasic__understandingcan__helpif__youmust__readprograms__writtenby__others.Iterations__Inthe__preceding chapter,we__learnedthat__thefor__loopcan__workon__anysequence__typein__Python,including__lists, tuples,and__strings,like__this (withblank__linesrequired__byREPLs__aftercompound__statementsomitted__for brevity): >>>for__xin__[1, 2, 3, 4]: print(x ** 2, end=' ') 1 4 9 16 >>>for__xin__(1, 2, 3, 4): print(x ** 3, end=' ') 1 8 27 64 >>>for__xin__'text': print(x * 2, end=' ')tt__eexx__ttAs__weve__also learned,the__forloop__iseven__moregeneric__thanthis__itworks__onany__iterable object.In__fact,this__istrue__ofall__iterationtools__thatscan__objectsfrom__leftto__rightin__Python,including__for loops;comprehensions__ofall__stripes;some__inmembership__tests;the__zip, enumerate,and__map built-in functions;and__more.Any__iterableobject__will do,even__nonsequenceslike__dictionaries: >>>for__kin__dict(a=1, b=2, c=3): print(k, end=' ')abc__Theconcept__ofiterable__objectswas__addedto__Pythonafter__its inception,but__ithas__cometo__permeatethe__languages__toolset.It__sessentially__ageneralization__ofthe__notionof__sequencesan__objectis__considerediterable__ifit__iseither__aphysically__storedsequence__oran__objectthat__producesone__resultat__atime__inthe__contextof__aniteration__toollike__for.In__a sense,iterable__objectsinclude__bothreal__sequencesand__virtualsequences__computedon__demand.The__virtualsequences__bothsave__memoryand__avoiddelays__byproducing__resultsone__ata__time,instead__ofall__at once.These__arenot__true sequences, however:virtual__iterablesdo__notsupport__thefull__rangeof__operationsdefined__forlists__and tuples. Rather,they__simplymaterialize__aseries__ofvalues__overtime__andon__request.Whether__aniterable__isphysical__or virtual,it__announcesits__supportfor__iterationsby__implementingthe__iterationprotocol__aset__ofcallable__methodsused__byall__iteration tools,and__thesubject__ofthe__next section.NOTE__Terminology moment:The__Pythonworld__sometimesuses__theterms__iterableand__iteratorinterchangeably__(and confusingly!)to__referto__anobject__thatsupports__iterationin__general.For__clarity,this__bookuses__theterm__iterableto__referto__anobject__thathas__theiter__callat__thetop__ofthe__protocolwe__reabout__to meet,and__iteratorto__referto__anobject__thathas__thenext__callto__produce results.That__is,an__iterablereturns__aniterator__thatadvances__on next.This__bookalso__usesthe__phraseiteration__toolfor__languagetools__thatrun__an iteration,like__forloops__andzip__calls.Chapter__20will__muddlethis__jargonwith__theterm__generatorwhich__refersto__objectsthat__automaticallysupport__theiteration__protocol,and__henceare__iterableeven__thoughall__iterablesgenerate__results!The__IterationProtocol__Oneof__theeasiest__waysto__understandthe__iterationprotocol__isto__seehow__itworks__witha__built-intype__suchas__thefile__objectwe__firstexplored__inChapter__9.In__this chapter,we__llbe__usingthe__following three-lineinput__fileas__a demo: >>> print(open('data.txt').read())Testing__fileIO__Learning Python, 6EPython__3.12 >>> open('data.txt').read() 'Testingfile__IO\nLearning Python, 6E\nPython 3.12\n'Recall__fromChapter__9that__openfile__objectshave__amethod__called readline,which__readsone__lineof__textfrom__afile__ata__timeeach__timewe__callthe__readline method,we__advanceto__thenext__line.At__theend__ofthe__file,an__emptystring__is returned,which__wecan__detectto__breakout__ofa__line-readingloop__(remember,empty__means false): >>>f__= open('data.txt') #Read__a three-linefile__inthis__directory >>> f.readline() #readline__loadsone__lineon__eachcall__'Testingfile__IO\n' >>> f.readline() #Newlines__are \neverywhere__intext__mode 'Learning Python, 6E\n' >>> f.readline() #Last__linesmay__havea__\nor__not 'Python 3.12\n' >>> f.readline() #Returns__emptystring__at end-of-file '' Files, however,also__havea__methodnamed____next__that__hasa__nearlyidentical__effectit__returnsthe__nextline__froma__fileeach__timeit__is called.The__onlynoticeable__differenceis__that__next____raisesa__built-inStopIteration__exception (that is,invokes__asignaling__event)at__end-of-fileinstead__ofreturning__anempty__string: >>>f__= open('data.txt') #__next____loadsone__lineon__eachcall__too >>> f.__next__() #But__raisesan__exceptionat__end-of-file 'Testingfile__IO\n' >>> f.__next__() 'Learning Python, 6E\n' >>> f.__next__() 'Python 3.12\n' >>> f.__next__()Traceback__(mostrecent__call last):File__"",line__1,in__StopIterationAnd__thisinterface__ismost__ofwhat__wecall__theiteration__protocolin__Python.Any__objectwith__a__next____methodto__advanceto__anext__result,which__raisesStopIteration__atthe__endof__theseries__of results,is__consideredan__iteratorin__Python.Any__suchobject__mayalso__bestepped__throughwith__afor__loopor__anyother__iteration tool,because__alliteration__toolsnormally__workinternally__bycalling____next__on__eachiteration__andcatching__theStopIteration__exceptionto__knowwhen__to exit.As__youll__seein__a moment,for__someobjects__thefull__protocolincludes__anadditional__firststep__tocall__iter,but__thisisn__trequired__for files.The__upshotof__allthis__magicis__that,as__mentionedin__Chapters 9and__13,the__generallybest__wayto__reada__textfile__lineby__linetoday__isto__notread__itat__all instead,allow__thefor__loopto__automaticallycall____next__to__advanceto__thenext__lineon__each iteration.The__fileobject__siterator__willdo__thework__ofautomatically__loadinglines__asyou__go,both__oneat__atime__and efficiently.The__following,for__example,reads__lineby__line,printing__theuppercase__versionof__eachline__alongthe__waywithout__everexplicitly__readingfrom__thefile__at all: >>>for__linein__open('data.txt'): #Use__fileiterators__toread__bylines__print(line.upper(), end='') #Calls____next__,catches__StopIterationTESTING__FILEIO__LEARNING PYTHON, 6EPYTHON__3.12Notice__thatthe__printuses__end=''here__tosuppress__addinga__\n,because__linestrings__alreadyhave__one (without this,our__outputwould__be double-spaced).This__forcoding__patternis__usuallythe__bestway__toread__textfiles__lineby__line,for__three reasons:it__sthe__simplestto__code,might__bethe__quickestto__run,and__usesmemory__space sparingly.Prior__tothe__adventof__theiteration__protocolin__Python,programmers__achievedthe__sameeffect__witha__forloop__bycalling__thefile__readlinesmethod__toload__thefile__scontent__intomemory__asa__listof__line strings: >>>for__linein__open('data.txt').readlines(): print(line.upper(), end='')TESTING__FILEIO__LEARNING PYTHON, 6EPYTHON__3.12This__readlinestechnique__still works,but__isnot__consideredthe__bestpractice__todaybecause__itperforms__poorlyin__termsof__memory usage.In__fact,because__thisversion__reallydoes__loadthe__entirefile__intomemory__allat__once,it__willnot__evenwork__forfiles__toobig__tofit__intothe__memoryspace__availableon__your device.By__contrast,the__iterator-basedversion__isimmune__tosuch__memory-explosionissues__becauseit__readsjust__oneline__ata__time.The__iteratorversion__mightrun__quicker too,though__thiscan__varyper__Pythonrelease__(butsee__theupcoming__notefor__afew__specs).As__mentionedin__theprior__chapters__closing sidebar,Why__YouWill__Care:File__Scanners ,it__salso__possibleto__reada__fileline__byline__witha__while loop: >>>f__= open('data.txt') >>>while__line := f.readline(): print(line.upper(), end='')TESTING__FILEIO__LEARNING PYTHON, 6EPYTHON__3.12 However,this__mayrun__slowerthan__the iterator-basedfor__loopversion__becausefile__iteratorsrun__at C-languagespeed__insidethe__standard CPython,whereas__thewhile__versionmust__runPython__bytecodethrough__thePython__virtual machine.Anytime__wetrade__Pythoncode__forC__code,speed__tendsto__increase.This__isnot__anabsolute__truth, though; again,we__llexplore__timingtechniques__inChapter__21for__measuringthe__relativespeed__ofalternatives__like these,though__thefollowing__noteruins__someof__thesurprise__forthe__impatient.NOTE__Spoiler alert:Per__callsto__min(timeit.repeat(code, repeat=50, number=10))in__CPython 3.12on__macOS,the__fileiterator__isstill__slightlyfaster__than readlines,which__isfaster__thanthe__while loop.With__a 9k-linefile__andthis__chapters__code (usingpass__forloop__bodies),the__iterator, readlines,and__whilealternatives__checkin__at 0.0073, 0.0077,and__0.0102 seconds, respectively.The__whileis__slowestand__using :=doesn__thelp__much (its__0.0104sans__:=).For__more info,see__theexamples__packageand__Chapter 21. Caveats:your__testvariables__may vary,memory__matters too,and__0.0029seconds__maynot__beenough__toget__excitedabout__insome__programs.The__iterand__next built-insTo__simplifymanual__iteration code,Python__alsoprovides__a built-in function, next,that__hasthe__samenet__effectas__callingan__objects____next__ method.That__is,given__aniterator__object X,the__call next(X)is__thesame__as X.__next__(),but__isnoticeably__simplerto__typeand__read (andactually__runsslightly__fasterin__CPython 3.12for__tested cases).With__files,for__instance,either__formmay__be used: >>>f__= open('data.txt') >>> f.__next__() #Call__iterationmethod__directly 'Testingfile__IO\n' >>> next(f) # next(f)is__thesame__as f.__next__() 'Learning Python, 6E\n' >>> next(f) 'Python 3.12\n' >>> next(f)exception__textomitted__fromhere__onStopIteration__Technically,there__isone__morepiece__tothe__iterationprotocol__alludedto__earlier.When__thefor__loop begins,it__firstobtains__aniterator__froman__iterable object,by__callingthe__iterables____iter__ method.The__objectreturned__bythis__callin__turnhas__therequired____next__method__to advance.For__convenience again,the__iter built-infunction__internallyruns__theequivalent__ofthe____iter__ method,much__asnext__runsthe__equivalentof____next__. Hence,for__loopsrun__theinternal__equivalentof__the following,though__theiter__stepis__mootand__optionalfor__filesthey__aretheir__own iterators,because__filesdon__tsupport__multiplescans__per open: >>>f__= open('data.txt') >>>I__= iter(f) #Fetch__aniterator__froman__iterable >>> next(I) #Fetch__thenext__resultfrom__theiterator__'Testingfile__IO\n' >>> next(I) #Files__iterablesare__iteratorsthemselves__'Learning Python, 6E\n'etc__Thefull__iterationprotocol__Withall__thesepieces__in place,Figure__14-1sketches__thisfull__iteration protocol,used__byevery__iterationtool__inPython__andsupported__bya__widevariety__ofobject__types.It__sbased__ontwo__objectsused__intwo__distinctsteps__byiteration__tools:The__iterableobject__forwhich__iterationis__requested.Calling__thisobject__s__iter____returnsan__iterator,and__isthe__sameas__calling iter.The__iteratorobject__returnedby__the iterable.Calling__thisobject__s__next____producesresults__duringthe__iterationand__raisesStopIteration__whenno__moreresults__remain,and__isthe__sameas__calling next.Figure__14-1.The__iteration protocol,used__byfor__loops, comprehensions, maps,and__moreThese__stepsare__orchestratedautomatically__byiteration__toolsin__most cases,but__ithelps__tounderstand__thesetwo__objects roles.For__example,in__somecases__thesetwo__objectsare__thesame__whenonly__asingle__scanis__supported (e.g., files),and__theiterator__objectis__oftena__temporary,used__internallyby__theiteration__tool. Moreover,some__objectsare__bothan__iterationtool__(they iterate)and__aniterable__object (theirresults__are iterable)including__theenumerate__andzip__built-ins,and__Chapter 20s__generator expressions.Such__iterablesalready__avoidconstructing__resultlists__inmemory__themselves,but__applyingthem__toother__iterablessaves__evenmore__space.When__suchtools__are combined,no__workis__doneuntil__aniteration__toolrequests__results.In__code,the__protocols__firststep__becomesobvious__ifwe__lookat__howfor__loopsinternally__process built-insequence__typessuch__aslists__(foruses__theinternal__equivalentsof__the____methods,but__youuse__eitherin__your code): >>>L__= [1, 2] >>>I__= iter(L) #Obtain__aniterator__objectfrom__aniterable__>>> next(I) #Call__next(iterator)to__advanceto__nextitem__1 >>> next(I) #Or__use L.__iter__()and__I.__next__()calls__2 >>> next(I)StopIteration__Aswe__saw earlier,the__initialiter__stepis__notrequired__for files,because__afile__objectsupports__justone__scanand__henceis__itsown__iterator.You__cansee__thisyourself__withis__(recallfrom__Chapter 9that__thismeans__objectidentity__thesame__exactpiece__ofobject__memory,not__justthe__same value): >>>f__= open('data.txt') >>> iter(f)is__f #Files__areiterators__themselves: iter()optional__True >>> iter(f)is__f.__iter__() #Both__callsreturn__fileobject__fitself__True >>> next(f) #Which__respondsto__nextrequests__directly 'Testingfile__IO\n'Lists__andmany__other built-in objects, though,are__nottheir__owniterators__becausethey__dosupport__multipleopen__iterationsthere__maybe__anynumber__ofiterations__activein__nested loops,and__allmay__beat__differentpositions__ata__givenpoint__in time.For__such objects,we__mustcall__iterto__startiterating__manually: >>>L__= [1, 2, 3] >>> iter(L)is__L #Lists__arenot__theirown__iterators:use__iter()False__>>> next(L) TypeError: 'list'object__isnot__aniterator__>>>I__= iter(L) #Same__as L.__iter__() >>> next(I) #Same__as I.__next__() 1Manual__iterationAlthough__Pythoniteration__toolscall__thesefunctions__automatically,we__canalso__usethem__toapply__theiteration__protocolmanually__when needed.The__followingdemonstrates__theequivalence__betweenautomatic__andmanual__iteration (again,for__runsthe__internalequivalent__of I.__next__instead__ofthe__next(I)used__here,but__theeffect__isthe__same): >>>L__= [1, 2, 3] >>> >>>for__Xin__L: #Automatic__iteration print(X ** 2, end=' ') #Obtain__iter,call____next__,catch__exceptions 1 4 9 >>>I__= iter(L) #Manual__iteration:what__forloops__usuallydo__>>>while__True: #Use__trystatements__tocatch__stopexception__try:X__= next(I)except__StopIteration:break__print(X ** 2, end=' ') 1 4 9To__understandthis__code,you__needto__knowthat__trystatements__runan__actionand__catchexceptions__thatoccur__whilethe__actionruns__(wemet__exceptionsbriefly__inChapter__10but__willexplore__themin__depthin__Part VII).More__oniter__andnext__Forfull__fidelity,it__shouldalso__benoted__thatfor__loopsand__otheriteration__toolscan__sometimeswork__differentlyfor__user-definedclasses__repeatedlyindexing__anobject__insteadof__runningthe__iterationprotocol__butthey__preferthe__iterationprotocol__whensupported__(moreon__thisstory__whenwe__studyoperator__overloadingin__Chapter 30).Though__notcommonly__used,it__salso__worthnoting__thatnext__acceptsan__optionalsecond__defaultargument__foran__exit value;if__passed,it__sreturned__atthe__endinstead__ofraising__astop__exception: >>>L__= [1] >>>I__= iter(L) #Result__insteadof__exception >>> next(I, 'endof__list') 1 >>> next(I, 'endof__list') 'endof__list'Combined__withthe__:= named-assignment expression,this__canshave__multiplelines__offthe__preceding manual-iterationcode__butwill__alsofail__ifthe__passeddefault__canappear__asa__valid result: >>>I__= iter(L) >>>while__(X := next(I, None)) != None: #Same__effect,less__code print(X ** 2, end=' ') #Assuming__Noneis__safe!Though__also uncommon,iter__acceptsa__secondsentinel__argumentto__signalstop__froma__callable.This__verydifferent__modeprovides__anarguably__trickyway__touse__forto__readfiles__byblocks__butrequires__infoon__functionsor__lambda,which__wedon__tyet__have: >>>f__= open('data.txt') >>>I__= iter(lambda: f.read(5), '') #Callables__andsentinels__>>>for__blockin__I: print(block, end='') #Assuming__youknow__lambda!Watch__forlambda__inthe__nextpart__ofthis__book,and__seePython__sdocs__formore__onnext__anditer__modes.Other__Built-inIterables__Besidesfiles__andphysical__sequenceslike__lists,many__otherobjects__inPython__haveuseful__iteratorsas__well.Now__thatwe__havea__betterhandle__onhow__theiteration__protocol works,this__sectionrevisits__sometools__weve__alreadyseen__inthis__context,and__introducesa__handfulof__additionaliterables__alongthe__way. Reprise: Dictionaries, range, enumerate,and__zipAs__wesaw__inthe__last chapter,the__usualway__tostep__throughthe__keysof__adictionary__iswith__afor__loop: >>>D__= dict(a=1, b=2) >>>for__keyin__D: #Dictionaries__areimplicitly__iterable print(key, D[key])a__1b__2This__workssimply__becausedictionaries__areiterables__withan__iteratorthat__automaticallyreturns__onekey__ata__timein__aniteration__toollike__for: >>>I__= iter(D) #Which__justmeans__theysupport__theprotocol__>>> next(I) 'a' >>> next(I) 'b' >>> next(I)StopIteration__Theiteration__protocolis__alsothe__reasonthat__weve__hadto__wraprange__resultsin__alist__callto__seetheir__valuesall__atonce__ina__REPL.Objects__thatare__nonsequenceiterables__returnresults__oneat__a time,not__ina__physical list: >>>R__= range(5) >>>R__range(0, 5) >>>I__= iter(R) #Use__iterationprotocol__toproduce__results >>> next(I) 0 >>> next(I) 1 >>> list(range(5)) #Or__use list()to__collectall__resultsat__once [0, 1, 2, 3, 4]Note__thatthe__listcall__hereis__notneeded__andshouldn__tbe__usedin__contextswhere__iterationhappens__automaticallysuch__aswithin__for loops.It__isneeded__fordisplaying__valuesall__at once, though,and__mayalso__berequired__when list-likebehavior__ormultiple__scansare__requiredfor__objectsthat__normallyproduce__resultson__demand (moreon__this later).Now__thatyou__havea__betterunderstanding__ofthis__protocol,you__shouldalso__beable__tosee__howit__explainswhy__theenumerate__toolintroduced__inthe__priorchapter__worksthe__wayit__does: >>>E__= enumerate('text') #enumerate__isan__iterabletoo__>>>E__>>>I__= iter(E) >>> next(I) #Generate__resultswith__iterationprotocol__(0, 't') >>> next(I) #Or__use list()to__forcegeneration__torun__(1, 'e') >>> list(enumerate('text')) [(0, 't'), (1, 'e'), (2, 'x'), (3, 't')]Unlike__range,the__enumerate built-ins__resultis__itsown__iterator,much__like files.This__meansit__supportsjust__onescan__per call,and__iteris__optional (moreon__thisahead__too): >>>R__= range(5) >>> iter(R)is__RFalse__>>>E__= enumerate('text') >>> iter(E)is__ETrue__>>> next(E) (0, 't')The__zip built-in,covered__inthe__prior chapter,works__thesame__wayin__iteration tools.Like__enumerate,zip__isalso__itsown__iterator,so__wehave__tocall__itagain__toiterate__again: >>>Z__= zip((1, 2, 3), (10, 20, 30)) >>>Z__>>>I__= iter(Z) >>> next(I) (1, 10) >>> next(I) (2, 20) >>>I__isZ__True >>> list(Z) [(3, 30)] >>> list(zip((1, 2, 3), (10, 20, 30))) [(1, 10), (2, 20), (3, 30)]Iterator__nestingMore__interestingly,zip__isboth__iterationtool__and iterable:it__iteratesover__itsarguments__results,but__alsoreturns__aniterable__objectwith__aniterator__forits__own results.In__the following,for__example,it__sa__toolthat__receivesresults__fromtwo__range iterables,but__itsown__resultsare__producedon__demandas__well.In__other words,there__arethree__iterablesand__twolevels__ofiteration__atwork__here: >>>Z__= zip(range(1, 4), range(10, 40)) >>> next(Z) (1, 10) >>> next(Z) (2, 11) >>> next(Z) (3, 12) >>> list(zip(range(1, 4), range(10, 40))) [(1, 10), (2, 11), (3, 12)]In__fact,iterators__canbe__nested arbitrarily.Because__enumerateis__bothiteration__tooland__object too,in__the following, range, enumerate,and__zipall__producetheir__resultson__demand,and__listmakes__allthe__dances run: >>> list(enumerate(range(1, 4))) [(0, 1), (1, 2), (2, 3)] >>> list(zip(enumerate(range(1, 4)), enumerate(range(5, 8)))) [((0, 1), (0, 5)), ((1, 2), (1, 6)), ((2, 3), (2, 7))] Similarly,the__followingenumerates__thezipped__resultsof__rangesbut__onlywhen__requestedby__for: >>>for__xin__enumerate(zip(range(1, 4), range(5, 8))): print(x) ... (0, (1, 5)) (1, (2, 6)) (2, (3, 7))There__arethree__levelsof__iterablesin__this,all__deferringtheir__resultsuntil__theyare__activated.In__practice,this__works naturally,but__nothinghappens__insuch__codeuntil__atool__likelist__orfor__asksfor__resultsat__the top.In__response,all__theactors__herereturn__justone__resultat__a time,to__minimizememory__requirementsand__avoid delays.Functional__iterables:map__andfilter__Like range, enumerate,and__zip,the__mapand__filter built-insproduce__theirresults__individuallyto__conservespace__andavoid__pauses.Like__enumerateand__zip,these__toolsalso__areboth__iterabletools__anditerable__objects themselves:they__scanother__iterables,and__producetheir__ownresults__on demand.Unlike__otheriterables__weve__met, though,map__andfilter__applyfunction__callsinstead__of expressions,so__theircomplete__storyrequires__function-codingskills__wewon__tgain__untilthe__nextpart__ofthe__book. Still,we__canpreview__theirfundamentals__hereusing__built-infunctions__withouthaving__tocode__newfunctions__ofour__own.For__example,the__map built-in,which__madea__briefcameo__appearancein__Chapter 8 (andhas__nothingdirectly__todo__withmappings__like dictionaries!),calls__aprovided__functionfor__eachitem__ina__provided iterable,and__returnsthe__collectedresults__asanother__iterable.In__the following,it__appliesthe__ord built-into__collectcharacter__code points: >>> ord('p') #Return__asingle__character'scode__point 112 >>>M__= map(ord, 'py3') #map__returnsan__iterable,not__alist__>>>M__#Runs__ord(x)for__everyx__initerable__>>> next(M) #Iterating__manually:exhausts__results 112 #map__supportsno__sequenceops__like [i] >>> next(M) 121 >>> next(M) 51 >>> next(M)StopIteration__As usual,you__canforce__resultswith__listif__youmust__treatthem__asa__list,and__forautomates__iterations: >>> list(map(ord, 'py3')) #Force__areal__list -only__ifneeded__[112, 121, 51] >>>M__= map(ord, 'py3') #Must__callagain__toscan__again >>>for__xin__M: print(x, end=' ') #Iteration__toolsauto__call next() 112 121 51The__filter built-in,which__wemet__momentarilyin__Chapter 12and__willstudy__morefully__inthe__nextpart__ofthis__book,is__analogous.It__returnsitems__inan__iterablefor__whicha__passed-infunction__returns True.In__the following,we__releveraging__conceptswe__vealready__learnedTrue__includesnonempty__andnonzero__objects,the__bool built-inreturns__asingle__objects__truth value,and__thestr__strings__isdigitmethod__istrue__for all-digit text: >>> filter(bool, ['lp6e', '', 2024]) >>> list(filter(bool, ['lp6e', '', 2024])) #Collect__"true"items__['lp6e', 2024] >>> list(filter(str.isdigit, ['lp6e', '2024'])) #Collect__all-digitstrings__['2024']Like__mostof__thetools__discussedin__this section,filter__bothaccepts__aniterable__toprocess__andreturns__aniterable__togenerate__results.It__doesnt__doany__workuntil__codelike__afor__loopasks__it to.As__a preview,both__mapand__filtercan__beemulated__roughlywith__listcomprehensions__andmore__closelywith__Chapter 20s__generator expressions;but__togrok__thefollowing__codein__full,we__haveto__awaitthis__chapters__presentationof__comprehensionscoming__up soon: >>> [ord(x)for__xin__'py3'] [112, 121, 51] >>> [xfor__xin__['lp6e', '2024']if__x.isdigit()] ['2024'] Multiple-passversus__single-passiterables__Weve__noteda__fewtimes__thatsome__iterablesthat__dont__allowmultiple__scansare__theirown__iterables.Since__thisis__asubtle__differencethat__canimpact__theway__youll__use them,it__sworth__aseparate__callout here.In__particular,the__range built-ins__result,along__withobjects__likedictionaries__and lists,differs__fromother__built-insdescribed__inthis__section.They__arenot__theirown__iterators (youmust__makeone__withiter__wheniterating__manually),and__theysupport__multipleiterators__(eachremembers__itsposition__independently): >>>R__= range(3) #range__allowsmultiple__iterators >>> next(R) TypeError:range__objectis__notan__iterator >>> I1 = iter(R) >>> next(I1) 0 >>> next(I1) 1 >>> I2 = iter(R) #Two__iteratorson__onerange__>>> next(I2) 0 >>> next(I1) # I1is__ata__differentspot__than I2 2By__contrast,the__resultsof__enumerate, zip, map, filter,as__wellas__openfor__files,are__theirown__iterators,because__noneof__thesetools__supportmultiple__activeiterations__onthe__samecall__result.Because__of this,the__itercall__isoptional__forstepping__throughsuch__objectsresults__(though harmless:their__iteris__themselves),and__wemust__callthese__toolsagain__tobegin__afresh__iterationfrom__the start: >>>Z__= zip((1, 2, 3), (10, 11, 12)) >>> I1 = iter(Z) >>> I2 = iter(Z) #Two__iteratorson__onezip__>>> next(I1) (1, 10) >>> next(I1) (2, 11) >>> next(I2) #But__I2is__atsame__spotas__I1! (3, 12) >>>M__= map(ord, 'py3') #Ditto__formap__(and others) >>> I1, I2 = iter(M), iter(M) >>> next(I1), next(I1) (112, 121) >>> next(I2) 51 >>>L__= [0, 1, 2] #But__lists (and others)do__manyscans__>>> I1, I2 = iter(L), iter(L) >>> next(I1), next(I1) (0, 1) >>> next(I2) #Multiple__active scans,like__range 0When__wecode__ourown__iterableobjects__withclasses__laterin__thebook__(Chapter 30),you__llsee__thatmultiple__iteratorsare__usuallysupported__byreturning__newobjects__forthe__iter call;a__singleiterator__generallymeans__anobject__returnsitself__andsupports__next directly.In__Chapter 20,you__llalso__findthat__generatorfunctions__andexpressions__behavelike__mapand__zipinstead__ofrange__inthis__regard,supporting__justa__singleactive__iteration scan.Also__inthat__chapter,you__llsee__somesubtle__implicationsof__single-passiterators__inloops__thatattempt__toscan__multipletimes__codethat__treatsthese__aslists__mayfail__withoutmanual__list conversions. Standard-libraryiterables__inPython__Finally,while__outof__scope here,and__technicallypart__ofits__standardlibrary__insteadof__its language,Python__providesadditional__toolsthat__supportthe__iterationprotocol__andthus__mayalso__beused__infor__loopsand__otheriteration__tools.For__instance,shelves__(an access-by-keyfilesystem__forPython__objects),as__wellas__theresults__of os.popen (atool__forreading__theoutput__ofshell__commands),are__iterablesthat__canbe__processedwith__thefull__setof__iteration tools.The__standarddirectory__(a.k.a. folder)walker__in Python, os.walk,is__iterable too,but__well__savedetails__andan__exampleuntil__Chapter 20s__coverageof__thistool__sbasis__generatorsand__yield. Ultimately,all__suchtools__implementthe__iter/nextinterface__definedby__theiteration__protocol.We__dont__normallysee__thismachinery__becausefor__andits__kinrun__itfor__usautomatically__tostep__through results.In__fact,everything__thatscans__leftto__rightin__Pythonemploys__theiteration__protocolin__thesame__wayincluding__thetopic__ofthe__next section.Comprehensions__Nowthat__weve__seenhow__theiteration__protocol works,let__sturn__toone__ofits__mostcommon__use cases.Together__withfor__loops,list__comprehensionsare__oneof__themost__prominentcontexts__inwhich__theiteration__protocolis__applied.In__theprevious__chapter,we__learnedhow__touse__rangeto__changea__listas__westep__across it: >>>L__= [1, 2, 3, 4, 5] >>>for__iin__range(len(L)): L[i] += 10 >>>L__[11, 12, 13, 14, 15]This__works,but__asmentioned__there,it__maynot__bethe__optimalbest__practiceapproach__in Python. Today,the__listcomprehension__expressionmakes__manysuch__priorcoding__patterns obsolete. Here,for__example,we__canreplace__theloop__witha__singleexpression__thatproduces__thedesired__result list: >>>L__= [x + 10for__xin__L] >>>L__[21, 22, 23, 24, 25]The__netresult__is similar,but__itrequires__lesscoding__onour__partand__islikely__torun__substantiallyfaster__in fact,it__soften__twiceas__fastas__testedin__CPython 3.12.The__listcomprehension__isnt__exactlythe__sameas__thefor__loopstatement__versionbecause__itmakes__anew__list object,which__mightmatter__ifthere__aremultiple__referencesto__theoriginal__list,but__its__closeenough__formost__applicationsand__isa__commonand__convenientenough__approachto__merita__closerlook__here.List__ComprehensionBasics__Thelist__comprehensionwas__introducedin__Chapter 4,and__its__beendemoed__often. Syntactically,its__syntaxis__derivedfrom__aconstruct__inset__theorynotation__thatapplies__anoperation__toeach__itemin__a set,but__youdon__thave__toknow__settheory__touse__this tool.In__Python,most__peoplefind__thata__listcomprehension__simplylooks__likea__backwardfor__loop.To__geta__handleon__the syntax,let__sdissect__theprior__sections__examplein__more detail:L__= [x + 10for__xin__L]List__comprehensionsare__writtenin__squarebrackets__becausethey__areultimately__away__toconstruct__anew__list.They__beginwith__anarbitrary__expressionthat__wemake__up,which__usesa__loopvariable__thatwe__makeup__(x + 10).That__isfollowed__bywhat__youshould__nowrecognize__asthe__headerof__afor__loop,which__namesthe__loop variable,and__aniterable__object (forx__in L).To__runthe__expression,Python__executesan__iterationacross__Linside__the interpreter,assigning__xto__eachitem__in turn,and__collectsthe__resultsof__runningthe__itemsthrough__theexpression__onthe__left side.The__resultlist__weget__backis__exactlywhat__thelist__comprehensionsays__anew__listcontaining__x + 10,for__everyx__in L.Technically__speaking,list__comprehensionsare__neverreally__requiredbecause__wecan__alwaysbuild__upa__listof__expressionresults__manuallywith__forloops__thatappend__resultsas__we go: >>>res__= [] >>>for__xin__L: res.append(x + 10) >>>res__[31, 32, 33, 34, 35]In__fact,this__isexactly__whatthe__listcomprehension__doesinternally__(usinginternal__equivalents,of__course). However,list__comprehensionsare__moreconcise__to write,and__widelyuseful__inPython__programsbecause__buildingresult__listsis__sucha__common task. Moreover,depending__onyour__Pythonand__code,list__comprehensionsmight__runmuch__fasterthan__manualfor__loopstatements__(often 2Xas__stated earlier)because__theiriterations__areperformed__atthe__speedof__optimized (andusually__compiled)code__insidethe__interpreter,rather__thanwith__manualPython__code.Especially__forlarger__data sets,there__isoften__amajor__performanceadvantage__tousing__this expression.List__Comprehensionsand__FilesLet__swork__throughanother__commonapplication__oflist__comprehensionsto__explorethem__inmore__detail.Recall__thatthe__fileobject__hasa__readlinesmethod__thatloads__thefile__intoa__listof__linestrings__allat__once: >>>f__= open('data.txt') >>>lines__= f.readlines() >>>lines__['Testingfile__IO\n', 'Learning Python, 6E\n', 'Python 3.12\n']This__worksas__wesaw__earlier,but__thelines__inthe__resultall__includethe__newlinecharacter__(\n)at__the end.For__many programs,the__newlinecharacter__getsin__theway__wehave__tobe__carefulto__avoid double-spacingwhen__printing,and__so on.It__wouldbe__niceif__wecould__getrid__ofthese__newlinesall__at once,wouldn__t it?Anytime__westart__thinkingabout__performingan__operationon__eachitem__ina__sequence,we__rein__therealm__oflist__comprehensions.For__example,assuming__thevariable__linesis__asit__wasin__theprior__interaction,the__followingcode__doesthe__jobby__runningeach__linein__thelist__throughthe__stringrstrip__methodto__removewhitespace__onthe__rightside__(a line[: 1]slice__would work, too,but__onlyif__wecan__besure__alllines__areproperly__\n terminated,and__thismay__notalways__bethe__casefor__thelast__linein__a file): >>>lines__= [line.rstrip()for__linein__lines] >>>lines__['Testingfile__IO', 'Learning Python, 6E', 'Python 3.12']This__worksas__planned.Because__listcomprehensions__arean__iterationtool__justlike__forloop__statements, though,we__dont__evenhave__toopen__thefile__aheadof__time.If__weopen__itinside__the expression,the__listcomprehension__willautomatically__usethe__iterationprotocol__wemet__earlierin__this chapter.That__is,it__willread__oneline__fromthe__fileat__atime__bycalling__thefile__snext__handler method,run__theline__throughthe__rstrip expression,and__addit__tothe__result list. Again,we__getwhat__weask__forthe__rstripresult__ofa__line,for__everyline__inthe__file: >>>lines__= [line.rstrip()for__linein__open('data.txt')] >>>lines__['Testingfile__IO', 'Learning Python, 6E', 'Python 3.12']This__expressiondoes__alot__implicitly,but__were__gettinga__lotof__workfor__freehere__Pythonscans__thefile__lineby__lineand__buildsa__listof__operationresults__automatically.It__salso__anefficient__wayto__codethis__operation:because__mostof__thiswork__isdone__insidethe__Python interpreter,it__slikely__fasterthan__anequivalent__for statement.Just__as importantly,its__useof__fileiterators__meansthat__itwon__tload__thefile__intomemory__allat__once,like__readlines does. Again,especially__forlarge__files,the__advantagesof__listcomprehensions__canbe__significant.Besides__their efficiency,list__comprehensionsare__alsoremarkably__expressive.In__our example,we__canrun__anystring__operationon__afile__slines__aswe__iterate.To__illustrate,here__sthe__listcomprehension__equivalentto__thefile__iteratoruppercase__examplewe__met earlier,along__witha__fewother__representativeoperations__tosample__the possibilities: >>> [line.upper()for__linein__open('data.txt')] ['TESTINGFILE__IO\n', 'LEARNING PYTHON, 6E\n', 'PYTHON 3.12\n'] >>> [line.rstrip().upper()for__linein__open('data.txt')] ['TESTINGFILE__IO', 'LEARNING PYTHON, 6E', 'PYTHON 3.12'] >>> [line.split()for__linein__open('data.txt')] [['Testing', 'file', 'IO'], ['Learning', 'Python,', '6E'], ['Python', '3.12']] >>> [line.replace('\n', '!')for__linein__open('data.txt')] ['Testingfile__IO!', 'Learning Python, 6E!', 'Python 3.12!'] >>> [('Py'in__line, line.split()[0])for__linein__open('data.txt')] [(False, 'Testing'), (True, 'Learning'), (True, 'Python')]Recall__thatthe__methodchaining__inthe__secondof__theseexamples__worksbecause__stringmethods__returna__new string,to__whichwe__canapply__anotherstring__method.The__lastof__theseshows__howwe__canalso__collectmultiple__results,as__longas__theyre__wrappedin__acollection__likea__tupleor__list.One__finepoint__here:recall__fromChapter__9that__fileobjects__closethemselves__automaticallyin__CPythonwhen__garbage-collectedif__still open. Hence,these__listcomprehensions__willalso__automaticallyclose__thefile__whentheir__temporaryfile__objectis__garbage-collectedafter__theexpression__runs.Outside__CPython, though,you__maywant__tocode__theseto__closemanually__ifthis__isrun__ina__loop,to__ensurethat__fileresources__arefreed__immediately:open__beforethe__comprehension,and__close after.See__Chapter 9for__moreon__fileclose__callsif__youneed__arefresher__on this.Extended__ListComprehension__SyntaxHandy__asthey__mayalready__seem,list__comprehensionscan__beeven__richerin__practice,and__evenconstitute__asort__ofiteration__mini-languagein__theirfullest__forms.Let__stake__aquick__lookat__theirextra__syntaxtools__here.Filter__clauses:if__Asone__particularlyuseful__extension,the__forloop__nestedin__acomprehension__expressioncan__havean__associatedif__clauseto__filterout__ofthe__resultitems__forwhich__thetest__isnot__true. (Its__reallya__filter in,but__itworks__outthe__same.)For__example,suppose__wewant__torepeat__theprior__sections__file-scanning example,but__weneed__tocollect__onlylines__thatbegin__withthe__lettersL__orP__(perhapsthe__firstcharacter__oneach__lineis__anaction__codeof__some sort).Adding__asimple__iffilter__clauseto__ourexpression__doesthe__trick: >>>lines__= [line.rstrip()for__linein__open('data.txt')if__line[0]in__'LP'] >>>lines__['Learning Python, 6E', 'Python 3.12'] Here,the__ifclause__checkseach__lineread__fromthe__fileto__seewhether__itsfirst__character matches;if__not,the__lineis__omittedfrom__theresult__list,and__theiteration__continues.This__isa__fairlybig__expression,but__its__easyto__understandif__wetranslate__itto__itssimple__forloop__statement equivalent: >>>res__= [] >>>for__linein__open('data.txt'):if__line[0]in__'LP': res.append(line.rstrip()) >>>res__['Learning Python, 6E', 'Python 3.12']In__general,we__canalways__translatea__listcomprehension__toa__forstatement__byappending__aswe__goand__furtherindenting__eachsuccessive__part.The__converseisn__t true:for__statementsare__moregeneral__andcan__addressadditional__rolesout__ofscope__for comprehensions,but__thelatter__sresults__collectionis__avery__common task.This__forstatement__equivalent works,but__ittakes__upfour__linesinstead__ofone__andmay__run slower.In__fact,you__cansqueeze__asubstantial__amountof__logicinto__alist__comprehensionwhen__youneed__tothe__followingworks__likethe__priorbut__selectsonly__linesthat__endin__adigit__(beforethe__newlineat__the end),by__filteringwith__amore__sophisticatedexpression__onthe__rightside__(whichuses__[-1:]instead__of [-1]to__handlefiles__withblank__linesempty__after rstrip): >>> [line.rstrip()for__linein__open('data.txt')if__line.rstrip()[-1:].isdigit()] ['Python 3.12']As__anotherif__filter example,the__firstresult__inthe__followinggives__thetotal__linesin__atext__file,and__thesecond__stripswhitespace__onboth__endsto__omitblank__linesin__thetally__injust__oneline__of code: >>>fname__= 'data-blank-lines.txt' >>> len(open(fname).readlines()) #All__lines 5 >>> len([linefor__linein__open(fname)if__line.strip() != '']) #Nonblank__lines 3Nested__loops:for__Listcomprehensions__canbecome__evenmore__complexif__weneed__themto__for instance,they__maycontain__nested loops,coded__asa__seriesof__for clauses.In__fact,their__fullsyntax__allowsfor__anynumber__offor__clauses,each__ofwhich__canhave__anoptional__associatedif__clause.For__example,the__followingbuilds__alist__ofthe__concatenationof__x +y__forevery__xin__onestring__andevery__yin__another.It__effectivelycollects__allthe__orderedcombinations__ofthe__charactersin__two strings: >>> [x +y__forx__in 'abc'for__yin__'123'] ['a1', 'a2', 'a3', 'b1', 'b2', 'b3', 'c1', 'c2', 'c3'] Again,one__wayto__understandthis__expressionis__toconvert__itto__statementform__byindenting__its parts.The__followingis__an equivalent,but__likely slower,alternative__wayto__achievethe__sameeffect__(its__thesame__asthe__firstnested__forexample__inthe__prior chapter,but__buildsa__listof__resultsinstead__ofsimply__printing them): >>>res__= [] >>>for__xin__'abc':for__yin__'123': res.append(x + y) >>>res__['a1', 'a2', 'a3', 'b1', 'b2', 'b3', 'c1', 'c2', 'c3']Beyond__thiscomplexity__level, though,list__comprehensionexpressions__cansometimes__becometoo__compactfor__theirown__good.In__general,they__areintended__forsimple__typesof__iterations;for__moreinvolved__work,a__simplerfor__statementstructure__willprobably__beeasier__tounderstand__andmodify__inthe__future.As__usualin__programming,if__somethingis__difficultfor__youto__understand,it__sprobably__notthe__best idea.Comprehensions__Cliff-HangerBecause__comprehensionsare__generallybetter__takenin__multiple doses,we__llcut__thisstory__shorthere__for now.We__llrevisit__listcomprehensions__inChapter__20in__thecontext__offunctional__programming tools,and__willdefine__theirsyntax__moreformally__andexplore__additionalexamples__there.As__youll__find,comprehensions__turnout__tobe__justas__relatedto__functionsas__theyare__tolooping__statements.List__comprehensionsare__alsorelated__toand__predatethe__setand__dictionarycomprehensions__introducedin__thisbook__sprior__part,as__wellas__thegenerator__expressionyou__llmeet__laterthat__producesitems__onrequest__insteadof__buildinga__list.All__sharethe__same syntax,but__arecoded__slightlydifferently__andproduce__differentsorts__of stuff: [x + 10for__xin__Lif__x > 0] #List__comprehension {x + 10for__xin__Lif__x > 0} #Set__comprehension {x:x__+ 10for__xin__Lif__x > 0} #Dictionary__comprehension (x + 10for__xin__Lif__x > 0) #Generator__expressionWe__llput__thelast__threeof__theseto__workon__filesbriefly__inthe__next section.To__betterexpand__thisplotline__to generators, though,we__haveto__moveon__tothis__books__next part.NOTE__Speed disclaimer:As__ablanket__qualificationfor__allperformance__claimsin__this book,the__relativespeed__ofcode__dependsmuch__onthe__exactcode__testedand__versionof__Python used,and__isprone__tovary__and change.For__example,list__comprehensionshave__beenconsistently__twiceas__fastas__correspondingfor__loopson__mosttests__forall__CPythonsthrough__3.12,but__maybe__justmarginally__quickeron__some tests,and__perhapseven__slowerwhen__iffilter__clausesare__used.You__lllearn__howto__timeyour__owncode__andPython__inChapter__21.For__now,keep__inmind__thatabsolutes__inperformance__benchmarksare__aselusive__asconsensus__inopen__source projects.Iteration__ToolsLater__inthis__book,you__lllearn__how user-definedclasses__canimplement__theiteration__protocol too.Because__of this,it__ssometimes__importantto__knowwhich__built-intools__makeuse__ofit__anytool__thatemploys__theiteration__protocolwill__automaticallywork__onany__built-intype__or user-definedclass__thatprovides__it.This__sectioncloses__outthis__chapterwith__asummary__andsort__ofgrand__finaleof__toolsin__this domain.So__far,we__vemostly__seeniterators__atwork__inthe__contextof__thefor__loop statement,because__thispart__ofthe__bookis__focusedon__statements.Keep__in mind, though,that__every built-intool__thatscans__fromleft__toright__acrosscollection__objectsuses__theiteration__protocol.This__includesthe__forloops__weve__seen: >>>for__linein__open('data.txt'): print(line.upper(), end='')TESTING__FILEIO__LEARNING PYTHON, 6EPYTHON__3.12But__alsomuch__more.For__instance,the__priorsection__slist__comprehensionsand__themap__built-infunction__wemet__earlieruse__thesame__protocolas__theirfor__loop cousin.When__appliedto__a file,they__bothleverage__thefile__objects__iteratorautomatically__toscan__lineby__line,fetching__aniterator__with__iter____andcalling____next__each__time through: >>>uppers__= [line.upper()for__linein__open('data.txt')] >>>uppers__['TESTINGFILE__IO\n', 'LEARNING PYTHON, 6E\n', 'PYTHON 3.12\n'] >>> list(map(str.upper, open('data.txt'))) ['TESTINGFILE__IO\n', 'LEARNING PYTHON, 6E\n', 'PYTHON 3.12\n']As__wesaw__earlier,the__map built-inapplies__afunction__callto__eachitem__inan__iterable object.map__issimilar__toa__listcomprehension__butis__morelimited__becauseit__requiresa__functioninstead__ofan__arbitrary expression.It__alsoreturns__aniterable__object,so__wemust__wrapit__ina__listcall__toforce__itto__giveus__allits__valuesat__once.Because__map,like__thelist__comprehension,is__relatedto__bothfor__loopsand__functions,watch__forits__revivalin__Chapter 20.Many__ofPython__sother__built-insprocess__iterables, too.We__veseen__howzip__combinesitems__from iterables,enumerate__pairsitems__inan__iterablewith__relative positions,and__filterselects__itemsfor__whicha__functionis__true.In__addition,sorted__sortsitems__inan__iterable,and__reduce (nowoddly__relegatedto__a module)runs__pairsof__itemsin__aniterable__througha__function.All__ofthese__accept iterables,and__zip, enumerate,and__filteralso__returnan__iterablelike__map.Here__theyare__inaction__runningthe__files__iteratorautomatically__toread__lineby__line: >>> sorted(open('data.txt')) ['Learning Python, 6E\n', 'Python 3.12\n', 'Testingfile__IO\n'] >>> list(zip(range(99), open('data.txt'))) [(0, 'Testingfile__IO\n'), (1, 'Learning Python, 6E\n'), (2, 'Python 3.12\n')] >>> list(enumerate(open('data.txt'))) [(0, 'Testingfile__IO\n'), (1, 'Learning Python, 6E\n'), (2, 'Python 3.12\n')] >>> list(filter(bool, open('data.txt'))) ['Testingfile__IO\n', 'Learning Python, 6E\n', 'Python 3.12\n'] >>>import__functools,operator__>>> functools.reduce(operator.add, open('data.txt')) 'Testingfile__IO\nLearning Python, 6E\nPython 3.12\n'All__ofthese__areiteration__tools,but__theyhave__unique roles.We__metzip__andenumerate__inthis__chapter;filter__andreduce__arein__Chapter 19s__functionalprogramming__domain,so__well__defertheir__detailsfor__now;the__pointto__noticehere__istheir__useof__theiteration__protocolfor__filesand__other iterables.We__firstsaw__thesorted__functionused__hereat__workin__Chapter 4,and__weused__itin__Chapter 8.sorted__isa__built-inthat__employsthe__iterationprotocol__its__likethe__originallist__sort method,but__itreturns__thenew__sortedlist__asa__resultand__runson__anyiterable__object.Notice__that,unlike__mapand__others,sorted__returnsan__actuallist__insteadof__an iterable.Per__theprior__chapters__closer,its__reversedcohort__returnsan__iterablebut__doesnot__runthe__iteration protocol.In__general, though,everything__inPython__s built-intoolset__thatscans__objectis__definedto__usethe__iterationprotocol__ontheir__subject.This__evenincludes__toolssuch__asthe__listand__tuple built-infunctions__(whichbuild__newobjects__from iterables),and__Chapter 7s__stringjoin__method (whichmakes__anew__stringby__puttinga__substringbetween__stringsin__an iterable). Hence,these__willalso__workon__anopen__fileand__automaticallyread__oneline__ata__time: >>> list(open('data.txt')) ['Testingfile__IO\n', 'Learning Python, 6E\n', 'Python 3.12\n'] >>> tuple(open('data.txt')) ('Testingfile__IO\n', 'Learning Python, 6E\n', 'Python 3.12\n') >>> '&&'.join(open('data.txt')) 'Testingfile__IO\n&&Learning Python, 6E\n&&Python 3.12\n'Even__sometools__youmight__notexpect__fallinto__this category.For__example,Chapter__11s__sequenceassignment__(originaland__starred),the__inmembership__test,slice__assignment,the__lists__extend method,and__single-starliteral__unpackingalso__leveragethe__iterationprotocol__to scan,and__thusread__afile__bylines__automatically: >>> a, b,c__= open('data.txt') #Sequence__assignment >>> b,c__('Learning Python, 6E\n', 'Python 3.12\n') >>> a, *b = open('data.txt') # Extended-unpackingassignment__>>> a,b__('Testingfile__IO\n', ['Learning Python, 6E\n', 'Python 3.12\n']) >>> 'Python 2.7\n'in__open('data.txt') #Membership__testFalse__>>> 'Python 3.12\n'in__open('data.txt')True__>>>L__= [11, 22, 33, 44] #Slice__assignment >>> L[1:3] = open('data.txt') >>>L__[11, 'Testingfile__IO\n', 'Learning Python, 6E\n', 'Python 3.12\n', 44] >>>L__= [11] >>> L.extend(open('data.txt')) # list.extendmethod__>>>L__[11, 'Testingfile__IO\n', 'Learning Python, 6E\n', 'Python 3.12\n'] >>>L__= [11, *open('data.txt'), 44] # List-literalunpacking__>>>L__[11, 'Testingfile__IO\n', 'Learning Python, 6E\n', 'Python 3.12\n', 44]Remember__thatextend__iterates automatically,but__appenddoes__notthough__youcan__usethe__latterto__addan__iterableto__alist__without iterating,and__iterateacross__it later: >>>L__= [11] >>> L.append(open('data.txt')) >>> list(L[-1]) ['Testingfile__IO\n', 'Learning Python, 6E\n', 'Python 3.12\n']Nor__doesthe__iterationgrand__finaleend__here.In__theprior__chapter,we__sawthat__the built-indict__callaccepts__aniterable__zipresult__too.For__that matter,so__doesthe__set call,as__wellas__theset__anddictionary__comprehensionexpressions__wemet__earlierand__willrevisit__later: >>> set(open('data.txt')) {'Python 3.12\n', 'Learning Python, 6E\n', 'Testingfile__IO\n'} >>> {linefor__linein__open('data.txt')} {'Python 3.12\n', 'Learning Python, 6E\n', 'Testingfile__IO\n'} >>> {ix:line__for ix,line__in enumerate(open('data.txt'))} {0: 'Testingfile__IO\n', 1: 'Learning Python, 6E\n', 2: 'Python 3.12\n'}As__noted,both__setand__dictionarycomprehensions__supportthe__extendedsyntax__oflist__comprehensionswe__metearlier__inthis__chapter,including__if tests: >>> {linefor__linein__open('data.txt')if__line[0]in__'LP'} {'Python 3.12\n', 'Learning Python, 6E\n'} >>> {ix:line__for (ix, line)in__enumerate(open('data.txt'))if__line[0]in__'LP'} {1: 'Learning Python, 6E\n', 2: 'Python 3.12\n'}Like__thelist__comprehension,both__ofthese__scanthe__fileline__byline__andpick__outlines__thatbegin__withthe__specific letters.They__alsohappen__tobuild__setsand__dictionariesin__the end,but__weget__alot__ofwork__forfree__bycombining__fileiteration__andcomprehension__syntax.In__thenext__partof__this book,you__llmeet__arelative__ofcomprehensions__generatorexpressions__thatdeploys__thesame__syntaxand__workson__iterables too,but__isalso__iterable itself: >>> list(line.upper()for__linein__open('data.txt')) ['TESTINGFILE__IO\n', 'LEARNING PYTHON, 6E\n', 'PYTHON 3.12\n']Other__built-infunctions__supportthe__iterationprotocol__as well,but__frankly,some__areharder__tocast__ininteresting__examplesrelated__to files.For__example,the__sumcall__computesthe__sumof__allthe__numbersin__any iterable;the__anyand__all built-ins__returnTrue__ifany__orall__itemsin__aniterable__are True, respectively;and__maxand__minreturn__thelargest__andsmallest__itemin__an iterable, respectively.Like__reduce,all__ofthe__toolsin__thefollowing__examplesaccept__anyiterable__asan__argumentand__usethe__iterationprotocol__toscan__it,but__returna__single result: >>> sum(range(5)) #Punt__(requires numbers) 10 >>> any(open('data.txt')) # Any/alllines__true (nonempty)True__>>> all(open('data.txt')) #Mostly__pointlessfor__filesTrue__>>> max(open('data.txt')) #Line__withhighest__stringvalue__'Testingfile__IO\n' >>> min(open('data.txt')) #Use__cases wanted! 'Learning Python, 6E\n'There__sone__lastiteration__toolworth__mentioning,although__its__apreview__ofthis__books__next part:in__Chapter 18,you__lllearn__thata__special *form__canbe__usedin__functioncalls__tounpack__acollection__ofvalues__intoindividual__arguments,much__asit__doesin__list (and other) literals.As__youcan__probablypredict__by now,this__acceptsany__iterable too: >>>def__f(a, b, c): #See__PartIV__print(a, b, c, sep='&') >>> f(*open('data.txt')) #Iterates__bylines__too!Testing__fileIO__&Learning Python, 6E &Python 3.12In__fact,because__this argument-unpackingsyntax__incalls__accepts iterables,it__salso__possibleto__usethe__zip built-into__unzipzipped__tuples,by__makingprior__ornested__zipresults__argumentsfor__anotherzip__call (warning:you__probablyshouldn__tread__thefollowing__exampleif__youplan__tooperate__heavymachinery__anytime soon!): >>> X,Y__= (1, 2), (3, 4) >>> list(zip(X, Y)) #Zip__tuples:returns__aniterable__[(1, 3), (2, 4)] >>> A,B__= zip(*zip(X, Y)) #Unzip__a zip, really! >>> A,B__((1, 2), (3, 4))And__thatconcludes__our iteration-tools finale.It__sprobably__not complete,but__youprobably__getthe__point.Other__IterationTopics__Asmentioned__inthis__chapters__introduction,there__ismore__coverageof__bothlist__comprehensionsand__iterablesin__Chapter 20,in__conjunctionwith__functions,and__againin__Chapter 30when__westudy__classes.As__youll__see later: User-definedfunctions__canbe__turnedinto__iterablegenerator__functions,with__yield statements.List__comprehensionsmorph__intoiterable__generatorexpressions__whencoded__in parentheses. User-definedclasses__aremade__iterablewith____iter__or____getitem__in__operator overloading.In__particular, user-definediterables__definedwith__classesallow__arbitraryobjects__andoperations__tobe__usedin__anyof__theiteration__toolswe__vemet__inthis__chapter.By__supportingjust__asingle__operationiteration__objectsmay__beused__ina__widevariety__ofcontexts__and tools.Chapter__SummaryIn__this chapter,we__exploredconcepts__relatedto__loopingin__Python.We__tookour__firstsubstantial__lookat__theiteration__protocolin__Pythona__wayfor__nonsequenceobjects__totake__partin__iterationloops__andat__list comprehensions.As__we saw,a__listcomprehension__isan__expressionsimilar__toa__forloop__thatapplies__anotherexpression__toall__theitems__inany__iterable object.Along__the way,we__alsosaw__manyof__theother__built-initeration__toolsin__Pythons__arsenal.This__wrapsup__ourtour__ofspecific__proceduralstatements__andrelated__tools.The__nextchapter__closesout__thispart__ofthe__bookby__discussingdocumentation__optionsfor__Python code.Though__abit__ofa__diversionfrom__themore__detailedaspects__of coding,documentation__isalso__partof__thegeneral__syntax model,and__its__animportant__componentof__well-written programs.In__thenext__chapter,we__llalso__diginto__aset__ofexercises__forthis__partof__thebook__beforewe__turnour__attentionto__largerstructures__suchas__functions.As__usual, though,let__sfirst__exercisewhat__weve__learnedhere__witha__quiz.Test__Your Knowledge:Quiz__1.How__arefor__loopsand__iterableobjects__related? 2.How__arefor__loopsand__listcomprehensions__related? 3.Name__fouriteration__toolsin__thePython__language. 4.What__isthe__bestway__toread__lineby__linefrom__atext__file today?Test__Your Knowledge:Answers__1.The__forloop__normallyuses__theiteration__protocolto__stepthrough__itemsin__theiterable__objectacross__whichit__is iterating.It__firstfetches__aniterator__fromthe__iterableby__callingthe__iterables____iter__,and__thencalls__thisiterator__objects____next__method__oneach__iterationto__advanceand__catchesits__StopIterationexception__todetermine__whento__stop looping.Any__objectthat__supportsthis__modelworks__ina__forloop__andin__allother__iteration tools.The__protocols__methodscan__alsobe__runmanually__with built-insiter__and next.For__someobjects__thatare__theirown__iterator,the__initialiter__callis__extraneousbut__harmless. 2.Both__areiteration__tools.List__comprehensionsare__aconcise__andoften__efficientway__toperform__acommon__forloop__task:collecting__theresults__ofapplying__anexpression__toall__itemsin__aniterable__object.It__salways__possibleto__translatea__listcomprehension__toa__for loop,and__partof__thelist__comprehensionexpression__lookslike__theheader__ofa__forloop__syntactically.The__for loop, however,can__beused__inadditional__loopingroles__thatcomprehensions__donot__address. 3.Iteration__toolsin__Pythoninclude__thefor__loop;list__comprehensions;the__map built-in function;the__inmembership__test expression;and__the built-in__functions sorted, sum, any,and__all.This__categoryalso__includesthe__listand__tuple built-ins,string__join methods,and__sequenceassignments__(starredor__not),all__ofwhich__usethe__iterationprotocol__(seeanswer__#1)to__stepacross__iterableobjects__oneitem__ata__time. 4.The__bestway__toread__linesfrom__atext__filetoday__isto__notread__itexplicitly__at all: instead,open__thefile__withinan__iterationtool__suchas__afor__loopor__list comprehension,and__letthe__iterationtool__automaticallyscan__oneline__ata__timeby__runningthe__files__nexthandler__methodon__each iteration.This__approachis__generallybest__interms__ofcoding__simplicity,memory__space,and__possiblyexecution__speed requirements.Chapter__15.The__DocumentationInterlude__Thispart__ofthe__bookconcludes__witha__brieflook__attechniques__andtools__usedfor__documentingPython__code.Although__Pythoncode__iscomparatively__readableby__itself,a__few well-placedand__human-accessiblecomments__cando__muchto__helpothers__understandthe__workingsof__yourprograms__especiallywhen__codegrows__largerthan__mostin__this book.As__youll__see,Python__includesboth__syntaxand__toolsto__makedocumentation__easier.In__particular,the__Pydocsystem__coveredhere__canrender__acode__files__documentationas__eitherplain__textin__aninteractive__REPL,or__HTMLin__a browser.While__thistopic__ispartly__tools related,it__spresented__herebecause__itboth__involvesPython__ssyntax__modeland__providesa__resourcefor__readersstruggling__tounderstand__Pythons__toolset.For__thelatter__purpose,this__chapteralso__expandson__documentationpointers__firstgiven__inChapter__4.As__usual,because__thischapter__closesout__its part,it__alsoends__withsome__warningsabout__commonpitfalls__anda__setof__exercisesfor__thispart__ofthe__text,in__additionto__itschapter__quiz.Python__DocumentationSources__Bythis__pointin__the book,you__reprobably__startingto__realizethat__Pythoncomes__withan__amazingamount__ofprebuilt__functionality built-infunctions__and exceptions,predefined__objectattributes__and methods, standard-library modules,and__more.And__weve__reallyonly__scratchedthe__surfaceof__eachof__these categories.One__ofthe__firstquestions__thatbewildered__beginnersoften__ask is,How__doI__findinformation__onall__the built-in tools?This__sectionprovides__tipson__thevarious__documentationsources__availablein__Python.It__alsopresents__documentationstrings__(docstrings,for__short),and__thePydoc__systemshipped__withPython__thatmakes__useof__them.These__topicsare__somewhatperipheral__tothe__corelanguage__itself,but__theybecome__essentialknowledge__assoon__asyour__codebecomes__largeor__complexenough__tochallenge__itsreaders__including yourself,six__monthsdown__the road.As__summarizedin__Table 15-1,there__area__varietyof__placesto__lookfor__informationabout__Python,with__generallyincreasing__verbosity.Because__documentationis__sucha__crucialtool__inpractical__programming,we__llexplore__eachof__thesecategories__inthe__sectionsthat__follow.Table__15-1.Python__documentationsources__FormRole__#comments__In-filedocumentation__Thedir__functionLists__ofattributes__availablein__objects Docstrings:__doc____In-filedocumentation__attachedto__objects Pydoc:the__helpfunction__Interactivehelp__forobjects__Pydoc:HTML__reportsModule__documentationin__abrowser__Sphinx third-partytool__Richerdocumentation__forlarger__projectsThe__standardmanuals__Officiallanguage__andlibrary__descriptionsWeb__resourcesOnline__tutorials, examples,and__soon__#Comments__Aswe__velearned__andused__inmost__examplelistings__sofar__hash-markcomments__arethe__mostbasic__wayto__documentyour__code.Python__simplyignores__allthe__textfollowing__a # (aslong__asit__snot__insidea__string literal),so__youcan__followthis__characterwith__anywords__anddescriptions__meaningfulto__programmers.Such__commentsare__accessibleonly__inyour__source files, though;to__codecomments__thatare__morewidely__available,you__lluse__docstrings (ahead).In__fact,current__bestpractice__(generallyaccepted__convention)dictates__thatdocstrings__arebest__forlarger__functionaldocumentation__(e.g.,my__scriptdoes__this ),and__#comments__arebest__limitedto__smallercode__documentation (e.g.,this__strangeexpression__doesthat__)and__arebest__limitedin__scopeto__astatement__orsmall__groupof__statementswithin__ascript__or function.Docstrings__area__broadertopic__well__getto__ina__moment; first,let__ssee__howto__explore objects.The__dirFunction__Aswe__vealso__seen,the__built-indir__functionis__aneasy__andautomatic__wayto__listall__ofthe__attributesavailable__insidean__object (i.e.,its__methodsand__simplerdata__items).It__canbe__calledwith__noarguments__tolist__variablesin__thecaller__s scope,something__thenext__partof__thisbook__willdefine__in full.More__usefully,it__canalso__becalled__withany__objectthat__has attributes,including__importedmodules__andobjects__of built-in types,as__wellas__thename__ofa__datatype__itself.For__example,to__findout__whats__availablein__a module,such__asthe__standardlibrary__s sys,import__itand__passit__to dir: $ python3 >>>import__sys >>> dir(sys) [many__nameshere__]The__listof__attributename__stringsyou__llget__backis__omittedhere__becauseit__snot__smalland__isprone__tovary__perPython__version;run__thison__yourown__fora__better look.In__fact,there__arecurrently__110attributes__in sys,though__wegenerally__careonly__aboutthe__97that__donot__haveleading__doubleunderscores__(twounderscores__usuallymeans__interpreter-related),or__the 83that__haveno__leadingunderscore__atall__(oneunderscore__usuallymeans__implementation private, informally).Rooting__outsuch__numbersis__aprime__exampleof__thepreceding__chapters__listcomprehension__at work: >>> len(dir(sys)) #Number__namesin__sys 110 >>> len([xfor__xin__dir(sys)if__not x.startswith('__')]) #Non____Xnames__only 97 >>> len([xfor__xin__dir(sys)if__not x[0] == '_']) #Ignore___Xnames__too 83To__findout__whatattributes__areprovided__inobjects__of built-in types,run__diron__a literal,an__existing instance,or__thename__ofthe__desired type.For__example,to__seeall__text-string attributes,you__canpass__anempty__orthe__typename__str: >>> dir('') ['__add__',more__nameshere__, 'zfill'] >>> dir(str) == dir('')True__Thedir__resultfor__any built-intype__includesa__setof__attributesthat__arerelated__tothe__implementationof__thattype__(mostly,for__expression operators).Much__asin__modules,they__allbegin__andend__withdouble__underscoresto__makethem__distinct,and__youcan__safelyignore__themat__thispoint__inthe__book (theyll__resurfacelater__for OOP).For__instance,there__are 81 text-string attributes,but__only 47that__correspondto__namedmethods__or data;lists__haveeven__fewer: >>> len(dir('')), len([xfor__xin__dir('')if__not x.startswith('__')]) (81, 47) >>> len(dir([])), len([xfor__xin__dir([])if__not x.startswith('__')]) (48, 11)To__list names,filter__out double-underscoreditems__thatare__notof__commonprogram__interestby__runningthe__samelist__comprehensions,but__printthe__attributes.To__demo,here__arethe__namedattributes__inlists__and dictionaries: >>> [afor__ain__dir(list)if__not a.startswith('__')] ['append', 'clear', 'copy', 'count', 'extend', 'index', 'insert', 'pop', 'remove', 'reverse', 'sort'] >>> [afor__ain__dir(dict)if__not a.startswith('__')] ['clear', 'copy', 'fromkeys', 'get', 'items', 'keys', 'pop', 'popitem', 'setdefault', 'update', 'values']This__mayseem__likea__lotto__typeto__getan__attribute list,but__beginningin__thenext__chapter,you__lllearn__howto__wrapsuch__codein__a simple, importable,and__reusablefunction__soyou__dont__needto__typeit__again. Aside:type__nameslike__str, list,and__dictwork__indir__becausethey__areactually__namesof__typesin__Python today,not__just type-converter functions;calling__oneof__theseinvokes__itsconstructor__togenerate__aninstance__ofthat__type.Part__VIwill__havemore__tosay__aboutconstructors__andoperator__overloadingmethods__whenwe__discuss classes.The__dirfunction__ismostly__amemory__joggerit__providesa__listof__attribute names,but__itdoes__nottell__youanything__aboutwhat__thosenames__mean.For__suchextra__information,we__needto__moveon__tothe__nextdocumentation__source.NOTE__Attributesin__IDEs:Some__GUIsfor__Python work,including__IDLE,have__featuresthat__listattributes__onobjects__automatically,which__canbe__viewedas__alternativesto__dir. IDLE,for__example,will__listan__objects__attributesin__a pop-upselection__windowwhen__youtype__aperiod__afterthe__objects__nameand__pauseor__press Tab.This__ismostly__meantas__anautocomplete__feature, though,not__aninformation__source.Chapter__3and__AppendixA__haveintroductory__infoon__IDLE.Docstrings__and__doc____Besides # comments,Python__supportsdocumentation__thatis__automaticallyattached__toobjects__andretained__atruntime__for inspection. Syntactically,such__commentsare__codedas__stringliterals__ofany__type,except__bytesand__f-strings.They__arelocated__atthe__topsof__codecomponents__(modulefiles__andfunction__andclass__statements),and__beforeany__otherexecutable__code (# comments,including__Unix-style #! lines,are__OKbefore__them).When__present,the__textof__such strings,known__as docstrings,is__automaticallystuffed__intothe____doc__attributes__ofthe__corresponding objects. User-defineddocstrings__For example,consider__thefile__docstrings.pyin__Example 15-1.You__cansafely__ignoremost__ofits__codehere__(well__study functions, modules,and__classesin__thenext__threeparts__ofthis__book),but__noticeits__threestring__literals:because__theyare__codedat__thebeginning__ofthe__file,and__atthe__startof__afunction__(def)and__class (class)within__it,they__aretaken__asdocstrings__andare__savedin__theassociated__objects____doc__when__thisfile__isloaded__bya__runor__import.Example__15-1. docstrings.py """Module__documentationThis__moduledefines__a name,function__and class. """edition__= 6def__square(x): r'''Function__documentationReturns__the \square\of__its \numeric\ argument. '''return__x ** 2 #power__operatorclass__PartVI: "Classdocumentation__for \U0001F40D "pass__# Top-levelcode__print(square(edition)) print(square.__doc__) print(PartVI.__doc__)Some__finepoints__aboutthis__examples__docstrings: Literals:the__firstof__thisfile__sdocstrings__usesa__triple-quotedblock__atthe__topof__the file.This__iscommon__fordocstrings__asit__allowsfor__multiline comments,but__anysort__oftext__string (except f-strings)will__work.Both__single-or__double-quoted one-linerslike__thatin__theclass__are fine,but__dont__readilysupport__multiline text.Raw__strings:as__thefunction__demos, r' 'strings__worktoo__andmay__evenbe__requiredto__suppressunwanted__backslashescapes__andavoid__asyntax__warning (andeventual__error!)for__unrecognizedescapes__eachtime__codeis__runor__recompiledto__bytecode (seeChapter__7s__coverageof__new \deprecations__inPython__3.12). Content:docstrings__cancontain__anysort__of text,including__theclass__sUnicode__escapeand__rawemoji__(perthe__Unicodeintro__inChapter__4and__thewhole__storyin__Chapter 37).Notice__thatthe__\UUnicode__escaperequires__backslashesto__be used,so__itprecludes__usingraw__stringsto__avoidsyntax__errorsin__thefuture__(use \\).The__wholepoint__ofthis__documentationprotocol__isthat__yourcomments__areretained__forinspection__in__doc____attributesafter__thefile__is loaded. Thus,to__displaythe__docstringsassociated__withthe__moduleand__thetwo__codecomponents__it defines,we__simplyimport__thefile__andprint__their__doc____attributes,where__Pythonhas__savedthe__text.Assuming__thismodule__islocated__inthe__directoryin__whichwe__recurrently__working (anddeferring__toChapter__3s__noteabout__importsand__directoriesfor__backgroundinfo__onwhy__that matters): $ python3 >>>import__docstrings 36Function__documentationReturns__the \square\of__its \numeric\ argument.Class__documentationfor__>>> print(docstrings.__doc__)Module__documentationThis__moduledefines__a name,function__and class. >>> print(docstrings.square.__doc__)Function__documentationReturns__the \square\of__its \numeric\ argument. >>> print(docstrings.PartVI.__doc__)Class__documentationfor__Youwill__usuallywant__touse__printlike__thisto__view docstrings; otherwise,you__llget__asingle__stringwith__embedded \nnewline__characters.Also__notethat__importruns__thefile__s top-levelprints__(hencethe__outputimmediately__followingthe__import),as__doeslaunching__itas__a top-level script.Within__the file,square__isjust__square,a__simple variable: $ python3 docstrings.py 36Function__documentationReturns__the \square\of__its \numeric\ argument.Class__documentationfor__Youcan__alsoattach__docstringsto__methodsof__classes (coveredin__PartVI__too),but__because,as__youll__learn,these__arejust__defstatements__nestedin__class statements,they__renot__aspecial__case.For__instance,to__fetchthe__docstringof__amethod__functioninside__aclass__withina__module,you__wouldsimply__extendthe__pathto__gothrough__the class: module.class.method.__doc__.We__llcode__anexample__ofmethod__docstringsin__Chapter 29.NOTE__Docstrings futurism:If__youlook__closely,you__llnotice__thatmultiline__docstrings,like__thatof__square,retain__theirleading__indentationas__itwas__inthe__code.Python__3.13,still__onthe__drawingboard__asthis__noteis__being written,plans__toremove__leadingindentation__from docstrings,mostly__tosave__spacein__bytecodefiles__and memory.Even__beforethis__mod, though,you__wont__normallysee__theindents__in docs,because__toolslike__Pydocalready__stripand__reformat,as__youll__learn shortly.Docstring__standardsAs__mentioned earlier,common__practicetoday__recommends hash-markcomments__foronly__smaller-scaledocumentation__aboutan__expression, statement,or__smallgroup__of statements.Docstrings__arebetter__usedfor__higher-leveland__broaderfunctional__documentationfor__a file, function,or__class,and__havebecome__anexpected__partof__Python software.Beyond__these guidelines, though,you__stillmust__decidewhat__to write.Although__somecompanies__haveinternal__standards,there__isno__broadconsensus__aboutwhat__shouldgo__intothe__textof__a docstring.There__havebeen__variousmarkup__languageand__template proposals,including__HTML,but__theydon__tseem__tohave__caughton__inthe__Python world. Frankly,convincing__programmersto__documenttheir__workusing__handcodedHTML__probablywon__thappen__inour__lifetimes,but__thisshouldn__tapply__todocumentation__in general.Documentation__tendsto__havea__lowerpriority__thanit__should.Too__often,if__youget__anydocs__ina__fileat__all,you__countyourself__lucky (andeven__betterif__theyre__accurateand__upto__date).While__technically optional,documentation__isa__crucialpart__of well-written programs,and__youre__encouragedto__commentyour__code liberally.When__you do, though,there__isno__standarddocstring__format;if__youwant__touse__them,anything__goes today.Just__asfor__writingcode__itself,it__sup__toyou__tocreate__docstringcontent__andkeep__itup__to date,but__commonsense__isprobably__yourbest__allyin__both tasks. Built-indocstrings__Whileit__simportant__todocument__ourown__code,it__turnsout__that built-inmodules__andobjects__inPython__usesimilar__techniquesto__attachdocumentation__aboveand__beyondthe__attributelists__returnedby__dir.For__example,to__viewa__human-readable__descriptionof__a built-in module,import__itand__printits____doc__string__aswe__didfor__ourown__code: >>>import__sys >>> print(sys.__doc__)This__moduleprovides__accessto__someobjects__usedor__maintainedby__theinterpreter__andto__functionsthat__interactstrongly__withthe__interpreter.Dynamic__objects:argv__--command__line arguments; argv[0]is__thescript__pathnameif__knownpath__--module__search path; path[0]is__thescript__directory,else__''modules__--dictionary__ofloaded__modulesmore__textomitted__For finer-grained details, functions, classes,and__methodswithin__built-inmodules__haveattached__descriptionsin__their__doc____attributesas__well: >>> print(sys.getrefcount.__doc__)Return__thereference__countof__object.The__countreturned__isgenerally__onehigher__thanyou__might expect,because__itincludes__the (temporary)reference__asan__argumentto__getrefcount().You__canalso__readabout__built-infunctions__viatheir__docstrings: >>> print(map.__doc__) map(func, *iterables) -->map__objectMake__aniterator__thatcomputes__thefunction__usingarguments__fromeach__ofthe__iterables.Stops__whenthe__shortestiterable__is exhausted.In__fact,you__canget__awealth__ofinformation__about built-intools__byinspecting__theirdocstrings__thisway__butyou__dont__have to.The__Pythonhelp__functionlargely__automatesthis__for you,as__thenext__sectionwill__explain. Pydoc:The__helpFunction__Thedocstring__techniqueproved__tobe__souseful__thatPython__eventuallyadded__atool__thatmakes__docstringseven__easierto__display. Namely,Pydoc__isPython__codethat__knowshow__toextract__docstringsand__associatedstructural__informationand__formatthem__intonicely__arrangedreports__ofvarious__types.Additional__toolsfor__extractingand__formattingdocstrings__areavailable__inthe__opensource__domain (including third-partytools__thatmay__supportstructured__textsearch__theWeb__for pointers),but__Pythonships__withPydoc__inits__always-presentstandard__library.There__area__varietyof__waysto__launch Pydoc,but__thetwo__mostprominent__arethe__built-inhelp__functionand__thePydoc__browser-based interface.Of__these,help__maybe__themost__straightforwardto__useand__isalways__availablein__a REPL.We__methelp__brieflyin__Chapter 4.It__invokesPydoc__togenerate__asimple__plain-text__reportfor__anyPython__object.In__this mode,help__textlooks__muchlike__amanpage__on Unix-like systems.In__fact,outside__GUIslike__IDLE,help__textworks__thesame__wayas__aUnix__morewhen__thereare__multiplepages__oftext__pressthe__spacebar__tomove__tothe__next page,Enter__(oryour__keyboards__equivalent)to__goto__thenext__line,and__Qto__quitthe__display.GUIs__generallyscroll__helptext__instead.Let__sturn__toa__fewexamples__tosee__howthis__works.Running__helpon__built-intools__Because built-intools__comewith__thedocstrings__wesaw__earlier,help__givesus__alevel__ofreference__docsfor__Python,midway__betweendir__listsand__thefull__manuals.Here__itis__live,reporting__ona__standard-librarymodule__s function: >>>import__sys >>> help(sys.getrefcount)Help__on built-infunction__getrefcountin__module sys: getrefcount(object, /)Return__thereference__countof__object.The__countreturned__isgenerally__onehigher__thanyou__might expect,because__itincludes__the (temporary)reference__asan__argumentto__getrefcount().You__donot__haveto__importsys__inorder__tocall__help,but__yougenerally__haveto__importsys__toget__helpon__systhis__way,because__helpexpects__anobject__referenceto__bepassed__in. Alternatively,you__canalso__gethelp__fora__moduleyou__havenot__importedby__quotingthe__modules__nameas__a string.For__example, help('sys')and__help('sys.getrefcount')both__work too,without__theimport__step.For__largerobjects__suchas__modulesand__classes,the__helpdisplay__isbroken__downinto__multiple sections,the__preamblesof__whichare__shown here.Run__thisinteractively__tosee__thefull__report: >>> help(sys)Help__on built-inmodule__sys:NAME__sysMODULE__REFERENCE https://docs.python.org/3.12/library/sys.htmlmore__omittedDESCRIPTION__Thismodule__providesaccess__tosome__objectsused__ormaintained__bythe__moreomitted__SUBMODULESmonitoring__FUNCTIONS__breakpointhook____= breakpointhook(...)more__omittedDATA____stderr__ = <_io.TextIOWrapper name='' mode='w' encoding='utf...more__omittedFILE__(built-in)Some__ofthe__informationin__thisreport__is docstrings,and__someof__it (e.g.,function__call patterns)is__structuralinformation__thatPydoc__gleansautomatically__byinspecting__objectsinternals__usingtools__availableto__yourcode__too.Besides__modules,you__canalso__usehelp__on built-in functions, methods,and__types.To__gethelp__fora__built-in type,try__eitherthe__typename__(e.g.,dict__fordictionary__orstr__for string);an__actualobject__ofthe__type (e.g., {}or__'');or__amethod__ofan__actualobject__ortype__name (e.g., 's'.joinor__str.join ).1For__anentire__type,you__llget__alarge__displaythat__describesall__themethods__availablefor__that type;for__a method,the__helpis__more focused: >>> help(dict)Help__onclass__dictin__module builtins:class__dict(object) | dict() ->new__emptydictionary__| dict(mapping) ->new__dictionaryinitialized__froma__mapping object's |more__omitted >>> help(str.replace)Help__on method_descriptor: replace(self, old, new, count=-1, /)Return__acopy__withall__occurrencesof__substringold__replacedby__new.more__omitted >>> help(''.replace)Help__on built-infunction__replace: replace(old, new, count=-1, /)method__of builtins.strinstance__Returna__copywith__alloccurrences__ofsubstring__oldreplaced__by new.more__omitted >>> help(ord)Help__on built-infunction__ordin__module builtins: ord(c, /)Return__theUnicode__codepoint__fora__one-character string.The__/in__functiondocs__meansthat__argumentsbefore__itmust__bepassed__byposition__only (notby__name),but__thisis__substantiallyabove__thischapter__spay__grade.See__thenext__partof__thisbook__fordetails__onthis__function syntax.Running__helpon__yourown__code Finally,the__helpfunction__worksjust__aswell__onyour__modulesas__itdoes__on built- ins.Here__itis__reportingon__componentsdefined__inthe__docstrings.pyfile__wecoded__earlierin__Example 15-1. Again,some__ofthis__isour__docstrings,and__someis__informationautomatically__extractedby__inspectingobjects__structures: >>>import__docstrings >>> help(docstrings.square)Help__onfunction__squarein__module docstrings: square(x)Function__documentationReturns__the \square\of__its \numeric\ argument. >>> help(docstrings.PartVI)Help__onclass__PartVIin__module docstrings:class__PartVI(builtins.object) |Class__documentationfor__| |Data__descriptorsdefined__here: |more__omittedAnd__askingfor__helpon__theentire__modulecollects__allparts__at once,with__yourdocstrings__inthe__mix: >>> help(docstrings)Help__onmodule__docstrings:NAME__docstringsDESCRIPTION__Moduledocumentation__Thismodule__definesa__name,function__and class.CLASSES__builtins.objectPartVI__class PartVI(builtins.object) |Class__documentationfor__| |Data__descriptorsdefined__here: |more__omittedFUNCTIONS__square(x)Function__documentationReturns__the \square\of__its \numeric\ argument.DATA__edition = 6FILE__/Users/me/MY-STUFF/Books/Dev/6E/LP6E/LP6E/Examples/Chapter15/docstrings.pyIf__youlook__closely,you__llnotice__thatwe__didnt__getour__files__printedoutput__onimport__this time,just__becauseit__wasimported__earlier;as__notedin__Chapter 3,imports__runjust__onceper__fileper__session (morein__Part V). Pydoc:HTML__ReportsThe__textdisplays__ofthe__helpfunction__areadequate__inmany__contexts,especially__atthe__interactive prompt.To__readerswho__vegrown__accustomedto__richerpresentation__mediums, though,they__mayseem__abit__rudimentary.This__sectionpresents__the HTML-basedflavor__of Pydoc,which__rendersmodule__documentationmore__graphicallyfor__viewingin__aweb__browser,and__caneven__openone__automaticallyfor__you.This__browserinterface__schemecombines__bothsearch__anddisplay__ina__webpage__thatcommunicates__withan__automaticallystarted__local server.Using__Pydocs__browserinterface__Toview__docsin__a browser,you__llusually__launchPydoc__smain__scriptwith__apydoc__-bcommand__line.This__spawnstwo__componentsrunning__locallyon__your device:a__documentation server,and__a web-browserclient__thatprovides__bothpage__displayand__searchinput__forcontent__fetchedfrom__the server.A__commandline__likethe__followingstarts__the show: $ python3 -mpydoc__-bServer__readyat__http://localhost:53965/Server__commands: [b]rowser, [q]uit server>q__Thiscommand__workson__all PCs;it__sknown__toalso__workon__Androiddevices__inthe__Pydroid 3app__s Terminal,but__isspotty__onphones__in general.It__usesthe__Pythonm__argumentto__locatePydoc__smodule__fileon__the module-importsearch__path (coveredin__PartV__ofthis__book),and__runit__asa__top-level script.Per__AppendixA__andChapter__3,use__pyinstead__of python3in__thiscommand__on Windows.On__macOSand__Linux,a__pydoc3 -bcommand__hasthe__same effect,and__onWindows__theModule__Docsentry__inPython__sStart__menuautomatically__runsPydoc__s -b mode.However__youstart__it,Pydoc__sbrowser__modeopens__withits__index page,captured__inFigure__15-1.The__indexpage__listsall__themodules__availablefor__importsand__includessearch__boxes (e.g.,Get__loadsa__namedmodule__s docs),as__wellas__topicguides__and reserved-word info.You__llsee__linksto__thedocs__ofevery__moduleon__yourmodule__search path,including__thedirectory__wherePydoc__is launched.Pydoc__sserver__runson__thelocal__hostand__ona__dedicatedbut__bydefault__arbitraryunused__port,but__thiscan__be tailored;launch__Pydocwithout__-bfor__more options.Figure__15-1.The__top-levelindex__startpage__ofthe__Pydocbrowser__interfaceWhen__youclick__ortap__ona__modules__entryin__Pydocs__module-indexpage__(orenter__itsname__in Get),you__geta__pageof__docsfor__thatmodule__alonewhich__isessentially__thesame__infothat__helpprovides__inan__interactive REPL,but__formattedfor__displayin__your browser.Figure__15-2,for__example,shows__thepage__weget__forthe__docstringsmodule__wecoded__earlierin__Example 15-1.It__sthe__samereport__createdfor__help(docstrings)with__asimple__HTML layout.Figure__15-2.Pydoc__browserinterface__displayinga__user-definedmodule__sdocs__Experimentwith__Pydocon__yourown__formore__insight.It__san__optional tool,but__providesextra__docsfor__both built-intools__providedby__Python,as__wellas__docstring-loadedcode__filesthat__youwrite__yourself.Customizing__PydocIf__yourun__this live,your__Pydocwill__probablylook__differentthan__thescreenshots__inthe__book,because__colorswere__customizedon__themachine__usedto__capturethe__images.Though__thisis__entirelyoptional__andrequires__some web-development knowledge,you__cancustomize__Pydocs__appearance, too,by__editingthe__simpleCSS__fileit__usesto__renderits__pages.To__modify colors,edit__file _pydoc.cssstored__inthe__pydoc_datafolder__alongsidePydoc__smodule__whichyou__canlocate__onany__platformby__importingPydoc__smodule__andinspecting__its__file____attribute: $ python3 -c "import pydoc; print(pydoc.__file__)"foldepath__/pydoc.py $ls__foldepath /pydoc_data # Pydoc'sCSS__customizationfile__isin__here __init__.py topics.py__pycache_____pydoc.cssOn__Windows,use__pyand__dirinstead__of python3and__ls.This__usesthe__Python -c__command-lineargument__tosubmit__codeto__berun__asa__string,which__ishandy__forshort__bitsof__one-offcode__like this; here,the__twostatements__separatedby__asemicolon__runthe__sameas__theywould__ifthey__weretyped__oneat__atime__ata__REPLs__>>> prompt.You__canalso__findthe__pathto__Pydocby__running help('pydoc'):its__pathshows__upat__thebottom__ofthe__display.Once__youve__locatedthe__CSS file,edit__itto__customizeas__youlike__(butsave__theoriginal__firstas__a fallback).As__an example,this__books__capturesuse__RGBcolor__string #173166for__index-decor.All__ofwhich__assumesCSS__skillsbeyond__thisbook__sscope__(plusan__undocumentedconfig__filethat__sprone__tochange__orvanish__inthe__future!),but__isprobably__enoughto__getyou__startedif__youwant__tohave__a go.More__Pydoctips__Pydocworks__byimporting__selectedfiles__toextract__their documentation.This__hastwo__usage implications. First,Pydoc__canaccess__onlyfiles__infolders__includedon__themodule__searchpath__usedby__imports.This__pathautomatically__includesPython__sstandard__library,so__youcan__viewdocs__forall__built-in modules.It__alsoincludes__thecurrent__workingdirectory__thefolder__fromwhich__Pydocwas__startedbut__thatmay__bemeaningless__whenstarted__froma__WindowsStart__button.Change__yourPYTHONPATH__settingto__includeother__codefolders__as needed,per__Appendix A. Second,although__Pydoccan__renderdocs__forboth__importablemodules__andrunnable__scriptsin__accessible folders,script__docscomes__witha__catch:when__afile__isselected__for help,Pydoc__mustimport__itin__orderto__collectits__documentation,and__aswe__learnedin__Chapter 3,importing__runsa__files__top-level code. Hence,script__helpimplies__ascript__run.Imported__modulesnormally__justdefine__toolswhen__run,so__thisis__usually irrelevant.If__youask__forthe__documentationof__a top-levelscript__file, though,the__scriptwill__be run,and__theconsole__windowwhere__youlaunched__Pydocserves__asthe__scripts__standardinput__andoutput__forany__user interaction.This__maywork__betterfor__somescripts__andmodes__than others;script__IOmay__appearbefore__orafter__helpis__dismissedin__console mode,before__helpis__scrolledin__aGUI__like IDLE,or__interleavedoddly__withPydoc__sown__server-commandprompts__inbrowser__mode.Later__inthe__bookyou__lllearn__waysto__code top-levellogic__thats__kickedoff__onlywhen__afile__is run,not__whenit__isimported__(e.g.,by__nestingit__undera__testfor__variable__name____being '__main__').If__scriptsuse__these protocols,they__resafe__toview__in Pydoc,because__itwon__trun__any top-levelcode__asan__inadvertentside__effectof__viewing docs. Finally,Pydoc__hasadditional__toolswe__llskip__herefor__space,including__a -wswitch__forsaving__HTMLdocs__toa__filefor__later viewing,and__a plain-textmode__runfrom__acommand__linewith__justa__topicname__thatworks__thesame__ashelp__ina__REPL. Again,run__Pydocwithout__any command-linearguments__forits__fullset__of options.NOTE__Blastfrom__the past:Pydoc__oncehad__asimple__GUI mode,invoked__byflag__-g,that__launcheda__tkinterGUI__clientthat__communicatedwith__the server.This__wasavailable__untilPython__3.2,when__thecurrent__browser-onlymode__wasdeemed__sufficientto__warrantdropping__thelongstanding__GUImode__in full.Browsers__areGUIs__too,of__course,and__theCSS__configurationscheme__forPydoc__thatarose__withthe__browsermode__assumesextra__web-developmentknowledge__thatmany__Pythonusers__wont__have.In__open source,those__withtime__anddesire__tochange__thingsdefine__thefuture__for everyone.Beyond__Docstrings:Sphinx__Ifyou__relooking__fora__wayto__documentyour__Pythonprograms__ina__moresophisticated__way,you__maywish__tocheck__outSphinx__adocumentation__generatorsystem__usedto__createPython__sstandard__manualsdescribed__inthe__next section,as__wellas__docsfor__manyother__software projects.It__usessimple__reStructuredTextas__itsmarkup__languageand__inheritsmuch__fromthe__Docutilssuite__ofparsing__andtranslating__tools.Among__other things,Sphinx__supportsa__varietyof__output formats,automatic__cross-referencesand__indexes,and__automaticcode__highlighting (colorization)using__Pygments,which__isitself__anoteworthy__Python tool.This__isprobably__overkillfor__smallerprograms__wheredocstrings__andhelp__may suffice,but__canyield__higher-gradedocumentation__forlarger__projects.See__theweb__formore__detailson__Sphinx,its__related tools,and__otheroptions__inthe__docs domain.The__StandardManuals__Asyou__knowby__now,this__bookis__atutorial__thatteaches__by example.While__itsindex__andintroductions__scaledto__differenttarget__audiences.Today__youwill__alsofind__amultitude__ofPython__blogs, websites, wikis,and__otherresources__onthe__webat__large.Given__theexplosion__ofthe__webin__recent decades,some__onlineresources__arenaturally__moreauthoritative__andreliable__than others,and__someare__sadlygeared__moretoward__monetizationthan__education.This__wordof__cautionincludes__AI chatbots,which__canonly__doas__wellas__thedata__theyre__fedand__paraphrase,and__arenot__areplacement__forthe__deeplearning__neededto__workin__software.That__said,there__sa__wealthof__Pythonmaterial__outthere__tobe__hadfor__thosewilling__toexercise__theprudence__andskepticism__thattoday__sweb__demands.Common__CodingGotchas__Beforethe__programmingexercises__forthis__partof__the book,let__srun__throughsome__ofthe__mostcommon__mistakesbeginners__makewhen__codingPython__statementsand__programs.Many__ofthese__arewarnings__issuedearlier__inthis__partof__the book,collected__herefor__easeof__reference.You__lllearn__toavoid__thesepitfalls__onceyou__vegained__abit__ofPython__coding experience,but__afew__wordsnow__mighthelp__youavoid__fallinginto__someof__thesetraps__initially:Don__tforget__the colons.Always__rememberto__typea__:at__theend__ofcompound__statementheaders__thefirst__lineof__an if, match, while, for, etc.You__llprobably__forgetat__first (ashave__thousandsof__Pythonstudents__overthe__years),but__youcan__takesome__comfortfrom__thefact__thatit__willsoon__becomean__unconscious habit.Start__incolumn__1.Be__sureto__start top-level (unnested)code__incolumn__1.That__includesunnested__codetyped__intomodule__files,as__wellas__unnestedcode__typedat__theinteractive__prompt (a.k.a. REPL).Indented__meansnested__in Python,so__itdoesn__twork__atthe__top.Blank__linesmatter__atthe__interactive prompt.Blank__linesin__compoundstatements__arealways__irrelevantand__ignoredin__module files,but__whenyou__retyping__codeat__theinteractive__prompt,they__endthe__statement.In__other words,blank__linestell__theinteractive__REPLthat__youve__finisheda__compound statement;if__youwant__to continue,don__thit__theEnter__keyat__the ...prompt__(if shown)until__youre__really done.This__alsomeans__youcan__tpaste__multilinecode__atthis__prompt;it__mustrun__onefull__statementat__a time,with__blanklines__as needed.Indent__consistently.Avoid__mixingtabs__andspaces__inthe__indentationof__anested__block. Otherwise,what__yousee__inyour__editormay__notbe__whatPython__seeswhen__itcounts__tabsas__anumber__of spaces.This__istrue__inany__block-structured language,not__justPython__ifthe__nextprogrammer__hastabs__set differently,it__willbe__difficultor__impossibleto__understandthe__structureof__your code.It__ssafer__touse__alltabs__orall__spacesfor__each block.Don__tcode__Cin__Python.A__reminderfor__C/C++ programmers:you__dont__needto__typeparentheses__aroundtests__inif__andwhile__headers (e.g.,if__(X==1)).You__canif__youlike__(anyexpression__canbe__enclosedin__parentheses),but__theyare__fullysuperfluous__inthis__context. Also,do__notterminate__allyour__statementswith__semicolons;it__stechnically__legalto__dothis__inPython__as well,but__its__totallyuseless__unlessyou__replacing__morethan__onestatement__ona__singleline__(theend__ofa__linenormally__terminatesa__statement).And__remember,don__tuse__{}around__blocks (indentyour__nestedcode__blocksconsistently__instead),and__avoidembedding__assignmentstatements__inwhile__looptests__unlessthey__resimple__(eventhough__Pythonnow__enablesthis__with :=).Use__simplefor__loopsinstead__ofwhile__or range.Another__reminder:a__simplefor__loop (e.g.,for__xin__y)is__almostalways__simplerto__codeand__oftenquicker__torun__thana__while-or__range-basedcounter__loop.Avoid__thetemptation__tocount__thingsin__Python;though__occasionally required,it__susually__subpar.Beware__ofmutables__in assignments.As__cautioned before,be__carefulabout__usingmutables__ina__multiple-targetassignment__(a =b__= []),as__wellas__inan__augmentedassignment__(a += [1, 2]).In__both cases, in-place__changesmay__impactother__variables.See__Chapter 11for__detailsif__youve__forgottenwhy__thisis__true.Don__texpect__resultsfrom__functionsthat__changeobjects__in place.We__encounteredthis__nag earlier, too: in-placechange__operationslike__the list.appendand__list.sortmethods__presentedin__Chapter 8do__notreturn__values (otherthan__None),so__youshould__callthem__withoutassigning__the result.It__snot__uncommonfor__beginnersto__saysomething__likemylist__= mylist.append(X)to__tryto__getthe__resultof__an append,but__thisassigns__mylistto__None,not__tothe__modifiedlist__(in fact,you__lllose__yourreference__tothe__list altogether).Always__useparentheses__tocall__a function.You__mustadd__parenthesesafter__afunction__nameto__call it,whether__ittakes__argumentsor__not (e.g.,use__function(),not__function).In__thenext__partof__this book,you__lllearn__thatfunctions__aresimply__objectsthat__havea__specialoperation__acall__thatyou__triggerwith__theparentheses__butthey__canbe__referencedlike__anyother__objectwithout__triggeringa__call.This__oftencrops__upwith__files;it__scommon__forbeginners__totype__file.closeto__closea__file,rather__than file.close().Because__its__legalto__referencea__functionwithout__calling it,the__firstversion__succeeds silently,but__itdoes__notclose__the file.Don__tuse__extensionsor__pathsin__importsand__reloads.Omit__directorypaths__andfile__extensionsin__importstatements__sayimport__mod,not__import mod.py.We__discussedmodule__basicsin__Chapter 3and__willcontinue__studyingmodules__inPart__V.Because__modulesmay__haveother__extensionsbesides__.py (e.g., .pycfor__bytecode),hardcoding__aparticular__extensionis__notonly__invalid syntax;it__doesnt__make sense.Python__picksan__extension automatically,and__any platform-specificdirectory__pathsyntax__comesfrom__modulesearch__path settings,not__theimport__statement.Until__weexplore__thisin__more depth,use__justa__simplename__in imports.And__otherpitfalls__inother__parts.Be__sureto__alsosee__the built-intype__warningsat__theend__ofPart__II,as__theymay__qualifyas__codingissues__too.There__areadditional__gotchasthat__cropup__commonlyin__Pythoncoding__losinga__built-infunction__byreassigning__its name,hiding__alibrary__moduleby__usingits__namefor__oneof__your own,changing__mutableargument__defaults,and__soon__butwe__dont__haveenough__backgroundto__coverthem__yet.To__learnmore__aboutboth__whatyou__shouldand__shouldnt__doin__Python,you__llhave__toread__on;later__partsextend__theset__ofgotchas__andfixes__weve__enumerated here.Chapter__SummaryThis__chaptertoured__documentationboth__documentationwe__writeourselves__inour__own programs,and__documentationavailable__fortools__we use.We__met docstrings,explored__referenceresources__for Python,and__learnedhow__Pydocs__helpfunction__and browser-basedinterfaces__provideextra__sourcesof__documentation.Because__thisis__thelast__chapterin__thispart__ofthe__book,we__alsoreviewed__commoncoding__mistakesto__helpyou__avoid them.In__thenext__partof__this book,we__llstart__applyingwhat__wealready__knowto__largerprogram__constructs. Specifically,the__nextpart__takesup__thetopic__offunctions__atool__usedto__groupstatements__for reuse.Before__moving on, however,be__sureto__workthrough__theset__oflab__exercisesfor__thispart__ofthe__bookthat__appearat__theend__ofthis__chapter.And__evenbefore__that,let__srun__throughthis__chapters__quizto__review.Test__Your Knowledge:Quiz__1.When__shouldyou__usedocumentation__stringsinstead__of hash-mark comments? 2.Name__threeways__youcan__viewdocumentation__strings. 3.How__canyou__obtaina__listof__theavailable__attributesin__an object? 4.How__canyou__geta__listof__allimportable__moduleson__your computer?Test__Your Knowledge:Answers__1.Documentation__strings (docstrings)are__consideredbest__for larger,functional__documentation,describing__theuse__of modules, functions, classes,and__methodsin__your code. Hash-markcomments__arebetter__limitedto__smaller-scaledocumentation__aboutarcane__expressionsor__statementsat__strategicpoints__onyour__code.This__ispartly__becausedocstrings__areeasier__tofind__ina__sourcefile__(theyhave__specific locations),but__alsobecause__theycan__beextracted__anddisplayed__bythe__Pydoc system. 2.You__cansee__docstringsby__printingan__objects____doc__ attribute,by__passingit__toPydoc__shelp__function,and__byselecting__modulesin__Pydocs__HTML-basedbrowser__interface.The__latteris__launchedwith__a -b__command-line switch,and__runsa__client/serversystem__thatdisplays__documentationin__a popped-upweb__browser.Pydoc__canalso__berun__tosave__amodule__sdocumentation__inan__HTMLfile__forlater__viewingor__printing. 3.The__built-in dir(X)function__returnsa__listof__allthe__attributesattached__toany__object.A__listcomprehension__like [afor__ain__dir(X)if__not a.startswith('__')]can__beused__tofilter__outinternals__nameswith__underscores (youll__learnhow__towrap__thisin__afunction__inthe__nextpart__ofthe__bookto__makeit__reusable). 4.Because__theindex__pageopened__forPydoc__s browser-based -bmode__displaysevery__moduleon__yourimport__search path,this__showsall__themodules__availablefor__importsin__your programs.This__relieson__configurable search-pathsettings__thatwe__llcover__morefully__laterin__this book,but__itincludes__boththe__currentdirectory__andPython__sstandard__libraryby__default.You__canalso__writecode__ofyour__ownto__achievethis__usingthe__sametools__thePydoc__uses (its__justPython__code,after__all),but__its__asignificant__manual task.Test__Your Knowledge:Part__IIIExercises__Nowthat__youknow__howto__codebasic__program logic,the__followingexercises__willask__youto__implementsome__simpletasks__with statements.Much__ofthe__workis__inexercise__4,which__letsyou__explorecoding__alternatives.There__arealways__manyways__toarrange__statements,and__partof__learningPython__islearning__whicharrangements__workbetter__than others.You__lleventually__gravitatenaturally__towardwhat__experiencedPython__programmerscall__best practice,but__bestpractice__takes practice.See__Part III,Statements__andSyntax__inAppendix__Bfor__solutionsto__thefollowing__exercises: 1.Coding__basic loops:This__exerciseasks__youto__experimentwith__for loops. a.Write__afor__loopthat__printsthe__ASCIIcode__pointof__eachcharacter__ina__stringnamed__S.Use__the built-infunction__ord(character)to__converteach__characterto__itsinteger__code point.This__functiontechnically__returnsa__Unicodecode__pointthat__maynot__fallin__ASCIIs__range,but__ifyou__restrictits__contentto__ASCII characters,you__llget__backASCII__codes. (Testit__interactivelyto__seehow__it works,if__needed.) b. Next,change__yourloop__tocompute__thesum__ofthe__ASCIIcode__pointsof__allthe__charactersin__a string. c. Finally,modify__yourloop__againto__returna__newlist__thatcontains__theASCII__codepoints__ofeach__characterin__the string.Does__theexpression__map(ord, S)have__asimilar__effect?How__about [ord(c)for__cin__S]? Why? (Hint:see__Chapter 14.) 2.Coding__basic selections:Write__Pythonif__andmatch__statementsthat__printthe__firstthree__monthnames__ofthe__year,given__theirrelative__numbers.For__example,given__1,the__outputshould__be January,and__for 3,it__shouldbe__March (orwhatever__monthsare__namedin__your locale).Then__dothe__sameby__codingthe__choicewith__botha__dictionary-keyindex__anda__list-offset index.How__wouldyou__handle out-of-rangemonth__numbers? 3.Backslash__characters:What__happenson__yourmachine__whenyou__typethe__followingcode__interactively?for__iin__range(50): print(f'hello {i}\a')Beware__thatif__its__runoutside__ofsome__interfaceslike__IDLE,this__examplemay__beepat__you,so__youmay__notwant__torun__itin__acrowded__room!IDLE__ignoresodd__charactersinstead__ofbeeping__spoilingmuch__ofthe__joke (seethe__backslashescape__charactersin__Table 7-2). 4.Sorting__dictionaries:In__Chapter 8,we__sawthat__dictionariesare__collectionsthat__storekeys__byinsertion__order only.Write__afor__loopthat__printsa__dictionarys__itemsin__sorted (ascending) key/value order. (Hint:store__keysin__unordered fashion,and__usethe__dictionarykeys__andlist__sort methods,or__thesorted__built-in function.) 5.Program__logic alternatives:Consider__thefollowing__code,which__usesa__whileloop__andfound__flagto__searcha__listof__powersof__2for__thevalue__of 2raised__tothe__fifthpower__(32).It__sstored__ina__modulefile__called power.py:L__= [1, 2, 4, 8, 16, 32, 64]X__= 5found__=False__i = 0while__notfound__andi__< len(L):if__2 **X__== L[i]:found__=True__else:i__= i+1if__found: print('at index', i) else: print(X, 'not found') $ python3 power.pyat__index 5As__is,the__exampledoesn__tfollow__normalPython__coding techniques.Follow__thesteps__outlinedhere__toimprove__it (forall__the transformations,you__mayeither__typeyour__codeinteractively__orstore__itin__ascript__filerun__fromthe__systemcommand__lineor__otherinterface__usinga__filemakes__thisexercise__much easier): a. First,rewrite__thiscode__witha__whileloop__elseclause__toeliminate__thefound__flagand__finalif__statement. b. Next,rewrite__theexample__touse__afor__loopwith__anelse__clause,to__eliminatethe__explicit list-indexing logic. (Hint:to__getthe__indexof__an item,use__thelist__indexmethod__L.index(X)returns__theoffset__ofthe__firstX__inlist__L.) c. Next,remove__theloop__completelyby__rewritingthe__examplewith__asimple__inoperator__membership expression. (SeeChapter__8for__more details,or__typethis__to test: 2in__[1, 2, 3].) d. Finally,use__afor__loopand__thelist__appendmethod__togenerate__the powers-of-2list__(L)instead__ofhardcoding__alist__literal.Deeper__thoughts: a.Do__youthink__itwould__improveperformance__tomove__the 2 **X__expressionoutside__the loops?How__wouldyou__code that? b.As__wesaw__inexercise__1,Python__includesa__map(function, iterable)tool__thatcan__generatea__powers-of-2 list, too: map(lambda x: 2 ** x, range(7)).Try__typingthis__code interactively;you__llmeet__lambdamore__formallyin__thenext__partof__this book,especially__inChapter__19.Would__alist__comprehensionhelp__here (seeChapter__14)?How__abouta__:=expression__(seeChapter__11)? 1Note__thatasking__forhelp__onan__actualstring__objectdirectly__(e.g., help('xyz'))doesn__twork__asyou__may expect:you__usuallyget__no help,because__stringsare__interpretedspecially__asa__requestfor__helpon__atopic__ortool__by name,as__described earlier.You__mustuse__thestr__typename__inthis__context,though__bothan__emptystring__(help(''))and__stringmethod__namesreferenced__throughactual__objects (help(''.join))work__fine.An__interactivehelp__mode,started__bytyping__just help(),avoids__manualhelp__calls,and__mayavoid__someof__their drama.Part__IV.Functions__andGenerators__Chapter 16.Function__BasicsIn__Part III,we__studiedbasic__proceduralstatements__in Python. Here,we__llmove__onto__explorea__setof__additionalstatements__andexpressions__thatwe__canuse__tocreate__functionsof__our own.In__simple terms,a__functionis__apackage__ofcode__invokedby__name.It__labelsand__groupsa__setof__statementsso__theycan__berun__morethan__oncein__a program.A__functionalso__cancompute__aresult__value,and__letsus__specifyparameters__thatserve__asinputs__andmay__differeach__timethe__functions__codeis__run.Wrapping__anoperation__ina__functionmakes__ita__generallyuseful__tool,which__wecan__applyin__avariety__of contexts.On__amore__pragmatic level,functions__arethe__alternativeto__programmingby__cuttingand__pastingrather__thanhaving__multipleredundant__copiesof__anoperation__s code,we__canfactor__itinto__asingle__function.In__so doing,we__reduceour__futurework__radically:if__theoperation__mustbe__changed later,we__haveonly__onecopy__toupdate__inthe__function,not__manyscattered__throughoutthe__program.Functions__arealso__themost__basicprogram__structurePython__providesfor__maximizingcode__reuse,and__leadus__tothe__largernotions__ofprogram__design.As__youll__see,functions__letus__splitcomplex__systemsinto__manageable parts.By__implementingeach__partas__a function,we__makeit__bothreusable__andeasier__to code.Table__16-1abstractly__previewsthe__function-relatedtools__well__studyin__thispart__ofthe__booka__setthat__includescall__expressions,two__waysto__makefunctions__(defand__lambda),two__waysto__managescope__visibility (globaland__nonlocal),two__waysto__sendresults__backto__callers (returnand__yield),and__toolsto__pausefor__results (asyncand__await).While__thiscomprises__a feature-rich topic,you__llfind__thatits__commonlyused__coreis__straightforward.Table__16-1. Function-relatedstatements__andexpressions__Statementor__expressionExamples__Callexpressions__myfunc('hack', tool=python, *versions)def__def printer(message): print('Hello', message)return__def adder(a, b=1, *c):return__a +b__+ c[0]lambda__funcs = [lambda x: x**2,lambda__x: x**3]global__x = 'old'def__changer():global__x;x__= 'new'nonlocal__def outer():x__= 'old'def__changer():nonlocal__x;x__= 'new'yield__def squares(x):for__iin__range(x):yield__i ** 2Generator__expressions (i ** 2for__iin__range(x)) async/awaitasync__def consumer(a, b):await__producer(b)Decorators__andannotations__@tracerdef__func(a: 'hack' = None) ->None__WhyUse__Functions?Before__weget__intothe__details,let__sestablish__aclearer__pictureof__whatfunctions__areall__about.Functions__area__nearlyuniversal__program-structuring device.You__mayhave__comeacross__thembefore__inother__languages,where__theymay__havebeen__calledsubroutines__or procedures.As__abrief__introduction,functions__servetwo__primarydevelopment__roles,and__serveas__thebasis__ofother__tools:Maximizing__reuseand__minimizingredundancy__Asin__mostprogramming__languages,Python__functionsare__thesimplest__wayto__packagelogic__youmay__wishto__usein__morethan__oneplace__andmore__thanone__time.Up__until now,almost__allthe__codewe__vebeen__writinghas__run immediately.Functions__allowus__todefer__andgeneralize__codeto__beused__arbitrarilymany__times later.Because__theyallow__usto__codean__operationin__asingle__placeand__useit__inmany__others,functions__arealso__afactoring__tool:they__enableus__toreduce__coderedundancy__inour__programs,and__therebyreduce__maintenance effort.Dividing__andconquering__Functionsalso__providea__toolfor__splittingsystems__intopieces__thathave__well-defined__rolesand__manageable scopes.For__instance,to__makea__pizzafrom__scratch,you__wouldstart__bymixing__the dough,rolling__it out,adding__toppings,baking__it,and__so on.If__youwere__programminga__pizza-making robot,functions__wouldhelp__youdivide__theoverall__makepizza__taskinto__smallerparts__onefunction__foreach__subtaskin__the process.Because__its__easierto__implementthe__smallertasks__inisolation__thanit__isto__implementthe__entireprocess__at once,this__makeslarger__tasksmore__practical.Implementing__objectmethods__In general,functions__areabout__procedurehow__todo__something,rather__thanwhat__youre__doingit__to. Nevertheless,when__pairedwith__animplied__subject,they__canalso__beused__tocode__object-specificbehavior__knownas__methods.You__llsee__whythis__distinctionmatters__inPart__VI,when__westart__makingnew__objectswith__classes.As__youll__find,classes__arelargely__justpackages__ofthe__functionsyou__lllearn__tocode__here.In__thispart__ofthe__book,we__llexplore__thetools__usedto__codefunctions__in Python:function__basics,scope__rules,and__argument passing,along__witha__fewrelated__conceptssuch__as generators, coroutines,and__functional tools.Because__itsimportance__beginsto__becomemore__apparentat__thislevel__of coding,we__llalso__revisitthe__notionof__polymorphism,which__wasintroduced__earlierin__the book.As__youll__see,functions__dont__implymuch__new syntax,but__theydo__leadus__tosome__biggerprogramming__ideas.Function__CodingOverview__Althoughit__wasnt__madevery__formal,we__vealready__usedfunctions__inearlier__chapters.For__instance,we__calledthe__built-inopen__functionto__makea__file object,invoked__thelen__built-infunction__toask__forthe__numberof__itemsin__acollection__object,and__employedtools__likezip__andrange__foriteration__tasks.In__this chapter,we__willbegin__exploringhow__towrite__newfunctions__in Python.Functions__wewrite__behavethe__sameway__asthe__built-inswe__vealready__seen:they__arecalled__in expressions,are__passed values,and__return results.But__writingnew__functionsrequires__theapplication__ofa__fewadditional__toolsand__ideasthat__havent__yetbeen__introduced. Moreover,functions__behavevery__differentlyin__Pythonthan__theydo__incompiled__languageslike__C.Basic__FunctionTools__Asa__roadmap__andbrief__rundownon__whatwe__llstudy__inthis__partof__the book,here__arethe__basiccomponents__andconcepts__inPython__sfunction__toolbox:def__createsa__functionand__assignsit__toa__name.Python__functionsare__codedwith__def statements.When__Pythonreaches__andruns__a def,it__generatesa__newfunction__objectand__assignsit__tothe__functions__name.As__withall__assignments,the__functionname__becomesa__referenceto__thefunction__object.There__snothing__magicalabout__thename__ofa__functionas__youll__see,the__functionobject__canbe__assignedto__other names,stored__ina__list,and__so on.Function__objectsmay__alsohave__arbitrary user-defined__attributesattached__tothem__torecord__data.def__isexecutable__code.Unlike__functionsin__compiled languages,def__isan__executablestatement__yourfunction__doesnot__existuntil__Pythonruns__its def.In__fact,it__slegal__(andeven__occasionally useful)to__nestdef__statementsinside__if statements,for__loops,and__evenother__defs.In__typical usage,def__statementsare__codedat__thetop__levelof__module files,and__areautomatically__runto__makefunctions__whentheir__modulesare__imported.return__sendsa__resultobject__backto__the caller.When__afunction__is called,the__callernormally__stopsuntil__thefunction__finishesits__workand__returnscontrol__tothe__caller.Functions__thatcompute__avalue__sendit__backto__thecaller__witha__return statement,and__thereturned__valuebecomes__theresult__ofthe__function call.A__returnwithout__avalue__simplyreturns__tothe__caller (andsends__back None,the__default result).lambda__createsa__functionbut__returnsit__asa__result.Function__objectsmay__alsobe__createdwith__thelambda__expression,a__featurethat__allowsus__tocode__inlinefunction__definitionsin__placeswhere__adef__statementwon__twork__syntactically.Like__def,functions__madethis__wayare__createdwhen__thelambda__isreached__and run.Because__lambdais__nottypically__codedat__thetop__levelof__a module, though,such__functionsare__madeduring__program runs,not__imports.lambda__isan__optionalconvenience__bestseen__asa__sidebarto__thedef__statement.Advanced__FunctionTools__In addition,Python__functionscan__leveragemore__advancedtools__likethe__following,which__well__takeup__afterwe__veintroduced__the basics:global__declares module-levelvariables__thatare__tobe__assigned.By__default,all__namesassigned__ina__functionare__localto__thatfunction__andexist__onlywhile__thefunction__runs.To__assigna__namein__theenclosing__module,functions__needto__listit__ina__global statement.More__generally,names__arealways__lookedup__inscopes__placeswhere__variablesare__storedand__namesare__boundto__scopesper__thelocation__ofassignments__inyour__code.nonlocal__declares enclosing-functionvariables__thatare__tobe__assigned.In__thesame__categoryas__global,the__nonlocalstatement__allowsa__functionto__assigna__namethat__existsin__thescope__ofa__syntacticallyenclosing__def statement.This__allowsenclosing__functionsto__serveas__aplace__toretain__stateinformation__rememberedbetween__functioncalls__withoutusing__sharedglobal__names.yield__sendsa__resultobject__backto__the caller,but__rememberswhere__itleft__off.Functions__knownas__generatorsmay__alsouse__theyield__statementto__sendback__avalue__andsuspend__theirstate__suchthat__theymay__beresumed__later,to__producea__seriesof__resultsover__time.Along__withtheir__generatorexpression__kin,such__functionssave__spaceand__avoiddelays__justlike__the built-initerables__wemet__inthe__priorpart__ofthis__book. await/asyncpause__awaiting__functionso__thatother__tasksmay__run.Functions__knownas__coroutinescan__suspendtheir__executionuntil__arequired__resultis__available.This__isan__advanced applications-level topic,but__allowscode__touse__languagetools__toget__otherwork__donewhile__waitingon__ablocking__eventlike__slow IO.General__FunctionConcepts__Finally,along__theway__well__explorea__handfulof__coreconcepts__thatspan__functionsof__all kinds:Arguments__arepassed__byassignment__(object reference).In__Python,arguments__arepassed__tofunctions__byassignment__which,as__weve__learned,means__byobject__reference.As__youll__see,in__Pythons__modelthe__callerand__functionshare__objectsby__references,but__thereis__noname__aliasing.Changing__anargument__namewithin__afunction__doesnot__alsochange__thecorresponding__namein__the caller,but__changing passed-inmutable__objectsin__placecan__changeobjects__sharedby__the caller,and__serveas__afunction__result.Arguments__arepassed__by position,unless__yousay__otherwise.Values__youpass__ina__functioncall__matchargument__namesin__afunction__sdefinition__fromleft__toright__by default.For__flexibility,function__callscan__alsopass__argumentsby__namewith__name=valuekeyword__syntaxand__unpackarbitrarily__manyarguments__tosend__with *argsand__**args starred-value notation.Function__definitionsuse__thesame__syntaxforms__tospecify__argumentdefaults__andcollect__arbitrarilymany__arguments received. Arguments,return__values,and__variablesare__not declared.As__witheverything__in Python,there__areno__typeconstraints__on functions.In__fact,nothing__abouta__functionneeds__tobe__declaredahead__of time:you__canpass__inarguments__ofany__type,return__anykind__of object,and__so on.As__a consequence,a__singlefunction__canoften__beapplied__toa__varietyof__objecttypes__anyobjects__thathave__acompatible__interface (supportfor__expectedmethods__and expressions)will__do,regardless__oftheir__specific types.This__makescode__flexibleby__design. Attributes, annotations,and__decoratorssupport__advanced roles.Functions__canoptionally__beaugmented__withboth__user-definedattributes__andother__toolsthat__extendtheir__roles.Annotations__ofarguments__and results,for__example,can__servea__varietyof__goals.Among__these,type__hinting (notedin__Chapter 6)gives__suggestedobject__typesbut__isunused__byPython__itselfand__simplyserves__asa__weightyform__of documentation,which__wewon__tcover__furtherin__this book.More__usefully,functions__canalso__beprefixed__with @decorators__thatadd__extralayers__oflogic__butare__usedin__waysthat__meritlargely__deferringuntil__PartVI__whenwe__vealso__learnedabout__classes.If__someof__thepreceding__wordsdidn__tsink__in,don__tworry__well__exploremost__ofthese__conceptswith__realcode__inthis__partof__the book.Let__sget__startedby__expandingon__someof__thebasics__bycoding__afew__abstract examples.def__StatementsThe__defstatement__createsa__functionobject__andassigns__itto__a name.Its__generalformat__andusage__isas__follows:def__name(arg1, arg2, argN): #Define__afunction__statements #Function__body name(val1, val2, valN) #Call__itlater__inan__expressionAs__withall__compound statements,def__consistsof__aheader__linefollowed__bya__blockof__other statements,usually__indented (thougha__simplestatement__afterthe__colonworks__as usual).The__statementblock__becomesthe__functions__bodythat__is,the__codePython__executeseach__timethe__functionis__later called.The__defheader__linespecifies__afunction__namethat__isassigned__thenew__function object,along__witha__listof__zeroor__morearguments__(sometimescalled__parameters)enclosed__inparentheses__(evenfor__zero arguments).The__argumentnames__inthe__headerare__assignedto__theobjects__passedin__parenthesesat__thepoint__ofcall__elsewherein__your code.To__callthe__functionlater__inyour__programand__runits__body,you__canuse__thefunction__nameassigned__by def,passing__inzero__ormore__values (objects)to__matchthe__argumentslisted__inthe__def header.A__callexpression__canalso__denotethe__functionwith__othertypes__ofobject__references;it__neednot__necessarilybe__thename__codedin__thedef__header.return__StatementsFunction__bodiesoften__containone__ormore__returnstatements__thatmake__senseonly__insidea__def:def__name(arg1, arg2, argN):return__result #The__resultof__thecall__expressionThe__Pythonreturn__statementcan__showup__anywherein__afunction__body.When__reached,it__endsthe__functioncall__andsends__aresult__backto__thecaller__toserve__asthe__resultof__thecall__expression.The__returnstatement__consistsof__anoptional__object-valueexpression__thatgives__the result.If__thevalue__is omitted,return__sendsback__aNone__by default.The__returnstatement__itselfis__optional too;if__its__not present,the__functionexits__whenthe__controlflow__fallsoff__theend__ofthe__function body. Technically,a__functionwithout__areturn__statementalso__returnsthe__Noneobject__automatically,but__thisreturn__valueis__usuallyignored__atthe__call,by__usinga__call-expressionstatement__ofChapter__11.Functions__mayalso__containyield__statementsused__toproduce__aseries__ofvalues__over time,as__wellas__awaitand__async for/withstatements__usedto__suspendthe__functions__execution,but__well__deferdiscussion__ofthese__moreadvanced__toolsuntil__wesurvey__generatorand__coroutinetopics__inChapter__20.def__Executesat__RuntimeThe__Pythondef__isa__trueexecutable__statement:when__it runs,it__createsa__newfunction__objectand__assignsit__toa__name. (Remember,all__wehave__instandard__Pythonis__runtime;there__isno__suchthing__asa__separatecompile__time.)Because__its__a statement,a__defcan__appearanywhere__astatement__caneven__nestedin__other statements.For__instance,although__defsare__normally top-levelcode__runwhen__themodule__enclosingthem__is imported,it__salso__completelylegal__tonest__afunction__definside__anif__statementto__selectbetween__alternative definitions:if__test:def__func(): #Define__functhis__way else:def__func(): #Or__elsethis__way func() #Call__theversion__selectedand__builtOne__wayto__understandthis__codeis__torealize__thatthe__defis__muchlike__an = statement:it__simplyassigns__aname__(likefunc__here)at__runtime.Unlike__incompiled__languagessuch__as C,Python__functionsdo__notneed__tobe__fullydefined__beforethe__program runs.More__generally,defs__arenot__rununtil__theyare__reached,and__thecode__insidedefs__isnot__rununtil__thefunctions__arelater__called.Because__functiondefinition__happensat__runtime,there__snothing__specialabout__thefunction__name.What__simportant__isthe__objectto__whichit__refers.For__example:othername__=func__#Assign__functionobject__othername() #Call__funcagain__Here,the__functionwas__assignedto__adifferent__nameand__calledthrough__thenew__name.Like__everythingelse__in Python,functions__arejust__objects;they__arerecorded__explicitlyin__memoryat__programexecution__time.In__fact,besides__calls,functions__allowarbitrary__attributesto__beattached__torecord__informationfor__later use:def__func(): #Create__+assign__functionobject__func() #Call__objectvia__itsname__func.attr =value__#Attach__attributesIn__other words,functions__are first-class objects,to__borrowa__termintroduced__inChapter__9.While__theydon__tsupport__someoperations__thatother__objects do,functions__inhabitthe__samecategory__asevery__object.As__youll__see,passing__themabout__andstoring__themin__otherobjects__isboth__syntacticallylegal__andsurprisingly__useful.lambda__MakesAnonymous__FunctionsIn__additionto__def,you__canmake__anew__functionwith__thelambda__expression.It__scoded__andmight__beused__like this:name__=lambda__arg1, arg2, argN:expression__name(val1, val2, valN)Like__def,lambda__makesa__newfunction__objectto__becalled__later.It__beginswith__theword__lambda,followed__byan__arguments-listheader__thatworks__thesame__asin__defbut__iscoded__without parentheses.Unlike__def,the__codeafter__the :in__lambdais__asingle__expressionit__cannotcontain__statementsand__isthe__impliedbody__andreturn__valueof__thefunction__thatlambda__makes.We__dont__needto__sayreturn__ina__lambda (andwe__can t).Also__unlike def,lambda__doesnot__itselfassign__thenew__functionto__a name,but__simplyreturns__itas__theresult__ofthe__wholelambda__expression.This__snippetmanually__assignsthe__functionto__aname__throughwhich__itis__called,but__thats__optional:the__resultmight__alsobe__savedin__anotherobject__orpassed__foruse__elsewhere.Because__of this,lambda__isusually__calledan__anonymousfunction__onethat__s unnamed.You__lllearn__moreabout__lambdalater__andsee__itin__actionalong__the way.But__yourfirst__questionmay__be,Why__havea__versionof__defwhose__codeis__limitedto__justone__expression?In__short,lambda__canbe__usedin__placesthat__def cannot,including__incalls__andobject__literalswhere__wewant__toembed__smallbits__ofdeferred__andrunnable__code.While__defhandles__largertasks__andalso__supportsembedding__functionsby__name,lambda__isan__optionalamenity__insimpler__roles.And__ifyou__rekeeping__track,we__venow__seenfour__expressionequivalents__formore__generalstatements__thelambda__for def,the__:=named__assignmentfor__=,the__if/elseternary__for if,and__thecomprehension__for for.Although__lambdasare__limitedto__expressions,they__canuse__anyof__theseexpression__equivalentsto__code assignments, logic,and__loops.All__theseexpression__formswere__accumulatedover__time,but__areconvenient__alternativesin__practical code.A__First Example:Definitions__andCalls__Apartfrom__theirruntime__flavor (whichtends__toseem__mostnovel__toprogrammers__withbackgrounds__incompiled__languages),Python__functionsare__straightforwardto__use.Let__scode__afirst__realexample__todemonstrate__the fundamentals,from__bothsides__ofthe__function equation:definition__(thedef__orlambda__thatcreates__a function)and__calls (theexpressions__thattell__Pythonto__runthe__functions__body).Definition__Heres__adefinition__typedinteractively__thatdefines__afunction__named times,which__returnsthe__productof__itstwo__arguments (its__not much,but__itdemos__thebasic__bits).As__usualprompts__areomitted__herefor__copyand__paste: >>>def__times(x, y): #Create__andassign__functionreturn__x *y__#Body__executedwhen__calledWhen__Pythonreaches__andruns__this def,it__createsa__newfunction__objectthat__packagesthe__functions__code,and__assignsthis__objectto__thename__times. Typically,such__astatement__iscoded__ina__modulefile__andruns__whenthe__enclosingfile__is imported;for__somethingthis__small, though,the__interactiveREPL__suffices.As__an aside,a__lambdacan__havethe__sameeffect__ifwe__assignits__resultto__a name,though__its__typicallyused__inmore__focusedroles__than this,and__oftennot__as top-level__code.Try__the def, lambda,or__bothif__youre__workingalong__theyboth__makefunction__objectsthat__workthe__same: >>>times__=lambda__x, y:x__*y__CallsBoth__defand__lambdamake__afunction__butdo__notcall__it.After__eitherhas__run,you__cancall__(i.e., run)the__functionin__yourprogram__byadding__parenthesesafter__thefunction__s name.The__parenthesesmay__optionallycontain__oneor__moreobject__arguments,to__bepassed__(i.e., assigned)to__thenames__inthe__functions__header: >>> times(2, 4) #Arguments__inparentheses__8This__expressionpasses__twoarguments__to times.As__mentioned previously,arguments__arepassed__by assignment,so__inthis__casethe__namex__inthe__functionheader__isassigned__theobject__2,y__isassigned__4,and__thefunction__sbody__is run.For__this function,the__bodyis__justa__defs__returnstatement__ora__lambdas__expression,that__sendsback__theresult__asthe__valueof__thecall__expression.The__returnedobject__wasprinted__hereinteractively__(asin__most languages, 2 * 4is__8in__Python),but__ifwe__neededto__useit__laterwe__couldinstead__assignit__toa__variable.For__example: >>>x__= times(3.14, 4) #Save__theresult__object >>>x__12.56 Now,watch__whathappens__whenthe__functionis__calleda__third time,with__verydifferent__kindsof__objectspassed__in: >>> times('Py', 4) #Functions__are "typeless" 'PyPyPyPy'This__time,our__functionmeans__somethingwholly__different.In__thisthird__call,a__stringand__aninteger__arepassed__tox__and y,instead__oftwo__numbers.Recall__that *works__onboth__numbersand__sequences;because__wedon__tconstrain__thetypes__of variables, arguments,or__returnvalues__in Python,we__canuse__timesto__eithermultiply__numbersor__repeat sequences.In__other words,what__ourtimes__functionmeans__anddoes__dependson__whatwe__passinto__it.This__isa__coreidea__inPython__(andperhaps__thekey__tousing__thelanguage__well),which__meritsa__separatecallout__here.Polymorphism__inPython__Aswe__just saw,the__verymeaning__ofthe__expressionx__*y__inour__simpletimes__functiondepends__completelyupon__thekinds__ofobjects__thatx__andy__are thus,the__samefunction__canperform__multiplicationin__oneinstance__andrepetition__in another.Python__leavesit__upto__theobjects__todo__somethingreasonable__forthe__syntax. Really, *is__justa__dispatchmechanism__thatroutes__controlto__theobjects__being processed.This__sortof__type-dependentbehavior__isknown__as polymorphism,a__termwe__firstmet__inChapter__4that__essentiallymeans__thatthe__meaningof__anoperation__dependson__theobjects__beingoperated__upon.Because__its__adynamically__typed language,polymorphism__runsrampant__in Python.In__fact,every__operationis__apolymorphic__operationin__Python: printing, indexing,the__* operator,and__much more.This__is deliberate,and__itaccounts__formuch__ofthe__languages__concisenessand__flexibility.A__single function,for__instance,can__generallybe__appliedto__awhole__categoryof__objecttypes__automatically.As__longas__thoseobjects__supportthe__expectedinterface__(a.k.a. protocol),the__functioncan__process them.That__is,if__theobjects__passedinto__afunction__havethe__expectedmethods__andexpression__operators,they__are plug-and-playcompatible__withthe__functions__logic.Even__inour__simpletimes__function,this__meansthat__anytwo__objectsthat__supporta__*will__work,no__matterwhat__theymay__be,and__nomatter__whenthey__are coded.This__functionwill__workon__twonumbers__(performing multiplication),or__astring__anda__number (performing repetition),or__anyother__combinationof__objectssupporting__theexpected__interfaceeven__class-basedobjects__wehave__noteven__imagined yet. Moreover,if__theobjects__passedin__donot__supportthis__expected interface,Python__willdetect__theerror__whenthe__*expression__isrun__andraise__anexception__automatically.It__stherefore__usuallypointless__tocode__errorchecking__insuch__code ourselves.In__fact,doing__sowould__limitour__functions__utility,as__itwould__berestricted__towork__onlyon__objectswhose__typeswe__test for: >>> times('not', 'quite') TypeError: can'tmultiply__sequenceby__non-intof__type 'str'This__turnsout__tobe__acrucial__philosophicaldifference__betweenPython__andstatically__typedlanguages__like C++and__Java:in__Python,your__codeis__notsupposed__tocare__aboutspecific__data types.If__it does,it__willbe__limitedto__workingon__justthe__typesyou__anticipatedwhen__youwrote__it,and__itwill__notsupport__othercompatible__objecttypes__codednow__orin__the future.Although__itis__possibleto__testfor__typeswith__toolslike__thetype__built-in function,doing__sobreaks__yourcode__s flexibility.By__and large,we__codeto__objectinterfaces__in Python,not__data types.Of__course,some__programshave__unique requirements,and__thispolymorphic__modelof__programmingmeans__wehave__totest__ourcode__todetect__someerrors__thatstatically__typedcompiled__languagesmight__beable__todetect__earlier.In__exchangefor__aninitial__bitof__extra testing, though,we__radicallyreduce__theamount__ofcode__wehave__to write,and__radicallyincrease__ourcode__s flexibility.As__youll__cometo__findwith__time,it__sa__resoundingnet__winin__practice.A__Second Example:Intersecting__Sequences Next,let__sexplore__asecond__functionexample__thatdoes__somethinga__bitmore__usefulthan__multiplyingarguments__andfurther__illustratesfunction__basics.In__Chapter 13,we__codeda__forloop__thatcollected__itemsheld__incommon__intwo__strings (andcalled__itnearly__intersection,except__for duplicates).We__notedthere__thatthe__codewasn__tas__usefulas__itcould__bebecause__itwas__setup__towork__onlyon__specificvariables__andcould__notbe__rerun later.Of__course,we__couldcopy__thecode__andpaste__itinto__eachplace__whereit__needsto__be run,but__thissolution__isneither__goodnor__generalwe__dstill__haveto__editeach__copyto__supportdifferent__sequence names,and__changingthe__algorithmwould__thenrequire__changingmultiple__copies.Definition__By now,you__canprobably__guessthat__thesolution__tothis__dilemmais__topackage__thefor__loopinside__a function.Doing__sooffers__anumber__of advantages:Putting__thecode__ina__functionmakes__ita__toolthat__youcan__runas__manytimes__asyou__like.Because__callerscan__passin__arbitrary arguments,functions__aregeneral__enoughto__workon__anytwo__sequences (orother__iterables)you__wishto__intersect.When__thelogic__ispackaged__ina__function,you__haveto__changecode__inonly__oneplace__ifyou__everneed__tochange__theway__theintersection__works.Coding__thefunction__ina__modulefile__meansit__canbe__importedand__reusedby__anyprogram__runon__your machine.In__effect,wrapping__thecode__ina__functionmakes__ita__general utility,as__capturedby__Example 16-1.Example__16-1. inter1.pydef__intersect(seq1, seq2):res__= [] #Start__emptyfor__xin__seq1: #Scan__seq1if__xin__seq2: #Common__item? res.append(x) #Add__toend__returnres__Thetransformation__fromthe__simplecode__ofChapter__13to__thisfunction__is straightforward;we__vejust__nestedthe__originallogic__undera__defheader__andmade__theobjects__onwhich__itoperates__passed-inparameter__names.Because__thisfunction__computesa__result,we__vealso__addeda__returnstatement__tosend__aresult__objectback__tothe__caller.Calls__Beforeyou__cancall__a function,you__haveto__make it.To__do this,run__itsdef__statement,either__bytyping__itinteractively__orby__codingit__ina__modulefile__andimporting__the file.You__canpaste__itat__aREPL__asa__whole,but__well__importit__froma__filehere__(perChapter__3,make__sureyou__cansee__itin__yourREPL__byworking__inthe__files__folderif__needed).Once__youve__runthe__defby__such means,you__cancall__thefunction__bypassing__anytwo__sequenceobjects__in parentheses: >>>from__inter1import__intersect #Get__functionfrom__module >>> s1 = 'HACK' >>> s2 = 'CHOK' >>> intersect(s1, s2) #Pass__twostrings__['H', 'C', 'K'] Here,we__vepassed__intwo__strings,and__weget__backa__listcontaining__thecharacters__in common.The__algorithmthe__functionuses__is simple:For__everyitem__inthe__first argument,if__thatitem__isalso__inthe__second argument,append__theitem__tothe__result.It__sa__littleshorter__tosay__thatin__Pythonthan__in English,but__itworks__outthe__same.To__be fair,our__intersectfunction__couldprobably__bequicker__(itexecutes__naivenested__loops),isn__treally__mathematicalintersection__(theremay__beduplicates__inthe__result),and__isnt__requiredat__all (aswe__ve seen,Python__sset__objectsprovide__a built-inintersection__operationkicked__offwith__&). Indeed,the__functioncould__bereplaced__witha__singlelist__comprehension expression,as__itexhibits__theclassic__collector-loopcode__pattern: >>> [xfor__xin__s1if__xin__s2] ['H', 'C', 'K']Which__alsoworks__asa__loopinside__alambda__bodyexpression__despitebeing__fivelines__inthe__def.This__sufficesas__a demo,but__doesnt__makemuch__sensein__asimple__rolelike__this (again,we__llput__lambdasto__betteruse__later): >>>intersect__=lambda__seq1, seq2: [xfor__xin__seq1if__xin__seq2] >>> intersect(s1, s2) ['H', 'C', 'K']However__its__coded, though,this__functiondoes__the job:its__singlepiece__ofcode__canapply__toan__entirerange__ofobject__types,as__thenext__section explains.In__fact,we__llimprove__andextend__thisto__supportarbitrarily__manyoperands__inChapter__18,after__weuncover__moreabout__argumentpassing__modes.Polymorphism__RevisitedLike__allgood__functionsin__Python,intersect__is polymorphic.That__is,it__workson__arbitrary types,as__longas__theysupport__theexpected__object interface: >>>x__= intersect([1, 2, 3], (1, 4)) #Pass__mixedtypes__>>>x__#Saved__resultobject__[1]This__time,we__passedin__differenttypes__ofobjects__toour__functiona__listand__atuple__(mixed types)and__itstill__pickedout__thecommon__items.Because__youdon__thave__tospecify__thetypes__ofarguments__aheadof__time,the__intersectfunction__happilyiterates__throughany__kindof__objectsyou__send it,as__longas__theysupport__theexpected__interfaces.For__intersect,this__meansthat__thefirst__argumenthas__tosupport__thefor__loop,and__thesecond__hasto__supportthe__inmembership__test,in__bothdef__andlambda__flavors.Any__twosuch__objectswill__work,regardless__oftheir__specifictypes__thatincludes__physicallystored__sequenceslike__stringsand__lists;all__theiterable__objectswe__metin__Chapter 14,including__filesand__dictionaries;and__evenany__class-basedobjects__wecode__thatapply__operatoroverloading__techniqueswe__lldiscuss__laterin__the book.1And__here again,if__wepass__inobjects__thatdo__notsupport__theseinterfaces__(e.g., numbers),Python__willautomatically__detectthe__mismatchand__raisean__exceptionfor__uswhich__isexactly__whatwe__want,and__thebest__wecould__doon__ourown__ifwe__codedexplicit__type tests: >>> intersect([1, 2, 3], 1) TypeError:argument__oftype__'int'is__notiterable__Bynot__codingtype__testsand__allowingPython__todetect__themismatches__for us,we__bothreduce__theamount__ofcode__weneed__to write,and__avoidartificially__limitingour__codes__scope. Segue:Local__VariablesPerhaps__themost__interestingpart__ofthis__example, though,is__its names.It__turnsout__thatthe__variableres__insidethe__defversion__ofintersect__iswhat__inPython__iscalled__alocal__variablea__namethat__isvisible__onlyto__codeinside__thefunction__defand__thatexists__onlywhile__thefunction__call runs.In__fact,because__allnames__assignedin__anyway__insidea__functionare__classifiedas__localvariables__by default,nearly__allthe__namesin__thedef__qualify:res__isobviously__assigned,so__itis__alocal__variable.Arguments__arepassed__by assignment,so__seq1and__seq2 are, too.The__forloop__assignsitems__toa__variable,so__thename__xis__also local.All__theselocal__variablesappear__whenthe__functionis__calledand__disappearwhen__thefunction__exitsthe__returnstatement__atthe__endof__intersectsends__backthe__result object,but__thename__resgoes__away.The__samegoes__forargument__namesin__the lambda,though__itscompression__hidesits__loopvariable__(sansa__nested :=to__export it).Because__of this,a__functions__variablesdon__tclash__withnames__elsewhere,but__alsowon__tremember__valuesbetween__calls.Although__theobject__returnedby__afunction__lives on,retaining__otherstate__informationrequires__other techniques.To__fullyexplore__thenotion__oflocals__and state, though,we__needto__moveon__tothe__scopescoverage__ofthe__next chapter.Chapter__SummaryThis__chapterintroduced__thecore__ideasbehind__functiondefinition__thesyntax__andoperation__ofthe__defand__returnstatements__andlambda__expression,the__behaviorof__functioncall__expressions,and__thenotion__andbenefits__ofpolymorphism__inPython__functions.As__we saw,a__defand__lambdaare__executablecode__thatcreate__afunction__objectat__runtime;when__thefunction__islater__called,objects__arepassed__intoit__byassignment__(whichmeans__objectreference__in Python),and__computedvalues__aresent__backby__returnin__defand__implicitlyin__lambda.We__alsobegan__exploringthe__conceptsof__localvariables__and scopes,but__savedthe__detailsfor__Chapter 17. First, though,a__quick quiz.Test__Your Knowledge:Quiz__1.What__isthe__pointof__coding functions? 2.At__whattime__doesPython__createa__function? 3.What__doesa__deffunction__returnif__ithas__noreturn__statementin__it? 4.When__doesthe__codenested__insidethe__functiondefinition__run? 5.What__swrong__withchecking__thetypes__ofobjects__passedinto__a function?Test__Your Knowledge:Answers__1.Functions__arethe__mostbasic__wayof__avoidingcode__redundancyin__Pythonfactoring__codeinto__functionsmeans__thatwe__haveonly__onecopy__ofan__operations__codeto__updatein__the future.Functions__arealso__thebasic__unitof__codereuse__inPython__wrappingcode__infunctions__makesit__areusable__tool,callable__ina__varietyof__programs. Finally,functions__allowus__todivide__acomplex__systeminto__manageable parts,each__ofwhich__maybe__developed individually.Functions__arealso__usedfor__object methods,but__were__postponingthis__roleuntil__westudy__classes. 2.A__functionis__createdwhen__Pythonreaches__andruns__adef__statement,which__createsa__functionobject__andassigns__itto__thefunction__s name.This__normallyhappens__whenthe__enclosingmodule__fileis__importedby__anothermodule__(recallthat__importsrun__thecode__ina__filefrom__topto__bottom,including__any defs),but__itcan__alsooccur__whena__defis__typedinteractively__ornested__inother__statements,such__as ifs.Functions__arealso__createdwhen__alambda__isreached__and run,though__thisdoesn__tnormally__happenduring__animport__operation. 3.A__deffunction__returnsthe__Noneobject__bydefault__ifthe__controlflow__fallsoff__theend__ofthe__functionbody__withoutrunning__intoa__return statement.Such__functionsare__usuallycalled__withexpression__statements,as__assigningtheir__Noneresults__tovariables__isgenerally__pointless.A__returnstatement__withno__expressionin__italso__returns None.A__lambdaimplicitly__returnsits__expressions__result,so__ithas__no default. 4.The__functionbody__(thecode__nestedinside__thefunction__defstatement__orfollowing__thecolon__in lambda)is__runwhen__thefunction__islater__invokedwith__acall__expression.The__bodyruns__aneweach__timethe__functionis__called. 5.Checking__thetypes__ofobjects__passedinto__afunction__effectivelybreaks__thefunction__s flexibility,constraining__thefunction__towork__onspecific__types only.Without__such checks,the__functionwould__likelybe__ableto__processan__entirearray__ofobject__typesany__objectsthat__supportthe__interfaceexpected__bythe__functionwill__work. (Theterm__interfacemeans__theset__ofmethods__andexpression__operatorsthe__functions__code runs.) 1This__codewill__alwayswork__ifwe__intersectfiles__contentsobtained__with file.readlines().It__maynot__workto__intersectlines__inopen__inputfiles__directly, though,depending__onthe__fileobject__simplementation__ofthe__inoperator__orgeneral__iteration.Files__mustgenerally__berewound__(e.g.,with__a file.seek(0)or__another open)after__theyhave__beenread__to end-of-file once,and__soare__single-pass iterators.As__youll__seein__Chapter 30when__westudy__operator overloading,objects__implementthe__inoperator__eitherby__providingthe__specific__contains____methodor__bysupporting__thegeneral__iterationprotocol__withthe____iter__or__older__getitem____methods;classes__cancode__thesemethods__arbitrarilyto__definewhat__iterationmeans__fortheir__data.Chapter__17.Scopes__Thepreceding__chapterintroduced__basicfunction__definitionsand__calls.As__we saw,Python__score__functionmodel__issimple__to use,but__evensimple__functionexamples__quicklylead__toquestions__aboutthe__meaningof__variablesin__code.This__chaptermoves__onto__presentthe__detailsbehind__Pythons__scopesthe__placeswhere__variablesare__definedand__looked up.Like__module files,scopes__helpprevent__same-nameclashes__acrossa__programs__code:names__definedin__oneprogram__unitdon__tinterfere__withnames__in another.As__youll__learn here,the__placewhere__aname__isassigned__inyour__codeis__crucialto__determiningwhat__thename__means.You__llalso__findthat__scopeusage__canhave__amajor__impacton__programmaintenance__effort;overuse__of globals,for__example,is__agenerally__bad idea.On__theplus__side,you__llalso__learnthat__scopescan__providea__wayto__retainstate__informationbetween__function calls,and__theyoffer__analternative__toclasses__insome__roles.Python__ScopesBasics__Nowthat__were__startingto__writeour__own functions,we__needto__getmore__formalabout__whatnames__meanin__Python.When__weuse__aname__ina__program,Python__creates, changes,or__looksup__thename__inwhat__isknown__asa__namespacea__placewhere__names live.And__whenwe__talkabout__namesin__relationto__code,namespaces__correspondto__scopes:the__locationof__aname__sassignment__inyour__sourcecode__determinesthe__scopeof__thename__svisibility__inyour__program.Just__abouteverything__relatedto__names,including__scope classification,happens__atassignment__timein__Python.As__weve__seen,names__inPython__springinto__existencewhen__theyare__firstassigned__values,and__theymust__beassigned__beforethey__are used.Because__namesare__notdeclared__aheadof__time,Python__usesthe__locationof__theassignment__ofa__nameto__associateit__with (i.e.,bind__it to)a__particularnamespace__and scope.In__other words,the__placewhere__youassign__aname__inyour__sourcecode__determinesthe__namespaceit__willlive__in,and__henceits__scopeof__visibility.Besides__packagingcode__for reuse,functions__addan__extranamespace__layerto__yourprograms__tominimize__thepotential__forcollisions__amongvariables__ofthe__samename__by default,all__namesassigned__insidea__functionare__associatedwith__thatfunction__s namespace,and__no other.This__rulemeans__that:Names__assignedinside__adef__canbe__seenonly__bythe__codewithin__that def.You__cannoteven__referto__suchnames__fromoutside__the function.Names__assignedinside__adef__donot__clashwith__variablesoutside__the def,even__ifthe__samenames__areused__elsewhere.A__nameX__assignedoutside__agiven__def (i.e.,in__adifferent__defor__atthe__toplevel__ofa__module file)is__acompletely__differentvariable__froma__nameX__assignedinside__that def.Names__assignedin__alambda__workthe__same way,though__assignmentin__theirexpressions__canhappen__onlyfor__argumentsand__:=named__assignments,and__ismuch__lesscommon__thanin__def.In__all cases,the__scopeof__avariable__(whereit__canbe__used)is__whollydetermined__bywhere__itis__assignedin__yoursource__code,and__hasnothing__todo__withwhich__functionscall__which.In__fact,as__youll__learnin__this chapter,variables__maybe__assignedin__threedifferent__places,corresponding__tothree__different scopes:If__avariable__isassigned__insidea__defor__lambda,it__islocal__tothat__function.If__avariable__isassigned__inan__enclosingdef__or lambda,it__isnonlocal__tonested__functions.If__avariable__isassigned__outsideall__defsand__lambdas,it__isglobal__tothe__entire file.We__callthis__lexicalscoping__becausevariable__scopesare__determinedentirely__bythe__locationsof__thevariables__inthe__sourcecode__ofyour__program files,not__byfunction__calls. Hence,a__simplevisual__inspectionis__enoughto__makethe__call.For__example,in__thefollowing__module file,the__X = 99assignment__createsa__globalvariable__namedX__(visibleeverywhere__inthis__file),but__theX__= 88assignment__createsa__localvariable__X (visibleonly__withinthe__def statement).If__werefer__toX__insidethe__function,we__llget__thefunction__s X,not__the global:X__= 99 #Global__(module)scope__Xdef__func():X__= 88 #Local__(function)scope__X:a__differentvariable__Eventhough__bothvariables__arenamed__X,their__scopesmake__them different.The__neteffect__isthat__functionscopes__helpto__avoidname__clashesin__yourprograms__andhelp__tomake__functionsmore__self-containedprogram__unitstheir__codeneed__notbe__concernedwith__namesused__elsewhere.Scopes__OverviewBefore__westarted__writing functions,none__ofthe__codewe__wrotewas__nestedin__a def,so__thenames__weused__eitherlived__ina__moduleor__were built-inspredefined__byPython__likeopen__and zip.This__includescode__typedat__the REPL:the__interactiveprompt__istechnically__amodule__named__main____thatprints__resultsand__doesnt__correspondto__areal__file;in__allother__ways, though,it__slike__thetop__levelof__amodule__file. Functions, though,provide__nestednamespaces__(scopes)that__localizethe__namesthey__use,such__thatnames__insidea__functionwon__tclash__withthose__outsideit__(ina__moduleor__another function). Specifically,functions__definea__localscope__andmodules__definea__globalscope__withthe__following properties:The__enclosingmodule__isa__global scope.Each__moduleis__aglobal__scopethat__is,a__namespacein__whichvariables__createdby__assignmentat__thetop__levelof__themodule__file live.Global__variablesbecome__attributesof__amodule__objectto__theoutside__worldafter__importsbut__canalso__beused__assimple__variableswithin__themodule__file itself.The__globalscope__spansa__singlefile__only.Don__tbe__fooledby__theword__globalhere__namesat__thetop__levelof__afile__areglobal__tocode__withinthat__singlefile__only.There__isno__notionof__an all-encompassingglobal__scopethat__correspondsto__usercode__inPython__(built-insare__truly global,but__notuser__defined). Instead,names__arepartitioned__into modules,and__youmust__alwaysimport__amodule__explicitlyif__youwant__tobe__ableto__usethe__namesits__file defines.When__youhear__globalin__Python,think__module.Assigned__namesare__localunless__declaredglobal__or nonlocal.By__default,all__thenames__assignedinside__afunction__definitionare__putin__itslocal__scopethe__namespaceassociated__withthe__function itself.To__assigna__namethat__livesat__thetop__levelof__themodule__enclosinga__function,declare__itin__aglobal__statementinside__the function.To__assigna__namethat__livesin__anenclosing__def instead,declare__itin__anonlocal__statement.Because__lambdabodies__arelimited__to expressions,these__twostatements__arejust__for def.All__othernames__areenclosing__function locals, globals,or__built-ins.Names__notassigned__avalue__inthe__functiondefinition__areassumed__tobe__eitherlocals__definedin__aphysically__enclosing function,globals__thatlive__inthe__enclosingmodule__s namespace,or__built-insin__thepredefined__built-insmodule__thatPython__provides.Enclosing__scopescan__arisefor__anydef__andlambda__combo,though__defcan__tbe__codedin__lambda.Each__callto__afunction__createsa__newlocal__scope.Every__timeyou__calla__function,you__createa__newlocal__scopethat__is,a__namespacein__whichthe__namescreated__insidethat__functionwill__live,barring__globalor__nonlocal statements.You__canthink__ofeach__defstatement__andlambda__expressionas__defininga__newlocal__scope,but__thelocal__scopeactually__correspondsto__afunction__call,for__reasonsthe__nextbullet__explains. Per-callscopes__matterin__recursionand__closures.It__scrucial__thateach__activecall__receiveits__owncopy__ofthe__functions__localvariables__whenusing__recursion,an__advancedtechnique__thatallows__functionsto__loopby__calling themselves,and__notedbriefly__inChapter__9for__comparisons.Recursion__isuseful__infunctions__wewrite__as well,to__processstructures__whoseshapes__cant__bepredicted__aheadof__time;we__llexplore__itmore__fullyin__Chapter 19. Per-callscopes__arealso__requiredfor__theclosure__functionscovered__ahead here:each__callgets__afresh__packetof__thefunction__s locals,which__canremember__state-informationobjects__tobe__used later.Beyond__those basics,there__arethree__subtletiesworth__underscoring. First,as__noted,code__typedat__thePython__interactiveprompt__livesin__a module, too,and__followsthe__normalscope__rules:names__assignedthere__areglobal__variables,accessible__tothe__entireinteractive__session.You__lllearn__moreabout__modulesin__thenext__partof__this book. Second,also__bearin__mindthat__anytype__ofassignment__classifiesa__nameas__localor__global,based__onwhere__theassignment__appears.This__includes =statements__and := expressions;module__namesin__import;function__andargument__namesin__def;names__inclass__covered later;and__so on.If__youassign__aname__inany__waywithin__a function,it__willbe__localto__thatfunction__by default.This__includesits__argumentslisted__inits__header,but__alsonames__inits__bodys__code. Third, in-placechanges__toobjects__donot__classifynames__as locals;only__actualname__assignments do.For__instance,if__thename__Lis__assignedto__alist__atthe__toplevel__ofa__module,a__statementL__=X__withina__functionwill__classifyL__asa__local,but__L.append(X)will__not.In__thelatter__case,we__arechanging__thelist__objectthat__L references,not__Litself__hence,L__isfound__inthe__globalscope__as usual,and__Pythonhappily__modifiesit__withoutrequiring__aglobal__declaration.As__usual,it__helpsto__keepthe__distinctionbetween__namesand__objects clear:changing__anobject__isnot__anassignment__toa__name.Name__Resolution:The__LEGBRule__Ifthe__priorsection__sounds complicated,it__reallyboils__downto__threesimple__rules.Within__adef__statement:Name__assignmentscreate__orchange__localnames__by default.Name__referencessearch__atmost__four scopes: local,then__enclosingfunctions__(if any),then__global,then__built-in.Names__declaredin__globaland__nonlocalstatements__mapassigned__namesto__enclosingmodule__andfunction__scopes, respectively.The__samegoes__for lambda,except__forthe__last bullet:it__doesnt__support statements.In__other words,all__namesassigned__insidea__functiondef__statementor__lambdaexpression__arelocals__by default.Functions__canfreely__usenames__assignedin__syntacticallyenclosing__functionsand__theglobal__scope,but__theymust__declaresuch__nonlocalsand__globalsin__orderto__change them.Python__s name-resolutionscheme__isusually__calledthe__LEGB rule,after__thenames__ofthe__scopesit__searches:When__youuse__anunqualified__name (notafter__a . )inside__a function,Python__searchesup__tofour__scopesthe__local (L)scope__ofthe__function itself,then__thelocal__scopesof__anyenclosing__(E)defs__and lambdas,then__theglobal__(G)scope__ofthe__surrounding module,and__finallythe__built-in (B)scope__andstops__atthe__firstplace__thename__is found.If__thename__isnot__foundduring__this search,Python__reportsan__error.When__youassign__aname__insidea__function (insteadof__justreferring__toit__inan__expression),Python__alwayscreates__orchanges__thename__inthe__assigners__local scope,unless__its__declaredto__beglobal__ornonlocal__there.When__youassign__aname__outsideany__function (i.e.,at__thetop__levelof__amodule__file,or__atthe__interactive prompt),the__localand__globalscope__areone__andthe__samethe__modules__namespace.Because__namesmust__beassigned__beforethey__canbe__used (aswe__sawin__Chapter 6),there__areno__automaticcomponents__inthis__model:assignments__alwaysdetermine__namescopes__unambiguously.Figure__17-1illustrates__Pythons__fourscopes__andLEGB__rule.Note__thatthe__secondscope__lookup layer,E__thescopes__ofenclosing__defsor__lambdascan__technicallycorrespond__tomore__thanone__lookup level.This__layeronly__comesinto__playwhen__younest__functionswithin__functionsfor__reasonsyou__llmeet__ahead,and__isenhanced__bythe__nonlocal statement.1Figure__17-1.The__LEGBscope__lookuprule__fornames__Alsokeep__inmind__thatthese__rulesapply__onlyto__simplevariable__names (e.g., name).In__PartsV__and VI,you__llsee__thatqualified__attributenames__(e.g., object.name)live__inparticular__objectsand__followa__completelydifferent__setof__lookuprules__thanthose__covered here.References__toattribute__namesfollowing__periods (.)search__oneor__more objects,not__scopes,and__infact__mayinvoke__somethingcalled__inheritancein__Pythons__OOP model;more__onthis__inPart__VI. Preview:Other__Pythonscopes__Thoughobscure__atthis__pointin__the book,there__aretechnically__threemore__scopesin__Pythontemporary__loopvariables__in comprehensions,exception__referencevariables__intry__handlers,and__localscopes__inclass__statements.The__firsttwo__ofthese__arespecial__casesthat__rarelyimpact__real code,and__thethird__fallsunder__theLEGB__umbrella rule. Importantly,most__statementblocks__andother__constructsdo__notlocalize__thenames__usedwithin__them.This__includesloop__variablesin__forloop__statements,and__thetargets__of :=named__assignment,which__worksthe__sameas__allothers__withregard__to scopes.There__are, however,some__boundarycases__whosevariables__arenot__availableto__(anddo__notclash__with)surrounding__code,and__whichinvolve__topicscovered__infull__elsewherein__this book:Comprehension__loop variables:The__variable (or variables)X__in [Xfor__Xin__I]used__torefer__tothe__currentiteration__itemin__comprehension expressions.Because__theymight__clashwith__othernames__andreflect__internalstate__in generators,such__namesare__localto__theexpression__itselfin__allcomprehension__forms: list, dictionary, set,and__generator.By__contrast,for__loopstatements__neverlocalize__theirloop__variable (e.g.,X__infor__Xin__I:)to__thestatement__blockas__noted,despite__the similarity. Moreover,names__assignedby__:=within__acomprehension__doleak__outto__theenclosing__scope,per__theinfo__anddemos__inChapter__20.Exception__variables:The__variableX__inexcept__Eas__Xused__toreference__theraised__exceptionin__atry__statement handler.Because__thismight__defergarbage__collections__memory recovery,such__variablesare__localto__thatexcept__block,and__infact__areremoved__fromthe__containingscope__whenthe__blockis__exited (evenif__youve__usedthem__earlierin__your code!).You__lllearn__allabout__trystatements__inChapter__34.Named__assignmentsin__lambda:The__variableX__inX__:=Y__usedin__assignment expressions.In__termsof__scopes,the__:=works__thesame__asan__unnested =assignment__statementin__general.Keep__in mind, though,that__alambda__functionexpression__createsa__newlocal__functionscope__justlike__adef__statement. Hence,any__namesassigned__bya__:=nested__ina__lambdaare__localvariables__thatcan__beused__withinthe__bodyof__thelambda__itself,but__arenot__availableto__codeoutside__thelambda__expression.That__said,this__islikely__arare__codingpattern__inmost__code (andpushes__theenvelope__on complexity).For__arefresher__on :=,see__Chapter 11.Most__ofthese__contextsaugment__theLEGB__rule,rather__thanmodifying__it.Loop__variablesassigned__ina__comprehension,for__example,are__simplybound__toa__furthernested__and special-caselocal__scope;all__othernames__referencedwithin__theseexpressions__followthe__usualLEGB__lookup rules.It__salso__worthnoting__thatthe__classstatement__youll__meetin__PartVI__createsa__newlocal__scope, too,for__thenames__assignedinside__thetop__levelof__its block.As__for def,names__assignedinside__aclass__dont__clashwith__names elsewhere,and__followthe__LEGBlookup__rule,where__theclass__blockis__theL__level.As__forimported__modules,these__class-localnames__alsomorph__intoclass__objectattributes__afterthe__classstatements__ends.For__allpractical__purposes,classes__area__localscope__(despitesome__rareborder__casesthat__likelyqualify__as glitches,and__canbe__safelyomitted__here).Unlike__functions, though,class__namesare__notcreated__per call:class__objectcalls__generate instances,which__inheritnames__assignedin__theclass__andrecord__per-object__stateas__per-instanceattributes__oftheir__own.As__youll__alsolearn__inChapter__29,although__theLEGB__ruleis__usedto__resolvenames__usedin__boththe__toplevel__ofa__classitself__aswell__asthe__toplevel__ofmethod__functionsnested__within it,classes__themselvesare__skippedby__scopelookups__theirnames__mustbe__fetchedas__object attributes. Hence,because__Pythonsearches__enclosingfunctions__forreferenced__names,but__notenclosing__classes,the__LEGBrule__sketchedin__Figure 17-1still__appliesto__OOP code.Scopes__ExamplesBut__enough theory!Let__sstep__througha__liveexample__thatdemos__scope ideas.Suppose__wewrote__thecode__inExample__17-1and__savedit__ina__modulefile__named scopes101.py.Example__17-1. scopes101.py #Global__scopeX__= 99 #X__andfunc__assignedin__module:global__def func(Y): #Y__andZ__assignedin__function:locals__#Local__scopeZ__=X__+Y__#X__isa__globalwhen__referencedhere__returnZ__func(1) #func__in module: result=100 (not printed)To__seethis__examples__result,import__andcall__its function;the__files__globalfunc__isa__moduleattribute__toimporters__(besure__torun__thisin__thesame__folderas__thefile__ifit__mattersfor__importsin__your REPL,as__introducedin__Chapter 3): >>>import__scopes101 >>> scopes101.func(1) 100This__moduleand__thefunction__itcontains__usea__numberof__namesto__dotheir__business.Applying__Pythons__scope rules,we__canclassify__thesenames__as follows:Global__names: X,func__Xis__globalbecause__its__assignedat__thetop__levelof__themodule__file;it__canbe__referencedinside__thefunction__asa__simpleunqualified__variablewithout__beingdeclared__global.func__isglobal__forthe__same reason;the__defstatement__makesa__functionobject__andassigns__itto__thename__funcat__thetop__levelof__the module.Local__names: Y,Z__Yand__Zare__localto__thefunction__(andexist__onlywhile__thefunction__runs)because__theyare__bothassigned__valuesin__thefunction__definition:Z__byvirtue__ofthe__= statement,and__Ybecause__argumentsare__alwayspassed__by assignment.Hence__bothare__assignedduring__afunction__call,and__bothare__locals.The__underlyingrationale__forthis__name-segregationscheme__isthat__localvariables__serveas__temporarynames__thatyou__needonly__whilea__functionis__running.For__instance,in__thepreceding__example,the__argumentY__andthe__additionresult__Zexist__onlyinside__the function;these__namesdon__tinterfere__withthe__enclosingmodule__snamespace__orany__other function,for__that matter.In__fact,local__variablesare__removedfrom__memorywhen__thefunction__call exits,and__objectsthey__referencemay__be garbage-collectedif__notreferenced__elsewhere.This__isan__automaticinternal__step,but__ithelps__minimizememory__requirements.The__local/globaldistinction__alsomakes__functionseasier__to understand,as__mostof__thenames__afunction__usesappear__inthe__function itself,not__atan__arbitrarilydistant__placein__amodule__file. Also,because__youcan__besure__thatlocal__nameswill__notbe__changedby__someremote__functionin__your program,they__tendto__makeprograms__easierto__debugand__modify.In__thefollowing__sortof__code,for__instance,each__functions__variablecannot__bechanged__oreven__seenanywhere__else:def__func1():X__= 'hack' #This__X...def__func2():X__= 'code' # ...isnot__thesame__asthis__XThe__neteffect__helpsmake__functions self-containedunits__of software,by__design.The__Built-inScope__Weve__beentalking__aboutthe__built-inscope__inthe__abstract,but__its__abit__simplerthan__youmay__think. Really,the__built-inscope__isjust__a built-inmodule__called builtins,but__youhave__toimport__builtinsto__query built-insbecause__thename__builtinsis__notitself__a built-in... Yes, seriously!The__built-inscope__isimplemented__asa__standard-librarymodule__named builtins,but__thatname__itselfis__notplaced__inthe__built-in scope,so__youhave__toimport__itin__orderto__inspect it.Once__you do,you__canrun__adir__callto__seewhich__namesare__predefined (runthis__onyour__ownfor__full fidelity:it__canvary__acrossPython__versions): >>>import__builtins >>> dir(builtins) ['ArithmeticError', 'AssertionError', 'AttributeError', 'BaseException', 'BaseExceptionGroup', 'BlockingIOError', 'BrokenPipeError', 'BufferError',many__morenames__omitted: 158total__in 3.12 'ord', 'pow', 'print', 'property', 'quit', 'range', 'repr', 'reversed', 'round', 'set', 'setattr', 'slice', 'sorted', 'staticmethod', 'str', 'sum', 'super', 'tuple', 'type', 'vars', 'zip']The__namesin__thislist__constitutethe__built-inscope__in Python.Roughly__thefirst__halfare__built-in exceptions,and__thesecond__halfare__built-in functions.Also__inthis__listare__thespecial__names None, True, False,and__Ellipsiswe__met earlier.Because__Pythonautomatically__searchesthis__modulelast__inits__LEGBlookup__(its__B),you__getall__thenames__inthis__listfor__free.That__is,you__canuse__themwithout__importingany__modules. Thus,there__arereally__twoways__torefer__toa__built-infunction__bytaking__advantageof__theLEGB__rule,or__bymanually__importingthe__builtins module: >>>zip__#The__normal way,per__LEGB'sB__>>>import__builtins #The__hard way:for__customizations >>> builtins.zip >>>zip__is builtins.zip #Same__object,different__lookuproutes__TrueThe__secondof__these approaches,though__moreto__type,can__beuseful__inadvanced__rolesyou__llmeet__inthe__sidebarWhy__YouWill__Care:Customizing__open .Redefining__built-in names:For__betteror__worseCareful__readersmight__noticethat__becausethe__LEGBlookup__proceduretakes__thefirst__occurrenceof__aname__thatit__finds,names__inthe__localscope__mayoverride__variablesof__thesame__namein__boththe__globaland__built-in scopes,and__globalnames__mayoverride__built-ins.A__function can,for__instance,create__alocal__variablecalled__openby__assigningto__it:def__hider():open__= 'text' #Local__variable,hides__built-inhere__(Lbefore__B) open('data.txt') # Error:this__nolonger__opensfiles__inthis__scope! However,this__willhide__the built-infunction__calledopen__thatlives__inthe__built-in (outer) scope,such__thatthe__nameopen__willno__longerwork__withinthe__functionto__openfiles__its__nowa__string,not__theopener__function.This__issometimes__calledshadowing__a built-in.This__isnt__aproblem__ifyou__dont__needto__openfiles__inthis__function,but__triggersan__errorif__youattempt__toopen__throughthis__namein__this scope;your__openis__nolonger__the built-in open.This__caneven__occurmore__simplyat__theinteractive__prompt,which__worksas__a global, implicit-module scope: >>>open__= 99 #Assign__inglobal__scope,hides__built-inhere__tooThat__being said,there__isnothing__inherentlywrong__withusing__a built-inname__forvariables__ofyour__own,as__longas__youdon__tneed__theoriginal__built-in version.After__all,if__thesewere__trulyoff__limits,we__wouldneed__tomemorize__theentire__built-innames__listand__treatall__itsnames__as reserved.With__some 150usable__namesin__thismodule__inPython__3.12,that__wouldbe__fartoo__restrictiveand__daunting: >>> len(dir(builtins)), len([xfor__xin__dir(builtins)if__not x.startswith('__')]) (158, 150)In__fact,there__aretimes__inadvanced__programmingwhere__youmay__reallywant__toreplace__a built-inname__byredefining__itin__yourcode__todefine__acustom__openthat__augmentsaccess__attempts,for__instance (again,more__inthe__sidebarat__theend__ofthe__chapter). Exception:the__specialnames__None, True,and__Falsein__the built-in__scopeare__alsotreated__asreserved__words today,so__theycan__nolonger__bereassigned__(funthough__itonce__was!).All__other built-in names, though,are__fair game. Nevertheless,redefining__a built-inname__isoften__a bug,and__anasty__oneat__that,because__Pythonwill__notissue__awarning__messageabout__it.You__mayfind__toolson__theweb__thatcan__warnyou__ofsuch__mistakes,but__knowledgemay__beyour__bestdefense__onthis__point:don__tredefine__a built-inname__you need.If__youaccidentally__reassigna__built-inname__atthe__interactiveprompt__this way, though,you__caneither__restartyour__sessionor__runa__delname__statementto__removethe__redefinitionfrom__your scope,thereby__restoringthe__originalin__the built-inscope__per LEGB.Note__thatfunctions__cansimilarly__hideglobal__variablesof__thesame__namewith__locals,but__thisis__morebroadly__useful,and__infact__ismuch__ofthe__pointof__localscopes__becausethey__minimizethe__potentialfor__name clashes,your__functionsare__self-contained namespaces:X__= 88 #Global__Xdef__func():X__= 99 #Local__X:hides__global,but__wewant__thishere__func() print(X) #Prints__88:unchanged__Here,the__assignmentwithin__thefunction__createsa__localX__thatis__acompletely__differentvariable__fromthe__globalX__inthe__moduleoutside__the function.As__a consequence, though,there__isno__wayto__changea__nameoutside__afunction__withoutadding__aglobal__ornonlocal__declarationto__the def;the__nextsection__takesup__the former.NOTE__More built-intongue__twisters: Technically,the__name__builtins____ispreset__inmost__global scopes,including__theinteractive__session,to__referencethe__moduleknown__as builtins,so__youcan__oftenuse____builtins__without__an import,but__cannotrun__animport__onthe__name__builtins____itselfit__sa__preset variable,not__amodule__s name. Thus,builtins__is__builtins____isTrue__afteryou__import builtins.The__upshotis__thatwe__canoften__inspectthe__built-inscope__bysimply__running dir(__builtins__)sans__imports,but__areadvised__touse__builtinsfor__realwork__and customization.Who__saiddocumenting__thisstuff__was easy?The__globalStatement__Theglobal__statementand__itsnonlocal__cousinare__theonly__declarationstatements__inPython__thatare__actuallyused__byPython__(for contrast,see__Chapter 6s__discussionof__unusedtype__hinting).They__arenot__typeor__size declarations, though;they__arenamespace__declarations.The__global statement,for__instance,tells__Pythonthat__afunction__plansto__changeone__ormore__globalnames__that is,names__thatlive__inthe__enclosingmodule__sscope__(namespace).We__vetalked__aboutglobal__inpassing__already.Here__sa__summary:Global__namesare__variablesassigned__atthe__toplevel__ofthe__enclosingmodule__file.Global__namesmust__bedeclared__onlyif__theyare__assignedwithin__a function.Global__namesmay__bereferenced__withina__functionwithout__being declared,per__theLEGB__rule.In__other words,global__allowsus__tochange__namesthat__liveoutside__adef__atthe__toplevel__ofa__module file.As__youll__see later,the__nonlocalstatement__isalmost__identicalbut__appliesto__namesin__anenclosing__defs__local scope,rather__thannames__inthe__enclosing module.The__global statement,usable__indef__butnot__lambda,simply__consistsof__thereserved__word global,followed__byone__ormore__namesseparated__by commas.All__thelisted__nameswill__bemapped__tothe__enclosingmodule__sscope__whenassigned__orreferenced__withinthe__function body.For__instance,the__followingis__atakeoff__onthe__preceding example:X__= 88 #Global__Xdef__func():global__XX__= 99 #Global__X:outside__def func() print(X) #Prints__99We__veadded__aglobal__declarationto__theexample__here,such__thatthe__Xinside__thedef__nowrefers__tothe__Xoutside__the def;they__arethe__samevariable__this time,so__changingX__insidethe__functionchanges__theX__outside it.Here__isa__slightlymore__involvedexample__ofglobal__at work: y,z__= 1, 2 #Global__variablesin__moduledef__all_global():global__x #Declare__globalsassigned__x =y__+z__#No__needto__declarey__or z:LEGB__rule Here, x, y,and__zare__allglobals__insidethe__function all_global.Names__yand__zare__globalbecause__theyaren__tassigned__inthe__function,and__xis__globalbecause__itwas__listedin__aglobal__statementto__mapit__tothe__modules__scope explicitly.Without__theglobal__here,x__wouldbe__consideredlocal__byvirtue__ofthe__assignment.Notice__thaty__andz__arenot__declared global;Python__sLEGB__lookuprule__findsthem__inthe__module (G) automatically.Also__noticethat__xdoes__noteven__existin__theenclosing__modulebefore__thefunction__runs;in__this case,the__firstassignment__inthe__functioncreates__xin__the module.All__ofwhich__workswhen__needed,but__youreally__shouldtry__toavoid__usingglobals__likethis__wheneverpossible__asthe__nextsection__will explain.Program__Design:Minimize__GlobalVariables__Functionsin__general,and__globalvariables__in particular,raise__somelarger__design questions. How,for__example,should__functions communicate?Although__someanswers__willbecome__moreapparent__whenyou__beginwriting__largerfunctions__ofyour__own,a__fewguidelines__upfront__mightspare__youfrom__problems later.In__general,functions__shouldrely__onarguments__andreturn__valuesinstead__of globals,but__thismay__notat__allbe__obviousto__newcomersto__programming.By__default,names__assignedin__functionsare__locals,so__ifyou__wantto__changenames__outsidefunctions__youhave__towrite__extracode__(e.g.,global__statements).This__isdeliberate__youhave__tosay__moreto__dothe__potentiallywrong__thing.Although__thereare__timeswhen__globalsare__useful (andeven__required),variables__assignedin__adef__arelocal__bydefault__becausethat__isnormally__thebest__policy.Changing__globalscan__leadto__well-known software-engineering problems:because__thevariables__valuesare__dependenton__theorder__ofcalls__toarbitrarily__distant functions,programs__canbecome__difficultto__debug,or__understandat__all.Consider__thismodule__file,for__example,which__ispresumably__importedand__used elsewhere:X__= 99def__func1():global__X #Change__globalX__whencalled__X = 88def__func2():global__X #But__sodoes__this,and__when?X__= 77 Now,imagine__thatit__isyour__jobto__modifyor__reusethis__code.What__willthe__valueof__Xbe__here? Really,that__questionhas__nomeaning__unlessit__squalified__witha__pointof__referencein__timethe__valueof__Xis__timing-dependent,as__itdepends__onwhich__functionwas__calledlast__(somethingwe__cant__tellfrom__thisfile__alone).The__neteffect__isthat__tounderstand__this code,you__haveto__tracethe__flowof__controlthrough__theentire__program. Hence,if__youneed__toreuse__ormodify__the code,you__haveto__keepthe__entireprogram__inyour__headall__at once.In__fact,you__cant__reallyuse__oneof__thesefunctions__withoutbringing__alongthe__other.They__aredependent__onthat__is,coupled__withthe__global variable.And__thatis__theproblem__with globals:they__generallymake__codemore__difficultto__understandand__reusethan__codeconsisting__of self-containedfunctions__thatrely__on locals.On__theother__hand,short__ofusing__toolslike__thenested__scopeclosures__coveredahead__orOOP__withclasses__covered later,global__variablesare__themost__basicway__toretain__sharedstate__informationinformation__thata__functionneeds__toremember__foruse__thenext__timeit__is called.Local__variablesdisappear__whenthe__function returns,but__globalsdo__not.As__youll__see later,other__techniquescan__achieve this, too,and__allowfor__multiplecopies__ofthe__retained information;but__theyare__morecomplex__thanpushing__valuesout__tothe__globalscope__forretention__insimple__caseswhere__this applies. Moreover,some__programsdesignate__asingle__moduleto__collectshared__globals;as__longas__thisis__expected,it__isnot__as harmful.Programs__thatuse__multithreadingfor__parallelprocessing__alsocommonly__dependon__globalvariables__theybecome__sharedmemory__betweenfunctions__runningin__parallel threads,and__soact__asa__communication device.2For__now, though,and__especiallyif__youare__relativelynew__to programming,avoid__thetemptation__touse__globalswhenever__youcan__theytend__tomake__programsdifficult__tounderstand__and reuse,and__wont__workfor__caseswhere__onecopy__ofsaved__datais__not enough.That__swhy__theyare__notthe__defaultin__Python.Try__tocommunicate__with passed-inarguments__andreturn__values instead.Six__monthsfrom__now,both__youand__yourcoworkers__maybe__gladyou__did.Program__Design:Minimize__Cross-FileChanges__Whilewe__reon__thesubject__of globals,here__sanother__relateddesign__note:although__wecan__changeglobal__variablesin__anotherfile__directly,we__usuallyshouldn__t.Module__fileswere__introducedin__Chapter 3and__arecovered__indepth__inthe__nextpart__ofthis__book,but__theirbasics__are simple.To__demotheir__relationshipto__scopes,consider__thesetwo__module files: # first.pyX__= 99 #This__code doesn'tknow__about second.py # second.pyimport__first print(first.X) # OK:references__aname__inanother__file first.X = 88 #But__changingit__canbe__toosubtle__andimplicit__Thefirst__definesa__variable X,which__thesecond__printsand__thenchanges__by assignment.Notice__thatwe__mustimport__thefirst__moduleinto__thesecond__toget__toits__variableat__allas__weve__learned,each__moduleis__a self-containednamespace__(packageof__variables),and__wemust__importone__moduleto__seeinside__itfrom__another.That__sthe__mainpurpose__of modules:by__segregatingvariables__ona__per-file__basis,they__avoidname__collisionsacross__files,in__muchthe__sameway__thatlocal__variablesavoid__nameclashes__across functions. Really, though,in__termsof__thischapter__s topic,the__globalscope__ofa__modulefile__becomesthe__attributenamespace__ofthe__moduleobject__onceit__isimported__importersautomatically__haveaccess__toall__ofthe__files__global variables,because__afile__sglobal__scopemorphs__intoan__objects__attributenamespace__whenit__is imported.After__importingthe__first module,the__secondmodule__printsits__variableand__thenassigns__ita__new value.Referencing__themodule__svariable__toprint__itis__finethis__ishow__modulesare__linkedtogether__intoa__largersystem__normally.The__problemwith__theassignment__to first.X, however,is__thatit__isfar__too implicit:whoever__scharged__withmaintaining__orreusing__thefirst__moduleprobably__hasno__cluethat__somearbitrarily__far-removedmodule__onthe__importchain__canchange__Xat__runtime.In__fact,the__secondmodule__maybe__ina__different folder,and__sodifficult__tonotice__at all.Although__such cross-filevariable__changesare__alwayspossible__in Python,they__areusually__muchmore__subtlethan__youwill__want. Again,this__setsup__toostrong__acoupling__betweentwo__componentsbecause__thefiles__areboth__dependenton__thevalue__ofthe__variable X,it__sdifficult__tounderstand__orreuse__onefile__withoutthe__other.Such__implicit cross-filedependencies__canlead__toinflexible__codeat__best,and__surprisingbugs__at worst.Here__again,and__generally speaking,don__tdo__thatthe__betterway__tocommunicate__acrossfile__boundariesis__tocall__functions,passing__inarguments__andgetting__backreturn__values.In__thisspecific__case,we__wouldprobably__bebetter__offcoding__anaccessor__functionto__managethe__change: # first.pyX__= 99def__setX(new): #Accessors__makeexternal__changesexplicit__globalX__#And__canmanage__accessin__asingle__placeX__=new__# second.pyimport__first first.setX(88) #Call__thefunction__insteadof__changingdirectly__Thisrequires__morecode__andmay__seemlike__atrivial__change,but__itmakes__ahuge__differencein__termsof__readabilityand__maintainabilitywhen__aperson__readingthe__firstmodule__byitself__seesa__function,that__personwill__knowthat__itis__apoint__ofinterface__andwill__expectthe__changeto__the X.In__other words,it__removesthe__elementof__surprisethat__israrely__agood__thingin__software projects.Although__wecannot__prevent cross-filechanges__fromhappening__(sansobscure__hacksthat__well__omit here),common__sensedictates__thatthey__shouldbe__minimizedunless__widelyknown__acrossthe__program.Other__Waysto__AccessGlobals__Interestingly,because__global-scopevariables__morphinto__theattributes__ofa__loadedmodule__object,we__canemulate__theglobal__statementby__importingthe__enclosingmodule__andassigning__toits__attributes,as__inthe__modulefile__inExample__17-2.Code__inthis__fileaccesses__itsenclosing__module,first__byimporting__it,and__thenby__indexingthe__sys.modulesdictionary__thatrecords__allloaded__modulesand__isused__inadvanced__roles (theres__moreon__thisdictionary__inPart__V).Example__17-2. thismod.py "Changea__globalthree__ways"var__= 99 #Global__variable ==module__attributedef__local():var__= 0 #Change__localvar__def glob1():global__var #Declare__global (normal)var__+= 1 #Change__globalvar__def glob2():var__= 0 #Change__localvar__importthismod__#Import__myself thismod.var += 1 #Change__globalvar__def glob3():var__= 0 #Change__localvar__importsys__#Import__systemtable__thismod = sys.modules['thismod'] #Get__moduleobject__(oruse____name__) thismod.var += 1 #Change__globalvar__def test(): print(var) local(); glob1(); glob2(); glob3() print(var)When__weimport__andcall__thismodule__stest__toinvoke__itsother__functions,this__adds 3to__theglobal__variablevar__onlyits__first function, local,does__notimpact__the global: >>>import__thismod >>> thismod.test() 99 102 >>> thismod.var 102All__these global-accesstechniques__work,and__illustratethe__equivalenceof__theglobal__scopeto__module attributes,but__theyre__noticeablymore__workthan__usingthe__globalstatement__tomake__yourintentions__explicit.As__weve__seen,global__allowsus__toeasily__changenames__ina__moduleoutside__a function.It__hasa__closerelative__namednonlocal__thatcan__beused__tochange__namesin__enclosing functions,too__butto__understandhow__thatcan__be useful,we__firstneed__toexplore__functionnesting__in general,the__topicwe__turnto__next.Nested__Functionsand__ScopesSo__far,this__chapterhas__largelyomitted__onepart__ofPython__sscope__ruleson__purpose,because__its__relativelyuncommon__toencounter__itin__practice. However,it__stime__totake__adeeper__lookat__layerE__inthe__LEGBlookup__rule.This__layerwas__addedduring__Python 2.Xs__reign.It__takesthe__formof__thelocal__scopesof__anyand__allenclosing__functions__local scopes.Enclosing__scopesare__sometimesalso__calledstatically__nested scopes. Really,the__nestingis__alexical__onenested__scopescorrespond__tophysically__andsyntactically__nestedcode__structuresin__yourprogram__ssource__code text.Nested__ScopesOverview__Withthe__additionof__nestedfunction__scopes,variable__lookuprules__becomeslightly__more complex.Within__a function:A__namereference__(X)looks__forthe__nameX__firstin__thecurrent__localscope__(function);then__inthe__localscopes__ofany__lexicallyenclosing__functionsin__yoursource__code,from__innerto__outer;then__inthe__currentglobal__scope (themodule__file);and__finallyin__the built-inscope__(whichwe__veseen__meansthe__built-inmodule__builtins).global__declarationsin__adef__makethe__searchbegin__inthe__global (module file)scope__instead.A__nameassignment__(e.g.,X__= value)creates__orchanges__thename__Xin__thecurrent__local scope,by__default.If__Xis__declaredglobal__withinthe__function,the__assignmentcreates__orchanges__thename__Xin__theenclosing__modules__scope instead. If,on__theother__hand,X__isdeclared__nonlocalwithin__adef__function,the__assignmentchanges__thename__Xin__thelocal__scopeof__theclosest__enclosingfunction__thatassigns__thesame__name.Notice__thatthe__globaldeclaration__stillmaps__variablesto__theenclosing__module.When__nestedfunctions__are present,variables__inenclosing__functionsmay__be referenced,but__requirenonlocal__declarationsto__be changed.Also__note that,unlike__global,nonlocal__doesnot__createa__namein__anenclosing__defif__its__notassigned__there;nonlocal__makessense__onlyif__thevariables__itnames__arealso__assignedby__anenclosing__defand__isan__errorto__use otherwise.This__sectionis__primarilyconcerned__withthe__firstbullet__inthe__preceding list:nested__scope references.We__llexplore__nestedassignments__andnonlocal__ina__moment,but__firstwe__needto__grokfunction__nestingin__general.Nested__ScopesExamples__Lets__turnto__codeto__illustratesome__ofthe__preceding points.Here__iswhat__anenclosing__functionscope__lookslike__(typethis__intoa__scriptfile__orat__theinteractive__promptto__runit__live):X__= 99 #Global__scope name:not__useddef__f1():X__= 88 #Enclosing__deflocal__def f2(): print(X + 1) #Reference__madein__nesteddef__f2() f1() #Prints__89:enclosing__deflocal__+ 1First__off,this__islegal__Python code:the__defis__simplyan__executable statement,which__canappear__anywhereany__otherstatement__canincluding__nestedin__another def. Here,the__nesteddef__runswhile__acall__tothe__function f1is__running;it__makesa__functionand__assignsit__tothe__name f2,a__localvariable__within f1s__local scope.In__a sense, f2is__atemporary__functionthat__livesonly__duringthe__executionof__(andis__visibleonly__tocode__in)the__enclosing f1.As__such,its__namewon__tclash__withany__otherpart__ofthe__programwhich__isone__reasonto__nestit__this way.But__noticewhat__happensinside__f2:when__ituses__thevariable__X,it__refersto__theX__thatlives__inthe__enclosing f1function__slocal__scope.Because__functionscan__accessnames__inall__physicallyenclosing__functions,the__Xin__f2is__automaticallymapped__tothe__Xin__f1,by__theLEGB__lookuprule__slevel__E.In__fact,this__enclosingscope__lookupworks__evenif__theenclosing__functions__callhas__already ended.For__example,the__followingcode__definesa__functionthat__makesand__returnsanother__function,and__introducesa__commonnesting__role:def__f1():X__= 88def__f2(): print(X + 1) #Remembers__Xin__enclosingdef__scopereturn__f2 #Return__f2but__don'tcall__itaction__= f1() # Make,return__function action() #Call__it now:prints__89In__this code,the__callto__actionis__reallyrunning__thefunction__wenamed__f2when__f1 ran.This__worksnaturally__becausefunctions__areobjects__inPython__likeeverything__elseand__canbe__passedback__asreturn__valuesfrom__other functions.More__subtly, f2remembers__theenclosing__scopes__Xin__f1even__though f1is__nolonger__activewhen__f2is__run.Though__abstract here,this__memorybehavior__turnsout__tobe__oneof__themain__reasonsto__nest functions,and__warrantsa__closerlook__inthe__next section.Closures__andFactory__FunctionsDepending__onwhom__you ask,the__precedingexample__sbehavior__issometimes__calleda__closureor__afactory__functionthe__formerdescribing__afunctional__programming technique,and__thelatter__denotinga__design pattern.In__code,a__factoryfunction__createsand__returnsa__functionthat__hasa__stateful closure,but__thetwo__termsare__intertwined.Whatever__the label,the__functionobject__inquestion__remembersvalues__inenclosing__scopesregardless__ofwhether__thosescopes__arestill__activefor__a call.In__effect,it__hasattached__packetsof__memory (a.k.a.state__retention),which__aremade__anewfor__eachcopy__ofthe__nestedfunction__created,and__oftenprovide__asimple__alternativeto__classesin__this role.Closures__(a.k.a.factory__functions)are__sometimesused__byprograms__thatneed__togenerate__eventhandlers__onthe__flyin__responseto__conditionsat__runtime.For__instance,imagine__aGUI__thatmust__defineactions__accordingto__userinputs__thatcannot__beanticipated__whenthe__GUIis__builtand__varyper__action.In__such cases,we__needa__functionthat__createsand__returnsanother__function,with__information (i.e., state)that__differsper__function made.To__demothis__livein__simplified terms,consider__thefollowing__function,typed__atthe__interactive prompt: >>>def__maker(N):def__action(X): #Make__andreturn__actionreturn__X **N__#action__retainsN__fromenclosing__scopereturn__actionThis__definesan__outerfunction__thatsimply__makesand__returnsa__nested function,without__callingit__makermakes__action,but__simplyreturns__actionwithout__running it.If__wethen__callthe__outer function: >>>f__= maker(2) #Pass__2to__argumentN__>>>f__.actionat__0x101ae7ba0>What__weget__backis__areference__tothe__nestedfunction__builtthe__onecreated__andassigned__toaction__whenthe__nesteddef__runs.If__wenow__callwhat__wegot__backfrom__theouter__function: >>> f(3) #Pass__3to__action'sX__9 #And__maker'sN__remembers 2: 3 ** 2 >>> f(4) #Pass__4to__X,N__isstill__2: 4 ** 2 16We__invokethe__nestedfunction__theone__calledaction__within maker.In__other words,we__recalling__thenested__functionthat__makercreated__andpassed__back.Perhaps__themost__unusualpart__of this, though,is__thatthe__nestedfunction__remembersinteger__2,the__valueof__thevariable__Nin__maker,even__thoughmaker__hasreturned__andexited__bythe__timewe__call action.In__effect,N__fromthe__enclosinglocal__scopeis__retainedas__stateinformation__attachedto__thegenerated__action,which__iswhy__weget__backits__argumentsquared__wheneverit__islater__called.Just__as important,if__wenow__callthe__outerfunction__again,we__getback__anew__nestedfunction__withdifferent__stateinformation__attached.In__the following,we__computethe__argumentcubed__insteadof__squaredwhen__callingthe__new function,but__theoriginal__stillsquares__as before: >>>g__= maker(3) #g__remembers 3,f__remembers 2 >>> g(4) # 4 ** 3 64 >>> f(4) # 4 ** 2 16This__worksbecause__eachcall__toa__closure/factoryfunction__likethis__getsits__ownset__ofstate__information.In__our demo,the__functionwe__assignto__nameg__remembers 3,and__fremembers__2,because__eachhas__itsown__stateinformation__retainedby__thevariable__Nin__maker.In__a GUI,N__mightbe__a username,email__address,or__other per-function state.This__isall__literalinside__Python.Nested__functionshave__anattached__closurestorage__areafor__theenclosing__scopenames__they use.It__savailable__asthe____closure__attribute__ofsuch__functions (andfetching__cell_contentsafter__indexingthis__tupleyields__astate__item),but__wedon__tneed__tounderstand__Pythoninternals__touse__closuresin__our code.This__isalso__asomewhat__advancedtechnique__thatyou__maynot__seecommonly__inmost__code,and__maybe__morepopular__amongprogrammers__withbackgrounds__infunctional__programming languages.On__theother__hand,enclosing__scopesare__oftenemployed__bythe__lambda function-creationexpressions__introducedin__theprior__chapterbecause__lambdais__an expression,it__isalmost__alwaysnested__ina__def.For__example,a__lambdacan__servein__placeof__adef__inour__demo,and__alsorelies__onenclosing__scopereferences__toretain__statelike__Nin__thefollowing__variation: >>>def__maker(N):return__lambda X:X__*N__#lambda__functionsretain__statetoo__>>> h,i__= maker(2), maker(3) #Make__twoclosure__functions >>> h('Py'), i('Py') #Run__lambdas: ('Py' * 2)and__('Py' * 3) ('PyPy', 'PyPyPy')For__amore__tangibleexample__ofclosures__at work,see__thesidebar__WhyYou__Will Care:Customizing__open .It__usessimilar__techniquesto__storeinformation__forlater__usein__anenclosing__scope.As__youll__alsosee__afterthe__nextsection__s closer,closures__becomemore__usefulwhen__theirstate__becomeschangeable__with nonlocal.Arbitrary__ScopeNesting__Finally,this__tourof__nestedfunction__scopeswould__beremiss__ifit__didnt__pointout__thatscopes__maynest__arbitrarily,though__onlyenclosing__functions (not classes,described__inPart__VI)are__searchedwhen__namesare__referenced: >>>def__f1():x__= 99def__f2():def__f3(): print(x) #Found__in f1'slocal__scope! f3() f2() >>> f1() 99This__does work:Python__willsearch__thelocal__scopesof__allenclosing__defs,from__innerto__outer,after__thereferencing__functions__ownlocal__scopeand__beforethe__modules__globalscope__or built-ins. However,this__sortof__codeis__evenless__likelyto__cropup__in practice.Per__coding aphorism,flat__isbetter__than nested,and__thisstill__holdsgenerally__trueeven__withnested__scopeclosures__inthe__toolbox.Except__inlimited__contexts,your__life (andthe__livesof__yourfellow__travelersin__thesoftware__realm)will__generallybe__betterif__youminimize__nestingin__function definitions.The__nonlocalStatement__Inthe__prior section,we__sawhow__nestedfunctions__canreference__variablesin__anenclosing__functions__scope,even__ifthat__functionhas__already returned.As__suggested earlier,we__canalso__changesuch__enclosingscope__variables,as__longas__wedeclare__themin__nonlocal statements.With__this statement,nested__functionsgain__bothread__andwrite__accessto__namesin__enclosing functions.This__makesnested__scopeclosures__more useful,by__makingstate__changeable.The__nonlocal statement,usable__indef__butnot__lambda,is__similarin__bothform__androle__to global,covered__earlier.Like__global,nonlocal__declaresthat__aname__(or names)will__bechanged__inan__enclosing scope.Unlike__global, though,nonlocal__appliesto__aname__inan__enclosingfunction__s scope,not__tothe__globalmodule__scopeoutside__all functions.Also__unlike global,nonlocal__namesmust__existin__anenclosing__functions__scopethey__aremapped__onlyto__enclosingfunctions__andcannot__becreated__bya__firstassignment__ina__nesteddef__thatuses__nonlocal.In__other words,nonlocal__bothallows__assignmentto__namesin__enclosingfunction__scopes,and__limitsscope__lookupsfor__suchnames__toenclosing__functions.The__neteffect__isa__directand__reliableimplementation__ofchangeable__state information,for__contextsthat__donot__desireor__needto__useclasses__orother__stateful tools.nonlocal__BasicsThe__nonlocalstatement__hasmeaning__onlyinside__a function,and__isan__errorto__use elsewhere.More__specifically,it__appliesand__isusable__onlywhen__defis__nestedin__another def:because__thebody__ofa__lambdaallows__justan__expression,it__supportsneither__nonlocalnor__nesteddef__statements.When__usedwithin__a def,the__nonlocalstatement__sealsthe__fateof__referencesmuch__likethe__global statement,nonlocal__causessearches__forthe__nameslisted__inthe__statementto__beginin__theenclosing__defs scopes,not__inthe__localscope__ofthe__declaring function.That__is,nonlocal__alsomeans__skipmy__localscope__entirely.In__fact,the__nameslisted__ina__nonlocalmust__beassigned__inan__enclosing def,and__neverrefer__tonames__inthe__globalor__built-in scopes. Importantly,the__additionof__nonlocaldoes__notalter__namereference__scoperules__in general;they__stillwork__as before,per__theLEGB__ruledescribed__earlier.The__nonlocalstatement__simplyserves__toallow__namesin__enclosingscopes__tobe__changedrather__thanjust__referenced.The__globaland__nonlocal statements, though,tighten__upand__evenrestrict__thelookup__ruleswithin__afunction__forthe__namesthat__they list:global__makesscope__lookupbegin__inthe__enclosingmodule__sscope__andallows__namesthere__tobe__assigned.Scope__lookupcontinues__onto__the built-inscope__ifthe__namedoes__notexist__inthe__module,but__assignmentsto__globalnames__alwayscreate__orchange__themin__themodule__s scope.nonlocal__restrictsscope__lookupto__justenclosing__defs,requires__thatthe__namesexist__there,and__allowsthem__tobe__reassigned.Scope__lookupdoes__notcontinue__onto__theglobal__or built-in scopes.nonlocal__inAction__Lets__moveon__toexamples__tomake__thismore__concrete.Simple__referencesto__enclosingdef__scopeswork__aswe__vealready__seenin__the following,outer__buildsand__returnsthe__functioninner__tobe__called later,and__thestate__referencein__innermaps__thelocal__scopeof__outerusing__thenormal__scopeLEGB__lookup rules: >>>def__outer(start):state__=start__#Referencing__nonlocalsworks__normallydef__inner(label): print(label, state) #Remembers__statein__enclosingscope__returninner__>>>F__= outer(0) >>> F('code') #State__isthe__sameon__everyinner__runcode__0 >>> F('hack')hack__0Changing__aname__inan__enclosingdef__s scope, however,is__notallowed__by default: >>>def__outer(start):state__=start__def inner(label):state__+= 1 #Cannot__changeby__default print(label, state)return__inner >>>F__= outer(0) >>> F('code') UnboundLocalError:cannot__accesslocal__variable 'state' Now,if__wedeclare__statein__theouter__scopeas__nonlocalwithin__inner,we__getto__bothreference__andchange__itinside__thenested__function. Again,this__workseven__thoughouter__hasreturned__andexited__bythe__timewe__callthe__returnedinner__functionthrough__thename__F: >>>def__outer(start):state__=start__#Each__callgets__itsown__statedef__inner(label):nonlocal__state # <=Remembers__statein__enclosingscope__state += 1 #Allowed__tochange__itif__nonlocal print(label, state)return__inner >>>F__= outer(0) >>> F('code') #Increments__stateon__eachcall__code 1 >>> F('hack')hack__2As__usualwith__enclosingscope__references,we__cancall__theouter__factory (closure)function__multipletimes__toget__multiplecopies__ofits__statein__memory.The__stateobject__inthe__enclosingscope__isessentially__attachedto__thenew__innerfunction__object returned;each__callmakes__a new,distinct__state object,such__thatupdating__onefunction__sstate__wont__impactthe__other.The__followingcontinues__theprior__listings__interaction: >>>G__= outer(24) #Make__anew__outerthat__startsat__24 >>> G('code')code__25 >>> G('hack') # G'sstate__informationupdated__to 26hack__26 >>> F('more') #But__F'sstate__iswhere__itleft__off:at__2more__3 #Each__callhas__differentstate__informationAs__youcan__see,Python__snonlocals__aremuch__morefunctional__thanstatic__functionlocals__typicalin__someother__languages:in__aclosure__function,nonlocals__are per-call,multiple__copy data.nonlocal__BoundaryCases__Though useful,nonlocals__comewith__somesubtleties__tobe__aware of. First,unlike__theglobal__statement,nonlocal__namesreally__mustbe__assignedin__anenclosing__defs__scopeyou__cannotcreate__themdynamically__byassigning__themanew__ina__nested function.The__enclosingfunction__sassignment__canappear__eitherbefore__orafter__thenested__function,but__youll__getan__errorif__its__missing.In__fact,nonlocals__arechecked__foran__enclosingfunction__assignmentat__functiondefinition__time,before__eitheran__enclosingor__nestedfunction__isever__called: >>>def__outer(start):def__inner(label):nonlocal__state #Nonlocals__mustexist__inan__enclosingdef__state = 0 print(label, state)return__inner SyntaxError:no__bindingfor__nonlocal 'state'found__>>>def__outer(start):def__inner(label):global__state #But__globals don'thave__toexist__whendeclared__state = 0 print(label, state)return__inner >>>F__= outer(0) >>> F('glob')glob__0 >>>state__#Created__bythe__assignmentin__nestedinner__0 Second,nonlocal__restrictsthe__scopelookup__tojust__enclosing defs;nonlocals__arenot__lookedup__inthe__enclosingmodule__sglobal__scopeor__the built-inscope__outsideall__defs,even__ifthey__arealready__there: >>>state__= 0 >>>def__outer():def__inner():nonlocal__state #Must__belocated__ina__def,not__themodule__state += 1 #Use__globalfor__globals,not__nonlocalreturn__inner SyntaxError:no__bindingfor__nonlocal 'chapter'found__>>>def__outer():def__inner():nonlocal__ord #Ditto__for built-ins (andimmediate__calls) print(ord) inner() SyntaxError:no__bindingfor__nonlocal 'ord'found__Theserestrictions__makesense__onceyou__realizethat__Pythonwould__nototherwise__generallyknow__inwhich__enclosingscope__tocreate__a brand-new name.In__theprior__listing,should__statebe__assignedin__outer,or__themodule__outside?Because__thisis__ambiguous,Python__mustresolve__nonlocalsat__functioncreation__time,not__functioncall__time. Finally,this__chapterhas__beencareful__tosay__thatnonlocal__namesmust__beassigned__inan__enclosing function,not__theenclosing__function.This__canmatter__whenfunction__nestingruns__deep:a__namelisted__innonlocal__cantechnically__appearanywhere__inthe__hierarchyof__enclosingfunctions__notjust__onelevel__upand__theclosest__appearanceis__used.Even__so,because__suchcode__seemsunlikely__tocrop__upin__practice (andprobably__qualifiesas__crueland__unusual punishment),we__llforgo__aformal__demo here,but__seeArbitrary__ScopeNesting__formost__ofthe__morass. State-RetentionOptions__Giventhe__extracomplexity__ofnested__functions,you__mightwonder__whythey__reworth__the fuss.Although__its__difficultto__seein__oursmall__examples,state__informationbecomes__essentialin__many programs.While__functionscan__return results,their__localvariables__wont__normallyretain__othervalues__thatmust__liveon__between calls. Moreover,many__applicationsrequire__suchvalues__todiffer__percontext__of use.Broadly__speaking,there__aremultiple__waysfor__Pythonfunctions__toretain__statebetween__calls.These__includethe__globalvariables__andenclosing__scopereferences__weve__already met,but__also class-instanceattributes__andfunction__attributes.To__closeout__this chapter,let__sreview__theseoptions__tosee__howthey__stack up. Nonlocals: Changeable, Per-Call,LEGB__First off,the__followingcode__isa__recapfrom__theprior__section,repeated__herefor__compareand__contrast.As__weve__seen,its__nonlocalallows__statein__anenclosing__scopeto__besaved__and modified.Each__callto__outermakes__a self-containedpackage__ofchangeable__information,whose__namesand__objectsdo__notclash__withany__otherpart__ofthe__program: >>>def__outer(start):state__=start__#Each__callgets__itsown__statedef__inner(label):nonlocal__state #Remembers__statein__enclosingscope__state += 1 #Allowed__tochange__itif__nonlocal print(label, state)return__inner >>>F__= outer(0) #State__tobe__savedin__enclosingscope__>>> F('nonlocal1') #State__visiblewithin__closureonly__nonlocal1 1 >>> F('nonlocal2') nonlocal2 2 >>> F.state AttributeError: 'function'object__hasno__attribute 'state'We__needto__declarevariables__nonlocalonly__ifthey__mustbe__changed (otherenclosing__scopename__referencesare__automaticallyretained__asusual__per LEGB),and__nonlocalnames__arenot__visibleoutside__theenclosing__function.While__thisscheme__works well,the__nextthree__sectionspresent__some alternatives.Some__ofthe__codein__thesesections__usestools__wehaven__tcovered__yetand__isintended__partiallyas__preview,but__well__keepthe__examplessimple__hereso__thatyou__cancompare__andcontrast__alongthe__way. Globals:Changeable__butShared__Onecommon__suggestionfor__achievingstate__retentionwithout__nonlocalis__tosimply__movesaved__infoout__tothe__globalscope__(theenclosing__module): >>>def__outer(start):global__state #Move__itout__tothe__moduleto__changeit__state =start__#global__allowschanges__inmodule__scopedef__inner(label):global__statestate__+= 1 print(label, state)return__inner >>>F__= outer(0) >>> F('global1') #Each__callincrements__sharedglobal__state global1 1 >>> F('global2') global2 2 >>>state__#State__accessibleas__globaloutside__defs 2This__worksin__this case,but__itrequires__globaldeclarations__inboth__functionsand__isprone__toname__collisionsin__theglobal__scope (whatif__stateis__alreadybeing__usedfor__something else?).A__moresubtle__problemis__thatit__onlyallows__fora__singleshared__copyof__thestate__informationin__themodule__scopeif__wecall__outer again,we__llwind__upresetting__themodule__sstate__variable,such__thatprior__callswill__seetheir__state overwritten: >>>G__= outer(24) #Resets__state'ssingle__copyin__globalscope__>>> G('global3') global3 25 >>> F('global4') #But__F'scounter__hasbeen__overwritten! global4 26As__shown earlier,when__youuse__nonlocaland__nestedfunction__closuresinstead__of global,each__callto__outerremembers__itsown__uniquecopy__ofthe__state object.For__per-call roles,globals__dont__fitthe__bill.Function__Attributes: Changeable, Per-Call,Explicit__Asanother__state-retention option,we__canoften__achievethe__sameeffect__asnonlocals__withfunction__attributes user-definednames__attachedto__functions explicitly.When__youattach__user-definedattributes__tonested__functionsgenerated__byfactory__functions,they__canalso__serveas__per-call,multiple__copy,and__writeable state,just__likenonlocal__scope closures.Such__user-definedattribute__nameswon__tclash__withnames__Pythoncreates__itself,and__asfor__nonlocal,need__beused__onlyfor__statevariables__thatmust__be changed;other__scopereferences__areretained__andwork__normally.Because__factoryfunctions__makea__newfunction__oneach__call anyhow,this__doesnot__requireextra__objectsthe__newfunction__sattributes__become per-callstate__inmuch__thesame__wayas__nonlocals,and__aresimilarly__associatedwith__thenew__functionin__memory.In__contrast,function__attributesare__perhapsless__magicalthan__scopes,and__allowstate__variablesto__beaccessed__outsidethe__nested function.With__nonlocal,state__variablescan__beseen__directlyonly__withinthe__nested def;with__attributes,state__accessis__asimple__function-attribute fetch.Here__sa__mutationof__ourexample__basedon__thistechnique__itreplaces__anonlocal__withan__attributeattached__tothe__nested function.This__schememay__notseem__asintuitive__tosome__atfirst__glance;you__mustaccess__stateexplicitly__throughthe__functions__nameinstead__ofas__simple variables,and__mustinitialize__afterthe__nested def. Still,it__allowsstate__tobe__accessed externally,saves__aline__byeliminating__anonlocal__declaration,and__makesstate__usagemore__explicit: >>>def__outer(start):def__inner(label): inner.state += 1 #Change__object attr,not__inneritself__print(label, inner.state) #inner__isin__theenclosing__scope inner.state =start__#Initialize__stateafter__innerdefined__returninner__>>>F__= outer(0) >>> F('attr1') #F__isan__innerwith__stateattached__attr1 1 >>> F('attr2') attr2 2 >>> F.state #Can__accessstate__outsidedefs__too 2Because__eachcall__tothe__outerfunction__producesa__newnested__function object,this__schemesupports__multiple-copy, per-callchangeable__datajust__likenonlocal__closuresa__usagemode__thatglobal__variablescannot__provide: >>>G__= outer(24) #G__hasown__state, doesn'toverwrite__F's >>> G('attr3') attr3 25 >>> F('attr4') # F'sstate__varies attr4 3 >>> F.state #State__isaccessible__and per-call 3 >>> G.state 25 >>>F__isG__#Different__functionobjects__FalseFine__points:this__coderelies__onthe__factthat__thefunction__nameinner__isa__localvariable__inthe__outerscope__enclosing inner;as__such,it__canbe__referencedfreely__insideinner__perLEGB__s E.This__codealso__relieson__thefact__thatchanging__anobject__inplace__isnot__anassignment__toa__name;when__itincrements__inner.state,it__ischanging__partof__theobject__inner references,not__thename__inneritself__(muchlike__the L.appendcall__wesaw__earlier).Because__were__notreally__assigninga__namein__theenclosing__scope,no__nonlocaldeclaration__is required.We__llexplore__functionattributes__furtherin__Chapter 19. Importantly,you__llsee__therethat__Pythonuses__namingconventions__thatensure__thatthe__arbitrarynames__youassign__asfunction__attributeswon__tclash__withnames__relatedto__internal implementation,making__thenamespace__equivalentto__auser__scope.At__theend__ofthe__day,function__attributesboth__predatenonlocal__andprovide__similar utility,making__thelatter__technicallyredundant__insome__roles.NOTE__Statewith__enclosingscope__mutables:On__arelated__note,it__salso__possibleto__changea__mutableobject__likea__listin__theenclosing__scopewithout__declaringits__name nonlocal.The__following,for__example,implements__changeable per-callstate__information,and__largelyworks__thesame__asthe__precedingversion__(thoughit__doesnot__supportaccess__tostate__infofrom__outsidethe__functions):def__outer(start):def__inner(label): state[0] += 1 #Clever__hackor__dark magic? print(label, state[0]) #Leverage__in-placemutable__changestate__= [start]return__innerThis__exploitsthe__mutabilityof__lists,and__likefunction__attributes,relies__onthe__factthat__in-placeobject__changesdo__notclassify__aname__as local.This__isperhaps__moreobscure__thaneither__functionattributes__or nonlocal,though__its__atechnique__thatpredates__others,and__seemsto__lietoday__somewhereon__thespectrum__fromarcane__hackto__dated workaround.You__reprobably__betteroff__usingnamed__functionattributes__thanlists__andnumeric__offsetsthis__way (butyou__cant__controlwhat__others code). Classes: Changeable, Per-Call,OOP__Anotherstandard__prescriptionfor__changeablestate__informationin__Pythonis__touse__classeswith__attributes.Like__function attributes,this__schememakes__stateinformation__accessmore__explicitthan__theimplicit__magicof__scopelookup__rules.In__addition,each__instanceof__aclass__getsa__freshcopy__ofthe__state information,as__anatural__byproductof__Pythons__object model.Classes__alsosupport__inheritance,multiple__behaviors,and__otherOOP__toolsabove__andbeyond__functions.As__anabstract__andpartial__illustration,the__followingdefines__twostateful__instancesof__a class:class__Book:code__todefine__methodfunctions__thatmanage__anduse__state lp6e = Book() #Make__aninstance__ofthe__class lp6e.year = 2024 #Access__instancestate__viaattributes__lp6e.python = 3.12 lp5e = Book() #Make__anotherinstance__ofthe__class lp5e.year = 2013 #Each__instancehas__itsown__attributes/state lp5e.python = 3.3Because__classessupport__abroader__arrayof__tools,they__tendto__requiremore__codethan__closure functions,but__maybe__betterin__moredemanding__roles.We__havent__exploredclasses__inany__sortof__detail yet, though,so__well__haveto__cutthis__sectionshort__here.Watch__for classes,and__theirexplicit__flavorof__multiple-copystate__information,in__Part VI.And__theWinner__IsAs__a wrap-up, globals, nonlocals,function__attributes,and__classesall__offerchangeable__state-retention options.Globals__supportonly__single-copyshared__data,but__nonlocals,function__attributes,and__classesall__support multiple-copychangeable__state.Of__the latter,nonlocals__relyon__animplicit__LEGB lookup,function__attributesare__manualbut__explicitand__allowstate__accessoutside__of functions,and__classesare__alarger__solutionthat__comeswith__OOPs__complexities.As__usual,the__besttool__foryour__programdepends__uponyour__programs__goals.We__veseen__thatnonlocal__provideschangeable__statefor__nestedfunctions__witha__dedicated statement,and__isespecially__usefulfor__simpler state-retentionneeds__whereglobal__variablesdo__notapply__andclasses__maynot__be warranted.That__being said,function__attributescan__oftenserve__thesame__rolesas__nonlocal,with__arguablyless__implicit behavior.We__llrevisit__state-retentionoptions__introducedhere__inChapter__39for__amore__realisticuse__case decorators,a__toolthat__bynature__involvesmultilevel__state retention.State__optionshave__additionalselection__factors (e.g., performance),which__well__haveto__leaveunexplored__herefor__space (youll__learnhow__totime__codespeed__inChapter__21).For__now,it__stime__toexplore__onemore__technique,which__bothconfounds__theLEGB__ruleand__seguesto__thenext__chapter.Scopes__andArgument__DefaultsIn__earlyversions__of Python,the__enclosingscope__referenceswe__veused__inthis__chapterfailed__becausenested__functionsdid__notdo__anythingabout__scopesa__referenceto__anenclosing__functions__variablewould__searchonly__the local, global,and__built-in scopes.Because__itskipped__thescopes__ofenclosing__functions,an__errorwould__result.To__workaround__this,programmers__typicallyused__defaultargument__valuesto__passin__andremember__theobjects__inan__enclosing scope.Though__apreview__ofthe__nextchapter__sarguments__coverage,this__alsobears__on scopes.In__the following,a__takeoffof__anearlier__example,a__valuefrom__theenclosing__functions__scopeis__passedinto__anested__functionvia__anunused__arguments__default:def__f1():X__= 88def__f2(X=X): #Remember__enclosingscope__Xwith__defaults print(X + 1) f2() f1() #Prints__89This__syntaxalso__worksin__lambda, which,as__weve__learned,naturally__andnormally__creates nested-function scopes:def__f1():X__= 88 f2 =lambda__X=X: print(X + 1) f2()Both__ofthese__examplesstill__workin__allPython__releases,and__relyon__argument defaults.In__short,the__syntax arg=valin__afunction__headermeans__thatthe__argumentarg__willdefault__tothe__valueval__ifno__realvalue__ispassed__toarg__ina__call.In__thepreceding__code,this__isused__toexplicitly__assignenclosing__scopestate__tobe__retained. Specifically,in__themodified__f2s here,the__X=Xmeans__thatthe__argumentX__onthe__leftwill__defaultto__thevalue__ofX__inthe__enclosingscope__becausethe__Xon__theright__isevaluated__beforePython__stepsinto__thenested__function,it__stillrefers__tothe__Xin__f1.In__effect,each__f2s__defaultargument__Xremembers__whatX__wasin__theenclosing__f1:the__object 88.That__sfairly__subtle,and__itdepends__entirelyon__thetiming__of default-value evaluations.It__salso__anincidental__ifnot__accidental feature:this__worksonly__ifa__realvalue__isnever__passedto__argumentX__tooverwrite__the default.In__fact,the__nestedscope__lookuprule__wasadded__toPython__inpart__tomake__defaultsunnecessary__forthis__role: today,Python__automaticallyremembers__anyvalues__requiredfrom__theenclosing__scopefor__usein__nesteddefs__and lambdas.As__weve__seen,this__exampletoday__worksthe__samesans__defaults:def__f1():X__= 88def__f2(): #Remember__enclosingscope__Xper__LEGBrule__print(X + 1) #And__likewisefor__lambda f2()That__said,flat__isgenerally__betterthan__nested again,and__functionnesting__insome__suchcode__makesprograms__morecomplex__thanthey__need be.The__following,for__instance,is__anequivalent__ofthe__priorexamples__thatavoids__nesting altogether.Notice__theforward__referenceto__f2inside__f1in__thiscode__its__OKto__calla__functiondefined__afterthe__functionthat__calls it,as__longas__thesecond__defruns__beforethe__firstfunction__isactually__called.Code__insidea__functions__bodyis__neverevaluated__untilthe__functionis__later called:def__f1():X__= 88 #Pass__xalong__insteadof__nesting f2(X) #Forward__referenceOK__def f2(X): print(X + 1) #Flat__isstill__oftenbetter__thannested__Ifyou__avoidnesting__this way,you__canalmost__forgetabout__thenested__scopesconcept__in Python.On__theother__hand,nested__functionscan__avoidname__clashesby__localizingthe__namesof__functionsused__nowhere else,and__nestingis__thebasis__ofclosure__functions,which__supportstateful__callableobjects__usefulin__avariety__of roles.When__functionsare__nestedfor__such reasons,the__LEGBrule__almostmakes__defaultsunnecessary__forsaving__statefrom__anenclosing__functions__scopeexcept__inthe__following case.Loops__Require Defaults,Not__ScopesSo__whybother__learningan__outdated scope-reference scheme?Because__its__stillrequired__inone__common case:if__alambda__ordef__isnested__ina__loop,and__thenested__functionreferences__anenclosing__scopevariable__thatis__changedby__that loop,then__allfunctions__generatedwithin__theloop__willhave__thesame__valuethe__valuethe__referencedvariable__hadin__thelast__loop iteration.In__such cases,you__muststill__usedefaults__tosave__thevariable__scurrent__value instead.This__mayseem__obscure,but__itcan__comeup__inpractice__moreoften__thanyou__may think,especially__incode__thatgenerates__event-handlerfunctions__fora__numberof__widgetsin__aGUI__for instance,handlers__for button-clicksfor__allthe__buttonsin__a panel.If__theseare__createdin__aloop__(andthey__oftenwill__be),you__needto__becareful__tosave__statewith__defaults,or__allyour__buttonscallbacks__maywind__updoing__thesame__thing.Here__san__illustrationof__thisphenomenon__reducedto__simple code:the__followingattempts__tobuild__upa__listof__functionsthat__eachremember__thecurrent__variablei__fromthe__enclosing scope: >>>def__makeActions():acts__= []for__iin__range(5): #Try__toremember__eachi__in 0..4 acts.append(lambda x:i__** x) #But__allremember__samelast__i!return__acts >>>acts__= makeActions() >>> acts[0] .at__0x101ae7ec0> Interestingly,this__canalso__becoded__asa__list comprehension,where__alambda__canbe__usedas__thecollection__result,and__thelist__comprehensionserves__asa__localscope__forits__loop variable: >>>acts__= [(lambda x:i__** x)for__iin__range(5)] >>> acts[0]at__0x10de6bce0>Either__way, though,this__doesnt__quitework__becausethe__enclosingscope__variablei__islooked__upwhen__thenested__functionsare__later called,they__alleffectively__rememberthe__same value:the__valuethe__loopvariable__hadon__thelast__loop iteration.That__is,when__wepass__apower__argumentof__2to__xin__eachof__thefollowing__calls,we__getback__4to__thepower__of 2for__eachfunction__inthe__list,because__iis__thesame__inall__ofthem__4: >>> acts[0](2) #All__are 4 ** 2, 4=lasti__16 >>> acts[1](2) #This__shouldbe__1 ** 2 (1) 16 >>> acts[2](2) #This__shouldbe__2 ** 2 (4) 16 >>> acts[4](2) #Only__thisshould__be 4 ** 2 (16) 16In__this case,we__stillhave__toexplicitly__retainenclosing__scopevalues__withdefault__arguments,rather__thanenclosing__scope references.That__is,to__makethis__sortof__code work,we__mustpass__inthe__currentvalue__ofthe__enclosingscope__svariable__witha__default.Here__sthe__requiredmod__forboth__thedef__andcomprehension__versions: >>>def__makeActions():acts__= []for__iin__range(5): #Use__defaultsinstead__acts.append(lambda x, i=i:i__** x) #Remember___current_i__returnacts__>>>acts__= [(lambda x, i=i:i__** x)for__iin__range(5)]In__either coding,because__defaultsare__evaluatedwhen__thenested__functionis__created (notwhen__its__later called),each__remembersits__ownvalue__for i: >>>acts__= makeActions() >>> acts[0](2) # 0 ** 2 0 >>> acts[1](2) # 1 ** 2 1 >>> acts[2](2) # 2 ** 2 4 >>> acts[4](2) # 4 ** 2 16Nor__arefunction__attributesa__fix here:because__afunction__sown__nameis__avariable__fromthe__enclosingscope__thatchanges__inthe__loop too,in__everyfunction__itmay__referencethe__lastfunction__madeby__thelast__loop iteration.We__llomit__thegory__details here,but__keepin__mindthat__anyenclosing__scopereference__changedby__aloop__mayrequire__defaults.This__mayseem__anodd__special case,but__itreflects__Pythons__implementationof__variable scopes,and__willbecome__morelikely__tocrop__upas__youstart__writinglarger__programs.This__caseis__alsorooted__inboth__scopesand__arguments defaults,and__tounderstand__thelatter__in full,we__haveto__moveon__tothe__next chapter.NOTE__Statewith__argument-default mutables:Also__ona__related note,it__spossible__toretain__statetoo__withmutable__argumentdefaults__likelists__anddictionaries__(e.g.,def__f(a=[])).Because__defaultsare__implementedas__objectsattached__tofunctions__atfunction__creation time,mutable__defaultsretain__statefrom__callto__call,rather__thanbeing__initializedanew__oneach__call.Defaults__canalso__retainmutables__froman__enclosingfunction__s scope,thereby__enablingchangeable__per-call__state information.Depending__onwhom__youask__andwhen__youask__themthis__iseither__afeature__thatsupports__state retention,or__aperilous__anddark__cornerof__thelanguage__tobe__avoided. Usually,programmers__expectdefaults__initializedwith__literalslike__[]to__be re-createdon__every call,and__aresurprised__whenthey__retainprior__calls values.More__onthis__inFunction__Gotchas .Chapter__SummaryIn__this chapter,we__studiedone__oftwo__keyconcepts__relatedto__functions: scopes,which__determinehow__variablesare__lookedup__when used.As__we learned,variables__areconsidered__localto__thefunction__definitionsin__whichthey__are assigned,unless__theyare__specificallydeclared__tobe__globalor__nonlocal.We__alsoexplored__somemore__advancedscope__concepts here,including__nestedfunction__scopesand__function attributes. Finally,we__lookedat__somegeneral__design ideas,such__asthe__needto__minimizeglobals__and cross-file changes.In__thenext__chapter,we__regoing__tocontinue__ourfunction__tourwith__thesecond__key function-related concept:argument__passing.As__youll__find,arguments__arepassed__intoa__functionby__assignment,but__Pythonalso__providestools__thatallow__functionsto__beflexible__inhow__itemsare__passed,including__thedefaults__wepreviewed__here.Before__wemove__on,let__stake__thischapter__squiz__toreview__thescope__conceptswe__vecovered__here.Test__Your Knowledge:Quiz__1.What__isthe__outputof__thefollowing__code,and__why? >>>X__= 'Hack' >>>def__func(): print(X) >>> func() 2.What__isthe__outputof__this code,and__why? >>>X__= 'Hack' >>>def__func():X__= 'Py!' >>> func() >>> print(X) 3.What__doesthis__code print,and__why? >>>X__= 'Hack' >>>def__func():X__= 'Py!' print(X) >>> func() >>> print(X) 4.What__outputdoes__thiscode__produce? Why? >>>X__= 'Hack' >>>def__func():global__XX__= 'Py!' >>> func() >>> print(X) 5.What__aboutthis__codewhat__sthe__output,and__why? >>>X__= 'Hack' >>>def__func():X__= 'Py!'def__nested(): print(X) nested() >>> func() >>> print(X) 6.How__aboutthis__example:what__isits__output,and__why? >>>def__func():X__= 'Py!'def__nested():nonlocal__XX__= 'Hack' nested() print(X) >>> func() 7.Name__threeor__moreways__toretain__stateinformation__acrosscalls__ina__Python function.Test__Your Knowledge:Answers__1.The__outputhere__isHack__becausethe__functionreferences__aglobal__variablein__theenclosing__module (becauseit__isnot__assignedin__the function,it__isconsidered__global). 2.The__outputhere__isHack__againbecause__assigningthe__variableinside__thefunction__makesit__alocal__andeffectively__hidesthe__globalof__thesame__name.The__printstatement__findsthe__variableunchanged__inthe__global (module) scope. 3.It__prints Py!on__oneline__andHack__on another,because__thereference__tothe__variablewithin__thefunction__findsthe__assignedlocal__andthe__referencein__theprint__statementfinds__the global. 4.This__timeit__justprints__Py!because__theglobal__declarationforces__thevariable__assignedinside__thefunction__torefer__tothe__variablein__theenclosing__global scope,even__thoughthe__variableis__assignedinside__the function. 5.The__outputin__thiscase__isagain__Py!on__oneline__andHack__on another,because__theprint__statementin__thenested__functionfinds__thename__inthe__enclosingfunction__slocal__scope,and__thedisplay__atthe__endfinds__thevariable__inthe__global scope. 6.This__exampleprints__Hackbecause__thenonlocal__statementmeans__thatthe__assignmentto__Xinside__thenested__functionchanges__Xin__theenclosing__functions__local scope.Without__this statement,this__assignmentwould__classifyX__aslocal__tothe__nested function,making__ita__different variable;the__codewould__thenprint__Py! instead. 7.Although__thevalues__oflocal__variablesgo__awaywhen__afunction__returns,you__canmake__aPython__functionretain__stateinformation__byusing__sharedglobal__variables,nonlocal__enclosingscope__referenceswithin__nested functions,or__usingdefault__argument values.Function__attributesalso__allowstate__tobe__attachedto__thefunction__itself,instead__oflooked__upin__scopes.Another__alternative,using__classesand__OOP,sometimes__supportsstate__retentionbetter__thanany__ofthe__scope-basedtechniques__becauseit__makesit__explicitwith__attribute assignments;we__llexplore__thisoption__inPart__VI.Changing__mutableobjects__inscopes__anddefaults__works too,but__maynot__belegal__insome__locales.WHY__YOUWILL__CARE:CUSTOMIZING__OPENFor__anotherexample__ofclosures__at work,consider__changingthe__built-inopen__callto__acustom__versionas__suggestedearlier__inthis__chapter.If__thecustom__versionneeds__tocall__the original,it__mustsave__itbefore__changing it,and__retainit__forlater__usea__classicstate__retention scenario. Moreover,if__wewish__tosupport__multiplecustomizations__tothe__same function,globals__wont__do:we__need per-customizer state.The__following,coded__infile__makeopen.py,is__oneway__toachieve__this.It__usesa__nestedscope__closureto__remembera__valuefor__later use,without__relyingon__globalvariables__whichcan__clashand__allowjust__one value,and__withoutusing__aclass__thatmay__requiremore__codethan__iswarranted__here:import__builtinsdef__makeopen(id):original__= builtins.opendef__custom(*pargs, **kargs): print(f'Customopen__call {id}' , pargs, kargs)return__original(*pargs, **kargs) builtins.open =custom__Tochange__openfor__everymodule__ina__process,this__codereassigns__itin__the built-inscope__toa__customversion__codedwith__anested__def,after__savingthe__originalin__theenclosing__scopeso__thecustomization__cancall__it later.This__codeis__partiallya__preview,as__itrelies__on starred-argumentforms__tocollect__andlater__unpackarbitrary__positionaland__keywordarguments__meantfor__opena__topiccoming__upin__thenext__chapter.Much__ofthe__magic here, though,is__scope closures:the__customopen__foundby__theLEGB__ruleretains__the original: >>>file__= '../Chapter14/data.txt' >>>F__= open(file) #Call__built-inopen__inbuiltins__>>> F.read() 'Testingfile__IO\nLearning Python, 6E\nPython 3.12\n' >>>from__makeopenimport__makeopen #Import__openresetter__function >>> makeopen('MOD1') #Custom__opencalls__built-inopen__>>>F__= open(file) #Call__customopen__inbuiltins__Customopen__call MOD1 ('../Chapter14/data.txt',) {} >>> F.read() 'Testingfile__IO\nLearning Python, 6E\nPython 3.12\n'Because__eachcustomization__remembersthe__former built-inscope__versionin__itsown__enclosing scope,they__caneven__benested__naturallyin__waysthat__globalvariables__cannotsupport__eachcall__tothe__makeopenclosure__functionremembers__itsown__versionsof__idand__original,so__multiplecustomizations__maybe__run: >>> makeopen('MOD2') #Nested__customizerswork__too >>>F__= open(file) #Because__eachretains__itsown__stateCustom__opencall__MOD2 ('../Chapter14/data.txt',) {}Custom__opencall__MOD1 ('../Chapter14/data.txt',) {} >>> F.read() 'Testingfile__IO\nLearning Python, 6E\nPython 3.12\n'As__is,our__functionsimply__addspossibly__nestedcall__tracingto__a built-in function,but__thegeneral__techniquemay__haveother__applications.A__class-based__equivalentto__thismay__requiremore__codebecause__itwould__needto__savethe__idand__originalvalues__explicitlyin__objectattributes__butrequires__morebackground__knowledgethan__weyet__have;stay__tunedfor__stateretention__inclasses__inthis__books__Part VI. 1The__scopelookup__rulewas__brandedthe__LGBrule__inthe__firstedition__ofthis__book.The__enclosingE__layerwas__addedlater__inPython__toobviate__thetask__ofpassing__inenclosing__scopenames__explicitlywith__defaultarguments__anadvanced__topicthat__well__samplelater__inthis__chapter.Since__thisscope__isnow__addressedby__thenonlocal__statement,the__lookuprule__mighthave__beenbetter__named LNGB,but__backwardcompatibility__mattersin__books, too.The__presentform__ofthis__acronymalso__doesnot__accountfor__thenewer__obscurescopes__ofcomprehensions__andexception__handlers,but__acronymslonger__thanfour__letterstend__todefeat__their purpose! 2Multithreading__runsfunction__callsin__parallelwith__therest__ofa__programand__issupported__byPython__s standard-librarymodules___thread, threading,and__queue.Because__allthreaded__functionsrun__inthe__same process,global__scopesoften__serveas__oneform__ofshared__memorybetween__them (threadsmay__shareboth__namesin__global scopes,as__wellas__objectsin__aprocess__smemory__space).Threading__iscommonly__usedfor__long-runningtasks__in GUIs,to__implementnonblocking__IO,and__toutilize__CPU capacity.Threading__isalso__wellbeyond__thislanguage__books__scope (aproperty__itshares__withasync__functions,which__arenevertheless__partof__Pythonsyntax__today,as__youll__learnin__Chapter 20).See__Pythons__librarymanual__formore__details.Chapter__18.Arguments__Thepreceding__chapterexplored__Pythons__scopesthe__placeswhere__variablesare__definedand__looked up.As__we saw,the__placewhere__aname__isdefined__inour__codedetermines__muchof__its meaning.This__chaptercontinues__thefunction__storyby__studyingthe__conceptsin__Pythonargument__passingthe__waythat__objectsare__sentto__functionsas__inputs.As__youll__see,arguments__(a.k.a. parameters)are__assignedto__namesin__a function,but__havemore__todo__withobject__referencesthan__withvariable__scopes.You__llalso__findthat__Pythonprovides__extra tools,such__as keywords, defaults,and__argumentcollectors__and extractors,that__allowarguments__tobe__sentto__functions flexibly. Argument-PassingBasics__Earlierin__thispart__ofthe__book,we__learnedthat__defand__lambdaare__function definitions,and__bothinclude__argument-listheaders__thatname__variableswhich__receivevalues__passedby__calls.These__argumentsare__usedin__function bodies,and__maybe__matchedbetween__calland__headerby__position, name,and__othermeans__well__explorelater__inthis__chapter.More__fundamentally, though,it__wasalso__notedthat__allPython__argumentsare__passedby__assignmentwhich__meansobject__reference.This__hassome__subtleramifications__thataren__talways__obviousto__newcomers.Let__sstart__ourarguments__adventureby__exploringhow__this works.Here__isa__rundownof__thekey__pointsin__this model:Arguments__arepassed__byautomatically__assigningobjects__tolocal__variable names.Function__argumentsare__justanother__instanceof__Pythonassignment__at work:they__arereferences__toobjects__sent by,and__possiblyshared__with,the__caller.Because__referencesare__implementedas__pointers,all__argumentsare__passedby__opaque pointer.As__forall__assignments,objects__passedas__argumentsare__neverautomatically__copied.Assigning__toargument__namesinside__afunction__doesnot__affectthe__caller.Per__assignment norms,when__thefunction__isrun__bya__call,argument__namesin__thefunction__headersimply__becomenew__namesin__thelocal__scopeof__the function.There__isno__aliasingbetween__functionargument__namesand__variablenames__inthe__callers__scope.Changing__amutable__objectargument__ina__functionmay__impactthe__caller.On__theother__hand,as__argumentsare__simplyreferences__to passed-in__objects,functions__canchange__passed-inmutable__objectsin__place,and__theresults__mayaffect__the caller. Hence,mutable__argumentscan__beboth__inputand__outputfor__functions.For__moredetails__on references,see__Chapter 6;everything__westudied__therealso__appliesto__function arguments,though__theassignment__toargument__namesis__automaticand__implicit.Python__s pass-by-assignmentscheme__isnt__quitethe__sameas__C++s__referenceparameters__option,but__itturns__outto__besimilar__tothe__argument-passingmodel__ofthe__Clanguage__(and others)in__practice.You__dont__needto__knowthese__languagesto__use Python,of__course,but__thecomparison__mighthelp__thosewith__backgroundsin__other tools:Immutable__argumentshave__thesame__effectas__passingby__value.Objects__suchas__integersand__stringsare__passedby__objectreference__insteadof__by copying,but__becauseyou__cannever__changeimmutable__objectsin__place anyhow,the__netresult__ismuch__likemaking__acopy__inother__languages:the__callers__valuesnever__morph.Mutable__argumentshave__thesame__effectas__passingby__pointer.Objects__suchas__listsand__dictionariesare__alsopassed__byobject__reference,which__hassimilar__consequencesto__passingarrays__aspointers__in C:mutable__objectscan__bechanged__inplace__withinthe__function,with__sideeffects__likethose__forC__s arrays.If__youve__neverused__C,Python__s argument-passingmode__willseem__simplerstill__itinvolves__justthe__assignmentof__objectreferences__to names,and__itworks__thesame__whetherthe__objectsare__mutableor__not.Arguments__andShared__ReferencesTo__demo argument-passingproperties__at work,consider__thefollowing__code: >>>def__f(a): #a__isassigned__areference__tothe__passedobject__a = 99 #Changes__localvariable__aonly__>>>b__= 88 >>> f(b) #a__andb__bothreference__same 88initially__>>>b__#But__bis__notchanged__byassignment__toa__inf__88In__this example,the__variablea__isassigned__theobject__88at__themoment__thefunction__iscalled__with f(b),but__alives__onlywithin__thecalled__functions__local scope.Changing__ainside__thefunction__hasno__effecton__theplace__wherethe__functionis__called;it__simplyresets__thelocal__variablea__toa__completelydifferent__object, 99.That__swhat__ismeant__bya__lackof__namealiasing__assignmentto__anargument__nameinside__afunction__(e.g., a=99)does__notmagically__changea__variablelike__bin__thescope__ofthe__function call.Argument__namesmay__sharepassed__objectsinitially__(theyare__essentiallypointers__tothose__objects),but__only temporarily,when__thefunction__isfirst__called.As__soonas__anargument__nameis__reassigned,this__relationship ends.At__least,that__sthe__casefor__assignmentto__argumentnames__themselves.When__argumentsare__passedmutable__objectslike__listsand__dictionaries,we__alsoneed__tobe__awarethat__in-placechanges__tosuch__objectsmay__liveon__aftera__function exits,and__henceimpact__callers.Here__san__examplethat__demonstratesthis__behavior: >>>def__changer(a, b): #Arguments__assignedreferences__toobjects__a = 2 #Changes__local name'svalue__only b[0] = 'mod' #Changes__sharedobject__in place:outlives__call >>>X__= 1 >>>L__= [1, 2] # Caller: >>> changer(X, L) #Pass__immutableand__mutableobjects__>>> X,L__#X__is unchanged,but__Lis__different! (1, ['mod', 2])In__this code,the__changerfunction__assignsvalues__toargument__a itself,and__toa__componentof__theobject__referencedby__argument b.These__twoassignments__withinthe__functionare__onlyslightly__differentin__syntaxbut__haveradically__different results:Because__ais__alocal__variablename__inthe__functions__scope,the__firstassignment__hasno__effecton__thecaller__itsimply__changesthe__localvariable__ato__referencea__completelydifferent__object,and__doesnot__changethe__valueof__thename__Xin__thecaller__s scope.This__isthe__sameas__inthe__prior example.Argument__bis__alocal__variable name, too,but__itis__passeda__mutableobject__thelist__thatL__alsoreferences__inthe__callers__scope.Because__theassignment__to b[0]in__thefunction__isan__in-placechange__toa__shared object,its__resultimpacts__thevalue__ofL__afterthe__function returns. Really,the__secondassignment__statementin__changerdoesn__tchange__bit__changespart__ofthe__objectthat__bcurrently__references.This__in-placechange__impactsthe__calleronly__becausethe__changedobject__outlivesthe__function call.The__nameL__hasnt__changedeither__itstill__referencesthe__same,changed__objectbut__itseems__asthough__Ldiffers__afterthe__callbecause__thevalue__itreferences__hasbeen__modifiedwithin__the function.In__effect,the__listname__Lserves__asboth__inputto__andoutput__fromthe__function.Figure__18-1illustrates__the name/objectbindings__thatexist__immediatelyafter__thefunction__hasbeen__called,and__beforeits__codehas__run.When__thecall__begins,two__objectsare__sharedamong__four names.If__thisexample__isstill__confusing,it__mayhelp__tonotice__thatthe__effectof__theautomatic__assignmentsof__the passed-inarguments__isthe__sameas__runninga__seriesof__simpleassignment__statements.In__termsof__thefirst__argument,the__assignmenthas__noeffect__onthe__caller: >>>X__= 1 >>>a__=X__#They__sharethe__sameobject__>>>a__= 2 #Name__changeresets__'a' only, 'X'is__still 1 >>>X__1Figure__18-1.Function__argumentsand__sharedobject__referencesThe__assignmentthrough__thesecond__argumentdoes__affecta__variableat__the call, though,because__itis__an in-placeobject__change: >>>L__= [1, 2] >>>b__=L__#They__sharethe__sameobject__>>> b[0] = 'mod' # In-placechange__from 'b': 'L'sees__thechange__too >>>L__['mod', 2]If__yourecall__ourdiscussions__aboutshared__mutableobjects__inChapters__6and__9,you__llrecognize__thephenomenon__at work:changing__amutable__objectin__placecan__impactother__referencesto__that object. Here,the__effectis__tomake__oneof__thearguments__worklike__bothan__inputand__anoutput__ofthe__function.Avoiding__MutableArgument__ChangesThis__behaviorof__in-placechanges__tomutable__argumentsisn__ta__bugit__ssimply__theway__argumentpassing__worksin__Python,and__turnsout__tobe__widelyuseful__in practice.Arguments__arenormally__passedto__functionsby__referencebecause__thatis__whatwe__normally want.It__meanswe__canpass__largeobjects__aroundour__programswithout__makingmultiple__copiesalong__the way,and__wecan__easilyupdate__theseobjects__aswe__go.In__fact,as__youll__seein__Part VI,Python__sclass__andOOP__modeldepends__uponchanging__a passed-inself__argumentin__place,to__updatemutable__object state.If__wedon__twant__in-placechanges__withinfunctions__toimpact__objectswe__passto__them, though,we__cansimply__makeexplicit__copiesof__mutable objects,as__wesaw__inChapter__6.For__function arguments,we__canalways__copythe__listat__thepoint__ofcall__withtools__like list, list.copy,or__anempty__slice (dictionarieshave__similarcopy__tools):L__= [1, 2] changer(X, L[:]) #Pass__a copy,so__our 'L'does__notchange__Wecan__alsocopy__withinthe__function itself,if__wenever__wantto__change passed-in objects,regardless__ofhow__thefunction__is called:def__changer(a, b):b__= b.copy() #Copy__inputlist__sowe__don'timpact__callera__= 2 b[0] = 'mod' #Changes__ourlist__copyonly__Bothof__thesecopying__schemesdon__tstop__thefunction__fromchanging__theobject__theyjust__preventthose__changesfrom__impactingthe__caller.To__reallyprevent__changes,we__canalways__convertto__immutableobjects__toforce__the issue. Tuples,for__example,raise__anexception__whenchanges__are attempted:L__= [1, 2] changer(X, tuple(L)) #Pass__a tuple,so__changesare__errors TypeError: 'tuple'object__doesnot__supportitem__assignmentThis__schemeuses__the built-intuple__function,which__buildsa__newtuple__outof__allthe__itemsin__asequence__(really,any__iterable).It__salso__somethingof__anextreme__becauseit__forcesthe__functionto__bewritten__tonever__change passed-in arguments,this__solutionmight__imposemore__limitationson__thefunction__thanit__should,and__soshould__generallybe__avoided (younever__knowwhen__changingarguments__mightcome__inhandy__forother__callsin__the future).Using__thistechnique__willalso__makethe__functionlose__theability__tocall__any list-specificmethods__onthe__argument,including__methodsthat__donot__changethe__objectin__place (e.g. copy,though__tupleshave__adoptedlist__countand__index).The__mainpoint__toremember__hereis__thatfunctions__mightupdate__mutableobjects__likelists__anddictionaries__passedinto__them.This__isnt__necessarilya__problemif__its__expected,and__oftenserves__useful purposes. Moreover,functions__thatchange__passed-inmutable__objectsin__placeare__probablydesigned__andintended__todo__sothe__changeis__likelypart__ofa__well-definedAPI__thatyou__shouldnt__violateby__making copies. However,you__dohave__tobe__awareof__thisproperty__ifobjects__changeout__fromunder__you unexpectedly,check__whethera__calledfunction__mightbe__responsible,and__makecopies__whenobjects__arepassed__if needed.Simulating__OutputParameters__andMultiple__ResultsHere__sanother__functiontopic__fromthe__assignments department.We__vealready__discussedthe__returnstatement__andused__itin__examples.What__wehaven__tyet__seenis__acommon__thoughunusual__codingtechnique__it enables:because__returncan__sendback__anysort__of object,it__canreturn__multiplevalues__bypackaging__themin__atuple__orother__collection type.In__fact,although__Pythondoesn__tsupport__whatsome__languageslabel__callby__referenceargument__passing,we__cansimulate__itby__returningtuples__andassigning__theresults__backto__theoriginal__argumentnames__inthe__caller: >>>def__multiple(x, y):x__= 2 #Changes__localnames__onlyy__= [3, 4]return__x,y__#Return__multiplenew__valuesin__atuple__>>>X__= 1 >>>L__= [1, 2] >>> X,L__= multiple(X, L) #Assign__resultsto__caller'snames__>>> X,L__(2, [3, 4])It__lookslike__thecode__isreturning__twovalues__here,but__its__reallyjust__onea__two-item__tuplewith__theoptional__surroundingparentheses__omitted.After__thecall__returns,we__canuse__tuple (a.k.a. sequence)assignment__tounpack__theparts__ofthe__returned tuple. (Ifyou__veforgotten__whythis__works,flip__backto__Tuplesin__Chapters 4and__9,and__Assignmentsin__Chapter 11.)The__neteffect__ofthis__codingpattern__isto__bothsend__backmultiple__resultsand__simulatethe__outputparameters__ofother__languagesby__explicit assignments. Here,X__andL__changeafter__thecall__butonly__becausethe__codesaid__so.Lists__would work, too,but__tuplessans__()are__lessto__type,and__hence common.Special__Argument-MatchingModes__Aswe__vejust__seen,arguments__arealways__passedby__assignmentin__Python;names__ina__defor__lambdadefinition__sheader__areassigned__referencesto__passed-in__objects.On__topof__this model, though,Python__providesadditional__toolsthat__alterthe__waythe__argumentobjects__ina__callare__matchedwith__argumentnames__inthe__definitionprior__to assignment.These__toolsare__all optional,but__allowus__tocode__functionsthat__supportmore__flexiblecalling__patternsand__arecommonly__usedby__librariesyou__relikely__to encounter.By__default,arguments__arematched__betweencall__anddefinition__by position,from__leftto__right,and__youmust__passexactly__asmany__argumentsas__thereare__argumentnames__inthe__function definition. However,you__canalso__specifymatching__by name,provide__default values,unpack__andcollect__arbitrarilymany__arguments,and__evenspecify__passing-mode requirements.This__sectionpresents__allthese__extratools__witha__quickoverview__followedby__examples,and__aformal__lookat__howthey__interactat__theend__afterwe__vehad__achance__tosee__the basics.Argument__MatchingOverview__Beforewe__getinto__syntax details,it__simportant__tostress__thatthese__specialmodes__areoptional__anddeal__onlywith__matchingobjects__to names;the__underlyingpassing__mechanismafter__thematching__takesplace__isstill__assignment.In__fact,some__ofthese__toolsare__intendedmore__forpeople__writinglibraries__thanfor__application developers.That__said,you__maystumble__acrossthese__modeseven__ifyou__dont__codethem__yourself,so__thefollowing__summarizesall__the options: Positionals:matched__fromleft__toright__Thenormal__case,which__weve__mostlybeen__usingso__far,is__tomatch__argumentvalues__(passedin__a call)to__argumentnames__(listedin__afunction__definition)by__position,from__leftto__right. Keywords:matched__byargument__name Alternatively,callers__canexplicitly__specifywhich__argumentin__thefunction__isto__receivea__value,by__givingthe__definitions__namefor__theargument__with name=value syntax. Defaults:specify__valuesfor__optionalarguments__thataren__tpassed__Functionsthemselves__canspecify__defaultvalues__forarguments__toreceive__ifthe__callpasses__toofew__values,again__usingthe__name=value syntax.Starred__collectors:collect__arbitrarilymany__positionalor__keywordarguments__Functiondefinitions__canuse__specialarguments__precededwith__oneor__two *characters__tocollect__anarbitrary__numberof__argumentsafter__other matching.This__featureis__sometimesreferred__toas__varargs,after__a variable-lengthargument__listtool__inthe__C language;in__Python,the__argumentsare__collectedin__anormal__object.Starred__unpackers:pass__arbitrarilymany__positionalor__keywordarguments__Functioncalls__canalso__usethe__oneor__two *syntax__tounpack__argumentcollections__intoseparate__arguments.This__isthe__inverseof__a *in__afunction__definitionin__thedefinition__itmeans__collectarbitrarily__many arguments,while__inthe__callit__meansunpack__arbitrarilymany__arguments,and__passthem__individuallyas__discrete values. Keyword-only arguments:arguments__thatmust__bepassed__byname__Functiondefinitions__canalso__usea__*in__theirheaders__tospecify__argumentsthat__mustbe__passedby__nameas__keyword arguments,not__position.This__isoften__usedfor__configurationoptions__thataugment__primary arguments. Positional-only arguments:arguments__thatmust__bepassed__byposition__Asof__Python 3.8,function__definitionsmay__additionallyuse__a /in__theirheader__sarguments__listto__specifythat__allarguments__precedingit__mustbe__passedby__position,not__keyword-argument name.Argument__MatchingSyntax__Asa__referenceand__preview,Table__18-1summarizes__thesyntax__thatinvokes__the argument-matching modes.Table__18-1.Function__argument-matchingforms__SyntaxLocation__Interpretation func(value)Caller__Normal argument:matched__byposition__func(name=value)Caller__Keyword argument:matched__byname__func(*iterable)Caller__Passall__objectsin__iterableas__individualpositional__arguments func(**dict)Caller__Passall__key/valuepairs__indict__asindividual__keywordarguments__def func(name)Function__Normal argument:matches__anypassed__valueby__positionor__namedef__func(name=va lue)Function__Defaultargument__value,if__notpassed__inthe__calldef__func(*name)Function__Matchesand__collectsremaining__positionalarguments__ina__tupledef__func(**name)Function__Matchesand__collectsremaining__keywordarguments__ina__dictionarydef__func(*name, name)Function__Argumentsthat__mustbe__passedby__keywordonly__incalls__def func(*,name__)Function__Argumentsthat__mustbe__passedby__keywordonly__incalls__def func(name, / )Function__Argumentsthat__mustbe__passedby__positiononly__incalls__The argument-matchingmodes__listedin__thistable__breakdown__betweenfunction__callsand__definitionsas__follows:In__afunction__call (thefirst__fourrows__ofthe__table)Simple__valuesare__matchedto__definitionarguments__by position,but__usingthe__name=valueform__tellsPython__tomatch__argumentsby__name instead;these__arecalled__keyword arguments.Any__numberof__*iterableor__**dictforms__canbe__usedin__a call,allowing__usto__bundlemany__positionalor__keywordobjects__initerables__and mappings, respectively,and__unpackthem__as separate,individual__argumentswhen__theyare__passedto__the function.In__afunction__definition (therest__ofthe__table)A__simplename__ismatched__byposition__orname__dependingon__howthe__callerpasses__it,but__the name=valueform__specifiesa__default value.The__*nameform__collectsany__extraunmatched__positionalarguments__ina__tuple,and__**namecollects__unmatchedkeyword__argumentsin__a dictionary.In__addition,any__normalor__defaultedargument__namesfollowing__a *nameor__abare__*are__keyword-onlyarguments__andmust__bepassed__bykeyword__in calls,and__argumentspreceding__a /are__positional-onlyarguments__thatmust__notbe__passedby__keyword name.Of__these,keyword__argumentsand__defaultsare__probablythe__mostcommonly__usedin__Python code.We__veinformally__usedboth__ofthese__earlierin__this book:We__vealready__usedkeywords__tospecify__optionsto__theprint__function,but__theyare__moregeneral__keywordsallow__usto__labelany__argumentwith__its name,to__makecalls__moreexplicit__and informational.We__metdefaults__earlier, too,as__away__topass__invalues__fromthe__enclosingfunction__s scope,but__theyare__alsomore__generalthey__allowus__tomake__anyargument__optional,providing__itsdefault__valuein__afunction__definition.As__youll__see ahead,the__combinationof__defaultsin__afunction__definitionand__keywordsin__acall__furtherallows__usto__pickand__choosewhich__defaultsto__overrideper__call.In__short,special__argument-matchingmodes__letyou__befairly__liberalabout__howmany__argumentsmust__bepassed__toa__function.If__afunction__specifies defaults,they__areused__ifyou__passtoo__few arguments.If__afunction__usesthe__* argument-collector__forms,you__canseemingly__passtoo__many arguments;the__*names__collectthe__extraarguments__indata__structuresfor__processingwithin__the function.Argument__PassingDetails__Ifyou__chooseto__useand__combinethe__special argument-matching modes,Python__willask__youto__followsome__orderingrules__amongthe__modesoptional__components.We__regoing__todefer__fulland__formalcoverage__ofthese__untilwe__vehad__achance__toobserve__thesemodes__in action,but__assome__initial tips:In__afunction__call,any__numberof__positionals, keywords,and__starredunpackings__canbe__used,but__positionalarguments__mustprecede__keywordarguments__and **dict unpackings,and__*iterableunpackings__mustprecede__**dict unpackings.In__afunction__definition,arguments__mustappear__inthis__order:any__positional-only arguments;followed__byany__positional-or-keyword arguments;followed__bythe__optional *namepositional__collectoror__*and__any keyword-only arguments;followed__bythe__optional **namekeyword__collector.Arguments__canhave__optionaldefaults__(name=value),but__oncea__defaultis__used,all__argumentsmust__usedefaults__upto__a *,after__which keyword-onlyarguments__allowdefaults__andnondefaults__tobe__freely mixed.If__youmix__argumentsin__anyother__order,you__willget__asyntax__errorbecause__thecombinations__canbe__ambiguous.The__stepsthat__Pythoninternally__carriesout__tomatch__argumentsbefore__assignmentcan__roughlybe__describedas__follows: 1.Unpack__all *argsat__thecall__intononkeyword__arguments. 2.Unpack__all **argsat__thecall__intokeyword__arguments. 3.Assign__nonkeywordarguments__by position. 4.Assign__keywordarguments__bymatching__names. 5.Collect__extranonkeyword__argumentsin__the *name tuple. 6.Collect__extrakeyword__argumentsin__the **name dictionary. 7.Assign__defaultvalues__tounassigned__arguments.After__argumentsin__calland__definitionare__matched,Python__checksto__makesure__eachargument__ispassed__justone__value (orelse__anerror__is raised)and__thenassigns__argumentnames__tothe__objectspassed__tothem__andruns__thefunction__body.The__actualmatching__algorithmPython__usesis__abit__more complex,so__well__deferto__Pythons__standardlanguage__manualfor__amore__exact description.It__snot__required reading,but__tracingPython__smatching__algorithmmay__helpyou__tounderstand__someconvoluted__cases,especially__whenmodes__are mixed.We__llreturn__tothe__orderingrules__infunction__callsin__definitionswith__higherfidelity__afterwe__vehad__achance__tomeet__allthe__players.Let__sget__startedin__thenext__sectionwith__themost__commonof__the bunch.NOTE__Butannotations__are moot:Argument__namesin__adef__statement (only)can__alsohave__annotation values,specified__as name:annot,or__name:annot=defaultwhen__defaultsare__present.This__issimply__additionalsyntax__forarguments__anddoes__notaugment__orchange__argument-ordering rules.The__functionitself__canalso__havean__annotation value,given__asdef__f( )->annot,and__Pythonattaches__allannotation__valuesto__thefunction__object.See__thediscussion__offunction__annotationin__Chapter 19for__more details,and__thesection__ontheir__rolein__unusedtype__hintingin__Chapter 6.Keyword__andDefault__ExamplesArgument__passingis__simplerin__codethan__thepreceding__descriptionsmay__imply.First__off,if__youdon__tuse__anyspecial__matching syntax,Python__matchesnames__byposition__fromleft__to right.For__instance,if__youdefine__afunction__thatrequires__three arguments,you__mustcall__itwith__three arguments: >>>def__f(a, b, c): print(a, b, c) >>> f(1, 2, 3) 1 2 3 Here,we__passby__positiona__ismatched__to 1,b__ismatched__to 2,and__so on.This__workslike__itdoes__inmost__otherprogramming__languages.Keywords__In Python, though,you__canbe__morespecific__aboutwhat__goeswhere__whenyou__calla__function.Keyword__argumentsallow__usto__matchby__name,instead__ofby__position.Using__thesame__functiondefinition__buta__different call: >>> f(c=3, b=2, a=1) 1 2 3The__c=3in__this call,for__example,means__send 3to__theargument__named c.More__formally,Python__matchesthe__namec__inthe__callto__theargument__namedc__inthe__function definition,and__thenassigns__thevalue__3to__that argument.The__neteffect__ofthis__callis__thesame__asthat__ofthe__prior call,but__noticethat__the left-to-rightorder__ofthe__argumentsno__longermatters__whenkeywords__areused__becausearguments__arematched__by name,not__by position.It__seven__possibleto__combinepositional__andkeyword__argumentsin__asingle__call.In__this case,all__positionalsare__matchedfirst__fromleft__toright__inthe__definition,before__keywordsare__matchedby__name: >>> f(1, c=3, b=2) #a__gets 1by__position,b__andc__passedby__name 1 2 3When__mostpeople__seethis__thefirst__time,they__wonderwhy__onewould__usesuch__a tool.Keywords__typicallyhave__tworoles__in Python. First,they__makeyour__callsa__bitmore__self-documenting (assumingthat__youuse__betterargument__namesthan__a, b,and__c!).For__example,a__callof__this form: func(title='Learning Python', edition=6, year=2024, python=3.12)is__muchmore__meaningfulthan__acall__withthree__nakedvalues__separatedby__commas,especially__inlarger__programsthe__keywordsserve__aslabels__forthe__datain__the call: func(title='Learning Python', 6, 2024, 3.12)The__secondmajor__useof__keywordsoccurs__inconjunction__with defaults,which__weturn__to next.Defaults__Wetalked__aboutdefaults__inbrief__earlier,when__discussingnested__function scopes.In__short,defaults__allowus__tomake__selectedfunction__arguments optional;if__notpassed__a value,the__argumentis__assignedits__defaultbefore__thefunction__runs.For__example,here__isa__functionthat__requiresone__argumentand__defaultstwo__others: >>>def__f(a, b=2, c=3): print(a, b, c) #a__required,b__andc__optionalAs__noted earlier,defaults__mustappear__afternondefaults__atthis__pointin__aheader__(theycan__bemixed__aftera__*as__youll__see ahead).When__wecall__this function,we__mustprovide__avalue__for a,either__byposition__orby__keyword; however,providing__valuesfor__band__cis__optional.If__wedon__tpass__valuesto__band__c,they__defaultto__2and__3, respectively: >>> f(1) #Use__defaults 1 2 3 >>> f(a=1) 1 2 3If__wepass__two values,only__cgets__its default,and__whenpassing__three values,no__defaultsare__used: >>> f(1, 4) #Override__defaults 1 4 3 >>> f(1, 4, 5) 1 4 5 Finally,here__ishow__thekeyword__anddefault__features interact.Because__theysubvert__thenormal__left-to-rightpositional__mapping,keywords__allowus__toessentially__skipover__argumentswith__defaults: >>> f(1, c=6) #Choose__defaults:b__inthe__middle 1 2 6 Here,a__gets 1by__position,c__gets 6by__keyword,and__b,in__between,defaults__to 2.Be__carefulnot__toconfuse__thespecial__name=valuesyntax__ina__functiondefinition__anda__function call;in__thecall__itmeans__a match-by-namekeyword__argument,while__inthe__definitionit__specifiesa__defaultfor__anoptional__argument.In__both cases,this__isnot__anassignment__statement (despiteits__appearance);it__isspecial__syntaxfor__thesetwo__contexts,which__modifiesthe__default argument-matching mechanics.Combining__keywordsand__defaultsHere__isa__slightlylarger__examplethat__demonstrateskeywords__anddefaults__in action.In__the following,the__callermust__alwayspass__atleast__twoarguments__(tomatch__codeand__hack),but__theother__twoare__optional.If__theyare__omitted,Python__assignsscript__andapp__tothe__defaultsspecified__inthe__definition:def__func(code, hack, script=0, app=0): #First__2required__print((code, hack, script, app)) func(1, 2) # Output: (1, 2, 0, 0) func(1, app=1, hack=0) # Output: (1, 0, 0, 1) func(code=1, hack=0) # Output: (1, 0, 0, 0) func(script=1, hack=2, code=3) # Output: (3, 2, 1, 0) func(1, 2, 3, 4) # Output: (1, 2, 3, 4)Notice__againthat__whenkeyword__argumentsare__usedin__the call,the__orderin__whichthe__argumentsare__listeddoesn__t matter;Python__matchesby__name,not__by position.The__callermust__supplyvalues__forcode__and hack,but__theycan__begiven__byposition__orby__name.Also__keepin__mindthat__allthe__special definition-side argument-matchingsyntax__were__exploringin__thischapter__worksthe__samein__defand__lambda,though__mostexamples__usethe__former,and__thelatter__returnsresults__implicitly: >>>func__=lambda__code, hack, script=0, app=0: (code, hack, script, app) >>> func(1, 2) (1, 2, 0, 0) >>> func(script=1, hack=2, code=3) (3, 2, 1, 0)NOTE__Bewaremutable__defaults:As__notedin__theprior__chapter,if__youcode__adefault__tobe__amutable__object (e.g.,def__f(a=[])),the__same,single__mutableobject__isreused__everytime__thefunction__islater__calledeven__ifit__ischanged__inplace__withinthe__function.The__neteffect__isthat__theargument__sdefault__retainsits__valuefrom__theprior__calland__isnot__resetto__itsoriginal__valuecoded__inthe__function header.To__resetanew__oneach__call,move__theassignment__intothe__functionbody__instead.Mutable__defaultsallow__state retention,but__thisis__oftenan__unpleasant surprise.Since__thisis__sucha__common trap,we__llpostpone__furtherexploration__untilthis__parts__gotchaslist__atthe__endof__Chapter 21.Arbitrary__ArgumentsExamples__Thelast__two argument-matching extensions, *and__**,are__designedto__supportany__numberof__arguments.Both__canappear__ineither__thefunction__definitionor__afunction__call,and__theyhave__relatedpurposes__inthe__two locations. Definitions:Collecting__argumentsThe__first use,in__thefunction__definition,collects__unmatchedpositional__argumentsinto__a tuple: >>>def__f(*args): print(args)When__thisfunction__is called,Python__collectsall__thepositional__argumentsinto__anew__tupleand__assignsthe__variableargs__tothat__tuple.Because__itis__anormal__tuple object,it__canbe__indexed,stepped__throughwith__afor__loop,and__so on: >>> f() () >>> f(1) (1,) >>> f(1, 2, 3, 4) (1, 2, 3, 4)The__**feature__is similar,but__itonly__worksfor__keywordarguments__itcollects__theminto__anew__dictionary,which__canthen__beprocessed__withnormal__dictionary tools.In__a sense,the__**form__allowsyou__toconvert__fromkeywords__to dictionaries,which__youcan__thenstep__throughwith__keys calls,dictionary__iterators,and__thelike__(thisis__roughlywhat__thedict__calldoes__whenpassed__keywords,but__itreturns__thenew__dictionary): >>>def__f(**args): print(args) >>> f() {} >>> f(a=1, b=2) {'a': 1, 'b': 2} Finally,function__definitionscan__combinenormal__arguments,the__*,and__the **to__implementwildly__flexiblecall__signatures.For__instance,in__the following, 1is__passedto__aby__position, 2and__3are__collectedinto__thepargs__positional tuple,and__xand__ywind__upin__thekargs__keyword dictionary: >>>def__f(a, *pargs, **kargs): print(a, pargs, kargs) >>> f(1, 2, 3, x=1, y=2) 1 (2, 3) {'x': 1, 'y': 2}Notice__thatthe__dictionarys__keysare__ordered here:as__ofPython__3.6,the__**collector__skeys__preservethe__orderin__whichkeyword__argumentswere__passedto__the function.This__relieson__theinsertion__orderof__keysin__dictionariesat__large (seeChapter__8for__arefresher__ifyou__veforgotten__whatthat__means).Functions__withboth__*and__**may__be rare,but__theyshow__upin__functionsthat__needto__supportmultiple__callpatterns__(forbackward__compatibility,for__instance).In__fact,these__featurescan__becombined__ineven__morecomplex__waysthat__mayseem__ambiguousat__firstglance__anidea__wewill__revisitlater__inthis__chapterwhen__welock__downordering__rules. First, though,let__ssee__whathappens__when *and__**are__codedin__functioncalls__insteadof__definitions. Calls:Unpacking__argumentsIt__turnsout__thatwe__canuse__the *syntax__whenwe__calla__function, too.In__this context,its__meaningis__theinverse__ofits__meaningin__thefunction__definitionit__unpacksa__collectionof__arguments,rather__thanbuilding__acollection__of arguments.For__example,we__canpass__fourarguments__toa__functionin__atuple__orother__iterable,and__letPython__unpackthem__intoindividual__positional arguments: >>>def__func(a, b, c, d): print(a, b, c, d) >>>args__= (1, 2) >>>args__+= (3, 4) >>> func(*args) #Same__as func(1, 2, 3, 4) 1 2 3 4 Similarly,the__**syntax__ina__functioncall__unpacksa__dictionaryor__othermapping__of key/valuepairs__intoseparate__keyword arguments: >>>args__= {'a': 1, 'b': 2, 'c': 3} >>> args['d'] = 4 >>> func(**args) #Same__as func(a=1, b=2, c=3, d=4) 1 2 3 4 Moreover,we__canuse__otheriterables__likelists__andother__dictionarysyntax__like dict,and__wemay__combine star, positional,and__keywordarguments__inthe__callin__veryflexible__ways: >>> func(*(1, 2), **{'d': 4, 'c': 3}) #Same__as func(1, 2, d=4, c=3) 1 2 3 4 >>> func(1, *[2, 3], **dict(d=4)) #Same__as func(1, 2, 3, d=4) 1 2 3 4 >>> func(1, c=3, *[2], **{'d': 4}) #Same__as func(1, 2, c=3, d=4) 1 2 3 4 >>> func(1, *(2, 3), d=4) #Same__as func(1, 2, 3, d=4) 1 2 3 4 >>> func(1, *[2], c=3, **dict(d=4)) #Same__as func(1, 2, c=3, d=4) 1 2 3 4While__thepreceding__servesto__demothe__possibilities,its__useof__starsand__literalsis__overkillwhen__argumentsare__known;more__typicalcode__wouldbuild__upargument__collectionsahead__ofthe__calland__unpackby__names: >>> pargs,kargs__= (1, 2), dict(d=4, c=3) >>> func(*pargs, **kargs) 1 2 3 4Star__unpackingis__convenientwhen__youcannot__predictthe__numberof__argumentsthat__willbe__passedto__afunction__whenyou__writeyour__script;you__canbuild__upa__collectionof__argumentsat__runtimeinstead__andcall__thefunction__genericallythis__way.Here__again, though,don__tconfuse__the */** starred-argumentsyntax__inthe__functiondefinition__andthe__functioncall__inthe__definitionit__collectsany__numberof__arguments,while__inthe__callit__unpacksany__numberof__arguments.In__both,one__starmeans__positionals,and__twoapplies__to keywords. Finally,as__ofPython__3.5,and__asnoted__inChapter__11s__sidebarThe__ManyStars__ofPython__,we__caneven__usemultiple__*and__**items__incalls__tounpack__multipleiterables__and mappings, respectively.The__*unpacks__intopositional__arguments,and__**into__keyword arguments,though__singlestars__mustprecede__double stars,per__formalrules__comingup__ahead. Again,the__followinguses__literalsto__demo,but__thesewould__usuallybe__namesassigned__toprebuilt__values: >>>def__func(a, b, c, d): print(a, b, c, d) >>> func(*[1], *(2,), **dict(c=3), **{'d': 4}) # *Positionals + **keywords 1 2 3 4 >>> func(*[1], *(2,), *[3, 4]) #All__*positionals 1 2 3 4 >>> func(**dict(a=1, b=2), **dict(c=3), **{'d': 4}) #All__**keywords 1 2 3 4 >>> func(*[1], 2, **dict(c=3), d=4) #All__callmodes__at once! 1 2 3 4 >>> func(*[1], **dict(b=2, c=3), *[4]) SyntaxError:iterable__argumentunpacking__followskeyword__argumentunpacking__NOTEUnpacking__generalityand__inconsistency:As__previewedin__Chapter 14,the__*form__ina__callis__aniteration__tool,so__itaccepts__anyiterable__object,not__justtuples__orother__sequencesused__inexamples__here.For__instance,iterables__likezip__andrange__workafter__a *too__andunpack__intoindividual__arguments,and__fileobjects__automaticallyread__andunpack__their lines: func(*range(4)) #Same__as func(0, 1, 2, 3) func(*open('filename')) # Read+passlines__asarguments__Watchfor__moreexamples__ofthis__utilityin__Chapter 20,after__westudy__generators.On__the downside,stars__alsocome__with inconsistencies.For__one,this__generalityholds__trueonly__forcalls__a *unpacking__ina__callallows__any iterable,but__a *in__afunction__definitionalways__collectsextra__argumentsinto__a tuple. Moreover,this__collectionbehavior__indefinitions__issimilar__inspirit__andsyntax__tothe__*in__the extended-unpackingassignment__formswe__metin__Chapter 11 (e.g., x, *y = z),but__thatstar__usagealways__creates lists,not__tuples. Again:these__aredifferent__rulesfor__differenttools__despitethe__same syntax.Why__arbitrary arguments?The__priorsection__sexamples__mayseem__academic (ifnot__downright esoteric),but__theyare__usedmore__oftenthan__youmight__expect.Some__programsneed__tocall__arbitraryfunctions__ina__generic fashion,without__hardcodingtheir__namesor__argumentsahead__of time.In__fact,the__realpower__ofthe__special starred-unpackingcall__syntaxis__thatyou__dont__needto__knowhow__manyarguments__afunction__callrequires__beforeyou__writea__script.For__example,you__canuse__iflogic__toselect__froma__setof__functionsand__argument lists,and__callany__ofthem__generically (functionshere__are hypothetical):if__sometest: action,args__= func1, (1,) #Call__func1with__onearg__inthis__case else: action,args__= func2, (1, 2, 3) #Call__func2with__threeargs__instead action(*args) #Dispatch__genericallyThis__leveragesboth__the *form__andthe__factthat__functionsare__objectsthat__maybe__bothreferenced__by,and__called through,any__variable.More__generally,this__unpackingcall__syntaxis__usefulanytime__youcannot__predictthe__arguments list.If__youruser__selectsan__arbitraryfunction__viaa__user interface,for__instance,you__maybe__unableto__hardcodea__functioncall__whenwriting__your script.To__workaround__this,simply__buildup__thearguments__listwith__sequence operations,and__callit__with starred-argumentsyntax__tounpack__the arguments:args__= (2,3)args__+= (4,) func3(*args)Because__thearguments__listis__passedin__asa__tuple here,the__programcan__buildit__at runtime.This__techniquealso__comesin__handyfor__functionsthat__testor__timeother__functions.For__instance,the__codein__Example 18-1supports__anyfunction__withany__argumentsby__passingalong__whateverarguments__weresent__in (see tracer0.pyin__theexample__package).Example__18-1. tracer0.pydef__tracer(func, *pargs, **kargs): #Accept__arbitraryarguments__print('calling:', func.__name__)return__func(*pargs, **kargs) #Pass__alongarbitrary__argumentsdef__func(a, b, c, d):return__a +b__+c__+d__print(tracer(func, 1, 2, c=3, d=4))This__codeuses__the built-in__name____attributeattached__toevery__function (asyou__might expect,it__sthe__functions__name string),and__usesstars__tocollect__andthen__unpackthe__argumentsintended__forthe__traced function.In__other words,when__thiscode__is run,arguments__areintercepted__bythe__tracerand__thenpropagated__withunpacking__call syntax: $ python3 tracer0.py calling:func__10For__anotherexample__ofthis__technique,see__thepreview__nearthe__endof__thepreceding__chapter,where__itwas__usedto__resetthe__built-inopen__function (thoughit__probablymakes__moresense__toyou__now).We__llcode__additionalexamples__ofsuch__roleslater__inthis__book;see__especiallythe__sequencetiming__examplesin__Chapter 21and__thevarious__decoratorutilities__wewill__codein__Chapter 39 (aftera__previewin__thenext__chapter).It__sa__commontechnique__ingeneral__tools. Keyword-OnlyArguments__Besidesaccepting__keyword (i.e., pass-by-name)arguments__in general,function__definitionscan__alsospecify__thatsome__argumentsmust__alwaysbe__passedby__keywordonly__andwill__neverbe__filledin__bya__positional argument.This__extension,known__as keyword-only arguments,can__beuseful__ifwe__wanta__functionto__bothprocess__anynumber__ofarguments__andaccept__possiblyoptional__configuration options. Syntactically, keyword-onlyarguments__arecoded__asnamed__argumentsthat__mayappear__after *namein__thearguments__list.All__sucharguments__mustbe__passedusing__keywordsyntax__inthe__call.For__example,in__the following,a__maybe__passedby__nameor__position,b__collectsany__extrapositional__arguments,and__cmust__bepassed__bykeyword__only: >>>def__kwonly(a, *b, c): print(a, b, c) >>> kwonly(1, 2, c=3) 1 (2,) 3 >>> kwonly(a=1, c=3) 1 () 3 >>> kwonly(1, 2, 3) TypeError: kwonly()missing__1required__keyword-only argument: 'c'If__wedon__tneed__tocollect__arbitrary positionals,we__canalso__usea__bare *character__byitself__inthe__argumentslist__tointroduce__keyword-only arguments.This__indicatesthat__afunction__doesnot__accepta__variable-lengthargument__listbut__stillexpects__allarguments__followingthe__*to__bepassed__as keywords.In__thenext__function,a__maybe__passedby__positionor__name again,but__band__cmust__be keywords,and__noextra__positionalsare__allowed: >>>def__kwonly(a, *, b, c): print(a, b, c) >>> kwonly(1, c=3, b=2) 1 2 3 >>> kwonly(c=3, b=2, a=1) 1 2 3 >>> kwonly(1, 2, 3) TypeError: kwonly()takes__1positional__argumentbut__3were__given >>> kwonly(1) TypeError: kwonly()missing__2required__keyword-only arguments: 'b'and__'c'You__canstill__usedefaults__for keyword-only arguments,even__thoughthey__appearafter__the *in__the function.In__the following,a__maybe__passedby__nameor__position,and__band__care__optionalbut__mustbe__passedby__keywordif__used: >>>def__kwonly(a, *, b='code', c='app'): print(a, b, c) >>> kwonly(1) 1code__app >>> kwonly(1, c='hack') 1code__hack >>> kwonly(a='py')py__codeapp__>>> kwonly(c=3, b=2, a=1) 1 2 3 >>> kwonly(1, 2) TypeError: kwonly()takes__1positional__argumentbut__2were__givenIn__fact, keyword-onlyarguments__withdefaults__are optional,but__thosewithout__defaultseffectively__becomerequired__keywordsfor__thefunction__likeb__inthe__following: >>>def__kwonly(a, *, b, c='hack'): print(a, b, c) >>> kwonly(1, b='code') 1code__hack >>> kwonly(1, c='code') TypeError: kwonly()missing__1required__keyword-only argument: 'b' >>> kwonly(1, 2) TypeError: kwonly()takes__1positional__argumentbut__2were__givenAs__noted earlier, keyword-onlyarguments__alsoallow__defaultsand__nondefaultsto__be mixed,unlike__theirotherwise__moreflexible__cohortscoded__beforethe__optional *an__ostensibleinconsistency__well__returnto__later: >>>def__kwonly(a, *, b=2, c, d=4): print(a, b, c, d) >>> kwonly(1, c=3) 1 2 3 4 >>> kwonly(1, c=5, b=6) 1 6 5 4 >>> kwonly(1) TypeError: kwonly()missing__1required__keyword-only argument: 'c' >>> kwonly(1, 2, 3) TypeError: kwonly()takes__1positional__argumentbut__3were__given >>>def__badmix(b=2, c, d=5): SyntaxError:parameter__withouta__defaultfollows__parameterwith__adefault__Finally,note__that keyword-onlyarguments__mustbe__specifiedafter__asingle__star,not__twonothing__canappear__afterthe__**args arbitrary-keywords form, and,unlike__*,a__**can__tappear__byitself__inthe__arguments list.More__generally, keyword-onlyarguments__mustbe__codedbetween__the *and__theoptional__**,and__anargument__thatappears__before *is__apossibly__defaultargument__thatcan__bepassed__byposition__or keyword,not__keyword-only: >>>def__kwonly(a, **kargs, b, c): SyntaxError:arguments__cannotfollow__var-keywordargument__>>>def__kwonly(a, **, b, c): SyntaxError:invalid__syntax >>>def__mixed(a, *b, **d, c=6): SyntaxError:arguments__cannotfollow__var-keywordargument__Thesefailures__willmake__moresense__afterwe__getformal__aboutargument__orderingrules__laterin__this chapter.They__mayalso__appearto__beworst__casesin__theartificial__examples here,but__theycan__comeup__inreal__practice,especially__forpeople__whowrite__librariesfor__otherPython__programmersto__usewhich__leadsto__thenext__point.Why__keyword-only arguments?So__whycare__about keyword-only arguments?In__short,they__makeit__easierto__allowa__functionto__acceptboth__anynumber__ofpositional__argumentsto__be processed,and__configurationoptions__passedas__keywords.While__theiruse__is optional,without__keyword-onlyarguments__extrawork__maybe__requiredto__providedefaults__forsuch__optionsand__toverify__thatno__superfluouskeywords__were passed.Imagine__afunction__thatprocesses__aset__of passed-inobjects__andallows__atracing__flagto__be passed: process(X, Y, Z) #Use__flag'sdefault__process(X, Y, notify=True) #Override__flagdefault__Without keyword-onlyarguments__wehave__touse__both *argsand__**argsand__manuallyinspect__the keywords,but__with keyword-onlyarguments__lesscode__is required.The__followingguarantees__thatno__positionalargument__willbe__incorrectlymatched__againstnotify__andrequires__thatit__bea__keywordif__passed:def__process(*args, notify=False):Since__were__goingto__explorea__morerealistic__exampleof__thislater__inthis__chapter,in__Example:Rolling__YourOwn__Print ,we__llpostpone__therest__ofthis__storyuntil__then.For__anadditional__exampleof__keyword-onlyarguments__in action,see__theupcoming__iteration-optionstiming__casestudy__inTimer__Module:Take__2 . Positional-OnlyArguments__Beginningwith__Python 3.8,function__definitionsmay__alsoinclude__a /in__thearguments__listto__designatethat__allarguments__precedingit__(i.e.,to__its left)must__bepassed__by position,not__by keyword-argument name.Though__arguablyad__hocon__firstsighting__inan__arguments list,this__notationwas__beingused__indocumentation__for built-infunctions__thatdid__notaccept__keywords;making__itavailable__tofunction__codersas__partof__Pythons__syntaxwas__deemeda__logicalextension__forlibrary__developerswho__maynot__wantto__exposeargument__namesfor__useby__clientsas__keywords.To__demo,the__followingfunction__specifiesthat__aand__bmust__bepassed__by position,though__cis__more flexible: >>>def__mostlypos(a, b, /, c): print(a, b, c) >>> mostlypos(1, 2, 3) 1 2 3 >>> mostlypos(1, 2, c=3) 1 2 3Passing__eitherof__thefirst__twoarguments__by keyword, however, fails: >>> mostlypos(1, b=2, c=3) TypeError: mostlypos()got__some positional-onlyarguments__passedas__keyword arguments: 'b' >>> mostlypos(c=3, b=2, a=1) TypeError: mostlypos()got__some positional-onlyarguments__passedas__keyword arguments: 'a, b'To__definea__functionthat__allowsonly__positional arguments,simply__codethe__slashat__the end: >>>def__allpos(a, b, c, /): print(a, b, c) >>> allpos(1, 2, 3) 1 2 3 >>> allpos(1, 2, c=3) TypeError: mostlypos()got__some positional-onlyarguments__passedas__keywordAs__youshould__expect,the__slashworks__thesame__ina__lambdaargument__list: >>>f__=lambda__a, b, /, c: print(a, b, c) >>> f(1, 2, c=3) 1 2 3 >>> f(1, b=2, c=3) TypeError: ()got__some positional-onlyarguments__passedas__keywordAnd__functionscan__combine positional-and__keyword-onlyarguments__tobe__asrigid__asthey__wish: >>>def__combo(a, b, /, *, c, d): print(a, b, c, d) >>> combo(1, 2, c=3, d=4) 1 2 3 4 >>> combo(1, 2, 3, 4) TypeError: combo()takes__2positional__argumentsbut__4were__given >>> combo(a=1, b=2, c=3, d=4) TypeError: combo()got__some positional-onlyarguments__passedas__keywordIt__sup__toyou__toponder__whetheror__notuse__casesfor__thissyntax__justifyits__convolutionof__functiondefinitions__thatfollows__inthe__next section.Given__thatPython__userssomehow__gotby__withoutit__forover__three decades, though,this__seemsa__tough sell.For__moreon__therationale__andusage__ofthe__positional-only slash,see__Pythons__standard manuals.Also__watchfor__anexample__inChapter__21that__usesit__toavoid__nameclashes__andmay__ormay__notbe__compelling.Argument__Ordering:The__GrittyDetails__So far,we__vebeen__fairlyloose__aboutthe__rulessurrounding__argument-matching tools,because__theydon__tcrop__upvery__oftenin__thesimpler__usagepatterns__oftypical__code.In__moresophisticated__roles, though,you__needto__verifythat__yourcode__followsPython__s expectations.Now__thatwe__veseen__allof__its subjects,the__orderingrules__forfunction__argumentscan__finallybe__summarizedin__full.While__functiondefinitions__andcalls__sharesome__similar syntax,their__rulesare__completely different,owing__totheir__different roles.Let__stake__amore__formallook__at both.Definition__OrderingIn__function definitions,argument__listsare__enclosedin__parenthesesin__adef__statementand__codedbefore__acolon__ina__lambda expression,but__followthe__sameformat__in both.In__short,they__consistof__fouroptional__partsthat__mustappear__inthe__following order,where__positionmeans__asimple__valuein__calls,and__keywordmeans__a name=value pair: 1.One__ormore__argumentsthat__mustbe__passedby__position only,followed__bya__single / 2.Any__numberof__argumentsthat__canbe__passedby__eitherposition__orkeyword__3.A__single *by__itselfor__asingle__*name positional-argument collector,optionally__followedby__anynumber__ofarguments__thatmust__bepassed__bykeyword__only 4.A__single **name keyword-argumentcollector__Inall__cases,individual__arguments,including__abare__/or__*,are__separatedby__commas.In__addition,any__nonstarredargument__namecan__havea__name=expression default,but__allnames__musthave__defaultsafter__thefirst__that does,up__tothe__* (keyword-onlyargument__runsfollowing__astar__mayfreely__mixdefault__andnondefault__names).Inherent__inthis__ordering, positional-onlyarguments__mustappear__first, *nameends__positional-argumentruns__andcollects__unmatched positionals,and__**nameends__theentire__argumentslist__andcollects__unmatched keywords.As__noted earlier,the__**namecollector__skeys__retainthe__orderin__whichkeyword__argumentswere__passedto__the function.Formal__definitionMore__concisely,the__orderingof__argumentsin__functiondefinitions__canbe__definedas__follows,where__-or-is__notationfor__achoice__and []encloses__anoptional__part (neitheris__partof__theactual__codeyou__type):def__name(arguments-list):statements__lambda arguments-list:expression__arguments-list = [positional-only-arguments, /] [positional-or-keyword-arguments] [* -or- *positional-collector, [keyword-only-arguments]] [**keyword-collector]As__areal__example,the__followingdefines__afunction__withall__theseparts__in actions: >>>def__f(a, /, b, c=3, *ps, e=4, **ks): print(f'{a=}, {b=}, {c=}, {ps=}, {e=}, {ks=}') >>> f(0, 1, 2, 3, 4, e=5, f=6, g=7) a=0, b=1, c=2, ps=(3, 4), e=5, ks={'f': 6, 'g': 7}Boundary__casesAs__consequencesof__theordering__infunction__definitions, /must__precedea__star,and__the double-starkeyword__collectormust__becoded__last: >>>def__f(a, *ps, /, b):pass__SyntaxError: /must__beahead__of * >>>def__f(a, **ks, b):pass__SyntaxError:arguments__cannotfollow__var-keywordargument__Thoughenforced__separatelyfrom__basic argument-ordering rules,once__adefault__isused__ina__definition,all__subsequentarguments__mustalso__havedefaults__includingthose__followingthe__positional-only / delimiter: >>>def__f(a, b, c=3, d, e):pass__SyntaxError:parameter__withouta__defaultfollows__parameterwith__adefault__>>>def__f(a, b=2, /, c):pass__SyntaxError:parameter__withouta__defaultfollows__parameterwith__adefault__However,this__constraintapplies__onlyto__argumentspreceding__a *or__*namedefaults__andnondefaults__canbe__mixedfreely__in keyword-only arguments,which__seems inconsistent,though__acase__forsanity__couldbe__madehere__onthe__groundsthat__keyword-onlyarguments__nevermatch__by position,which__reducesambiguity__of defaults: >>>def__f(a, *, x=1, y): ... # OK:x__andy__mustbe__keywords >>>def__f(a=1, b, *, x=1): ... #Not__OK:a__andb__maybe__positional SyntaxError:parameter__withouta__defaultfollows__parameterwith__adefault__Notshown__here,def__canalso__bepreceded__bya__decorator (e.g., @value), and,as__noted earlier,any__ofits__argumentsmay__befollowed__byannotations__(e.g., :value)extensions__well__explorein__thenext__chapterand__laterin__this book.Neither__ofthese__impactargument__orderingor__matching,and__neitherwork__inlambda__dueto__itslimited__syntax.Calls__OrderingOn__theother__sideof__the fence,the__syntaxis__similarbut__therules__differ.In__function calls,all__positionalarguments__mustprecede__allkeyword__arguments,and__anynumber__ofstarred__unpackingscan__bemixed__inwith__individual values:one__starunpacks__intomultiple__positional arguments,two__unpacksinto__keywords,and__allpositional__argumentsand__one-starunpackings__mustprecede__all two-star unpackings.In__more detail,function__(andby__extension, method)calls__consistof__threeoptional__partsin__thefollowing__order: 1.Any__combinationof__oneor__moreexpression__positional arguments,and__*expressioniterable__unpackingstransformed__intopositional__arguments 2.Any__combinationof__oneor__more name=expressionkeyword__arguments,and__*expressioniterable__unpackingstransformed__intopositional__arguments 3.Any__combinationof__oneor__more name=expressionkeyword__arguments,and__**expressionmapping__unpackingstransformed__intokeyword__argumentsIn__all cases,all__arguments,starred__or otherwise,are__separatedby__commas.Formal__definitionMore__concisely again,the__orderingof__argumentsin__functioncalls__canbe__definedas__follows,where__functionis__anexpression__thatevaluates__toa__callable object,and__-or-and__[]here__againmean__achoice__andoptional__part,respectively__(theyre__notpart__ofthe__codeyou__type): function([positional-values -or- *iterable-positional-unpackings] [keyword-arguments -or- *iterable-positional-unpackings] [keyword-arguments -or- **mapping-keyword-unpackings])As__aconcrete__example,the__followingpasses__avariety__of positional, keyword,and__unpackingarguments__(thiscode__servesas__ademo__here,but__isnot__exactlythe__sortof__thingyou__shouldstrive__tocraft__in practice!): >>>def__f(a, b, c, d, e, f, g, h, i): print(a, b, c, d, e, f, g, h, i) >>> f(*[1], 2, *[3], 4, f=6, *[5], **dict(g=7), h=8, **{'i': 9}) 1 2 3 4 5 6 7 8 9Boundary__casesAs__oneconsequence__ofthe__argumentordering__in calls,once__youuse__akeyword__argument,you__canno__longeruse__anyunstarred__positionalsall__subsequentarguments__mustalso__be keywords,or__singleor__double stars: >>> f(1, 2, c=3, 4) SyntaxError:positional__argumentfollows__keywordargument__unpackingThis__issimilar__todefaults__indefinitions__butnot__exactly. Again,try__notto__conflatefunction__definitionsand__calls.Despite__theirreuse__ofsimilar__syntax,it__hasvery__differentroles__andrules__inthese__tools.The__*and__=,for__example,are__usedfor__unpackingand__keywordsin__calls,but__meancollection__anddefaults__in definitions.Once__youcode__adouble__star,both__positionalsand__singlestars__arealso__outof__the game,though__thisseems__inconsistenttoo__singlestars__canbe__freelymixed__withkeyword__arguments (whichis__whata__doublestar__unpacks into),and__keywordarguments__cannotbe__mixedwith__positionals (whichis__whata__singlestar__unpacks into): >>> f(1, 2, **{'d': 3}, 4) SyntaxError:positional__argumentfollows__keywordargument__unpacking >>> f(1, 2, **{'d': 3}, *[4]) SyntaxError:iterable__argumentunpacking__followskeyword__argumentunpacking__>>> f(1, 2, d=3, *[4]) # OK,but__why?like__firsterror__above >>> f(1, 2, d=3, 4) #Not__OK,but__why?like__precedingline__SyntaxError:positional__argumentfollows__keywordargument__PerspectiveAnd__ifthis__isstarting__tomake__yourhead__spin,it__probably should.Python__s argument-matchingrules__havebeen__accumulatedover__timeto__incorporatenew__convolutions,and__theyare__complexand__perhapseven__kludgy.The__firstrule__ofprogramming__appliesto__functiondefinitions__andcalls__aseverywhere__else:keep__it simple,unless__ithas__tobe__complex.If__youhave__toagonize__over argument-ordering__rulesto__understand code,it__sprobably__timeto__reevaluate priorities. Example:The__minWakeup__CallOK__its__timefor__somethingmore__realistic.To__makethe__conceptshere__more concrete,the__restof__thischapter__worksthrough__aset__ofexamples__thatdemonstrate__practicalapplications__of argument-matching tools.First__upis__anexercise__borrowedfrom__liveclasses__andused__torouse__learnerslike__youstarting__tosuccumb__tothe__knottinessof__argument rules.Here__sthe__problem statement:suppose__youre__askedto__codea__functionthat__isable__tocompute__theminimum__valuefrom__anarbitrary__setof__arguments,which__maybe__arbitrarysorts__of objects.That__is,the__functionshould__acceptzero__ormore__argumentsas__manyas__youwish__to pass. Moreover,the__functionshould__workfor__allkinds__ofPython__object types: numbers, strings, lists,lists__of lists, files,and__even None.To__keepthis__fair,you__dont__needto__supportdictionaries__ormixed__nonnumeric types,because__neithersupports__direct comparisons,per__Chapters 8and__9.The__firstrequirement__providesa__naturalexample__ofhow__the *feature__canbe__putto__gooduse__wecan__handlearbitrary__argumentsby__collectingthem__ina__tuple,and__steppingover__eachwith__asimple__for loop.The__secondpart__ofthe__problemdefinition__iseasy__in Python:because__nearlyevery__objecttype__supports comparisons,we__dont__haveto__specializethe__functionper__type (anapplication__of polymorphism);we__cansimply__compareobjects__blindlyand__letPython__worryabout__whatsort__ofcomparison__toperform__accordingto__theobjects__being compared.Full__CreditThe__followingscript__file, mins.pyin__Example 18-2,shows__fourways__tocode__thisoperation__(someof__whichwere__suggestedby__studentsin__agroup__exercisedesigned__toprevent__post-lunch napping):The__firstfunction__fetchesthe__firstargument__fromits__args tuple,and__traversesthe__restby__slicingoff__thefirst__(theres__nopoint__incomparing__thefirst__objectto__itself,especially__ifit__mightbe__alarge__structure).The__secondversion__letsPython__pickoff__thefirst__andrest__ofthe__arguments automatically,and__soavoids__anindex__and slice;the__codeis__simpler,and__maybe__faster (thoughit__wouldtake__manycalls__to matter).The__thirdconverts__froma__tupleto__alist__withthe__built-inlist__calland__employsthe__listsort__method:the__firstitem__haslowest__valueafter__an ascending-value sort.The__fourthsorts__too,but__skipsthe__listconversion__(andtwo__lines)by__usingthe__sorted built-in function.Python__sortingtools__arecoded__in C,so__theycan__bequicker__thanthe__otherapproaches__at times,but__thelinear__scansof__thefirst__twotechniques__mayoften__makethem__faster.1Example__18-2. mins.py "Findminimum__valueamong__allpassed__argumentsof__comparable types"def__min1(*args):res__= args[0]for__argin__args[1:]:if__arg < res:res__=arg__returnres__def min2(first, *rest):for__argin__rest:if__arg < first:first__=arg__returnfirst__def min3(*args):tmp__= list(args) tmp.sort()return__tmp[0]def__min4(*args):return__sorted(args)[0]for__funcin__(min1, min2, min3, min4): #Test__all 4functions__print(func.__name__ + '...') print(func(3, 4.0, 1, 2)) #Mixed__numerics print(func('bb', 'aa')) # Strings:code__points print(func([2, 2], [1, 1], [3, 3])) # Lists:recursive__print(func(*'hack')) #Unpacked__charactersThis__scripts__testingcode__usesthe____name__attribute__wemet__earlier,along__witha__forloop__torun__eachfunction__oneat__atime__(remember,functions__areobjects__thatwork__ina__tuple too).All__foursolutions__producethe__sameresult__whenthe__fileis__run,so__well__listjust__thefirst__soutput__here.Run__thisfile__live,or__importit__asa__moduleand__typea__fewcalls__toits__functioninteractively__toexperiment__withthem__onyour__own (seeChapter__3for__tipson__both modes): $ python3 mins.py min1... 1aa__[1, 1]a__andthe__samefor__othersNotice__thatnone__ofthese__fourvariants__testsfor__thecase__whereno__argumentsare__passed in.They__could,but__theres__probablyno__pointin__doingso__herein__allfour__solutions,Python__willautomatically__raisean__exceptionto__signalthe__errorif__noarguments__are sent.The__firstvariant__raisesan__exceptionwhen__wetry__tofetch__argument 0,the__secondwhen__Pythondetects__anargument__list mismatch,and__thethird__andfourth__whenwe__tryto__returnitem__0post__sort.This__isexactly__whatwe__wantto__happenbecause__thesefunctions__supportany__object (including None),there__isno__valuethat__wecould__passback__todesignate__an error,so__wemay__aswell__letthe__exceptionbe__raised.There__areexceptions__tothis__exceptionsrule__(e.g.,you__mighttest__forerrors__yourselfif__youd__ratheravoid__actionsthat__runbefore__reachingthe__codethat__triggersan__error automatically).But__ingeneral__andespecially__whenerrors__arent__commonit__sbetter__toassume__thatarguments__willwork__inyour__functions code,and__letPython__raiseerrors__foryou__whenthey__do not.Bonus__PointsYou__canget__bonuspoints__herefor__changingthese__functionsto__computethe__arguments maximum,rather__than minimum, value.This__ones__trivial:the__firsttwo__versionsonly__requirechanging__<to__>,and__thelast__twosimply__requirethat__wereturn__item [ 1]instead__of [0].For__anextra__point,be__sureto__modthe__functionname__tomax__aswell__(thoughthis__partis__strictly optional).True__curvebusters__mightalso__notethat__its__possibleto__generalizea__singlefunction__tocompute__eithera__minimumor__amaximum__value,by__evaluatingcomparison__expressionstrings__witha__toollike__theeval__built-infunction__(describedin__Pythons__library manual,and__atvarious__appearances here,especially__itsnote__inChapter__10),or__bypassing__inan__arbitrarycomparison__function.Example__18-3shows__howto__implementthe__latterscheme__forone__ofthe__coding options.Example__18-3. minmax.py "Findminimum__-or-maximum__valueof__arguments"def__minmax(test, *args):res__= args[0]for__argin__args[1:]:if__test(arg, res):res__=arg__returnres__def lessthan(x, y):return__x <y__#See__also: lambda,eval__def grtrthan(x, y):return__x >y__print(minmax(lessthan, 4, 2, 1, 5, 6, 3)) # Self-testcode__print(minmax(grtrthan, 4, 2, 1, 5, 6, 3))Running__thisscript__printsboth__minimumand__maximum,per__its self-testcode__atthe__end: $ python3 minmax.py 1 6 Again,functions__arejust__anotherkind__of object,which__allowsthem__tobe__passedinto__otherfunctions__asdone__here.To__makethis__amax__(or other) function,for__example,we__simplypass__inthe__rightsort__oftest__functionto__minmax.This__mayseem__likeextra__work,but__themain__pointof__generalizingfunctions__thisway__insteadof__cuttingand__pastingto__changejust__asingle__characteris__thatwe__llonly__haveone__versionto__changein__the future,not__two.The__PunchLine__Of course,all__thiswas__justa__coding exercise.There__sreally__noreason__towrite__minor__max functions,because__bothare__built-insin__Python!We__metthem__brieflyin__Chapter 5in__conjunctionwith__numeric tools,and__againin__Chapter 14when__exploringiteration__contexts.The__built-inversions__workalmost__exactlylike__ours,but__theyre__codedin__Cfor__optimalspeed__andaccept__eithera__singleiterable__ormultiple__arguments. Still,though__its__superfluousin__this context,the__generalcoding__patternwe__usedhere__mightbe__usefulin__other scenarios. Example:Generalized__SetFunctions__Ournext__examplealso__demosspecial__argument-matchingmodes__at work.At__theend__ofChapter__16,we__wrotea__functionthat__returnedthe__intersectionof__twosequences__(really,it__pickedout__itemsthat__appearedin__both).Example__18-4codes__anaugmented__versionthat__intersectsan__arbitrarynumber__ofsequences__(oneor__more)by__usingthe__argument-matchingform__*argsto__collectall__the passed-in arguments.Because__thearguments__comein__asa__tuple,we__canprocess__themin__asimple__for loop.Just__for fun,we__llcode__aunion__functionthat__alsoaccepts__anarbitrary__numberof__argumentsto__collectitems__thatappear__inany__ofthe__operands.Example__18-4. inter2.py """Implement__intersectionand__unionfor__oneor__more arguments.Inputs__maybe__anysort__ofiterable__thatsupports__multiplein__tests,and__resultsare__always lists.This__intersectavoids__duplicatesin__resultsby__in test,but__maybe__slow:improve__me. """def__intersect(*args):res__= []for__xin__args[0]: #Scan__firstsequence__ifx__in res:continue__#Skip__duplicatesin__[0]for__otherin__args[1:]: #For__allother__argsif__xnot__in other:break__#Item__ineach__one? else: # No:break__outof__loop res.append(x) # Yes:add__itemsto__endreturn__resdef__union(*args):res__= []for__seqin__args: #For__allargs__forx__in seq: #For__allin__thisarg__ifnot__xin__res: res.append(x) #Add__newitems__toresult__returnres__Becausethese__toolsare__potentiallyworth__reusing (andare__toobig__toretype__interactively),we__llstore__thefunctions__ina__modulefile__called inter2.py. Again,if__youre__unsureabout__howmodules__andimports__work,see__theintroduction__inChapter__3,or__staytuned__for in-depthcoverage__inPart__V.This__chapters__moduleusage__is simple,but__perChapter__3,be__sureto__launchyour__REPLin__thesame__folderas__the file,so__importscan__find it.Like__Chapter 16s__original intersect,both__ofthe__functionsin__thismodule__workon__anykind__of sequence.Here__theyare__liveat__the REPL,processing__strings,mixed__types,and__morethan__two sequences: $ python3 >>>from__inter2import__intersect,union__>>> s1, s2, s3 = 'HACKK', 'CODE', 'CASH' >>> intersect(s1, s2), union(s1, s3) #Two__operands (['C'], ['H', 'A', 'C', 'K', 'S']) >>> intersect([1, 2, 3, 4], (1, 4)) #Mixed__types [1, 4] >>> intersect(s1, s2, s3) #Three__operands ['C'] >>> union(s1, s2, s3) ['H', 'A', 'C', 'K', 'O', 'D', 'E', 'S']Testing__theCode__Totest__more thoroughly,the__followingcontinues__ourREPL__sessionto__codea__functionthat__appliesthe__twotools__toarguments__indifferent__ordersusing__asimple__shufflingtechnique__thatwe__sawin__Chapter 13it__slicesto__movethe__firstto__theend__oneach__loop,uses__a *to__unpack arguments,and__sortsso__resultsare__comparable.Notice__thatarguments__forthe__functionare__sentas__asequence__(notdiscrete__items),and__thetrace__configurationoption__is keyword-only here: >>>def__tester(func, items, *, trace=True):for__iin__range(len(items)):items__= items[1:] + items[:1] #Move__frontitem__toback__if trace: print(items) print(sorted(func(*items))) #Test__withreordered__items >>> tester(intersect, (s1, s2, s3)) #Use__stringsfrom__priorlisting__('CODE', 'CASH', 'HACKK') ['C'] ('CASH', 'HACKK', 'CODE') ['C'] ('HACKK', 'CODE', 'CASH') ['C'] >>> tester(union, (s1, s2, s3), trace=False) ['A', 'C', 'D', 'E', 'H', 'K', 'O', 'S'] ['A', 'C', 'D', 'E', 'H', 'K', 'O', 'S'] ['A', 'C', 'D', 'E', 'H', 'K', 'O', 'S'] >>> tester(intersect, (s1, s2, s3), trace=False) ['C'] ['C'] ['C']Two__contextnotes__here: first,because__duplicateswon__tappear__inthese__intersectionand__union functions,they__qualifyas__setoperations__mathematically,but__maynot__beoptimal__interm__of speed. Still,there__snot__muchpoint__inimproving__thisdemo__scode__intersectionand__union,like__minand__max,are__built-in__operations today:the__setobject__weexplored__inChapter__5does__intersectionand__unionwith__&and__|,and__hasmethods__thattake__multipleoperands__too. Hence,optimizing__thiscode__isleft__assuggested__exercise,but__see inter3.pyin__theexamples__packagefor__pointers. Second,the__argumentscrambling__inthe__testerhere__doesnt__generateall__possibleargument__orders (thatwould__requirea__full permutation,and__6orderings__for 3 arguments),but__sufficesto__checkif__argumentorder__impacts results.As__a preview, though,the__testerwould__besimpler__andmore__flexibleif__itdelegated__scramblingto__areusable__function.Watch__forthis__revisionin__Chapter 20,after__weve__exploredhow__tocode__user-defined generators.We__llalso__recodeset__toolsone__lasttime__inChapter__32and__asolution__toa__PartVI__exercise,as__classesthat__addthem__tothe__listobject__as methods. Example:Rolling__YourOwn__PrintTo__closeout__the chapter,let__slook__atone__lastexample__ofargument__matchingat__work:this__sectionuses__both *and__** arbitrary-argumentscollectors__up front,and__keyword-onlyarguments__later,to__emulatemost__ofwhat__Pythons__printfunction__does.Like__thepreceding__examples,there__sno__urgentreason__tocode__toolsthat__Python provides.Also__likethe__others, though,this__isboth__instructiveand__maybe__abasis__forcustom__variantsof__built-in tools.For__both purposes,the__modulefile__inExample__18-5does__roughlythe__samejob__asprint__ina__smallamount__ofreusable__andmodifiable__code,by__buildingand__routingthe__printstring__perconfiguration__arguments.Example__18-5. print3.py r"""Emulate__mostof__thePython__3.Xprint__functionas__customizable code.Call__signature: print3(*args, sep=' ', end='\n', file=sys.stdout). """import__sysdef__print3(*args, **kargs):sep__= kargs.get('sep', ' ') #Keyword__argdefaults__end = kargs.get('end', '\n')file__= kargs.get('file', sys.stdout)output__= '' # Build+printa__stringfirst__=True__forarg__in args:output__+= (''if__firstelse__sep) + str(arg)first__=False__file.write(output + end)Notice__thatthis__modules__docstringuses__araw__stringto__retainits__backslashfor__help (perChapter__15).Also__notethat__thismodule__sfunction__neednot__becalled__print3because__printis__a built-inbut__nota__reserved word,but__usinga__differentname__avoidsinadvertently__hidingthe__built-in.To__test it,import__thisinto__anotherfile__orthe__interactive prompt,and__useit__likethe__print built-in.Example__18-6codes__atest__scriptthat__importsour__printeras__a demo.Example__18-6. test-print3.pyfrom__print3import__print3 print3(1, 2, 3) #Defaults__print3(1, 2, 3, sep='') #Suppress__separator print3(1, 2, 3, sep='...') #Custom__separator print3(1, [2], (3,), sep='...') #Various__objecttypes__print3(4, 5, 6, sep='', end='') #Suppress__newline print3(7, 8, 9) #Finish__line print3() #Blank__lineimport__sys print3(1, 2, 3, sep='?', end='.\n', file=sys.stderr) #Redirect__tostream__print3('LP6Ewas__here', file=open('log.txt', 'w')) #Redirect__toa__file print3(open('log.txt').read())When__thisis__run,our__print3produces__thesame__resultsas__theprint__built-in.Fine__points here:stderr__goesto__yourconsole__by default,and__its__OKto__usea__dashin__thisscript__sname__becauseit__s run,not__imported (again,we__llbe__focusingon__suchmodule__detailsin__thisbook__snext__part): $ python3 test-print3.py 1 2 3 123 1...2...3 1...[2]...(3,) 4567 8 9 1?2?3. LP6Ewas__hereAs__usual,the__generalityof__itstoolset__allowsus__toprototype__ordevelop__conceptsin__thePython__language itself.In__this case, argument-matchingtools__areas__flexiblein__Pythoncode__asthey__arein__Pythons__internal implementation.Using__Keyword-OnlyArguments__Ourprint__emulator works,but__hasa__minorflaw__baked in:it__assumesthat__allpositional__argumentsare__tobe__printed,and__allkeywords__arefor__options only.Any__extrakeyword__argumentsare__silently ignored,and__neitherprinted__nor reported.A__calllike__the following,for__instance,will__ignorethe__extraand__likelyerroneous__sap argument: $ python3 >>>from__print3import__print3 >>> print3(3.12, 'py', sap='@') 3.12py__Itmay__notmake__senseto__printsuperfluous__keywords,but__wecan__detectthem__manuallyby__using dict.pop()to__deletefetched__keywords,and__checkingif__thedictionary__isnot__emptywhen__were__done.The__versionin__Example 18-7does__its__equivalentto__the original,but__triggersa__built-inexception__witha__raisestatement__whenunexpected__keywordarguments__aresent__bya__call (thisis__partly preview:we__llstudy__exceptionsand__raisein__depthin__Part VII).Example__18-7. print3_pops.py "Use keyword-collectorarguments__withdeletion__and defaults"import__sysdef__print3(*args, **kargs):sep__= kargs.pop('sep', ' ')end__= kargs.pop('end', '\n')file__= kargs.pop('file', sys.stdout)if__kargs:raise__TypeError(f'extra keywords: {kargs}')output__= ''first__=True__forarg__in args:output__+= (''if__firstelse__sep) + str(arg)first__=False__file.write(output + end)Notice__thatthis__files__nameuses__anunderscore__insteadof__a dash:because__its__tobe__imported,its__namemust__followthe__rulesfor__variablesof__Chapter 11.This__versionworks__as before,but__itnow__catchesextraneous__keyword arguments: >>>from__print3_popsimport__print3 >>> print3(3.12, 'py', sep='@') 3.12@py >>> print3(3.12, 'py', sap='@') TypeError:extra__keywords: {'sap': '@'}It__sOK__toreimport__thesame__print3name__froma__differentfile__here:this__simplyreplaces__theprior__versionjust__likereassigning__anyother__variable (moreon__thislater__inthis__book).That__being coded,this__examplecould__alsouse__keyword-onlyarguments__toautomatically__validateconfiguration__arguments,as__thefinal__variantin__Example 18-8 illustrates.Example__18-8. print3_kwonly.py "Use keyword-onlyarguments__toemulate__print"import__sysdef__print3(*args, sep=' ', end='\n', file=sys.stdout):output__= ''first__=True__forarg__in args:output__+= (''if__firstelse__sep) + str(arg)first__=False__file.write(output + end)This__versionworks__thesame__wayfor__valid calls,but__catchesinvalid__keywordswith__keyword-onlyarguments__insteadof__manual code,and__isa__primeexample__ofhow__keyword-onlyarguments__canaddress__coding needs: >>>from__print3_kwonlyimport__print3 >>> print3(3.12, 'py', sep='@') 3.12@py >>> print3(3.12, 'py', sap='@') TypeError: print3()got__anunexpected__keywordargument__'sap'Given__thatthis__versionof__thefunction__alsorequires__fourfewer__linesof__codethan__its predecessor, keyword-onlyarguments__cansimplify__aspecific__categoryof__functionsthat__acceptboth__argumentsand__options.A__similarcase__canbe__madefor__positional-inlyarguments__versusmanual__code,but__its__more obscure,and__thischapter__hasrun__outof__space.For__anotherexample__of keyword-onlyarguments__at work,stay__tunedfor__the iteration-timingcase__studyin__Chapter 21.And__formore__inspiration,also__seethe__sidebarWhy__YouWill__Care:Customizing__open .Much__aswe__did there,our__printemulator__couldbe__assignedto__builtins.printto__replacethe__built-inwith__ourcustom__versioneverywhere__ina__program.There__sno__reasonto__dothat__fora__versionthat__sthe__same,of__course,but__thistechnique__canbe__usedto__installa__replacementprinter__thatmods__orextends__the built-in (e.g.,with__logging).Chapter__SummaryIn__this chapter,we__studiedthe__secondof__twokey__conceptsrelated__to functions:the__argumentsused__tosend__objectsto__a function.As__we saw,arguments__arepassed__toa__functionby__assignment,which__meansby__objectreference__(whichreally__meansby__pointer),and__areopen__tothe__usualside__effectsfor__sharedmutable__objects,desired__or not.We__alsostudied__someadvanced__extensionsthat__generalizeargument__matching,including__defaultand__keyword arguments,tools__forcollecting__andunpacking__arbitrarilymany__arguments,and__keyword-and__positional-only arguments. Finally,we__exploreda__fewlarger__examplesthat__employedargument__tools,and__previewedmodule__topicsof__thisbook__snext__part.The__nextchapter__continuesour__lookat__functionswith__agrab__bagof__moreadvanced__function-related ideas:function__annotations, recursion,and__moreon__lambdaand__functionaltools__suchas__mapand__filter.Many__ofthese__conceptsstem__fromthe__factthat__functionsare__normalobjects__in Python,and__sosupport__flexibleprocessing__toolsand__modes.Before__divinginto__those topics, however,take__thischapter__squiz__toreview__theargument__ideaswe__vestudied__here.Test__Your Knowledge:Quiz__Thisquiz__asksyou__totrace__throughexamples__offunction__definitionsand__callsto__predicttheir__outputs.Try__towork__outthe__answerson__yourown__beforeresorting__tocut__andpaste__ina__REPL: 1.What__isthe__outputof__thefollowing__code,and__why? >>>def__func(a, b=4, c=5): print(a, b, c) >>> func(1, 2) 2.What__isthe__outputof__this code,and__why? >>>def__func(a, b, c=5): print(a, b, c) >>> func(1, c=3, b=2) 3.How__aboutthis__code:what__isits__output,and__why? >>>def__func(a, *pargs): print(a, pargs) >>> func(1, 2, 3) 4.What__doesthis__code print,and__why? >>>def__func(a, **kargs): print(a, kargs) >>> func(a=1, c=3, b=2) 5.What__getsprinted__by this,and__why? >>>def__func(a, b, c=3, d=4): print(a, b, c, d) >>> func(1, *(5, 6)) 6.One__last time:what__isthe__outputof__this code,and__why? >>>def__func(a, b, c):a__= 2; b[0] = 'x'; c['a'] = 'y' >>> L=1; M=[1]; N={'a': 0} >>> func(L, M, N) >>> L, M,N__TestYour__Knowledge:Answers__1.The__outputhere__is 1 2 5,because__1and__2are__passedto__aand__bby__position,and__cis__omittedin__thecall__andhence__defaultsto__5. 2.The__outputthis__timeis__1 2 3: 1is__passedto__aby__position,and__band__care__passed 2and__3by__name (the left-to-rightorder__doesnt__matterwhen__keywordarguments__areused__like this). 3.This__codeprints__1 (2, 3),because__1is__passedto__aand__the *pargscollects__theremaining__positionalarguments__intoa__newtuple__object.We__canstep__throughthe__extrapositional__argumentstuple__withany__iterationtool__(e.g.,for__argin__pargs: ). 4.This__timethe__codeprints__1 {'c': 3, 'b': 2},because__1is__passedto__aby__nameand__the **kargscollects__theremaining__keywordarguments__intoa__dictionary.We__couldstep__throughthe__extrakeyword__argumentsdictionary__bykey__withany__iterationtool__(e.g.,for__keyin__kargs: ).Note__thatthe__orderof__thedictionary__skeys__reflectsthe__orderin__whichkeyword__argumentsare__passed,in__recent Pythons. 5.The__outputhere__is 1 5 6 4:the__1matches__aby__position, 5and__6match__band__cby__*positional__unpacking (6overrides__cs__default),and__ddefaults__to 4because__itwas__notpassed__a value. 6.This__displays (1, ['x'], {'a': 'y'})the__firstassignment__inthe__functiondoesn__timpact__the caller,but__thesecond__twodo__becausethey__change passed-inmutable__objectsin__place.WHY__YOUWILL__CARE:KEYWORD__ARGUMENTSAs__youcan__probably tell,some__argument-matchingmode__comboscan__be complex.They__arealso__largelyoptional__inyour__code;in__fact,you__canget__bywith__justsimple__positional matching,and__its__probablya__goodidea__todo__sowhen__youre__starting out. However,because__manyPython__toolsmake__gooduse__of them,some__generalknowledge__ofthese__modesis__important.For__example,keyword__argumentsplay__akey__rolein__tkinter,the__defacto__standardGUI__APIfor__Python.We__touchon__tkinteronly__brieflyat__variouspoints__inthis__book,but__interms__ofits__call patterns,keyword__argumentsset__configurationoptions__whenGUI__componentsare__built.For__instance,a__callof__the form:from__tkinterimport__Buttonwidget__= Button(text='Press me', command=someFunction)creates__anew__buttonand__specifiesits__textdisplayed__inthe__GUIand__callbackfunction__runon__a press,using__thetext__andcommand__keyword arguments.Since__thenumber__ofconfiguration__optionsfor__awidget__canbe__large,keyword__argumentslet__youpick__andchoose__whichto__apply.Without__them,you__mighthave__toeither__listall__thepossible__optionsby__positionor__hopefor__ajudicious__positional-argumentdefaults__protocolthat__wouldhandle__everypossible__option arrangement.Many__built-infunctions__inPython__expectus__touse__keywordsfor__usage-modeoptions__as well,which__mayor__maynot__have defaults.As__welearned__inChapter__8,for__instance,the__sorted built-in: sorted(iterable, key=None, reverse=False)expects__usto__passan__iterableobject__tobe__sorted,but__alsoallows__usto__passin__optionalkeyword__argumentsto__specifyboth__a value-transformfunction__anda__reversal flag,which__defaultto__Noneand__False, respectively.Since__wenormally__dont__usethese__options,they__maybe__omittedto__apply defaults.As__weve__also seen,the__dict, str.format,and__printcalls__acceptkeywords__aswell__otherusages__wehad__tointroduce__inearlier__chaptersbecause__oftheir__forwarddependence__on argument-passingmodes__weve__finallystudied__here (alas,those__whochange__Pythonalready__know Python!). 1 Actually,it__s complicated.CPython__ssort__(usedby__both list.sortand__sorted)is__codedin__Cand__usesa__heavilyoptimized__algorithmthat__attemptsto__takeadvantage__ofpartial__orderingin__theitems__tobe__sorted. Still,sorting__isan__inherentlybusy__operation (itmust__chopup__thesequence__andput__itback__togethermany__times),and__theother__versionssimply__performone__linear left-to-right scan.This__suggeststhat__sortingmay__bequicker__ifthe__argumentsare__partially ordered,but__islikely__tobe__slower otherwise.Even__so,Python__performancechanges__regularly;the__factthat__sortingis__implementedin__theC__languagecan__help greatly;and__thespeed__differencemay__notmatter__inmany__programs.For__anexact__analysis,you__shouldtime__thealternatives__withthe__timeor__timeitmodules__youll__seehow__soonin__Chapter 21,but__file mins-timings.txtin__theexamples__packagedemos__theidea__ifyou__cant__wait.The__gist:in__CPython,the__nonsortmins__arefaster__forrandom__arguments,but__slowerfor__ordered today!Chapter__19.Function__Oddsand__EndsThis__chapterpresents__amedley__of function-related topics:recursive__functions;function__attributes, annotations,and__decorations;and__moreon__boththe__lambdaexpression__and functional-programmingtools__suchas__mapand__filter.These__areall__somewhatadvanced__tools that,depending__onyour__job description,you__maynot__encounteron__aregular__basis.Because__oftheir__rolesin__some domains, though,a__basicunderstanding__canbe__useful. lambda,for__instance,makes__regularappearances__in GUIs,and__functionalprogramming__techniqueshave__growncommon__inPython__code.Some__ofthe__artof__usingfunctions__liesin__theinterfaces__between them,so__wewill__alsoexplore__somegeneral__functiondesign__principles here.The__nextchapter__continuesthe__advancedthemes__herewith__anexploration__ofgenerator__functionsand__expressionsand__arevival__oflist__comprehensionsin__thecontext__ofthe__functionaltools__wewill__study here.Function__DesignConcepts__Nowthat__weve__studiedfunction__essentialsin__Python,let__sopen__thischapter__withsome__perspective.When__youstart__usingfunctions__in earnest,you__refaced__withchoices__abouthow__toglue__componentstogether__for instance,how__todecompose__atask__intopurposeful__functions (knownas__cohesion),and__howyour__functionsshould__communicate (called coupling).You__alsoneed__totake__noteof__thesize__ofyour__functionsbecause__itdirectly__impactscode__usability.Some__ofthis__fallsinto__thecategory__ofstructured__analysisand__design,but__itapplies__toPython__codeas__toany__other.We__exploredsome__ideasrelated__tofunction__andmodule__couplingin__Chapter 17when__studying scopes,but__hereis__areview__ofa__fewgeneral__guidelinesfor__readersnew__tofunction__design principles: Coupling:use__argumentsfor__inputsand__returnfor__outputs. Generally,you__shouldstrive__tomake__afunction__independentof__theworld__outsideof__it.Arguments__andreturn__statementsare__oftenthe__bestways__toisolate__externaldependencies__toa__smallnumber__of well-knownplaces__inyour__code. Coupling:use__globalvariables__onlywhen__truly necessary.As__weve__seen,global__variables (i.e.,names__inthe__enclosing module)are__usuallya__poorway__forfunctions__to communicate.They__cancreate__dependenciesand__timingissues__thatmake__programsdifficult__to debug, change,and__reuse. Coupling:don__tchange__mutablearguments__unlessthe__callerexpects__it.As__weve__also seen,functions__canchange__partsof__passed-inmutable__objects,but__aswith__global variables,this__createsa__tightcoupling__betweenthe__callerand__callee,which__canmake__afunction__toospecific__and brittle. Cohesion:each__functionshould__havea__single,unified__purpose.When__designed well,each__ofyour__functionsshould__doone__thingsomething__youcan__summarizein__asimple__declarative sentence.If__thatsentence__isvery__broad (e.g.,this__functionimplements__mywhole__program )or__containslots__ofconjunctions__(e.g.,this__functiongives__employeeraises__andsubmits__apizza__order ),you__mightwant__tothink__aboutsplitting__itinto__separateand__simpler functions. Otherwise,there__isno__wayto__reusethe__codeof__theindividual__stepsembedded__inthe__function. Size:each__functionshould__berelatively__small.This__naturallyfollows__fromthe__preceding goal,but__ifyour__functionsstart__spanningmultiple__pageson__your display,it__sprobably__timeto__split them.Especially__giventhat__Pythoncode__isso__conciseto__begin with,a__longor__deeplynested__functionis__oftena__symptomof__design problems.Keep__it simple,and__keepit__short. Coupling:avoid__changingvariables__inanother__modulefile__directly.We__alsointroduced__thisconcept__inChapter__17,and__well__revisitit__inthe__nextpart__ofthe__bookwhen__wefocus__on modules.For__reference, though,remember__thatchanging__variablesacross__fileboundaries__setsup__acoupling__betweenmodules__similarto__howglobal__variablescouple__functionsthe__modulesbecome__difficultto__understandand__reuse separately.Use__accessorfunctions__whenever possible,instead__ofdirect__assignment statements.Figure__19-1summarizes__theways__functionscan__talkto__theoutside__world;inputs__maycome__fromitems__onthe__left side,and__resultsmay__besent__outin__anyof__theforms__onthe__right.Nonlocals__mightbelong__inthis__sketch too,but__theyre__mostlya__state-retentiontool__inthe__samecategory__asother__local variables.Despite__thearray__of options,good__functiondesigns__preferto__useonly__argumentsfor__inputsand__returnstatements__for outputs,whenever__possible.Figure__19-1.Function__executionenvironment__Of course,there__areplenty__ofexceptions__tothe__precedingdesign__rules,including__somerelated__toPython__sOOP__support.As__youll__seein__Part VI,Python__classesdepend__onchanging__a passed-inmutable__objectclass__functionsset__attributesof__anautomatically__passed-inargument__calledself__tochange__per-objectstate__information (e.g., self.edition=6). Moreover,if__classesare__not used,global__variablesare__astraightforward__wayfor__functionsin__modulesto__retain single-copy__statebetween__calls.Side__effectsare__usuallydangerous__onlyif__theyre__unexpected.In__general though,you__shouldstrive__tominimize__externaldependencies__infunctions__andother__program components.The__more self-containeda__function is,the__easierit__willbe__to understand, reuse,and__modify.Making__codeas__freestandingas__possibleis__especiallyimportant__whenfunctions__gomultilevel__with recursion,per__thenext__section.Recursive__FunctionsWe__mentionedrecursion__inrelation__tocomparisons__ofcore__typesin__Chapter 9.While__discussingscope__rulesnear__thestart__ofChapter__17,we__alsobriefly__notedthat__Pythonsupports__recursivefunctions__functionsthat__callthemselves__eitherdirectly__orindirectly__inorder__to loop.In__this section,we__llexplore__whatthis__lookslike__inour__functions code.Recursion__isa__somewhatadvanced__topic,and__its__relativelyuncommon__tosee__in Python,partly__becausePython__sprocedural__shedincludes__simplerlooping__tools. Still,it__sa__usefultechnique__toknow__about,as__itallows__programsto__traversestructures__thathave__arbitraryand__unpredictableshapes__anddepths__planningtravel__routes,analyzing__language,and__crawlinglinks__onthe__web,for__example.Recursion__iseven__analternative__tosimple__loopsand__iterations,though__notnecessarily__thesimplest__ormost__efficient one.Summation__withRecursion__Lets__turnto__some examples.To__suma__list (orother__sequence)of__numbers,we__caneither__usethe__built-insum__functionor__writea__morecustom__versionof__our own.Example__19-1shows__whata__customsumming__functionmight__looklike__whencoded__with recursion.Example__19-1. mysum.pydef__mysum(L):if__not L:return__0 else:return__L[0] + mysum(L[1:]) #Call__myselfrecursively__To use,either__add self-testcode__tothe__bottomof__thisfile__andrun__itas__a script,or__importit__asa__moduleand__testat__theREPL__(again,the__filemay__needto__bein__thefolder__whereyou__reworking__either way,per__Chapter 3).With__the latter: >>>from__mysumimport__mysum #Import__fileas__amodule__ina__REPL >>> mysum([1, 2, 3, 4, 5]) #Sum__allthe__numbersin__anysequence__15At__each level,this__functioncalls__itselfrecursively__tocompute__thesum__ofthe__restof__the list,which__islater__addedto__theitem__atthe__front.This__recursiveloop__endsand__zerois__returnedwhen__thelist__becomes empty.When__usingrecursion__like this,each__openlevel__ofcall__tothe__functionhas__itsown__copyof__thefunction__slocal__scopeon__theruntime__call stack. Here,that__meansL__isdifferent__ineach__level,so__eachremembers__itsown__segmentof__the list.If__thisis__difficultto__understand (andit__oftenis__fornew__programmers),try__addinga__printof__Lto__thefunction__andrun__it again,to__tracethe__currentlist__ateach__call level;here__sthe__requiredmod__pastedat__theREPL__for variety: >>>def__mysum(L): print(L) #Trace__recursivelevels__ifnot__L: #L__shorterat__eachlevel__return 0 else:return__L[0] + mysum(L[1:]) >>> mysum([1, 2, 3, 4, 5]) [1, 2, 3, 4, 5] [2, 3, 4, 5] [3, 4, 5] [4, 5] [5] [] 15As__youcan__see,the__listto__besummed__growssmaller__ateach__recursive level,until__itbecomes__emptythe__terminationof__therecursive__loop.The__sumis__thencomputed__asthe__recursivecalls__unwindon__returns.Coding__Alternatives Interestingly,we__canuse__Pythons__if/elseternary__expression (describedin__Chapter 12)to__savesome__codereal__estate here.We__canalso__generalizefor__anysummable__type (whichis__easierif__weassume__atleast__oneitem__inthe__input)and__use extended-unpackingassignment__tomake__the first/restunpacking__simpler (ascovered__inChapter__11).Example__19-2collects__allthree__ofthese__mods,ready__tobe__runin__afile__orpasted__intoa__REPL.Example__19-2. mysum_alts.pydef__mysum(L):return__0if__notL__else L[0] + mysum(L[1:]) #Use__ternaryexpression__def mysum(L):return__L[0]if__len(L) == 1else__L[0] + mysum(L[1:]) #Any__type,assume__one+def__mysum(L): first, *rest =L__returnfirst__ifnot__restelse__first + mysum(rest) #Use__extendedunpacking__Whentested__individually,all__threeof__thesealternatives__handlenumeric__summationthe__sameas__the original: >>> mysum([1, 2, 3, 4, 5]) 15 Uniquely,the__lattertwo__failfor__empties (e.g., mysum([])),but__handlesequences__ofany__objecttype__thatsupports__+,not__justnumbers__(for strings,the__effectis__similarto__''.join(L)): >>> mysum(('h', 'a', 'c', 'k')) #The__lasttwo__failon__mysum([]) 'hack' >>> mysum(['hack', 'app', 'code']) #But__theysupport__nonnumerictypes__'hackappcode'Run__sometests__onyour__ownfor__more insight.If__youstudy__thesethree__variants,you__llalso__find that:The__lattertwo__workon__asingle__stringargument__(e.g., mysum('hack')),because__stringsare__sequencesof__one-characterstrings__(thoughthis__usecase__isnt__very useful:you__getback__thesame__string).The__thirdvariant__alsoworks__onarbitrary__iterables,including__openinput__files (mysum(open(name))),but__theothers__indexinggenerally__failson__nonsequences (seeChapter__14for__extended-unpacking demos).You__mayalso__noticethat__thethird__variants__unpackingassignment__issimilar__toa__*collector__ina__function header,and__its__temptingto__recodeit__as such.This__wont__quite work, though,because__itwould__expectindividual__arguments,not__asingle__iterableunless__wealso__starboth__the top-levelinput__andrecursive__call.Here__sthe__end result,though__bysumming__discrete arguments,it__solvesa__differentproblem__thanboth__theprior__versionsand__built-in sum: >>>def__mysum(first, *rest):return__firstif__notrest__elsefirst__+ mysum(*rest) >>> mysum(*[1, 2, 3, 4, 5]) 15 >>> mysum(*'hack') 'hack' Finally,bear__inmind__thatrecursion__canbe__either direct,as__inthe__examplesso__far,or__indirect,as__inthe__followinga__functionthat__callsanother__function,which__callsback__toits__caller.The__neteffect__isthe__same,though__thereare__twofunction__callsat__eachlevel__insteadof__one: >>>def__mysum(L):if__not L:return__0return__nonempty(L) #Call__afunction__thatcalls__me >>>def__nonempty(L):return__L[0] + mysum(L[1:]) #Indirectly__recursive >>> mysum([1.1, 2.2, 3.3, 4.4]) 11.0Loop__StatementsVersus__RecursionThough__recursionworks__forsumming__inthe__priorsections__examples,it__sprobably__overkillin__this context.In__fact,recursion__isnot__usednearly__asoften__inPython__asin__moreesoteric__languageslike__Prologor__Lisp,because__Pythonemphasizes__simplerprocedural__statementslike__loops,which__areusually__more natural.The__while,for__example,often__makesthings__more concrete,and__itdoesn__trequire__thata__functionbe__definedto__allowrecursive__calls: >>>L__= [1, 2, 3, 4, 5] >>>tot__= 0 >>>while__L:tot__+= L[0]L__= L[1:] >>>tot__15Better__yet,for__loopsiterate__forus__automatically,making__recursionlargely__extraneousin__manycases__(and,in__all likelihood,less__efficientin__termsof__memoryspace__andexecution__time): >>>L__= [1, 2, 3, 4, 5] >>>tot__= 0 >>>for__xin__L:tot__+=x__>>>tot__15With__looping statements,we__dont__requirea__freshcopy__ofa__localscope__onthe__callstack__foreach__iteration,and__weavoid__thespeed__costsassociated__withfunction__callsin__general. (Staytuned__forChapter__21s__timercase__studyfor__waysto__comparethe__executiontimes__ofalternatives__like these.)Handling__ArbitraryStructures__Onthe__other hand,recursion__orequivalent__andexplicit__stack-basedalgorithms__well__exploreshortly__canbe__requiredto__traversearbitrarily__shaped structures.As__asimple__exampleof__recursions__rolein__this context,consider__thetask__ofcomputing__thesum__ofall__thenumbers__ina__nestedsublists__structurelike__this: [1, [2, [3, 4], 5], 6, [7, 8]] #Arbitrarily__nestedsublists__Neitherour__priorsummers__norsimple__loopingstatements__willwork__herebecause__thisis__nota__linear iteration.Nested__loopingstatements__donot__sufficeeither__becausethe__sublistsmay__benested__toarbitrary__depthand__inan__arbitrary shape,there__sno__wayto__knowhow__manynested__loopsto__codeto__handleall__cases. Instead,the__functionin__Example 19-3accommodates__suchgeneral__nestingby__usingrecursion__tovisit__sublistsalong__the way.Example__19-3. sumtree.pydef__sumtree(L, trace=False):tot__= 0for__xin__L: #For__eachitem__atthis__levelif__not isinstance(x, list):tot__+=x__#Add__numbersdirectly__if trace: print(x, end=', ') else:tot__+= sumtree(x, trace) #Recur__forsublists__returntot__Inthis__files__function,each__recursivelevel__runsa__forloop__toadd__numbers,or__recurinto__subliststo__opennew__levels.Recall__fromChapter__9that__isinstancecompares__object types;it__sused__hereto__detectnested__sublists.This__codeis__alsoinstrumented__totrace__itemsas__theyare__addedto__the total:if__traceis__passeda__true value,you__cansee__howthe__objectis__scannedleft__to right.Because__italso__stepsdown__intosublists__withrecursion__alongthe__way, though,the__traversalis__reallyboth__horizontaland__vertical: >>>from__sumtreeimport__sumtree >>> sumtree([1, [2, [3, 4], 5], 6, [7, 8]]) 36 >>> sumtree([1, [2, [3, 4], 5], 6, [7, 8]], trace=True) 1, 2, 3, 4, 5, 6, 7, 8, 36Testing__witha__separatescript__Atthis__point,we__couldtest__othercases__bytyping__theminteractively__orby__addingcode__tothe__bottomof__the file,but__youre__probablystarting__tosee__thatthis__canbe__abit__limiting. Instead,the__scriptin__Example 19-4makes__theprocess__automaticand__easily repeatable.As__a bonus,it__canbe__usedfor__othersummers__well__codein__a moment.Example__19-4. sumtree_tester.pytests__= ( [1, [2, [3, 4], 5], 6, [7, 8]], #Mixed__nesting => 36 [1, [2, [3, [4, [5]]]]], # Right-heavynesting__=> 15 [[[[[1], 2], 3], 4], 5]) # Left-heavynesting__=> 15def__tester(sumtree, trace=True):for__testin__tests: print(sumtree(test, trace))To__usethis__tester,simply__importboth__summerand__tester,and__passthe__formerto__the latter.When__run,our__summerprints__numbersas__addedwith__thefinal__sumat__the end,for__eachof__threecanned__tests: >>>from__sumtreeimport__sumtree #Get__thesummer__>>>from__sumtree_testerimport__tester #Get__thetester__>>> tester(sumtree) #Run__thetester__onthe__summer 1, 2, 3, 4, 5, 6, 7, 8, 36 1, 2, 3, 4, 5, 15 1, 2, 3, 4, 5, 15Within__tester,sumtree__refersto__thesummer__functionpassed__into it. Again,because__functionsare__objects,passing__themaround__thisway__is natural,and__makescode__flexible.Recursion__versusqueues__andstacks__Itsometimes__helpsrecursion__newcomersto__understandthat__internally,Python__implementsrecursion__bypushing__informationon__acall__stackat__eachrecursive__call,so__itremembers__whereit__mustreturn__andcontinue__later.In__fact,it__sgenerally__possibleto__implement recursive-styleprocedures__withoutrecursive__calls,by__usingan__explicitstack__orqueue__ofyour__ownto__keeptrack__ofremaining__steps.For__instance,Example__19-5computes__thesame__sumsas__theprior__example,but__usesan__explicitlist__toschedule__whenit__willvisit__itemsin__the subject,instead__ofissuing__recursive calls.The__itemat__thefront__ofthe__listis__alwaysthe__nextto__beprocessed__and summed.Example__19-5. sumtree_queue.pydef__sumtree(L, trace=False): # Breadth-first,explicit__queuetot__= 0items__= list(L) #Start__withcopy__oftop__levelwhile__items:front__= items.pop(0) # Fetch/deletefront__itemif__not isinstance(front, list):tot__+=front__#Add__numbersdirectly__if trace: print(front, end=', ') else: items.extend(front) # <==Append__allin__nestedlist__returntot__Technically,this__codetraverses__thelist__in breadth-firstfashion__(acrossbefore__down),because__itadds__nestedlists__contentsto__theend__ofthe__listforming__aFIFO__(first-in-first-out) queue.The__neteffect__sumsby__horizontal levels.To__test,we__caneither__importand__usethe__newsummer__directly,or__routeit__tothe__Example 19-4tester__tobe__exercisedautomatically__with tracing: >>>from__sumtree_queueimport__sumtree #Get__thenew__summer >>> sumtree([1, [2, [3, 4], 5], 6, [7, 8]]) 36 >>>from__sumtree_testerimport__tester #Unless__alreadyimported__>>> tester(sumtree) #Run__testeron___this_summer__1, 6, 2, 5, 7, 8, 3, 4, 36 1, 2, 3, 4, 5, 15 5, 4, 3, 2, 1, 15Fine__points:we__dont__haveto__reimportthe__testeragain__ifit__salready__beenimported__inthis__session,and__importingthe__same-namedsummer__justworks__thenew__summers__filenamemakes__it unique,and__sumtreeis__alwaysthe__latestversion__importedif__youimport__morethan__one,because__importsassign__names (seeChapter__18s__printemulators__foranother__exampleof__thispattern__at work,and__watchfor__moreon__importsin__thisbook__snext__part).More__importantly,notice__howthe__orderin__whichnumbers__arevisited__hereis__differentthan__inthe__original recursive-call version,due__tothe__breadth-first queue.Trace__throughthe__testers__teststo__seehow__thispans__out.If__weinstead__wantto__emulatethe__traversalof__the recursive-callversion__more closely,we__canchange__thiscode__toperform__depth-firsttraversal__(downbefore__across)simply__byadding__thecontents__ofnested__liststo__thefront__ofthe__listforming__a last-in-first-out (LIFO) stack.Example__19-6makes__therequired__mods,but__theonly__wayit__differsfrom__the breadth-firstversion__isthe__linethat__addsto__thefront__insteadof__the end,marked__with <==in__a comment.Example__19-6. sumtree_stack.pydef__sumtree(L, trace=False): # Depth-first,explicit__stacktot__= 0items__= list(L) #Start__withcopy__oftop__levelwhile__items:front__= items.pop(0) # Fetch/deletefront__itemif__not isinstance(front, list):tot__+=front__#Add__numbersdirectly__if trace: print(front, end=', ') else: items[:0] =front__# <==Prepend__allin__nestedlist__returntot__As before,we__canuse__thisfunction__directly,or__passit__tothe__same tester;its__filemakes__it distinct,and__itsname__refersto__thelatest__import.When__run,this__summervisits__numbersin__thesame__orderas__the recursive-calls original,but__managesthe__traversalwith__anexplicit__stackinstead__of recursion: >>>from__sumtree_stackimport__sumtree #Same__name,different__file >>> sumtree([1, [2, [3, 4], 5], 6, [7, 8]]) 36 >>>from__sumtree_testerimport__tester #Optional__ifalready__imported >>> tester(sumtree) 1, 2, 3, 4, 5, 6, 7, 8, 36 1, 2, 3, 4, 5, 15 1, 2, 3, 4, 5, 15For__moreon__thelast__twoexamples__(plusanother__breadth-firstcoding__variantomitted__here),see__file sumtree_etc.pyin__thebook__sexamples__package.It__addsadditional__tracingso__youcan__watchit__walkstructures__inmore__detail.In__general, though,once__youget__thehang__ofrecursive__calls,they__maybe__morenatural__thanthe__explicitscheduling__liststhey__automate,and__aregenerally__preferredunless__youneed__totraverse__structuresin__specialized ways.Some__programs,for__example,perform__a best-firstsearch__thatrequires__anexplicit__searchqueue__orderedby__relevanceor__other criteria.If__youthink__ofa__webcrawler__thatscores__sitesvisited__by content,the__applicationsmay__startto__become clearer. Cycles, paths,and__stacklimits__As is,these__programssuffice__as demos,but__largerrecursive__applicationscan__sometimesrequire__abit__moreinfrastructure__thanshown__here:they__mayneed__toavoid__cyclesor__repeats,record__pathstaken__forlater__use,and__expandstack__spacewhen__usingrecursive__callsinstead__ofexplicit__queuesor__stacks.For__instance,neither__the recursive-callnor__theexplicit__queue/stackexamples__inthis__sectiondo__anythingabout__avoidingcycles__visitinga__locationalready__visited.That__snot__required here,because__were__traversingstrictly__hierarchicaltrees__oflist__objects.If__datacan__bea__cyclic graph, though,both__theseschemes__will fail:the__recursive-callscheme__willfall__intoan__infiniterecursive__loop (andmay__runout__of call-stack space),and__theothers__willfall__intosimple__infinite loops, re-addingthe__sameitems__totheir__lists (andmay__ormay__notrun__outof__general memory).In__fact,it__seasy__todemo__theperils__bycreating__acyclic__objectwith__thestrange__codewe__metin__anexercise__atthe__endof__Chapter 3: >>>L__= [1, 2] >>> L.append(L) #Make__acyclic__object:L__referencesitself__>>>L__[1, 2, [...]] >>>from__sumtreeimport__sumtree >>> sumtree(L) RecursionError:maximum__recursiondepth__exceeded >>>from__sumtree_queueimport__sumtree >>> sumtree(L)hang__or crash,and__dittofor__stackSome__programsalso__needto__avoidrepeated__processingfor__astate__reachedmore__than once,even__ifthat__wouldnt__leadto__a loop.To__do better,a__recursive-calltraversal__mightmake__andpass__alonga__mutable set, dictionary,or__listof__statesvisited__sofar__andcheck__forrepeats__asit__goes.We__willuse__thisscheme__inlater__recursiveexamples__inthis__book:if__statenot__in visited: visited.add(state) # x.add(state), x[state]=True,or__x.append(state)proceed__Nonrecursivealternatives__mightsimilarly__avoidadding__statesalready__visitedwith__codelike__the following. Subtly,object__cyclesmay__requireis__(not in),and__simplychecking__forduplicates__alreadyon__theitems__listwould__avoidscheduling__astate__twicebut__wouldnot__preventrevisiting__astate__visitedearlier__andhence__removedfrom__that list: visited.add(front)proceed__items.extend([xfor__xin__frontif__xnot__in visited])This__modeldoesn__tquite__applyto__thissection__suse__casethat__simplyadds__numbersin__lists,but__otherapplications__willgenerally__beable__toidentify__repeatedstates__aURL__ofa__previouslyvisited__web page,for__instance.In__fact,we__lluse__suchtechniques__toavoid__cyclesand__repeatsin__thelater__exampleslisted__inthe__next section.Some__programsmay__alsoneed__torecord__completepaths__foreach__statefollowed__sothey__canreport__solutionswhen__finished.In__such cases,each__itemin__thenonrecursive__schemes__stackor__queuemay__bea__fullpath__listthat__sufficesfor__arecord__ofstates__visited,and__containsthe__nextitem__toexplore__ateither__end.Also__notethat__standardPython__limitsthe__depthof__itsruntime__callstack__crucialto__recursive-callprograms__totrap__infiniterecursion__errors.To__expandit__fordeeper__journeys,use__thesys__module: >>> sys.getrecursionlimit() # 1000calls__deepdefault__1000 >>> sys.setrecursionlimit(10000) #Allow__deepernesting__>>> help(sys.setrecursionlimit) #Read__moreabout__itThe__maximumallowed__settingcan__varyper__platform.This__isnt__requiredfor__programsthat__usestacks__orqueues__toavoid__recursivecalls__andgain__morecontrol__overthe__traversalprocess__(thoughthey__alsowon__tcatch__infinite loops).More__recursionexamples__Althoughthis__sections__exampleis__artificial,it__isrepresentative__ofa__largerclass__of programs;inheritance__treesand__moduleimport__chains,for__example,can__exhibitsimilarly__general structures,and__computingtools__suchas__permutationscan__requirearbitrarily__manynested__loops.In__fact,we__lluse__recursionagain__insuch__roleslater__inthis__book:In__Chapter 20s__permute.py,to__shufflearbitrary__sequencesIn__Chapter 25s__reloadall.py,to__traverseimport__chainsIn__Chapter 29s__classtree.py,to__traverseclass__inheritancetrees__InChapter__31s__lister.py,to__traverseclass__inheritancetrees__againIn__Appendix B,Solutions__to End-of-PartExercises__atthe__endof__thispart__ofthe__book:countdowns__andfactorials__Thesecond__andthird__ofthese__willalso__detectstates__alreadyvisited__toavoid__cyclesand__repeats.Although__simpleloops__shouldgenerally__bepreferred__torecursion__forlinear__iterationson__thegrounds__ofsimplicity__and efficiency,you__llfind__thatrecursion__isessential__inscenarios__likethose__inthese__later examples. Moreover,you__sometimesneed__tobe__awareof__thepotential__ofunintended__recursionin__your programs.As__youll__alsosee__laterin__the book,some__operator-overloading__methodsin__classessuch__as__setattr____and__getattribute____andeven____repr__have__thepotential__torecursively__loopif__used incorrectly.Recursion__isa__powerful tool,but__ittends__tobe__bestwhen__bothunderstood__and expected!Function__Tools: Attributes, Annotations, Etc.Let__smove__onto__acategory__oftools__thatmay__seemless__etherealthan__recursionto__some earthlings.As__weve__seenin__thispart__ofthe__book,functions__inPython__aremuch__morethan__code-generationspecifications__fora__compilerthey__are full-blown__objects,stored__inpieces__ofmemory__alltheir__own.As__such,they__canbe__freelypassed__arounda__programand__called indirectly.They__alsosupport__operationsthat__havelittle__todo__withcalls__at all,including__attributesand__annotation.We__vesampled__someof__thesetopics__earlier,but__thissection__providesexpanded__coverage.The__First-ClassObject__ModelBecause__Pythonfunctions__are objects,you__canwrite__programsthat__processthem__generically.Function__objectsmay__bereassigned__toother__names,passed__toother__functions,embedded__indata__structures,returned__fromone__functionto__another,and__more,as__ifthey__weresimple__numbersor__strings.Function__objectshappen__tosupport__aspecial__operationthey__canbe__calledby__listingarguments__inparentheses__butthey__belongto__thesame__generalcategory__asother__objects.As__weve__seen,this__isusually__calleda__first-classobject__model;it__subiquitous__in Python,and__anecessary__partof__functional programming.We__llexplore__thisprogramming__modemore__fullyin__thisand__thenext__chapter;because__itsmotif__isfounded__onthe__notionof__applying functions,it__treatsfunctions__asa__kindof__data.We__veexplored__somegeneric__usecases__forfunctions__inearlier__examples,but__aquick__reviewhelps__tounderscore__the model.For__example,there__sreally__nothingspecial__aboutthe__nameused__ina__def statement:it__sjust__avariable__assignedin__thecurrent__scope,as__ifit__hadappeared__onthe__leftof__an = sign.Because__thefunction__nameis__simplya__referenceto__anobject__aftera__def runs,you__canreassign__thatobject__toother__namesfreely__andcall__itthrough__any reference: >>>def__exclaim(message): #Name__exclaimassigned__tofunction__object print(message + '!') >>> exclaim('Direct call') #Call__objectthrough__originalname__Direct call! >>>x__=exclaim__#Now__xreferences__thefunction__too >>> x('Indirect call') #Call__objectthrough__namex__byadding__()Indirect__call!And__becausearguments__arepassed__byassigning__objects,it__sjust__aseasy__topass__functionsto__otherfunctions__as arguments.The__calleemay__thencall__the passed-infunction__justby__addingarguments__inparentheses__(seethe__earliersummer__testerin__Example 19-4for__anotherexample__ofthis__pattern): >>>def__generic(func, arg): func(arg) #Call__the passed-inobject__byadding__() >>> generic(exclaim, 'Argument call') #Pass__thefunction__toanother__functionArgument__call!You__caneven__stufffunction__objectsinto__data structures,as__thoughthey__wereintegers__or strings.The__following,for__example,embeds__thefunction__twicein__alist__of tuples,as__asort__ofactions__table.Because__Pythoncompound__typeslike__thesecan__containany__sortof__object,there__sno__specialcase__here,either__(Example 18-2used__similar code): >>>schedule__= [ (exclaim, 'Hack'), (exclaim, 'Code') ] >>>for__(func, arg)in__schedule: func(arg) #Call__functionsembedded__incontainers__Hack! Code!This__codesimply__stepsthrough__theschedule__list,calling__theexclaim__functionwith__oneargument__eachtime__through.As__wesaw__inChapter__17s__examples,functions__canalso__becreated__andreturned__foruse__elsewherethe__closurecreated__inthis__modealso__retainsstate__fromthe__enclosing scope: >>>def__implore(verb): #Make__afunction__but don'tcall__itdef__exclaim(noun): print(f'{verb} {noun}!')return__exclaim >>>I__= implore('Hack') #Label__inenclosing__scopeis__retained >>> I('Code') #Call__thefunction__thatmake__returnedHack__Code! >>> I('App')Hack__App!Python__s first-classobject__modeland__lackof__typeconstraints__makefor__avery__flexibleprogramming__language.Function__IntrospectionIn__fact,functions__aremore__flexiblethan__youmight__expect.Because__theyare__objects,we__canalso__processfunctions__withnormal__object tools.For__instance,by__nowwe__knowthat__oncewe__makea__functionwe__cancall__itas__usual: >>>def__func(a):b__= 'Hack'return__b *a__>>> func(8) 'HackHackHackHackHackHackHackHack'But__thecall__expressionis__justone__ofa__setof__operationsdefined__towork__onfunction__objects.For__instance,we__canalso__inspecttheir__attributes generically: >>> func.__name__ 'func' >>> dir(func) '__annotations__', '__builtins__', '__call__', '__class__', '__closure__',more__omitted: 38total__'__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__type_params__']Introspection__internalsaccess__toolslike__thisallow__usto__exploreimplementation__details.For__example,functions__haveattached__code objects,which__providedetails__onaspects__suchas__thefunctions__localvariables__and arguments: >>> func.__code__ ",line__1> >>> dir(func.__code__) ['__class__', '__delattr__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__',more__omitted: 48total__'co_posonlyargcount', 'co_qualname', 'co_stacksize', 'co_varnames', 'replace'] >>> func.__code__.co_varnames ('a', 'b') >>> func.__code__.co_argcount 1Tool__writerscan__makeuse__ofsuch__informationto__managefunctions__in fact,we__willtoo__inChapter__39,to__implementvalidation__offunction__argumentswith__thedecorators__introduced ahead.Whether__youcode__oruse__such tools,object__introspectionboosts__function utility.Function__AttributesNor__arefunction__objectslimited__tothe__system-definedattributes__ofthe__prior section:it__salso__possibleto__attacharbitrary__user-definedattributes__to them.This__topicwas__introducedin__Chapter 17,but__thissection__expandson__itwith__additionalcontext__and examples.As__usualin__Python,function__attributesare__createdby__simple assignments: >>>def__func():pass__>>>func__>>> func.count = 0 >>> func.count += 1 >>> func.count 1 >>> func.handles = 'Button-Press' >>> func.handles 'Button-Press' >>> dir(func)most__double-underscorenames__omitted '__str__', '__subclasshook__', '__type_params__', 'count', 'handles']Python__sown__implementation-relateddata__storedon__functionsfollows__namingconventions__thatprevent__themfrom__clashingwith__themore__arbitraryattribute__namesyou__mightassign__yourself. Specifically,all__functioninternals__nameshave__leadingand__trailingdouble__underscores (__X____): >>> len(dir(func)) 40 >>> [xfor__xin__dir(func)if__not x.startswith('__')] ['count', 'handles']If__youre__carefulnot__toname__attributesthe__sameway__as Python,you__cansafely__usethe__functions__namespaceas__thoughit__wereyour__ownnamespace__or scope. Naturally,all__ofthis__worksthe__samefor__functionsmade__with lambda: >>>F__= lambda:None__>>> len(dir(F)) 38 >>> F.book = 'LP6E' >>> F.book 'LP6E'As__coveredin__Chapter 17,such__attributescan__beused__toattach__stateinformation__tofunction__objects directly,instead__ofusing__othertechniques__suchas__globals, nonlocals,and__classes.Unlike__nonlocals,such__attributesare__accessibleanywhere__thefunction__itself is,even__fromoutside__its code.In__a sense,this__isalso__away__toemulate__staticlocals__inother__languagesvariables__whosenames__arelocal__toa__function,but__whosevalues__areretained__aftera__function exits.Attributes__arerelated__toobjects__insteadof__scopes (andmust__bereferenced__throughthe__functionname__withinits__code),but__thenet__effectis__similar. Moreover,as__alsoexplored__inChapter__17,when__attributesare__attachedto__functionsgenerated__byother__factory functions,they__alsosupport__multiple copy, writeable,and__per-callstate__retention,as__analternative__toclosures__and class-instance__attributes.This__makesfunction__attributesa__broadlyuseful__toollike__thetopics__ofthe__next section.Function__Annotationsand__DecorationsFor__tools roles,functions__alsosupport__attachedannotations__arbitrary user-defined__infoabout__afunction__sarguments__andresult__thataugment__the function.Python__providessyntax__forcoding__annotations,but__itdoesn__tdo__anythingwith__themitself__annotationsare__completely optional,don__timpact__functionbehavior__inany__way,and__whenpresent__aresimply__attachedto__thefunction__objects____annotations__attribute__foruse__byother__tools.While__notof__generalinterest__tomost__application programmers, third-partytools__andlibraries__mightuse__annotationsin__thecontext__ofenhanced__error checking,or__API directives.Type__hinting,discussed__inChapter__6,is__alsobased__on annotations,but__isoptional__and unused,and__doesnt__precludeother__rolesfor__annotationstoday__(moreon__this ahead).We__studiedthe__formalrules__forarguments__infunction__definitionsin__thepreceding__chapter.Annotations__dont__modifythese__rulesbut__simplyextend__theirsyntax__toallow__extraexpressions__tobe__associatedwith__namedarguments__andfunction__results.Consider__thefollowing__nonannotated function,coded__withthree__argumentsand__areturned__result: >>>def__func(a, b, c):return__a +b__+c__>>> func(1, 2, 3) 6 Syntactically,function__annotationsare__codedin__defheader__lines (only),as__arbitraryexpressions__associatedwith__argumentsand__return values.For__arguments,they__appearafter__acolon__immediatelyfollowing__theargument__s name;for__return values,they__arewritten__aftera__->following__thearguments__lists__closing parenthesis.The__following code,for__example,annotates__allthree__ofthe__priorfunction__s arguments,as__wellas__itsreturn__value: >>>def__func(a: 'hack', b: (1, 10), c: float) -> int:return__a +b__+c__>>> func(1, 2, 3) 6Calls__toan__annotatedfunction__workas__usual,but__whenannotations__arepresent__Pythoncollects__themin__adictionary__andattaches__itto__thefunction__objectitself__asits____annotations__.In__this,argument__namesbecome__keys;the__returnvalue__annotationis__storedunder__keyreturn__ifcoded__(whichsuffices__becausethis__reservedword__cant__beused__asan__argument name);and__thevalues__ofannotation__keysare__assignedto__theresults__ofthe__annotation expressions: >>> func.__annotations__ {'a': 'hack', 'b': (1, 10), 'c': , 'return': }Because__theyare__justPython__objectsattached__toa__Python object,annotations__arestraightforward__to process.The__followingannotates__justtwo__ofthree__argumentsand__stepsthrough__theattached__annotations generically: >>>def__func(a: 'python', b, c: 3.12):return__a +b__+c__>>> func(1, 2, 3) 6 >>> func.__annotations__ {'a': 'python', 'c': 3.12} >>>for__argin__func.__annotations__: print(arg, '=>', func.__annotations__[arg])a__=>python__c => 3.12There__aretwo__finepoints__tonote__here. First,you__canstill__usedefaults__forarguments__ifyou__codeannotations__theannotation__(andits__: character)appears__beforethe__default (andits__= character).In__the following,for__example, a: 'hack' = 4means__thatargument__adefaults__to 4and__isannotated__withthe__string 'hack': >>>def__func(a: 'hack' = 4, b: (1, 10) = 5, c:float__= 6) -> int:return__a +b__+c__>>> func(1, 2, 3) #No__defaultsused__6 >>> func() # a=4 + b=5 + c=6 (all defaults) 15 >>> func(1, c=10) # 1 + b=5 + 10 (keywordswork__normally) 16 >>> func.__annotations__ {'a': 'hack', 'b': (1, 10), 'c': , 'return': } Second,note__thatthe__blankspaces__inthe__priorexample__areall__optionalyou__canuse__spacesbetween__componentsin__functionheaders__or not,but__omittingthem__mightdegrade__yourcode__sreadability__tosome__observers (andprobably__improveit__to others): >>>def__func(a:'hack'=4, b:(1,10)=5, c:float=6)->int:return__a +b__+c__>>> func(1, 2) # 1 + 2 + c=6 9 >>> func.__annotations__ {'a': 'hack', 'b': (1, 10), 'c': , 'return': }While__annotationsare__optionaland__uncommon,they__maybe__usedto__specifyconstraints__fortypes__or values,and__largerAPIs__mightuse__thisfeature__asa__wayto__registerfunction__interface information.In__fact,you__llsee__apotential__applicationin__Chapter 39,when__wecode__annotationsas__analternative__tofunction__decoratorarguments__amore__generalconcept__inwhich__augmentationinfo__iscoded__outsidethe__functionheader__andso__isnot__limitedto__asingle__role.Function__decorators alternative:Preview__Becausewe__regoing__todevote__anentire__chapterto__decorators,we__llomit__mostof__theirstory__here.But__asa__verybrief__preview,decorators__aresimply__functionsthat__augmentother__functions.They__areapplied__toanother__functions__defwith__an @prefix__thatrebinds__theother__functions__nameto__theresult__ofpassing__itto__the decorator.This__syntax: @decoratordef__func(args): #Decorated__functiondef__isautomatically__morphedinto__thefollowing__equivalent,where__decoratoris__a one-argumentcallable__object (oran__expressionthat__returns one),which__returnsa__callableobject__havingarguments__compatiblewith__func (orfunc__itself):def__func(args):func__= decorator(func) #Rebind__functo__decorator'sresult__Decoratorscan__usethis__hookto__wrapanother__functionin__anextra__layerof__codefor__nearlyarbitrary__purposes,as__inthe__followingcode__thatadds__amessage__whena__decoratedfunction__is called:def__echo(F):def__proxy(*args): print('calling', F.__name__) #Add__actionshere__return F(*args) #Run__decoratedfunction__returnproxy__@echodef__func(x, y): #Rebinds__func = echo(func) print('Iam__running...', x, y) #func__isrun__bythe__proxyclosure__>>> func(1, 2) #Runs__a proxy,which__runsfunc__callingfunc__Iam__running... 1 2As__youll__learn later,decorators__canalso__takearguments__(e.g., @echo(args))whose__utilitycan__overlapwith__annotationsargument__infocan__besent__tothe__decoratorinstead__ofbeing__embeddedin__headersas__annotations.Because__thisis__anadvanced__toolthat__canalso__beapplied__to classes,we__llpause__thisthread__untilChapters__32and__39.Compared__to annotations, though,decorators__dont__complicatefunction__headersthemselves__withextra__syntax,and__morenaturally__supportmultiple__roles.Annotations__maymake__functionsdifficult__to read,and__generallycan__havejust__onerole__onethat__shijacked__bythe__optionaltype__hintingof__Chapter 6in__programsthat__chooseto__employ it.In__fact,type__hintingadvocates__havetried__todeprecate__allother__rolesfor__annotations.While__thesedivisive__(andperhaps__even rude)efforts__havethankfully__failedto__date,decorators__faceno__such challenge,and__maybe__asafer__betgoing__forward. Today, though,both__annotationsand__decorationsare__toolswhose__rolesare__limitedonly__byyour__imagination. Finally,note__thatannotations__anddecorations__workin__defstatements__butnot__inlambda__expressions,whose__syntaxby__designlimits__thefunctions__theycan__define. Coincidentally,this__bringsus__tothis__potpourris__next topic.Anonymous__Functions:lambda__Wefirst__metthe__lambdaexpression__backin__Chapter 16and__haveused__itin__ahandful__ofexamples__since then.This__sectionreviews__thebasics__andtakes__adeeper__second look,to__bothreinforce__andexpand__onthis__topic.As__weve__seen,besides__thedef__statement,Python__providesan__expressionthat__createsfunction__objects.Because__ofits__similarityto__atool__inother__languages,it__scalled__lambda.Like__def,this__expressioncreates__afunction__tobe__called later,but__itreturns__thefunction__insteadof__assigningit__toa__name.This__iswhy__lambdasare__sometimesknown__asanonymous__functions.In__practice,they__areused__toinline__function definitions,or__deferexecution__of code.NOTE__Whats__ina__name?:The__lambdatends__tointimidate__people,largely__dueto__thename__lambdaitself__aname__thatcomes__fromthe__Lisp language,which__gotit__fromlambda__calculus,which__isa__formof__symbolic logic.Obscure__mathematicalheritage__aside, though,lambda__inPython__isreally__justa__wordthat__introducesan__expression syntactically,and__itsexpression__issimply__analternative__wayto__codea__functionalbeit__without statements, decorators,or__annotations.lambda__BasicsAs__a refresher,the__lambdas__generalform__isthe__keyword lambda,followed__byzero__ormore__arguments (justlike__thearguments__youenclose__inparentheses__ina__def header,sans__annotations),followed__byan__expressionafter__a colon:lambda__argument1, argument2,argumentN__: expression-using-argumentsParentheses__arenot__allowedaround__lambdaarguments__andare__generallyoptional__aroundthe__entirelambda__itself,though__theyre__requiredin__somecontexts__andmay__boostclarity__in others.Functions__returnedby__lambdawork__thesame__asthose__assignedby__def,but__lambdadiffers__inways__thatmake__ituseful__inspecialized__roles:lambda__isan__expression,not__a statement.Because__of this,a__lambdacan__appearin__placesa__defis__notallowed__byPython__ssyntax__insidea__listliteral__ora__functioncall__s arguments,for__example.With__def,functions__canbe__referencedby__namein__such locations,but__mustbe__created elsewhere.As__an expression,lambda__returnsa__value (anew__function)that__canbe__assigneda__name,or__usedwhere__thelambda__appears.lambda__sbody__isa__single expression,not__ablock__of statements.The__lambdas__bodyis__similarto__whatyou__dput__ina__defbody__sreturn__statement;you__simplytype__theresult__asa__naked expression,instead__ofexplicitly__returning it.Because__itis__limitedto__an expression,a__lambdais__lessgeneral__thana__defyou__canonly__squeezeso__muchlogic__intoa__lambdabody__without full-blown statements.This__isby__design,to__limitprogram__nesting:lambda__isdesigned__forcoding__simple functions,and__defhandles__larger tasks.Apart__fromthose__distinctions,defs__andlambdas__dothe__samesort__of work.For__instance,by__thispoint__weshould__bepros__atmaking__afunction__witha__def statement: >>>def__func(x, y, z):return__x +y__+z__>>> func(2, 3, 4) 9But__wecan__achievethe__sameeffect__witha__lambdaexpression__byexplicitly__assigningits__resultto__aname__throughwhich__youcan__latercall__the otherwise-anonymous__function: >>>func__=lambda__x, y, z:x__+y__+z__>>> func(2, 3, 4) 9 Here,func__ismanually__assignedthe__functionobject__thelambda__expression creates;this__ishow__def works, too,but__itsassignment__is automatic.Defaults__andother__argument-matchingsyntax__workin__lambda too,just__likein__a def: >>>x__= (lambda a='hack', b='python', c='code':a__+b__+ c) >>> x('write') 'writepythoncode'The__codein__alambda__bodyalso__followsthe__samescope__lookuprules__ascode__insidea__def.lambda__expressionsintroduce__anew__localscope__muchlike__anested__def,which__automaticallysees__namesin__enclosing functions,the__module,and__the built-inscope__viathe__LEGBrule__westudied__inChapter__17: >>>def__editions(title): #title__inenclosing__scopereturn__(lambda e:title__+ ', ' + e) #Return__afunction__object >>>labeler__= editions('Learning Python') # Make+savenested__function >>> labeler('6E') # '6E'passed__toe__inlambda__'Learning Python, 6E'With__thosebasic__lambdahows__in hand,the__naturalnext__questionis__why,taken__upin__thenext__section.Why__Use lambda?Generally__speaking,lambda__isa__sortof__functionshorthand__thatallows__youto__embeda__functions__definitionwithin__thecode__thatuses__it.It__isentirely__optionalyou__canalways__usedef__instead,and__shouldif__yourfunction__requiresthe__powerof__fullstatements__thatthe__lambdas__expressioncannot__provide.But__lambdamay__beeasier__touse__inscenarios__whereyou__justneed__toembed__asmall__bitof__executablecode__inlineat__theplace__whereit__isto__belater__used.For__instance,you__llsee__laterthat__callbackhandlers__arefrequently__codedas__inlinelambda__expressionsembedded__directlyin__aregistration__calls__arguments list,instead__ofbeing__definedwith__adef__elsewherein__afile__andreferenced__byname__(seethe__sidebarWhy__YouWill__Care:lambda__Callbacksfor__an example).lambda__isalso__commonlyused__tocode__jump tables,which__arelists__ordictionaries__ofactions__tobe__performedon__demand.For__example:L__= [lambda x:x__* 2, #Inline__functiondefinition__lambda x:x__** 2,lambda__x:x__// 2] #A__listof__threecallable__functionsfor__fin__L: print(f(5)) #Prints__10, 25,and__2 print(L[1](5)) #Prints__25The__lambdaexpression__workswell__whenyou__needto__stuffsmall__piecesof__executablecode__intoplaces__wherestatements__likedef__arenot__allowed.The__precedingcode__snippet,for__example,builds__upa__listof__threefunctions__byembedding__lambdaexpressions__insidea__list literal;a__defwon__twork__insidea__literallike__thisbecause__itis__a statement,not__an expression.The__equivalentdef__codingwould__requiretemporary__functionnames__(whichmight__clashwith__others)and__functiondefinitions__outsidethe__contextof__intendeduse__(whichmight__behundreds__oflines__away):def__f1(x):return__x * 2def__f2(x):return__x ** 2 #Define__namedfunctions__def f3(x):return__x // 4 #Separate__fromtheir__placeof__useL__= [f1, f2, f3] #Reference__byname__forf__in L: print(f(2)) #Also__prints 10, 25,and__2Multiway__branches:The__finaleIn__fact,you__cando__thesame__sortof__thingwith__dictionariesand__otherdata__structuresin__Pythonto__buildup__moregeneral__sortsof__action tables.Here__sanother__exampleto__illustrateat__theinteractive__prompt: >>>key__= 'loop' >>> {'hack':lambda__s: s.upper(), 'code':lambda__s: s.lower(), 'loop':lambda__s: f'{s * 4}!'}[key]('Py') 'PyPyPyPy!' Here,when__Pythonmakes__thetemporary__dictionary,each__ofthe__nestedlambdas__generatesand__leavesbehind__afunction__tobe__called later.Indexing__bykey__fetchesone__ofthose__functions,and__parenthesesforce__thefetched__functionto__be called.When__codedthis__way,a__dictionarybecomes__amore__generalmultiway__branchingtool__thanthis__bookcould__fullyreveal__inChapter__12s__coverageof__if statements.To__makethis__workwithout__lambda,you__dneed__toinstead__codethree__defstatements__somewhereelse__inyour__file,outside__thedictionary__inwhich__thefunctions__areto__be used,and__referencethe__functionsby__name: >>>def__f1(s):return__s.upper() >>>def__f2(s):return__s.lower() >>>def__f3(s):return__f'{s * 4}!' >>>key__= 'loop' >>> {'hack': f1, 'code': f2, 'loop': f3}[key]('Py') 'PyPyPyPy!'This__works, too,but__yourdefs__maybe__arbitrarilyfar__awayin__your file,even__ifthey__arejust__littlebits__of code.The__codeproximity__thatlambda__providesis__especiallyuseful__forfunctions__thatwill__onlybe__usedin__asingle__contextif__thethree__functionshere__arenot__usefulanywhere__else,it__makessense__toembed__theirdefinitions__withinthe__dictionaryas__lambdas. Moreover,the__defform__requiresyou__tomake__upnames__forthese__littlefunctions__that, again,may__clashwith__othernames__inthis__file (perhaps unlikely,but__always possible).You__canuse__thematch__statementtoday__withsimilar__results,but__itmay__requireeven__morecode__thanthe__def scheme,especially__sinceyou__dhave__tonest__itwithin__adef__tosupport__anargument__like s;see__Chapter 12for__more info.lambda__isalso__handyin__function-callargument__listsas__away__toinline__temporaryfunction__definitionsnot__usedanywhere__elsein__your program;you__llsee__examplesof__suchother__useslater__inthis__chapter,when__westudy__map.NOTE__Thesiren__songof__eval:In__principle,you__couldskip__thedispatch__tablein__thepreceding__codeif__thefunction__nameis__thesame__asits__stringlookup__keyan__eval(key)(arg)would__kickoff__the call.While__truein__thiscase__andsometimes__useful,as__wesaw__earlier (e.g.,Chapter__10),eval__isrelatively__slow (itmust__compileand__run code)and__insecure (youmust__trustthe__strings__source).More__fundamentally,jump__tablesare__generallysubsumed__bypolymorphic__methoddispatch__in Python:calling__amethod__doesthe__rightthing__basedon__thetype__ofobject__thats__thesubject__ofthe__call,no__switchinglogic__required.To__see why,stay__tunedfor__Part VI.How__(Not)to__ObfuscateYour__PythonCode__Thefact__thatthe__bodyof__alambda__hasto__bea__singleexpression__(nota__seriesof__statements)would__seemto__placesevere__limitson__howmuch__logicyou__canpack__intoa__lambda.If__youknow__whatyou__re doing, though,you__cancode__moststatements__inPython__as expression-based equivalents.For__example,if__youwant__toprint__fromthe__bodyof__alambda__function,simply__useprint__or sys.stdout.write (recallfrom__Chapter 11that__thisis__whatprint__really does).And__toexecute__multiple actions,code__asequence__likea__tuple,to__evaluatenested__multipleexpressions__fromleft__toright__(tuplesrequire__parenthesesin__this context): >>>series__=lambda__a, b: (print(a.upper()), print(b.lower())) # > 1actions__>>>ignore__= series('Hack', 'Code')HACK__code Similarly,to__nestlogic__ina__lambda,you__canuse__the if/elseternary__expressionintroduced__inChapter__12,or__theequivalent__buttrickier__and/orcombination__alsodescribed__there.As__youlearned__earlier,the__following statement:if__a:b__else:c__canbe__emulatedby__eitherof__theseequivalent__expressions (thesecond__isonly__roughlythe__same,but__close enough):b__ifa__elsec__((aand__b)or__c)Because__expressionslike__thesecan__beplaced__insidea__lambda,they__maybe__usedto__implementselection__logicwithin__alambda__function (thelambda__isparenthesized__hereonly__forvariety__andsubjective__clarity): >>>lower__= (lambda x, y:x__ifx__<y__else y) #Ifs__in lambda:ternary__>>> lower('bb', 'aa') 'aa' >>> lower('aa', 'bb') 'aa' Furthermore,if__youneed__toperform__loopswithin__a lambda,you__canalso__embedthings__likelist__comprehensionexpressions__andmap__callstools__wemet__inearlier__chaptersand__willrevisit__inthis__andthe__next chapter: >>>showall__=lambda__x: [print(y)for__yin__x] #Loops__in lambda:list__comp >>>t__= showall(['lp5e', 'lp6e']) lp5e lp6e >>>showall__=lambda__x: list(map(print, x)) #Loops__in lambda:maps__>>>t__= showall(('py3.3', 'py3.12')) py3.3 py3.12 >>>showall__=lambda__x: print(*x, sep='', end='') #Another__option: *unpackingAnd__whileit__slimited__bythe__localscope__ofthe__functionthat__lambda makes,assignment__isin__scope (pun intended)for__lambdaexpressions__thatuse__the := named-assignment expression: >>>namer__=lambda__x: (res :=x__+ 1) +res__#Assignment__in lambda: := >>> namer(2) 6 >>>res__#But__it doesn'tpersist__NameError:name__'res'is__notdefined__Thereis__alimit__toemulating__statementswith__expressions:you__cant__assign nonlocals,for__instance,though__toolslike__thesetattr__built-in,the____dict__of__namespaces,and__methodsthat__changemutable__objectsin__placecan__sometimesstand__inand__canquickly__leadyou__deepinto__theheart__of expression-convolution__darkness.But__nowthat__thisbook__hasshown__youthese__tricks,it__mustalso__humblyimplore__youto__usethem__onlyas__alast__resort.Without__due care,they__canyield__unreadable (a.k.a. obfuscated)Python__code,despite__thelanguage__sbest__intents.In__general,simple__isbetter__than complex,explicit__isbetter__than implicit,and__fullstatements__arebetter__thanarcane__expressions.That__swhy__lambdais__limitedto__expressions.If__youhave__largerlogic__to code,use__def;lambda__isfor__smallpieces__ofinline__code.On__theother__hand,you__mayfind__thesetechniques__usefulwhen__takenin__moderation. Scopes:lambdas__CanBe__NestedToo__Onelast__lambda note:as__wesaw__inChapter__17,lambda__isalso__themain__beneficiaryof__enclosing-functionscope__lookupthe__Ein__theLEGB__scope rule.As__a review,in__thefollowing__thelambda__appearsinside__a def,its__typical coding,and__socan__accessthe__valuethat__namex__hadin__theenclosing__functions__scopeduring__its call: >>>def__action(x):return__(lambda y:x__+ y) #Make__function,remember__x >>>act__= action(99) >>> act(2) #Call__whataction__returned 101What__wasnt__illustratedin__theprior__discussionof__nestedfunction__scopesis__thata__lambdaalso__hasaccess__tothe__namesin__anyenclosing__lambda.This__caseis__somewhat obscure,but__imagineif__werecoded__theprior__defwith__a lambda: >>>action__= (lambda x: (lambda y:x__+ y)) #lambda__scopesnest__too >>>act__= action(99) >>> act(3) 102 >>> ((lambda x: (lambda y:x__+ y))(99))(4) #Even__ifyou__don'tsave__them 103 Here,the__nestedlambda__structuremakes__afunction__thatmakes__afunction__when called.In__both cases,the__nestedlambda__scode__hasaccess__tothe__variablex__inthe__enclosing lambda.This__works,but__itseems__fairlyconvoluted__code;in__theinterest__of readability,nested__lambdasmay__bebest__avoided.The__good news, perhaps,is__thatdef__cannotbe__nestedin__lambda:because__lambdas__bodyis__an expression,statements__likedef__wont__work thankfully!Functional__ProgrammingTools__Lastup__inthis__chapters__gumbois__areprisal__ofa__categoryof__toolswe__metin__earlierin__this book,with__afew__newtips__toround__outthe__topic.By__most definitions,today__sPython__blendssupport__formultiple__programming paradigms:procedural__(withits__basic statements), object-oriented (withits__classes),and__functional.The__criteriafor__thelatter__ofthese__categoriesare__somewhat loose,but__bymost__measuresPython__sfunctional__programmingtoolbox__includesits__first-classobject__model,nested__scope closures,and__anonymousfunction__lambdasthat__wemet__earlier;its__generatorsand__comprehensions,which__well__beexpanding__onin__thenext__chapter;and__perhapsits__functionand__classdecorators__previewedhere__butfleshed__outin__thisbook__sfinal__part.This__toolboxalso__includes built-infunctions__thatapply__otherfunctions__toiterables__automaticallyincluding__functionsthat__callother__functionson__aniterable__sitems__(map);select__itemsbased__ona__testfunction__(filter);and__applyfunctions__topairs__ofitems__andrunning__results (reduce).Let__swrap__upthis__chapterwith__aquick__surveyof__this trio.Mapping__Functionsover__Iterables:map__Oneof__themore__commonthings__programsdo__withlists__andother__sequencesis__applyan__operationto__eachitem__andcollect__theresults__selectingcolumns__indatabase__tables,incrementing__payfields__ofemployees__ina__company,parsing__email attachments,and__so on.Python__hasmultiple__toolsthat__makesuch__collection-wideoperations__easyto__code.For__instance,we__veseen__thatupdating__allthe__countersin__alist__canbe__doneeasily__witha__for loop: >>>counters__= [1, 2, 3, 4] >>>updated__= [] >>>for__xin__counters: updated.append(x + 10) #Add__10to__eachitem__>>> updated,counters__([11, 12, 13, 14], [1, 2, 3, 4])But__becausethis__issuch__acommon__operation,Python__alsoprovides__built-insthat__domost__ofthe__workfor__you.Among__them,the__mapfunction__appliesa__passed-infunction__toeach__itemin__aniterable__objectand__returnsa__listcontaining__allthe__function-call results.For__example,assuming__countersis__intact: >>>def__inc(x):return__x + 10 #Function__tobe__run >>> list(map(inc, counters)) #Collect__callresults__[11, 12, 13, 14]We__metmap__brieflyin__Chapters 13and__14,as__away__toapply__a built-infunction__toitems__inan__iterable. Here,we__makemore__generaluse__ofit__bypassing__ina__user-definedfunction__tobe__appliedto__eachitem__inthe__listmap__callsour__incon__eachlist__itemand__collectsall__thereturn__valuesinto__anew__list.Remember__thatmap__isa__nonsequence iterable,so__alist__callis__usedto__forceit__toproduce__allits__resultsfor__displayhere__(perChapter__14 coverage).Because__mapexpects__afunction__tobe__passedin__and applied,it__alsohappens__tobe__oneof__theplaces__wherelambda__commonly appears: >>> list(map((lambda x:x__+ 3), counters)) #Function__expression [4, 5, 6, 7] Here,the__functionadds__3to__eachitem__inthe__counters list;as__thislittle__functionisn__tneeded__elsewhere,it__waswritten__inlineas__a lambda.Because__suchuses__ofmap__areequivalent__tofor__loops,with__alittle__extracode__youcan__alwayscode__ageneral__mappingutility__yourself: >>>def__mymap(func, iter):res__= []for__xin__iter: res.append(func(x))return__resAssuming__thefunction__incis__stillas__itwas__whenit__wasshown__previously,we__canmap__itacross__asequence__(orother__iterable)with__eitherthe__built-inor__our equivalent: >>> list(map(inc, [1, 2, 3])) # Built-inis__aniterable__[11, 12, 13] >>> mymap(inc, [1, 2, 3]) #Ours__buildsa__list (see generators) [11, 12, 13] However,as__mapis__a built-in,it__salways__available,always__worksthe__same way,and__mayhave__performancebenefits__(aswe__llprove__inChapter__21,it__sfaster__thana__manuallycoded__forloop__insome__usage modes). Moreover,map__canbe__usedin__moreadvanced__waysthan__shown here.For__instance,given__multiplesequence__arguments,it__sendsitems__takenfrom__sequencesin__parallelas__distinctarguments__tothe__function: >>> pow(3, 4) # 3**4 81 >>> list(map(pow, [1, 2, 3], [2, 3, 4])) # 1**2, 2**3, 3**4 [1, 8, 81]With__multiple sequences,map__expectsan__N-argumentfunction__forN__sequences. Here,the__powfunction__takestwo__argumentson__eachcall__onefrom__eachsequence__passedto__map.It__snot__muchextra__workto__simulatethis__multiple-sequence__generalityin__code, too,but__well__postponedoing__sountil__laterin__thenext__chapter,after__weve__exploredsome__additionaliteration__tools (hint:it__wouldbe__betterto__generateitems__on demand,like__the built-in).The__mapcall__isalso__similarto__thelist__comprehensionexpressions__westudied__inChapter__14and__willrevisit__inthe__nextchapter__froma__functional perspective: >>> list(map(inc, [1, 2, 3, 4])) [11, 12, 13, 14] >>> [inc(x)for__xin__[1, 2, 3, 4]] [11, 12, 13, 14]In__some cases,map__maybe__fasterto__runthan__alist__comprehension,and__itmay__alsorequire__less code.On__theother__hand,because__mapapplies__afunction__callto__eachitem__insteadof__anarbitrary__expression,it__isa__somewhatless__general tool,and__oftenrequires__extrahelper__functionsor__lambdas. Moreover,wrapping__acomprehension__inparentheses__insteadof__squarebrackets__createsan__objectthat__generatesvalues__onrequest__tosave__memoryand__increase responsiveness,much__likemap__atopic__well__takeup__inthe__next chapter.Selecting__Itemsin__Iterables:filter__Themap__functionis__aprimary__andrelatively__straightforwardrepresentative__ofPython__sfunctional__programming toolset.Its__close relatives,filter__and reduce,select__aniterable__sitems__basedon__atest__functionand__applyfunctions__toitem__pairs, respectively.Because__italso__returnsan__iterable,filter__(like range)requires__alist__callto__displayall__itsresults__ina__REPL.For__example,the__followingfilter__callpicks__outitems__ina__sequencethat__aregreater__than zero: >>> list(range( 5, 5)) [ 5, 4, 3, 2, 1, 0, 1, 2, 3, 4] >>> list(filter((lambda x:x__> 0), range( 5, 5))) [1, 2, 3, 4]We__metfilter__brieflyearlier__inthe__sidebarWhy__YouWill__Care:Booleans__andwhile__exploringiterables__inChapter__14.Items__inthe__sequenceor__iterablefor__whichthe__functionreturns__atrue__resultare__addedto__theresult__list.Like__map,this__functionis__roughlyequivalent__toa__for loop,but__itis__built-in, concise,and__often fast: >>>res__= [] >>>for__xin__range( 5, 5): #The__statementequivalent__offilter__ifx__> 0: #Simple__butslower__today,probably__res.append(x) >>>res__[1, 2, 3, 4]Also__like map,filter__canbe__emulatedby__listcomprehension__syntaxwith__oftensimpler__results (especiallywhen__itcan__avoidcreating__anew__function),and__witha__similargenerator__expressionwhen__codedwith__enclosingparentheses__todelay__productionof__resultsthough__again,the__generatorstory__willhave__toremain__ateaser__forthe__next chapter: >>> [xfor__xin__range( 5, 5)if__x > 0] [1, 2, 3, 4]Combining__Itemsin__Iterables:reduce__Thefunctional__reducecall__oncea__built-inbut__nowa__residentof__thefunctools__standard-librarymodule__ismore__complex.It__acceptsan__iterableto__process,but__its__notan__iterable itself:it__returnsa__singleresult__thataggregates__aniterable__s items.To__demo,here__aretwo__reducecalls__thatcompute__thesum__andproduct__ofthe__itemsin__a list: >>>from__functoolsimport__reduce >>> reduce((lambda x, y:x__+ y), [1, 2, 3, 4]) 10 >>> reduce((lambda x, y:x__* y), [1, 2, 3, 4]) 24At__each step,reduce__passesthe__currentsum__or product,along__withthe__nextitem__fromthe__list,to__the passed-inlambda__function.By__default,the__firstitem__inthe__sequenceinitializes__thestarting__value.To__makethat__moreconcrete__again,here__sthe__forloop__equivalentto__thefirst__ofthese__calls,with__theaddition__hardcodedinside__the loop: >>>L__= [1, 2, 3, 4] >>>res__= L[0] >>>for__xin__L[1:]:res__+=x__>>>res__10In__fact,coding__yourown__reusableand__customizableversion__ofreduce__isfairly__straightforward too.The__followingfunction__emulatesmost__ofthe__built-ins__behaviorand__helpsdemystify__itsoperation__in general: >>>def__myreduce(function, sequence):tally__= sequence[0]for__nextin__sequence[1:]:tally__= function(tally, next)return__tally >>> myreduce((lambda x, y:x__+ y), [1, 2, 3, 4]) 10 >>> myreduce((lambda x, y:x__* y), [1, 2, 3, 4]) 24The__built-inreduce__alsoallows__anoptional__third argument,effectively__placedbefore__theitems__inthe__sequenceto__serveas__aninitial__valueand__adefault__resultwhen__thesequence__is empty,but__well__leavethis__extensionas__asuggested__exercise (again,emulating__built-intools__is instructive,but__superfluous).If__thiscoding__techniquehas__sparkedyour__interest,you__mightalso__beinterested__inthe__standard-libraryoperator__module,which__providesfunctions__thatcorrespond__to built-inexpressions__andso__comesin__handyfor__someuses__offunctional__tools (consulthelp__ina__REPLor__Pythons__librarymanual__formore__detailson__this module): >>>import__operator,functools__>>> functools.reduce(operator.add, [2, 4, 6]) # Function-based + 12 >>> functools.reduce((lambda x, y:x__+ y), [2, 4, 6]) 12 Together, map, filter,and__reducesupport__powerfulfunctional__programming techniques.As__mentioned,many__observerswould__alsoextend__thefunctional__programmingtoolset__inPython__toinclude__thenested__functionclosures__andanonymous__functionlambdas__weve__explored,as__wellas__thegenerators__andcomprehensions__weve__metin__piecemealfashion__alongthe__way.To__fullygrok__thelatter__two, though,we__mustmove__onto__thenext__chapter.Chapter__SummaryThis__chapters__collagetook__uson__atour__of function-related topics:function__design guidelines;recursive__functions;function__attributes, annotations,and__decorators;lambda__expressions;and__the map, filter,and__reduce built-ins.Some__ofthese__are advanced,but__mostare__commonin__Python programming.The__nextchapter__continuesthe__advanced-topicsmotif__witha__reprisalof__comprehensionsand__anunmasking__ofgenerators__toolsthat__arejust__asrelated__tofunctional__programmingas__tolooping__statements.Before__youmove__on, though,make__sureyou__vemastered__theconcepts__coveredhere__byworking__throughthis__chapters__quiz.Test__Your Knowledge:Quiz__1.How__arelambda__expressionsand__defstatements__related? 2.What__sthe__pointof__using lambda? 3.Compare__andcontrast__map, filter,and__reduce. 4.What__arefunction__annotations,and__howare__they used? 5.What__arerecursive__functions,and__howare__they used? 6.What__aresome__generaldesign__guidelinesfor__coding functions? 7.Name__threeor__moreways__thatfunctions__cancommunicate__resultsto__a caller.Test__Your Knowledge:Answers__1.Both__lambdaand__defcreate__functionobjects__tobe__called later.Because__lambdais__an expression, though,it__returnsa__functionobject__insteadof__assigningit__toa__name,and__itcan__beused__tonest__afunction__definitionin__placeswhere__adef__willnot__work syntactically.A__lambdaallows__foronly__asingle__implicitreturn__value expression, though;because__itdoes__notsupport__ablock__of statements,it__isnot__idealfor__larger functions. 2.lambda__allowsus__toinline__smallunits__ofexecutable__code,defer__its execution,and__provideit__withstate__inthe__formof__defaultarguments__andenclosing__scope variables.Using__alambda__isnever__required;you__canalways__codea__definstead__andreference__thefunction__by name.lambda__comesin__handy, though,to__embedsmall__piecesof__deferredcode__thatare__unlikelyto__beused__elsewherein__a program.It__commonlyappears__in callback-basedprograms__suchas__GUIs,and__hasa__naturalaffinity__withfunctional__toolslike__mapand__filterthat__expecta__processing function. 3.These__three built-infunctions__allapply__anotherfunction__toitems__ina__sequence (orother__iterable)object__andcollect__results.map__passeseach__itemto__thefunction__andcollects__call results,filter__collectsitems__forwhich__thefunction__returnsa__true value,and__reducecomputes__asingle__valueby__applyingthe__functionto__anaccumulator__andsuccessive__items.Unlike__theother__two,reduce__isavailable__inthe__functools module,not__the built-inscope__(inmodern__Python history,at__least). 4.Function__annotationsare__syntacticembellishments__ofa__functions__argumentsand__result,which__arecollected__intoa__dictionaryassigned__tothe__functions____annotations__ attribute.Python__placesno__semanticmeaning__onthese__annotations,but__simplypackages__themfor__potentialuse__byother__tools. 5.Recursive__functionscall__themselveseither__directlyor__indirectlyin__orderto__loop (i.e., repeat).They__maybe__usedto__traversearbitrarily__shaped structures,but__theycan__alsobe__usedfor__iterationin__general (thoughthe__latterrole__isoften__moresimply__andefficiently__codedwith__looping statements).Recursion__canoften__besimulated__orreplaced__bycode__thatuses__explicitstacks__orqueues__tohave__morecontrol__over traversals. 6.Functions__shouldgenerally__besmall__andas__self-containedas__possible,have__asingle__unified purpose,and__communicatewith__othercomponents__throughinput__argumentsand__return values.They__mayuse__mutablearguments__tocommunicate__resultstoo__ifchanges__are expected,and__sometypes__ofprograms__implyother__communication mechanisms. 7.Functions__cansend__backresults__withreturn__statements,by__changing passed-inmutable__arguments,and__bysetting__global variables.Globals__aregenerally__frownedupon__(exceptfor__veryspecial__cases,like__multithreaded programs)because__theycan__makecode__moredifficult__tounderstand__and use.return__statementsare__usually best,but__changingmutables__isfine__(andeven__useful),if__expected.Functions__mayalso__communicateresults__withsystem__devicessuch__asfiles__and sockets,but__theseare__beyondour__scope here.WHY__YOUWILL__CARE:LAMBDA__CALLBACKSAnother__commonrole__forlambda__isto__defineinline__callbackfunctions__forPython__stkinter__GUI API.For__example,the__followingcreates__abutton__thatprints__amessage__onthe__consolewhen__pressed,assuming__tkinteris__presentin__yourPython__(itis__bydefault__onmost__PCsand__atleast__oneAndroid__app):from__tkinterimport__Button,mainloop__x = Button( text='Press me', command=lambda: print('Tapped!')) x.pack() mainloop() #This__maybe__optionalin__someREPLs__Here,we__registerthe__callbackhandler__bypassing__afunction__generatedwith__alambda__tothe__commandkeyword__argument.The__advantageof__lambdaover__defin__thisis__thatthe__codethat__handlesa__buttonpress__isright__here,embedded__inthe__button-creation call.In__effect,the__lambdadefers__executionof__thehandler__untilthe__event occurs:the__printcall__happenson__button presses,not__whenthe__buttonis__created,and__effectivelyknows__thestring__itshould__writewhen__theevent__occurs.Real__GUIsrarely__printto__consoles,of__course,but__thisdemos__thecoding__pattern.Because__thenested__functionscope__rulesapply__to lambda,they__automaticallysee__namesin__thefunctions__inwhich__theyare__codedand__hencedon__trequire__passed-indefaults__inmost__cases (exceptfor__loop variables,per__Chapter 17).This__isespecially__usefulfor__accessingthe__specialself__instanceargument__thatis__alocal__variablein__enclosingclass__methodfunctions__(whichwe__llstudy__inPart__VI,so__takethis__aspreview__only):class__MyGui:def__makewidgets(self): Button(command=lambda: self.onPress('Tapped!'))def__onPress(self, message):use__messageAs__youll__see later,both__classobjects__with__call____andbound__methodsoften__servein__callbackroles__toowatch__forcoverage__ofthese__inChapters__30and__31.And__allof__thisapplies__tocoding__eventcallbacks__inother__commonlyused__andportable__GUItoolkits__forPython__including Kivy,Toga__(in BeeWare), PyQT,and__wxPython.tkinter__getsmore__presshere__onlybecause__its__shippedwith__Pythons__standard library.As__forall__tools,you__shouldvet__GUIsfor__yourself.Chapter__20.Comprehensions__andGenerations__Thischapter__exploresa__setof__advanced function-relatedtools__and topics.Its__mainsubjects__aregenerator__functionsand__theirgenerator__expressionrelatives__user-definedways__toproduce__resultson__demandthe__sameway__thatmany__built-ins__do.Because__generatorsapply__theiteration__protocoland__generatorexpressions__reusecomprehension__syntax,this__chapteris__alsopartly__a follow-upto__Chapter 14 (henceits__title).We__llextend__thesetopics__totheir__completionhere__anddemo__withlarger__examplesthat__tieideas__together. Finally,this__chapterprovides__justenough__ofan__introto__getyou__startedwith__asynccoroutines__toolsthat__buildon__generators,but__assumeknowledge__ofparallel__programming,which__isoutside__thescope__ofthis__bookand__theneeds__ofmost__Python learners.You__wont__becomean__asyncmaster__here,but__youll__geta__headstart__forfurther__explorations.Iteration__andgeneration__inPython__alsoencompasses__user-defined classes,but__well__deferthat__finalpart__ofthis__storyuntil__Part VI,when__westudy__operator overloading.The__nextchapter__continuesthreads__spunhere__bytiming__therelative__performanceof__someof__thischapter__stools__asa__largercase__study.Before__that, though,let__spick__upthe__comprehensionsand__iterationsstory__whereit__waslast__left,and__extendit__toinclude__value generators. Comprehensions:The__FinalAct__Asmentioned__earlyin__this book,Python__supportsthe__procedural, object- oriented,and__functionprogramming__paradigms.Among__these,Python__hasa__hostof__toolsthat__mostobservers__wouldconsider__functionalin__nature,which__weenumerated__inthe__precedingchapter__closures, generators, lambdas, comprehensions, maps, decorators,function__objects,and__more.These__toolsallow__usto__applyand__combinefunctions__inpowerful__ways,and__oftenoffer__stateretention__andcoding__solutionsthat__arealternatives__toclasses__and OOP.For__instance,the__priorchapter__exploredtools__suchas__mapand__filterkey__membersof__Pythons__early functional-programmingtoolset__inspiredby__theLisp__languagethat__mapoperations__overiterables__andcollect__results.Because__thisis__sucha__commontask__in coding,Python__eventuallysprouted__anew__expressionthe__listcomprehension__adevice__inspiredby__languageslike__Haskell,which__iseven__moreflexible__thanthe__originalfunctional__toolset.As__weve__seen,list__comprehensionsapply__anarbitrary__expressionto__itemsin__an iterable,rather__thanapplying__a function. Accordingly,they__canbe__moregeneral__tools.In__later Pythons,the__listcomprehension__wasextended__toother__roles sets, dictionaries,and__eventhe__valuegenerator__expressionswe__llexplore__inthis__chapter. Hence,it__snot__justfor__lists anymore,and__well__simplycall__itcomprehension__whenreferring__toall__itsforms__collectively.We__firstmet__comprehensionsin__Chapter 4s__preview,introduced__themin__PartII__scoverage__of sets, lists,and__dictionaries,and__studiedthem__furtherin__Chapter 14,in__conjunctionwith__looping statements.Because__theyre__alsorelated__tofunctional__programmingtools__likethe__mapand__filtercalls__andrepurposed__bygenerator__expressions, though,let__sresurrect__thetopic__herefor__onelast__look.List__ComprehensionsReview__Heres__abrief__exampleto__refresha__few neurons.As__welearned__inChapter__7,Python__s built-inord__functionreturns__theinteger__codepoint__ofa__single character.If__wewish__tocollect__codepoints__ofall__charactersin__anentire__string,a__straightforwardapproach__isto__usea__simplefor__loopand__appendthe__resultsto__a list.In__a REPL: >>>res__= [] >>>for__xin__'text': res.append(ord(x)) #Manual__resultscollection__>>>res__[116, 101, 120, 116]Now__thatwe__knowabout__map, though,we__canachieve__similarresults__witha__singlefunction__callwithout__havingto__managelist__constructionin__the code: >>>res__= list(map(ord, 'text')) #Apply__functionto__iterable >>>res__[116, 101, 120, 116] However,we__canget__thesame__resultsfrom__alist__comprehensionexpression__whilemap__mapsa__functionover__an iterable,list__comprehensionsmap__an expression: >>>res__= [ord(x)for__xin__'text'] #Apply__expressionto__iterable >>>res__[116, 101, 120, 116]List__comprehensionscollect__theresults__ofapplying__anexpression__toan__iterableof__values,and__returnthem__ina__new list. Syntactically,list__comprehensionsare__enclosedin__squarebrackets__toremind__youthat__theyconstruct__lists.In__theirbasic__form,within__thebrackets__youcode__anexpression__thatnames__a variable,followed__bywhat__lookslike__afor__loopheader__thatnames__thesame__variable.You__getback__theexpression__sresults__foreach__iterationof__theimplied__loop.The__effectof__thepreceding__exampleis__similarto__thatof__themanual__forloop__andthe__map call.List__comprehensionsbecome__more convenient, though,when__wewish__toapply__anarbitrary__expressioninstead__ofa__function: >>> [x ** 2for__xin__range(10)] #Squares__ofnumbers__0to__9 [0, 1, 4, 9, 16, 25, 36, 49, 64, 81]To__dosimilar__workwith__amap__call,we__mayneed__toinvent__alittle__functionto__implementthe__square operation.Because__wewon__tneed__thisfunction__elsewhere,we__dtypically__(butnot__necessarily)code__it inline,with__a lambda: >>> list(map((lambda x:x__** 2), range(10))) [0, 1, 4, 9, 16, 25, 36, 49, 64, 81]This__doesthe__same job,and__its__onlya__fewkeystrokes__longerthan__theequivalent__list comprehension.It__salso__onlymarginally__morecomplex__(at least,once__youunderstand__the lambda).For__moreadvanced__roles, though,list__comprehensionswill__oftenrequire__considerablyless__typing.For__instance,as__welearned__inChapter__14,you__cancode__anif__clauseafter__thecomprehension__sfor__toadd__selection logic.List__comprehensionswith__ifclauses__canbe__thoughtof__asanalogous__tothe__filter built-inin__thepreceding__chapterthey__skipan__iterables__itemsfor__whichthe__ifclause__isnot__true.As__a demo,following__areboth__schemes,along__withthe__equivalent for,picking__upeven__numbersfrom__0to__9 (x % 2is__zerofor__evens only): >>> [xfor__xin__range(10)if__x % 2 == 0] [0, 2, 4, 6, 8] >>> list(filter((lambda x:x__% 2 == 0), range(10))) [0, 2, 4, 6, 8] >>>res__= [] >>>for__xin__range(10):if__x % 2 == 0: res.append(x) >>>res__[0, 2, 4, 6, 8]Though__its__penalizedby__havingto__codea__functionto__be applied,the__filtercall__hereis__stillnot__muchlonger__thanthe__listcomprehension__either. However,the__listcomprehension__cancombine__anif__clauseand__anarbitrary__expression,to__giveit__theeffect__ofa__filterand__amap__ina__single expression: >>> [x ** 2for__xin__range(10)if__x % 2 == 0] [0, 4, 16, 36, 64]This__time,we__collectthe__squaresof__theeven__numbersfrom__0through__9:the__forloop__skipsnumbers__forwhich__theattached__ifclause__onthe__rightis__false,and__theexpression__onthe__leftcomputes__the squares.The__equivalentmap__callwould__requirea__lotmore__workon__ourpart__wewould__haveto__combinefilter__selectionswith__map iteration,making__fora__noticeablymore__complex expression: >>> list( map((lambda x: x**2), filter((lambda x:x__% 2 == 0), range(10))) ) [0, 4, 16, 36, 64]Formal__ComprehensionSyntax__In fact,list__comprehensionsare__moregeneral__still.In__theirsimplest__form,you__mustalways__codean__accumulationexpression__anda__singlefor__clause: [expression__fortarget__initerable__]Though__allother__partsare__optional,they__allowricher__iterationsto__beexpressed__youcan__codeany__numberof__nestedfor__loopsin__alist__comprehension,and__eachmay__havean__optionalassociated__iftest__toact__asa__filter.The__generalstructure__oflist__comprehensionslooks__like this: [expression__for target1in__iterable1if__condition1for__target2in__iterable2if__condition2 ...for__targetNin__iterableNif__conditionN ]This__exactsame__syntaxis__inheritedby__setand__dictionarycomprehensions__aswell__asthe__generatorexpressions__coming up,though__theseuse__differentenclosing__characterscurly__bracesfor__thefirst__twoand__often-optionalparentheses__forthe__latterand__thedictionary__comprehensionbegins__withtwo__expressionsseparated__bya__colon (forkey__and value).We__experimentedwith__theif__filterclause__inthe__previous section.When__forclauses__arenested__withina__list comprehension,they__worklike__equivalentnested__forloop__statements.For__example: >>>res__= [x +y__forx__in [0, 1, 2]for__yin__[100, 200, 300]] >>>res__[100, 200, 300, 101, 201, 301, 102, 202, 302]This__hasthe__sameeffect__asthis__substantiallymore__verbose equivalent: >>>res__= [] >>>for__xin__[0, 1, 2]:for__yin__[100, 200, 300]: res.append(x + y) >>>res__[100, 200, 300, 101, 201, 301, 102, 202, 302]Although__listcomprehensions__constructlist__results,remember__thatthey__caniterate__overany__iterable object.Here__sa__similarbit__ofcode__thattraverses__stringsinstead__oflists__of numbers,and__socollects__concatenation results: >>> [x +y__forx__in 'orm'for__yin__'ORM'] # 3 * 3results__['oO', 'oR', 'oM', 'rO', 'rR', 'rM', 'mO', 'mR', 'mM']Each__forclause__canhave__anassociated__if filter,no__matterhow__deeplythe__loopsare__nestedthough__usecases__forthe__followingsort__of code,apart__perhapsfrom__themultidimensional__arrays ahead,start__tobecome__moreand__moredifficult__toimagine__atthis__level: >>> [x +y__forx__in 'orm'if__xin__'ro'for__yin__'ORM'if__y > 'M'] ['oO', 'oR', 'rO', 'rR'] >>> [x +y__+z__forx__in 'hack'if__x > 'c'for__yin__'CODE'if__yin__'OD'for__zin__'123'if__z > '1'] ['hO2', 'hO3', 'hD2', 'hD3', 'kO2', 'kO3', 'kD2', 'kD3'] Finally,here__isa__similarlist__comprehensionthat__illustratesthe__effectof__attachedif__selectionson__nestedfor__clausesapplied__tonumeric__objectsrather__than strings: >>> [(x, y)for__xin__range(5)if__x % 2 == 0for__yin__range(5)if__y % 2 == 1] [(0, 1), (0, 3), (2, 1), (2, 3), (4, 1), (4, 3)]This__expressioncombines__evennumbers__from 0through__4with__oddnumbers__from 0through__4.The__ifclauses__filterout__itemsin__each iteration.Here__isthe__equivalent statement-based code: >>>res__= [] >>>for__xin__range(5):if__x % 2 == 0:for__yin__range(5):if__y % 2 == 1: res.append((x, y)) >>>res__[(0, 1), (0, 3), (2, 1), (2, 3), (4, 1), (4, 3)]Recall__thatif__youre__confusedabout__whata__complexlist__comprehension does,you__canalways__nestthe__listcomprehension__sfor__andif__clausesinside__eachother__likethis__indentingeach__clausesuccessively__furtherto__theright__toderive__theequivalent__statements.The__resultis__longer,but__perhapsclearer__inintent__tosome__humanreaders__onfirst__glance,especially__thosemore__familiarwith__basic statements.The__mapand__filterequivalent__ofthis__lastexample__wouldbe__wildlycomplex__anddeeply__nested,so__thisbook__willleave__itscoding__asan__exercisefor__Zen masters,ex__Lisp programmers,and__thosewith__fartoo__muchfree__time. Example:List__Comprehensionsand__MatrixesNot__alllist__comprehensionsare__so artificial,of__course.Let__slook__atone__moreapplication__tostretch__ourcomprehension__muscles.As__wesaw__inChapters__4and__8,one__basicway__tocode__matrixes (a.k.a.multidimensional__arrays)in__Pythonis__withnested__list structures.The__following,for__example,defines__two 3 3matrixes__aslists__ofnested__lists: >>>M__= [[1, 2, 3], [4, 5, 6], [7, 8, 9]] >>>N__= [[2, 2, 2], [3, 3, 3], [4, 4, 4]]Given__this structure,we__canalways__index rows,and__columnswithin__rows,using__normalindex__operations: >>> M[1] #Row__2 [4, 5, 6] >>> M[1][2] #Row__2,item__3 6List__comprehensionsare__powerfultools__forprocessing__suchstructures__becausethey__automaticallyscan__rowsand__columns.For__instance,although__thiscode__storesthe__matrixby__rows,to__collectthe__secondcolumn__wecan__simplyiterate__acrossthe__rowsand__pullout__thedesired__column,or__iteratethrough__positionsin__therows__andindex__aswe__go: >>> [row[1]for__rowin__M] #Column__2 [2, 5, 8] >>> [M[row][1]for__rowin__(0, 1, 2)] #Using__offsets [2, 5, 8]Given__positions,we__canalso__easilyperform__taskssuch__aspulling__outa__diagonal.The__firstof__thefollowing__expressionsuses__rangeto__generatethe__listof__offsetsand__thenindexes__withthe__rowand__columnthe__same,picking__out M[0][0],then__M[1][1],and__so on.The__secondscales__thecolumn__indexto__fetch M[0][2], M[1] [1], etc. (weassume__thematrix__hasthe__samenumber__ofrows__and columns): >>> [M[i][i]for__iin__range(len(M))] #Diagonals__[1, 5, 9] >>> [M[i][len(M)-1-i]for__iin__range(len(M))] [3, 5, 7]Changing__sucha__matrixin__placerequires__assignmentto__offsets (userange__twiceif__shapes differ): >>>L__= [[1, 2, 3], [4, 5, 6]] >>>for__iin__range(len(L)):for__jin__range(len(L[i])): #Update__inplace__L[i][j] += 10 >>>L__[[11, 12, 13], [14, 15, 16]]We__cant__reallydo__thesame__withlist__comprehensions,as__theymake__new lists,but__wecould__alwaysassign__theirresults__tothe__originalname__fora__similar effect.For__example,we__canapply__anoperation__toevery__itemin__a matrix,producing__resultsin__eithera__simplevector__ora__matrixof__thesame__shape: >>> [col + 10for__rowin__Mfor__colin__row] #Assign__toM__toretain__newvalue__[11, 12, 13, 14, 15, 16, 17, 18, 19] >>> [[col + 10for__colin__row]for__rowin__M] [[11, 12, 13], [14, 15, 16], [17, 18, 19]]To__understand these,translate__totheir__simplestatement__formequivalents__thatfollow__indentparts__thatare__furtherto__theright__inthe__expression (asin__thefirst__loopin__the following),and__makea__newlist__whencomprehensions__arenested__onthe__left (likethe__secondloop__inthe__following).As__itsstatement__equivalentmakes__clearer,the__secondexpression__inthe__precedingworks__becausethe__rowiteration__isan__outer loop:for__each row,it__runsthe__nestedcolumn__iterationto__buildup__onerow__ofthe__result matrix: >>>res__= [] >>>for__rowin__M: #Statement__equivalentsfor__colin__row: #Indent__partsfurther__right res.append(col + 10) >>>res__[11, 12, 13, 14, 15, 16, 17, 18, 19] >>>res__= [] >>>for__rowin__M:tmp__= [] # Left-nestingstarts__newlist__forcol__in row: tmp.append(col + 10) res.append(tmp) >>>res__[[11, 12, 13], [14, 15, 16], [17, 18, 19]] Finally,with__abit__of creativity,we__canalso__uselist__comprehensionsto__combinevalues__ofmultiple__matrixes.The__followingfirst__buildsa__flatlist__thatcontains__theresult__ofmultiplying__thematrixes__pairwise,and__thenbuilds__anested__liststructure__havingthe__samevalues__bynesting__listcomprehensions__again: >>>M__[[1, 2, 3], [4, 5, 6], [7, 8, 9]] >>>N__[[2, 2, 2], [3, 3, 3], [4, 4, 4]] >>> [M[row][col] * N[row][col]for__rowin__range(3)for__colin__range(3)] [2, 4, 6, 12, 15, 18, 28, 32, 36] >>> [[M[row][col] * N[row][col]for__colin__range(3)]for__rowin__range(3)] [[2, 4, 6], [12, 15, 18], [28, 32, 36]]This__lastexpression__worksbecause__therow__iterationis__anouter__loop again;it__sequivalent__tothis__statement-based code:res__= []for__rowin__range(3):tmp__= []for__colin__range(3): tmp.append(M[row][col] * N[row][col]) res.append(tmp)And__formore__fun,we__canuse__zipto__pairitems__tobe__multipliedthe__followingcomprehension__andloop__statementboth__producethe__same list-of-listspairwise__multiplicationresult__asthe__lastpreceding__example (andbecause__zipis__agenerator__of values,this__isnt__asinefficient__asit__may seem): [[col1 * col2for__(col1, col2)in__zip(row1, row2)]for__(row1, row2)in__zip(M, N)]res__= []for__(row1, row2)in__zip(M, N):tmp__= []for__(col1, col2)in__zip(row1, row2): tmp.append(col1 * col2) res.append(tmp)Compared__totheir__statement equivalents,the__listcomprehension__versionshere__requireonly__oneline__of code,might__runsubstantially__fasterfor__large matrixes,and__justmight__makeyour__head explode.Which__bringsus__tothe__next section.When__notto__uselist__comprehensions:Code__obfuscationWith__such generality,list__comprehensionscan__quickly become, well, incomprehensible,especially__when nested.Some__programmingtasks__areinherently__complex,and__wecan__tsugarcoat__themto__makethem__anysimpler__thanthey__are (seethe__upcomingpermutations__fora__prime example).Tools__likecomprehensions__arepowerful__solutionswhen__used wisely,and__theres__nothinginherently__wrongwith__usingthem__inyour__scripts.At__thesame__time,code__likethat__atthe__endof__theprior__sectionmay__introducemore__complexitythan__itshould__and, frankly,tends__todisproportionately__sparkthe__interestof__thoseholding__thedarker__andmisinformed__assumptionthat__codeobfuscation__somehowimplies__talent.In__theinterest__ofsoftware__citizenship,some__perspectiveseems__inorder__here.This__bookdemonstrates__advancedcomprehensions__to teach,but__inthe__real world,programming__isnot__aboutbeing__cleverand__obscureit__sabout__howclearly__yourprogram__communicatesits__purpose.Writing__trickycomprehensions__maybe__afun__academic recreation,but__itdoesn__twork__inprograms__thatothers__willsomeday__needto__understand.In__other words,the__age-oldacronym__KISSapplies__hereas__always:Keep__ItSimple__traditionallyfollowed__eitherby__aword__thatis__nowtoo__sexist,or__anotherthat__istoo__colorfulfor__a G-ratedbook__like this.If__youhave__totranslate__codeto__simplerstatements__tounderstand__it,it__shouldprobably__besimpler__statementsin__thefirst__place.When__touse__list comprehensions: Speed, conciseness, etc. Nevertheless,in__this case,there__iscurrently__aperformance__advantageto__theextra__complexity:based__ontests__rununder__Python today,map__callsand__listcomprehensions__canbe__significantlyfaster__thanequivalent__for loops.This__speeddifference__canvary__perusage__and Python,but__isdue__tothe__factthat__mapand__listcomprehensions__runat__compiled-languagespeed__insidethe__interpreter,which__isgenerally__fasterthan__runningfor__loopbytecode__withinthe__PVM.Also__inthe__plus column,list__comprehensionsoffer__acode__concisenessthat__scompelling__andeven__warrantedwhen__thatreduction__insize__doesnt__alsoimply__areduction__inmeaning__forthe__next programmer;many__findthe__expressivenessof__comprehensionsto__bea__powerful ally;and__becausemap__andlist__comprehensionsare__both expressions,they__alsocan__showup__syntacticallyin__placesthat__forloop__statements cannot,such__asin__lambdaand__object literals.Because__ofall__this,list__comprehensionsand__mapcalls__areworth__knowingand__usingfor__simplesorts__of iterations,especially__ifyour__applications__speedis__animportant__consideration.For__example,it__shard__toargue__withthe__easeand__powerof__codelike__eitherof__the following: [line.rstrip()for__linein__open('myfile')] map((lambda line: line.rstrip()), open('myfile'))To__achievethe__samememory__economyand__executiontime__divisionas__map, though,list__comprehensionsmust__becoded__asgenerator__expressionswhich__iswhy__weve__runthrough__thisreview__inthe__first place,and__oneof__themajor__topicsthis__chapterturns__to next.Generator__Functionsand__ExpressionsPython__todaysupports__procrastinationmuch__morethan__itdid__inthe__pastit__providestools__thatproduce__resultsonly__when needed,instead__ofall__at once.We__veseen__thisat__workin__built-in tools:files__thatread__lineson__request,and__functionslike__mapand__zipthat__produceitems__on demand.Such__lazinessisn__tconfined__toPython__itself, though.In__particular,two__languageconstructs__delayresult__creationwhenever__possiblein__user-defined operations:Generator__functionsare__codedas__normaldef__statements,but__useyield__statementsto__returnresults__oneat__a time,suspending__andresuming__theirstate__between each.Generator__expressionsare__similarto__thelist__comprehensionsof__theprior__section,but__theyreturn__anobject__thatproduces__resultson__demandinstead__ofbuilding__aresult__list.Because__neitherof__theseconstructs__aresult__listall__at once,they__bothsave__memoryspace__andallow__computationto__besplit__acrossrequests__toavoid__pausesand__enablelarge__(andeven__infinite ) results.As__youll__see,both__ofthese__ultimatelyperform__their delayed-resultsmagic__byimplementing__theiteration__protocolwe__studiedin__Chapter 14.These__featuresdate__backto__atleast__Python 2.2 (andwere__exploredeven__earlierin__languageslike__Icon),and__arecommon__inPython__code today.Though__theymay__initiallyseem__unusualif__youre__accustomedto__simpler models,you__llprobably__findgenerators__tobe__apowerful__tool. Moreover,because__theyare__anatural__extensionto__the function, comprehension,and__iterationtopics__weve__already explored,you__alreadyknow__moreabout__codinggenerators__thanyou__might expect.Generator__Functions:yield__Versusreturn__Inthis__partof__the book,we__velearned__aboutcoding__normalfunctions__thatreceive__inputparameters__andsend__backa__singleresult__immediately.It__isalso__possible, however,to__writefunctions__thatmay__sendback__avalue__andlater__be resumed,picking__upwhere__theyleft__off.Such__functionsare__knownas__generatorfunctions__becausethey__generatea__seriesof__valuesover__timeinstead__ofstopping__afterjust__one.Generator__functionsare__likenormal__functionsin__most respects,and__infact__arecoded__withnormal__def statements. However,when__created,they__arecompiled__speciallyinto__anobject__thatsupports__theiteration__protocol.When__called,they__dont__returna__result:they__returna__resultgenerator__thatcan__appearin__anyiteration__context.We__studiediterables__inChapter__14,and__Figure 14-1gave__aformal__andgraphic__summaryof__their operation. Here,we__llrevisit__thesubject__tosee__howit__appliesto__generators.State__suspensionUnlike__normalfunctions__thatreturn__avalue__and exit,generator__functionsautomatically__suspendand__resumetheir__executionand__statearound__thepoint__ofvalue__generation.Because__of that,they__areoften__auseful__alternativeto__bothcomputing__anentire__seriesof__valuesup__frontand__manuallysaving__andrestoring__statein__classes.The__statethat__generatorfunctions__retainwhen__theyare__suspendedincludes__boththeir__codelocation__andtheir__entirelocal__scope. Hence,their__localvariables__retaininformation__between results,and__makeit__availablewhen__thefunctions__are resumed.The__chiefcode__differencebetween__generatorand__normalfunctions__isthat__agenerator__yieldsa__value,rather__thanreturning__onethe__yieldstatement__suspendsthe__functionand__sendsa__valueback__tothe__caller,but__retainsenough__stateto__enablethe__functionto__resumefrom__whereit__left off.When__resumed,the__functioncontinues__executionimmediately__afterthe__lastyield__run.From__thefunction__s perspective,this__allowsits__codeto__producea__seriesof__valuesover__time,rather__thancomputing__themall__atonce__andsending__themback__insomething__likea__list.Iteration__protocolintegration__Totruly__understandgenerator__functions,you__needto__knowthat__theyare__closelybound__upwith__thenotion__ofthe__iterationprotocol__in Python.As__weve__seen,iterator__objectsdefine__a__next____method,which__eitherreturns__thenext__itemin__the iteration,or__raisesthe__StopIterationexception__toend__the iteration.An__iterableobject__siterator__isfetched__initiallywith__the__iter____method,though__thisstep__isa__no-opfor__objectsthat__aretheir__own iterator.Python__for loops,and__allother__iteration tools,use__thisiteration__protocolto__stepthrough__asequence__orvalue__generator,if__theprotocol__issupported__(if not,iteration__fallsback__onrepeatedly__indexingsequences__instead).Any__objectthat__supportsthis__interfaceworks__inall__iteration tools,and__theiter__andnext__built-ins__simplifymanual__iterationby__callingthe__corresponding double-underscoremethod__(orits__internal equivalent).To__supportthis__protocol,functions__containinga__yieldstatement__arecompiled__speciallyas__generatorsthey__arenot__normal functions,but__ratherare__builtto__returnan__objectwith__theexpected__iteration-protocol methods.When__later called,such__functionsreturn__aniterable__objectthat__supportsthe__iterationprotocol__withan__automaticallycreated__methodnamed____next__to__startor__resume execution.Besides__yield,generator__functionsmay__alsouse__areturn__statement that,along__withfalling__offthe__endof__thedef__block,terminates__thegeneration__ofvalues__byautomatically__raisinga__StopIteration exception.A__generators__returncan__alsogive__anobject__thatbecomes__thevalue__attributeof__theStopIteration__exception,but__its__ignoredby__iterationtools__and uncommon.From__thecaller__s perspective,the__generators____next__method__simplystarts__orresumes__thefunction__andruns__untileither__thenext__yieldresult__is returned,or__aStopIteration__is raised.The__neteffect__isthat__generator functions,coded__asdef__statementscontaining__yield statements,are__automaticallymade__tosupport__theiteration__methodsprotocol__andthus__maybe__usedin__anyiteration__toolto__produceresults__overtime__andon__demand.The__presenceof__ayield__ina__defsuffices__tomake__allthis__happen,and__noneof__thisapplies__tolambda__becauseit__doesnt__allowstatements__likeyield__(whichis__yetanother__reasonto__prefer def).Generator__functionsin__actionAs__usual,this__isprobably__simplerin__codethan__narrative.The__followingdefines__agenerator__functionthat__canbe__usedto__producethe__squaresof__aseries__ofnumbers__over time: >>>def__gensquares(n):for__iin__range(n):yield__i ** 2 #Resume__herelater__Thisfunction__yieldsa__value,and__soreturns__toits__caller,each__timethrough__the loop.When__itis__resumed,its__priorstate__is restored,including__thelast__valuesof__itsvariables__iand__n,and__controlpicks__upagain__immediatelyafter__theyield__statement.For__example,when__its__usedin__thebody__ofa__for loop,the__firstiteration__startsthe__functionand__getsits__first result; thereafter,control__returnsto__thefunction__afterits__yieldstatement__eachtime__throughthe__loop: >>>for__iin__gensquares(5): #Resume__thefunction__print(i, end=' ') #Print__lastyielded__value 0 1 4 9 16To__endthe__generationof__values,functions__eitheruse__areturn__statementor__simplyallow__controlto__falloff__theend__ofthe__function body.As__noted,return__cangive__avalue__attachedto__theexit__exception,but__usuallydoes__not.To__most people,this__processseems__abit__implicit (ifnot__enchanted)on__first encounter.It__sactually__quite tangible, though.If__youreally__wantto__seewhat__isgoing__oninside__the for,call__thegenerator__function directly: >>>x__= gensquares(3) #Generator__of 0..2squares__>>>x__Youget__backa__generatorobject__thatsupports__theiteration__protocolthe__generatorfunction__wascompiled__toreturn__this automatically.The__returnedgenerator__objectin__turnhas__a__next____methodthat__startsthe__functionor__resumesit__fromwhere__itlast__yieldeda__value,and__raisesa__StopIterationexception__whenthe__endof__theseries__ofvalues__isreached__andthe__function returns.As__noted, next(X)here__calls X.__next__()for__convenience: >>> next(x) #Run__tofirst__yield 0 >>> next(x) #Resume__after yield,run__tonext__yield 1 >>> next(x) #Resume__after yield,run__tonext__yield 4 >>> next(x) #Resume__after yield,exception__onreturn__StopIterationPer__Chapter 14,for__loopsand__otheriteration__toolswork__withgenerators__inthe__sameway__bycalling__the__next____method repeatedly,until__theexit__exceptionis__caught.For__generators,the__resultproduces__yieldedvalues__over time.Notice__thatthe__top-leveliter__callof__theiteration__protocolisn__trequired__herebecause__generatorsare__theirown__iterator,supporting__justone__activeiteration__scan.To__putthat__another way,generators__returnthemselves__foriter__andsupport__next directly.This__alsoholds__truein__thegenerator__expressionsyou__llmeet__laterin__this chapter: >>>y__= gensquares(5) #Returns__agenerator__whichis__itsown__iterator >>> iter(y)is__y # iter()is__not required:a__no-ophere__True >>> next(y) #Can__run next()immediately__0Why__generator functions?Given__thesimple__examplewe__reusing__toillustrate__fundamentals,you__mightbe__wonderingjust__whyyou__dever__careto__codea__generatorat__all.In__codeso__far,for__instance,we__couldsimply__buildthe__listof__resultvalues__allat__once: >>>def__buildsquares(n):res__= []for__iin__range(n): res.append(i ** 2)return__res >>>for__xin__buildsquares(5): print(x, end=' ') 0 1 4 9 16For__that matter,we__coulduse__anyof__thefor__loop, map,or__listcomprehension__techniqueswe__vealready__mastered: >>>for__xin__[n ** 2for__nin__range(5)]: print(x, end=' ') 0 1 4 9 16 >>>for__xin__map((lambda n:n__** 2), range(5)): print(x, end=' ') 0 1 4 9 16 However,generators__canbe__betterin__termsof__bothmemory__useand__performancein__larger programs.They__allowfunctions__toavoid__doingall__thework__up front,which__isespecially__usefulwhen__theresult__listsare__largeor__whenit__takesa__lotof__computationto__produceeach__value.Generators__distributethe__timerequired__toproduce__theseries__ofvalues__amongloop__iterations,and__caneven__producea__seriesof__valuesthat__hasno__endat__all (aninfinite__result). Moreover,for__moreadvanced__uses,generators__canprovide__asimpler__alternativeto__manuallysaving__thestate__betweeniterations__inclass__objectswith__generators,variables__accessiblein__thefunction__sscopes__aresaved__andrestored__automatically.You__llbe__ableto__judgethis__contrastafter__wediscuss__class-basediterables__inmore__detailin__Part VI.Generator__functionsare__alsomore__broadlyfocused__thanimplied__so far.They__canoperate__onand__returnany__typeof__object,and__asiterables__mayappear__inany__ofChapter__14s__iteration tools,including__tuple calls, enumerations,and__dictionary comprehensions: >>>def__ups(line):for__subin__line.split(','): #Substring__generatoryield__sub.upper() >>> tuple(ups('aaa,bbb,ccc')) #All__iterationcontexts__('AAA', 'BBB', 'CCC') >>> {i:s__for (i, s)in__enumerate(ups('aaa,bbb,ccc'))} {0: 'AAA', 1: 'BBB', 2: 'CCC'}In__amoment__youll__observethe__sameassets__forgenerator__expressionsa__toolthat__tradesfunction__flexibilityfor__comprehension conciseness.Later__inthis__chapteryou__llalso__seethat__generatorscan__sometimesenable__otherwiseimpractical__tasks,by__producingcomponents__ofresult__setsthat__wouldbe__fartoo__largeto__createall__at once. First, though,let__sexplore__someadvanced__generatorfunction__features.Extended__generatorfunction__protocol:send__versusnext__Somewherealong__generatorsevolutionary__path (inPython__2.5),a__sendmethod__wasadded__tothe__generatorfunction__protocol.The__sendmethod__advancesto__thenext__itemin__theseries__of results,just__like __next__,but__alsoprovides__away__forthe__callerto__communicatewith__the generator,and__henceto__affectits__operation. Technically,yield__isan__expressionform__thatreturns__theitem__passedto__send,not__a statement.It__canbe__codedeither__way (andusually__isa__statement),but__whenused__asan__expressionmust__beenclosed__inparentheses__unlessit__sthe__onlyitem__onthe__rightside__ofan__assignment statement.For__example,X__=yield__Yis__OK,as__isX__= (yield Y) + Z.When__thisextra__protocolis__used,values__aresent__intoa__generatorG__bycalling__G.send(value).The__generators__codeis__then resumed,and__theyield__expressioninside__thegenerator__returnsthe__valuepassed__tosend__bythe__caller.If__theregular__G.__next__()method__(orits__next(G) equivalent)is__calledto__advance,the__yieldsimply__returns None.For__example: >>>def__gen():for__iin__range(10):X__=yield__i print('=>', X) >>>G__= gen() >>> next(G) #Must__call next() first,to__startgenerator__0 >>> G.send(77) # Advance,and__sendvalue__toyield__expression => 77 1 >>> G.send(88) => 88 2 >>> next(G) # next()and__X.__next__()send__None =>None__3The__sendmethod__canbe__used,for__example,to__codea__generatorthat__itscaller__canterminate__bysending__atermination__code,or__redirectby__passinga__newposition__indata__beingprocessed__insidethe__generator.In__addition,generators__alsosupport__a throw(type)method__toraise__anexception__insidethe__generatorat__thelatest__yield,and__aclose__methodthat__raisesa__specialGeneratorExit__exceptioninside__thegenerator__toterminate__theiteration__entirely.Together__with send,these__areadvanced__featuresadded__tomake__generatorsmore__likea__toolcalled__coroutines,a__roleeventually__subsumedin__partby__theupcoming__async. Hence,we__wont__delvefurther__here;see__Pythons__standardmanuals__formore__information,and__watchfor__moreon__exceptionsin__Part VII. Note, though,that__whilePython__providesa__next(X)convenience__built-inthat__callsthe__X.__next__()method__ofan__object,other__generator methods,like__send,must__becalled__asmethods__ofgenerator__objectsdirectly__(e.g., G.send(X)).This__makessense__ifyou__realizethat__theseextra__methodsare__implementedon__built-ingenerator__objects only,whereas__the__next____methodapplies__toall__iterableobjects__both built-intypes__and user-defined classes.The__yieldfrom__extensionEven__later,Python__3.3introduced__extendedsyntax__forthe__yieldstatement__witha__fromgenerator__clausethat__allowsgenerators__todelegate__tonested__generators (knownas__subgenerators).In__simple cases,it__sthe__equivalentto__ayielding__for loop.As__a demo,the__listcall__inthe__followingforces__agenerator__toproduce__valuesfrom__two sources: >>>def__both(N):for__iin__range(N):yield__ifor__iin__map(lambda x:x__** 2, range(N)):yield__i >>> list(both(5)) [0, 1, 2, 3, 4, 0, 1, 4, 9, 16]The__yieldfrom__syntaxmakes__thismore__conciseand__explicit,and__supportsall__theusual__generatorusage__contexts.In__the following,both__iscalled__adelegating__generator,and__therange__andmap__built-insserve__assubgenerators__(joinalso__usesa__generatorexpression__here:see__thenext__section): >>>def__both(N):yield__from range(N)yield__from map(lambda x:x__** 2, range(N)) >>> list(both(5)) [0, 1, 2, 3, 4, 0, 1, 4, 9, 16] >>> ' : '.join(str(i)for__iin__both(5)) '0 : 1 : 2 : 3 : 4 : 0 : 1 : 4 : 9 : 16'The__yieldfrom__alsosupports__arbitrarychains__of generators.In__the following,for__example,two__generatorsyield__from others,the__lastof__whichultimately__usesyield__tosend__resultsup__thoughthe__chain: >>>def__c(n):yield__n * 8 #The__bottomof__the "chain"yield__n ** 2 >>>def__b(n):yield__from c(n) #Delegate__tosubgenerator__>>>def__a(n):yield__from b(n) #Delegate__tosubgenerator__>>>g__= a(4) #Make__top generator,fetch__results >>>g__>>> next(g) 32 >>>for__iin__a(4): print(i) #Force__resultsproduction__32 16In__moreadvanced__roles, though,this__extensionallows__subgeneratorsto__receivesent__andthrown__valuesdirectly__fromthe__delegatinggenerator__s caller,and__returna__finalvalue__tothe__delegatinggenerator__asthe__resultof__theyield__from expression.The__neteffect__allowsgenerators__tobe__splitinto__multiplesubgenerators__muchas__asingle__functioncan__besplit__intomultiple__subfunctions,but__stilloperate__asthough__theircode__appearedinline__wherethe__yieldfrom__appears.Since__thisis__bothuncommon__andbeyond__thischapter__s scope,we__llagain__deferto__Pythons__standardmanuals__formore__details.For__anadditional__yieldfrom__example,see__thesolution__toExercise__11from__TestYour__Knowledge:Part__IVExercises__,and__staytuned__fora__glimpseof__asyncdef__coroutinesahead__whoseawait__issomething__likea__generatoryield__from,with__adelegation__toan__eventloop__toallow__othertasks__tobe__runduring__pauses. Here,let__smove__onto__atool__closeenough__toyield__tobe__calleda__fraternal twin.Generator__Expressions:Iterables__MeetComprehensions__Becausethe__delayedevaluation__ofgenerator__functionswas__so useful,later__Pythonseventually__combinedthe__notionsof__iterablesand__comprehensionsin__anew__tool:generator__expressions. Syntactically,generator__expressionsare__justlike__normallist__comprehensions,and__supportall__theirsyntax__includingif__filtersand__forloop__nestingbut__theyare__enclosedin__parenthesesinstead__ofsquare__brackets (like tuples,their__enclosingparentheses__areoften__optional): >>> [x ** 2for__xin__range(5)] #List__comprehension:build__alist__[0, 1, 4, 9, 16] >>> (x ** 2for__xin__range(5)) #Generator__expression:make__aniterable__at 0x109607ac0>In__fact,at__leaston__afunctionality__basis,coding__alist__comprehensionis__essentiallythe__sameas__wrappinga__generatorexpression__ina__list built-incall__toforce__itto__produceall__itsresults__ina__listat__once: >>> list(x ** 2for__xin__range(5)) #List__comprehensionequivalence__[0, 1, 4, 9, 16] Operationally, however,generator__expressionsare__very different:instead__ofbuilding__theresult__listin__memory,they__returna__generatorobject__anautomatically__created iterable.This__iterableobject__inturn__supportsthe__iterationprotocol__toyield__onepiece__ofthe__resultlist__ata__timein__anyiteration__tool.The__iterableobject__alsoretains__generatorstate__whileactive__thevariable__xin__thepreceding__expressions,along__withthe__generators__code location.The__neteffect__ismuch__likethat__ofgenerator__functions,but__inthe__contextof__acomprehension__expression:we__getback__anobject__thatremembers__whereit__leftoff__aftereach__partof__itsresult__is returned.Also__likegenerator__functions,looking__underthe__hoodat__theprotocol__thatthese__objectsautomatically__supportcan__helpdemystify__them;the__itercall__isagain__notrequired__atthe__top here,for__reasonswe__llexpand__on ahead: >>>G__= (x ** 2for__xin__range(3)) >>> iter(G)is__G # iter(G) optional:__iter____returnsself__True >>> next(G) #Generator__objects:automatic__methods 0 >>> next(G) 1 >>> next(G) 4 >>> next(G)StopIteration__>>>G__at 0x109607920> Again,we__dont__typicallysee__thenext__iteratormachinery__underthe__hoodof__agenerator__expressionlike__thisbecause__forloops__andsimilar__toolstrigger__itfor__us automatically: >>>for__numin__(x ** 2for__xin__range(3)): #Calls__next()automatically__print(num,num__/ 2.0, sep=', ') 0, 0.0 1, 0.5 4, 2.0As__weve__already seen,every__iterationtool__doesthis__includingfor__loops;the__listcall__weused__earlier;comprehensions__ofall__kinds;the__mapand__filterfunctional__tools;and__otheriteration__toolswe__exploredin__Chapter 14,including__the sum, sorted, any,and__all built-in functions.As__iterables,generator__expressionscan__beused__inany__ofthese__iteration tools,just__likeboth__physicalsequences__andthe__resultsof__a generator-function call.For__example,the__followingdeploys__generatorexpressions__inthe__stringjoin__methodcall__andtuple__assignment,iteration__tools both.Recall__thatjoin__withan__empty-stringdelimiter__concatenatesvalues__producedby__its iterable: >>> ''.join(x.upper()for__xin__'aaa,bbb,ccc'.split(',')) 'AAABBBCCC' >>> a, b,c__= (x + '\n'for__xin__'aaa,bbb,ccc'.split(',')) >>> a,c__('aaa\n', 'ccc\n')Notice__howthe__joincall__inthe__precedingdoesn__trequire__extraparentheses__aroundthe__generator. Syntactically,parentheses__arenot__requiredaround__agenerator__expressionthat__isthe__soleitem__alreadyenclosed__inparentheses__usedfor__otherpurposes__likethose__ofa__function call.Parentheses__arerequired__inall__other cases, however,even__ifthey__seem extra,as__inthe__secondcall__tosorted__that follows: >>> sum(x ** 2for__xin__range(3)) #Parens__optional 5 >>> sorted(x ** 2for__xin__range(3)) #Parens__optional [0, 1, 4] >>> sorted((x ** 2for__xin__range(3)), reverse=True) #Parens__required! [4, 1, 0]Like__the often-optionalparentheses__in tuples,there__isno__widelyaccepted__ruleon__this,though__agenerator__expressiondoes__nothave__asclear__arole__asa__fixedcollection__ofother__objectsas__a tuple,making__extraparentheses__seemperhaps__morespurious__here.Why__generator expressions?Just__likegenerator__functions,generator__expressionsare__a memory-spaceoptimization__theydo__notrequire__theentire__resultlist__tobe__constructedall__at once,as__the square-bracketedlist__comprehension does.Also__likegenerator__functions,they__dividethe__workof__resultsproduction__intosmaller__timeslices__theyyield__resultsin__piecemeal fashion,instead__ofmaking__thecaller__waitfor__thefull__setto__becreated__ina__single call.On__theother__hand,because__generatorexpressions__oftenrun__slowertoday__thanlist__comprehensions,they__maybe__bestreserved__forresult__setsthat__arevery__large,or__programsthat__cannotwait__forfull__results generation.A__moreauthoritative__statementabout__performance, though,will__haveto__awaitthe__timingscripts__well__codein__thenext__chapter.On__thesubjective__upside,generator__expressionsalso__offersignificant__codingadvantages__asthe__nextsections__show.Generator__expressionsversus__mapOne__wayto__seethe__codingbenefits__ofgenerator__expressionsis__tocompare__themto__otherfunctional__tools,as__wedid__forlist__comprehensions.For__example,generator__expressionsoften__areequivalent__tomap__calls,because__bothgenerate__resultitems__on request.Like__list comprehensions, though,generator__expressionsmay__besimpler__tocode__whenthe__operationapplied__isnot__afunction__call: >>> list(map(abs, (-1, -2, 3, 4))) #Map__functionon__tuple [1, 2, 3, 4] >>> list(abs(x)for__xin__(-1, -2, 3, 4)) #Generator__expression [1, 2, 3, 4] >>> list(map(lambda x:x__* 2, (1, 2, 3, 4))) #Nonfunction__case [2, 4, 6, 8] >>> list(x * 2for__xin__(1, 2, 3, 4)) #Simpler__as generator? [2, 4, 6, 8]The__sameholds__truefor__text-processinguse__caseslike__thejoin__callwe__sawearlier__alist__comprehensionmakes__anextra__temporarylist__of results,which__iscompletely__pointlessin__thiscontext__becausethe__listis__not retained,and__maploses__simplicitypoints__comparedto__generatorexpression__syntaxwhen__theoperation__beingapplied__isnot__a call: >>>line__= 'aaa,bbb,ccc' >>> ''.join([x.upper()for__xin__line.split(',')]) #Makes__temporarylist__'AAABBBCCC' >>> ''.join(x.upper()for__xin__line.split(',')) #Generates__results 'AAABBBCCC' >>> ''.join(map(str.upper, line.split(','))) #Generates__results 'AAABBBCCC' >>> ''.join(x * 2for__xin__line.split(',')) #Simpler__as generator? 'aaaaaabbbbbbcccccc' >>> ''.join(map(lambda x:x__* 2, line.split(','))) 'aaaaaabbbbbbcccccc'Both__mapand__generatorexpressions__canalso__bearbitrarily__nested;when__codedthis__way,a__listcall__orother__iterationtool__startsthe__entireprocess__ofproducing__results.For__example,the__listcomprehension__inthe__followingproduces__thesame__resultas__themap__andgenerator__equivalentsthat__follow it,but__makestwo__physical lists.The__othersgenerate__justone__integerat__atime__withnested__generators,and__thegenerator__expressionform__maymore__clearlyreflect__its intent: >>> [x * 2for__xin__[abs(x)for__xin__(-1, -2, 3, 4)]] #Nested__listcomps__[2, 4, 6, 8] >>> list(map(lambda x:x__* 2, map(abs, (-1, -2, 3, 4)))) #Nested__maps [2, 4, 6, 8] >>> list(x * 2for__xin__(abs(x)for__xin__(-1, -2, 3, 4))) #Nested__generators [2, 4, 6, 8]Although__theeffect__ofall__threeof__theseis__tocombine__operations,the__generatorsdo__sowithout__makingmultiple__temporary lists.In__fact,the__nextexample__bothnests__andcombines__generatorsthe__nestedgenerator__expressionis__activatedby__map,which__inturn__isonly__activatedby__list: >>>import__math >>> list(map(math.sqrt, (x ** 2for__xin__range(4)))) #Nested__combos [0.0, 1.0, 2.0, 3.0]Technically__speaking,the__rangeon__theright__inthe__precedingis__avalue__generator too,activated__bythe__generatorexpression__itselfforming__threelevels__ofvalue__generation,which__produceindividual__valuesfrom__innerto__outeronly__on request,and__whichjust__worksbecause__ofPython__siteration__toolsand__protocol.In__fact,generator__nestingscan__bearbitrarily__mixedand__deep,though__somemay__bemore__validthan__others: >>> list(map(abs, map(abs, map(abs, (-1, 0, 1))))) #Nesting__gone bad? [1, 0, 1] >>> list(abs(x)for__xin__(abs(x)for__xin__(abs(x)for__xin__(-1, 0, 1)))) [1, 0, 1]These__lastexamples__illustratehow__generalgenerators__can be,but__arealso__codedin__anintentionally__complexform__tounderscore__thatgenerator__expressionshave__thesame__potentialfor__abuseas__thelist__comprehensionsdiscussed__earlieras__usual,you__shouldkeep__themsimple__unlessthey__mustbe__complex.When__used well, though,generator__expressionscombine__theexpressiveness__oflist__comprehensionswith__thespace__andtime__benefitsof__other iterables.The__followingnonnested__alternatives,for__example,provide__simplersolutions__tothe__precedingthree__listingsnested__codings,but__stillleverage__generators strengths: >>> list(abs(x) * 2for__xin__(-1, -2, 3, 4)) # Same,unnested__[2, 4, 6, 8] >>> list(math.sqrt(x ** 2)for__xin__range(4)) #Flat__maybe__better [0.0, 1.0, 2.0, 3.0] >>> list(abs(x)for__xin__(-1, 0, 1)) [1, 0, 1]Generator__expressionsversus__filterGenerator__expressionsalso__supportall__theusual__listcomprehension__syntaxincluding__if clauses,which__worklike__thefilter__callwe__met earlier.Because__filteris__aniterable__thatgenerates__itsresults__on request,a__generatorexpression__withan__ifclause__isoperationally__equivalent. Again,the__joinin__thefollowing__isan__iterationtool__thatsuffices__toforce__allforms__toproduce__their results: >>>line__= 'aabbb__c' >>> ''.join(xfor__xin__line.split()if__len(x) > 1) #Generator__withif__'aabbb' >>> ''.join(filter(lambda x: len(x) > 1, line.split())) #Equivalent__filter 'aabbb'The__generatorseems__justmarginally__simplerthan__thefilter__here.As__forlist__comprehensions, though,adding__processingsteps__tofilter__resultsrequires__amap__too,which__makesfilter__noticeablymore__complex: >>> ''.join(x.upper()for__xin__line.split()if__len(x) > 1) 'AABBB' >>> ''.join(map(str.upper, filter(lambda x: len(x) > 1, line.split()))) 'AABBB'In__effect,generator__expressionsprovide__moregeneral__codingstructures__thatdo__notrely__on functions,but__stilldelay__results production.Also__likelist__comprehensions,there__isalways__a statement-basedequivalent__toa__generator expression,though__itsometimes__renderssubstantially__more code: >>>res__= '' >>>for__xin__line.split(): #Statement__equivalent?if__len(x) > 1: #This__isalso__ajoin__res += x.upper() >>>res__'AABBB'In__this case, though,the__statementform__isnt__quitethe__sameit__cannotproduce__itemsone__ata__time,and__its__alsoemulating__theeffect__ofthe__jointhat__forcesresults__tobe__producedall__at once.The__trueequivalent__toa__generatorexpression__wouldbe__agenerator__functionwith__a yield,as__thenext__sectionwill__show.Generator__FunctionsVersus__GeneratorExpressions__Lets__recapwhat__weve__coveredso__farin__this section:Generator__functionsA__functiondef__statementthat__containsa__yieldstatement__isturned__intoa__generator function.When__called,it__returnsa__newgenerator__objectwith__automaticretention__oflocal__scopeand__code position;an__automaticallycreated____iter__method__thatsimply__returns itself;and__anautomatically__created__next____methodthat__startsthe__functionor__resumesit__whereit__lastleft__off,and__raisesStopIteration__whenfinished__producing results.Generator__expressionsA__comprehensionexpression__enclosedin__parenthesesis__knownas__agenerator__expression.When__run,it__returnsa__newgenerator__objectwith__thesame__automaticallycreated__methodinterface__andstate__retentionas__agenerator__functioncall__sresults__withan____iter__method__thatsimply__returns itself;and__a__next____methodthat__startsthe__impliedloop__orresumes__itwhere__itlast__left off,and__raisesStopIteration__whenfinished__producing results.The__neteffect__isto__automaticallyproduce__resultson__demandin__alliteration__toolsthat__employeither__of these.As__impliedby__preceding coverage,the__sameiteration__canoften__becoded__witheither__agenerator__functionor__agenerator__expression.The__followinggenerator__expression,for__example,repeats__eachcharacter__ina__stringfour__times: >>>G__= (c * 4for__cin__'hack') #Generator__expression >>> list(G) #Force__generatorto__produceresults__['hhhh', 'aaaa', 'cccc', 'kkkk']The__equivalentgenerator__functionrequires__slightlymore__code,but__its multiple-statement__blockwill__beable__tocode__morelogic__anduse__morestate__informationif__needed.In__fact,this__isessentially__thesame__asthe__priorchapter__s trade-offbetween__lambdaand__defexpression__concisenessversus__statement power: >>>def__timesfour(S): #Generator__functionfor__cin__S:yield__c * 4 >>>G__= timesfour('hack') >>> list(G) #Iterate__automatically ['hhhh', 'aaaa', 'cccc', 'kkkk']To__their clients,the__twoare__moresimilar__than different.For__instance,both__expressionsand__functionssupport__bothautomatic__andmanual__iterationthe__priorlist__calliterates__automatically,and__thefollowing__iterate manually: >>>G__= (c * 4for__cin__'hack') >>>I__= iter(G) #Iterate__manually (expression) >>> next(I) 'hhhh' >>> next(I) 'aaaa' >>>G__= timesfour('hack') >>>I__= iter(G) #Iterate__manually (function) >>> next(I) 'hhhh' >>> next(I) 'aaaa'In__either case,Python__automaticallycreates__agenerator__object,which__hasboth__themethods__requiredby__theiteration__protocol,and__stateretention__forvariables__inthe__generators__codeand__itscurrent__code location.Notice__howwe__makenew__generatorshere__toiterate__againas__explainedin__thenext__section,generators__are single-pass iterators. First, though,here__sthe__true statement-basedequivalent__ofthe__expressionat__theend__ofthe__prior section:a__functionthat__yieldsvalues__thoughthe__differenceis__irrelevantif__thecode__usingit__producesall__resultswith__atool__like join: >>>line__= 'aabbb__c' >>> ''.join(x.upper()for__xin__line.split()if__len(x) > 1) #Expression__'AABBB' >>>def__gensub(line): #Function__forx__in line.split():if__len(x) > 1:yield__x.upper() >>> ''.join(gensub(line)) #But__why generate? 'AABBB'While__generatorshave__valid roles,in__caseslike__thisthe__useof__generatorsover__thesimple__statementequivalent__shownearlier__maybe__difficultto__justify,except__onstylistic__grounds:if__youre__justgoing__toimmediately__joingenerated__results anyhow,you__mightas__wellskip__generatorsand__usesimple__loops.On__theother__hand,trading__fourlines__forthe__generatorexpression__sone__mayto__manyseem__fairlycompelling__stylistic grounds!Generator__Oddsand__EndsThis__sectionwraps__upgenerators__witha__quickrundown__ofassociated__butlesser__topics.After__this,we__llmove__onto__larger examples,but__makesure__youhave__ahandle__onthe__smallerbits__beforejumping__ahead.Generators__are single-passiterables__First up,a__subtlebut__important point:both__generatorfunctions__andgenerator__expressionsare__theirown__iteratorsand__thussupport__justone__activeiteration__unlikesome__built-in types,you__cant__havemultiple__iteratorsof__eithergenerator__positionedat__differentlocations__inthe__streamof__results.Because__of this,a__generators__iteratoris__thegenerator__itself;in__fact,as__suggested earlier,calling__iteron__agenerator__expressionor__functionis__anoptional__no-op: >>>G__= (c * 4for__cin__'hack') >>> iter(G)is__G #My__iteratoris__myself:G__has__next____TrueIf__youdo__iterateover__theresults__streammanually__withmultiple__iterators,they__willall__pointto__thesame__position: >>>G__= (c * 4for__cin__'hack') #Make__anew__generator >>> I1 = iter(G) #Iterate__manually >>> next(I1) 'hhhh' >>> next(I1) 'aaaa' >>> I2 = iter(G) #Second__iteratorat__same position! >>> next(I2) 'cccc' Moreover,once__anyiteration__runsto__completion,all__areexhausted__wehave__tomake__anew__generatorto__start again: >>> list(I1) #Collect__therest__of I1'sitems__['kkkk'] >>> next(I2) #Other__iteratorsexhausted__tooStopIteration__>>> I3 = iter(G) #Ditto__fornew__iterators >>> next(I3)StopIteration__>>> I3 = iter(c * 4for__cin__'hack') #New__generatorto__startover__>>> next(I3) 'hhhh'The__sameholds__truefor__generatorfunctions__thefollowing__def statement-basedequivalent__supportsjust__oneactive__iteratorand__isexhausted__afterone__pass: >>>def__timesfour(S):for__cin__S:yield__c * 4 >>>G__= timesfour('hack') #Generator__functionswork__thesame__way >>> iter(G)is__G #One__scanper__generator (call)True__>>> I1, I2 = iter(G), iter(G) >>> next(I1) 'hhhh' >>> next(I1) 'aaaa' >>> next(I2) # I2at__sameposition__as I1 'cccc'This__isdifferent__fromthe__behaviorof__some built-inobjects__like lists,which__supportmultiple__iteratorsand__passesand__evenreflect__their in-placechanges__inactive__iterators: >>>L__= [1, 2, 3, 4] >>> I1, I2 = iter(L), iter(L) >>> next(I1) 1 >>> next(I1) 2 >>> next(I2) #Lists__supportmultiple__iterators 1 >>>del__L[2:] #Changes__reflectedin__iterators >>> next(I1)StopIteration__Thoughnot__readilyapparent__inthese__simple examples,this__canmatter__inyour__code:if__youwish__toscan__agenerator__svalues__multiple times,you__musteither__createa__newgenerator__foreach__scanor__builda__rescannablelist__outof__itsvalues__asingle__generators__valueswill__beconsumed__andexhausted__aftera__single pass.See__thischapter__ssidebar__WhyYou__Will Care:Iteration__VersusPython__Morphfor__aprime__exampleof__thesort__ofcode__impactedby__this.When__webegin__coding class-basediterables__inPart__VI,you__llalso__seethat__its__upto__usto__decidehow__manyiterations__wewish__tosupport__forour__objects,if__any.In__general,objects__thatwish__tosupport__multiplescans__willreturn__supplementalclass__objectsinstead__ofthemselves__for iter.The__nextsection__previewsmore__ofthis__model.Generation__in built-insand__classesAlthough__weve__focusedon__codingvalue__generatorsourselves__inthis__section,don__tforget__thatmany__built-intypes__behavethe__same way.As__wesaw__inChapter__14,for__example,dictionaries__andfiles__generateresults__too:for__keyin__dictionary: #See__Chapter 14et__al.for__linein__file:Though__beyondthis__books__scope,many__Python standard-librarytools__generatevalues__too,including__itsdirectory__walkerwhich__ateach__levelof__afolder__treeyields__atuple__ofthe__current directory,its__subdirectories,and__its files: >>>import__os >>>for__(root, subs, files)in__os.walk('..'): # Directory-walkgenerator__forname__in files: #A__Python 'find'operation__if name.endswith('.py'): #Also__os.path.join(root, name) print(root, name) ../Chapter02 script0.py ../Chapter03 myfile.py ../Chapter03 script1.pyetc__Becausethe__current Python-codedimplementation__of os.walkuses__yieldto__return results,it__sa__normalgenerator__function,and__henceiterable__object,that__generatesa__three-itemtuple__oneach__iteration: >>>G__= os.walk('..') #A__single-scan iterator: iter(G)optional__>>> next(G) ('..', ['Chapter02', 'Chapter03', 'Chapter04',etc__'Chapter37'], []) >>> next(G) ('../Chapter02', ['__pycache__'], ['script0.py'])By__yieldingresults__asit__goes,the__walkerdoes__notrequire__itsclients__towait__foran__entiretree__tobe__scanned.See__Pythons__manualsfor__moreon__this tool.For__system-tools fans,also__seethe__nextchapter__foran__examplethat__uses os.popena__relatediterable__usedto__runa__shellcommand__andread__its output.And__foradditional__examplesof__built-invalue__generatorsand__theiteration__toolsthat__use them,review__Chapter 14. Finally,although__beyondthe__scopeof__this chapter,it__isalso__possibleto__implementarbitrary__user-definedgenerator__objectswith__classesthat__conformto__theiteration__protocol.Such__classesdefine____iter__and____next__methods__explicitlyto__supportthe__protocol:class__SomeIterable:def____iter__(...): ... #On__iter():return__selfor__supplementalobject__def __next__(...): ... #On__next():coded__here,or__inanother__classAs__theprior__section suggested,these__classesusually__returntheir__objectsdirectly__for single-iteration behavior,or__asupplemental__objectwith__scan-specificstate__for multiple-scan support. Alternatively,a__user-definediterable__classs____iter__may__useyield__totransform__itselfinto__a generator,and__a__getitem____indexingmethod__isalso__availableas__afallback__optionfor__iterationwith__trade-offswe__llexplore__later.However__thisis__coded,the__iteratorand__generatorstory__wont__reallybe__completeuntil__weve__seenhow__italso__mapsto__classes.For__now,we__llhave__tosettle__forpostponing__itsconclusion__andits__finalsequel__untilChapter__30.Comprehensions__versustype__callsand__generatorsWe__vealso__beenfocusing__onlist__comprehensionsand__generatorsin__this chapter,but__keepin__mindthat__thereare__twoother__comprehensionexpression__forms:the__setand__dictionarycomprehensions__wemet__earlierin__Chapter 14and__Part II.For__referenceand__closure,here__sa__summaryof__allthe__comprehensionforms__in Python: >>> [x *x__forx__in range(10)] #List__comprehension:builds__list [0, 1, 4, 9, 16, 25, 36, 49, 64, 81] #Fixed__order,made__allat__once >>> (x *x__forx__in range(10)) #Generator__expression:yields__itemsat__0x100a1f920> >>> {x *x__forx__in range(10)} #Set__comprehension:builds__set {0, 1, 64, 4, 36, 9, 16, 49, 81, 25} #Random__order,no__duplicates >>> {x:x__*x__forx__in range(10)} #Dict__comprehension:insert__order {0: 0, 1: 1, 2: 4, 3: 9, 4: 16, 5: 25, 6: 36, 7: 49, 8: 64, 9: 81}All__ofthese__formsuse__thesame__formalcomprehension__syntaxwe__met earlier,but__theirenclosing__delimiters (and key,for__dictionaries)denote__theirdiffering__roles.In__a sense, list, set,and__dictionarycomprehensions__aresyntactic__sugarfor__passinggenerator__expressionsto__type names.Because__allaccept__any iterable,a__generatorworks__here too: >>> list(x ** 2for__xin__range(10)) #Generator__plustype__name [0, 1, 4, 9, 16, 25, 36, 49, 64, 81] >>> set(x *x__forx__in range(10)) #Similar__toa__setcomprehension__{0, 1, 64, 4, 36, 9, 16, 49, 81, 25} >>> dict((x,x__* x)for__xin__range(10)) {0: 0, 1: 1, 2: 4, 3: 9, 4: 16, 5: 25, 6: 36, 7: 49, 8: 64, 9: 81}But__dont__readtoo__muchinto__such equivalences.Because__implementationsmay__vary arbitrarily,you__shouldgenerally__collectperformance__databefore__adoptingan__alternative.In__this case,generators__areactually__slowerthan__theequivalent__listcomprehension__today,as__well__provein__thenext__chapter.Programs__thatrun__lotsof__themmay__needto__care.Scopes__andcomprehension__variablesNow__thatwe__veseen__allcomprehension__forms,Chapter__17s__overviewof__thelocalization__ofloop__variablesin__theseexpressions__maymake__more sense.In__all forms,the__loopvariable__(or variables)after__thefor__islocal__tothe__expressionit__wont__clashwith__names outside,but__isalso__notavailable__there,and__thisdiffers__fromfor__statements: >>>X__= 99 >>> [Xfor__Xin__range(5)] #All__comprehensionslocalize__loopvariables__[0, 1, 2, 3, 4] >>>X__# Enclosing-scopeX__wasnot__changed 99 >>>for__Xin__range(5):pass__#But__loopstatements__donot__localize! >>>X__4As__notedin__Chapter 17,loop__variablesassigned__ina__comprehensionreally__livein__afurther__nested special-case scope,but__othernames__referencedwithin__theseexpressions__followthe__usualLEGB__rules.In__thefollowing__generator,for__example,Z__islocalized__inthe__comprehension,but__Yand__Xare__foundin__theenclosing__localand__globalscopes__as usual: >>>X__= 'aaa' >>>def__func():Y__= 'bbb' print('-'.join(Zfor__Zin__X + Y)) # Z=comprehension, Y=local, X=global >>> func() a-a-a-b-b-bOne__exception here:names__assignedby__the :=expression__insidea__comprehensiondo__leakout__of comprehension,and__generallybehave__asthough__theywere__assignedin__thescope__containingthe__comprehension itself: >>>S__= 'hack' >>> [(temp := S[i]) + temp.upper()for__iin__range(len(S))] ['hH', 'aA', 'cC', 'kK'] >>>temp__'k' >>>i__NameError:name__'i'is__not defined.Did__you mean: 'id'?While__thisallows__comprehensionsto__bothreuse__andexport__values,keep__inmind__thata__lambdacontainer__slocal__scopeeffectively__plugsthe__leaktemp__inthe__following,for__example,lives__onlyin__thelambda__s scope: >>>del__temp >>>f__= lambda: [(temp := S[i]) + temp.upper()for__iin__range(len(S))] >>> f() ['hH', 'aA', 'cC', 'kK'] >>>temp__NameError:name__'temp'is__notdefined__Well__codesuch__a :=nesting__ina__sequence-scramblerexample__ahead,though__someobservers__maydeem__itmuch__lesstransparent__thansimple__assignment statements,and__other real-worldroles__mustawait__your discovery.See__Chapter 11for__morebackground__on :=named__assignment.Generating__infinite (well, indefinite)results__Finally,it__wasnoted__earlierin__passingthat__generatorscan__evenproduce__infiniteresults__thattools__likelist__comprehensions cannot.This__maysound__moreimpressive__thatit__is; really,this__justmeans__thata__generatorcan__keepyielding__resultsfrom__itsretained__states__localvariables__indefinitelyuntil__itsclient__growstired__of them: >>>def__squares(n):while__True: #Generate__results "forever"yield__n ** 2 #Or__untilno__morenext__calls...n__+= 1 >>>G__= squares(2) >>> next(G) 4 >>> next(G) 9 >>>for__iin__range(10): print(next(G), end=' ') 16 25 36 49 64 81 100 121 144 169This__patternmay__beuseful__inlimited__roleslike__test-parameter generation,and__othertools__cant__competein__this event;list__comprehensions,for__example,must__collectall__resultsat__once.In__the end, though,this__isa__narrow role,generators__are mortal,and__soare__weso__lets__moveon__tosome__codethat__sa__bitmore__tangiblein__thenext__section. Example:Shuffling__SequencesTo__demonstratethe__powerof__iterationand__generationtools__in action,let__sturn__tosome__morecomplete__examples.In__Chapter 18,we__wrotea__testing function,based__onearlier__codein__Chapter 13,that__scrambledthe__orderof__argumentsused__toverify__generalizedintersection__andunion__functions. There,it__wasnoted__thatthis__mightbe__bettercoded__asa__generatorof__values.Now__thatwe__velearned__howto__write generators,this__servesto__illustratea__practical application.One__noteup__front:because__theyslice__andconcatenate__objects,all__theexamples__inthe__section (includingthe__permutationsat__the end)work__onlyon__sequenceslike__stringsand__lists,not__onarbitrary__iterableslike__files, maps,and__other generators.That__is,some__ofthese__exampleswill__begenerators__themselves,producing__valueson__request,but__theycannot__processgenerators__astheir__inputs.Generalization__forbroader__categoriesis__leftas__anopen__issue,though__thecode__herewill__sufficeunchanged__ifyou__wrapnonsequence__generatorsin__listcalls__beforepassing__them in.Scrambling__Sequences First,let__s review.As__codedin__Chapter 18,we__canreorder__asequence__withslicing__and concatenation,moving__thefront__itemto__theend__oneach__loop;slicing__insteadof__indexingthe__itemallows__+to__workfor__arbitrarysequence__types: >>> L,S__= [1, 2, 3], 'code' >>>for__iin__range(len(S)): #Coding__1:for__repeatcounts__0..3S__= S[1:] + S[:1] #Move__frontitem__tothe__end print(S, end=' ')odec__decoecod__code >>>for__iin__range(len(L)):L__= L[1:] + L[:1] #Slice__soany__sequencetype__works print(L, end=' ') [2, 3, 1] [3, 1, 2] [1, 2, 3] Alternatively,as__wealso__sawin__Chapter 13,we__getthe__sameresults__bymoving__anentire__frontsection__tothe__end,though__theorder__ofthe__resultsvaries__slightly: >>>for__iin__range(len(S)): #Coding__2:for__positions 0..3X__= S[i:] + S[:i] #Rear__part +front__part (same effect) print(X, end=' ')code__odecdeco__ecodTrace__thiscode__tosee__howit__works;each__versionproduces__Nresults__foran__N-item__sequencepassed__in.Simple__functionsAs__is,this__codeworks__onspecific__namedvariables__only,and__simplyprints__its result.As__weve__seen,it__seasy__togeneralize__thisby__turningit__intoa__normalfunction__thatcan__bothwork__onany__objectpassed__toits__argumentand__returnits__resultfor__arbitrary use.The__followingdoes__sofor__thesecond__coding alternative;since__itsfirst__cutexhibits__theclassic__listcomprehension__pattern,we__canalso__savesome__workby__codingit__assuch__inthe__second: >>>def__scramble(seq):res__= []for__iin__range(len(seq)): res.append(seq[i:] + seq[:i])return__res >>> scramble('code') ['code', 'odec', 'deco', 'ecod'] >>>def__scramble(seq):return__[seq[i:] + seq[:i]for__iin__range(len(seq))] >>> scramble('code') ['code', 'odec', 'deco', 'ecod'] >>>for__xin__scramble((1, 2, 3)): print(x, end=' ') (1, 2, 3) (2, 3, 1) (3, 1, 2)We__coulduse__recursionhere__as well,but__its__probablyoverkill__inthis__fixedand__linear context.Generator__functionsThe__precedingsection__ssimple__approach works,but__mustbuild__anentire__resultlist__inmemory__allat__once (notgreat__onmemory__usageif__its__massive),and__requiresthe__callerto__waituntil__theentire__listis__complete (lessthan__idealif__thistakes__asubstantial__amountof__time).You__shouldknow__bynow__thatwe__cando__betteron__bothfronts__bytranslating__thisto__agenerator__functionthat__yieldsone__resultat__a time,using__eithercoding__scheme: >>>def__scramble(seq):for__iin__range(len(seq)):seq__= seq[1:] + seq[:1] #Generator__function,coding__1yield__seq #Assignments__workhere__>>>def__scramble(seq):for__iin__range(len(seq)): #Generator__function,coding__2yield__seq[i:] + seq[:i] #Yield__oneitem__periteration__Bothof__thesealternatives__producevalues__whenused__byan__iterationtool__likelist__or for,though__thesecond__versions__resultsorder__(shown here)again__variesslightly__inways__thatprobably__wont__matterto__future clients: >>> list(scramble('code')) # list()generates__allresults__['code', 'odec', 'deco', 'ecod'] >>> list(scramble((1, 2, 3))) #Any__sequencetype__works [(1, 2, 3), (2, 3, 1), (3, 1, 2)] >>>for__xin__scramble((1, 2, 3)): #for__loopsgenerate__results print(x, end=' ') (1, 2, 3) (2, 3, 1) (3, 1, 2)Both__generatorfunctions__retaintheir__localscope__state (seqand__i)while__active,minimize__memoryspace__requirements,and__dividethe__workinto__shortertime__slices.As__full functions,they__arealso__very general. Moreover,because__iterationtools__workthe__samewhether__steppingthrough__areal__listor__agenerator__of values,the__functioncan__selectbetween__thetwo__codings freely,and__evenchange__strategiesin__thefuture__withoutimpacting__callers.Generator__expressionsAs__weve__also seen,generator__expressionscomprehensions__inparentheses__insteadof__squarebrackets__alsogenerate__valueson__requestand__retaintheir__local state.As__expressions,they__renot__asflexible__asfull__functions,but__becausethey__yieldtheir__values automatically,generator__expressionscan__oftenbe__moreconcise__inspecific__usecases__like this: >>>S__= 'code' >>>G__= (S[i:] + S[:i]for__iin__range(len(S))) #Generator__expr,coding__2 >>> list(G) ['code', 'odec', 'deco', 'ecod']A__generatorexpression__cant__usethe__seqassignment__statementof__thefirst__generator-function coding,but__itcan__achievethe__sameeffect__bynesting__the := named-assignmentexpression__coveredin__Chapter 11,because__:=both__changesassigned__namesin__thecontaining__scopeand__returnsthe__assignedvalue__soit__appearsin__theresults__stream: >>>S__= 'code' >>>G__= (S:=(S[1:] + S[:1])for__iin__range(len(S))) #Generator__expr,coding__1 >>> list(G) ['odec', 'deco', 'ecod', 'code']Either__way,we__restill__operatingon__aspecific__variable here, S.To__generalizea__generatorexpression__foran__arbitrary subject,wrap__itin__asimple__lambdafunction__thattakes__anargument__andreturns__agenerator__thatuses__it (subtle bit:note__thatseq__inthe__secondof__theseis__notlocal__tothe__generator,but__islocal__tothe__lambdathat__encloses it): >>>F__=lambda__seq: (seq[i:] + seq[:i]for__iin__range(len(seq))) >>> list(F(S)) ['code', 'odec', 'deco', 'ecod'] >>>F__=lambda__seq: (seq:=(seq[1:] + seq[:1])for__iin__range(len(seq))) >>> list(F(S)) ['odec', 'deco', 'ecod', 'code'] >>> list(F([1, 2, 3])) [[2, 3, 1], [3, 1, 2], [1, 2, 3]] >>> F(S) ..at__0x100b23300> >>>for__xin__F((1, 2, 3)): print(x, end=' ') (2, 3, 1) (3, 1, 2) (1, 2, 3)Tester__client Finally,we__canuse__eitherthe__generatorfunction__orits__expressionequivalent__inChapter__18s__testerto__producescrambled__arguments.As__packagedin__themodule__ofExample__20-1,the__sequencescramblers__becomereusable__tools.Example__20-1. scramble.py "Generateshuffles__ofa__sequence,by__functionor__expression"def__scramble1(seq):for__iin__range(len(seq)):yield__seq[i:] + seq[:i] #Yield__oneshuffle__periteration__scramble2 =lambda__seq: (seq[i:] + seq[:i]for__iin__range(len(seq)))Though__itrequires__abit__ofpage__flippingto__see how,moving__thevalues__generationout__toan__externaltool__likethis__alsomakes__thetesting__functionnoticeably__simpler: >>>from__scrambleimport__scramble1 #Choose__yourscrambler__>>>from__inter2import__intersect,union__#Functions__tobe__tested >>>def__tester(func, items, trace=True):for__argsin__scramble1(items): #Use__eithergenerator__if trace: print(args) print(sorted(func(*args))) #Test__forthis__scramble >>> tester(intersect, ('aab', 'abcde', 'ababab'), False) ['a', 'b'] ['a', 'b'] ['a', 'b']To__makethis__workfor__yourself,make__sureall__importedfiles__arein__thecurrent__directory:either__copy inter2.pyfrom__Chapter 18s__folderto__Chapter 20 s,or__copyExample__20-1s__scramble.pyto__Chapter 18s__folderand__workthere__(theexamples__packagehas__alreadydone__the former). Alternatively,you__canmodify__themodule__importsearch__paths__PYTHONPATHsetting__toinclude__anyfolder__asyou__lllearn__whenwe__covermodules__infull__afterthe__next chapter.Permutating__SequencesGenerators__havemany__other real-worldapplications__considerparsing__attachmentsin__anemail__messageor__computingpoints__tobe__plottedin__a GUI. Moreover,other__typesof__sequencescrambles__servecentral__rolesin__other applications,from__searchesto__mathematics.As__is,our__sequencescrambler__ofthe__priorsection__isa__simple reordering,but__someprograms__warrantthe__moreexhaustive__setof__allpossible__orderingswe__getfrom__permutationsproduced__usingrecursive__functionsin__both list-builderand__generatorforms__bythe__modulefile__inExample__20-2.Example__20-2. permute.py "Permute sequences:as__alist__orgenerator__of values"def__permute1(seq):if__not seq: #Shuffle__any sequence:list__return [seq] #Empty__sequence else:res__= []for__iin__range(len(seq)):rest__= seq[:i] + seq[i+1:] #Delete__currentnode__forx__in permute1(rest): #Permute__theothers__res.append(seq[i:i+1] + x) #Add__nodeat__frontreturn__resdef__permute2(seq):if__not seq: #Shuffle__any sequence:generator__yieldseq__#Empty__sequence else:for__iin__range(len(seq)):rest__= seq[:i] + seq[i+1:] #Delete__currentnode__forx__in permute2(rest): #Permute__theothers__yield seq[i:i+1] +x__#Add__nodeat__frontBoth__ofthese__functionsproduce__thesame__results,though__thesecond__defersmuch__ofits__workuntil__itis__askedfor__a result.This__codeis__abit__advanced,especially__thesecond__ofthese__functions (andto__somePython__newcomersmight__evenbe__categorizedas__crueland__unusual punishment!). Still,as__youll__learnin__a moment,there__arecases__wherethe__generatorapproach__canbe__veryuseful__andeven__essential.Study__andtest__thiscode__formore__insight,and__addprints__totrace__ifit__helps.If__its__stilla__mystery,try__tomake__senseof__thefirst__version first;remember__thatgenerator__functionssimply__returnobjects__withmethods__thathandle__nextoperations__runby__forloops__ateach__level,and__dont__produceany__resultsuntil__iterated;and__tracethrough__someof__thefollowing__examplesto__seehow__theyre__handledby__this code.Permutations__producemore__orderingsthan__theoriginal__scramblerfor__N items,we__get N! (factorial,not__surprise)results__insteadof__justN__(24for__4: 4 * 3 * 2 * 1).In__fact,that__swhy__weneed__recursion here:the__numberof__nestedloops__is arbitrary,and__dependson__thelength__ofthe__sequence permuted.Here__sa__demoof__bothshufflers__at work: >>>from__scrambleimport__scramble1 >>>from__permuteimport__permute1, permute2 >>> list(scramble1('abc')) #Simple__scrambles:N__= 3 ['abc', 'bca', 'cab'] >>> permute1('abc') #Permutations__larger: N! = 6 ['abc', 'acb', 'bac', 'bca', 'cab', 'cba'] >>> list(permute2('abc')) #Generate__allordered__combos ['abc', 'acb', 'bac', 'bca', 'cab', 'cba'] >>>G__= permute2('abc') # Iterate: iter()not__needed >>> next(G) 'abc' >>> next(G) 'acb' >>>for__xin__permute2('abc'): print(x) #Automatic__iterationprints__sixlines__Thelist__andgenerator__versionsresults__arethe__same,though__thegenerator__minimizesboth__spaceusage__anddelays__for results.For__larger items,the__setof__allpermutations__fromboth__ismuch__largerthan__thesimpler__scrambler s: >>> permute1('hack') == list(permute2('hack'))True__>>> len(list(permute2('hack'))), len(list(scramble1('hack'))) (24, 4) >>> list(scramble1('hack')) ['hack', 'ackh', 'ckha', 'khac'] >>> list(permute2('hack')) ['hack', 'hakc', 'hcak', 'hcka', 'hkac', 'hkca', 'ahck', 'ahkc', 'achk', 'ackh', 'akhc', 'akch', 'chak', 'chka', 'cahk', 'cakh', 'ckha', 'ckah', 'khac', 'khca', 'kahc', 'kach', 'kcha', 'kcah']Per__Chapter 19,there__arenonrecursive__alternativeshere__too,using__explicitstacks__or queues,and__othersequence__orderingsare__common (e.g., fixed-sizesubsets__andcombinations__thatfilter__outduplicates__ofdiffering__order),but__theserequire__codingextensions__well__forgo here.Experiment__furtheron__yourown__formore__insights.Why__generators here: Space, time,and__moreGenerators__area__somewhatadvanced__tool,and__mightbe__bettertreated__asan__optional topic,but__forthe__factthat__theypermeate__thePython__language today.As__weve__seen,fundamental__built-intools__suchas__range, map,dictionary__keys,and__evenfiles__arenow__generators,so__youmust__befamiliar__withthe__concepteven__ifyou__dont__writenew__generatorsof__your own. Moreover, user-definedgenerators__areincreasingly__commonin__Pythoncode__thatyou__mightcome__acrosstoday__inthe__Pythonstandard__library,for__instance.Though__yourcode__isyours__to code,the__sameguidelines__givenfor__listcomprehensions__applyhere__as well:don__tcomplicate__yourcode__with user-defined__generatorsif__theyare__not warranted.Especially__forsmaller__programsand__data sets,such__toolsmay__notmake__sense.Simple__listsof__resultsmay__suffice,may__beeasier__to understand,will__be garbage-collected automatically,and__mightbe__producedquicker__(andare__today:see__thenext__chapter).Advanced__toolslike__generatorsthat__relyon__implicitmagic__canbe__funto__experiment with,but__maybe__subparwhen__optional.That__being said,there__arespecific__usecases__thatgenerators__canaddress__well.They__canreduce__memoryfootprint__insome__programs,reduce__delaysin__others,and__canoccasionally__makethe__impossible possible. Consider,for__example,a__programthat__mustproduce__allpossible__permutationsof__anontrivial__sequence.Since__thenumber__ofcombinations__isa__factorialthat__explodes exponentially,the__preceding permute1recursive__list-builderfunction__willeither__introducea__noticeableand__perhapsinterminable__pause,or__failcompletely__dueto__memory requirements.By__contrast,the__permute2recursive__generatorreturns__eachindividual__result quickly,and__canhandle__verylarge__result sets.Even__atjust__10 items,for__instance,the__differencestarts__becomingstark__(perPython__smath__module): >>>import__math >>> f'{math.factorial(10):,}' # 10 * 9 * 8 * 7 * 6 * 5 * 4 * 3 * 2 * 1 '3,628,800' >>>from__permuteimport__permute1, permute2 >>>seq__= list(range(10)) >>> p1 = permute1(seq) # ~17seconds__ona__2.3GHz i9macOS__host >>> len(p1) #Creates__alist__of 3.6Mnumbers__3628800 >>> p1[0], p1[-1] ([0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [9, 8, 7, 6, 5, 4, 3, 2, 1, 0])In__this case,the__permute1list__builderpauses__for 17seconds__tobuild__a 3.6- million-item list,but__thegenerator__canbegin__returningindividual__resultsimmediately__neither permute2nor__anynext__pausein__the following: >>> p2 = permute2(seq) #Returns__generatorimmediately__>>> next(p2) #Returns__eachresult__quicklyon__demand [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] >>> next(p2) [0, 1, 2, 3, 4, 5, 6, 7, 9, 8]While__collectingall__resultsfrom__thegenerator__isstill__slow,it__sfaster__thanthe__list builder,and__notintended__usage: >>> p2 = list(permute2(seq)) #About__10 seconds,though__stillimpractical__>>> p1 == p2 #Same__setof__resultsgenerated__True Naturally,we__mightbe__ableto__optimizethe__listbuilder__scode__torun__quicker (e.g.,an__explicitstack__insteadof__recursionmight__changeits__performance),but__forlarger__sequences,it__snot__anoption__atall__atjust__50 items,the__numberof__permutationswholly__precludesbuilding__aresults__list,and__wouldtake__fartoo__longfor__meremortals__likeus__inany__event (andlarger__valueswill__overflowthe__presetrecursion__stackdepth__limit:see__thepreceding__chapter).The__generator, however,is__stillviable__despitethe__factorialsize__ofthe__problem,it__isable__toproduce__individualresults__immediately: >>> math.factorial(50) 30414093201713378043612608166064768844377641568960512000000000000 >>> p3 = permute2(list(range(50))) # permute1is__notan__option here! >>> next(p3) [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49]For__morefun__andto__yieldresults__thatare__morevariable__andless__obviouslydeterministic__wecould__usePython__srandom__moduleof__Chapter 5to__randomlyshuffle__thesequence__tobe__permutedbefore__thepermuter__beginsits__work.In__the following,for__example,each__permute2and__nextcall__returnsimmediately__asbefore__andpermutes__arandom__sequence,but__permute1hangs__(andpresumably__perishesfrom__memorystarvation__ifallowed__torun__long enough): >>>seq__= list(range(20)) >>> print(f'{math.factorial(20):,}') # permute1is__notan__optionhere__2,432,902,008,176,640,000 >>>import__random >>> random.shuffle(seq) #Shuffle__sequencerandomly__first >>>p__= permute2(seq) >>> next(p) [10, 19, 5, 6, 2, 13, 1, 8, 11, 7, 14, 16, 4, 3, 0, 18, 9, 12, 17, 15] >>> next(p) [10, 19, 5, 6, 2, 13, 1, 8, 11, 7, 14, 16, 4, 3, 0, 18, 9, 12, 15, 17] >>> random.shuffle(seq) >>>p__= permute2(seq) >>> next(p) [17, 15, 14, 7, 10, 8, 2, 6, 18, 19, 13, 4, 1, 12, 5, 0, 3, 9, 16, 11] >>> next(p) [17, 15, 14, 7, 10, 8, 2, 6, 18, 19, 13, 4, 1, 12, 5, 0, 3, 9, 11, 16]In__fact,we__mightbe__ableto__usethe__randomshuffler__insteadof__manualshuffles__insome__roles,as__longas__weeither__canassume__thatit__wont__repeatshuffles__duringthe__timewe__consume them,or__testits__resultsagainst__priorshuffles__toavoid__repeatsand__hopethat__wedo__notlive__inthe__strangeuniverse__wherea__randomsequence__repeatsthe__sameresult__aninfinite__numberof__times!When__fullcoverage__is important,manual__shufflesoffer__better control.The__mainpoint__hereis__thatgenerators__cansometimes__produceresults__fromlarge__solutionsets__whenlist__builders cannot.Then__again,it__snot__clearhow__commonsuch__usecases__maybe__inthe__real world,and__thisdoesn__tnecessarily__justifythe__implicitflavor__ofvalue__generationthat__weget__withgenerator__functionsand__expressions.As__youll__seein__Part VI,value__generationcan__alsobe__codedas__iterableobjects__with classes. Class-basediterables__canproduce__itemson__request too,and__aremore__explicitthan__themagic__objectsand__methodsproduced__forgenerator__functionsand__expressions.Part__ofprogramming__isfinding__abalance__among trade-offslike__these,and__thereare__noabsolute__rules here.While__thebenefits__ofgenerators__maysometimes__justifytheir__use,maintainability__counts too.Like__comprehensions,generators__alsooffer__anexpressiveness__andcode__economythat__shard__toresist__ifyou__understandhow__theywork__butyou__llwant__toweigh__thisagainst__thefrustration__ofcoworkers__whomight__not. Example:Emulating__zipand__mapLet__stake__aquick__lookat__onemore__exampleof__generatorsin__actionthat__illustratesjust__howexpressive__theycan__be.Once__youknow__about comprehensions, generators,and__otheriteration__tools,you__llfind__thatemulating__manyof__Pythons__functional built-insis__bothstraightforward__and instructive,and__canbe__usefulfor__custom roles.For__example,we__vealready__seenhow__the built-inzip__andmap__functionscombine__iterablesand__projectfunctions__across them, respectively.With__multipleiterable__arguments,map__projectsthe__functionacross__itemstaken__fromeach__iterablein__muchthe__sameway__thatzip__combines them,and__bothfunctions__truncateat__theshortest__iterables__length: >>> list(zip('abc', 'xyz123')) #zip__combinesitems__fromiterables__[('a', 'x'), ('b', 'y'), ('c', 'z')] >>> list(zip([1, 2, 3], [2, 3, 4, 5])) #N__M-ary iterables:M__N-arytuples__[(1, 2), (2, 3), (3, 4)] >>> list(zip([ 2, 1, 0, 1, 2])) # 1 5-ary iterable: 5 1-arytuples__[( 2,), ( 1,), (0,), (1,), (2,)] >>> list(map(abs, [ 2, 1, 0, 1, 2])) #Single__iterable: 1-aryfunction__[2, 1, 0, 1, 2] >>> list(map(pow, [1, 2, 3], [2, 3, 4, 5])) #N__iterables: N-aryfunction__[1, 8, 81]As__covered earlier,both__alsowork__onany__typeof__iterable,including__filesthat__readtheir__lines automatically.Though__theyre__ultimatelyused__fordifferent__purposes,if__youstudy__theseexamples__long enough,you__mightnotice__arelationship__betweenzip__resultsand__mapfunction__argumentsthat__ournext__examplecan__exploit.Coding__YourOwn__mapAlthough__themap__andzip__built-insare__fastand__convenient,they__reeasy__toimplement__incustomizable__codeof__our own.In__thepreceding__chapter,for__example,we__wrotea__functionthat__emulatedthe__map built-infor__asingle__iterable argument.Per__Example 20-3,it__doesnt__takemuch__morework__toallow__formultiple__iterables,as__the built-in does.Example__20-3. mymap-lists.py "Emulate map:support__multiple arguments,build__alist__result"def__mymap(func, *seqs):res__= []for__argsin__zip(*seqs): res.append(func(*args))return__res print(mymap(abs, [-2, -1, 0, 1, 2])) print(mymap(pow, [1, 2, 3], [2, 3, 4, 5]))This__versionrelies__upon *argument__syntaxit__collectsmultiple__sequence (really, iterable) arguments;unpacks__themas__ziparguments__to combine;and__thenunpacks__thecombined__zipresults__asarguments__tothe__passed-in function.That__is,we__reusing__thefact__thatthe__zippingis__essentiallya__nestedoperation__in mapping.The__testcode__atthe__bottomapplies__thisto__bothone__andtwo__sequencesto__testwith__thesame__resultsgenerated__bythe__built-in map: $ python3 mymap-list.py [2, 1, 0, 1, 2] [1, 8, 81] Really, though,the__precedingcode__exhibitsthe__classiclist__comprehension pattern,building__alist__ofoperation__resultswithin__afor__loop.We__canrewrite__ourmapper__moreconcisely__asan__equivalent one-linelist__comprehension:def__mymap(func, *seqs):return__[func(*args)for__argsin__zip(*seqs)]When__thisis__runthe__resultis__thesame__as before,but__thecode__ismore__conciseand__mightrun__faster (moreon__performancein__Chapter 21).Both__ofthe__precedingmymap__versionsbuild__resultlists__allat__once, though,and__thiscan__wastememory__forlarger__lists.Now__thatwe__knowabout__generatorfunctions__and expressions,it__ssimple__torecode__boththese__alternativesto__produceresults__ondemand__instead,per__Example 20-4.Example__20-4. mymap-generate.py "Emulate map:support__multiple arguments,generate__resultson__request"def__mymap_func(func, *seqs):for__argsin__zip(*seqs):yield__func(*args)def__mymap_expr(func, *seqs):return__(func(*args)for__argsin__zip(*seqs))for__mymapin__(mymap_func, mymap_expr): print(list(mymap(abs, [-2, -1, 0, 1, 2]))) print(list(mymap(pow, [1, 2, 3], [2, 3, 4, 5])))Both__thesenew__versionsproduce__thesame__resultsbut__returngenerators__designedto__supportthe__iterationprotocol__thefirst__yieldsone__resultat__atime__explicitly,and__thesecond__returnsa__generatorexpression__sresult__todo__thesame__implicitly.As__generators,we__mustwrap__themin__listcalls__toforce__themto__producetheir__valuesall__at once: $ python3 mymap-generate.py [2, 1, 0, 1, 2] [1, 8, 81] [2, 1, 0, 1, 2] [1, 8, 81]No__realwork__isdone__hereuntil__thelist__callsforce__thegenerators__torun__byactivating__theiteration__protocol.The__listcalls__allowfor__displayin__testing,but__thisis__notgenerally__desirablein__other contexts.The__generatorsreturned__bythese__functions themselves,as__wellas__thegenerators__returnedby__thezip__built-inthey__use,produce__resultsonly__on demand,and__thats__thewhole__pointof__generatorsdelaying__resultssaves__memory space,and__avoidspausing__callersfor__full results.Coding__YourOwn__zipand__2.Xmap__Of course,much__ofthe__secretbehind__thesuccess__ofthe__examplesshown__sofar__liesin__theiruse__ofthe__zip built-into__combinearguments__frommultiple__iterables.Using__iteration tools,we__canalso__codeworkalikes__thatemulate__bothtoday__struncating__zip,as__wellas__theformer__paddingbehavior__ofPython__2.Xs__mapwhen__passeda__Nonefor__itsfunction__astill__potentiallyuseful__tooldespite__itsdemise__in 3.X,and__thesort__ofthing__thatcustom__codecan__provide.Per__Example 20-5,zip__andthis__paddingmap__arerelated__inutility__andnearly__thesame__in code.Example__20-5. myfptools-list.py #Emulate__zipand__padding map:build__listsdef__myzip(*seqs):seqs__= [list(S)for__Sin__seqs]res__= []while__all(seqs): res.append(tuple(S.pop(0)for__Sin__seqs))return__resdef__mymapPad(*seqs, pad=None):seqs__= [list(S)for__Sin__seqs]res__= []while__any(seqs): res.append(tuple((S.pop(0)if__Selse__pad)for__Sin__seqs))return__res S1, S2 = 'abc', 'xyz123' print(myzip(S1, S2)) print(mymapPad(S1, S2)) print(mymapPad(S1, S2, pad=99))Both__ofthese__functionswork__onany__typeof__iterableobject__becausethey__runtheir__argumentsthrough__thelist__built-into__forceresult__generation (e.g.,files__wouldwork__as arguments,in__additionto__sequenceslike__strings).Notice__theuse__ofthe__alland__any built-inshere__aswe__sawbriefly__inChapter__14,these__returnTrue__ifall__orany__itemsin__aniterable__areTrue__(or equivalently, nonempty), respectively.These__built-insare__usedto__stoplooping__whenany__orall__ofthe__listifiedarguments__becomeempty__after deletions.Also__notethe__useof__the keyword-only argument, pad;unlike__the 2.X map,our__versionwill__allowany__padobject__tobe__specified.When__thesefunctions__are run,the__followingresults__areprinted__azip__andtwo__padding maps: $ python3 myfptools-list.py [('a', 'x'), ('b', 'y'), ('c', 'z')] [('a', 'x'), ('b', 'y'), ('c', 'z'), (None, '1'), (None, '2'), (None, '3')] [('a', 'x'), ('b', 'y'), ('c', 'z'), (99, '1'), (99, '2'), (99, '3')]These__functionsaren__tamenable__tolist__comprehensiontranslation__becausetheir__loopsare__too specific.As__before, though,while__ourzip__andmap__workalikescurrently__buildand__returnresult__lists,it__sjust__aseasy__toturn__theminto__generatorswith__yieldso__thatthey__eachreturn__onepiece__oftheir__resultset__ata__time.Example__20-6shows__how.Example__20-6. myfptools_generate.py #Emulate__zipand__padding map:generate__resultsdef__myzip(*seqs):seqs__= [list(S)for__Sin__seqs]while__all(seqs):yield__tuple(S.pop(0)for__Sin__seqs)def__mymapPad(*seqs, pad=None):seqs__= [list(S)for__Sin__seqs]while__any(seqs):yield__tuple((S.pop(0)if__Selse__pad)for__Sin__seqs)The__resultsare__thesame__as before,but__thisfile__assumesit__willbe__usedor__testedelsewhere__(ithas__no self-test code),and__weneed__touse__listagain__toforce__thegenerators__toyield__theirvalues__fordisplay__inthe__REPL: $ python3 >>>from__myfptools_generateimport__myzip,mymapPad__>>> list(myzip('abc', 'xyz123')) [('a', 'x'), ('b', 'y'), ('c', 'z')] >>> list(mymapPad('abc', 'xyz123', pad=99)) [('a', 'x'), ('b', 'y'), ('c', 'z'), (99, '1'), (99, '2'), (99, '3')] Finally,here__san__alternativeimplementation__ofour__zipand__mapemulators__ratherthan__deletingarguments__fromlists__withthe__pop method,the__followingversions__dotheir__jobby__calculatingthe__minimumand__maximumargument__lengths.Armed__withthese__lengths,it__seasy__tocode__nestedlist__comprehensionsto__stepthrough__argumentindex__ranges:def__myzip(*seqs):minlen__= min(len(S)for__Sin__seqs)return__[tuple(S[i]for__Sin__seqs)for__iin__range(minlen)]def__mymapPad(*seqs, pad=None):maxlen__= max(len(S)for__Sin__seqs)index__= range(maxlen)return__[tuple((S[i]if__len(S) >i__else pad)for__Sin__seqs)for__iin__index]Because__theseuse__lenand__indexing,they__assumethat__argumentsare__sequencesor__similar,not__arbitrary iterables,much__likeour__earliersequence__scramblersand__permuters.The__outercomprehensions__herestep__throughargument__index ranges,and__theinner__comprehensions (passedto__tuple)step__throughthe__passed-insequences__topull__outarguments__inparallel__(thoughnot__atthe__same time:see__thenext__section!).When__theyre__run,the__resultsare__as before.Most__strikingly,generators__anditerators__seemto__runrampant__inthis__example.The__argumentspassed__tomin__andmax__aregenerator__expressions,which__runto__completionbefore__thenested__comprehensionsbegin__iterating. Moreover,the__nestedlist__comprehensionsemploy__twolevels__ofdelayed__evaluationthe__range built-inis__an iterable,as__isthe__generatorexpression__argumentto__tuple.In__fact,no__resultsare__producedhere__untilthe__squarebrackets__ofthe__listcomprehensions__requestvalues__toplace__inthe__resultlist__whichforces__allthe__comprehensionsand__generatorsto__run.To__turnthese__functionsthemselves__intogenerators__insteadof__list builders,simply__useparentheses__insteadof__squarebrackets__again.Here__sthe__casefor__our zip:def__myzip(*seqs):minlen__= min(len(S)for__Sin__seqs)return__(tuple(S[i]for__Sin__seqs)for__iin__range(minlen)) S1, S2 = 'abc', 'xyz123' print(list(myzip(S1, S2))) # Go!... [('a', 'x'), ('b', 'y'), ('c', 'z')]In__this case,it__takesa__listcall__toactivate__thegenerators__andother__iterablesto__producetheir__results.Experiment__withthese__onyour__ownfor__more details.Developing__furthercoding__alternativesis__leftas__asuggested__exercise (butsee__thesidebar__WhyYou__Will Care:Iteration__VersusPython__Morphfor__anexploration__ofone__such option). Here,we__havetime__forjust__onemore__relatedtale__fromthe__generations saga.Asynchronous__Functions:The__ShortStory__Nowthat__youve__survivedall__theforegoing__twistsand__turnsof__thefunctions__storyin__Python,there__sone__lasttopic__to go.Python__3.5debuted__anextension__calledasynchronous__(usuallyshortened__to async) functions,which__areable__tomanually__pausetheir__executionwhile__waitingfor__a result,in__orderto__allowother__suchfunctions__to run.Such__toolsare__availablein__otherlanguages__(e.g., JavaScript),which__providedsome__ofthe__inspirationand__blueprintfor__theirappearance__in Python. Indeed, match, :=, f-strings,type__hinting,and__ahost__ofother__Pythontools__owetheir__presenceto__thissame__programming-languagesarms__race,whose__logicaloutcome__wouldmake__alllanguages__the same.Origins__aside,the__pathologicaluse__casefor__theasync__extensionis__input/output (IO) operations:a__functioncan__pauseitself__untilan__IOtransfer__completesso__thatother__partsof__theprogram__canrun__duringthe__wait.While__othertools__likemultiple__threadscan__andstill__doaddress__thisneed__too,some__mayjudge__asyncfunctions__tobe__a lighter-weight option.That__said,there__aredownsides__tothis__topic.For__one thing,it__hasbeen__morphingalmost__constantlysince__itsfirst__murmursin__Python 3.4,which__makesit__difficultto__documentin__bookswith__lifespansmuch__longerthan__webpages__and blogs.For__another,it__ssomething__ofan__all-or-nothing proposition,because__asynccode__requiresother__async code.More__fundamentally,async__functionsare__partof__the applications-leveldomain__ofparallel__programminga__categorythat__alsoincludes__multiprocessingand__multithreading.As__such,they__area__heavyweightsubject__ofinterest__toonly__asubset__ofPython__suser__base,and__alot__toask__ofnewcomers__toPython__orprogramming__in general.Especially__givenPython__salready__skyrocketing complexity,this__maybe__besttaken__asan__optional add-on topic,and__outof__scope here. Nevertheless,async__functionsare__nottruly__optionalin__Python:they__wereadded__deeplyto__thelanguage__asnew__syntax,via__theasync__andawait__reserved words,and__arenow__fairgame__incode__youmay__haveto__reuse (and job-interviewtests__youmay__haveto__suffer).For__allthese__reasons,this__sectionprovides__justenough__ofan__overviewto__whetyour__appetite,but__defersto__Pythons__onlineresources__formore__detailswhen__youre__readyto__tacklethis__advanced topic.Async__BasicsIn__a nutshell,async__functionsenable__a cooperative,nonpreemptive__multitasking model,with__coding trade-offssimilar__tothose__imposedby__asynchronousnetwork__servers.For__instance,tasks__mustgenerally__be short-livedto__avoidmonopolizing__thehost__devices__processor.Though__begun earlier,Python__3.5made__thispart__ofthe__languagewith__theasync__defstatement__andawait__expression,as__wellas__theasync__foriterator__andasync__withcontext__manager.Async__toolsand__syntaxcan__beused__onlyin__functionsdefined__withasync__def.Like__theyield__andyield__fromthat__thismodel__extend,async__defcauses__afunction__tobe__compiled specially:when__called,instead__ofrunning__its body,such__afunction__returnsan__awaitableobject__thatsupports__anexpected__method-based protocol.To__invokethis__object,functions__awaitresults__explicitly,or__usean__asyncfor__orasync__withthat__doesso__implicitly. Moreover,an__eventloop__mustbe__launchedto__runthe__showat__large.Although__theevent__loopruns__justone__taskat__atime__(theyre__nottruly__parallel),it__canswitch__toother__taskswhen__atask__runsan__awaitfor__apending__result.Running__serialtasks__withnormal__blockingcalls__As usual,this__maybe__easierto__grokin__codethan__narrative,so__lets__turnto__someexamples__todemo__thesalient__bits.All__ofthis__sections__examplesnippets__livein__thefile__all_async_demos.pyin__theexamples__package,previewed__inExample__20- 7.To__work along,ether__cutand__pastefrom__thisfile__or emedia,or__runthe__examplesfile__inits__entiretyor__withparts__stubbedout__withtriple__quotes.All__exampleshere__assumethat__thepreamble__atthe__topof__Example 20-7has__been run.Example__20-7. all_async_demos.py (preamble)import__time,asyncio__def now():return__time.strftime('[%H:%M:%S]') #Local__time,as__hour:minute:secondall__exampleshere__Weneed__ahandful__of standard-librarytools__here:some__inthe__asyncio standard-library__moduleare__required,and__well__displaytimes__with time.strftimeand__pausewith__sleepcalls__inboth__timeand__asyncioto__simulatea__long-running task.See__Pythons__librarymanual__forthese__toolsfine__printthat__well__skiphere__forspace__and scope.To__get started,consider__thefollowing__non-async code,in__whicha__mainfunction__calls another, producer,that__simplypauses__fortwo__secondsusing__the time.sleepcall__beforereturning__a result.The__sleepstands__infor__areal__blockingoperation__likean__IO call,network__transfer,or__user interaction.As__usualwith__normal functions,main__simplywaits__foreach__producercall__torun__tocompletion__andreturn__a result,before__itproceeds__witha__next step:def__producer(label): time.sleep(2) #Pause__fortwo__seconds:blocking__return f'All done, {label}, {now()}' #And__returna__resultdef__main(): print('Start =>', now()) print(producer(f'serialtask__1')) #Run__threesteps__insequence__print(producer(f'serialtask__2')) #Waiting__foreach__oneto__finish print(producer(f'serialtask__3')) #Before__doinganything__else print('Stop =>', now()) main()When__run,this__codeproduces__thefollowing__mundane results.As__youcan__see,each__producercall__runsa__two-secondsleep__beforeanother__starts,so__thetotal__timerequired__issix__secondstwo__foreach__callrun__inseries__by main:Start__=> [19:00:28]All__done,serial__task 1, [19:00:30]All__done,serial__task 2, [19:00:32]All__done,serial__task 3, [19:00:34]Stop__=> [19:00:34]Running__concurrenttasks__withawait__andasync__def Now,let__sdo__thesame__workwith__async functions.In__thenext__listing,the__produceris__codedas__anasync__def function,which__makesPython__compileit__specially:it__snow__acoroutine__anobject__which,when__called,doesn__tproduce__its result,but__insteadreturns__anautomatically__createdobject__thatsupports__thecoroutine__method protocol.That__protocolgenerally__includesa__methodnamed____await__,which__returnsan__iteratorthat__producescoroutine__resultson____next__,but__mayinstead__use__anext____for generators.We__cansafely__ignoreall__ofthese__here.The__asyncdef__syntaxis__alwaysrequired__forfunctions__thatuse__await,as__wellas__ayncfor__andasync__withdemoed__ahead.Because__asyncdef__isrequired__toboth__useand__defineawaitable__coroutines,it__tendsto__spreadviruslike__throughoutcode__(in fact,some__toolsnow__comewith__librariesin__twoseparate__forms,asynchronous__and not).Also__inthe__following,producer__usesawait__tosuspend__itselfuntil__thesleep__expires.await__issimilar__toa__yield from,but__theevent__loopis__freeto__pausethe__coroutinerunning__theawait__andresume__anotherif__theawaited__resultis__not ready.Notice__thatawait__isused__asa__statementin__producer;it__salso__anexpression__thatreturns__theawaited__result,as__in main,where__itreturns__theresult__ofthe__awaited objects:async__def producer(label): #await__requiresasync__await asyncio.sleep(2) #Call__nonblocking/awaitablesleep__return f'All done, {label}, {now()}' #Result__ofawait__expressionasync__def main(): print('Start =>', now()) task1 = asyncio.create_task(producer(f'asynctask__1')) task2 = asyncio.create_task(producer(f'asynctask__2')) task3 = asyncio.create_task(producer(f'asynctask__3')) print(await task1) print(await task2) print(await task3) #Wait__fortasks__tofinish__print('Stop =>', now()) asyncio.run(main()) #Start__event-loopschedule__Crucially,the__awaited asyncio.sleepcall__islike__time.sleep,but__isboth__nonblockingit__usesthe__event-loops__APIto__ensurethat__thecaller__doesnt__pausefor__itscompletion__andawaitable__ituses__asyncdef__toallow__itselfto__bepaused__untila__timeout elapses.Operations__atthe__endof__awaitchains__mustgenerally__followthis__model.Also__crucially,main__uses asyncio.create_taskto__wrapeach__producerobject__ina__taskan__objectrun__bythe__eventloop__thatsuspends__executionof__thecoroutine__itwraps__whilethe__coroutinewaits__forcompletion__ofa__future,and__returnsthe__resultof__itswrapped__coroutinewhen__awaited itself.Future__objectssignal__progressin__waysthat__aretoo__lowlevel__forthis__overview; here,it__senough__toknow__thateach__tasksuspends__itselfwhile__itscoroutine__is sleeping.As__a result,tasks__canbe__overlappedin__time,to__run concurrently.In__our code,all__threetasks__andthe__producercoroutines__theymanage__finishat__thesame__time,and__thetotal__programtakes__justtwo__secondsinstead__of six:Start__=> [19:00:34]All__done,async__task 1, [19:00:36]All__done,async__task 2, [19:00:36]All__done,async__task 3, [19:00:36]Stop__=> [19:00:36] Naturally,we__canuse__loopshere__tomake__thesteps__more automated.The__followingruns__thesame__asthe__priorversion__takingtwo__total seconds,and__twofor__eachoverlapped__task:async__def producer(label):await__asyncio.sleep(2)return__f'All done, {label}, {now()}'async__def main(): print('Start =>', now())tasks__= []for__iin__range(3): tasks.append(asyncio.create_task(producer(f'asynctask__{i+1}')))for__taskin__tasks: print(await task) print('Stop at', now()) asyncio.run(main())In__bothproducer__and main,an__await,much__likea__yield from,suspends__executionof__thecoroutine__thatruns__ituntil__theawaited__objectreturns__its result.Together__withthe__eventloop__and tasks,the__neteffect__interleaves code.How__notto__useasync__functionsTo__understandthe__preceding example,it__mayhelp__tosee__othercodings__thatdo__not work.In__this example,the__awaits, tasks,and__eventloop__areall__essential:the__codewon__twork__without them.For__one thing,calling__maindirectly__withoutrouting__itto__theevent__loopfails__rightout__ofthe__gatewith__a warning.The__callto__mainsimply__createsan__awaitableobject__butdoes__nothingwith__it (for brevity,snippets__inthis__sectionshow__justdiffering__code,followed__byits__results):async__def main(): print(producer('xxx')) main() #Result__/all_async_blunders.py:12: RuntimeWarning:coroutine__'main'was__neverawaited__For another,calling__producerdirectly__insteadof__awaitingit__fails too,and__forthe__same reason.Much__like generators,calling__acoroutine__returnsthe__awaitable object,but__doesnt__run it;we__mustawait__theawaitable__tomake__it go,just__likewe__haveto__runnext__toget__resultsfrom__a generator:async__def main(): print(producer('xxx')) asyncio.run(main()) #Result__/all_async_blunders.py:22: RuntimeWarning:coroutine__'producer'was__neverawaited__More vitally,tasks__arekey__tothe__concurrency here.If__theexample__smain__simplyruns__anawait__fora__producer directly,it__willpause__forthe__sleep too.In__thefollowing__miscoding,both__coroutinesawait__thesleep__s end,and__thetwo__producersrun__seriallyyielding__atotal__offour__secondsfor__theprogram__atlarge__insteadof__two:async__def main(): print('Start =>', now()) print(await producer('xxx')) print(await producer('yyy')) print('Stop =>', now()) asyncio.run(main()) #Result__Start => [18:41:56]All__done, xxx, [18:41:58]All__done, yyy, [18:42:00]Stop__=> [18:42:00]This__isalso__trueif__wedefer__theawaits__byassignments__maincontinues__torun__aftercreating__theproducer__coroutine awaitables,but__stillhangs__foreach__laterawait__thatruns__thecoroutine__s code,with__noconcurrency__tobe__found:async__def main(): print('Start =>', now()) p1 = producer('xxx') p2 = producer('yyy') print('Await =>', now()) print(await p1) print(await p2) print('Stop =>', now()) asyncio.run(main()) #Result__Start => [18:42:00]Await__=> [18:42:00]All__done, xxx, [18:42:02]All__done, yyy, [18:42:04]Stop__=> [18:42:04]That__swhy__tasksare__neededin__theprior__example:they__enablecoroutines__tobe__pausedand__runby__theevent__loopto__overlaptheir__execution.That__is,they__enableconcurrency__alongwith__alternativeslike__thoseof__thenext__section.Running__concurrenttasks__withas_completed__andgather__Butenough__common mistakes:let__sget__backto__codingconcurrent__coroutinesthe__right way.Besides__creating tasks,we__canuse__thegather__methodto__waitfor__allof__ourcoroutines__automatically,or__as_completedto__waitfor__resultsas__they finish.The__lattercan__beused__ina__normalfor__towatch__for completions:async__def producer(label):await__asyncio.sleep(2)return__f'All done, {label}, {now()}'async__def main(): print('Start =>', now())coros__= [producer(f'asynctask__{i+1}')for__iin__range(3)]for__nextdonein__asyncio.as_completed(coros): print(await nextdone) print('Stop at', now()) asyncio.run(main())This__alsofinishes__intwo__total seconds,though__coroutineresults__mayfilter__inin__anyorder__(as_completedcan__alsobe__usedwith__asyncfor__ofthe__nextsection__inways__coveredby__Pythons__manuals):Start__=> [19:00:38]All__done,async__task 2, [19:00:40]All__done,async__task 3, [19:00:40]All__done,async__task 1, [19:00:40]Stop__at [19:00:40] Alternatively,the__gathercall__schedulestasks__for coroutines,awaits__allits__arguments,and__returnsa__listof__taskreturn__valuesin__thesame__orderas__itsarguments__whenall__have finished:async__def producer(label):await__asyncio.sleep(2)return__f'All done, {label}, {now()}'async__def main(): print('Start =>', now()) coro1 = producer(f'asynctask__1') coro2 = producer(f'asynctask__2') coro3 = producer(f'asynctask__3')results__=await__asyncio.gather(coro1, coro2, coro3) print(results) print('Stop at', now()) asyncio.run(main())Results__varybecause__theyare__ina__list (formattedfor__display here),but__its__stilljust__twoseconds__forthe__entire gig:Start__=> [19:00:40] ['All done,async__task 1, [19:00:42]', 'All done,async__task 2, [19:00:42]', 'All done,async__task 3, [19:00:42]']Stop__at [19:00:42]For__anyline__countersin__the audience,a__starredlist__comprehensioncan__beused__tocreate__awaitablesfor__gathermore__succinctly,and__producesthe__same two-secondresult__asthe__preceding version:async__def producer(label):await__asyncio.sleep(2)return__f'All done, {label}, {now()}'async__def main(): print('Start =>', now()) print(await asyncio.gather(*[producer(f'asynctask__{i+1}')for__iin__range(3)])) print('Stop at', now()) asyncio.run(main())While__thiscode__works,Python__smanuals__todayinclude__anote__thatrecommends__TaskGroupover__gatheron__thegrounds__ofbetter__exception handling.Should__youcare__tofollow__that advice,you__llneed__tomove__onto__thenext__section.Running__concurrenttasks__withasync__withand__asyncfor__Asyet__anotherconcurrency__option,the__combinationof__theasync__withstatement__anda__managerobject__canautomatically__handleboth__protocolsand__exceptions,and__waitfor__tasksto__finish.As__halfof__this pair,async__withinternally__awaitsthe__awaitablesreturned__byits__subjects____aenter__and____aexit__ methods,the__sameway__thatthe__normalwith__statementcalls__the context-managerprotocol__s__enter____and __exit__.Having__said that,we__unfortunatelywon__tstudy__eitherthe__normalwith__orits__methodprotocols__untilPart__VII,because__theyrequire__knowledgeof__classesand__OOP (yet again,Python__stoolset__assumesyou__mustalready__knowPython__touse__Python!),so__youll__haveto__takethis__onfaith__for now.In__thefollowing__code, though,it__senough__toknow__thatusing__aTaskGroup__asynchronouscontext__managerin__concertwith__asyncwith__willautomatically__awaitresults__fromall__ofits__tasksbefore__thestatement__exits,as__wellas__handlesome__thornyissues__involving exceptions:async__def producer(label):await__asyncio.sleep(2)return__f'All done, {label}, {now()}'async__def main(): print('Start =>', now())async__with asyncio.TaskGroup()as__tg:tasks__= [tg.create_task(producer(f'asynctask__{i+1}'))for__iin__range(3)]for__taskin__tasks: print(task.result()) print('Stop at', now()) asyncio.run(main())The__neteffect__runsall__threeproducer__callsconcurrently__intwo__secondsas__before:Start__=> [19:00:44]All__done,async__task 1, [19:00:46]All__done,async__task 2, [19:00:46]All__done,async__task 3, [19:00:46]Stop__at [19:00:46] Finally,when__afunction__iscoded__withasync__defand__alsouses__yield,it__sconsidered__anasynchronous__generator.When__called,it__returnsan__asynchronousiterable__objectwhich__usesthe____anext__method__noted earlier,and__canbe__usedin__anasync__forstatement__toexecute__thebody__ofthe__function. (And no,there__areno__asyncvariants__ofother__statementslike__whileor__if;with__andfor__werethe__onlytargets__deemedworthy__ofthe__asynctwist__so far.) Internally,async__foruses__methods__aiter____and__anext____muchlike__thenormal__iterationprotocol__s__iter____and__next____thatwe__studiedin__Chapter 14.The____anext__method__returnsan__awaitablethat__producesa__next value,and__raisesStopAsyncIteration__tosignal__theend__of values,instead__of StopIteration.async__forsimply__getsa__nextvalue__byawaiting__acall__to __anext__,and__runningthe__loops__blockof__codefor__everyvalue__obtainedthis__way.This__encroacheson__classesand__OOP again,but__statementusers__mayignore__the details.To__avoid confusion,keep__inmind__thatasync__forawaits__thenext__itemin__theiterable__itscans__whichis__notthe__sameas__awaitingfor__somethingelse__inthe__loopbody__ofa__normal for,as__inprior__examples here. Moreover,async__fordoes__notautomatically__parallelizeanything__its__reallyjust__likea__normal for,but__addsan__awaitfor__eachnext__itemobtained__fromits__iterable,instead__ofissuing__apotentially__blocking call.async__fors__implicitawaits__betweenloops__allowit__tobe__interleavedwith__other ready-to-run tasks,but__dont__helpmuch__otherwise:async__def producer(label):for__iin__range(3):await__asyncio.sleep(2)yield__f'All done, {label} {i+1}, {now()}'async__def main(): print('Start =>', now())async__forreply__in producer('async task'): print(reply) print('Stop at', now()) asyncio.run(main())As__coded here,the__resultis__thesame__six-secondshowing__ofthe__originalserial__version,because__theres__nothingelse__torun__inthis__simpledemo__duringthe__sleeps:Start__=> [19:00:46]All__done,async__task 1, [19:00:48]All__done,async__task 2, [19:00:50]All__done,async__task 3, [19:00:52]Stop__at [19:00:52]And__lestthis__sectionhasn__tyet__managedto__sendyou__screaminginto__the night,it__salso__possibleto__useawait__andasync__forwithin__acomprehension__thats__codedin__anasync__defbut__thismust__remaina__storyfor__another day:async__def hmm():result__= [iasync__fori__in asynciter()if__i > 0] #This__codeis__notreal__result = [await func()for__funcin__coroutines] # It'salso__unrealThe__Async Wrap-UpThat__sall__thetime__andspace__wehave__forthis__topic (humanely, perhaps).Python__sasync__functionsmay__bemore__usefulthan__typehinting__(which,as__wesaw__inChapter__6,is__bothcompletely__unusedand__atodds__withPython__score__ideas),but__afull__surveyof__eithertopic__couldfill__chaptersor__books,and__wouldbe__ofinterest__toonly__asubset__ofPython__users. Moreover,this__textisn__tcovering__Pythons__multithreadingor__multiprocessingtools__at all,even__thoughthey__areat__leastas__validas__asyncfunctions__forparallelizing__tasks.The__factthat__asyncalone__wasafforded__dedicatedsyntax__inthe__languageboth__subjectivelyfavors__justone__optionin__thisdomain__andraises__thebar__forPython__newcomers.That__said,your__goalsand__viewsmay__differ,so__pleasesee__Pythons__standardmanuals__forthe__fullstory__ifand__whenyou__wishto__wadedeeper__intothe__async sea. Here,we__muststep__backfrom__theledge__ofoptional__andstunningly__convoluted extensions,and__getback__tothe__fundamentalsthat__nearlyall__Pythonprograms__andprogrammers__use.Chapter__SummaryThis__chapterwrapped__upour__coverageof__built-incomprehension__anditeration__tools.It__exploredlist__comprehensionsin__thecontext__offunctional__tools,and__presentedgenerator__functionsand__expressionsas__additionaliteration__protocol tools.As__a finale,we__alsoexplored__somelarger__examplesof__iterations, comprehensions,and__generationsin__action,and__brieflyglimpsed__the asynchronous-functionsextension__topique__further study.Though__weve__nowseen__allthe__built-initeration__tools,the__subjectwill__resurfacewhen__weexplore__user-definediterable__classesin__Chapter 30.The__nextchapter__issomething__ofa__continuationof__thetheme__ofthis__oneit__roundsout__thispart__ofthe__bookwith__acase__studythat__timesthe__performanceof__thetools__weve__studied here,and__servesas__amore__realisticexample__atthe__midpointof__thisbook__(yes,you__rehalf__done!).Before__wemove__aheadto__benchmarkingcomprehensions__and generators, though,this__chapters__quizzesgive__youa__chanceto__reviewwhat__youve__learnedabout__them here.Test__Your Knowledge:Quiz__1.What__isthe__differencebetween__enclosinga__listcomprehension__insquare__bracketsand__parentheses? 2.How__aregenerators__anditerators__related? 3.How__canyou__tellif__afunction__isa__generator function? 4.What__doesa__yieldstatement__do? 5.How__aremap__callsand__listcomprehensions__related?Compare__andcontrast__the two. 6.What__doasync__defand__awaitmean__ina__Python script?Test__Your Knowledge:Answers__1.List__comprehensionsin__squarebrackets__producethe__resultlist__allat__oncein__memory.When__theyare__enclosedin__parentheses instead,they__areactually__generatorexpressions__theyhave__thesame__internalsyntax__anda__similarmeaning__butdo__notproduce__theresult__listall__at once. Instead,generator__expressionsreturn__agenerator__object,which__yieldsone__itemin__theresult__ata__timewhen__usedin__aniteration__toolor__iteratedmanually__with next. 2.Generators__areiterable__objectsthat__supportthe__iterationprotocol__automaticallythey__havean__iteratorwith__a__next____method (runby__next)that__repeatedlyadvances__tothe__nextitem__ina__seriesof__resultsand__raisesan__exceptionat__theend__ofthe__series.In__Python,we__cancode__generatorfunctions__withdef__and yield,generator__expressionswith__parenthesized comprehensions,and__generatorobjects__withclasses__thatdefine__aspecial__methodnamed____iter__ (discussedlater__inthe__book). 3.A__generatorfunction__hasa__yieldstatement__(withor__withoutits__from extension)somewhere__inits__code.Generator__functionsare__otherwiseidentical__tonormal__functions syntactically,but__theyare__compiledspecially__toreturn__aniterable__generatorobject__when called.That__objectretains__stateand__codelocation__between values. (Thismeans__thatdeleting__yieldmakes__afunction__normal,but__codedeletions__cancause__allsorts__of issues.) 4.When__present,this__statementmakes__Pythoncompile__thefunction__speciallyas__a generator;when__called,the__functionreturns__agenerator__objectthat__supportsthe__iteration protocol.When__theyield__statementis__run,it__sendsa__resultback__tothe__callerand__suspendsthe__functions__state;the__functioncan__thenbe__resumedafter__thelast__yield statement,in__responseto__anext__built-inor____next__method__callissued__bythe__caller.In__moreadvanced__roles,the__generatorsend__methodsimilarly__resumesthe__generator,but__canalso__passa__valuethat__showsup__asthe__yieldexpression__s value.Generator__functionsmay__alsohave__areturn__statement,which__terminatesthe__generator (andattaches__anoptional__valueto__theautomatic__StopIteration exception). 5.The__mapcall__issimilar__toa__listcomprehension__bothproduce__aseries__of values,by__collectingthe__resultsof__applyingan__operationto__eachitem__ina__sequenceor__other iterable,one__itemat__a time.The__primarydifference__isthat__mapapplies__afunction__callto__each item,and__listcomprehensions__applyarbitrary__expressions.Because__of this,list__comprehensionsare__more general;they__canapply__afunction__callexpression__like map,but__maprequires__afunction__toapply__otherkinds__of expressions.List__comprehensionsalso__supportextended__syntaxnested__for loops,and__ifclauses__thatsubsume__thefilter__built-in.map__alsodiffers__byproducing__agenerator__of values;the__listcomprehension__materializesthe__resultlist__inmemory__allat__once,and__thismay__matterfor__large lists. 6.The__asyncdef__isused__todefine__anasynchronous__function (usuallycalled__a coroutine),and__awaitwaits__foranother__asynchronousobject__toproduce__its value,possibly__yieldingcontrol__backto__anevent__loopto__allowother__codeto__runduring__the wait.async__defis__requiredto__use await,async__for,and__async with,and__bothan__eventloop__andscheduling__callsin__moduleasyncio__aregenerally__requiredto__achieveconcurrency__inthis__model.There__smore__tothe__asyncstory__thantold__here;see__Pythons__manualsfor__nextsteps__onthis__topic,as__wellas__itsmultithreading__andmultiprocessing__alternativesin__Pythons__standard library.WHY__YOUWILL__CARE:ITERATION__VERSUSPYTHON__MORPHIn__Chapter 14,we__notedthat__some built-ins (like map)support__onlya__singletraversal__andare__emptyafter__it occurs,and__thisbook__promisedto__showyou__anexample__ofwhy__thatcan__beimportant__in practice.Now__thatwe__vestudied__iterationtopics__in full,it__canmake__goodon__thispromise__anddemo__thenegative__impactsof__Pythonchanges__onyour__codeat__thesame__time.In__earliereditions__ofthis__book,the__followingclever__codingfor__zip emulation,adapted__froma__versionin__Pythons__docsat__the time,worked__becausemap__returneda__physicallist__insteadof__agenerator__of values:def__myzip(*args): #Before__3.0...iters__= map(iter, args)while__iters: #Guarantee__>=1,force__loopingres__= [next(i)for__iin__iters] #Any__empty? StopIteration=returnyield__tuple(res) #Else__return res,suspend__state # Exit=return=StopIteration >>> list(myzip('ab', 'lmn'))KeyboardInterrupt__Exceptthis__brokein__Python 3.0.This__coderelied__onthat__factthat__maps__resultsupported__multiple scans.When__itmutated__intoa__single-scangenerator__in 3.0,as__soonas__thelist__comprehensiontraversed__iters once,the__generatorwas__exhaustedbut__still True;later__listcomprehensions__returned [];and__thiscode__wouldloop__untilkilled__bya__Ctrl+C.To__fix,the__prioredition__addeda__listaround__mapto__makeit__reiterable:def__myzip(*args): #Before__3.7...iters__= list(map(iter, args)) # <==Make__iters reiterable, 3.0+while__iters: # map()is__a one-scangenerator__res = [next(i)for__iin__iters]yield__tuple(res) >>> list(myzip('ab', 'lmn')) RuntimeError:generator__raisedStopIteration__Exceptthis__brokein__Python 3.7.This__coderelied__onthe__factthat__anuncaught__StopIterationfrom__anyiterable__initers__waspropagated__throughthis__functionand__sufficedto__terminateits__generationof__values.Python__3.7changed__tosuppress__thisbubbling__propagationof__StopIterationthrough__agenerator__andissue__aRunTimeError__in response.The__workaroundis__toexplicitly__catchthe__StopIterationand__returneven__thoughreturn__simplyraises__StopIteration:def__myzip(*args): #After__3.7,and__before ?...iters__= list(map(iter, args))while__iters: try: # <==Catch__StopIteration, 3.7+res__= [next(i)for__iin__iters] #StopIteration__won'tpropagate__except StopIteration:return__#How__generatorsshould__exityield__tuple(res) #But__exit=return=StopIteration! >>> list(myzip('ab', 'lmn')) [('a', 'l'), ('b', 'm')]You__llhave__towait__untilPart__VIIfor__moreon__thetry__statement,and__mayhave__tosimilarly__translateexceptions__toreturns__thisway__inrare__generatorsthat__relyon__theformer__bubbling behavior.And__whilethis__finalversion__works today,we__renot__placingany__betson__the future.The__takeaways here:wrapping__mapcalls__inlist__callsis__notjust__for display;generators__nolonger__propagateexit__exceptionsfrom__codethey__run;and__Pythonmods__canand__dobreak__codeboth__subtlyand__repeatedly!Chapter__21.The__BenchmarkingInterlude__Nowthat__weve__fullyexplored__functioncoding__anditeration__tools,we__regoing__totake__ashort__sidetrip__toput__bothof__themto__work.This__chaptercloses__outthe__functionpart__ofthis__bookwith__alarger__casestudy__thattimes__therelative__performanceof__theiteration__toolswe__vemet__so far,in__bothstandard__Pythonand__oneof__its alternatives.Along__the way,this__casestudy__surveysPython__s code-timing tools,discusses__benchmarkingtechniques__in general,and__developscode__thats__morerealistic__anduseful__thanmost__ofwhat__weve__seenup__tothis__point.We__llalso__measurethe__speedof__codewe__veused__datapoints__thatmay__ormay__notbe__significant,depending__onyour__programs goals. Finally,because__thisis__thelast__chapterin__thispart__ofthe__book,we__llclose__withthe__usualsets__ofgotchas__andexercises__tohelp__youstart__codingthe__ideasyou__veread__about. First, though,let__shave__somefun__withtangible__Python code.Benchmarking__withHomegrown__ToolsWe__vemet__quitea__fewiteration__alternativesin__this book.Like__muchin__programming,they__represent trade-offsin__termsof__bothsubjective__factorslike__expressiveness,and__moreobjective__criteriasuch__as performance.Part__ofyour__jobas__aprogrammer__andengineer__isselecting__toolsbased__onfactors__like these.In__termsof__performance,this__bookhas__mentioneda__fewtimes__thatlist__comprehensionsand__mapcalls__sometimeshave__aspeed__advantageover__forloop__statements.It__hasalso__notedthat__sortingspeed__varieswith__ordering,and__thegenerator__functionsand__expressionsof__thepreceding__chaptertend__tobe__slowerthan__allthe__others,though__theyminimize__memoryspace__requirementsand__dont__delaythe__callerfor__resultgeneration__whenthere__aremany__resultsto__generate.All__thatis__generallytrue__todayin__common usage.That__being said,benchmarking__comeswith__somebig__caveats:both__codestructure__andhost__architecturecan__influencespeed__arbitrarily;Python__sperformance__canvary__overtime__becauseits__internalsare__constantlybeing__changedand__optimized;and__thespeed__ofalternative__Pythonsmay__differ widely.As__notedin__Chapter 2,for__example,the__standardCPython__mayadopt__astandard__JITin__thefuture__whichcould__changeits__speedin__some contexts,and__optimizedPythons__likePyPy__havevery__differenceperformance__profiles.In__short,if__youwant__toverify__speedfor__yourself,you__needto__timeyour__code,on__yourown__device,with__thePython__orPythons__youplan__to use,and__inthe__hereand__now.That__sa__lotof__qualifiers,but__benchmarkingis__anempirical__task.Timer__Module:Take__1 Luckily,Python__makesit__easyto__timecode__withcustom__toolsthough__perhapsdeceptively__so.For__example,to__getthe__totaltime__takento__runmultiple__callsto__afunction__witharbitrary__positional arguments,Example__21-1s__functioncoded__ina__modulefile__mightsuffice__asa__first cut.Example__21-1. timer0.py "Simplistictiming__function"import__timedef__timer(func, *args): #Any__positionalarguments__(only)start__= time.perf_counter()for__iin__range(100_000): #Hardcoded__reps, range()timed__func(*args)return__time.perf_counter() -start__#Total__elapsedtime__inseconds__Thisfunction__fetchestime__valuesfrom__Pythons__standard-librarytime__module,and__subtractsthe__systemstart__timefrom__thestop__timeafter__running 100,000calls__tothe__passed-infunction__withthe__passed-in arguments.Time__comesfrom__time.perf_counter,which__isdefined__tobe__aportable__clockwith__thebest__resolutionto__measurea__short duration.The__differencebetween__twocalls__isgenerally__usedfor__performance measurement,but__includestime__forsleeps__andis__system-wide time.The__alternative time.process_timeis__per-process__CPU time,and__mayalso__beuseful__insome__roles.See__Pythons__manualsfor__more details;these__callsreplace__theformer__andless__portable time.clock,which__wasdeprecated__anddropped__sincethis__books__prioredition__(breakingmost__examples here!).Apart__fromits__time calls,the__codein__Example 21-1is__straightforwardand__usestools__weve__already met.When__usedon__thisbook__smain__developmentcomputer__usingmacOS__andCPython__3.12,its__resultsare__thesein__a REPL: >>>from__timer0import__timer >>> timer(pow, 2, 1000) #Time__tocall__pow(2, 1000) 100ktimes__0.08591239107772708 >>> timer(str.upper, 'hack' * 100) #Time__tocall__'hack...'.upper() 100ktimes__0.04990812297910452Though__functionaland__simple,the__precedingtimer__isalso__fairly limited,and__deliberatelyexhibits__someclassic__mistakesin__bothfunction__designand__benchmarking.Among__these, it:Hardcodes__therepetitions__countat__100kCharges__thecost__ofrange__tothe__testedfunction__stime__Doesnt__supportkeyword__argumentsin__thetested__functionDoesn__tgive__callersa__wayto__verifythat__thetested__functionactually__workedOnly__givestotal__time,which__mightfluctuate__onsome__busyhost__machinesIn__other words,timing__codeis__morecomplex__thanyou__might expect!Timer__Module:Take__2To__bemore__generaland__accurate,let__srewrite__thepreceding__sections__codeto__definestill__simplebut__moreuseful__timerutility__functionswe__canboth__useto__seehow__iterationalternative__optionsstack__up now,and__applyto__othertiming__needsin__the future.These__functions,in__Example 21-2,are__codedin__amodule__fileagain__sothey__canbe__usedin__avariety__of programs,and__havedocstrings__givingsome__basicusage__detailsthat__helpand__PyDoccan__display;see__Chapter 15for__tipson__viewingthe__in-codedocumentation__ofthis__chapters__timing modules.Example__21-2. timer.py """Homegrown__timingtools__forarbitrary__function calls.Times__one call,total__of N,best__of N,and__bestof__totalsof__N.Pass__anynumber__ofpositional__andkeyword__argumentsfor__each func. """import__timetimer__= time.perf_counter #See__also time.process_time()def__once(func, *pargs, **kargs): #Collect__argumentsfor__func """Time__torun__func(...)one__time.Returns__(time, result). """start__= timer()result__= func(*pargs, **kargs) #Unpack__argumentsfor__funcelapsed__= timer() -start__return (elapsed, result) #Return__resultto__verifydef__total(reps, func, *pargs, **kargs): #Collect__argumentsfor__func """Total__timeto__run func(...)reps__times.Returns__(total-time, last-result). """total__= 0 # Don'tcharge__range()time__fori__in range(reps): time,result__= once(func, *pargs, **kargs)total__+=time__return (total, result) #Return__lastresult__toverify__def bestof(reps, func, *pargs, **kargs): """Best__timeamong__repsruns__of func(...).Returns__(best-time, best-time-result). """return__min(once(func, *pargs, **kargs)for__iin__range(reps))def__bestoftotal(reps1, reps2, func, *pargs, **kargs): """Best__totaltime__among reps1runs__of [reps2runs__of func(...)].Returns__(best-total-time, best-total-time-last-result). """return__min(total(reps2, func, *pargs, **kargs)for__iin__range(reps1)) Operationally,this__moduleimplements__bothtotal__andbest__times,and__abest__oftotals__thatcombines__theother__two.In__each mode,it__timescalls__toany__subjectfunction__thattakes__anypositional__andkeyword__arguments,by__fetchingthe__start time,calling__thefunction__witharbitrary__arguments,and__subtractingthe__starttime__fromthe__stop time.Here__arethe__salientpoints__tonotice__abouthow__thisversion__addressesthe__shortcomingsof__its predecessor:The__repetitionscount__isno__longer hardcoded,but__passedin__asa__requiredargument__(or arguments)before__thetest__functionand__itsown__arguments,to__allowrepetitions__tovary__per call.The__rangecall__sconstruction__anditeration__costsare__nolonger__chargedto__timed functions,because__timinghas__beenfactored__outto__theseparate__oncefunction__thattimes__justthe__subject function.Any__numberof__bothpositional__andkeyword__argumentsfor__thetimed__functionare__nowcollected__andunpacked__with starred-argument syntax.They__mustbe__sent individually,not__ina__sequenceor__dictionary,though__callerscan__unpackargument__collectionsinto__individualarguments__withstars__inthe__top-level call.All__functionsin__thismodule__returnone__ofthe__timedfunction__sreturn__valuesso__callerscan__verifythat__thefunction__worked.The__returnvalue__isprovided__ina__two-itemresult__tuple,along__withthe__requestedtime__result.New__best-ofmodes__returnminimum__timesto__addressfluctuations__onthe__host device,per__thenext__paragraph.This__versions__functionsalso__supportmultiple__use cases:once__timesa__singlecall__forsimple__cases;total__runsmany__calls,to__allowtime__toaccumulate__for short-lived__functions;bestof__returnsthe__minimumtime__amongall__single calls,to__filterout__theimpacts__ofother__activityon__the host;and__bestoftotalselects__theminimum__ofnested__total-time tests,to__bothapply__a best-offilter__andrun__manycalls__forfunctions__toofast__toproduce__meaningful times. Importantly,the__mincalls__inthe__best-ofvariants__workto__selectthe__bestand__lowest time,because__Pythoncompares__collectionsrecursively__(fromleft__to right)as__weve__learned,and__resulttuples__beginwith__time:because__its__firstin__these (time, result) tuples,time__dominatesand__determinesthe__mincalls__results: >>> min(tupfor__tupin__[(2.0, 3), (3.0, 3), (1.0, 3), (0.0, 3), (4.0, 3)]) (0.0, 3)From__alarger__perspective,because__thesefunctions__arecoded__ina__module file,they__becomegenerally__usefultools__anywherewe__wishto__import them.Modules__andimports__wereintroduced__inChapter__3,and__youll__learnmore__aboutthem__inthe__nextpart__ofthis__book;for__now,simply__importthe__moduleand__callits__functionto__useone__ofthis__files__timers.Its__resultson__thesame__hostand__ina__REPLare__similarto__its timer0.py predecessor,but__aremore__robust: >>>import__timer #Import__filein__thisdirectory__>>> help(timer) #Display__module'sdocs__nicely >>> reps,text__= 100_000, 'hack' * 100 >>> timer.once(pow, 2, 1000)[0] #Not__usefulfor__fastcalls__6.182119250297546e-06 >>> timer.once(str.upper, text) # (time, result) (3.363005816936493e-06, 'HACKHACKHACKetc__') >>> timer.total(reps, pow, 2, 1000)[0] #Compare__to timer0results__0.08979405369609594 >>> timer.total(reps, str.upper, text)[0] # (time,last__call's result) 0.050884191412478685 >>> timer.bestof(50, pow, 2, 1000)[0] #Not__usefulfor__fastcalls__1.6265548765659332e-06 >>> timer.bestof(50, str.upper, text)[0] # (best time,best__time result) 8.619390428066254e-07 >>> timer.bestoftotal(50, reps, pow, 2, 1000)[0] 0.07521858718246222 >>> timer.bestoftotal(50, reps, str.upper, text)[0] 0.03947464330121875The__lasttwo__callshere__calculatethe__best-of-totalstimes__thelowest__timeamong__50 runs,each__ofwhich__computesthe__totaltime__tocall__afunction__100ktimes__roughlycorresponding__tothe__totaltimes__earlierin__this listing,but__repeatedfor__aminimum__thatfilters__outhost__fluctuations (andsans__anextra__chargefor__range).The__functionused__inthese__lasttwo__callsis__reallyjust__aconvenience__thatwraps__totalfor__better accuracy,but__thisis__acommon__timing mode.Note__thatbestoftotal__mightreplace__itsmin__oftotal__withcode__likethe__followingto__nesttotal__in bestof: >>> timer.bestof(50, timer.total, reps, str.upper, text) (0.07037258706986904, (0.039281503297388554, 'HACKHACKHACKetc__'))But__thisisn__tquite__the same.For__one thing,the__resultis__nested tuples,reflecting__thenested__calls.For__another,this__reallytimes__theentire__total function,not__justthe__subjectfunction__it runs.The__neteffect__chargesan__extra admin-codeoverhead__thats__enoughto__skewthe__best-oftime__up,and__makeit__largerthan__thebest__totaltime__shownin__thenested__tuple.By__usingmin__oftotal__instead,bestoftotal__avoidstiming__thisoverhead__skew.Subtle__but true!Timing__Runnerand__Script Now,to__timeiteration__toolspeed__(ouroriginal__goal),we__llwrite__ascript__thatdefines__andsubmits__testfunctions__tothe__timer module.To__makeit__easyto__codea__varietyof__tests,let__sfirst__definea__utilitymodule__thatdoes__theheavy__liftingas__areusable__intermediary.Example__21-3defines__afunction__namedrunner__thattakes__anynumber__oftest__functionsas__argumentsand__passesthem__offfor__timingto__thebestoftotal__functionimported__fromExample__21-2.Example__21-3. timer_runner.py "Run passed-intest__functionswith__the timer.py module"import__timer,sys__def runner(*tests):results__= [] print('Python', sys.version.split()[0], 'on', sys.platform) #Time__fortest__in tests: besttime,result__= timer.bestoftotal(10, 1000, test) results.append(result) print(f'{test.__name__:<9}: ' f'{besttime:.5f} => [{result[0]} {result[-1]}]') #Verify__print('Results differ!'if__any(result != results[0]for__resultin__results[1:])else__'Allresults__same.')Fine__points here:this__modules__runnerfunction__displayscontext__withsys__toolsdocumented__inPython__s manuals,and__stepsthrough__allthe__passed-in functions,printing__the__name____ofeach__(aswe__ve seen,this__isa__built-inattribute__thatgives__afunction__s name).The__test-runnercode__alsosaves__resultsto__verifythat__theyare__allthe__samein__aternary__expressionat__thevery__endof__the process,to__besure__were__comparingapples__to apples.Last__butnot__least,the__scriptin__Example 21-4defines__theactual__teststo__betimed__andpasses__themto__theimported__runnerof__Example 21-3,which__handsthem__offto__theimported__timerof__Example 21-2.We__llrun__thefile__inExample__21-4as__a top-levelscript__totime__therelative__speedsof__thevarious__iterationcodings__weve__studiedin__thisbook__so far.Example__21-4. timer_tests.py "Testthe__relativespeed__ofiteration__coding alternatives."from__timer_runnerimport__runnerrepslist__= list(range(10_000))def__forLoop():res__= []for__xin__repslist: res.append(abs(x))return__resdef__listComp():return__[abs(x)for__xin__repslist]def__mapCall():return__list(map(abs, repslist)) #Use__list()to__forceresults__def genExpr():return__list(abs(x)for__xin__repslist) #Use__list()to__forceresults__def genFunc():def__gen():for__xin__repslist:yield__abs(x)return__list(gen()) #Use__list()to__forceresults__runner(forLoop, listComp, mapCall, genExpr, genFunc)This__scripttests__fivealternative__waysto__buildlists__of results.In__combinationwith__thetest__runner,its__reportedtimes__reflectsome__100million__stepsfor__eachof__the 5test__functionseach__buildsa__listof__10,000items__1,000 times,and__thisprocess__isrepeated__10times__toget__the best-of times.Applying__thisfor__eachof__the 5test__functionsyields__awhopping__500million__totalsteps__forthe__scriptat__large (impressivebut__reasonableon__mostmachines__these days).Notice__howwe__haveto__runthe__resultsof__thegenerator__expressionand__functionthrough__the built-inlist__callto__forcethem__toyield__allof__their values;if__wedid__not,we__wouldjust__producegenerators__thatnever__doany__real work.We__mustdo__thesame__forthe__map result,since__itis__an iterable, on-demandobject__as well.For__similar reasons,the__innerloops__rangeresult__ishoisted__outto__thetop__ofthe__moduleto__removeits__constructioncost__fromtotal__time,and__wrappedin__alist__callso__thatits__traversalcost__isnt__skewedby__beinga__generator.This__maybe__overshadowedby__thecost__ofthe__inneriterations__loops,but__its__bestto__removeas__manyvariables__aswe__can.For__example,though__rangesupports__multiple scans,tests__timesinflate__bysome__25%if__itslist__wrapperis__removed.Iteration__ResultsWhen__the top-levelscript__ofthe__priorsection__isrun__underthe__standardCPython__3.12on__thesame__macOS host,it__printsthe__followingwith__totaltimes__inseconds__aftercueing__thedrum__roll,that__is: $ python3 timer_tests.pyPython__3.12.2on__darwinforLoop__: 0.26035 => [0...9999]listComp__: 0.20781 => [0...9999]mapCall__: 0.14399 => [0...9999]genExpr__: 0.41133 => [0...9999]genFunc__: 0.41203 => [0...9999]All__results same.In__short,map__callsare__fasterthan__list comprehensions,which__arequicker__thanfor__loops,and__bothgenerator__expressionsand__functionscome__inlast__androughly__tiedfor__slowest.Perhaps__surprisingly,generator__expressionsrun__muchslower__thanequivalent__listcomprehensions__today.As__warnedin__theprior__chapter,although__wrappinga__generatorexpression__ina__listcall__makesit__functionallyequivalent__toa__list comprehension,the__internalimplementations__ofthe__twoexpressions__appearto__differ:return__[abs(x)for__xin__repslist] # 0.20seconds__return list(abs(x)for__xin__repslist) # 0.41 seconds:differs__internallyWe__realso__effectivelytiming__thelist__callfor__thegenerator__test,but__giventhat__thisdoes__notseem__tohamper__map,it__slikely__moot.Though__theexact__causefor__thedifference__wouldrequire__deeperanalysis__(andprobably__sourcecode__spelunking),this__seemsto__makesense__giventhat__thegenerator__expressionmust__doextra__workto__saveand__restoreits__stateduring__value production;the__listcomprehension__does not,and__runsquicker__hereand__inother__tests ahead.Other__Pythonsresults__For comparison,following__arethe__sametests__speedresults__onthe__samehost__usingthe__currentPyPy__theoptimized__Pythonimplementation__discussedin__Chapter 2,whose__current 7.3release__implementsthe__Python 3.10 language.PyPy__isroughly__5Xquicker__thanCPython__here (andup__to 10X),though__itstiming__resultscan__varywidely__ifits__JIThas__notyet__compiledcode__infull__(anda__futureand__currentlyhypothetical__CPythonJIT__mayor__maynot__eventhe__race): $ pypy3 timer_tests.pyPython__3.10.14on__darwinforLoop__: 0.04329 => [0...9999]listComp__: 0.01876 => [0...9999]mapCall__: 0.04132 => [0...9999]genExpr__: 0.08744 => [0...9999]genFunc__: 0.08726 => [0...9999]All__results same.On__PyPy alone,list__comprehensionswin__thetitle__inthis__test today,but__generatorsstill__lose soundly,and__thefact__thatall__ofPyPy__sresults__areso__muchquicker__todayseems__thelarger__point here.On__CPython,map__isstill__quickestso__far. Interestingly,these__resultsare__verydifferent__thanthey__werein__thisbook__sprior__editionon__Windowsunder__CPython 3.3when__generatorsplaced__inthe__middleof__thepack__betweenlist__comprehensionsand__for loops,for__loopsfared__substantiallyworse__thanthey__do today,and__thescript__hada__differentname__forhistorical__reasons: C:\code> c:\python33\python timeseqs.py 3.3.0 (v3.3.0:bd8afb90ebf2,Sep__29 2012, 10:57:17) [MSC v.1600 64bit__(AMD64)]forLoop__: 1.33290 => [0...9999]listComp__: 0.69658 => [0...9999]mapCall__: 0.56483 => [0...9999]genExpr__: 1.08457 => [0...9999]genFunc__: 1.07623 => [0...9999]While__theseabsolute__timesnaturally__reflectolder__andslower__test hosts,these__toolsrelative__performancehas__clearlychanged__inthe__last 12years__andprobably__shouldbe__expectedto__doso__againin__another dozen!For__moregood__times:Function__callsand__mapAll__ofthe__foregoingis__trueas__advertised,but__watchwhat__happenswhen__Example 21-5performs__aninline__operationon__each iteration,such__asa__+ expression,instead__ofcalling__a built-infunction__like abs.Only__thetest__functionsoperations__(in bold)need__tobe__modified here,and__theimported__andreused__runnerhandles__tests generically.Example__21-5. timer_tests2.pyfrom__timer_runnerimport__runnerrepslist__= list(range(10_000))def__forLoop():res__= []for__xin__repslist: res.append(x + 10)return__resdef__listComp():return__[x + 10for__xin__repslist]def__mapCall():return__list(map((lambda x:x__+ 10), repslist))def__genExpr():return__list(x + 10for__xin__repslist)def__genFunc():def__gen():for__xin__repslist:yield__x + 10return__list(gen()) runner(forLoop, listComp, mapCall, genExpr, genFunc) Now,map__isslower__thanthe__forloop__statements,despite__thefact__thatthe__looping-statementsversion__islarger__interms__of code.This__couldeither__meanthat__theneed__tocall__a user-definedfunction__makesmap__sloweror__equivalently,that__thelack__offunction__callsmakes__theothers__quicker.On__CPython 3.12and__thesame__hostas__before: $ python3 timer_tests2.pyPython__3.12.2on__darwinforLoop__: 0.28682 => [10...10009]listComp__: 0.24389 => [10...10009]mapCall__: 0.49622 => [10...10009]genExpr__: 0.44047 => [10...10009]genFunc__: 0.44476 => [10...10009]All__results same.These__resultshave__alsobeen__consistentin__CPython:the__prioredition__sPython__3.3results__ona__slowermachine__wereagain__relatively similar,discounting__testmachine__differences.Because__theinterpreter__optimizesso__much internally,performance__analysisof__Pythoncode__likethis__isa__verytricky__affair.Without__numbers,it__svirtually__impossibleto__guesswhich__methodwill__performthe__best; again,the__bestyou__cando__istime__yourcode__withyour__test parameters.In__this case,what__wecan__sayis__thaton__this Python,using__a user-definedlambda__functionin__mapcalls__seemsto__slowits__performancedisproportionately__(though +is__alsoslower__thana__trivialabs__acrossthe__board),and__thatlist__comprehensionsrun__quickestin__thiscase__(thoughslower__thanmap__insome__others).List__comprehensionsseem__consistentlyfaster__thanfor__loops,but__eventhis__mustbe__qualifiedthe__listcomprehension__srelative__speedmight__beaffected__byits__extrasyntax__(e.g.,if__filters),Python__changes,and__usagemodes__wedid__nottime__here.For__deeper truth,Example__21-6codes__onelast__takeoffon__ourtests__toapply__asimple__user-definedfunction__inall__fiveiterations__timed. Again,we__mustonly__modifythe__relevant (and bold)bits__ofthe__testfunctions__themselves.Example__21-6. timer_tests3.pyfrom__timer_runnerimport__runnerrepslist__= list(range(10_000))def__F(x):return__xdef__forLoop():res__= []for__xin__repslist: res.append(F(x))return__resdef__listComp():return__[F(x)for__xin__repslist]def__mapCall():return__list(map(F, repslist))def__genExpr():return__list(F(x)for__xin__repslist)def__genFunc():def__gen():for__xin__repslist:yield__F(x)return__list(gen()) runner(forLoop, listComp, mapCall, genExpr, genFunc)When__codedthis__wayand__runin__CPython 3.12on__thesame__host again,map__improvesits__relative times,and__comesin__secondbetween__listcomprehensions__andfor__loopsinstead__ofbeing__slowerthan__allothers__asit__wasfor__+: $ python3 timer_tests3.pyPython__3.12.2on__darwinforLoop__: 0.36206 => [0...9999]listComp__: 0.31181 => [0...9999]mapCall__: 0.35479 => [0...9999]genExpr__: 0.50531 => [0...9999]genFunc__: 0.50290 => [0...9999]All__results same.That__is,map__maybe__slowersimply__becauseit__requiresfunction__calls,and__functioncalls__arerelatively__slowin__general.Since__mapcan__tavoid__calling functions,it__maylose__by association,and__theother__iterationtools__maywin__whenthey__canuse__expressions instead.On__theother__hand,this__hypothesisalone__cant__explainthe__bettershowing__formap__inthe__absresults__ofthe__first timer_tests.py:calling__built-infunctions__maybe__aspecial__andfast__casefor__mapin__CPython (atheory__supportedby__Conclusion:Comparing__toolsand__ordat__theend__ofthis__chapters__benchmarking safari).All__thisbeing__said,performance__shouldnot__beyour__primaryconcern__whenwriting__Pythoncode__thefirst__thingyou__shoulddo__tooptimize__Pythoncode__isto__notoptimize__Python code!Write__forreadability__andsimplicity__first,then__optimize later,if__andonly__if needed.It__couldvery__wellbe__thatany__ofthe__fiveiteration__alternativeswe__vetimed__isquick__enoughfor__thedata__setsyour__programneeds__to process;if__so,program__clarityshould__bethe__chief goal.More__ModuleMods__Our timer.pymodule__worksas__designed,but__itcould__bea__bitmore__user-friendly.Most__obviously,its__functionsrequire__passingin__repetitioncounts__asfirst__arguments,and__provideno__defaultsfor__thema__minor point, perhaps,but__lessthan__idealin__a general-purpose tool.To__do better,it__couldallow__repetitioncounts__tobe__passedin__askeyword__argumentswith__defaults,much__thesame__waywe__didfor__theprint__emulatorsof__Chapter 18. Here, though,these__argumentsnames__wouldhave__tobe__distinctto__avoidclashing__withthose__ofthe__timedfunction__(e.g.,_reps__insteadof__reps).While__were__at it,the__functionobject__couldalso__bea__positional-onlyargument__toprevent__namefunc__fromclashing__witha__keywordargument__ofthe__samename__inthe__timed subject.Example__21-7codes__therequired__mods (sansdocs__for space).Review__Chapter 18s__argument-orderingcoverage__formore__insight.Example__21-7. timer2.py "Use keyword-onlyarguments__withdefaults__for reps,and__positional-onlyfor__func."import__timetimer__= time.perf_counterdef__once(func, /, *pargs, **kargs):start__= timer()result__= func(*pargs, **kargs)elapsed__= timer() -start__return (elapsed, result)def__total(func, /, *pargs, _reps=100_000, **kargs):total__= 0for__iin__range(_reps): time,result__= once(func, *pargs, **kargs)total__+=time__return (total, result)def__bestof(func, /, *pargs, _reps=5, **kargs):return__min(once(func, *pargs, **kargs)for__iin__range(_reps))def__bestoftotal(func, /, *pargs, _reps1=50, **kargs):return__min(total(func, *pargs, **kargs)for__iin__range(_reps1)) #_reps__=> **This__versionis__notbackward__compatible:it__usesdifferent__namesand__modesfor__repetition arguments,which__meansthe__timer_runner.pywe__wroteearlier__wouldrequire__aminor__editto__useit__(seethe__examplespackage__s timer2_*.py). Otherwise,it__worksthe__samecompare__itsoutput__onthe__samehost__with timer.pys__resultslisted__atExample__21-2: $ python3 >>>import__timer2 >>> timer2.total(pow, 2, 1000, _reps=100_000)[0] 0.0865794476121664 >>> timer2.total(str.upper, 'hack' * 100, _reps=100_000)[0] 0.04620114527642727 >>> timer2.bestoftotal(pow, 2, 1000, _reps1=50, _reps=100_000)[0] 0.07179990829899907 >>> timer2.bestoftotal(str.upper, 'hack' * 100, _reps1=50, _reps=100_000)[0] 0.0393348871730268This__time, though,we__canallow__thefunctions__repetitiondefaults__toapply__or not: >>> timer2.total(str.upper, 'hack' * 100)[0] 0.047992002684623 >>> timer2.bestoftotal(str.upper, 'hack' * 100)[0] 0.03935634717345238 >>> timer2.bestoftotal(str.upper, 'hack' * 100, _reps=10_000)[0] 0.00393257150426507Notice__howthe___repsargument__for total,if__passed,in__bestoftotalcalls__ispropagated__alongin__**kargsbecause__its__notmatched__otherwise.For__morevetting__of this,time__user-definedfunctions__withricher__argumentheaders__asin__the following.Per__thefirst__four timings,passing__keywordarguments__toa__timedfunction__addsa__smalltime__costfor__unpackingan__unavoidableoverhead__sharedby__theoriginal__timer.py,but__irrelevantwhen__collectingrelative__times: >>>def__f(a, b, c=88, d=99): return(a, b, c, d) >>> f(1, 2) (1, 2, 88, 99) >>> timer2.bestoftotal(f, 1, 2, _reps1=50, _reps=100_000) (0.014080120716243982, (1, 2, 88, 99)) >>> timer2.bestoftotal(f, 1, 2, c=66, d=77, _reps1=50, _reps=100_000) (0.021575820166617632, (1, 2, 66, 77)) >>> timer2.bestoftotal(f, 1, 2, c=66, d=77, _reps1=50) (0.021694606635719538, (1, 2, 66, 77)) >>> timer2.bestoftotal(f, 1, 2, c=66, d=77, _reps=100_000) (0.021556788589805365, (1, 2, 66, 77)) >>>def__f(a, *b, c=88, **d): return(a, b, c, d) >>> f(1, 2, 3, c=66, d=77, e=88) (1, (2, 3), 66, {'d': 77, 'e': 88}) >>> timer2.bestoftotal(f, 1, 2, 3, c=66, d=77, e=88) (0.030859854072332382, (1, (2, 3), 66, {'d': 77, 'e': 88})) >>> timer2.bestoftotal(f, 1, 2, 3, c=66, d=77, e=88, _reps1=10) (0.030802161898463964, (1, (2, 3), 66, {'d': 77, 'e': 88})) >>> timer2.bestoftotal(f, 1, 2, 3, c=66, d=77, e=88, _reps=10_000) (0.0030745575204491615, (1, (2, 3), 66, {'d': 77, 'e': 88}))Beyond__this,custom__benchmarkingcode__isfun__butopen__ended,and__thissection__muststop__herefor__space.As__next steps,you__mightmodify__thetiming__scriptto__measurethe__speedof__setand__dictionarycomprehensions__andtheir__forequivalents__(openquestions__well__returnto__ahead);explore__Pythons__profileand__cProfilemodules__(toolsthat__create full-programprofiles__insteadof__focused benchmarks);or__explorePython__stimeit__module,which__worksmuch__likesome__ofthis__chapters__homegrown code,and__offersextra__optionsas__youll__learnin__thenext__section.NOTE__Decoratortimers__preview:Notice__howwe__mustpass__functionsinto__thetimers__manually here.In__Chapter 39,we__llcode__decorator-basedtimer__alternativeswith__whichtimed__functionsare__called normally,but__requireextra__@preamble__syntaxwhere__defined.Decorators__maybe__moreuseful__toinstrument__functionswith__timinglogic__whenthey__arealready__beingused__withina__larger system,and__dont__aseasily__supportthe__specific test-callpatterns__assumedhere__when decorated,every__callto__thefunction__runsthe__timing logic,which__iseither__aplus__orminus__dependingon__your goals.Benchmarking__withPython__stimeit__Thepreceding__sectionused__customtiming__functionsto__comparecode__speed.As__teased there,the__Pythonstandard__libraryalso__shipswith__amodule__namedtimeit__thatcan__beused__insimilar__ways,but__offersadded__flexibility,with__supportfor__timingcode__stringsin__additionto__functions,as__wellas__a command-line mode.As__usualin__Python,it__simportant__tounderstand__fundamentalprinciples__likethose__illustratedin__theprior__section.Python__sbatteries__includedapproach__meansyou__llusually__findprecoded__optionsfor__most goals,though__youstill__needto__knowthe__ideasunderlying__themto__chooseand__usethem__properly. Indeed,the__timeitmodule__isa__primeexample__ofthis__its__hada__historyof__beingmisused__bynewcomers__whodidn__tyet__understandthe__conceptsit__embodies.Now__thatwe__velearned__the basics, though,let__smove__aheadto__atool__thatcan__automatemuch__ofour__work.Basic__timeitUsage__Lets__startwith__thismodule__sfundamentals__beforeleveraging__themin__larger scripts.With__timeit,tests__arespecified__byeither__callableobjects__orstatement__strings;the__lattercan__holdmultiple__statementsif__theyuse__;separators__or \ncharacters__forline__breaks,and__spacesor__tabsto__indentstatements__innested__blocks (e.g., \n\t).Tests__mayalso__givesetup__actions,and__canbe__launchedfrom__bothcommand__linesand__API calls,and__fromboth__scriptsand__the REPL. API-callsmode__For example,the__timeitmodule__srepeat__callreturns__alist__givingthe__totaltime__takento__runa__testa__numberof__times,for__eachof__repeatruns__themin__ofthis__listyields__thebest__timeamong__the runs,and__helpsfilter__outsystem__loadfluctuations__thatcan__otherwiseskew__timingresults__artificiallyhigh__(likeour__earlier bestoftotal).Code__tobe__timedis__passedto__thestmt__keyword (orfirst__positional) argument,and__maybe__astring__or no-argument function.The__followingshows__thiscall__inaction__inREPLs__on macOS,timing__alist__comprehensionon__bothCPython__3.12and__theoptimized__PyPyimplementation__ofPython__describedin__Chapter 2 (as earlier,its__tested 7.3release__implementsthe__Python 3.10 language).The__resultshere__givethe__besttotal__timein__secondsamong__5runs__thateach__executethe__codestring__1,000 times;the__codestring__itselfconstructs__a 1,000-itemlist__ofintegers__eachtime__through (timeitalso__hasreasonable__defaultsfor__repeat counts,but__beingexplicit__ensures comparability): $ python3 >>>import__timeit >>> min(timeit.repeat(stmt='[x ** 2for__xin__range(1000)]', number=1000, repeat=5)) 0.05187674192711711 $ pypy3 >>>>import__timeit >>>> min(timeit.repeat(stmt='[x ** 2for__xin__range(1000)]', number=1000, repeat=5)) 0.00252467580139637You__llnotice__thatPyPy__checksin__at 20Xfaster__thanCPython__3.12.This__isa__smallartificial__benchmark,of__course,but__stunning nonetheless,and__reflectsa__relativespeed__rankingthat__isgenerally__supportedby__othertests__runin__thisbook__(thoughCPython__willstill__beatPyPy__onsome__typesof__code ahead,and__again,may__improvewith__afuture__JIT).To__be fair,this__particulartest__measuresthe__speedof__botha__listcomprehension__andinteger__math,but__integermath__isubiquitous__inPython__code,and__PyPys__winis__largeron__nonintegertests__(trysquaring__afloat__tosee__for yourself).These__resultsalso__differfrom__thepreceding__sections__relativeversion__speeds,where__PyPywas__some 10Xquicker__forlist__comprehensions.Apart__fromthe__differenttype__ofcode__beingtimed__here,the__differentcoding__structureinside__timeitmay__havean__effecttoo__forcode__stringslike__thosetested__here,timeit__builds, compiles,and__executesa__functiondef__statementstring__thatembeds__thetest__string,thereby__avoidinga__functioncall__perinner__loop.This__isirrelevant__froma__relative-speed perspective, though:times__fromthe__samegiven__toolare__comparable.You__llalso__noticethat__codeto__betimed__isa__string here.As__youll__see ahead,this__requiresmanually__codedline__breaksand__indentationin__someusage__modes,and__allcode__tobe__timedthis__waymust__conformto__Pythons__rulesfor__string literals, quotes,and__escapes.For__instance,a__codestring__cannotembed__thesame__quotesused__toenclose__itwithout__alsoescaping__them.You__canavoid__thispotential__downsideby__timing callables,though__theyre__limitedto__zero arguments. Command-linemode__Thetimeit__modulealso__canbe__runas__ascript__froma__commandline__eitherby__explicit pathname, or,more__portably,automatically__locatedon__themodule__searchpath__withPython__sm__switch (weused__thisearlier__tolaunch__PyDocin__Chapter 15and__IDLEin__Chapter 3).In__this mode,you__llneed__toquote__orescape__Pythoncode__inthe__commandline__peryour__consoleshell__s rules;double__quotesare__generally portable,but__thisalso__qualifiesas__apotential__downside.Also__inthis__mode,timeit__reportsthe__averagetime__fora__singlen__loop,in__eitherusec__microseconds (millionths),msec__milliseconds (thousandths),sec__seconds,or__nsec nanoseconds;to__compareresults__hereto__thetotal__timevalues__reportedby__API calls,multiply__bythe__numberof__loopsrun__51usec__here * 1,000loops__is 51k usec, 51 msec,and__0.051seconds__intotal__time.For__CPython 3.12on__macOS: $ python3 -mtimeit__-n 1000 "[x ** 2for__xin__range(1000)]" 1000 loops,best__of 5: 51.9usec__perloop__$ python3 -mtimeit__-n 1000 -r 50 "[x ** 2for__xin__range(1000)]" 1000 loops,best__of 50: 51.8usec__perloop__Asanother__example,we__canuse__commandlines__toverify__thatchoice__oftimer__calldoesn__timpact__speedcomparisons__runin__thischapter__so far.timeit__uses time.perf_counterby__defaultbut__its -pflag__instructsit__toinstead__use time.process_time,both__discussedearlier__(spoiler:as__tested,there__sno__discernible difference): $ python3 -mtimeit__-p -n 1000 -r 50 "[x ** 2for__xin__range(1000)]" 1000 loops,best__of 50: 51.8usec__perloop__Wecan__alsouse__timeitto__seehow__PyPystacks__upagain__butwe__rein__fora__bitof__a surprise: $ pypy3 -mtimeit__-n 1000 -r 50 "[x ** 2for__xin__range(1000)]" WARNING:timeit__isa__veryunreliable__tool.use__pyperfor__somethingelse__forreal__measurements pypy3 -mpip__installpyperf__pypy3 -mpyperf__timeit -n '1000' -r '50' '[x ** 2for__xin__range(1000)]' ------------------------------------------------------------ 1000 loops,average__of 50: 1.54 +- 0.568usec__perloop__(usingstandard__deviation)As__youcan__see,PyPy__hascustomized__command-linemode__inits__versionof__timeitto__bothemit__asubjective__redirectto__analternative__timer,as__wellas__modifythe__resultdisplay__toshow__averagesinstead__of minimums.These__areboth__opinionatedmods__madesince__thisbook__sprior__edition,though__perhapsunderstandable__fora__toolso__focusedon__(andsensitive__to)benchmark__results.See__theweb__formore__onthe__suggested pyperf;it__snot__partof__Pythons__standardlibrary__andrequires__aseparate__install,but__mayoffer__moreadvanced__timingoptions__thatmay__ormay__notapply__toyour__goals.Handling__multilinestatements__Happily,timeit__sAPI__modeis__still opinion-free today.To__timelarger__blocksof__codein__API-call mode,either__loadcode__froma__file,use__a triple-quotedblock__string,or__usenewlines__andtabs__orspaces__tosatisfy__Pythons__syntax.Because__youpass__Pythonstring__objectsto__aPython__functionin__this mode,there__areno__shell considerations,though__becareful__tohandle__nestedquotes__withescapes__ormixed__quotesif__needed.The__following,for__instance,times__Chapter 13loop__alternativesin__CPython 3.12;you__canuse__thesame__patternto__timethe__file-line-reader__alternativesin__Chapter 14: $ python3 >>>import__timeit >>> min(timeit.repeat(number=100_000, repeat=5, stmt='L = [1, 2, 3, 4, 5]\nfori__in range(len(L)): L[i] += 1')) 0.028153221122920513 >>> min(timeit.repeat(number=100_000, repeat=5, stmt='L = [1, 2, 3, 4, 5]\ni=0\nwhilei__< len(L):\n\tL[i] += 1\n\ti += 1')) 0.03337613819167018 >>> min(timeit.repeat(number=100_000, repeat=5, stmt='L = [1, 2, 3, 4, 5]\nM = [x + 1for__xin__L]')) 0.021507765166461468To__runmultiline__statementslike__thesein__command-line mode,appease__yourshell__bypassing__eachstatement__lineas__aseparate__argument,with__whitespacefor__indentationtimeit__concatenatesall__thelines__togetherwith__anewline__characterbetween__them,and__later re-indentsfor__itsown__statement-nesting purposes.Leading__spacesmay__workbetter__forindentation__thantabs__inthis__modedue__toshell__variability,and__besure__toquote__thecode__argumentsif__requiredby__yourshell__(thefirst__ofthe__followingwas__line-splithere__to fit,but__mustbe__inputon__asingle__linein__some shells): $ python3 -mtimeit__-n 100000 -r 5 "L = [1,2,3,4,5]" "i=0" "whilei__< len(L):" " L[i] += 1" "i__+= 1" 100000 loops,best__of 5: 332nsec__perloop__$ python3 -mtimeit__-n 100000 -r 5 "L = [1,2,3,4,5]" "M = [x + 1for__xin__L]" 100000 loops,best__of 5: 218nsec__perloop__Othertimeit__usagemodes__Thetimeit__modulealso__allowsyou__toprovide__setupcode__thatis__runin__themain__statements__scope,but__whosetime__isnot__chargedto__themain__statements__totaluseful__forinitialization__codeyou__wishto__excludefrom__total time,such__asimports__ofrequired__modulesand__buildsof__test data.Because__theyre__runin__thesame__scope,any__namescreated__bysetup__codeare__availableto__themain__test statement;names__definedin__theinteractive__shellgenerally__are not.To__specifysetup__code,use__as__in command-linemode__(ormany__ofthese__formultiline__setups)and__asetup__argumentstring__in API-call mode.This__canfocus__testsmore__sharply,as__inthe__following,whose__secondcommand__splitslist__initializationoff__toa__setupstatement__totime__justiteration__in command-line mode.As__ageneral__ruleof__thumb, though,the__morecode__youinclude__ina__test statement,the__moreapplicable__itsresults__willgenerally__beto__realistic code: $ python3 -mtimeit__-n 100000 -r 5 "L = [1,2,3,4,5]" "M = [x + 1for__xin__L]" 100000 loops,best__of 5: 211nsec__perloop__$ python3 -mtimeit__-n 100000 -r 5 -s "L = [1,2,3,4,5]" "M = [x + 1for__xin__L]" 100000 loops,best__of 5: 175nsec__perloop__Timingsort__speedTo__demosetup__codein__API-call mode,the__interactionthat__followstimes__a sort-based__optionin__Chapter 18s__minimum-value example.To__avoidpage__flipping,here__sthe__functionit__times,in__themodule__mins.py (Example 18-2):def__min4(*args):return__sorted(args)[0]And__hereare__theresults__provingindirectly__thatsequences__sortmuch__fasterwhen__theyare__orderedthan__theydo__withrandomly__orderedcontents__(tosee__for yourself,run__thisin__Chapter 18s__code folder): >>>from__timeitimport__repeat # Standard-librarymodule__>>> min(repeat(number=1000, repeat=5, #Sort__anordered__listin__min4 setup='frommins__import min4\n' #Adjacent__stringsconcatenated__'vals=list(range(1000))', #Code__within ()spans__lines stmt= 'min4(*vals)')) #First__importprints__output 0.011066518723964691 >>> min(repeat(number=1000, repeat=5, #Sort__arandomly__orderedlist__setup='frommins__import min4\n' 'import random\n' 'vals=[random.random()for__iin__range(1000)]', stmt= 'min4(*vals)')) 0.068130933213979See__Pythons__manualsfor__moreon__therandom__moduleused__hereand__inearlier__chapters,as__wellas__moreon__timeit.Not__shown here,timeit__alsolets__youask__forjust__total time,time__callableobjects__insteadof__strings,use__a class-based API,and__leverageadditional__command-lineswitches__and API-callarguments__wedon__thave__spaceto__cover. Instead,the__nextsection__codesa__timeitutility__thatgoes__beyondmanual__commandlines__andREPL__calls.Automating__timeitBenchmarking__Ratherthan__goinginto__moretimeit__details,let__sstudy__aprogram__thatdeploys__itto__timeboth__codingalternatives__andPython__versions.This__willlet__useasily__definea__setof__teststo__timein__aseparate__file,and__willallow__uscollect__datafrom__multiple Pythons,both__individuallyand__grouped (thoughgrouped__modecomes__withlimits__today,as__youll__see).Benchmark__moduleTo__get started,the__modulefile__inExample__21-8, pybench.py,is__setup__totime__asequence__ofstatements__codedin__scriptsthat__importand__use it,with__eitherthe__Pythonrunning__itscode__orall__Pythonversions__namedin__a list.It__usessome__application-leveltools__described ahead.Because__itmostly__appliesideas__weve__alreadyexplored__andis__amply documented, though,it__slisted__asmostly__self-study__material,and__anexercise__inreading__Python code.Example__21-8. pybench.py r"""Time__thespeed__ofone__ormore__Pythonson__multiple code-stringbenchmarks__with timeit.This__isa__function,to__allowtimed__teststo__vary.It__timesall__codestrings__ina__passed list,in__either: 1)The__Pythonrunning__this script,by__timeitAPI__calls 2)Multiple__Pythonswhose__pathsare__passedin__a list,by__readingthe__outputof__timeitcommand__linesrun__by os.popenthat__use Python's -mswitch__tofind__timeiton__themodule__searchpath__In command-linemode__(2) only,this__replacesall__"in__timedcode__with ',to__avoidclashes__withargument__quoting;splits__multilinestatements__intoone__quotedargument__perline__soall__willbe__run;and__replacesall__\tin__indentationwith__4spaces__for uniformity. Caveats: - Command-linemode__(only)uses__naivequoting__andMAY__FAILif__codeembeds__andrequires__double quotes;quoted__codeis__incompatiblewith__thehost__shell;or__commandlength__exceedsshell__limits. -PyPy__islargely__unusablein__command-linemode__(2) today,as__itsmodified__timeitoutput__inthis__modeis__jarringin__the report. -This__doesnot__(yet?)support__asetup__statementin__any mode:the__timeof__allcode__inthe__teststmt__ischarged__toits__total time.As__fallbackson__fails,use__eitherthis__module's API-callmode__totest__onePython__ata__time,or__thehomegrown__timer.py module. """import__sys, os, time,timeit__defnum, defrep= 1000, 5 #May__varyper__stmtdef__show_context(): """Show__run'scontext__usingan__arguablygratuitous__f-stringthat__failson__3.10PyPy__without "..."for__nested ' quotes. """ print(f"Python {'.'.join(str(x)for__xin__sys.version_info[:3])}" f'on__{sys.platform}' f"at__{time.strftime('%b-%d-%Y, %H:%M:%S')}")def__runner(stmts, pythons=None, tracecmd=False): """Main__logic:run__testsper__inputlists__whichdetermine__usage modes. stmts: [(number?, repeat?, stmt-string)] pythons: None=hostpython__only,or__[python-executable-paths] """ show_context()for__(number, repeat, stmt)in__stmts:number__=number__ordefnum__repeat =repeat__ordefrep__# 0=defaultif__not pythons: #Run__stmton__this python:API__call #No__needto__splitlines__orquote__herebest__= min(timeit.repeat(stmt=stmt, number=number, repeat=repeat)) print(f'{best:.4f} {stmt[:70]!r}') else: #Run__stmton__all pythons:command__line #Split__linesinto__quotedarguments__print('-' * 80) print(repr(stmt)) #show__quotesfor__pythonin__pythons:stmt__= stmt.replace('"', "'") #all__" => 'stmt__= stmt.replace('\t', ' ' * 4) #tab__=>______lines = stmt.split('\n') #line__=>arg__args = ' '.join(f'"{line}"'for__linein__lines) #arg__=> "arg"oscmd__= f'{python} -mtimeit__-n {number} -r {repeat} {args}' print(oscmdif__tracecmdelse__python) print('\t' + os.popen(oscmd).read().rstrip())Benchmark__scriptThis__precedingfile__isreally__onlyhalf__the picture.Testing__scriptsuse__thismodule__s function,passing__inconcrete__thoughvariable__listsof__statementsand__Pythonsto__be tested,as__appropriatefor__theusage__mode desired.For__example,the__scriptin__Example 21-9, pybench_tests.py,tests__ahandful__ofstatements__andPythons__byimporting__andusing__Example 21-8,and__allows command-linearguments__todetermine__partof__its operation:a__testsall__listedPythons__insteadof__just one,and__anadded__ttraces__constructedcommand__linesin__fullso__youcan__seehow__quotes,multiline__statements,and__tabsare__handledper__timeits__command-lineformats__shownearlier__(seeboth__filesdocstrings__formore__details).Example__21-9. pybench_tests.py """Run__pybench.pyto__timeone__ormore__Pythonson__multiplecode__strings.Use__command-linearguments__(whichappear__in sys.argv)to__select modes: pybench_tests.pytimes__justthe__hostingPython__onall__codelisted__instmts__below python3 pybench_tests.py -atimes__allstmts__inall__pythonswhose__pathsare__listedbelow__python3 pybench_tests.py -a -tsame__as -a,but__alsotraces__commandlines__infull__Editstms__belowto__changetested__code,and__editpythons__belowto__givepaths__ofPython__executablesto__betested__in -a mode.To__finda__Python's path,start__its REPL,run__"import sys",and__inspect "sys.executable". """import__pybench,sys__pythons = [ '/Library/Frameworks/Python.framework/Versions/3.12/bin/python3', '/Users/me/Downloads/pypy3.10-v7.3.16-macos_x86_64/bin/pypy3', ]stmts__= [ #Iterations__(0, 0, '[x ** 2for__xin__range(1000)]'), # (num,rpt,stmt) (0, 0, 'res=[]\nforx__in range(1000): res.append(x ** 2)'), # \n=multistmt (0, 0, 'list(map(lambda x:x__** 2, range(1000)))'), # \n\t=indent (0, 0, 'list(x ** 2for__xin__range(1000))'), #String__ops (0, 0, "s = 'hack' * 2500\nx = [s[i]for__iin__range(10_000)]"), (0, 0, "s = '?'\nfori__in range(10_000):s__+= '?'"), #A__PyPy loss! ]tracecmd__= '-t'in__sys.argv # -t:trace__command lines?pythons__=pythons__if '-a'in__sys.argvelse__None # -a:all__in list,else__one? pybench.runner(stmts, pythons, tracecmd) #Time__pythonson__allstmts__Timingindividual__PythonsThe__followingis__thepreceding__scripts__outputwhen__runto__testa__specificPython__theone__runningthe__script.This__modeuses__directtimeit__API calls,not__command lines,with__totaltime__listedin__theleft__column,the__statementtested__quotedon__the right,and__acontext__lineat__thetop__courtesyof__Pythons__sysand__timemodules__(seeits__manualsfor__more info).These__tworuns__againuse__CPython 3.12and__PyPy 7.3 (i.e., 3.10), respectively,on__thesame__host: $ python3 pybench_tests.pyPython__3.12.2on__darwinat__Jun-27-2024, 15:21:02 0.0533 '[x ** 2for__xin__range(1000)]' 0.0605 'res=[]\nforx__in range(1000): res.append(x ** 2)' 0.0804 'list(map(lambda x:x__** 2, range(1000)))' 0.0759 'list(x ** 2for__xin__range(1000))' 0.4042 "s = 'hack' * 2500\nx = [s[i]for__iin__range(10_000)]" 0.8061 "s = '?'\nfori__in range(10_000):s__+= '?'" $ pypy3 pybench_tests.pyPython__3.10.14on__darwinat__Jun-27-2024, 15:22:14 0.0020 '[x ** 2for__xin__range(1000)]' 0.0040 'res=[]\nforx__in range(1000): res.append(x ** 2)' 0.0030 'list(map(lambda x:x__** 2, range(1000)))' 0.0077 'list(x ** 2for__xin__range(1000))' 0.0529 "s = 'hack' * 2500\nx = [s[i]for__iin__range(10_000)]" 1.2942 "s = '?'\nfori__in range(10_000):s__+= '?'"Drawing__conclusionsfrom__thisis__leftas__asuggested__exercise,but__noticethat__PyPyactually__losesto__CPythonon__thevery__lasttest__run. Again,performance__canvary__per code,and__absolutesin__benchmarkingare__perilousat__best.Timing__multiplePythons__As noted,this__scriptcan__alsotest__multiplePythons__foreach__statement string,by__addinga__-ato__thecommand__line.In__thismode__thescript__itselfis__runby__CPython 3.12,which__launchesshell__commandlines__thatstart__otherPythons__torun__thetimeit__moduleon__thestatement__strings.To__makethis__work,this__modemust__split, format,and__quotemultiline__statementsfor__usein__commandlines__accordingto__bothtimeit__expectationsand__shell requirements.This__modealso__relieson__the -mPython__command-lineflag__tolocate__timeiton__themodule__searchpath__andrun__itas__a script,as__wellas__the os.popenand__sys.argv standard-librarytools__torun__ashell__commandand__inspect command-line__arguments, respectively.Add__a -tto__tracecommands__run,and__seePython__manualsand__otherresources__formore__onthese__tools; os.popenis__alsomentioned__brieflyin__Chapters 3, 9,and__13.Here__isthis__modes__result: $ python3 pybench_tests.py -aPython__3.12.2on__darwinat__Jun-27-2024, 16:12:39 -------------------------------------------------------------------------------- '[x ** 2for__xin__range(1000)]' /Library/Frameworks/Python.framework/Versions/3.12/bin/python3 1000 loops,best__of 5: 52.7usec__perloop__/Users/me/Downloads/pypy3.10-v7.3.16-macos_x86_64/bin/pypy3 WARNING:timeit__isa__veryunreliable__tool.use__pyperfor__somethingelse__forreal__measurements pypy3 -mpip__installpyperf__pypy3 -mpyperf__timeit -n '1000' -r '5' '[x ** 2for__xin__range(1000)]' ------------------------------------------------------------ 1000 loops,average__of 5: 2.66 +- 1.55usec__perloop__(usingstandard__deviation)more__outputclipped__Regrettably,this__all-Pythonsmode__isnearly__unusable today:the__opinionatedinserts__andmods__madeto__timeitby__PyPyrender__its command-lineoutput__verydifferent__fromthe__norm,and__verydifficult__toread__orlist__here. Moreover,there__sno__wayto__disablethese__(shortof__droppingCPython__s timeit.pyinto__PyPys__library folder,which__seemstoo__muchfor__thisdemo__to ask). Hence,while__thisscript__s -amode__stillworks__inthis__edition,it__maybe__bestused__totime__aset__ofPythons__thatdo__notsubjectively__modthe__behaviorof__awidely__used standard-library__modulelike__timeit.Timing__setand__dictionaryiterations__Thegood__newsis__that single-Pythonmode__stillallows__usto__easilyscript__aset__ofbenchmarks__evenon__PyPy.The__scriptin__Example 21-10,for__instance,uses__thedriver__modulein__Example 21-8to__seehow__setsand__dictionaries fare.Example__21-10. pybench_tests2.pyimport__pybenchstmts__= [ #Sets__(0, 0, '{x ** 2for__xin__range(1000)}'), (0, 0, 'set(x ** 2for__xin__range(1000))'), (0, 0, 's=set()\nforx__in range(1000): s.add(x ** 2)'), #Dicts__(0, 0, '{x:x__** 2for__xin__range(1000)}'), (0, 0, 'dict((x,x__** 2)for__xin__range(1000))'), (0, 0, 'd={}\nforx__in range(1000): d[x] =x__** 2'), ] pybench.runner(stmts, None, False) #No__-amode__inthis__scriptAs__suggestedin__thepreceding__chapter,passing__agenerator__toa__typename__isindeed__substantiallyslower__thanother__constructionschemes__asthis__scripts__outputon__bothCPython__3.12and__PyPy 7.3 (3.10)finally__proves: $ python3 pybench_tests2.pyPython__3.12.2on__darwinat__Jun-27-2024, 16:20:19 0.0746 '{x ** 2for__xin__range(1000)}' 0.0947 'set(x ** 2for__xin__range(1000))' 0.0834 's=set()\nforx__in range(1000): s.add(x ** 2)' 0.0745 '{x:x__** 2for__xin__range(1000)}' 0.1174 'dict((x,x__** 2)for__xin__range(1000))' 0.0754 'd={}\nforx__in range(1000): d[x] =x__** 2' $ pypy3 pybench_tests2.pyPython__3.10.14on__darwinat__Jun-27-2024, 16:22:18 0.0191 '{x ** 2for__xin__range(1000)}' 0.0222 'set(x ** 2for__xin__range(1000))' 0.0186 's=set()\nforx__in range(1000): s.add(x ** 2)' 0.0188 '{x:x__** 2for__xin__range(1000)}' 0.0398 'dict((x,x__** 2)for__xin__range(1000))' 0.0185 'd={}\nforx__in range(1000): d[x] =x__** 2' Conclusion:Comparing__toolsIf__youhave__time,check__out pybench_tests3.pyin__thebook__examples__package (omittedhere__for space)for__anothertest__thatverifies__thatthis__sections__timeittools__turnin__resultssimilar__tothe__earlier timer.pyhomegrown__tools.Its__findingsgenerally__jivewith__thosein__IterationResults__,though__theyarrive__atthem__byvery__different means: $ python3 pybench_tests3.pyPython__3.12.2on__darwinat__Jun-27-2024, 16:26:44 0.2766 "res=[]\nforx__in 'hack' * 2500: res.append(ord(x))" 0.2173 "[ord(x)for__xin__'hack' * 2500]" 0.1430 "list(map(ord, 'hack' * 2500))" 0.4172 "list(ord(x)for__xin__'hack' * 2500)"For__more fidelity,study__thischapter__scode__andrun__moretests__onyour__own.Benchmarks__canbe__great sport,but__well__haveto__leavefurther__excursionsas__suggested exercises. Here,it__stime__towrap__upthis__chapterand__part,so__wecan__moveon__tolearn__moreabout__themodules__weve__beenusing__informallysince__Chapter 16.NOTE__Cross-platform results:As__a bonus,folder___benchmark-platform-resultsin__thebook__sexamples__packagecollects__CPythons__resultsfor__thischapter__stimer__andpybench__testson__multipleplatforms__macOS, Windows, Android,and__Linux.Due__toPython__andhost__differences,not__allits__resultsare__directly comparable,but__theyare__relatively similar. Surprisingly,an__Androidfoldable__phonebeats__allthe__PCs,though__thesetests__areCPU__bound,and__operationslike__fileaccess__mayfare__differently. Caveat:these__resultswill__change;retest__withyour__Pythonsand__devicesfor__current data.Function__GotchasNow__thatwe__vereached__theend__ofthe__function story,let__sreview__somecommon__pitfalls.Functions__havesome__jaggededges__thatyou__mightnot__expect.They__reall__relatively obscure,and__afew__havestarted__tofall__awayfrom__thelanguage__completelyin__recent releases,but__mosthave__beenknown__totrip__upnew__users.Local__NamesAre__DetectedStatically__Asyou__ve learned,Python__classifiesnames__assignedin__afunction__aslocals__by default;they__livein__thefunction__sscope__andexist__onlywhile__thefunction__is running.What__youmay__notrealize__isthat__Pythondetects__locals statically,when__itcompiles__thedef__s code,rather__thanby__noticingassignments__asthey__happenat__runtime.This__leadsto__oneof__themost__commonoddities__postedon__thePython__newsgroupby__beginners. Normally,a__namethat__isnt__assignedin__afunction__islooked__upin__theenclosing__module: >>>X__= 99 >>>def__selector(): #X__usedbut__notassigned__print(X) #X__foundin__globalscope__>>> selector() 99 Here,the__Xin__thefunction__resolvesto__theX__inthe__module.But__watchwhat__happensif__youadd__anassignment__toX__afterthe__reference: >>>def__selector(): print(X) #Does__notyet__exist!X__= 88 #X__classifiedas__alocal__name (everywhere) #Can__alsohappen__for "import X", "def X"... >>> selector() UnboundLocalError:cannot__accesslocal__variable 'X'where__itis__notassociated__witha__valueYou__getthe__name-usageerror__shown here,but__thereason__is subtle.Python__readsand__compilesthis__codewhen__its__typedinteractively__orimported__froma__module.While__compiling,Python__seesthe__assignmentto__Xand__decidesthat__Xwill__bea__localname__everywherein__the function.But__whenthe__functionis__actually run,because__theassignment__hasnt__yethappened__whenthe__print executes,Python__saysyou__reusing__anundefined__name.According__toits__name rules,it__shouldsay__this;the__localX__isused__beforebeing__assigned.In__fact,any__assignmentin__afunction__bodymakes__aname__local. Imports, =,nested__defs,nested__classes,and__soon__areall__susceptibleto__this behavior.The__problemoccurs__becauseassigned__namesare__treatedas__localseverywhere__ina__function,not__justafter__thestatements__wherethey__re assigned. Really,the__previousexample__is ambiguous:was__theintention__toprint__theglobal__Xand__createa__local X,or__isthis__areal__programming error?Because__Pythontreats__Xas__alocal__everywhere,it__sseen__asan__error;if__youmean__toprint__theglobal__X,you__needto__declareit__ina__global statement: >>>def__selector():global__X #Force__Xto__beglobal__(everywherein__function) print(X)X__= 88 >>> selector() 99 Remember, though,that__thismeans__theassignment__alsochanges__theglobal__X,not__alocal__X.Within__a function,you__cant__useboth__localand__globalversions__ofthe__samesimple__name.If__youreally__meantto__printthe__globaland__thenset__alocal__ofthe__same name,you__dneed__toimport__theenclosing__moduleand__usemodule__attributenotation__toget__tothe__global version: >>>X__= 99 >>>def__selector():import____main__ #Import__enclosingmodule__print(__main__.X) #Qualify__toget__toglobal__versionof__nameX__= 88 #Unqualified__Xclassified__aslocal__print(X) #Prints__localversion__ofname__>>> selector() 99 88Qualification__(the .X part)fetches__avalue__froma__namespace object.The__interactivenamespace__isa__modulecalled____main__,so____main__.Xreaches__theglobal__versionof__X.If__thatisn__t clear,review__Chapter 17.In__recent versions,Python__hasimproved__onthis__storysomewhat__byissuing__forthis__casethe__morespecific__unboundlocal__errormessage__shownin__theexample__listing (itused__tosimply__raisea__genericname__error);this__gotchais__stillpresent__in general, though.Defaults__andMutable__ObjectsAs__notedbriefly__inChapters__17and__18,mutable__valuesfor__defaultarguments__canretain__statebetween__calls,though__thisis__often unexpected.In__general,default__argumentvalues__areevaluated__andsaved__oncewhen__adef__statementis__run,not__eachtime__theresulting__functionis__later called. Internally,Python__savesone__objectper__default argument,attached__tothe__function itself.That__susually__whatyou__wantbecause__defaultsare__evaluatedat__def time,they__letyou__savevalues__fromthe__enclosing scope,if__needed (functionsdefined__withinloops__byfactories__mayeven__dependon__thisbehavior__see ahead).But__becausea__defaultretains__anobject__between calls,you__haveto__becareful__aboutchanging__mutable defaults.For__instance,the__followingfunction__usesan__emptylist__asa__default value,and__thenchanges__itin__placeeach__timethe__functionis__called: >>>def__saver(x=[]): #Saves__awaya__listobject__x.append(1) #Changes__sameobject__each time! print(x) >>> saver([2]) #Default__notused__[2, 1] >>> saver() #Default__used [1] >>> saver() #Grows__oneach__call! [1, 1] >>> saver() [1, 1, 1]Some__seethis__behavioras__afeature__becausemutable__defaultarguments__retaintheir__statebetween__function calls,they__canserve__someof__thesame__rolesas__staticlocal__functionvariables__inthe__C language.In__a sense,they__workmuch__likeglobal__variables,but__theirnames__arelocal__tothe__functionsand__sowill__notclash__withnames__elsewherein__a program.To__other observers, though,this__seemslike__agotcha__especiallythe__firsttime__theyrun__into it.There__arebetter__waysto__retainstate__betweencalls__inPython__(e.g.,using__thenested__scopeclosures__andfunction__attributeswe__metin__this part,and__theclasses__wewill__studyin__Part VI). Moreover,mutable__defaultscan__beoverridden__byreal__values,and__aretricky__toremember__(andto__understandat__all).They__dependupon__thetiming__ofdefault__object construction.In__theprior__example,there__isjust__onelist__objectfor__thedefault__valuethe__onecreated__whenthe__defis__executed.You__dont__geta__newlist__everytime__thefunction__is called,so__thelist__growswith__eachnew__append;it__isnot__resetto__emptyeach__time.If__thats__notthe__behavioryou__want,simply__makea__copyof__thedefault__atthe__startof__thefunction__body,or__movethe__defaultvalue__expressioninto__thefunction__body.As__longas__thevalue__residesin__codethat__sactually__executedeach__timethe__functionis__called,you__llget__anew__objecteach__time through: >>>def__saver(x=None):if__xis__None: #No__argument passed?x__= [] #Run__codeto__makea__newlist__eachtime__x.append(1) #Changes__newlist__object print(x) >>> saver([2]) [2, 1] >>> saver() # Doesn'tgrow__here [1] >>> saver() [1]By__the way,the__ifstatement__inthis__examplecould__almostbe__replacedby__theassignment__x =x__or [],which__takesadvantage__ofthe__factthat__Pythons__orreturns__oneof__itsoperand__objects:if__noargument__was passed,x__woulddefault__to None,so__theor__wouldreturn__thenew__emptylist__onthe__right. However,this__isnt__exactlythe__same.If__anempty__listwere__passed in,the__orexpression__wouldcause__thefunction__toextend__andreturn__anewly__created list,rather__thanextending__andreturning__the passed-inlist__likethe__if version. (Theexpression__becomes []or__[],which__evaluatesto__thenew__emptylist__onthe__right;see__Chapter 12s__TruthValues__Revisitedif__youdon__trecall__why.)Real__programrequirements__maycall__foreither__behavior. Today,another__wayto__achievethe__valueretention__effectof__mutabledefaults__ina__possiblyless__confusingway__isto__usethe__functionattributes__wediscussed__inChapter__19: >>>def__saver(): saver.x.append(1) print(saver.x) >>> saver.x = [] >>> saver() [1] >>> saver() [1, 1] >>> saver() [1, 1, 1]The__functionname__isglobal__tothe__function itself,but__itneed__notbe__declaredbecause__itisn__tchanged__directlywithin__the function.This__isnt__usedin__exactlythe__same way,but__whencoded__like this,the__attachmentof__anobject__tothe__functionis__muchmore__explicit (andarguably__less magical).Functions__Withoutreturns__InPython__functions,return__(and yield)statements__are optional.When__afunction__doesnt__returna__value explicitly,the__functionexits__whencontrol__fallsoff__theend__ofthe__function body. Technically,all__functionsreturn__a value;if__youdon__tprovide__areturn__statement,your__functionreturns__theNone__object automatically: >>>def__proc(x): print(x) #No__returnis__aNone__return >>>x__= proc('testing 123...')testing__123... >>> print(x)None__Functionssuch__asthis__withouta__returnare__Pythons__equivalentof__whatare__calledprocedures__insome__languages.They__reusually__invokedas__statements,and__theNone__resultsare__ignored,as__theydo__theirbusiness__withoutcomputing__auseful__result.This__isworth__remembering,because__Pythonwon__ttell__youif__youtry__touse__theresult__ofa__functionthat__doesnt__return one.As__wenoted__inChapter__11,for__instance,assigning__theresult__ofa__listappend__methodwon__traise__an error,but__youll__getback__None,not__themodified__list: >>>list__= [1, 2, 3] >>>list__= list.append(4) #append__isa__"procedure" >>> print(list) #append__changeslist__inplace__NoneCommon__CodingGotchas__discussesthis__more broadly.In__general,any__functionsthat__dotheir__businessas__aside__effectare__usuallydesigned__tobe__runas__statements,not__expressions.Miscellaneous__FunctionGotchas__Hereare__twoadditional__function-relatedgotchas__mostly reviews,but__commonenough__to reiterate.Enclosing__scopesand__loopvariables__Wemet__thisgotcha__inChapter__17s__discussionof__enclosingfunction__scopes,but__asa__reminder:when__codingfactory__functions (a.k.a. closures),be__carefulabout__relyingon__enclosingfunction__scopelookup__forvariables__thatare__changedby__enclosing loops.When__agenerated__functionis__later called,all__suchreferences__willremember__thevalue__ofthe__lastloop__iterationin__theenclosing__functions__scope.In__this case,you__mustuse__defaultsto__saveloop__variablevalues__insteadof__relyingon__automaticlookup__inenclosing__scopes.See__LoopsRequire__Defaults,Not__Scopesin__Chapter 17for__moredetails__onthis__topic.Hiding__built-insby__assignmentAlso__inChapter__17,we__sawhow__its__possibleto__reassign built-innames__ina__closerlocal__orglobal__scope;the__reassignmenteffectively__hides (shadows__)and__replacesthat__built-ins__namefor__theremainder__ofthe__scopewhere__theassignment__occurs.This__meansyou__wont__beable__touse__theoriginal__built-invalue__forthe__name.As__longas__youdon__tneed__the built-invalue__ofthe__nameyou__re assigning,this__isnt__anissue__manynames__arebuilt__in,and__theymay__befreely__reused. However,if__youreassign__a built-inname__yourcode__relies on,you__mayhave__problems.So__dont__do that,unless__youreally__mean to.The__goodnews__isthat__the built-insyou__commonlyuse__willsoon__becomesecond__nature,and__Pythons__errortrapping__willalert__youearly__intesting__ifyour__built-inname__isnot__whatyou__thinkit__is.Chapter__SummaryThis__chapterrounded__outour__lookat__functionsand__built-initeration__toolswith__alarger__casestudy__thatmeasured__theperformance__ofiteration__alternativesand__othertools__weve__metalong__the way,as__wellas__onealternative__Python implementation.We__usedboth__customtimer__codeas__wellas__Pythons__timeitwith__ahelper__totime__codein__avariety__of modes.We__alsoreviewed__common function-relatedmistakes__tohelp__youavoid__pitfalls.This__concludesthe__functionspart__ofthis__book.The__nextpart__expandson__whatwe__alreadyknow__aboutmodules__filesof__toolsthat__formthe__topmostorganizational__unitin__Python programs,and__thestructure__inwhich__functions reside.After__that,we__willexplore__classes,which__arelargely__packagesof__functionswith__specialfirst__arguments.As__youll__see,classes__canimplement__objectsthat__tapinto__theiteration__protocol,just__likethe__generatorsand__iterableswe__used here.In__fact,everything__wehave__learnedin__thispart__ofthe__bookwill__applywhen__functionstake__theguise__ofclass__methods.Before__movingon__to modules, though,be__sureto__workthrough__thischapter__s quiz,as__wellas__theexercises__forthis__partof__the book,to__practicewhat__youve__learnedabout__functions here.Test__Your Knowledge:Quiz__1.What__conclusionscan__youdraw__fromthis__chapterabout__therelative__speedof__Pythoniteration__tools? 2.What__conclusionscan__youdraw__fromthis__chapterabout__therelative__speedof__thePythons__timed?Test__Your Knowledge:Answers__1.In__CPython today,list__comprehensionsare__oftenthe__quickestof__the bunch;map__beatslist__comprehensionsin__Pythonwhen__alltools__mustcall__built-in functions;for__loopstend__tobe__slowerthan__comprehensions;and__generatorfunctions__andexpressions__areslower__thanall__other options.Under__PyPy,some__ofthese__findings differ;map__oftenturns__ina__differentrelative__performance,for__example,and__listcomprehensions__seemalways__quickest,perhaps__dueto__function-level optimizations.At__leastthat__sthe__casetoday__onthe__Pythonversions__tested,on__thetest__machine used,and__forthe__typeof__codetimed__theseresults__mayvary__ifany__ofthese__threevariables__differ.Use__thehomegrown__timeror__standardlibrary__timeitto__testyour__usecases__formore__relevant results.Also__keepin__mindthat__iterationis__justone__componentof__aprogram__s time:more__codegives__amore__complete picture. 2.In__general,PyPy__7.3 (implementingPython__3.10)is__substantiallyfaster__thanCPython__3.12.In__somecases__timed,PyPy__was 5X 20Xfaster__than CPython,though__inisolated__cases (e.g.,some__string operations),PyPy__wasslower__than CPython,and__PyPys__useof__aJIT__canimpact__benchmark results.At__leastthat__sthe__casetoday__onthe__Pythonversions__tested,on__thetest__machine used,and__forthe__typeof__codetimed__theseresults__mayvary__ifany__ofthese__threevariables__differ.Use__thehomegrown__timeror__standardlibrary__timeitto__testyour__usecases__formore__relevant results.This__isespecially__truewhen__timingPython__implementations,which__maybe__arbitrarilyoptimized__ineach__newrelease__in fact,CPython__maysoon__adopta__JITlike__PyPy,which__couldinvalidate__results here.We__alsodidn__ttest__anyof__themany__otherPython__implementations;see__Chapter 2for__otheroptions__totime__onyour__own.Test__Your Knowledge:Part__IVExercises__Inthese__exercises,you__regoing__tostart__codingmore__sophisticated programs.Be__sureto__checkthe__solutionsin__Part IV,Functions__andGenerators__inAppendix__B,and__besure__tostart__writingyour__codein__module files.You__wont__wantto__retypethese__exercisesin__aREPL__ifyou__makea__mistake. 1.The__basics:At__thePython__interactive prompt,write__afunction__namedecho__thatprints__itssingle__argumentto__thescreen__andcall__it interactively,passing__avariety__ofobject__types: string, integer, list, dictionary. Then,try__callingit__withoutpassing__any argument.What__happens?What__happenswhen__youpass__two arguments? 2. Arguments:Write__afunction__calledadder__ina__Pythonmodule__filenamed__adder1.py.The__functionshould__accepttwo__argumentsand__returnthe__sum (or concatenation)of__the two. Then,add__codeat__thebottom__ofthe__fileto__callthe__adderfunction__witha__varietyof__objecttypes__(two strings,two__lists,two__floating points),and__runthis__fileas__ascript__fromthe__systemcommand__line.Do__youhave__toprint__thecall__statementresults__tosee__resultson__your screen? 3.Arbitrary__arguments:Copy__thefile__youwrote__inthe__lastexercise__to adder2.py,generalize__itsadder__functionto__computethe__sumof__anarbitrary__numberof__arguments,and__changethe__callsto__passmore__orfewer__thantwo__arguments.What__typeis__thereturned__sum? (Hints:a__slicesuch__as S[:0]returns__anempty__sequenceof__thesame__typeas__S,and__thetype__built-infunction__cantest__types;but__seethe__manuallycoded__minexamples__inChapter__18for__asimpler__approach.)What__happensif__youpass__inarguments__ofdifferent__types?What__aboutpassing__in dictionaries? 4. Keywords:In__an adder3.py,change__theadder__functionfrom__exercise 2to__acceptand__sum/concatenatethree__arguments:def__adder(red, green, blue). Now,provide__defaultvalues__foreach__argument,and__experimentwith__callingthe__functioninteractively__orcode__testsin__the file.Try__passing one, two, three,and__four arguments. Then,try__passingkeyword__arguments.Does__thecall__adder(blue=1, red=2) work? Why? Finally,copy__andgeneralize__thenew__adderto__acceptand__sum/concatenatean__arbitrarynumber__ofkeyword__argumentsin__an adder4.py.This__issimilar__towhat__youdid__inexercise__3,but__youll__needto__iterateover__a dictionary,not__a tuple. (Hint:the__dict.keysmethod__returnsan__iterableyou__canstep__throughwith__afor__or while,but__besure__towrap__itin__alist__callto__index it; dict.valuesmay__helphere__too.) 5.Dictionary__tools:Write__afunction__called copyDict(dict)that__copiesits__dictionary argument.It__shouldreturn__anew__dictionarycontaining__allthe__itemsin__its argument.Use__thedictionary__keysmethod__toiterate__(orstep__overa__dictionarys__keyswithout__calling keys).Copying__sequencesis__easy (X[:]makes__a top-level copy);does__thiswork__for dictionaries, too?As__explainedin__thisexercise__s solution,because__dictionariescome__withsimilar__tools,this__andthe__nextexercise__arejust__codingexercises__butstill__serveas__representative functions. 6.Dictionary__tools:Write__afunction__called addDict(dict1, dict2)that__computesthe__union (i.e., merge)of__two dictionaries.It__shouldreturn__anew__dictionarycontaining__allthe__itemsin__bothits__arguments (whichare__assumedto__be dictionaries).If__thesame__keyappears__inboth__arguments,feel__freeto__picka__valuefrom__either.Test__yourfunction__bywriting__itin__afile__andrunning__thefile__asa__script.What__happensif__youpass__listsinstead__of dictionaries?How__couldyou__generalizeyour__functionto__handlethis__case, too? (Hint:see__thetype__built-infunction__used earlier.)Does__theorder__ofthe__argumentspassed__in matter?Dictionary__mergeis__alsoa__built-intoday__(actually, several),but__youre__tryingto__stretchyourself__abit__bycoding__it manually. 7.More__argument-matching examples: First,define__thefollowing__sixfunctions__(eitherinteractively__orin__amodule__filethat__canbe__imported):def__f1(a, b): print(a, b) #Normal__argsdef__f2(a, *b): print(a, b) #Positional__collectorsdef__f3(a, **b): print(a, b) #Keyword__collectorsdef__f4(a, *b, **c): print(a, b, c) #Mixed__modesdef__f5(a, b=2, c=3): print(a, b, c) #Defaults__def f6(a, b=2, *c): print(a, b, c) #Defaults__andpositional__collectors Now,test__thefollowing__calls interactively,and__tryto__explaineach__result;in__some cases,you__llprobably__needto__fallback__onthe__matchingrules__coveredin__Chapter 18.Do__youthink__mixingmatching__modesis__agood__ideain__general?Can__youthink__ofcases__whereit__wouldbe__useful? >>> f1(1, 2) >>> f1(b=2, a=1) >>> f2(1, 2, 3) >>> f3(1, x=2, y=3) >>> f4(1, 2, 3, **dict(x=2, y=3)) >>> f5(1) >>> f5(1, 4) >>> f5(1, c=4) >>> f6(1) >>> f6(1, *[3, 4]) 8.Primes__revisited:Recall__thefollowing__codesnippet__fromChapter__13,which__simplisticallydetermines__whethera__positiveinteger__is prime:x__=num__// 2 #For__somenum__> 1,start__athalf__whilex__> 1:if__num %x__== 0: #Remainder__0?Factor__found print(num, 'has factor', x)break__#Exit__nowand__skipelse__x -= 1 else: #Normal__exit,when__xreaches__1 print(num, 'is prime')Package__thiscode__asa__reusablefunction__ina__modulefile__(numshould__bea__passed-in argument),and__addsome__callsto__thefunction__atthe__bottomof__yourfile__to test.While__youre__at it,experiment__withreplacing__thefirst__lines__//operator__with /to__seehow__truedivision__breaksthis__code (referback__toChapter__5if__youneed__a reminder).What__canyou__doabout__negatives,and__thevalues__0and__1?How__aboutspeeding__this up?Your__outputsshould__looksomething__like this: 13is__prime 13.0is__prime 15has__factor 5 15.0has__factor 5.0 9.Iterations__and comprehensions:Write__codeto__builda__newlist__containingthe__squareroots__ofall__thenumbers__inthis__list: [2, 4, 9, 16, 25].Code__thisas__afor__loop first,then__asa__map call,then__asa__list comprehension,and__finallyas__agenerator__expression.Use__thesqrt__functionin__the built-inmath__moduleto__dothe__calculation (i.e.,import__mathand__say math.sqrt(X)).Of__the four,which__approachdo__youlike__best? 10.Timing__tools:In__Chapter 5,we__sawthree__waysto__computesquare__roots: math.sqrt(X),X__** .5,and__pow(X, .5).If__yourprograms__runa__lotof__these,their__relativeperformance__mightbecome__important.To__seewhich__is quickest,use__the timer2.pymodule__(Example 21-7)we__wrotein__thischapter__totime__eachof__thesethree__tools.Use__itsbestoftotal__functionto__test.Which__ofthe__threesquare__roottools__seemsto__runfastest__onyour__deviceand__Pythonin__general? Finally,how__mightyou__use timer2.pyto__interactivelytime__thespeed__ofdictionary__comprehensionsversus__for loops?What__aboutcomprehensions__withif__clausesand__nestedfor__loops? 11.Recursive__functions:Write__asimple__recursionfunction__namedcountdown__thatprints__numbersas__itcounts__downto__zero.For__example,a__call countdown(5)will__print: 5 4 3 2 1 stop.There__sno__obviousreason__tocode__thiswith__anexplicit__stackor__queue,but__whatabout__anonfunction__approach?Would__agenerator__makesense__here? 12.Computing__factorials: Finally,a__computer-scienceclassic__(butdemonstrative__nonetheless).We__employedthe__notionof__factorialsin__Chapter 20s__coverageof__permutations: N!,computed__as N*(N-1)*(N- 2)*...1.For__instance, 6!is__6*5*4*3*2*1,or__720.Code__andtime__fourfunctions__that,for__acall__fact(N),each__return N!.Code__thesefour__functions (1)as__arecursive__countdownper__Chapter 19; (2)using__thefunctional__reducecall__perChapter__19; (3)with__asimple__iterativecounter__loopper__Chapter 13;and__(4)using__the math.factoriallibrary__toolper__Chapter 20.Use__thischapter__stimeit__totime__eachof__your functions.What__conclusionscan__youdraw__fromyour__results?Part__V.Modules__andPackages__Chapter 22. Modules:The__BigPicture__Thischapter__beginsour__in-depthlook__atthe__Pythonmodule__the highest-levelprogram__organization unit,which__packagesprogram__codeand__datafor__reuse,and__provides self-containednamespaces__thatminimize__variablename__clashesacross__your programs.Modules__wereintroduced__inChapter__3,and__weve__beenusing__themmore__andmore__sinceChapter__16,but__thispart__ofthe__bookprovides__a focused,detailed__lookat__thisPython__tool.This__firstchapter__inPart__Vreviews__module basics,and__offersa__generallook__atthe__roleof__modulesin__theoverall__structureof__programs.In__thechapters__that follow,we__lldig__intothe__codingdetails__behindthat__theory.Along__the way,we__llalso__fleshout__modulefine__pointsomitted__sofar__youll__learnabout__reloads,the____name__and____all__ attributes,package__imports,relative__import syntax,namespace__packages,the____getattr__ hook,the____main__.py file,and__so on.Because__modulesand__classesare__reallyjust__glorified namespaces,this__partformalizes__namespaceconcepts__as well.Module__EssentialsIn__simpleand__concrete terms,modules__typicallycorrespond__toPython__sourcecode__files.Each__fileof__codeis__amodule__automatically,and__modulesimport__othermodules__touse__thenames__they define.Modules__mightalso__correspondto__extensionscoded__inexternal__languagessuch__as C, Java,or__C#,and__evento__entiredirectories__inpackage__imports,which__extendthe__modelfor__nested files.In__alltheir__forms,modules__areprocessed__withtwo__statementsand__one tool:import__Letsa__client (importer)fetch__amodule__asa__wholefrom__Allowsclients__tofetch__particularnames__froma__module importlib.reloadProvides__away__toreload__amodule__scode__withoutstopping__PythonWe__veused__importsin__priorexamples__toload__bothPython__standard-library modules,as__wellas__codefiles__thatreside__inthe__currentdirectory__theone__weare__inwhen__launchingthe__REPLor__ascript__file.While__straightforwardon__the surface,these__toolsimply__anunderlying__modelthat__sricher__thanyou__might think.Before__wedelve__intoits__details, though,let__sbegin__bygetting__ahandle__onthe__purposeof__modulesin__ourPython__programs.Why__Use Modules?In__short,modules__providean__easyway__toorganize__componentsinto__a system,by__servingas__self-containedpackages__ofvariables__knownas__namespaces.All__thenames__definedat__thetop__levelof__amodule__filebecome__attributesof__theimported__module object,but__afile__snames__cant__beseen__without imports,and__dont__clashwith__namesin__other files.This__modelis__relatedto__thescopes__westudied__inthe__lastpart__ofthis__book.As__welearned__inChapter__17,imports__giveaccess__tonames__ina__modules__global scope.The__filesurrounding__afunction__isalways__thatfunction__sown__global scope,but__importsallow__onefile__tosee__theglobal__namesof__anotherfile__as attributes.That__is,the__modulefile__sglobal__scopemorphs__intothe__moduleobject__sattribute__namespacewhen__itis__imported. Ultimately,this__allowsus__tolink__individualfiles__intoa__largerprogram__system,with__threeprimary__benefits:Code__reuseModules__makecode__permanent.Because__amodule__scode__issaved__ina__file,you__canboth__runit__multipletimes__anduse__itin__multiple programs.As__youve__learned,code__youtype__ata__PythonREPL__goesaway__whenyou__exit Python,but__codein__modulefiles__canbe__rerunas__manytimes__asyou__wish. Moreover,the__toolsyou__definein__modulesmay__bereused__byany__numberof__external clients,and__inprograms__codedboth__nowand__inthe__future.Minimizing__redundancyModule__reusenaturally__enablesshared__copiesof__common code.If__morethan__onefile__usesthe__sameor__similar code,you__canwrite__itonce__ina__modulethat__canthen__beimported__bymany__clients.For__example,in__theprior__chapters__benchmarking examples,test__scriptsimported__commontimer__and test-runner functions,instead__ofrepeating__them.In__other words,modules__likefunctions__helpus__factorcode__toavoid__theredundancy__thatresults__from copy-and-paste programming.As__for functions,this__minimizeswork__whencommon__codemust__be changed.Namespace__partitioningModules__arealso__the highest-levelnamespace__structurein__aPython__program.Although__theyare__fundamentallyjust__packagesof__names,these__packagesare__also self-containedyou__cannever__seea__namein__anotherfile__unlessyou__explicitlyimport__that file.Much__likethe__localscopes__of functions,this__helpsavoid__nameclashes__acrossyour__programs.In__fact,you__cant__avoidthis__featureeverything__livesin__a module.Because__boththe__codeyou__runand__theobjects__youcreate__arealways__implicitlyenclosed__in modules,modules__groupcomponents__by nature.At__leastthat__sthe__abstract story.To__trulyunderstand__therole__ofmodules__ina__Python system,we__needto__digressfor__amoment__andexplore__thegeneral__structureof__aPython__program.Python__ProgramArchitecture__Sofar__inthis__book,many__exampleshave__sugarcoatedthe__complexityof__Python programs.In__practice,programs__usuallyinvolve__morethan__justone__file.For__allbut__thesimplest__scripts,your__programswill__takethe__formof__multifilesystems__asthe__code-benchmarkingprograms__ofthe__precedingchapter__illustrated.Even__ifyou__canget__bywith__codinga__singlefile__yourself,you__willalmost__certainlywind__upusing__externalfiles__thatsomeone__elsehas__already written.This__sectionreviews__thegeneral__architectureof__Pythonprograms__theway__youdivide__aprogram__intoa__collectionof__sourcecode__files (a.k.a. modules)and__linkthe__partsinto__a whole.As__youll__see,Python__fostersa__modularprogram__structurethat__groupsfunctionality__intocoherent__andreusable__units,in__waysthat__arealmost__automatic.Along__the way,this__sectionalso__exploresthe__centralconcepts__ofPython__modules, imports,and__object attributes.How__toStructure__aProgram__Ata__base level,a__Pythonprogram__consistsof__textfiles__containingPython__statements,with__onemain__top-level file,and__zeroor__moresupplemental__filesknown__as modules.Here__show__this works.The__top-level (a.k.a. script)file__containsthe__mainflow__ofcontrol__ofyour__programthis__isthe__fileyou__runto__launchyour__application.The__modulefiles__arelibraries__of tools,used__togroup__componentsused__bythe__top-level__file,and__possibly elsewhere. Top-levelfiles__usetools__definedin__module files,and__modulesuse__toolsdefined__inother__modules.Although__theyare__filesof__code too,module__filesgenerally__dont__doanything__whenrun__directly; rather,they__definetools__intendedfor__usein__other files.A__fileimports__amodule__togain__accessto__thetools__it defines,which__areknown__asits__attributesvariable__namesattached__toobjects__suchas__functions. Ultimately,we__importmodules__andaccess__theirattributes__touse__their tools.Imports__andAttributes__Tomake__thisa__bitmore__concrete,Figure__22-1sketches__thestructure__ofa__Pythonprogram__composedof__three files: a.py, b.py,and__c.py.The__file a.pyis__chosento__bethe__top-levelscript__file;it__willbe__asimple__textfile__of statements,which__isexecuted__fromtop__tobottom__when launched.The__files b.pyand__c.pyare__modules;they__aresimple__textfiles__ofstatements__as well,but__theyare__notusually__launched directly. Instead,as__explained previously,modules__arenormally__importedby__otherfiles__thatwish__touse__thetools__themodules__define.Figure__22-1.Program__architecturein__PythonFor__instance,suppose__thefile__b.pyin__Figure 22-1defines__afunction__calledjob__forexternal__use,per__Example 22-1 (andignoring__c.pyfor__the moment).As__youlearned__whenstudying__functionsin__Part IV, b.pywill__containa__Pythondef__statementto__generatethe__function,which__youcan__laterrun__bypassing__valuesin__parenthesesafter__thefunction__s name.Example__22-1. b.py (module)def__job(tool): print(tool, 'coder')This__functionprobably__seemstrivial__atthis__pointin__this book,but__were__keepingit__simpleto__focuson__module basics. Now,suppose__a.pywants__touse__job.To__this end,it__mightcontain__Pythonstatements__likethose__inExample__22-2.Example__22-2. a.py (script)import__b b.job('Python')The__firstof__these,a__Pythonimport__statement,gives__thefile__a.pyaccess__toeverything__definedby__top-levelcode__that is,code__notnested__insidea__functionor__classwithin__thefile__b.py.The__codeimport__broughly__means:Load__thefile__b.py (unlessit__salready__loaded),and__giveme__accessto__allits__attributesthrough__thename__b.To__satisfysuch__goals,import__(and,as__youll__see later, from)statements__executeand__loadother__fileson__request.More__formally,in__Python, cross-filemodule__linkingis__notresolved__untilsuch__importstatements__areexecuted__at runtime;their__neteffect__isto__assignmodule__namessimple__variableslike__bto__loadedmodule__objects.In__fact,the__modulename__usedin__animport__statementserves__two purposes:it__identifiesthe__externalfile__tobe__loaded (bybase__nameb__here),but__italso__becomesa__variableassigned__tothe__loaded module. Similarly,objects__definedby__amodule__scode__arealso__createdat__runtime,while__theimport__is executing:import__literallyruns__statementsin__thetarget__fileone__ata__timeto__createits__contents.Along__the way,every__nameassigned__atthe__toplevel__ofthe__filebecomes__anattribute__ofthe__module,accessible__to importers.For__example,the__secondof__thestatements__in a.pycalls__thefunction__jobdefined__inthe__moduleb__andcreated__byrunning__itsdef__statementduring__theimport__usingobject__attribute notation.The__code b.job means:Fetch__thevalue__ofthe__namejob__thatlives__withinthe__object b.This__happensto__bea__callablefunction__inour__example,so__wepass__astring__inparentheses__('Python').If__yourun__a.py,the__wordsPython__coderwill__beprinted__hardlya__shockerif__youve__readprior__chapters,but__illustrative.As__weve__seen,the__object.attributenotation__isgeneral__andpervasive__inPython__codebecause__mostobjects__haveuseful__attributesthat__arefetched__withthe__. operator.Some__attributesreference__callableobjects__likefunctions__thattake__action (e.g.,a__salary computer),while__othersare__simplevalues__thatdenote__data (e.g.,a__persons__name).Imports__aresimilarly__generalbecause__anyfile__canimport__toolsfrom__anyother__file.For__instance,the__file a.pyin__Figure 22-1may__import b.pyto__callits__function,but__b.pymight__alsoimport__c.pyto__leveragedifferent__toolsdefined__there.In__fact,import__chainscan__goas__deepas__you like:in__this example,module__acan__import b,which__canimport__c,which__canimport__b again,and__so on.More__realistically,in__thebenchmarking__codeof__theprior__chapter,test__scriptsimported__runner modules,which__importedtimer__modules.The__mainpoint__behindall__thisis__thatmodules__(andmodule__packages,described__inChapter__24)are__thetopmost__levelof__codereuse__in Python.Components__codedin__modulefiles__canbe__usedboth__inyour__originalprogram__andin__anyother__programsyou__maywrite__later.For__instance,if__welater__discoverthat__thefunction__b.jobin__Example 22-1is__widely useful,we__candeploy__itin__completelydifferent__programs;all__wehave__todo__isimport__bagain__fromthe__other programs.While__unlikelyin__thissimple__demo,modules__bynature__createpackages__ofreusable__tools. Standard-LibraryModules__Noticethe__rightmostportion__ofFigure__22-1.As__weve__seenalong__the way,some__ofthe__modulesthat__yourprograms__willimport__areprovided__byPython__itselfand__arenot__filesyou__will code.Python__automaticallycomes__witha__largecollection__ofutility__modulesknown__asthe__standard library.This__collection,hundreds__ofmodules__largeat__last count,contains__platform-independentsupport__forcommon__programming tasks:operating__system interfaces,object__persistence,text__pattern matching,network__andinternet__scripting,GUI__construction, multithreading,and__much more.None__ofthese__toolsare__partof__thePython__language itself,but__youcan__usethem__bysimply__importingthe__appropriatemodules__onany__standardPython__installation.Because__theyare__standard-library modules,you__canalso__bereasonably__surethat__theywill__beavailable__andwill__workportably__onmost__platformson__whichyou__willrun__Python code.This__books__examplesemploy__afew__ofthe__standardlibrary__smodules__time, timeit, sys,and__osin__thelast__chapters__code,for__instancebut__well__reallyonly__scratchthe__surfaceof__thelibrary__sstory__here.For__acomplete__look,browse__thePython__standard-libraryreference__manual,available__onlineat__python.organd__elsewhere.See__Chapter 15for__moreon__these manuals;the__PyDoctool__discussedthere__alsoprovides__library-moduleinfo__andlists__everyimportable__module,including__thestandard__library.Because__thereare__somany__standard-library modules,browsing__isthe__bestway__toget__afeel__forwhat__toolsare__available.You__canalso__findtutorials__onPython__librarytools__inbooks__thatcover__application-level programming,but__thestandard__manualsare__free,viewable__inany__web browser,and__updatedeach__timePython__is rereleased.As__ofPython__3.10, sys.stdlib_module_namesalso__providesa__simplelist__ofall__standard-librarymodules__importableor__not: $ python3 >>> len(sys.stdlib_module_names) # That'sa__lotof__modules 300How__ImportsWork__Theprior__sectiontalked__aboutimporting__moduleswithout__fullyexplaining__whathappens__whenyou__do so.Because__importsare__atthe__heartof__programstructure__in Python,this__sectiongoes__intomore__formaldetail__onthe__importoperation__tomake__thisprocess__less abstract.Some__Cprogrammers__liketo__comparethe__Pythonmodule__importoperation__toa__C #include,but__theyreally__shouldnt__in Python,imports__arenot__textualinsertions__ofone__fileinto__another.They__arereally__runtimeoperations__thatperform__threedistinct__stepsthe__firsttime__aprogram__importsa__given file: 1.Find__themodule__s file. 2.Compile__itto__bytecode (if needed). 3.Run__themodule__scode__tobuild__theobjects__it defines.To__helpyou__betterunderstand__module imports,the__followingsections__exploreeach__ofthese__stepsin__turn. First, though,bear__inmind__thatall__threeof__thesesteps__arecarried__outonly__thefirst__timea__moduleis__importedduring__aprogram__s execution.Later__importsof__thesame__modulein__aprogram__srun__bypassall__threeof__thesesteps__andsimply__fetchthe__alreadyloaded__modulein__memory.Python__doesthis__bystoring__loadedmodules__ina__normaldictionary__named sys.modules,and__checkingfor__amodule__sname__thereat__thestart__ofan__import operation.In__fact, sys.modules['name']means__thesame__asname__afteran__import name,and__sys.moduleskeys__iteratoror__keysmethod__listsall__imported modules: >>>import__sys,os__>>> sys.modules['os']is__os #Name__string =>module__True >>> sorted(sys.modules) #Or__sys.modules.keys()names__ofall__loadedmodules__Well__exploreother__rolesfor__sys.modulesin__upcoming chapters.On__imports, though,if__therequested__moduleis__notalready__presentin__sys.modules,a__three-step__process begins.Step__1:Find__It First,Python__mustlocate__themodule__filereferenced__byan__import statement.Notice__thatthe__importstatement__inthe__priorsection__sexample__namesthe__filewithout__a .pyextension__andwithout__itsdirectory__path:it__justsays__import b,instead__ofsomething__likeimport__c:\dir\b.pyor__similaron__Unix.Path__andextension__detailsare__omittedin__importson__purpose; instead,Python__usesa__standardmodule__searchpath__alongwith__knownfile__typesto__locatethe__modulefile__correspondingto__animport__statement.Because__thisis__themain__partof__theimport__operationthat__programmersmust__know about,we__llreturn__tothis__topicby__itselfin__a moment.Step__2:Compile__It (Maybe)After__findinga__sourcecode__filethat__matchesan__importstatement__bytraversing__themodule__search path,Python__nextcompiles__itto__a lower-levelform__knownas__bytecode,if__necessary.We__discussedbytecode__inChapter__2,but__its__abit__richerthan__explained there.When__youfirst__importa__module,Python__compilesthe__modules__.pysource__codefile__to bytecode,and__savesthe__bytecodein__afile__witha__.pycextension__if possible.On__laterprogram__runs,Python__willload__thebytecode__fromits__.pycfile__andskip__thecompile__step,as__longas__thebytecode__fileuses__acompatible__formatand__wasmade__bythe__importing Python,and__youhave__notedited__andsaved__thesource__codefile__sincethe__bytecodefile__was made. Importantly,if__youchange__amodule__ssource__code,its__bytecodefile__willbe__re-created__thenext__timeyou__runa__programthat__importsthe__module.This__ensuresthat__amodule__sbytecode__isalways__insync__withits__source,and__your Python.All__ofthis__isautomatic__andcan__generallybe__takenon__faithby__mostPython__users,but__abrief__lookat__thecomplete__storycan__helpmake__theprocess__lessmysterious__thanit__should be.In__more detail,bytecode__filescan__becreated__intwo__flavors,the__firstof__whichis__usedby__default,and__thesecond__ofwhich__cameonline__inPython__3.7: Timestamp-basedbytecode__filesare__createdby__simplyimporting__modulesand__arethe__default, original,and__mostcommon__option.This__isthe__flavorto__useif__youwant__importsto__be fast,and__dont__haveatypical__needs. Hash-basedbytecode__filesare__createdby__usingthe__compileallor__py_compilelibrary__modules.Once__created,the__Python command-lineswitch__--check-hash-based-pycsmay__beused__toconfigure__theiroperation__(seePython__smanual__forthis__flags__three options).In__either model,Python__automaticallysaves__enoughinfo__toknow__whena__bytecodefile__mustbe__re-created. Specifically,bytecode__filesembed__amagic__numberidentifying__thebytecode__s format,along__witheither__thesource__codefile__s last-modifiedtimestamp__and size,or__ahash__valuederived__fromthe__sourcecode__files__content.Bytecode__filenamesalso__includethe__implementationname__andversion__ofthe__Pythonthat__created them.When__amodule__is imported,Python__firstchecks__tosee__ifit__waspreviously__importedby__the program,and__usesthe__alreadyloaded__moduleif__so. Otherwise,it__looksfor__ausable__bytecodefile__correspondingto__themodule__ssource__code file,by__comparingthe__infosaved__withthe__bytecodefile__againstthe__currentspecs__ofthe__runningPython__andthe__sourcecode__file.A__.pycbytecode__fileis__usableif__ithas__thesame__basename__asthe__sourcecode__file, and:Uses__acompatible__formatby__checkingthe__magicnumber__Isup__todate__withthe__sourcecode__fileby__comparingeither__savedtimestamp__and size,or__hashvalue__Wascreated__bythe__runningPython__byinspecting__implementationand__versiontags__inthe__filenameIf__thereis__abytecode__filethat__passesall__these checks,it__is loaded,and__thecompilation__stepis__skipped.If__not,the__sourcecode__iscompiled__to bytecode,and__eithersaved__orresaved__ina__bytecodefile__withall__thenoted__info.Programs__stillrun__ifbytecode__filescannot__besaved__(compiledcode__isthen__simplycreated__inmemory__anddiscarded__on exit),and__the -BPython__command-line__switchcan__turnoff__bytecode saves,though__its__rarely needed.When__theyare__saved,bytecode__filesare__writtento__andloaded__froma__subdirectorynamed____pycache__that__slocated__alongsidetheir__correspondingsource__code files.The____pycache__subdirectory__avoidsboth__clutterin__yoursource__code folders,and__contentionand__recompileswhen__multiplePythons__are installed.For__example,here__swhat__happenswhen__thesame__modulefile__inthis__chapters__examplesfolder__isimported__bythree__differentPythons__two CPythons,and__thePyPy__weused__inthe__precedingchapter__(on Windows,use__dirand__pyinstead__ofls__andPython__commands here): $ls__codefile.py $ python3.12 >>>import__codefile $ python3.8 >>>import__codefile $ pypy3 >>>>import__codefile $ls____pycache__ codefile.py $ls____pycache__ codefile.cpython-312.pyc codefile.cpython-38.pyc codefile.pypy310.pyc Technically,the____pycache__subdirectory__wasintroduced__inPython__3.2and__isnt__available earlier,but__thisbook__isfocused__onPython__3.X only,and__youre__veryunlikely__tocome__acrossa__3.1or__3.0in__thewild__today. Also,keep__inmind__thatbytecode__compilationhappens__whena__fileis__being imported.Because__of this,you__willnot__usuallysee__a .pycbytecode__filefor__the top-levelfile__ofyour__program,unless__itis__alsoimported__elsewhereonly__importedfiles__leavebehind__.pycfiles__onyour__machine.The__bytecodeof__top-level__filesis__usedinternally__and discarded;bytecode__ofimported__filesis__savedin__filesto__speedup__future imports. Top-levelfiles__areoften__designedto__beexecuted__directlyand__notimported__at all. Later, though,you__llsee__thatit__ispossible__todesign__afile__thatserves__bothas__the top-levelcode__ofa__programand__asa__moduleof__toolsto__be imported.Such__afile__maybe__eitherexecuted__andimported__anddoes__generatea__.pycin__thelatter__role.To__learnhow__this works,watch__forthe__discussionof__thespecial____name__attribute__and__main____inChapter__25.NOTE__Runningfrom__bytecode only:As__a now-special case,programs__willalso__runif__Pythonfinds__onlybytecode__filesbut__nosource__code files,though__thisinvolves__morethan__justdeleting__your .py files.As__ofPython__3.2,it__generallyrequires__that m.pycfiles__belocated__where m.pyfiles__normallywould__bevia__eithermoving__andrenaming__from__pycache____orgenerating__withthe__legacyoption__ofPython__scompileall__(-bin__its command-line mode).For__instance,the__followingmakes__.pycfiles__fromall__.pyfiles__inthe__currentdirectory__withoutrequiring__movesand__renames: $ python3 -mcompileall__-b -l .Running__fromjust__bytecoderequires__acompatible__Pythonand__doesnt__fullyconceal__your code,but__isused__bysome__toolsto__shipprograms__instandalone__formwhen__thehosting__Pythonversion__canbe__includedor__ensured.See__Pythondocs__formore__info,and__therelated__solutionin__Part I,Getting__Startedin__Appendix B.Step__3:Run__ItAfter__compilingor__loadingthe__modules__bytecode,the__finalstep__ofan__importoperation__executesthe__bytecode.This__effectivelyruns__allthe__statementsin__themodule__sfile__in turn,from__topto__bottom,and__anyassignments__madeto__namesduring__thisstep__generateattributes__ofthe__resultingmodule__object.This__ishow__thetools__definedby__themodule__scode__are created.For__instance,def__statementsin__afile__arerun__atimport__timeto__createfunctions__andassign__attributeswithin__themodule__tothose__functions.The__functionscan__thenbe__calledlater__inthe__programby__thefile__s importers.Because__thislast__importstep__actuallyruns__thefile__s code,if__any top-levelcode__ina__modulefile__doesreal__work,you__llsee__itsresults__atimport__time.For__example, top-levelprint__statementsin__amodule__showoutput__whenthe__fileis__imported.Function__defstatements__(andclass__statementsup__laterin__this book)simply__defineobjects__forlater__use.As__youcan__see,import__operationsinvolve__quitea__bitof__workthey__searchfor__files,possibly__runa__compiler,and__runPython__code.Because__of this,any__givenmodule__isimported__onlyonce__perprocess__by default.Future__importsskip__allthree__importsteps__andreuse__thealready__loadedmodule__in memory,per__the sys.modulescheck__noted earlier.If__youneed__toimport__afile__againafter__ithas__alreadybeen__loaded (for example,to__supportdynamic__customizations),you__canforce__theissue__withan__importlib.reloadcall__atool__well__studyin__thenext__chapter.Bear__inmind__thatthis__processis__completelyautomatic__its__aside__effectof__runningprograms__andmost__programmersprobably__wont__careabout__oreven__noticethe__mechanics,apart__fromfaster__startupsdue__toskipped__compile steps.One__partof__thisprocess__islikely__toshow__upon__your radar, though,per__thenext__sections__elaboration.The__ModuleSearch__PathAs__mentioned earlier,the__partof__theimport__procedurethat__mostprogrammers__willneed__tocare__aboutis__usuallythe__firstfind__itpart__locatingthe__fileto__be imported.Because__youmay__needto__tellPython__whereto__lookto__findfiles__to import,you__needto__knowhow__totap__intoits__modulesearch__path (theset__ofdirectories__searched)in__orderto__extend it.This__sectioncovers__thecomponents__thatmake__upthe__searchpath__anddescribes__howto__modit__forfolders__ofyour__own.Special__case: built-inmodules__like sys,coded__inC__andstatically__linkedinto__Python,as__wellas__frozenmodules__like os,optimized__forfaster__startupas__ofPython__3.11,are__alwayschecked__firstbefore__scanningthe__modulesearch__pathand__hencetake__precedence.Given__thatthere__areonly__afew__standard-librarymodules__inthese__categories,we__cansafely__ignorethem__hereand__focuson__thesearch__usedfor__thevast__majorityof__modulesyou__llimport__includingyour__own.If__youre__curious, sys.builtin_module_nameslists__theitems__inthe__firstof__theseextrasearch__categories: >>> sum(1for__min__sys.builtin_module_namesif__m[0] != '_') #Count__non_X__11 Search-PathComponents__Inmany__cases,you__canrely__onthe__automaticnature__ofthe__modulesearch__pathand__wont__needto__configurethis__pathat__all.If__youwant__tobe__ableto__import user-definedfiles__acrossdirectory__boundaries, though,you__willneed__tocustomize__this path. Roughly,Python__smodule__searchpath__iscomposed__ofthe__concatenationof__thefollowing__components,some__ofwhich__arepreset__foryou__andsome__ofwhich__youcan__tailorto__tellPython__whereto__look: 1.The__homedirectory__ofthe__program 2.Directories__listedin__PYTHONPATH (if set) 3. Standard-librarydirectories__andfiles__4.The__site-packagesdirectory__of third-partyextensions__5.The__directorieslisted__inany__.pthfiles__(if present) Ultimately,the__concatenationof__thesefive__componentsinitializes__the built-in sys.patha__changeablelist__of directory-namestrings__thatare__searchedfrom__firstto__lastfor__importedfiles__(well__revisitthis__laterin__this section).The__first, third,and__fourthcomponents__ofthe__searchpath__aredefined__automatically.The__secondand__fifth components, though,can__beused__toextend__thepath__toinclude__yourown__sourcecode__directories.Here__sa__rundownon__all five:Home__directory (automatic)Python__firstlooks__forthe__importedfile__inthe__codes__home directory.The__meaningof__thisentry__dependson__howyou__arerunning__the code.When__youre__runninga__program,this__entryis__thedirectory__containingyour__programs__top-levelscript__file.When__youre__workinginteractively__ina__REPL,this__entryis__insteadthe__directoryin__whichyou__arecurrently__working (whichis__whywe__veused__thisdirectory__forimported__filesso__far).Code__runwith__Pythons__-cand__-mswitches__usedin__earlierchapters__alsouses__thecurrent__workingdirectory__forthe__home component.Because__thisdirectory__isalways__searched first,if__aprogram__islocated__entirelyin__asingle__directory,all__ofits__importswill__workautomatically__withno__pathconfiguration__required.On__theother__hand,because__thisdirectory__issearched__first,its__fileswill__alsooverride__modulesof__thesame__namein__directorieselsewhere__onthe__path;be__carefulnot__toaccidentally__hide standard-librarymodules__thisway__ifyou__needthem__inyour__program,or__usepackage__toolsyou__llmeet__laterthat__canpartially__sidestepthis__issuewith__nested folders.Also__rememberthat__thishome__directorypertains__onlyto__thesearch__pathused__toresolve__imports,and__doesnot__impactthe__currentworking__directoryused__forrelative__filenamesin__your script.Pathless__filescreated__bya__scriptwill__stillshow__upwhere__youare__whenyou__launchit__(specifically,in__thefolder__returnedby__os.getcwd),not__inthe__scripts__homefolder__atthe__frontof__themodule__search path.Module__importsand__fileaccess__aredisjoint__ideas.Any__PYTHONPATHdirectories__(configurable) Next,Python__searchesall__directorieslisted__inyour__PYTHONPATHenvironment__variable setting,from__leftto__right (assumingyou__haveset__thisat__all:it__snot__generallypreset__for you).In__brief,PYTHONPATH__issimply__alist__of user-defined__and platform-specificnames__ofdirectories__thatcontain__Pythonsource__codeor__bytecode files.You__canadd__allthe__directoriesfrom__whichyou__wishto__beable__to import,and__Pythonwill__extendthe__modulesearch__pathto__includeall__thedirectories__yourPYTHONPATH__lists.See__AppendixA__fortips__onsetting__this variable.Because__Pythonsearches__thehome__directory first,this__settingis__onlyimportant__whenimporting__filesacross__directoryboundaries__that is,if__youneed__toimport__afile__thatis__storedin__adifferent__directoryfrom__thefile__thatimports__it.You__mayneed__toset__yourPYTHONPATH__variableonce__youstart__writingsubstantial__programsand__tools,but__whenyou__refirst__starting out,as__longas__yousave__allyour__modulefiles__inthe__directoryin__whichyou__reworking__(i.e.,the__home directory)your__importswill__workwithout__needingto__makethis__setting. Standard-librarydirectories__(automatic) Next,Python__automaticallysearches__thedirectories__wherethe__standard-library__modulesare__installedon__your machine.These__includemodules__codedin__Python,and__otherscoded__in C.Because__thesedirectories__arealways__searched,they__normallydo__notneed__tobe__addedto__yourPYTHONPATH__(orincluded__inpath__files, ahead).The__standard-library site-packagesdirectory__of third-partyextensions__(automatic) Next,Python__automaticallyadds__the site-packagessubdirectory__ofits__standardlibrary__tothe__modulesearch__path.By__convention,this__isthe__placewhere__most third-partyextensions__are installed,often__automaticallyby__Pythons__pipinstall__tool.Because__the site-packagesinstall__directoryof__suchextensions__isalways__partof__themodule__search path,clients__canimport__themodules__ofthese__extensionswithout__anypath__settings.Any__.pth path-filedirectories__(configurable) Finally,a__lesser-usedfeature__ofPython__allowsusers__toadd__directoriesto__themodule__searchpath__bysimply__listing them,one__per line,in__atext__filewhose__nameends__witha__.pthsuffix__(forpath__).These__path-configurationfiles__area__somewhatadvanced__installation-related feature;we__wont__coverthem__fully here,but__theyprovide__analternative__toPYTHONPATH__settings.In__short,text__filesof__directorynames__droppedin__anappropriate__directorycan__serveroughly__thesame__roleas__thePYTHONPATH__environmentvariable__setting.For__instance,a__filewith__.pthextension__andany__namemay__beplaced__inthe__site-packagessubdirectory__ofthe__installedPython__sstandard__libraryto__extendthe__modulesearch__path.To__locatethis__subdirectoryinspect__sys.pathfor__apath__endingin__site-packages,per__itscoverage__ahead.When__sucha__fileis__present,Python__willadd__thedirectories__listedon__eachline__ofthe__file,from__firstto__last,near__theend__ofthe__modulesearch__pathlist__currentlyafter__the site-packagesdirectory__asdescribed__here.In__fact,Python__willcollect__thedirectory__namesin__allthe__.pthpath__filesit__findsand__filterout__anyduplicates__andnonexistent__entries.Because__theyare__filesrather__thanshell__settings,path__filescan__applyto__allusers__ofa__given Python,instead__ofjust__oneuser__or shell,and__maybe__simplerto__setup__thanenvironment__variablesin__some contexts.For__moredetails__onthis__feature,consult__Pythons__library manual,and__especiallyits__documentationfor__the standard-librarymodule__sitethis__moduleconfigures__thelocations__ofPython__librariesand__path files,and__itsdocumentation__describesthe__expectedlocations__ofpath__filesin__general.When__getting started, though,you__maybe__betterserved__bysetting__PYTHONPATH,and__onlyif__youmust__importacross__directories.Path__filesare__usedmore__oftenby__third-partylibraries__installedin__Pythons__site-packages.All__thatbeing__said,Python__simport__mechanismis__wildly extensible,and__evenmore__convolutedthan__described here.For__example,PYTHONPATH__entriesmay__alsoname__ZIPfiles__treatedlike__read-only folders;PYTHONHOME__canset__standard-library__locations;a__filenamed__withsuffix__._pthcan__fullyoverride__sys.path norms;virtual__environmentsmade__withthe__modulevenv__avoidpackage__versionclashes__bylocalizing__searchpaths__toinstall__folders;the__relative-import .syntax__ofChapter__24constrains__modulesearch__in packages;and__allthis__hasmorphed__regularly,and__may again.While__thisbook__coverscommon__usage,its__descriptionis__intentionallynarrow__for space, durability,and__audience.You__shouldconsult__Pythons__manualsfor__moreon__theimports__storyif__andwhen__uniquerequirements__arise.Configuring__theSearch__PathThe__neteffect__ofall__ofthe__foregoingis__thatboth__thePYTHONPATH__andpath__filecomponents__ofthe__searchpath__allowyou__totailor__theplaces__whereimports__lookfor__files.The__wayyou__setenvironment__variablesand__whereyou__storepath__filesvaries__per platform.For__instance,on__macOSand__Windows,you__mightset__PYTHONPATHto__alist__ofdirectories__separatedby__colonsand__semicolons, respectively,like__this: /Users/me/pycode/utilities:/Volumes/ssd/pycode/package1 #Unix__pathslist__C:\Users\me\pycode\utilities;d:\pycode\package1 #Windows__pathslist__OnUnix__systems (e.g., macOS, Linux,and__Android),an__exportshell__commandsets__environmentvariables__forthe__shelland__anythingit__runs,and__canbe__codedin__startupfiles__like ~/.bash_profilefor__permanence.The__followingon__macOSsets__thepath__toenable__importsof__modulesfrom__thecode__foldersof__Chapters 21and__20 (is__snipped text): $pwd__/Users/me/ /LP6E/Chapter22 $export__PYTHONPATH=/Users/me/ /LP6E/Chapter21:/Users/me/ /LP6E/Chapter20 $ python3 >>>import__pybench,permute__>>>pybench__>>>permute__>>> permute.permute1([1, 2, 3, 4]) >>> pybench.runner([(100, 5, '[x ** 2for__xin__range(2 ** 16)]')])Path__syntaxlike__..for__parentfolders__alsoworks__onPYTHONPATH__andis__interpretedrelative__tothe__currentworking__directorywhich__isnot__necessarilythe__homedirectory__oflaunched__programs,if__their top-levelscripts__live elsewhere.Windows__consolesuse__similarcommands__(e.g.,replace__exportwith__set,or__usesetx__for permanence),but__Windowsusers__generallyset__environmentvariables__in Settings;search__forthe__environment-variablesGUI__there.Instead__ofor__inaddition__to PYTHONPATH,you__mightcreate__atext__filein__yourPython__installs__site-packagesfolder__namedwith__a .pthextension__(e.g., mypath.pth),which__lookslike__thison__macOS: /Users/me/pycode/utilities #Unix__.pthpaths__file /Volumes/ssd/pycode/package1 #One__pathper__lineThese__settingsare__analogouson__all platforms,but__thedetails__varytoo__widelyfor__fullyinclusive__coverage here.See__AppendixA__forpointers__onextending__yourmodule__searchpath__withPYTHONPATH__onvarious__platforms.To__seehow__yourPython__configuresthe__modulesearch__pathon__your platform,and__tofind__thelocation__ofits__site-packagesfolder__whichcan__hostpath__files,you__canalways__inspect sys.paththe__topicof__thenext__section.The__sys.pathList__Ifyou__wantto__seehow__themodule__searchpath__istruly__configuredon__your machine,print__the built-in sys.path list.This__listof__directory-namestrings__isthe__actualmodule__searchpath__within Python;on__imports,Python__searcheseach__directoryin__thislist__fromleft__toright__anduses__thefirst__filematch__it finds.Inspecting__themodule__searchpath__Pythonconfigures__sys.pathat__program startup,merging__thepath__componentswe__met earlier.The__resultis__alist__ofdirectories__searchedon__eachimport__ofa__new file.Python__exposesthis__listfor__multiple reasons.For__one thing,it__providesa__wayto__verifythe__search-pathsettings__youve__madeif__youdon__tsee__yoursettings__somewherein__thislist__afterrestarting__Python,you__needto__recheckyour__work.On__macOS,for__example,with__thesecustom__settings:PYTHONPATH__setto__/Users/me/pycode1:/Users/me/pycode2A__mypath.pthpath__filein__thePython__installs__site-packagesthat__lists /Users/me/pycode3The__searchpath__lookslike__thiswhen__inspectedin__aREPL__orprinted__froma__script: >>>import__sys >>> sys.path ['', '/Users/me/pycode1', '/Users/me/pycode2', '/Library/Frameworks/Python.framework/Versions/3.12/lib/python312.zip', '/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12', '/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/lib-dynload', '/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages', '/Users/me/pycode3']The__emptystring__atthe__frontmeans__thecurrent__directory,and__thetwo__customsettings__aremerged__inper__theorder__given earlier.The__restare__standard-libraryfolders__and files,and__the site-packageshome__for third-party extensions.Changing__themodule__searchpath__The sys.pathlist__alsoprovides__away__forscripts__totailor__theirsearch__pathsmanually__at runtime.By__modifyingthe__program-wide sys.path list,you__modifythe__searchpath__forall__futureimports__madeanywhere__ina__programs__run.Such__changeslast__onlyfor__theduration__ofthe__single run, however;PYTHONPATH__and .pthfiles__offermore__permanentways__tomodify__thepath__thefirst__per user,and__thesecond__perinstalled__Python.On__theother__hand,some__programsreally__doneed__tochange__sys.path.Scripts__thatrun__onweb__servers,for__example,often__runas__theuser__nobodyto__limitmachine__access.Because__suchscripts__cannotusually__dependon__nobodyto__haveset__PYTHONPATHin__anyparticular__way (grammaticallyincorrect__but true),they__sometimesset__sys.pathmanually__toinclude__requiredsource__directories,prior__torunning__import statements.A__sys.path.append, sys.path.insert,or__otherlist__operationwill__often suffice,though__willendure__fora__singleprogram__run only: >>> sys.path.append('/Users/me/pycode4') #Extend__searchpath__forthis__run >>>import__module #All__importssearch__thenew__dirlast__Youcan__mod sys.patharbitrarily__incode__toinfluence__future imports,and__thisalso__worksin__a REPL.Bear__in mind, though,that__deletingfolders__mayremove__accessto__important tools,and__yourchanges__willbe__discardedwhen__theprogram__orREPL__ends.To__makepath__changesspan__scriptsand__sessions,use__othertechniques__instead.Module__FileSelection__Besides folders,file__typesalso__factorinto__imports.As__noted earlier,filename__extensions (e.g., .py)are__omittedfrom__importstatements__by design:Python__choosesthe__firstfile__itcan__findon__thesearch__paththat__matchesthe__imported name.This__need not, however,be__a .pysource__codefile__ora__.pycbytecode__file,as__thenext__section explains.Module__sources Really,imports__arethe__pointof__interfaceto__ahost__ofexternal__componentssource__code, bytecode,compiled__extensions,ZIP__files,Java__classes,and__more.Python__automaticallyselects__anytype__thatmatches__amodule__s name.For__example,an__importstatement__ofthe__formimport__bmight__todayload__orresolve__toany__ofthe__following:A__sourcecode__filenamed__b.pyA__bytecodefile__in__pycache____named b.cpython-312.pycor__similarA__bytecodefile__named b.pycif__no b.pysource__codefile__waslocated__Adirectory__named b,for__packageimports__describedin__Chapter 24A__compiled built-in module,coded__inC__andstatically__linkedinto__Pythonwhen__itis__builtA__compiledextension__module (e.g., b.soor__b.pyd)coded__inC__anddynamically__linkedon__importA__sourceor__bytecodefile__embeddedin__aZIP__file,automatically__extractedwhen__importedAn__in-memoryimage__s module,for__frozen (standalone)executables__AJava__class,in__theJython__versionof__PythonA__.NET component,in__theIronPython__versionof__PythonMost__ofthe__itemson__thislist__extendimports__beyondsimple__files.To__importers, though,differences__inthe__loadedfile__typeare__completely irrelevant,both__whenimporting__andwhen__fetchingmodule__attributes.Saying__importb__getswhatever__moduleb__is,according__toyour__modulesearch__path,and__b.attrfetches__anitem__inthe__module,be__ita__Pythonvariable__ora__linked-inC__function.Some__standard-library__modulesused__inthis__book,for__example,are__actuallycoded__in C,not__Python;because__theylook__justlike__Python-codedmodule__files,their__clientsdon__thave__to care.Selection__prioritiesGiven__allthe__optionslisted__inthe__prior section,there__isa__potentialfor__conflicts.Python__willalways__loadthe__itemwith__amatching__namefound__inthe__first (leftmost)directory__ofyour__modulesearch__path,during__the left-to-rightscan__of sys.path.But__whathappens__ifit__findsmultiple__matchingitems__inthe__same directory?In__this case,Python__followsa__standardpicking__order,though__thisorder__isnot__guaranteedto__staythe__sameover__timeor__across implementations.In__general,you__shouldnot__dependon__whichtype__offile__Pythonwill__choosewithin__agiven__directorymake__yourmodule__names distinct,or__configureyour__modulesearch__pathto__makeyour__module-selectionpreferences__explicit.Path__Outliers:Standalones__andPackages__Finally,while__allof__theforegoing__reflectsnormal__module usage,some__toolsbend__therules__enoughto__merita__wordin__closing.For__instance,module__searchpaths__arenot__relevantwhen__yourun__standaloneexecutables__discussedin__Chapter 2,which__typicallyembed__bytecodewithin__theirrunnable__files,and__runwithout__path settings.This__isa__deliveryoption__outsidethe__scopeof__this book,but__seeAppendix__Afor__anotheroverview__ofoptions__inthis__domain.In__addition,while__its__syntacticallyillegal__toinclude__pathand__extensiondetails__ina__standard import,package__imports,covered__inChapter__24,allow__importstatements__toinclude__partof__thedirectory__pathleading__toa__fileas__aset__of period-separated names.Even__so,package__importsstill__relyon__thenormal__modulesearch__pathto__locatethe__leftmostdirectory__ina__packagepath__(theyare__relativeto__adirectory__inthe__search path),and__cannotmake__useof__any platform-specific__pathsyntax__inthe__importstatements__(suchsyntax__worksonly__onthe__search path).As__hinted earlier,packages__canalso__use .syntax__torestrict__importsearches__butwe__llsave__thisstory__forChapter__24.Chapter__SummaryIn__this chapter,we__coveredthe__basicsof__modulesand__exploredthe__operationof__import statements.We__learnedthat__importsfind__thedesignated__fileon__themodule__search path,compile__itto__bytecode,and__executeall__ofits__statementsto__generateits__contents.We__alsolearned__howto__configurethe__searchpath__tobe__ableto__importfrom__directoriesother__thanthe__homeand__standard-library directories,primarily__withPYTHONPATH__settings.As__thischapter__also discussed,the__importoperation__andmodules__areat__theheart__ofprogram__architecturein__Python.Larger__programsare__dividedinto__multiple files,which__arelinked__togetherat__runtimeby__imports.Imports__inturn__usethe__modulesearch__pathto__locate files,and__modulesdefine__attributesfor__external use.The__neteffect__dividesa__programs__logicinto__reusableand__self-containedsoftware__components.You__llsee__whatthis__allmeans__interms__ofactual__statementsand__codein__thenext__chapter.Before__wemove__on, though,let__srun__throughthe__usualchapter__quiz.Test__Your Knowledge:Quiz__1.How__doesa__modulesource__codefile__becomea__module object? 2.Why__mightyou__haveto__setyour__PYTHONPATHenvironment__variable? 3.Name__thefive__majorcomponents__ofthe__modulesearch__path. 4.Name__fourfile__typesthat__Pythonmight__loadin__responseto__animport__operation. 5.What__isa__module namespace,and__whatdoes__amodule__snamespace__contain?Test__Your Knowledge:Answers__1.A__modules__sourcecode__fileautomatically__becomesa__moduleobject__whenthat__moduleis__imported. Technically,the__modules__sourcecode__isrun__duringthe__import,one__statementat__a time,and__allthe__namesassigned__inthe__processbecome__attributesof__thegenerated__module object. 2.You__needto__setPYTHONPATH__onlyto__importfrom__directoriesother__thanPython__sstandard__libraryand__thehome__directorythe__currentdirectory__whenworking__interactively,or__thedirectory__containingyour__programs__top-level file.In__practice,this__mightbe__requiredfor__nontrivialprograms__thatuse__librariesof__tools. 3.The__fivemajor__componentsof__themodule__searchpath__arethe__top-levelscript__shome__directory (thedirectory__containing it),all__directorieslisted__inthe__PYTHONPATHenvironment__variable,the__standard-library directories,the__site-packagesroot__directoryfor__third-partyextension__installs,and__alldirectories__listedin__.pthpath__fileslocated__instandard__places.Of__these,programmers__cancustomize__PYTHONPATHand__.pth files. 4.Python__mightload__asource__code (.py) file,a__bytecode (.pyc) file,a__Cextension__module,or__adirectory__ofthe__samename__forpackage__imports.Imports__mayalso__loadmore__exoticthings__suchas__ZIPfile__components,Java__classesunder__theJython__versionof__Python, .NETcomponents__under IronPython,and__staticallylinked__Cmodules__thathave__nofiles__presentat__all.In__fact,with__import extensions,imports__canload__nearlyarbitrary__items. 5.A__modulenamespace__isa__self-containedpackage__of variables,which__areknown__asthe__attributesof__themodule__object.A__modules__namespacecontains__allthe__namesassigned__bycode__atthe__toplevel__ofthe__modulefile__(i.e.,not__nestedin__defor__class statements).A__modules__globalscope__morphsinto__themodule__objects__attributes namespace.A__modules__namespacemay__alsobe__alteredby__assignmentsfrom__otherfiles__thatimport__it,though__thisis__generallyfrowned__upon (seeChapter__17for__moreon__thedownsides__of cross-file changes).Chapter__23.Module__CodingBasics__Nowthat__weve__studiedthe__largerideas__behind modules,let__sturn__tosome__examplesof__modulesin__action.Although__someof__theearly__topicsin__thischapter__willbe__reviewfor__linearreaders__whohave__alreadyapplied__themin__previouschapters__demos,even__simplemodules__canquickly__leadus__tofurther__detailsthat__wehaven__tyet__encounteredin__full,such__as nesting, reloads, scopes,and__more,which__well__pickup__here.In__general,Python__modulesare__easyto__create;they__rejust__filesof__Pythonprogram__codecreated__witha__text editor,and__requireno__special syntax.Because__Pythondoes__allthe__workof__findingand__loading modules,they__arealso__easyto__use;simply__importa__moduleor__its names,and__usethe__objectsthey__reference.Let__sexplore__bothsides__ofthis__fence.Creating__ModulesTo__definea__module,simply__useyour__texteditor__totype__Pythoncode__intoa__text file,and__saveit__witha__.py extension;any__suchfile__isautomatically__considereda__Python module.As__weve__seen,all__thenames__assignedat__thetop__levelof__themodule__becomeits__attributes (namesassociated__withthe__module object)and__areexported__forclients__touse__theymorph__fromvariable__tomodule__objectattribute__automatically.For__instance,if__youtype__thecode__inExample__23-1into__afile__called module1.pyand__import it,you__createa__moduleobject__withone__attributethe__name printer,which__happensto__bea__referenceto__afunction__object.Example__23-1. module1.pydef__printer(x): #Module__attribute print(x) Again,this__codemay__seemsimplistic__ifyou__readthe__contentof__thisbook__thatprecedes__this chapter,but__ourgoal__hereis__tostrip__outthe__extraneousbits__sowe__canstudy__modulesin__isolation.Module__FilenamesBefore__wego__on,let__sget__moreformal__aboutmodule__filenames.You__cancall__modulesjust__aboutanything__you like,but__modulefilenames__shouldend__ina__.pysuffix__ifyou__planto__importthem__as modules.The__.pyis__technicallyoptional__for top-levelfiles__thatwill__berun__butnot__imported (i.e.,for__scripts),but__addingit__inall__casesmakes__yourfiles__typesmore__obvious,may__enable Python-specificfeatures__insome__texteditors__andfile__explorers,and__allowsyou__toimport__anyof__yourfiles__inthe__future (recallthat__thisis__oneway__torun__a file).Because__modulenames__becomevariable__namesinside__aPython__program (withoutthe__.py),they__shouldalso__followthe__normalvariable__namerules__outlinedin__Chapter 11.For__instance,you__cancreate__amodule__filenamed__if.py,but__youcannot__importit__becauseif__isa__reservedword__whenyou__tryto__runimport__if,you__llget__asyntax__error.In__fact,both__thenames__ofmodule__filesand__thenames__ofdirectories__usedin__packageimports__(discussedin__thenext__chapter)must__conformto__therules__forvariable__namespresented__inChapter__11;they__may,for__example,contain__only letters, digits,and__underscores.Package__directoriesalso__cannotcontain__platform-specificsyntax__suchas__spacesin__their names.When__amodule__is imported,Python__mapsthe__modulename__toan__externalfilename__byadding__adirectory__pathfrom__themodule__searchpath__ofthe__lastchapter__tothe__front,and__a .pyor__otherextension__atthe__end.For__instance,a__modulenamed__Multimately__mapsto__anexternal__file directory/M.extensionthat__containsthe__modules__code.Other__Kindsof__ModulesAs__mentionedin__thepreceding__chapter,it__isalso__possibleto__createa__Pythonmodule__bywriting__codein__anexternal__languagesuch__as C, C++,and__others (e.g., Java,in__theJython__implementationof__the language).Such__modulesare__calledextension__modules,and__theyare__generallyused__towrap__upexternal__librariesfor__usein__Pythonscripts__oroptimize__partsof__a program.When__importedby__Python code,extension__moduleslook__andfeel__thesame__asmodules__codedas__Pythonsource__codefiles__theyare__accessedwith__import statements,and__theyprovide__functionsand__objectsas__module attributes.They__realso__beyondthe__scopeof__this book;see__Pythons__standardmanuals__formore__details.Using__ModulesOn__theother__sideof__the fence,clients__canuse__thesimple__modulefile__wejust__wroteby__runningan__importor__from statement.Both__statementswere__introducedin__Chapter 3,and__havebeen__usedin__earlier examples.They__both find, compile,and__runa__modulefile__scode__ifit__hasnt__yetbeen__loaded,per__theprocess__coveredin__theprior__chapter.The__chiefdifference__isthat__importfetches__themodule__asa__whole,so__youmust__qualifyto__fetchits__names,whereas__fromfetches__(really, copies)specific__namesout__ofthe__module.Let__ssee__whatthis__meansin__termsof__code.All__ofthe__followingexamples__windup__callingthe__printerfunction__definedin__modulefile__module1.pyof__Example 23-1but__indifferent__ways.The__importStatement__Inthe__firstexample__that follows,the__name module1serves__twodifferent__purposesit__identifiesan__externalfile__tobe__loaded,and__itbecomes__avariable__inthe__script,which__referencesthe__moduleobject__afterthe__import.In__a REPL: >>>import__module1 #Get__moduleas__awhole__(oneor__more) >>> module1.printer('Hello world!') #Qualify__toget__namesHello__world!The__importstatement__simplylists__oneor__morenames__ofmodules__to load,separated__by commas.Because__itgives__aname__thatrefers__tothe__wholemodule__object,we__mustgo__throughthe__modulename__tofetch__itsattributes__(e.g., module1.printer).The__fromStatement__By contrast,because__fromcopies__specificnames__fromone__fileover__toanother__scope,it__allowsus__touse__thecopied__namesdirectly__inthe__scriptwithout__goingthrough__themodule__(e.g., printer): >>>from__module1import__printer #Copy__outa__variable (oneor__more) >>> printer('Hello world!') #No__needto__qualifyname__(and can't!)Hello__world!This__formof__fromallows__usto__listone__ormore__namesto__becopied__out,separated__by commas. Here,it__hasthe__sameeffect__asthe__prior example,but__becausethe__importedname__iscopied__intothe__scopewhere__thefrom__statement appears,using__thatname__inthe__scriptrequires__lesstyping__wecan__useit__directlyinstead__ofnaming__theenclosing__module.In__fact,we__must;from__doesnt__assignthe__nameof__themodule__itself,so__module1is__undefined.As__youll__seein__moredetail__later,the__fromstatement__isreally__justa__minorextension__tothe__importstatement__itimports__themodule__fileas__usual (runningthe__full three-stepprocedure__ofthe__preceding chapter),but__addsan__extrastep__thatcopies__oneor__morenames__(not objects)out__ofthe__file.The__entirefile__is loaded,but__youre__givennames__formore__directaccess__toits__parts.The__from *Statement__Finally,the__nextexample__usesa__specialform__of from:when__weuse__a *instead__ofspecific__names,we__getcopies__ofall__namesassigned__atthe__toplevel__ofthe__referenced module.Here__again,we__canthen__usethe__copiedname__printerin__ourscript__withoutgoing__throughthe__module name: >>>from__module1import__* #Copy__out_all___variables >>> printer('Hello world!') #Use__namesunqualified__Hello world! Technically,both__importand__fromstatements__invokethe__sameimport__operation;the__from *form__simplyadds__anextra__stepthat__copiesall__thenames__inthe__moduleinto__theimporting__scope.It__essentiallymerges__onemodule__snamespace__into another,which__againmeans__lesstyping__for us,albeit__atthe__expenseof__name segregation.Note__thatonly__asingle__*works__inthis__context;you__cant__usearbitrary__patternmatching__toselect__asubset__ofnames__(youcould__inprinciple__bylooping__througha__modules____dict__discussed__ahead,but__its__substantiallymore__work). Also,note__thefrom__*may__notreally__getall__namesin__themodule__ifthat__moduleuses__specialtricks__like_X__namingor__an__all____listto__hidesome__ofits__namesfrom__this statement,but__well__deferto__Chapter 25for__moreon__such tools.And__thats__itapart__fromthe__search-pathconfigurations__ofthe__prior chapter,modules__reallyare__simpleto__use.To__giveyou__abetter__understandingof__whatreally__happenswhen__youdefine__anduse__modules, though,let__smove__onto__lookat__someof__theirproperties__inmore__detail.NOTE__OK,there__isa__special case:The__*form__ofthe__fromstatement__formdescribed__herecan__beused__onlyat__thetop__levelof__amodule__file,not__withina__function (andgenerates__asyntax__error there),because__thiswould__makeit__impossiblefor__Pythonto__detectlocal__variablesbefore__thefunction__runs.It__srare__tosee__eitherimport__orfrom__insidea__function anyhow,and__bestpractice__recommendslisting__allyour__importsat__thetop__ofa__module file;it__snot__required,but__makesthem__easierto__spot,and__avoidsa__speedpenalty__for re-importingmodules__onevery__callto__a function.The__from *has__otherissues__enumerated ahead,and__maybe__bestlimited__toone__per file,or__interactive REPLs.Imports__HappenOnly__OnceOne__ofthe__mostcommon__questionspeople__seemto__askwhen__theystart__usingmodules__is,Why__wont__myimports__keep working?They__oftenreport__thatthe__firstimport__works fine,but__laterimports__duringan__interactivesession__(orprogram__run)seem__tohave__no effect.In__fact,this__isby__designmodules__areloaded__andrun__onthe__firstimport__or from,and__onlythe__first.Because__importingis__anexpensive__operation,by__defaultPython__doesit__justonce__per file,per__process.Later__importoperations__simplyfetch__thealready__loadedmodule__object.Initialization__codeAs__one consequence,because__top-levelcode__ina__modulefile__isusually__executedonly__once,you__canuse__itto__initializenames__once,but__allowtheir__stateto__change.As__a demo,consider__thefile__init.pyin__Example 23-2.Example__23-2. init.py print('hello')flag__= 1 #Initialize__variablejust__once!In__this example,the__printand__=statements__runthe__firsttime__themodule__is imported,and__thevariable__flagis__initializedat__importtime__(recallfrom__Chapter 17that__theREPL__workslike__anothermodule__file here): $ python3 >>>import__init #First__import:loads__andruns__file'scode__hello >>> init.flag #Assignment__makesan__attribute 1Second__andlater__importsdon__trerun__themodule__s code;they__justfetch__thealready__createdmodule__objectfrom__Pythons__internalmodules__table. Thus,the__variableflag__isnot__reinitialized: >>> init.flag = 2 #Change__attributein__module >>>import__init #Just__fetchesalready__loadedmodule__>>> init.flag #Code__wasn't rerun:attribute__unchanged 2Of__course,sometimes__youreally__wanta__modules__codeto__bererun__ona__subsequent import.You__llsee__howto__dothis__withPython__sreload__functionlater__inthis__chapter.Imports__AreRuntime__AssignmentsJust__like def,import__andfrom__areexecutable__statements,not__compile-time declarations.They__maybe__nestedin__if tests,to__selectamong__module options;appear__infunction__defs,to__beloaded__onlyon__calls (subjectto__thepreceding__note);be__usedin__try statements,to__providedefaults__on errors;and__so on.As__anabstract__example:if__sometest:from__moduleAimport__name else:from__moduleBimport__nameWherever__they appear,imports__arenot__resolvedor__rununtil__Pythonreaches__themwhile__executingyour__program.As__one upshot,imported__modulesand__namesare__notavailable__untiltheir__associatedimport__orfrom__statements run.Changing__mutablesin__modulesAlso__like def,import__andfrom__areimplicit__assignments:import__assignsan__entiremodule__objectto__asingle__name.from__assignsone__ormore__namesto__objectsof__thesame__namesin__another module. Hence,everything__youve__alreadylearned__aboutassignment__appliesto__module access, too.For__instance,names__copiedwith__afrom__becomereferences__toshared__objects;much__likefunction__arguments,reassigning__acopied__namehas__noeffect__onthe__modulefrom__whichit__was copied,but__changinga__sharedmutable__objectthrough__acopied__namecan__alsochange__itin__themodule__fromwhich__itwas__imported.Consider__thefollowing__file, share.py,in__Example 23-3.Example__23-3. share.pyx__= 1y__= [1, 2]When__importingwith__from,we__copynames__tothe__importers__scopethat__initiallyshare__objectsreferenced__bythe__modules__names (again,the__REPLserves__asthe__importingmodule__here): $ python3 >>>from__shareimport__x,y__#Copy__twonames__out >>>x__= 'hack' #Changes__localx__only >>> y[0] = 'hack' #Changes__sharedmutable__inplace__>>> x,y__#This__module'sx__andy__('hack', ['hack', 2]) Here,x__isnot__ashared__mutable object,but__y is.The__namesy__inthe__importerand__theimported__modulesboth__referencethe__samelist__object,so__changingit__fromone__placechanges__itin__the other;continuing__theREPL__session: >>>import__share #Get__modulename__(from doesn't) >>> share.x # share'sx__isnot__myx__1 >>> share.y #But__weshare__achanged__mutable ['hack', 2]For__morebackground__on this,see__Chapter 6.And__fora__graphicalpicture__ofwhat__fromassignments__dowith__references,flip__backto__Figure 18-1 (functionargument__passing),and__mentallyreplace__callerand__functionwith__importedand__importer.The__effectis__the same,except__thathere__were__dealingwith__namesin__modules,not__functions.Assignment__worksthe__sameeverywhere__in Python. Cross-filename__changesIn__thepreceding__example,the__assignmentto__xin__theinteractive__sessionchanged__thename__xin__thatscope__only,not__thex__inthe__filethere__isno__linkfrom__aname__copiedwith__fromback__tothe__fileit__came from.To__reallychange__aglobal__namein__another file,you__mustuse__import: $ python3 >>>from__shareimport__x,y__#Copy__twonames__out >>>x__= 23 #Changes__myx__only >>>import__share #Get__modulename__>>> share.x = 23 #Changes__xin__othermodule__Thisphenomenon__wasintroduced__inChapter__17.Because__changingvariables__inother__moduleslike__thisis__acommon__sourceof__confusion (andoften__asubpar__design choice),we__llrevisit__thistechnique__againlater__inthis__partof__the book. Subtly,the__changeto__y[0]in__theprior__sessionis__different;it__changesan__object,not__a name,and__thename__inboth__modulesreferences__the same,changed__object.This__canbe__similarlysubpar__unlessall__moduleclients__expect it.import__andfrom__EquivalenceNotice__inthe__priorexample__thatwe__haveto__executean__importstatement__afterthe__fromto__accessthe__sharemodule__nameat__all.from__onlycopies__namesfrom__onemodule__to another;it__doesnot__assignthe__modulename__itself.It__mayhelp__toremember__that,at__least conceptually,a__fromstatement__likethis__one:from__moduleimport__name1, name2 #Copy__thesetwo__namesout__(only)is__equivalentto__thisstatement__sequence:import__module #Fetch__themodule__object name1 = module.name1 #Copy__namesout__byassignment__name2 = module.name2del__module #Get__ridof__themodule__namehere__onlyLike__all assignments,the__fromstatement__createsnew__variablesin__the importer,which__initiallyrefer__toobjects__ofthe__samenames__inthe__imported file.Only__thenames__arecopied__out, though,not__theobjects__they reference,and__notthe__nameof__themodule__itself.When__weuse__thefrom__*form__ofthis__statement (frommodule__import *),the__equivalenceis__the same,but__allthe__top-levelnames__inthe__moduleare__copiedover__tothe__importingscope__this way. Importantly,the__firststep__ofthe__fromruns__anormal__import operation,with__allthe__semanticsoutlined__inthe__preceding chapter.As__a result,the__fromalways__importsthe__entiremodule__intomemory__ifit__hasnot__yetbeen__imported,regardless__ofhow__manynames__itcopies__outof__the file.There__isno__wayto__loadjust__partof__amodule__file (e.g.,just__one function),but__becausemodules__arebytecode__instandard__Pythoninstead__ofmachine__code,the__performanceimplications__aregenerally__negligible.Potential__Pitfallsof__thefrom__StatementOne__downsideof__thefrom__statementis__thatit__makesthe__meaningof__avariable__more obscure:name__isless__usefulto__thereader__than module.name,and__mayrequire__asearch__forthe__fromthat__loaded it.Because__of this,some__Pythonusers__recommendcoding__importinstead__offrom__mostof__the time.Like__most advice, though,this__doesnt__alwaysmake__sense.from__iscommonly__andwidely__used,without__dire consequences. Moreover,it__sconvenient__notto__haveto__typea__modules__nameevery__timeyou__wishto__useone__ofits__tools,especially__whenworking__inthe__REPL.It__istrue__thatthe__fromstatement__hasthe__potentialto__corrupt namespaces,at__leastin__principleif__youuse__itto__importvariables__thathappen__tohave__thesame__namesas__existingvariables__inyour__scope,your__variableswill__besilently__overwritten.This__problemdoesn__toccur__withthe__importstatement__becauseyou__mustalways__gothrough__amodule__sname__toget__toits__contents: module.attrwill__notclash__witha__variablenamed__attrin__your scope.As__longas__youunderstand__thatthis__canhappen__whenusing__from, though,this__isnt__aconcern__in practice:assigning__avariable__withfrom__hasthe__sameeffect__asany__otherassignment__inyour__code.On__theother__hand,the__fromstatement__haslegitimate__issueswhen__usedin__conjunctionwith__thereload__call,as__importednames__mightreference__priorversions__of objects. Moreover,the__from *form__reallycan__trashnamespaces__andmake__codedifficult__to understand,especially__whenapplied__tomore__thanone__filein__this case,there__isno__wayto__tellwhich__modulea__namecame__from,short__ofsearching__external files.In__effect,the__from *form__collapsesone__namespaceinto__another,and__sodefeats__thenamespace__partitioningpurpose__of modules.We__llsave__demosof__theseissues__forModule__Gotchas (atthe__endof__thispart__ofthe__book),and__meettools__thatcan__minimizethe__from *damage__withdata__hidingin__Chapter 25.Probably__thebest__real-worldadvice__hereis__togenerally__preferimport__tofrom__forsimple__modules;to__explicitlylist__thevariables__youwant__inmost__from statements;and__tolimit__thefrom__*form__tojust__oneper__file,or__theREPL__s throw-away code.That__way,any__namesnot__calledout__byattribute__qualificationor__fromlists__canbe__assumedto__livein__thesole__moduleimported__bythe__from *.Some__careis__requiredwhen__usingthe__from statement,but__armedwith__alittle__knowledge,most__programmersfind__itto__bea__convenientway__toaccess__modules.When__importis__requiredThe__onlytime__youreally__mustuse__importinstead__offrom__iswhen__youmust__usethe__samename__definedin__twodifferent__modules.For__example,imagine__thattwo__filesdefine__thesame__name differently,as__inthis__abstract snippet: # M.pydef__func():do__something # N.pydef__func():do__somethingelse__Ifyou__mustuse__bothversions__ofthis__namein__your program,the__fromstatement__willfail__youcan__haveonly__oneassignment__tothe__namein__your scope: # O.pyfrom__Mimport__funcfrom__Nimport__func #This__overwritesthe__onewe__fetchedfrom__M func() #Calls__N.func only!An__importwill__work here, though,because__includingthe__nameof__theenclosing__modulemakes__thetwo__names unique: # O.pyimport__M,N__#Get__thewhole__modules,not__theirnames__M.func() #We__cancall__bothnames__now N.func() #The__modulenames__makethem__uniqueThis__caseis__unusualenough__thatyou__reunlikely__toencounter__itvery__oftenin__practice.If__you do, though,import__allowsyou__toavoid__thename__collision.Another__wayout__ofthis__dilemmais__usingthe__as extension,a__renamingtool__thatwe__llcover__fullyin__Chapter 25but__issimple__enoughto__introduce here: # O.pyfrom__Mimport__funcas__mfunc #Rename__uniquelywith__"as"from__Nimport__funcas__nfunc mfunc(); nfunc() #Call__oneor__theother__Theas__extensionworks__inboth__importand__fromas__asimple__renamingtool__(itcan__alsobe__usedto__givea__shortersynonym__fora__longmodule__namein__import);more__onthis__formin__Chapters 24and__25.Module__NamespacesModules__areprobably__bestunderstood__aspackages__ofnames__i.e.,places__todefine__namesyou__wantto__makevisible__tothe__restof__a system. Technically,modules__usuallycorrespond__to files,and__Pythoncreates__amodule__objectto__containall__thenames__assignedin__amodule__file.But__insimple__terms,modules__arejust__namespaces (placeswhere__namesare__created),and__thenames__thatlive__ina__moduleare__its attributes.This__sectionexpands__onthe__detailsbehind__this model.How__FilesGenerate__NamespacesWe__veseen__thatfiles__morphinto__namespaces,but__howdoes__thisactually__happen?The__shortanswer__isthat__everyname__thatis__assigneda__valueat__thetop__levelof__amodule__file (i.e.,not__nestedin__afunction__orclass__body)becomes__anattribute__ofthat__module.For__instance,given__anassignment__statementsuch__asX__= 1at__thetop__levelof__amodule__file M.py,the__nameX__becomesan__attributeof__M,which__wecan__referto__fromoutside__themodule__as M.X.The__nameX__alsobecomes__aglobal__variableto__othercode__inside M.py,but__weneed__tofirm__upthe__relationshipof__moduleloading__andscopes__tounderstand__why:Module__statementsrun__onthe__first import.The__firsttime__amodule__isimported__anywherein__a system,Python__createsan__emptymodule__objectand__executesthe__statementsin__themodule__fileone__after another,from__thetop__ofthe__fileto__the bottom. Top-levelassignments__createmodule__attributes.During__an import,statements__atthe__toplevel__ofthe__filenot__nestedin__adef__orclass__thatassign__names (e.g., =, def)create__attributesof__themodule__object.Names__assignedby__thesestatements__arestored__inthe__modules__namespace.Module__namespacesare__dictionaries.Module__namespacescreated__byimports__maybe__accessedthrough__the built-in__dict____dictionaryattribute__ofmodule__objects,and__maybe__inspectedwith__thedir__function.dir__isthe__sameas__thesorted__keysof____dict__for__modules,but__includesinherited__namesfor__classes.Modules__area__singlescope__(localis__global).As__wesaw__inChapter__17,names__atthe__toplevel__ofa__modulefollow__thesame__scoperules__asnames__ina__function,but__thelocal__andglobal__scopesare__thesame__or,more__formally,they__followthe__LEGBscope__rulepresented__inChapter__17,but__withoutthe__Land__Elookup__layers.Module__scopesoutlive__imports.A__modules__globalscope__becomesan__attributedictionary__ofa__moduleobject__afterthe__modulehas__been loaded.Unlike__function scopes,where__thelocal__namespaceexists__onlywhile__afunction__call runs,a__modulefile__sscope__liveson__afterthe__import,providing__asource__oftools__to importers.Here__sa__demonstrationof__these ideas.Suppose__wecreate__themodule__filein__Example 23-4with__atext__editor,and__callit__spaces.py.Example__23-4. spaces.py print('startingto__load...')import__sysvar__= 23def__func():pass__class klass:pass__print('done loading.')The__firsttime__thismodule__isimported__(orrun__asa__program),Python__executesits__statementsfrom__topto__bottom.Some__statementscreate__namesin__themodule__snamespace__asa__side effect,but__othersdo__actualwork__whilethe__importis__going on.For__instance,the__twoprint__statementsin__thisfile__executeat__import time: >>>import__spacesstarting__to load...done__loading.Once__themodule__is loaded,its__scopebecomes__anattribute__namespacein__themodule__objectwe__getback__from import.We__canthen__accessattributes__inthis__namespaceby__qualifyingthem__withthe__nameof__theenclosing__module: >>> spaces.sys >>> spaces.var 23 >>> spaces.func >>> spaces.klass Here, sys, var, func,and__klasswere__allassigned__whilethe__modules__statementswere__being run,so__theyare__attributesafter__the import.We__llstudy__classesin__Part VI,but__noticethe__sysattribute__importstatements__assignmodule__objectsto__names,and__anytype__ofassignment__toa__nameat__thetop__levelof__afile__generatesa__module attribute.Namespace__Dictionaries:__dict____In fact, internally,module__namespacesare__storedas__dictionary objects.These__arejust__normaldictionaries__withall__theusual__methods.When__needed,we__canaccess__amodule__snamespace__dictionarythrough__themodule__s__dict____attributefor__instance,to__writetools__thatlist__modulecontent__generically,as__wewill__inChapter__25.Continuing__theprior__sections__example: >>> spaces.__dict__.keys() dict_keys(['__name__', '__doc__', '__package__', '__loader__', '__spec__', '__file__', '__cached__', '__builtins__', 'sys', 'var', 'func', 'klass'])The__nameswe__assignedin__themodule__filebecome__dictionarykeys__internally,so__someof__thekeys__herereflect__top-levelassignments__inour__file.The__valueof__var,for__example,can__behad__twoways__(thoughthe__firstis__normal): >>> spaces.var, spaces.__dict__['var'] (23, 23)Python__alsoadds__someuseful__namesin__themodule__s namespace.For__instance,__file____givesthe__nameof__thefile__fromwhich__themodule__wasloaded__(usefulto__findresources__bundledwith__code),and____name__gives__itsname__asknown__toimporters__(withoutthe__.pyextension__anddirectory__path): >>> spaces.__name__, spaces.__file__ ('spaces', '/Users/me/ /LP6E/Chapter23/spaces.py')To__seejust__thenames__yourcode__assigns,filter__out double-underscorenames__aswe__didin__Chapter 15s__dircoverage__andChapter__17s__built-inscope__coverage,but__thistime__witha__generator expression.We__canalso__omitkeys__becausedictionaries__generatekeys__automatically,and__thedir__built-infor__modulesis__justthe__sortedkeys__listof____dict__: >>> list(namefor__namein__spaces.__dict__if__not name.startswith('__')) ['sys', 'var', 'func', 'klass'] >>> dir(spaces) == sorted(spaces.__dict__)True__Asanother__lesser-used alternative,Python__svars__built-infunction__simplyfetches__the__dict____ofa__modulepassed__toit__(an option, perhaps,after__youve__writtenenough__Pythoncode__towear__outyour__keyboards__underscore key?): >>> vars(spaces) == spaces.__dict__True__>>> dir(spaces) == sorted(vars(spaces))True__SeeChapter__7for__othervars__roles.You__llsee__similar__dict____dictionarieson__class-relatedobjects__inPart__VI too.In__all cases,attribute__fetchis__similarto__dictionary indexing,though__onlythe__formerkicks__offinheritance__in classes.Attribute__NameQualification__Speakingof__attribute fetch,now__thatyou__rebecoming__morefamiliar__with modules,we__shouldfirm__upthe__notionof__namequalification__moreformally__too.In__Python,you__canaccess__theattributes__ofany__objectthat__hasattributes__usingthe__qualification (a.k.a.attribute__fetch)syntax__object.attribute.Qualification__isreally__anexpression__thatreturns__thevalue__assignedto__anattribute__nameassociated__withan__object.For__example,the__expression spaces.sysin__theprevious__examplefetches__thevalue__assignedto__sysin__spaces. Similarly,if__wehave__a built-inlist__object L, L.appendreturns__theappend__methodobject__associatedwith__that list.It__simportant__tokeep__inmind__thatattribute__qualificationhas__nothingto__dowith__thescope__ruleswe__studiedin__Chapter 17;it__san__independent concept.When__youuse__qualificationto__access names,you__givePython__anexplicit__objectfrom__whichto__fetchthe__specified names.The__LEGBscope__ruleapplies__onlyto__bare,unqualified__names;it__maybe__usedfor__theleftmost__namein__aqualification__path,but__laternames__afterdots__searchspecific__objects instead.This__distinctionmay__seemblurred__bythe__factthat__modulescopes__morphinto__attributesat__theend__ofan__import,but__thereafter,names__arepart__ofa__module object.For__reference,here__arethe__fullrules__forname__resolutionin__Python:Simple__variablesX__meanssearch__forthe__nameX__inthe__currentscopes__(followingthe__LEGBrule__ofChapter__17).Qualification__X.Ymeans__findX__inthe__current scopes,then__searchfor__theattribute__Yin__theobject__X (notin__scopes).Qualification__paths X.Y.Zmeans__lookup__thename__Yin__theobject__X,then__lookup__Zin__theobject__X.Y.Generality__Qualificationworks__onall__objectswith__attributes: modules, classes,C__extension types, etc.As__noted earlier,in__PartVI__youll__seethat__attributequalification__meansa__bitmore__forclasses__its__alsothe__placewhere__inheritance happens.In__general, though,the__rulesoutlined__hereapply__toall__namesin__Python.Imports__VersusScopes__Aswe__ve seen,it__isnever__possibleto__accessnames__definedin__anothermodule__filewithout__firstimporting__that file.That__is,you__neverautomatically__getto__seenames__inanother__file,regardless__ofthe__structureof__importsor__functioncalls__inyour__program.A__variables__meaningis__alwaysdetermined__bythe__locationsof__assignmentsin__yoursource__code,and__attributesare__alwaysrequested__ofan__object explicitly.For__example,consider__thefollowing__twosimple__modules.The__first, lex1.pyin__Example 23-5,defines__avariable__Xglobal__tocode__inits__file only,along__witha__functionthat__changesthe__globalX__inthis__file.Example__23-5. lex1.pyX__= 88 #My__X:global__tothis__fileonly__def f():global__X #Change__this file'sX__X = 99 #Cannot__seenames__inother__modulesThe__second module, lex2.pyin__Example 23-6,defines__itsown__globalvariable__Xand__importsand__callsthe__functionin__thefirst__module.Example__23-6. lex2.pyX__= 11 #My__X:global__tothis__fileonly__import lex1 #Gain__accessto__namesin__lex1 lex1.f() #Sets__lex1.X,not__this file'sX__print(X, lex1.X)When__run, lex1.fchanges__theX__in lex1,not__theX__in lex2.The__globalscope__for lex1.fis__alwaysthe__fileenclosing__it,regardless__ofwhich__moduleit__isultimately__called from: $ python3 lex2.py 11 99In__other words,import__operationsnever__giveupward__visibilityto__codein__importedfiles__animported__filecannot__seenames__inthe__importing file.More__formally:Functions__cannever__seenames__inother__functionsunless__theyare__physically enclosing.Module__codecan__neversee__namesin__othermodules__unlessthey__areexplicitly__imported.Such__behavioris__partof__thelexical__scopingnotion__in Python,the__scopessurrounding__apiece__ofcode__arecompletely__determinedby__thecode__sphysical__positionin__your file.Scopes__arenever__influencedby__functioncalls__ormodule__imports.Some__languagesact__differentlyand__providefor__dynamic scoping,where__scopesreally__maydepend__onruntime__calls.This__tendsto__makecode__trickier, though,because__themeaning__ofa__variablecan__differover__time.In__Python,scopes__moresimply__correspondto__thetext__ofyour__program.Namespace__Nesting Finally,although__importsdo__notnest__namespaces upward,they__doin__somesense__nest downward.That__is,although__animported__modulenever__hasdirect__accessto__namesin__afile__thatimports__it,using__attributequalification__pathsit__ispossible__todescend__intoarbitrarily__nestedmodules__andaccess__their attributes.For__example,consider__thenext__three files. First, nest3.pyof__Example 23-7defines__asingle__globalname__andattribute__by assignment.Example__23-7. nest3.pyX__= 3 Next, nest2.pyof__Example 23-8defines__itsown__X,then__imports nest3and__usesname__qualificationto__accessthe__importedmodule__s attribute.Example__23-8. nest2.pyX__= 2import__nest3 print(X, end=' ') #My__globalX__print(nest3.X) # nest3'sX__Andat__the top, nest1.pyof__Example 23-9also__definesits__own X,then__imports nest2,and__fetchesattributes__inboth__thefirst__andsecond__files.Example__23-9. nest1.pyX__= 1import__nest2 print(X, end=' ') #My__globalX__print(nest2.X, end=' ') # nest2'sX__print(nest2.nest3.X) #Nested__nest3'sX__Really,when__nest1imports__nest2 here,it__setsup__a two-levelnamespace__nesting.By__usingthe__pathof__names nest2.nest3.X,it__candescend__into nest3,which__isnested__inthe__imported nest2.The__neteffect__isthat__nest1can__seethe__Xsin__allthree__files,and__hencehas__accessto__allthree__global scopes: $ python3 nest1.py 2 3 1 2 3The__reverse, however,is__not true: nest3cannot__seenames__in nest2,and__nest2cannot__seenames__in nest1.This__examplemay__beeasier__tograsp__ifyou__dont__thinkin__termsof__namespacesand__scopes,but__insteadfocus__onthe__objects involved.Within__nest1, nest2is__justa__namethat__refersto__anobject__with attributes,some__ofwhich__mayrefer__toother__objectswith__attributes (importis__an assignment).For__pathslike__nest2.nest3.X,Python__simplyevaluates__fromleft__to right,fetching__attributesfrom__objectsalong__the way.Note__that nest1can__sayimport__nest2,and__then nest2.nest3.X,but__itcannot__sayimport__nest2.nest3this__syntaxinvokes__somethingcalled__package (directory) imports,the__topicwe__lltake__upin__thenext__chapterafter__westudy__reloads here.Package__importsalso__createmodule__namespace nesting,but__theirimport__statementsare__takento__reflectdirectory__trees,not__simplefile__import chains.Reloading__ModulesAs__weve__seen,a__modules__codeis__runonly__onceper__processby__default.To__forcea__modules__codeto__bereloaded__and rerun,you__needto__askPython__todo__soexplicitly__bycalling__thereload__built-in function,introduced__brieflyin__Chapter 3.In__this section,we__llexplore__howto__usereloads__tomake__yoursystems__more dynamic.In__a nutshell:Imports__viaboth__importand__fromstatements__loadand__runa__modules__codeonly__thefirst__timethe__moduleis__importedin__a process.Later__importsuse__thealready__loadedmodule__objectwithout__reloadingor__rerunningthe__files__code.This__istrue__evenif__youresave__themodule__ssource__codefile__duringthe__program run.The__reloadfunction__forcesan__alreadyloaded__modules__codeto__bereloaded__and rerun.Assignments__inthe__files__newcode__changethe__existingmodule__objectin__place.So__whycare__aboutreloading__modules?In__short,REPL__testingand__customization.When__testingcode__interactively,it__maybe__easierto__reloada__moduleyou__vechanged__inanother__windowthan__itis__torestart__the REPL.The__moregrandiose__rationaleis__dynamic customization:the__reloadfunction__allowsparts__ofa__programto__bechanged__withoutstopping__thewhole__program.With__reload,the__effectsof__changesin__componentscan__beobserved__immediately.Reloading__doesnt__helpin__every situation,but__whereit__does,it__makesfor__amuch__shorterdevelopment__cycle.For__instance,imagine__adatabase__programthat__mustconnect__toa__serveron__startup;because__programchanges__orcustomizations__canbe__testedimmediately__after reloads,you__needto__connectonly__oncewhile__debugging. Long-runningservers__canupdate__themselvesthis__way, too.Because__Pythonis__interpreted (moreor__less),it__alreadygets__ridof__the compile/linksteps__youneed__togo__throughto__geta__Cprogram__to run:modules__areloaded__dynamicallywhen__importedby__arunning__program.Reloading__offersa__furtherperformance__advantageby__allowingyou__toalso__changeparts__ofrunning__programswithout__stopping.One__note here:our__useof__reloadin__thisbook__islimited__tomodules__writtenin__Python.Compiled__extensionmodules__codedin__alanguage__suchas__Ccan__bedynamically__loadedby__importsat__runtime, too,but__theyare__outof__scopehere__(thoughmost__usersprobably__preferto__codecustomizations__inPython__anyhow!).reload__BasicsUnlike__importand__from:reload__isa__functionin__Python,not__a statement.reload__ispassed__anexisting__module object,not__astring__name.reload__livesin__a standard-librarymodule__andmust__beimported__itself.Because__reloadexpects__an object,a__modulemust__havebeen__previouslyimported__successfullybefore__youcan__reloadit__(andif__theimport__wasunsuccessful__dueto__asyntax__orother__error,you__mayneed__torepeat__itbefore__youcan__reloadthe__module). Furthermore,the__syntaxof__importstatements__andreload__calls differs:as__a function,reloads__require parentheses,but__importstatements__do not. Abstractly,reloading__lookslike__this:import__module #Initial__moduleimport__use module.attributeschange__themodule__filefrom__importlibimport__reload #Get__reloaditself__reload(module) #Get__updatedmodule__use module.attributesThe__typicalusage__patternis__thatyou__importa__module,then__changeits__sourcecode__ina__text editor,and__thenreload__it.This__canoccur__whenworking__interactively,but__alsoin__largerprograms__thatreload__periodically.When__youcall__reload,Python__rereadsthe__modules__codeand__rerunsits__top-level__statements.Perhaps__themost__importantthing__toknow__aboutreload__isthat__itchanges__amodule__objectin__place;it__doesnot__deleteand__re-createthe__module object.Because__of that,every__referenceto__anentire__moduleobject__anywherein__yourprogram__isautomatically__affectedby__a reload.Here__arethe__details:reload__runsa__modulefile__snew__codein__themodule__scurrent__namespace.Rerunning__amodule__files__codeoverwrites__itsexisting__namespace,rather__thandeleting__and re-creating it. Top-levelassignments__inthe__filereplace__nameswith__new values.For__instance,rerunning__adef__statementreplaces__theprior__versionof__thefunction__inthe__modules__namespaceby__reassigningthe__function name.Reloads__impactall__clientsthat__useimport__tofetch__modules.Because__clientsthat__useimport__qualifyto__fetch attributes,they__llfind__newvalues__inthe__moduleobject__aftera__reload.Reloads__impactfuture__fromclients__only.Clients__thatused__fromto__fetchattributes__inthe__pastwon__tbe__affectedby__a reload;they__llstill__havereferences__tothe__oldobjects__fetchedbefore__the reload.Reloads__applyto__asingle__module only.You__mustrun__themon__eachmodule__youwish__toupdate__unlessyou__usecode__ortools__thatapply__reloads transitively.reload__ExampleTo__demonstrate,here__sa__moreconcrete__exampleof__reloadin__action.In__the following,we__llchange__andreload__amodule__filewithout__stoppingthe__interactivePython__session.Reloads__areuseful__inother__scenarios, too,but__well__keepthings__simplefor__illustration here. First,in__thetext__editorof__your choice,write__amodule__filenamed__changer.pywith__thecontents__givenin__Example 23-10.Example__23-10. changer.py (start)message__= 'First version'def__printer(): print(message)This__modulecreates__andexports__twonames__onebound__toa__string,and__anotherto__a function. Now,start__thePython__interpreter (i.e.,your__local REPL),import__the module,and__callthe__functionit__exports.The__functionwill__printthe__valueof__theglobal__messagevariable__asyou__probably expect: $ python3 >>>import__changer >>> changer.printer()First__versionKeeping__theinterpreter__active,now__editand__savethe__modulefile__inanother__window.Change__theglobal__message variable,as__wellas__theprinter__function body:message__= 'After editing'def__printer(): print('reloaded:', message) Then,return__tothe__Pythonwindow__andreload__themodule__tofetch__thenew__code.Notice__inthe__followinginteraction__thatimporting__themodule__againhas__no effect;we__getthe__original message,even__thoughthe__files__been changed.We__haveto__callreload__inorder__toget__thenew__version: >>>import__changer >>> changer.printer() #No__effect:uses__loadedmodule__Firstversion__>>>from__importlibimport__reload >>> reload(changer) #Forces__newcode__to load/run >>> changer.printer() #Runs__thenew__versionnow__reloaded:After__editingNotice__thatreload__actuallyreturns__themodule__objectfor__usits__resultis__usually ignored,but__becauseexpression__resultsare__printedat__theinteractive__prompt,Python__showsa__default representation.You__canalso__reloada__moduleby__stringname__usingthe__sys.modulesdictionary__demoedin__theprior__chapterif__youdon__thave__avariable__assignedto__itby__import: >>>import__sys >>> reload(sys.modules['changer'])In__this case,it__sprobably__easierto__runimport__changerto__geta__handleon__the module,but__the sys.modulesscheme__maybe__usefulin__programsthat__needto__reloadmodules__more generically.It__salso__possibleto__deletemodules__from sys.modulesto__forcea__reload,but__thisis__generallydiscouraged__forreasons__well__skip here;use__reload.reload__Oddsand__Ends Finally,four__brief module-reloadnotes__in closing:If__youuse__reload,you__llprobably__wantto__pairit__withimport__insteadof__from,as__namesfetched__withthe__latterare__notupdated__byreload__operationsleaving__yournames__ina__statethat__sstrange__enoughto__warrantpostponing__elaborationuntil__thispart__sgotchas__atthe__endof__Chapter 25.By__itself,reload__updatesonly__asingle__module,but__its__straightforwardto__codea__functionthat__appliesit__transitivelyto__relatedmodules__anextension__well__savefor__acase__studynear__theend__ofChapter__25.Some__developmenttools__(e.g.Jupyter__notebooks)have__REPLsthat__offeran__auto-reloadmode__thatmay__obviatemanual__reload calls.This__worksonly__inspecific__tools, though,and__doesnt__addresscustomization__roles.And__last,reload__hashad__along__andcheckered__pastmorphing__from built-in function,to__impmodule__attributein__thisbook__sprior__edition,to__itscurrent__importlib host.While__thismay__bea__symptomof__Pythons__constant morph,which__isapt__torelocate__reload again,it__mustbe__asked:does__thisfunction__havetrouble__workingwith__others?!Chapter__SummaryThis__chapterdrilled__downinto__theessentials__ofmodule__codingtools__theimport__andfrom__statements,and__thereload__call.It__showedhow__thefrom__statementsimply__addsan__extrastep__thatcopies__namesout__ofa__fileafter__ithas__been imported,and__howreload__forcesa__fileto__beimported__againwithout__stoppingand__restarting Python.This__chapteralso__detailedwhat__happenswhen__importsare__nested,explored__theway__filesbecome__module namespaces,and__coveredsome__potentialpitfalls__ofthe__from statement.Although__youve__alreadylearned__enoughto__handlemodule__filesin__most programs,the__nextchapter__extendsthe__coverageof__theimport__modelby__presentingpackage__importsa__wayfor__importstatements__tospecify__partof__thedirectory__pathleading__tothe__desired module.As__youll__find,package__importsgive__usa__hierarchythat__isuseful__inlarger__systemsand__allowus__tobreak__conflictsbetween__same-named modules.Before__wemove__on, though,here__sa__quickquiz__onthe__conceptspresented__here.Test__Your Knowledge:Quiz__1.How__doyou__makea__module? 2.How__isthe__fromstatement__relatedto__theimport__statement? 3.How__isthe__reloadfunction__relatedto__imports? 4.When__mustyou__useimport__insteadof__from? 5.Name__threepotential__pitfallsof__thefrom__statement.Test__Your Knowledge:Answers__1.To__createa__module,you__simplywrite__atext__filecontaining__Python statements;every__sourcecode__fileis__automaticallya__module,and__thereis__nosyntax__fordeclaring__one.Import__operationsload__modulefiles__intomodule__objectsin__memory.You__canalso__makea__moduleby__writingcode__inan__externallanguage__likeC__or Java,but__suchextension__modulesare__beyondthe__scopeof__thisbook__(andmost__ofits__readers). 2.The__fromstatement__importsan__entire module,like__theimport__statement,but__asan__extra step,it__alsocopies__oneor__morevariables__fromthe__importedmodule__intothe__scopewhere__thefrom__appears.This__enablesyou__touse__theimported__namesdirectly__(name)instead__ofhaving__togo__throughthe__module (module.name). 3.By__default,a__moduleis__importedonly__onceper__process.The__reloadfunction__forcesa__moduleto__beimported__again.It__ismostly__usedto__pickup__newversions__ofa__modules__sourcecode__during development,and__indynamic__customizationscenarios__whereusers__changepart__ofa__systemwithout__restarting it. 4.You__mustuse__importinstead__offrom__onlywhen__youneed__toaccess__thesame__namein__twodifferent__modules.To__makethe__twonames__unique,qualify__withthe__namesof__theirenclosing__modulesobtained__with import.The__asextension__canrender__fromusable__inthis__contextas__well,by__renamingimports__uniquely. 5.The__fromstatement__canobscure__themeaning__ofa__variable (whichmodule__itis__defined in),can__haveproblems__withthe__reloadcall__(namesmay__referenceprior__versionsof__objects),and__cancorrupt__namespaces (itmight__silentlyoverwrite__namesyou__areusing__inyour__scope).The__from *form__isworse__inmost__regardsit__cancorrupt__namespacesarbitrarily__andobscure__themeaning__of variables,so__itis__probablybest__used sparingly.Chapter__24.Module__PackagesSo__far,when__weve__imported modules,we__vebeen__loading files.This__representstypical__module usage,and__its__probablythe__techniqueyou__lluse__formost__importsyou__ll code,especially__earlyin__yourPython__career.The__moduleimport__story, though,is__richerthan__impliedup__tothis__point.This__chapterextends__itto__presentmodule__packagescollections__ofmodule__filesthat__normallycorrespond__tofolders__(a.k.a. directories)on__your device.It__coversfour__topics:Package__imports,which__givepart__ofa__folderpath__leadingto__afile__Packages themselves,which__organizemodules__intofolder__bundles Package-relative imports,which__usedots__withina__packageto__limitsearch__Namespace packages,which__builda__packagethat__mayspan__multiplefolders__Asyou__ll find,a__packageimport__turnsa__folderon__yourcomputer__intoanother__Python namespace,with__attributescorresponding__tothe__modulefiles__andsubfolders__thatthe__folder contains.As__youll__also learn,package__importsare__sometimesrequired__toresolve__ambiguitywhen__multipleprogram__filesof__thesame__nameare__installedon__a device.Packages__area__somewhatadvanced__topic,which__manyreaders__candefer__untilthey__gainexperience__with file-based modules.That__said,packages__providean__easyway__toorganize__codefiles__thatavoids__same-nameconflicts__andis__employedby__many standard-libraryand__third-partytools__thatyou__llbe__using.While__packages,like__muchin__Python,have__grownconvoluted__over time,a__basicknowledge__oftheir__usagecan__bebeneficial__tomost__Python learners.Using__PackagesTo__loaditems__ina__package folder,you__lluse__thenormal__importstatements__andtools__weve__already met,but__providea__pathof__namesthat__reflectsa__pathof__nested folders.Let__sget__startedwith__this user-guideside__ofthe__packages story.Package__ImportsCoding__packageimports__is straightforward.In__allthe__placeswhere__youhave__beennaming__asimple__filein__yourimport__operations,you__caninstead__lista__pathof__namesseparated__by periods.For__instance,this__worksin__animport__statement:import__dir1.dir2.modThe__samegoes__forfrom__statements:from__dir1.dir2.modimport__varAnd__thisalso__appliesto__already-importeditems__inreload__calls:from__importlibimport__reload reload(dir1.dir2.mod)The__dottedpath__inthese__contextsis__assumedto__correspondto__apath__throughthe__folderhierarchy__onyour__device,leading__tothe__modulefile__mod.py,or__othercomponent__withbasename__mod (aswe__ve seen,it__mightalso__bea__bytecode file,C__extension module,or__other).Most__importantly here,the__precedingpaths__indicatethat__onyour__devicethere__isa__directory dir1,which__hasa__subdirectory dir2,which__containsa__modulefile__mod.py (or similar). Furthermore,these__pathsimply__that dir1resides__withinsome__containerdirectory__dir0,which__isa__partof__thenormal__modulesearch__path.In__other words,these__importsand__reloadsimply__adirectory__structurethat__lookssomething__likethis__onUnix__and Windows, respectively: dir0/dir1/dir2/mod.py #Or__mod.pyc, mod.so, etc. dir0\dir1\dir2\mod.py # Ditto,on__WindowsThe__containerdirectory__dir0needs__tobe__addedto__yourmodule__searchpath__unlessit__san__automaticpart__ofthat__path,exactly__asif__dir1were__asimple__module file.More__formally,the__leftmostcomponent__ina__packageimport__pathis__relativeto__(located in)a__directoryincluded__inthe__sys.pathmodule__search-pathlist__weexplored__inChapter__22.From__there down, though,the__importstatements__inyour__scriptexplicitly__givethe__directorypaths__leadingto__modulesin__packages.The__dotted-pathsyntax__ofpackages__isplatform__neutral,but__alsoreflects__thefact__thatfolder__pathsin__importstatements__becomenested__objects: dir1.dir2.modtraverses__threemodule__objectsafter__an import.This__syntaxalso__explainswhy__Pythoncomplains__abouta__filenot__beinga__packageif__youforget__toomit__the .pyextension__inimport__statements:it__staken__tomean__apackage__import!Packages__andthe__ModuleSearch__PathIf__youuse__this feature,keep__inmind__thatthe__directorypaths__inyour__importstatements__canbe__onlyvariables__separatedby__periods.You__cannotuse__any platform-specificpath__syntaxin__yourimport__statements,such__as C:\dir1, /Users/me/dir1,or__../dir1these__donot__work syntactically. Instead,use__anysuch__platform-specificsyntax__inyour__modulesearch__pathsettings__toname__thedirectories__containingyour__packages.For__instance,in__theprior__example, dir0the__directoryname__youadd__toyour__modulesearch__pathcan__bean__arbitrarilylong__and platform-specificdirectory__pathleading__upto__dir1.You__cannotuse__aninvalid__statementlike__this:import__C:\Users\me\mycode\dir1\dir2\mod # Error:illegal__syntax (Windows)import__/Users/me/mycode/dir1/dir2/mod # Ditto,on__UnixBut__youcan__adda__pathlike__C:\Users\me\mycodeor__/Users/me/mycodeto__eitheryour__PYTHONPATHenvironment__variable,a__strategicallyplaced__.pth file,or__sys.pathitself__inmanual__code,and__thensay__thisin__your script:import__dir1.dir2.mod # OK:variables__andperiods__In effect,entries__onthe__modulesearch__pathprovide__platform-specificdirectory__prefixes,which__leadto__theleftmost__namesof__packagepaths__inimport__andfrom__statements.These__importstatements__themselvesprovide__theremainder__ofthe__directorypath__ina__platform-neutral fashion.As__forsimple__file imports,you__donot__needto__addthe__containerdirectory__toyour__modulesearch__pathif__its__already there.Per__Chapter 22,the__searchpath__automaticallyincludes__thehome__directory (whereyou__reworking__ina__REPL,or__thecontainer__ofa__launchedprogram__s top-level file),along__withthe__standardlibrary__s containers,and__the site-packages third-partyinstall__root.While__noneof__thesecomponents__require search-path mods,your__modulesearch__pathmust__includeall__thedirectories__containingleftmost__componentsin__yourcode__s package-import statements.Creating__PackagesTo__makepackages__ofyour__own,you__llbundle__modulefiles__andnested__foldersin__apackage__folder.A__packagefolder__canalso__optionallycontain__an __init__.pyfile__runon__first import,and__a __main__.pyfile__runwhen__theentire__packagefolder__isrun__asa__bundle.The__followingsections__demowhat__thislooks__likein__code,one__stepat__a time.Basic__PackageStructure__Intheir__simplest form,packages__arejust__folderscontaining__normalmodule__files,and__perhapsnested__subfoldersof__the same.Let__sset__oneup__asa__demo.The__followinguses__indentationto__representthe__foldernesting__well__beusing__inthis__andthe__following sections: dir0/ #Container__listedon__modulesearch__path dir1/ #Package__rootfolder__dir1 mod.py #Module__file dir1.modin__package dir2/ #Nested__packagefolder__dir1.dir2 mod.py #Module__dir1.dir2.modin__packageThese__nestedfolders__canbe__createdin__file explorers,or__withthe__followingcommands__onmost__platforms;use__backslasheson__Windows,or__simplyuse__thisChapter__sfolder__inthe__examples package,which__hasprebuilt__the structure: $mkdir__dir1 $mkdir__dir1/dir2 #Use__backwardslashes__onWindows__Admin note:the__namesof__package folders,like__thoseof__simplemodule__files,must__followthe__rulesfor__variablenames__becausethey__becomevariables__where imported.See__Chapter 11for__arefresher__onthe__constraints,but__in short,use__letters, digits,and__underscores,and__avoidreserved__words. Now,add__thenested__modulefiles__listedin__Examples 24-1and__24-2.Their__top-level__coderuns__onfirst__importand__createsattributes__as usual,and__theirtitles__givetheir__paths (usingjust__Unix forward-slashseparators__for brevity).Example__24-1. dir1/mod.pyvar__= 'hack' print('Loading dir1.mod')Example__24-2. dir1/dir2/mod.pyvar__= 'code' print('Loading dir1.dir2.mod')Using__thebasic__packageTo__useour__module package,import__itsmodules__froma__REPLor__anotherfile__justas__youwould__fora__simple .py file,but__usedots__tospecify__thepath__belowthe__dir0folder__inthe__searchpath__whichis__thecurrent__directoryin__a REPL: $ python3 >>>import__dir1.mod #Package__pathsin__importLoading__dir1.mod >>> dir1.mod.var #Module__coderun__onimport__'hack' >>>import__dir1.dir2.mod #A__further-nestedpath__Loading dir1.dir2.mod >>> dir1.dir2.mod.var #Repeat__pathto__getitem__atend__'code'As__forsimple__top-level modules,the__codeof__modulesnested__ina__packageis__runonly__whenfirst__imported: >>>import__dir1.mod # No-opif__alreadyimported__>>>import__dir1.dir2.modAnd__yougenerally__mustimport__anested__modulein__orderto__useits__attributesbecause__modulescorresponding__tofolders__dont__goback__tothe__filesystemon__attribute fetches,it__snot__enoughto__importjust__aroot__folder: $ python3 >>>import__dir1 #Gets__dir1,nothing__belowit__>>> dir1.dir2.mod.var AttributeError:module__'dir1'has__noattribute__'dir2' $ python3 >>>import__dir1.dir2 >>> dir1.dir2.mod.var AttributeError:module__'dir1.dir2'has__noattribute__'mod' $ python3 >>>import__dir1.dir2.mod #List__fullpath__totarget__Loading dir1.dir2.mod >>> dir1.dir2.mod.var 'code'All__thisworks__thesame__inthe__fromstatement__which,as__weve__seen,is__reallyjust__importwith__anextra__copyof__names. Again, though,we__mustlist__afolder__byits__pathin__animport__statementto__beable__toaccess__its contents,and__thepaths__listedin__importsare__taken literally,not__fetchedfrom__variables: $ python3 >>>from__dir1.modimport__var #Package__pathsin__fromLoading__dir1.mod >>>var__# Don'trepeat__pathto__item 'hack' >>>from__dir1.dir2.modimport__varLoading__dir1.dir2.mod >>>var__'code' >>>from__dir1import__dir2 #Paths__takenliterally__>>>from__dir2import__mod #Not__fromvariable__values ModuleNotFoundError:No__modulenamed__'dir2'One__potentialadvantage__offrom__hereis__thatit__avoidsrepeating__apackage__pathevery__timean__itemin__apackage__is used.With__import,you__generallymust__repeatthe__fullpath__each time,but__fromlets__youcode__thepath__just once,and__usethe__simplename__fetchedfrom__it everywhere;this__isespecially__usefulif__thepackage__sdirectory__structurelater__changes (assoftware__iswont__to do): >>>import__dir1.dir2.mod #import__requirespaths__>>> dir1.dir2.mod.var 'code' >>>from__dir1.dir2.modimport__var #from__canshorten__paths >>>var__'code' >>>from__dir1.dir2import__mod #And__avoidsrepeating__them >>> mod.var 'code' >>>import__dir1.dir2.modas__mod #Though__"as"can__too >>> mod.var 'code'As__thelast__example shows, though,the__asextension__introducedin__thepreceding__chaptercan__shortenup__pathsthe__sameway__asfrom__ascan__asimple__manual reassignment,which__theas__sugarcoats (moreon__asin__thenext__chapter).Package____init__.pyFiles__Ifyou__needto__runsetup__codewhen__apackage__folderis__imported,put__itin__afile__named __init__.pyand__storeit__inthe__packages__folder.Python__willautomatically__runthis__files__codethe__firsttime__thepackage__isimported__duringa__programrun__(orREPL__session).Here__show__thisaugments__ourpackage__s structure: dir0/ dir1/ __init__.py #Run__onfirst__importof__dir1 mod__.py dir2/ __init__.py #Run__onfirst__importof__dir1.dir2 mod.pyThe__new __init__.pyfiles__arelisted__inExamples__24-3and__24-4.Example__24-3. dir1/__init__.pyvar__= 'Python' print('Running dir1.__init__.py')Example__24-4. dir1/dir2/__init__.pyvar__= 3.12 print('Running dir1.dir2.__init__.py')Using__theupdated__packageThese__special __init__.pyfiles__areoptional__ineach__folderof__a package.Because__theyare__runon__thefirst__importof__orthrough__afolder__level, though,they__providea__naturalhook__forkicking__off package-specificinitializations__(hencetheir__abbreviated names).In__fact,their__assignmentsserve__toinitialize__thenamespace__thatcorresponds__toa__folderon__yourdevice__asfor__files,they__createattributes__ofthe__packages__module object: $ python3 >>>import__dir1.dir2.mod #Runs__all __init__.pyfiles__Running dir1.__init__.pyRunning__dir1.dir2.__init__.pyLoading__dir1.dir2.mod >>> dir1.var #Name__in __init__.py'snamespace__'Python' >>> dir1.dir2.var 3.12 >>> dir1.dir2.mod.var #Name__innested__mod.pynamespace__'code'Technically__speaking,packages__with __init__.pyfiles__arecalled__regular packages,and__thosewithout__themare__callednamespace__packages,and__thedemo__wasa__single-foldernamespace__packageuntil__adding __init__.pymade__it regular.We__llget__intothe__detailsbehind__thisdistinction__later,but__apartfrom__thefact__thatregular__packageshave__precedenceduring__module search,the__differenceis__mostlya__historicalartifact__today,and__wont__matterin__most roles.Of__course, __init__.pyfiles__canalso__domore__thanprint__beacons;we__llalso__exploretheir__roleslater__inthis__chapter.As__noted earlier,reload__workswith__packagepaths__too,if__youve__alreadyimported__thepaths__in question.Continuing__theprior__REPL session: >>>from__importlibimport__reload >>> reload(dir1)Running__dir1.__init__.py >>> reload(dir1.dir2)Running__dir1.dir2.__init__.py >>> reload(dir1.dir2.mod)Loading__dir1.dir2.modNotice__fromthe__initializationprints__thatthis__callreloads__justthe__singlemodule__onthe__rightend__ofthe__path.To__do better,we__llcode__areloader__toolin__thenext__chapter that,given__apackage__root,can__loadall__theitems__ona__packagepath__like this,one__ata__time;See__Example:Transitive__ModuleReloads__.Package____main__.pyFiles__Finally,if__youwant__apackage__susers__tobe__ableto__runthe__packageas__thoughit__werea__programor__script,add____main__.pyfiles__toeach__folderwhere__youwish__tosupport__this mode;Python__willautomatically__runthese__fileseach__timetheir__containerfolder__islaunched__likea__program.Here__show__thislast__bitaugments__ourpackage__s structure: dir0/ dir1/ __main__.py #Run__whenever dir1bundle__isrun____init__.py mod__.py dir2/ __main__.py #Run__whenever dir1.dir2bundle__isrun____init__.py mod.pyThe__added __main__.pyfiles__arelisted__inExamples__24-5and__24-6;they__resimple__sowe__canfocus__on packages.Example__24-5. dir1/__main__.py print('Executing dir1.__main__.py')Example__24-6. dir1/dir2/__main__.py print('Executing dir1.dir2.__main__.py')Using__theupdated__packageWhen__present, __main__.pyfiles__areautomatically__runfor__avariety__oflaunch__options,including__directconsole__commandlines__thatname__thecontaining__packagefolder__whichneed__notbe__onthe__modulesearch__pathin__this mode: $ python3 dir1 #Runs____main__.py (not __init__.py)Executing__dir1.__main__.py $ python3 dir1/dir2Executing__dir1.dir2.__main__.py $ python3 dir1/dir2/mod.py #Runs__nested mod.pyLoading__dir1.dir2.modPackage____main__.pyfiles__arealso__runfor__thePython__-m mode, which,as__weve__seen,locates__anitem__onthe__modulesearch__pathand__runsit__asa__top-level script.Unlike__directconsole__command lines,this__modekicks__offthe__full package-import__machineryand__runsany____init__.pyfiles__alongthe__path,but__requiresthe__packageto__beon__thesearch__path: $ python3 -m dir1 #Runs__both __init__.pyand____main__.pyRunning__dir1.__init__.pyExecuting__dir1.__main__.py $ python3 -m dir1.dir2 #And__packagemust__beon__searchpath__Running dir1.__init__.pyRunning__dir1.dir2.__init__.pyExecuting__dir1.dir2.__main__.py $ python3 -m dir1.dir2.mod #Runs__mod.py,and__parents' __init__.pyRunning__dir1.__init__.pyRunning__dir1.dir2.__init__.pyLoading__dir1.dir2.modThis__issimilar__inspirit__toapp__bundleson__macOSand__smartphones,which__arereally__foldersbut__canbe__runas__anexecutable__item.The__rolesfor____main__.pyfiles__are many,but__theyre__oftenused__toprovide__a command-lineinterface__toa__packageof__tools.This__way,you__canimport__thepackage__touse__itstools__inanother__program,but__alsolaunch__itas__awhole__touse__thetools__ina__standalone program.This__filemight__alsobe__usedto__hosttest__codefor__the package.A____main__.pyfile__isalso__runif__locatedin__aZIP__fileon__thesearch__path.As__noted earlier,ZIP__filesare__treatedlike__anormal__folderif__encounteredduring__amodule__search,but__seePython__sdocs__formore__onthis__option.One__subtlety here:intrapackage__(same-package)imports__in __main__.pymay__needto__usethe__package-relativefrom__.syntax__well__studyahead__whenrun__bythe__-margument__only.This__syntaxfails__forlaunches__fromdirect__command lines,so__youmay__needto__choosea__launchmode__tosupport__whena____main__.pyrequires__same-package imports.As__youll__find,code__thatwants__tosupport__bothpackage__andprogram__usagemay__solvethis__dilemmawith__full-path imports.Why__Packages?Now__thatyou__veseen__howto__useand__create packages,you__mightbe__wonderingwhy__inthe__worldanyone__wouldgo__toall__the bother.It__sa__valid question.In__truth,and__despitewhat__youmay__have heard,packages__arecompletely__optional:they__areprobably__overkillearly__inyour__coding journey,and__even later,you__canwrite__amazingprograms__without them.In__general, though,packages__areuseful__toknow__aboutbecause__theyhelp__makenames__uniquein__bothlarger__programsand__librariespublished__forothers__to use.By__organizingyour__codeas__apackage__folder,you__canbe__fairlysure__thatthe__namesof__itsfiles__wont__clashwith__thoseof__othersoftware__onhosting__devices.This__isthe__same namespace-segregationrole__that file-basedmodules__andlocal__scopesin__functions play,but__extendedto__the filesystem:because__referencesto__yourpackage__arequalified__bythe__nameof__thepackage__s folder,there__sless__riskof__same-name collisions.In__addition,packages__canmake__importsmore__descriptive,ease__thetask__oftracking__downthe__locationsof__variablesin__code files,and__simplifyyour__module search-path settings.The__onlytime__packageimports__areactually__required, however,is__toresolve__ambiguitiesthat__mayarise__whenmultiple__programswith__same-namedfiles__areinstalled__onthe__same machine.This__issomething__ofan__install issue,but__itcan__alsobecome__aconcern__ingeneral__practiceespecially__giventhe__tendencyof__developersto__usesimple__andsimilar__namesfor__module files.To__helpyou__betterunderstand__whyall__thesebenefits__matter,let__stake__abrief__detourinto__theland__ofthe__abstract.A__Taleof__TwoSystems__Toillustrate__theroles__of packages,suppose__thata__programmerdevelops__aPython__programthat__containsa__filecalled__utilities.pyfor__commonutility__code,and__a top-levelfile__named main.pythat__userslaunch__tostart__the program.All__overthis__program,its__filessay__importutilities__toload__anduse__thecommon__code.When__theprogram__is installed,it__unpacksall__itsfiles__intoa__singledirectory__named system1on__thetarget__machinethat__lookslike__this: system1/ utilities.py #Common__utility functions,classes__main.py #Launch__thisto__startthe__program other.py #Import__utilitiesto__loadmy__tools Now,suppose__thata__secondprogrammer__developsa__differentprogram__withfiles__alsocalled__utilities.pyand__main.py,and__againuses__importutilities__throughoutthe__programto__loadits__owncommon__code file.When__thissecond__systemis__fetchedand__installedon__thesame__computeras__thefirst__system,its__fileswill__unpackinto__anew__directorycalled__system2on__thehost__ensuringthat__theydo__notoverwrite__same-namedfiles__fromthe__first system: system2/ utilities.py #Common__utilities main.py #Launch__thisto__run other.py #Imports__utilitiesSo__far,there__sno__problem:both__systemscan__coexistand__runon__thesame__computer.In__fact,you__wont__evenneed__toconfigure__themodule__searchpath__touse__theseprograms__onyour__computerbecause__Pythonalways__searchesthe__homedirectory__first (that is,the__directorycontaining__the top-level file),imports__ineither__systems__fileswill__automaticallysee__allthe__filesin__thatsystem__sown__directory.For__instance,if__yourun__system1/main.py,all__importswill__search system1 first. Similarly,if__youlaunch__system2/main.py, system2will__besearched__first instead. Remember,module__searchpath__settingsare__onlyneeded__toimport__acrossdirectory__boundaries. However,suppose__thatafter__youve__installedthese__twoprograms__onyour__machine,you__decidethat__youd__liketo__usesome__ofthe__codein__eachof__the utilities.pyfiles__ina__systemof__your own.It__scommon__utility code,after__all,and__Pythoncode__bynature__wantsto__be reused.In__this case,you__dlike__tobe__ableto__saythe__followingfrom__codethat__youre__writingin__athird__directoryto__loadone__ofthe__two files:import__utilities utilities.func('hack')Now__theproblem__startsto__materialize.To__makethis__workat__all,you__llhave__toset__themodule__searchpath__toinclude__thedirectories__containingthe__utilities.py files.But__whichdirectory__doyou__putfirst__inthe__path system1or__system2?The__issuehere__isthe__linearnature__ofthe__sys.pathsearch__path.It__isalways__scannedfrom__leftto__right,so__nomatter__howlong__youponder__this dilemma,you__willalways__getjust__one utilities.pyfrom__thedirectory__listedfirst__(leftmost)on__thesearch__path.As__is,you__llnever__beable__toimport__thisfile__fromthe__otherdirectory__at all.You__couldtry__changing sys.pathwithin__yourscript__beforeeach__import operation,but__thats__bothextra__workand__error-prone.And__changingPYTHONPATH__beforeeach__Pythonprogram__runis__too tedious,and__wont__allowyou__touse__bothversions__ina__singlefile__inan__event.By__default,you__re stuck.This__isthe__issuethat__packagesactually__fix.Rather__thaninstalling__programsin__independentdirectories__listedon__themodule__searchpath__directlyand__individually,you__canpackage__andinstall__themas__subdirectoriesunder__acommon__root.For__instance,you__mightorganize__allthe__codein__thisexample__asan__installhierarchy__thatlooks__like this: root/ system1/ utilities.py main.py other.py system2/ utilities.py main.py other.py mycode/ #Here__orelsewhere__myfile.py #Your__newcode__here Now,add__justthe__commonroot__directoryto__yoursearch__path.If__yourcode__simports__areall__relativeto__thiscommon__root,you__canimport__eithersystem__sutility__filewith__apackage__importthe__enclosingdirectory__namemakes__thepath__(and hence,the__module reference) unique.In__fact,you__canimport__bothutility__filesin__thesame__module,if__youuse__animport__statementand__repeatthe__fullpath__eachtime__youreference__theutility__modules:import__system1.utilities #Import__fromone__packageimport__system2.utilities #Import__fromanother__system1.utilities.function('hack') #And__usenames__fromeither__system2.utilities.function('code') #Or__both!In__short,the__namesof__theenclosing__directorieshere__makethe__modulereferences__unique.Note__thatyou__haveto__useimport__insteadof__fromwith__packagesonly__ifyou__needto__accessthe__sameattribute__namein__twoor__more paths.If__thename__ofthe__calledfunction__herewere__differentin__each path,you__coulduse__fromstatements__toavoid__repeatingthe__fullpackage__pathwhenever__youcall__oneof__the functions,as__described earlier;as__also mentioned,the__asextension__inimport__andfrom__canbe__usedto__provideunique__synonyms too. Technically,in__this case,the__mycodefolder__doesnt__haveto__beunder__rootjust__thepackages__ofcode__fromwhich__youwill__import.Because__younever__knowwhen__yourown__modulesmight__beuseful__inother__programs, though,placing__themunder__thecommon__root directory, too,may__avoidsimilar__name-collisionproblems__inthe__future. Importantly,path__configurationalso__becomessimple__ifyou__recareful__tounpack__allyour__Pythonsystems__undera__commonroot__like this;you__llonly__needto__addthe__commonroot__directory once. Moreover,both__ofthe__twooriginal__systemsimports__willkeep__working unchanged.Because__theirhome__directoriesare__searched first,the__additionof__thecommon__rooton__thesearch__pathis__irrelevantto__codein__system1and__system2;they__cankeep__sayingjust__importutilities__andexpect__tofind__theirown__fileswhen__runas__programs.As__youll__see ahead, though,if__theyare__alsoused__as packages,they__mayneed__touse__from . package-relative__imports (and main.pycould__be __main__.py). Finally,keep__inmind__thateven__ifyou__nevercreate__packagesof__your own,you__llprobably__use standard-libraryand__third-partytools__that do.As__arandom__sampleof__standard-library packages:from__email.messageimport__Message #Email__parsing/constructionfrom__tkinter.filedialogimport__askopenfilename #Portable__GUItoolkit__from http.serverimport__CGIHTTPRequestHandler # Web-serverutilities__(tillPython__3.15?)By__bundlingtheir__codein__a package,such__toolsbecome__more self-contained,and__avoidname__conflicts.Whether__youopt__todo__thesame__foryour__owncode__isup__to you,but__thenext__fewsections__digdeeper__forif__andwhen__you opt-in.The__Rolesof____init__.pyFiles__Nowthat__weve__seenthe__basicsand__addressedthe__whyof__packages,let__sexplore__someof__thedetails__behindtheir__usage.The____init__.pyfiles__inour__openingdemo__were simple,but__thesefiles__cancontain__arbitraryPython__code,just__likenormal__module files.Their__namesare__specialbecause__theircode__isrun__automaticallythe__firsttime__aPython__programimports__a directory,and__thusserves__primarilyas__ahook__forperforming__initializationsteps__requiredby__the package.These__filescan__alsobe__completely empty, though,and__sometimeshave__additional roles. Specifically,the____init__.pyfile__servesas__ahook__forpackage__initialization-time actions,generates__amodule__namespacefor__a directory,declares__adirectory__asa__normalPython__package,and__implementsthe__behaviorof__from *statements__whenused__forfolders__inpackage__imports:Package__initializationThe__firsttime__aPython__programimports__througha__directory,it__automaticallyruns__allthe__codein__thedirectory__s __init__.py file.Because__of that,these__filesare__anatural__placeto__putcode__toinitialize__thestate__requiredby__filesin__a package.For__instance,a__packagemight__useits__initializationfile__tocreate__requireddata__files,open__connectionsto__databases,and__so on. Typically, __init__.pyfiles__arenot__meantto__beuseful__ifexecuted__directly (thats__what __main__.pyis__for); instead,they__arerun__automaticallywhen__apackage__isfirst__importedfor__use elsewhere.Module__namespaceinitialization__Asnoted__earlier,in__thepackage__import model,the__directorypaths__inyour__scriptbecome__realnested__objectpaths__afteran__import.For__instance,after__animport__inthe__preceding demo,the__expression dir1.dir2works__andreturns__amodule__objectwhose__namespacecontains__allthe__namesassigned__by dir2s____init__.pyinitialization__file.The__variableassignments__insuch__filesprovide__attributenamespaces__formodule__objectscreated__for folders,which__haveno__realassociated__module file,and__wouldotherwise__haveno__placeto__define names.Package__indicatorfor__searchPackage____init__.pyfiles__arealso__partlypresent__todeclare__thata__directoryis__aPython__package.In__this role,these__filesserve__toprevent__directorieswith__commonnames__fromunintentionally__hidingtrue__modulesthat__appearlater__onthe__modulesearch__path.Without__this safeguard,Python__mightpick__adirectory__thathas__nothingto__dowith__your code,just__becauseit__appearsnested__inan__earlierdirectory__onthe__search path.As__youll__see later,the__generalizationsadded__fornamespace__packagessubsume__someof__thisrole__algorithmically,by__scanningahead__onthe__searchpath__tofind__lateritems__beforesettling__onsimple__folders.Package____init__.py files, though,still__givea__packagehigher__prioritythan__a same-namefolder__elsewhereon__thesearch__path.from__*statement__behaviorAs__anadvanced__feature,a__listof__namestrings__named__all____atthe__toplevel__ofan____init__.pyfile__defineswhat__isexported__forthe__from *statement__form. Specifically,the____all__list__inan____init__.pyfile__istaken__tobe__thenames__ofnested__submodulesthat__shouldbe__automaticallyimported__whenfrom__*is__usedon__thepackage__directory itself.If____all__is__not set,the__from *does__notautomatically__loadsubmodules__nestedin__thepackage__directory; instead,it__loadsjust__namesdefined__byassignments__inthe__directorys____init__.py file,including__anysubmodules__explicitlyimported__bycode__inthis__file.For__instance,from__submoduleimport__Xin__adirectory__s __init__.pymakes__thename__Xavailable__inthat__directorys__namespacewithout__an __all__.You__llsee__anexample__ofthe____all__list__later,and__morecoverage__ofit__inChapter__25where__youll__findthat__italso__servesto__declarefrom__*exports__ofsimple__file-based modules,not__just packages,and__ispart__ofthe__largertopic__ofdata__hiding.You__canalso__simplyleave____init__.pyfiles__emptyto__giveyour__packageprecedence__overnamespace__packagesduring__animport__search,but__tounderstand__whythat__matters,we__needto__move ahead.NOTE__Classesconflation__caution:As__a preview,package____init__.pyfiles__arenot__thesame__asthe__class__init____constructormethods__youll__meetin__thenext__partof__this book.The__formerare__filesof__coderun__whenimports__firststep__througha__packagefolder__ina__program run,while__thelatter__arefunctions__calledwhenever__aninstance__is created.Both__haveinitialization__rolesand__are optional,but__theyare__otherwisevery__differentdespite__their names. Package-RelativeImports__Thecoverage__ofpackage__importsso__farhas__focusedon__importingpackage__filesfrom__outsidethe__package.Within__thepackage__itself,imports__of same-packagefiles__canuse__thesame__fullpath__syntaxas__importsfrom__outsidethe__packageand__asyou__ll see,sometimes__should. However,files__withina__packagecan__alsomake__useof__intrapackagesyntax__thatmakes__importsrelative__tothe__package itself,and__canensure__thatimports__ina__packageload__thepackage__sown__files.Relative__andAbsolute__ImportsThe__codebehind__thisis__straightforward.Imports__runby__filesused__aspart__ofa__packagecan__usespecial__syntaxlike__the following,which__worksonly__infiles__usedas__package components,and__onlyin__from statements,not__import:from__.import__module #Import__amodule__inthis__package (only)from__.moduleimport__name #Import__aname__froma__modulein__thispackage__from ..import__module #Import__amodule__siblingof__theparent__folderfrom__..moduleimport__name #Import__aname__froma__parent-siblingmodule__Thissyntax__wouldnt__makesense__in import,because__thatstatement__assignsmodules__tosimple__names,not__paths.In__a from, though,when__thesource__ofthe__importbegins__with (oris__only)dots__like this,the__importis__knownas__relativeit__identifiesan__itemrelative__tothe__folderof__theenclosing__package itself.This__namecomes__fromthe__similarityto__relativefilename__paths,which__referencea__fileper__thecurrent__workingdirectory__(CWD),as__coveredin__Chapter 9.Much__asin__filenames, .means__theimmediately__enclosingpackage__folder,and__..means__itsparent__folderanother__levelup__(andeach__additionaldot__meansone__level higher,though__thisis__rarely used). Here, though,the__effectnames__anitem__relativeto__animporter__s package,not__acontent__filerelative__tothe__CWD. Importantly,relative__importswithin__apackage__searchonly__thereferenced__package:they__nevercheck__thefolders__listedin__sys.pathas__normalimports__do (andskip__the built-inand__frozenmodules__precheck). Moreover, relative-importsyntax__canbe__usedonly__whena__fileis__beingutilized__aspart__ofa__package,and__fails otherwise.This__hasconsequences__bothgood__andbad__thatwe__llexplore__ina__moment.Imports__infiles__beingused__aspart__ofa__packagecan__stillbe__codedwithout__dotsas__usual,in__bothimport__and from:import__module #Import__amodule__froma__folderin__sys.pathfrom__moduleimport__name #Import__aname__fromthe__sameSans__leadingperiods__like this,an__importis__knownas__absoluteit__identifiesan__itemthat__slocated__ina__folderlisted__in sys.path.This__isthe__normalbehavior__ofimports__in Python,and__theres__reallynothing__absoluteabout__itper__thefilename__analogy (absolutefilename__pathsgive__acomplete__filesystem path).In__fact,these__absoluteimports__arereally__relativeto__anentry__inthe__modulesearch__path,but__were__stuckwith__theterminology__today.Also__importantly,absolute__importswithin__apackage__donot__automaticallycheck__thepackage__itself:they__skipthe__packageand__moveright__toa__searchof__folderson__sys.path.As__weve__seen, sys.pathmay__includethe__packages__folder anyhow,by__virtueof__theREPL__sCWD__orthe__homefolder__ofthe__top-level script,and__PYTHONPATHor__other settings.By__themselves, though,absolute__importsdon__tcheck__thepackage__forimports__runin__package files. Relative-ImportRationales__and Trade-OffsSo__whythe__dots?In__short,relative__importsallow__apackage__toensure__thatits__importswill__loadits__own modules.Because__relativeimports__searchonly__thepackage__itself,they__wont__inadvertentlyload__a same-namedbut__unrelatedmodule__elsewhereon__thehost__thathappens__tobe__accessiblethrough__sys.path.This__inturn__makesthe__packagemore__self-contained:without__relative imports,such__anunrelated__modulemight__breakthe__packages__code;with__them,packages__areless__relianton__client search-pathsettings__thatthey__cannotpredict__or control.The__downsideis__thatthis__modelis__an all-or-nothing proposition.You__essentiallymust__choosea__modefor__yourfiles__packageor__program.Relative__importsgive__visibilityto__thepackage__itself,but__cannotbe__usedin__nonpackage mode,and__absoluteimports__canbe__usedin__nonpackage mode,but__donot__givevisibility__tothe__package itself.This__combinationseems__a catch-22that__limitsyour__codes__utility.That__being said,if__youre__codinga__libraryof__tools,this__maybe__a nonissue:you__canadopt__relativeimports__throughoutyour__package,and__providea____main__.pyfile__torun__thepackage__asa__programwith__the -m switch.If__youre__writinga__moretraditional__folderof__codethat__youwant__touse__arbitrarily, though,your__optionsappear__tobe__limited.One__easysolution__tothis__dilemmais__tosimply__avoidrelative__imports altogether,and__use full, explicit,and__absolute package-importpaths__everywherein__your code.That__is,use__importsthat__listthe__pathto__thedesired__itemfrom__andincluding__thepackage__sroot__folder itself:import__package.module #Import__amodule__inthis__packagefrom__packageimport__module #Same__as:from__.import__moduleform__package.moduleimport__name #Same__as:from__.moduleimport__nameFor__thisto__work,the__packages__rootfolder__mustreside__ina__folderlisted__on sys.path,but__thiswill__bethe__normalcase__theres__noway__forclients__toimport__thepackage__scode__otherwise.This__alsodoesn__tdirectly__supportexotic__importslike__..parent__siblings,but__theseseem__likelyto__berare__(e.g.,only__one standard-library__tooluses__them today).With__thisnonrelative__equivalence,code__folderscan__beused__more flexibly,and__bothdirect__commandlines__andthe__-m module-modeswitch__canbe__usedto__launchfiles__inthe__packageas__programs.The__nextsection__shows how. Package-RelativeImports__inAction__Todemo__allof__theforegoing__points,let__sreturn__tothe__simplepackage__wecoded__atthe__startof__this chapter.As__youll__recall,its____main__.pyfile__isrun__automaticallywhen__thefolder__isrun__asa__bundle,but__itwill__alsoplay__therole__ofany__top-levelfile__inthe__folderlaunched__asa__script.When__welast__metthis__file,it__simplycontained__a print;here__sa__refresherof__the last-knownstate__ofthe__fileswe__llbe__usinghere__soyou__dont__haveto__flip back: #prior__dir1/mod.pyvar__= 'hack' print('Loading dir1.mod') #prior__dir1/__main__.py print('Executing dir1.__main__.py')The__normal-import warm-upThis____main__.pyworked__as advertised,but__thingsget__morecomplicated__ifa__filerun__asa__top-levelscript__triesto__importanother__modulein__itsown__packagefolder__asin__therewrite__ofExample__24-7.Example__24-7. dir1/__main__.py (modified)import__mod print('Executing dir1.__main__.py:', mod.var.upper())Coded__this way,the__filecan__berun__witha__directcommand__line (andboth__asa__folderand__a script),but__notwith__Pythons__-m module-mode switch,which__bringsthe__packagemachinery__online (noticethe____init__.pyoutput__inthis__mode): $ python3 dir1 #Launch__witha__directcommand__lineLoading__dir1.modExecuting__dir1.__main__.py:HACK__$ python3 dir1/__main__.py #As__folderbundle__orexplicit__fileLoading__dir1.modExecuting__dir1.__main__.py:HACK__$ python3 -m dir1 #Launch__withPython__-mmodule__switchRunning__dir1.__init__.py ModuleNotFoundError:No__modulenamed__'mod' $ python3 -m dir1.__main__ #As__packageroot__orexplicit__moduleRunning__dir1.__init__.py ModuleNotFoundError:No__modulenamed__'mod'The__firsttwo__commandsin__thiswork__because __main__.pyis__runas__a normal,nonpackage__program,and__findsits__importedsibling__perthe__homeentry__on sys.path,the__top-levelfile__sown__folder.The__problemwith__thelast__twocommands__isthat__theyuse__thefile__aspart__ofa__package:the__importmod__in __main__.pyis__theninterpreted__asan__absoluteimport__whichskips__theenclosing__package.Hence__the fails.The__relative-importadventure__Ourfirst__reactionmight__beto__addrelative__importsto__appeasethe__packagesystem__asin__Example 24-8.Example__24-8. dir1/__main__.py (modified)from__.import__mod print('Executing dir1.__main__.py:', mod.var.upper())Coded__this way,we__vefixed__-m usage,but__brokendirect__command lines: $ python3 -m dir1Running__dir1.__init__.pyLoading__dir1.modExecuting__dir1.__main__.py:HACK__$ python3 -m dir1.__main__Running__dir1.__init__.pyLoading__dir1.modExecuting__dir1.__main__.py:HACK__$ python3 dir1 ImportError:attempted__relativeimport__withno__knownparent__package $ python3 dir1/__main__.py ImportError:attempted__relativeimport__withno__knownparent__packageThe__firsttwo__commandsin__thiswork__because -minvokes__package behavior,which__enablesthe__relative .import__syntaxthat__searchesthe__packageand__findsthe__target module.The__problemwith__thelast__twocommands__isthat__Pythondoesn__tallow__relativeimports__tobe__usedin__nonpackagemode__whichdooms__theseruns__fromthe__start,regardless__of search-path settings.Hence__the fails.Under__this regime, then,it__wouldseem__wemust__choosepackage__ornonpackage__rolesfor__our code.The__absolute-importsolution__As noted, though,an__easyway__outof__thisconstraint__isto__usenormal__packageimports__thatexplicitly__spellout__absoluteimport__paths (which, again,are__actuallyrelative__to sys.path)from__thepackage__rootas__inExample__24-9.Example__24-9. dir1/__main__.py (modified)import__dir1.mod print('Executing dir1.__main__.py:', dir1.mod.var.upper())As__also noted,the__package root, dir1,will__normallybe__on sys.path,because__thats__theonly__wayto__useits__codefrom__outsidethe__package (clientsmust__importwith__pathsthat__startat__the dir1package__root too).To__demo here,we__lladd__thepackage__rootexplicitly__usinga__relativein__filesystemterms__pathof__.for__thecurrent__directory (intypical__use,this__mightinstead__bean__absolute path,or__Pythons__automatic site-packagesroot__ofinstalled__packages).We__mustset__thishere__becausethe__top-levelfile__shome__onthe__searchpath__in direct-commandmode__isone__levelbelow__thepackage__root,and__both direct-commandand__-mmodes__needaccess__tothe__packageroot__in general: $export__PYTHONPATH=. #Or__similaroutside__Unix:see__Chapter 22 $ python3 dir1Running__dir1.__init__.pyLoading__dir1.modExecuting__dir1.__main__.py:HACK__$ python3 dir1/__main__.pyRunning__dir1.__init__.pyLoading__dir1.modExecuting__dir1.__main__.py:HACK__$ python3 -m dir1 #Both__usagemodes__work,sans__"."imports__Running dir1.__init__.pyLoading__dir1.modExecuting__dir1.__main__.py:HACK__$ python3 -m dir1.__main__Running__dir1.__init__.pyLoading__dir1.modExecuting__dir1.__main__.py:HACK__Nowlaunches__byboth__directcommand__linesand__the -mswitch__work,because__were__notusing__atool__thatlimits__theutility__ofour__codeto__justone__mode.The__endresult__is dual-modecode__itcan__beused__asboth__programand__package.If__youd__rathernot__repeatimport__pathsat__eachitem__reference,both__launchmodes__alsowork__ifwe__code __main__.pyin__anyof__theseways__(teston__yourown__to verify;this__isjust__importnorms__at work):import__dir1.modas__mod print('Executing dir1.__main__.py:', mod.var.upper())from__dir1import__mod print('Executing dir1.__main__.py:', mod.var.upper())from__dir1.modimport__var print('Executing dir1.__main__.py:', var.upper())For__more fun,you__canalso__usea__from *in__this scheme,if__youadd__an__all____tothe__packageroot__sinitialization__file (subjectto__allthe__standarddisclaimers__aboutthe__evilsof__from *outlined__inChapter__23): # dir1/__init__.py__all____= ['mod'] # dir1/__main__.pyfrom__dir1import__* print('Executing dir1.__main__.py:', mod.var.upper()) Again,if__youre__surethat__yourcode__willonly__everbe__usedas__partof__a package,you__coulduse__relativeimports__inall__ofits__filesto__access same-package modules. Moreover,the__absolute-pathsolution__arrivedat__herecould__beapplied__onlyfor__filesmeant__tobe__lunchedas__top-level scripts;other__filesonly__importedcan__use package-relative imports.In__both cases,relative__importscome__withthe__advantagethat__a same-namedmodule__earlieron__sys.pathwon__taccidentally__overridea__crucialmodule__inthe__package.But__theyalso__limita__fileto__package-only roles;if__youwant__packagefiles__tosupport__bothlaunches__and imports,relative__importsare__notyour__best option.It__shouldalso__benoted__thatwe__reskipping__somedetails__herefor__space.For__one, -mmode__unusuallyalso__checksthe__CWDfor__absolute imports,making__thedemo__sPYTHONPATH__settingoptional__forthis__modeand__demo only.For__another,some__otherresources__suggestthat__relative-importfailures__inscripts__stemfrom__theirname__'__main__',but__filesrun__with -mhave__thesame__nameand__employother__protocolsthat__aretoo__obscureto__cover here.Because__package-relativeimports__areboth__proneto__changeand__mostlymeant__forprogrammers__building large-scalelibraries__ofcode__forothers__to use,this__Python-learners__textwill__deferto__Pythons__docsfor__further details.Modules__are feature-rich__tools,to__saythe__least,but__thegood__newsis__thatnamespace__packagesthe__topicof__thenext__andfinal__sectionof__thischapter__donot__addany__new syntax,but__simplyallow__amodule__tospan__folders.To__see how,let__smove__on.Namespace__PackagesNow__thatyou__velearned__allabout__packageand__package-relative imports,there__sone__last package-relatedsubject__to cover.The__evolutionarypath__ofmodules__inPython__eventuallyled__towhat__areknown__asnamespace__packagespackages__thatmay__becomposed__ofone__ormore__folderslocated__ondifferent__partsof__themodule__search path.While__packagessplit__acrossfolders__areprobably__atypicalin__the wild,the__generalizationsadded__tosupport__namespacepackages__inthe__import-searchalgorithm__(procedure)also__allowfor__packageswithout____init__.pyfiles__in general.Since__thisrevised__algorithmis__nowjust__theimport__search,namespace__packagesare__somethingof__anincidental__topic.To__understandnamespace__packagesplace__inthe__broadermodules__picture, though,as__wellas__thechanges__theyushered__in,we__needa__quickhistory__lesson.Python__ImportModels__All told,Python__hasfour__distinctimport__schemes.The__followingenumerates__themfrom__originalto__newest,with__representativebut__incompleteexamples__(aswe__ve seen,from__alsoallows__a *wildcard__andreload__reloadsany__modulepassed__to it,but__theseare__just add-on topics):Basic__modulesThe__original model,used__toimport__filesand__their contents,relative__tothe__sys.pathmodule__search path:import__modulefrom__moduleimport__nameBasic__packagesThe__originalpackage__modelused__toimport__fromfolder__pathsrelative__tothe__sys.pathsearch__path,where__eachpackage__iscontained__ina__singledirectory__thathas__an __init__.py file:import__folder.folder.modulefrom__folder.moduleimport__name Package-relativeimports__Themodel__usedfor__intrapackage (same-package)imports__ofthe__prior section,with__itsrelative__andabsolute__lookuprules__forimports__withand__withoutleading__dots, respectively:from__.import__modulefrom__.moduleimport__nameNamespace__packagesThe__newestpackage__model,which__isstill__relativeto__sys.path,but__allowspackages__tospan__multiple directories,and__removesthe__requirementthat__packagesmust__define __init__.py files:import__anyfolder.anyfolder.modulefrom__anyfolderimport__nameThe__firsttwo__ofthese__modelsare__self-contained,but__thethird__tightensup__thesearch__orderand__extendssyntax__for same-package imports,and__thefourth__upendssome__ofthe__notionsand__requirementsof__theprior__package model.In__fact,Python__nowformally__definestwo__flavorsof__packages:The__original model,now__knownas__regularpackages__Thealternative__model,known__asnamespace__packagesThe__originaland__alternativepackage__modelsare__notmutually__exclusiveand__canbe__usedsimultaneously__inthe__same program.In__fact,the__namespacepackage__modelworks__assomething__ofa__fallback option,recognized__onlyif__basicmodules__andregular__packagesof__thesame__nameare__notpresent__onthe__modulesearch__path.Despite__theirshowy__title,namespace__packagesare__reallyjust__amutation__ofimport__search,as__thefollowing__sections explain. Namespace-PackageRationales__First off,it__simportant__toknow__thata__namespacepackage__isnot__fundamentallydifferent__froma__regular package:it__isjust__adifferent__wayof__creating packages. Moreover,they__arestill__relativeto__sys.pathat__thetop__level:the__leftmostcomponent__ofa__dotted namespace-packagepath__muststill__belocated__inan__entryon__thenormal__modulesearch__path.In__termsof__physical structure, though,regular__andnamespace__packageshave__notable differences.Regular__packageshave__an __init__.pyfile__thatis__run automatically,and__theyreside__ina__single directory.Namespace__packages,by__contrast,cannot__containan____init__.py,and__mayor__maynot__spanmultiple__directoriescollected__atimport__time.Because__thepresence__of __init__.pydifferentiates__package type,none__ofthe__directoriesthat__makeup__anamespace__packagecan__havethis__file,but__thecontent__nestedwithin__eachof__themis__treatedas__asingle__composite package.The__rationalefor__namespacepackages__isrooted__inpackage__installationgoals__thatmay__seemobscure__unlessyou__areresponsible__forsuch__tasks.In__short, though,they__resolvea__potentialfor__collisionof__multiple __init__.pyfiles__whenpackage__partsare__merged,by__removingthis__file completely. Moreover,by__providingstandard__supportfor__packagesthat__canbe__splitacross__multipledirectories__andlocated__inmultiple__sys.path entries,namespace__packagesboth__enhanceinstall__flexibilityand__replacemultiple__incompatiblesolutions__thathad__arisento__addressthis__goal.Though__split-folderpackages__havesome__narrow roles,average__Pythonusers__willprobably__findnamespace__packagesbiggest__benefitto__bethat__theyremove__therequirement__forpackage____init__.pyinitialization__files,and__thusallow__anydirectory__ofcode__tobe__usedas__animportable__package.To__see how,let__smove__onto__the nitty-grittyof__import search.The__ModuleSearch__AlgorithmTo__understandthe__waythat__namespacepackages__changeand__extendimport__search,we__haveto__lookunder__thehood__tosee__howthe__importoperation__works.As__weve__seen,Python__fulfillsimports__bysearching__fora__nameamong__aset__ofcandidate__folders.For__theleftmost__componentsof__imports,the__setof__candidatesis__allthe__directorieslisted__onthe__sys.pathmodule__search path.For__componentsof__packageseither__nestedin__packageimports__ornamed__inrelative__imports,the__setof__candidatesis__justthe__package itself.While__packagefolders__havejust__oneinstance__ofa__given name,search__pathsmay__have many.The__waythe__importsearch__selectsitems__fromthese__candidatesis__subtlerthan__impliedso__far.For__eachdirectory__inan__importsearch__sset__of candidates,Python__testsfor__avariety__ofmatches__toan__imported name,in__thefollowing__order (usingUnix__/for__folderseparators__and { }to__meana__choice): 1.If__directory/name/__init__.pyis__found,a__regularpackage__isimported__and returned. 2.If__directory/name.{py, pyc,or__othermodule__extension}is__found,a__simplemodule__isimported__and returned. 3.If__directory/nameis__foundand__isa__directory,it__isrecorded__andthe__scancontinues__withthe__nextdirectory__inthe__searchs__setof__candidates. 4.If__noneof__theabove__was found,the__scancontinues__withthe__nextdirectory__inthe__searchs__setof__candidates.If__thissearch__scandidate__scancompletes__withoutreturning__aregular__packageor__moduleby__steps 1or__2,and__atleast__onedirectory__wasrecorded__bystep__3,then__anamespace__packageis__createdand__returned.Else__anerror__is reported.The__creationof__thenamespace__packagehappens__immediatelyand__isnot__deferreduntil__a lower-levelimport__occurs.The__newnamespace__packageis__amodule__objectthat__doesnot__havea____file__ attribute,but__hasa____path__set__toan__iterableof__thedirectory__pathstrings__thatwere__foundand__recordedduring__thecandidates__scanby__step 3.This____path__attribute__isthen__usedas__theset__ofcandidates__forlater__anddeeper__accesses,to__searchthe__oneor__morecomponent__foldersof__thenamespace__package.That__is,each__recordedentry__ona__namespacepackage__s__path____issearched__whenever further-nesteditems__are requested,instead__ofthe__soledirectory__ofa__regular package.Viewed__another way,the____path__attribute__ofa__namespacepackage__servesthe__samerole__for lower-levelcomponents__that sys.pathdoes__atthe__topfor__theleftmost__componentof__packageimport__paths;it__becomesthe__parentsearch__pathfor__accessinglower__itemsusing__thesame__four-stepprocedure__just sketched.The__netresult__isthat__anamespace__packageis__asort__ofvirtual__concatenationof__directorieslocated__onone__ormore__search candidates.Once__anamespace__packageis__created, though,there__isno__functionaldifference__betweenit__anda__regular package;it__supportseverything__weve__learnedfor__regular packages,including__package-relativeimport__syntax. Importantly,because__asingle__directorylacking__an __init__.pybut__nestedin__a search-candidatefolder__isclassified__asa__namespacepackage__bythis__algorithms__step 3,any__suchdirectory__qualifiesas__a package.The__onlyoperational__differencebetween__sucha__singlefolder__anda__regularpackage__folderis__thatthe__formerhas__lowersearch__precedence:both__same-namedfolders__withan____init__.pyand__simplemodules__anywherein__asearch__pathare__chosenfirst__bysteps__1and__2.In__other words,although__themods__madeto__supportnamespace__packagesmake____init__.pyfiles__optionalin__package folders,adding__one,even__if empty,ensures__thata__packagewill__beselected__insteadof__a same-namedfolder__lateron__asearch__path (itmay__alsoboost__importspeed__byending__search-pathscans__atstep__1,but__thisis__a one-time event).Whether__this,or__theother__rolesof____init__.pywe__met earlier,warrants__includingthis__filewill__naturallydepend__onyour__goals.Namespace__Packagesin__Action Technically,we__vealready__seennamespace__packagesat__work:the__openingstep__ofthe__demoat__thestart__ofthis__chaptermade__single-foldernamespace__packagesbecause__itsfolders__didnt__yethave____init__.py files. Again,any__foldernested__ina__sys.path search-pathfolder__qualifiesas__a package,as__longas__its__nothidden__bya__same-namedregular__packagewith____init__.pyor__asimple__moduleelsewhere__onthe__path.To__seethe__grander folder-concatenationeffect__ofvirtual__namespacepackages__work,let__swork__througha__quick demo.To__begin,make__twomodules__ina__nesteddirectory__structurethat__hassubdirectories__namedsub__locatedin__differentparent__directories, part1and__part2like__thisin__indentationnotation__meantto__represent nesting: ns/ part1/ sub/ mod1.py part2/ sub/ mod2.pyNote__thatthere__areno____init__.pyfiles__hereas__noted earlier,these__filescannot__beused__innamespace__packages,as__thisis__theirchief__differentiationfrom__regular, single-folder packages.We__cancreate__thisdemo__sfolders__withconsole__commandslike__the following;translate__/to__\and__omitthe__-pon__Windows,or__usea__fileexplorer__orthe__prebuiltfolders__inthe__examplespackage__ifyou__prefer: $mkdir__-p ns/part1/sub #Two__subdirsof__samename__indifferent__dirs $mkdir__-p ns/part2/sub #And__similaron__WindowsThe__modulesat__theend__ofthese__pathsare__codedin__Examples 24-10and__24-11to__simplyprint__onimports__asa__trace.Example__24-10. ns/part1/sub/mod1.py print('Loading ns/part1/sub/mod1')Example__24-11. ns/part2/sub/mod2.py print('Loading ns/part2/sub/mod2') Now,if__weadd__both part1and__part2to__themodule__search path,sub__becomesa__namespacepackage__spanningboth__folders,with__thetwo__modulefiles__availableunder__thatname__eventhough__theylive__inseparate__physical directories.Here__sthe__path-settingcommand__onUnix__(for Windows,use__setand__:,and__seeChapter__22for__more tips);this__usespaths__relativeto__the CWD,but__inpractice__wouldmore__likelylist__two full,absolute__paths instead: $export__PYTHONPATH=ns/part1:ns/part2When__imported directly,the__namespacepackage__isthe__virtualconcatenation__ofits__individualdirectory__components,and__allowsfurther__nestedparts__tobe__accessedthrough__its single,composite__namewith__normalimports__(as usual,paths__havebeen__shortenedhere__forspace__withand__linebreaks__wereadded__for fit): $ python3 >>>import__sub >>>sub__#Namespace__packages:nested__searchpaths__>>>from__subimport__mod1Loading__ns/part1/sub/mod1 >>>import__sub.mod2 #Content__fromtwo__differentdirectories__Loading ns/part2/sub/mod2 >>> mod1 >>> sub.mod2This__split-folderpackage__alsoworks__ifwe__importthrough__thenamespace__packagename__immediatelybecause__thenamespace__packageis__madewhen__first reached,the__timingof__pathextensions__is irrelevant: $ python3 >>>import__sub.mod1Loading__ns/part1/sub/mod1 >>>import__sub.mod2 #One__packagespanning__twodirectories__Loading ns/part2/sub/mod2 >>> sub.mod1 >>> sub.mod2 >>>sub__>>> sub.__path__ _NamespacePath( ['/ /LP6E/Chapter24/ns/part1/sub', '/ /LP6E/Chapter24/ns/part2/sub']) Interestingly,relative__importswork__innamespace__packages too,if__weadd__oneas__inExample__24-12.Example__24-12. ns/part1/sub/mod1.py (modified)from__.import__mod2 print('Loading ns/part1/sub/mod1')The__added package-relativeimport__statementreferences__afile__inthe__packageeven__thoughthe__referencedfile__residesin__adifferent__directory: $ python3 >>>import__sub.mod1 #Relative__importof__mod2in__anotherdir__Loading ns/part2/sub/mod2Loading__ns/part1/sub/mod1 >>>import__sub.mod2 #Already__importedby__mod1.py:not__rerun >>> sub.mod2As__youcan__see,namespace__packagesare__likeordinary__single-directorypackages__inevery__way,except__forhaving__asplit__physical storage.By__extension,this__iswhy__codefolders__without __init__.pyfiles__areexactly__likeregular__packages,but__withno__initializationlogic__tobe__run;they__rejust__aninstance__ofnamespace__packageswith__asingle__directory.Like__package-relative imports,this__bookis__alsogoing__todefer__toPython__smanuals__formore__detailson__this subject.Namespace__packagesare__apotentially__useful tool,but__mostPython__learnersare__probablybetter__servedby__firstmastering__packagesthat__mapto__real folders,before__tacklingthose__thatare__spreadvirtually__acrossa__hosts__directories.Chapter__SummaryThis__chapterintroduced__Pythons__packageimport__modelan__optionalbut__usefulway__toexplicitly__listpart__ofthe__directorypath__leadingup__to modules.Package__importsare__stillrelative__toa__directoryon__yourmodule__search path,but__yourscript__givesthe__restof__thepath__tothe__module explicitly.Packages__maybe__builtwith__asimple__folderand__canmake__importsmore__meaningful,simplify__import search-path settings,and__resolveambiguities__whenthere__ismore__thanone__moduleof__thesame__namethe__nameof__theenclosing__directorymakes__them unique.Because__its__relevantonly__tocode__in packages,we__alsoexplored__relative imports:a__wayfor__importsin__packagefiles__toselect__modulesin__thesame__packageexplicitly__usingleading__dotsin__from,instead__ofrelying__ona__searchin__the host. Finally,we__surveyednamespace__packages:a__toolthat__allowsa__packageto__spanmultiple__directoriesas__afallback__optionof__import searches,and__makeinitialization__filesoptional__in single-folder packages.The__nextchapter__surveysa__handfulof__bothcommon__andadvanced__module-related__topics,such__asthe____name__usage__mode variable,the____getattr__attribute__hook,and__name-string imports,and__codesuseful__moduletools__alongthe__way.As__usual, though,let__sclose__outthis__chapterfirst__witha__shortquiz__toreview__whatyou__velearned__here.Test__Your Knowledge:Quiz__1.What__isthe__purposeof__an __init__.pyfile__ina__modulepackage__directory? 2.How__canyou__avoidrepeating__thefull__packagepath__everytime__youreference__apackage__s content? 3.Which__directoriesrequire____init__.py files? 4.When__mustyou__useimport__insteadof__fromwith__packages? 5.What__isthe__differencebetween__frompkg__importname__andfrom__.import__name? 6.What__isa__namespace package?Test__Your Knowledge:Answers__1.The____init__.pyfile__servesto__declareand__initializea__regularmodule__package;Python__automaticallyruns__itscode__thefirst__timeyou__importthrough__adirectory__ina__process.Its__assignedvariables__becomethe__attributesof__themodule__objectcreated__inmemory__tocorrespond__tothat__directory.It__soptional__forpackage__foldersbut__givesa__foldersearch__precedenceover__otherfolders__ofthe__samename__thatdon__thave__this file. 2.Use__thefrom__statementwith__apackage__tocopy__namesout__ofthe__package directly,or__usethe__asextension__withthe__importstatement__torename__thepath__toa__shorter synonym.In__both cases,the__pathis__listedin__onlyone__place,in__thefrom__orimport__statement. 3.Trick__question!These__filesused__tobe__requiredfor__packagesin__earlierPythons__butbecame__optionalwith__accommodationsfor__namespacepackages__inthe__modulesearch__algorithm.As__notedin__answer 1, though,these__foldersstill__have valid,if__optional, roles,including__boostinga__folders__import-search precedence. 4.You__mustuse__importinstead__offrom__withpackages__onlyif__youneed__toaccess__thesame__namedefined__inmore__thanone__path.With__import,the__pathmakes__thereferences__unique,but__fromallows__onlyone__versionof__anygiven__name (unlessyou__alsouse__theas__extensionto__rename uniquely). 5.The__frompkg__importname__isan__absoluteimport__thesearch__forpkg__skipsan__enclosingpackage__andthen__triesthe__absolutedirectories__in sys.path.A__statementfrom__.import__name,on__theother__hand,is__arelative__importname__islooked__uprelative__tothe__packagein__whichthis__statementis__contained, only. 6.A__namespacepackage__isan__extensionto__theimport__modelthat__correspondsto__oneor__moredirectories__thatdo__nothave____init__.py files.When__Pythonfinds__theseduring__animport__searchand__doesnot__finda__simplemodule__orregular__package first,it__createsa__namespacepackage__thatis__thevirtual__concatenationof__allfound__directorieshaving__therequested__module name.Further__nestedcomponents__arelooked__upin__allthe__namespacepackage__s directories.The__effectis__similarto__aregular__package,but__contentmay__besplit__acrossmultiple__directories.Chapter__25.Module__Oddsand__EndsThis__chapterconcludes__thispart__ofthe__bookwith__anassortment__of module-related__topicsdata__hiding,the____future__ module,the____name__ variable, name-string imports,the____gettattr__ hook,transitive__reloads,and__morealong__withthe__usualset__ofgotchas__andexercises__relatedto__whatwe__vecovered__inthis__partof__the book.Along__the way,we__llbuild__someuseful__toolsthat__combinefunctions__and modules.Like__functions,modules__aremore__effectivewhen__theirinterfaces__are well-defined,so__thischapter__alsobriefly__reviewsmodule__design concepts.Though__somecoverage__heremight__qualifyas__advancedand__optional,this__ismostly__amiscellany__ofadditional__module subjects.Because__someof__thetopics__discussedhere__arevery__widelyused__especiallythe____name__ dual-modetrick__besure__tobrowse__herebefore__movingon__toclasses__inthe__nextpart__ofthe__book.Module__DesignConcepts__First up,some__perspective.Like__functions,modules__presentdesign__trade-offs:you__haveto__thinkabout__whichfunctions__goin__which modules,module__communication mechanisms,and__so on.All__ofthis__willbecome__clearerwhen__youstart__writingbigger__Python systems,but__hereare__afew__generalideas__tokeep__in mind:You__realways__ina__modulein__Python.There__sno__wayto__writecode__thatdoesn__tlive__insome__module.As__mentionedbriefly__inChapters__17and__21,even__codetyped__atthe__interactiveprompt__(a.k.a. REPL)really__goesin__a built-inmodule__called __main__;the__onlyunique__thingsabout__theinteractive__promptare__thatcode__runsand__isdiscarded__immediately,and__expressionresults__areprinted__automatically.Minimize__module coupling:global__variables.Like__functions,modules__workbest__ifthey__rewritten__tobe__mostlyclosed__boxes.As__arule__of thumb,they__shouldbe__asindependent__ofglobal__variablesused__withinother__modulesas__possible,except__forfunctions__andclasses__importedfrom__them.The__onlythings__amodule__shouldshare__withthe__outsideworld__arethe__toolsit__uses,and__thetools__it defines.Maximize__module cohesion:unified__purpose.Also__like functions,you__canminimize__amodule__scouplings__bymaximizing__its cohesion.If__allthe__componentsof__amodule__sharea__general purpose,they__reless__likelyto__dependon__external names.Modules__shouldrarely__changeother__modules variables.We__illustratedthis__withcode__inChapter__17,but__its__worthrepeating__here:it__sperfectly__OKto__useglobals__definedin__anothermodule__(thats__howclients__import services,after__all),but__changingglobals__inanother__moduleis__oftena__symptomof__adesign__problem.There__are exceptions,of__course,but__youshould__tryto__communicateresults__throughdevices__suchas__functionarguments__andreturn__values,not__cross-module changes. Otherwise,your__globalsvalues__becomedependent__onthe__orderof__arbitrarilyremote__assignmentsin__other files,and__yourmodules__becomeharder__tounderstand__and reuse.As__a summary,Figure__25-1sketches__theenvironment__inwhich__modules operate.Modules__contain variables, functions,and__classes,and__importother__modulesfor__thetools__they define.Functions__havelocal__variablesof__their own,as__doclasses__objectsthat__livewithin__modulesand__whichwe__llbegin__studyingin__thenext__chapter.As__wesaw__inPart__IV,functions__can nest, too,but__allare__ultimatelycontained__bymodules__atthe__top.Figure__25-1.Module__executionenvironment__DataHiding__inModules__Next,we__turnto__private matters.As__weve__seen,a__Pythonmodule__exportsall__thenames__assignedat__thetop__levelof__its file.There__isno__syntaxfor__declaringwhich__namesshould__andshouldn__tbe__visibleoutside__the module.In__fact,there__sno__wayto__preventa__clientfrom__changingnames__insidea__moduleif__itwants__to.In__Python,data__hidingin__modulesis__a convention,not__asyntactical__constraint.If__youwant__tobreak__amodule__bytrashing__its names,you__can,but__mostprogrammers__dont__countthis__asa__life goal.Some__puristsobject__tothis__liberalattitude__towarddata__hiding,claiming__thatit__meansPython__cant__implement encapsulation. However,encapsulation__inPython__ismore__aboutpackaging__thanabout__restricting.We__llexpand__onthis__ideain__thenext__partin__relationto__classes,which__alsohave__noprivacy__syntaxbut__canoften__emulateits__effectin__code.Minimizing__from * Damage:_X__and__all____Thatbeing__said,as__alimited__special case,you__canprefix__nameswith__asingle__underscore (e.g., _X)to__preventthem__frombeing__copiedout__whena__clientimports__amodule__snames__witha__from * statement.This__reallyis__intendedonly__tominimize__namespace pollution;because__from *copies__outall__names,the__importermay__getmore__thanit__sbargained__for (includingnames__thatoverwrite__namesin__the importer).But__underscoresaren__tprivate__declarations:you__canstill__seeand__changesuch__nameswith__otherimport__forms.Example__25-1demos__the idea.Example__25-1. unders.py a, b, _c,_d__= 1, 2, 3, 4 #Control__from * exports,take__1When__namesboth__withand__withoutunderscores__areassigned__this way,from__*can__tsee__the former,but__importand__normalfrom__can: $ python3 >>>from__undersimport__* #Load__non_X__namesonly__onfrom__* >>> a,b__(1, 2) >>>_c__NameError:name__'_c'is__not defined.Did__you mean: '_'? >>>from__undersimport___c #But__otherimporters__getevery__name >>>_c__3 >>>import__unders >>> unders._d 4 Alternatively,you__canachieve__ahiding__effectsimilar__tothe___Xnaming__conventionby__assigninga__listof__variablename__stringsto__thevariable____all__at__thetop__levelof__the module.When__thisfeature__is used,the__from *statement__willcopy__outonly__thosenames__listedin__the__all____list,though__otherimports__workas__before.In__effect,this__isthe__converseof__the_X__convention:__all____identifiesnames__tobe__copied,while___Xidentifies__namesnot__tobe__copied.Python__looksfor__an__all____listin__themodule__first,and__copiesits__namesirrespective__ofany__underscores;if____all__is__not found,from__*copies__allnames__withouta__singleleading__underscore.To__demo,Example__25-2uses__both name-hiding tools.Example__25-2. alls.py__all____= ['a', '_c'] #Control__from * exports,take__2 a, b, _c,_d__= 1, 2, 3, 4 #__all____hasprecedence__over_X__On imports,from__*gets__everythingin____all__,but__no others;other__importersagain__get everything: $ python3 >>>from__allsimport__* #Load____all__names__-only__>>> a,_c__#Even__ifthey__haveunderscores__(1, 3) >>>b__NameError:name__'b'is__notdefined__>>>from__allsimport__a, b, _c,_d__#But__otherimporters__getevery__name >>> a, b, _c,_d__(1, 2, 3, 4) >>>import__alls >>> alls.a, alls.b, alls._c, alls._d (1, 2, 3, 4)Like__the_X__convention,the____all__list__hasmeaning__onlyto__thefrom__*statement__formand__doesnot__amountto__aprivacy__declaration:other__importstatements__canstill__accessall__names,as__thelast__twotests__show. Still,module__writerscan__useeither__techniqueto__implementmodules__thatare__well-behavedwhen__usedwith__from *.See__alsothe__discussionof____all__lists__inpackage____init__.pyfiles__inChapter__24.In__this context,these__listsdeclare__nestedsubmodules__tobe__automaticallyloaded__fora__from *run__ontheir__container.The__effectis__similarto__namehiding__inmodule__files,though__packagesextend__itto__applyto__thecontent__ofa__packagefolder__inthe__filesystem.Managing__Attribute Access:__getattr____and__dir____Onthe__subjectof__datahiding__in modules,Python__3.7added__supportfor__specialfunctions__ata__modules__toplevel__thatcan__beused__tomanage__accessto__amodule__s attributes.If__defined,a__modules____getattr__function__isautomatically__runwhen__amodule__attributeis__not found,and__its__dir____overridesthe__normal attribute-listfetch__runfor__thedir__built-in.These__canbe__usedto__implementboth__basicaccess__constraintsand__arbitrarilydynamic__interfaces.These__functionsalso__shadow same-namedtools__inclasses__andare__meantin__partto__obviatea__long-standingand__obscuretrick__thatreset__amodule__sobject__inthe__sys.modulestable__toan__instanceof__aclass__withthese__same methods. This,of__course,means__thatthese__functionsmay__makemore__senseafter__westudy__classesin__Part VI,but__theartificial__modulein__Example 25-3demos__the basics.Example__25-3. gamod.pyvar__= 2 #Real__attributereturned__directlydef____getattr__(name): #Undefined__attrfetches__routedhere__print(f'(virtual {name})', end=' ')match__name:case__'test':return__name *var__case 'hack' | 'code':return__name.upper()case___:raise__AttributeError(f'{name}is__undefined')def____dir__():return__['var', 'test', 'hack', 'code']When__imported,fetches__ofreal__attributesdefined__inthe__modulework__normally (subjectto__the_X__and__all____ofthe__priorsection__forfrom__*),but__missingnames__arerouted__to __getattr__,which__canmanage__the request.It__mayalso__usea__raisestatement__toflag__aninvalid__requestwith__anexception__atopic__well__studyin__fulllater__inthe__bookbecause__its__alsodependent__onclasses__today: >>>import__gamod >>> gamod.var # Real:__getattr____notcalled__2 >>> gamod.test # Virtual:computed__whenfetched__(virtual test) 'testtest' >>> gamod.hack (virtual hack) 'HACK' >>> gamod.nonesuch AttributeError:nonesuch__isundefined__>>> dir(gamod) ['code', 'hack', 'test', 'var']The__fromstatement__invokes__getattr____too,though__from *requires__namesto__belisted__on__all____(youcan__largelyignore__thespurious____path__fetch__here,though__a__getattr____mustaccommodate__it): >>>from__gamodimport__code (virtual __path__) (virtual code) >>>code__'CODE' >>>from__gamodimport__* (virtual __path__) (virtual __all__) >>>var__2 >>>hack__NameError:name__'hack'is__notdefined__Importantly,__getattr____isnot__runfor__global-scopelookup__withinthe__module itself,so__in-fileundefined__namesremain__undefined.It__sreally__justfor__attributefetches__fromother__modulesand__doesnot__catchassignments__anywhere.For__example,the__firstline__ofthe__followingadded__atthe__bottomof__Example 25-3would__fail,and__thesecond__linerun__inthe__REPLwould__makea__newattribute__inthe__modulewhich__bypasses__getattr____thereafter: print(test) # File:does__NOTcall____getattr__ (raises NameError) gamod.hack = 'real' # REPL:does__NOTcall____getattr__ (makes attribute)Although__thisall__worksas__advertised,it__isa__tool-builders__hook,and__youll__haveto__unearthlegitimate__use cases.It__maybe__usefulin__narrow roles,but__italso__conflatesmodules__withclasses__anddiscounts__thefact__thatmodule__learnersdo__notalready__understandthese__functionsorigins__in classes.This__isa__regrettablycommon__themein__Python:additions__oftencome__withforward__dependenciesthat__seemto__expectusers__toalready__knowPython__inorder__touse__Python.Python__isnot__justfor__Python experts,but__thats__amessage__bakedinto__manya__mod.The__goodnews__heremay__bethat__alater__proposalto__addclasses____setattr__for__module-attributeassignment__wasrejected__byPython__ssteering__committeethough__onlyafter__allowing__getattr____and__dir____tosneak__in.As__usual,you__shouldweigh__theconvolutions__ofthis__extensionagainst__its real-world applications.Enabling__Language Changes:__future____Speakingof__changes,Python__modsthat__maybreak__existingcode__areoften__introduced gradually.This__isnot__alwaysas__gradualas__itmight__be,and__version 3.0was__aglaring__exception (though 2.Xwas__supportedfor__12more__yearsafter__3.Xs__release). Sometimes, though,changes__initiallyappear__asoptional__extensions,which__aredisabled__by default.To__enablesuch__anextension__inPythons__thatpredate__itsofficial__arrival,use__aspecial__importstatement__ofthis__form:from____future__import__featurenameWhen__codedin__a script,this__statementmust__appearas__thefirst__executablestatement__inthe__file (possiblyfollowing__adocstring__or comment),because__itenables__specialcompilation__ofcode__ona__per-module basis.It__salso__possibleto__submitthis__statementat__theinteractive__promptto__experimentwith__upcominglanguage__changes;the__featurewill__thenbe__availablefor__theremainder__ofthe__interactive session.For__example,the__prioredition__ofthis__bookused__thisstatement__inPython__2.Xto__activate 3.Xtrue__divisionof__Chapter 5, 3.Xprint__callsof__Chapter 11,and__3.Xabsolute__importsfor__packagesof__Chapter 24.Earlier__editionsused__thisstatement__formto__demonstrategenerator__functions,which__requirea__yieldthat__wasnot__yetenabled__by default.This__editionis__boldlygoing__forwardwith__the present,but____future__can__beused__inolder__Pythonsto__enablePython__3.7s__StopIterationbubbling__behaviordescribed__atthe__endof__Chapter 20:from____future__import__generator_stopFor__alist__offuturisms__youmay__importand__turnon__this way,see__thePython__librarymanual__sentry__for __future__.Per__its documentation,none__ofits__featurenames__willever__be removed,so__its__safeto__leavein__a__future____importeven__incode__runby__aversion__ofPython__wherethe__featureis__enabled normally.The__futuredoes__noterase__the past. Dual-Usage Modes:__name____and__main____Ournext__module-relatedtrick__letsyou__bothimport__afile__asa__moduleand__runit__asa__standalone script,a__hookthat__iswidely__usedin__Python files.It__sactually__sosimple__thatsome__learnersmiss__thepoint__at first.Each__modulehas__a built-inattribute__called __name__,which__Pythoncreates__andassigns__automaticallyas__follows:If__thefile__isbeing__runas__a top-levelscript__file,__name____isset__tothe__string '__main__'when__it starts.If__thefile__isbeing__imported instead,__name____isset__tothe__modules__nameas__knownby__its clients.The__upshotis__thata__modulecan__testits__own__name____todetermine__whetherit__sbeing__runor__imported.For__example,suppose__wecreate__thecode__filenamed__dualmode.pyin__Example 25-4,with__asingle__functioncalled__title.Example__25-4. dualmode.pydef__title(): print('Learning Python, 6E')if____name__ == '__main__': #Only__whenrun__title() #Not__whenimported__Thismodule__definesa__functionfor__clientsto__importand__useas__usual: $ python3 >>>import__dualmode >>> dualmode.title()Learning__Python, 6EBut__themodule__alsoincludes__codeat__thebottom__thatis__setup__tocall__thefunction__automaticallywhen__thisfile__isrun__asa__program: $ python3 dualmode.pyLearning__Python, 6EIn__effect,a__modules____name__variable__servesas__ausage__mode flag,allowing__itscode__tobe__leveragedas__bothan__importablelibrary__anda__top-level script.Though__simple,you__llsee__thishook__usedin__manyof__thePython__programfiles__youare__likelyto__encounterin__thewild__bothfor__testingand__dual usage.For__instance,one__ofthe__mostcommon__waysyou__llsee__the__name____testapplied__isfor__self-test code.In__short,you__canpackage__codethat__testsa__modules__exportsin__themodule__itselfby__wrappingit__ina____name__test__atthe__bottomof__the file.This__way,you__canuse__thefile__inclients__byimporting__it,but__alsotest__itslogic__byrunning__itfrom__thesystem__shellor__otherlaunching__scheme.Coding__self-testcode__atthe__bottomof__afile__underthe____name__test__isprobably__themost__commonand__simplest unit-testingprotocol__in Python.It__smuch__moreconvenient__thanretyping__allyour__testsat__theinteractive__prompt. (Preview:Chapter__36will__discussother__commonlyused__optionsfor__testingPython__codeas__youll__see,the__unittestand__doctest standard-librarymodules__providemore__advancedtesting__tools.)In__addition,the____name__trick__isalso__commonlyused__whenyou__rewriting__filesthat__canbe__usefulboth__as command-lineutilities__andas__tool libraries.For__instance,suppose__youwrite__a file-finderscript__in Python.You__canget__moremileage__outof__yourcode__ifyou__packageit__in functions,and__adda____name__test__inthe__fileto__automaticallycall__thosefunctions__whenthe__fileis__run standalone.That__way,the__scripts__codebecomes__reusablein__other programs.NOTE__Whats__ina____name__?:Don__tconfuse__the__main____hookhere__withthe____main__.pyfile__discussedin__theprior__chapter.That__fileserves__asa__scriptwhen__runningan__entirepackage__folderas__a program,but__testingwhether____name__is__'__main__'is__usedto__givetwo__rolesto__asingle__file.Python__oftenconflates__thesame__namesfor__similarbut__differentpurposes__see __getattr__! Example:Unit__Testswith____name__In__fact,we__vealready__seennumerous__casesin__thisbook__wherethe____name__check__couldbe__useful.As__one example,we__codeda__scriptin__Chapter 18that__computedthe__minimumvalue__fromthe__setof__argumentssent__Example 18-3,whose__codeis__repeatedhere__forease__of reference:def__minmax(test, *args):res__= args[0]for__argin__args[1:]:if__test(arg, res):res__=arg__returnres__def lessthan(x, y):return__x <y__def grtrthan(x, y):return__x >y__print(minmax(lessthan, 4, 2, 1, 5, 6, 3)) # Self-testcode__print(minmax(grtrthan, 4, 2, 1, 5, 6, 3))This__scriptincludes__self-testcode__atthe__bottom,so__wecan__testit__withouthaving__toretype__testcode__inthe__REPLeach__timewe__run it.The__problemwith__theway__itis__currently coded, however,is__thatthe__outputof__the self-testcall__willappear__whenthis__fileis__importedfrom__anotherfile__tobe__usedas__atool__notexactly__a client-friendly feature!To__do better,we__canwrap__upthe__self-testcall__ina____name__check__sothat__itwill__belaunched__onlywhen__thefile__isrun__asa__top-level__script,not__whenit__is imported.Example__25-5lists__this new-and-improvedversion__ofthe__module.Example__25-5. minmax.py print('I am:', __name__)def__minmax(test, *args):res__= args[0]for__argin__args[1:]:if__test(arg, res):res__=arg__returnres__def lessthan(x, y):return__x <y__def grtrthan(x, y):return__x >y__if__name____== '__main__': print(minmax(lessthan, 4, 2, 1, 5, 6, 3)) # Self-testcode__print(minmax(grtrthan, 4, 2, 1, 5, 6, 3))We__realso__printingthe__valueof____name__at__thetop__hereto__traceits__value (somethingyou__wouldnt__doin__areal__library module).Python__createsand__assignsthis__usage-modevariable__assoon__asit__startsloading__a file.When__werun__thisfile__asa__top-level script,its__nameis__setto____main__,so__its self-testcode__kicksin__automatically: $ python3 minmax.pyI__am:__main____1 6If__weimport__the file, though,its__nameis__not __main__,so__wemust__explicitlycall__thefunction__tomake__it run: $ python3 >>>import__minmaxI__am:minmax__>>> minmax.minmax(minmax.lessthan, *'hack') 'a' Again,regardless__ofwhether__thisis__usedfor__testing,the__neteffect__isthat__weget__touse__ourcode__intwo__differentroles__asa__librarymodule__of tools,or__asan__executable program.It__s buy-one-get-one code.You__llalso__seeprograms__thatroute__program-moderuns__intoa__modulecalled__main:def__main():if____name__ == '__main__': main()This__works,but__its__extra code,and__theres__nothingspecial__abouta__functionnamed__mainin__Pythonunlike__someother__languages,which__maybe__partof__theinspiration__forthis__indirections__appearancein__Python code.NOTE__Fishingtutorial__past:For__anotherexample__ofthe____name__ == '__main__'test__at work,see__the dual-mode script/module formats.pyin__thisbook__sexamples__package.It__formatsnumbers__withcommas__andcurrency__conventionsand__demoshow__youcan__codeyour__ownflexible__toolsinstead__ofrelying__on built-ins.It__didnt__addmuch__hereand__wascut__inthis__editionfor__space,but__providesoptional__self-studycode__andunderscores__thatlearning__tofish__generallybeats__beinggiven__one.The__asExtension__forimport__andfrom__Nexton__thetour__isa__follow-upon__atopic__introducedin__Chapter 23s__name-collision__coverage.As__aminor__butuseful__convenience,both__theimport__andfrom__statementssupport__anoptional__as clause,which__simplyrenames__aname__importedby__your script.For__example,the__followingimport__statementusing__theas__extension:import__modulenameas__name #And__use name,not__modulenameis__equivalentto__thefollowing__setof__three statements,which__renamesthe__modulein__theimporter__sscope__only (its__stillknown__byits__originalname__toother__files),and__dropsthe__originalname__inthe__importers__scope altogether:import__modulename #Run__anormal__importname__=modulename__#Rename__themodule__-here__delmodulename__#Discard__theoriginal__name -here__Afteran__importwith__as,you__canand__in fact,must__usethe__namelisted__afterthe__asto__referto__the module.The__longerequivalent__worksbecause__modulesare__first-classobjects__justlike__functions,and__canbe__passedaround__freely.The__asextension__worksin__afrom__statement, too,to__assigna__nameimported__froma__fileto__adifferent__namein__theimporter__s scope.As__before,you__getonly__thenew__nameyou__provide,not__its original:from__modulenameimport__attrnameas__name #And__use name,not__attrnameThis__inturn__worksthe__sameas__thefollowing__statements:from__modulenameimport__attrnamename__=attrname__delattrname__Asnoted__inChapter__23,this__extensionis__commonlyused__bothto__provideshorter__synonymsfor__longernames__andto__avoidname__clasheswhen__youare__alreadyusing__aname__inyour__scriptthat__wouldotherwise__beoverwritten__bya__normal import:import__reallylongmodulenameas__name #Use__shorternickname__name.func() #Rename__tomake__shorterfrom__module1import__utilityas__util1 #Can__haveonly__one "utility"from__module2import__utilityas__util2 #Rename__tomake__unique util1(); util2()By__wayof__review,the__asclause__alsocomes__inhandy__forproviding__a short,simple__namefor__anentire__directorypath__andavoiding__namecollisions__whenusing__thepackage__importfeature__describedin__Chapter 24:import__dir1.dir2.modas__mod #Only__listfull__pathonce__mod.func() #Only__onechange__ifpath__changesfrom__dir1.dir2.modimport__funcas__modfunc #Rename__tomake__uniqueif__needed modfunc() #Allow__functo__besomething__else Finally,the__asclause__isalso__somethingof__ahedge__againstname__changes:if__anew__releaseof__alibrary__renamesa__moduleor__toolyour__codeuses__extensively,or__providesa__newalternative__youd__ratheruse__instead,you__cansimply__renameit__toits__priorname__onimport__toavoid__breakingyour__code:import__newnameas__oldnamefrom__libraryimport__newnameas__oldnameand__keephappily__usingoldname__untilyou__havetime__toupdate__allyour__codeThat__said,if__allsoftware__changeswere__justname__changes,we__dhave__alot__lessto__fillour__time!Module__IntrospectionNext__upis__module plumbing.Because__modulesexpose__mostof__theirinteresting__propertiesas__built-in attributes,it__seasy__towrite__programsthat__manageother__programstools__weusually__call metaprograms,because__theirsubjects__areother__programs.This__domainis__alsoreferred__toas__introspection,because__programscan__seeand__processobject__internals.Introspection__isa__somewhatadvanced__feature,but__itcan__beuseful__forbuilding__programming tools.For__instance,to__fetchthe__valueof__amodule__s attribute,we__canuse__attributequalification__orindex__themodule__sattribute__dictionary,exposed__inthe__built-in__dict____attributewe__exploredin__Chapter 23.As__weve__also seen,Python__svars__built-inis__analternative__wayto__access __dict__,and__its sys.modulesdictionary__recordsall__loadedmodules__by import-name string.In__addition,its__getattr built-inlets__usfetch__attributesfrom__theirstring__namesit__slike__saying object.attr,but__attris__anexpression__thatproduces__astring__at runtime. Hence,all__thefollowing__expressionsreach__thesame__attributeand__objectnamed__nameafter__importingM__and sys: M.name #Qualify__objectby__attribute M.__dict__['name'] #Index__namespacedictionary__manually vars(M)['name'] #Namespace__dictionaryalternative__sys.modules['M'].name #Index__loaded-modulestable__manually getattr(M, 'name') #Call__built-infetch__function sys.modules['M'].__dict__['name'] #Module__andattribute__namestrings__Demoingwith__Example 25-5 (andchained__comparisonsthat__implyan__andand__a right-side repeat): >>>import__minmax,sys__>>> (minmax.lessthanis__minmax.__dict__['lessthan']is__vars(minmax)['lessthan']is__sys.modules['minmax'].lessthanis__getattr(minmax, 'lessthan')is__sys.modules['minmax'].__dict__['lessthan'])True__Of course,the__firstof__theseis__mucheasier__onthe__eyes (and keyboard),but__theothers__supportmore__generic access. Example:Listing__Moduleswith____dict__By__exposingmodule__internalslike__this,Python__helpsyou__buildprograms__about programs.As__a demo,the__modulein__Example 25-6,named__mydir.py,puts__theseideas__towork__toimplement__acustomized__andexpanded__versionof__the built-indir__function.It__definesand__exportsa__functioncalled__listing,which__takesa__moduleobject__asan__argumentand__printsa__formatteddisplay__ofthe__modules__namespacesorted__byattribute__name.Example__25-6. mydir.py """ mydir.py:a__modulethat__liststhe__namespacesof__other modules.Import__this module'slisting__andpass__animported__module,or__runthis__fileas__ascript__toperform__its self-test code. """sepchr__= '-'seplen__= 60def__listing(module, verbose=True, unders=True): """List__module:just__attributesif__verbose=False,hide__built-in__X____attributesif__unders=False. """sepline__=sepchr__*seplen__if verbose: print(sepline) print(f'name: {module.__name__}\nfile: {module.__file__}') print(sepline) #Scan__namespacekeys__for (count, attr)in__enumerate(sorted(module.__dict__)):prefix__= f'{count + 1:02d}) {attr}'if__attr.startswith('__'):if__unders: print(prefix, '') #Skip____file__, etc. else: print(prefix, getattr(module, attr)) #Or__module.__dict__[attr]if__verbose: print(sepline) print(f'{module.__name__}has__{count + 1} names') print(sepline)if____name__ == '__main__':import__mydir listing(mydir) # Self-test code:list__myselfNotice__thedocstrings__inthis__module;because__wemay__wantto__usethis__asa__general tool,the__docstringsprovide__functionalinformation__accessiblevia__helpand__thebrowser__modeof__PyDoctools__thatuse__similarintrospection__toolsto__dotheir__jobs (seeChapter__15for__usage info).A__self-testis__alsoprovided__atthe__bottomof__this module,which__narcissisticallyimports__andlists__itself;here__sthe__sortof__outputproduced__(withpath__editsfor__space): $ python3 mydir.py ------------------------------------------------------------ name:mydir__file: /Users/me/ /LP6E/Chapter25/mydir.py ------------------------------------------------------------ 01)__builtins____02)__cached____03)__doc____04)__file____05)__loader____06)__name____07)__package____08)__spec____09)listing__10)sepchr__- 11)seplen__60 ------------------------------------------------------------mydir__has 11names__------------------------------------------------------------To__usethis__asa__toolfor__listingother__modules,simply__passthe__modulesin__asobjects__tothis__files__function.Here__itis__listingitself__manually,as__wellas__attributesin__thetkinter__GUImodule__inthe__Pythonstandard__library;it__willtechnically__workon__anyobject__with __name__, __file__,and____dict__ attributes: >>>from__mydirimport__listing >>>import__mydir,tkinter__>>> listing(mydir, unders=False, verbose=False) 09)listing__10)sepchr__- 11)seplen__60 >>> listing(tkinter, unders=False) ------------------------------------------------------------ name:tkinter__file: / /lib/python3.12/tkinter/__init__.py ------------------------------------------------------------ 01)ACTIVE__active 02)ALL__all 03)ANCHOR__anchor 04)ARC__arc ...morenames__omitted... 166)re__167)sys__168)types__169)wantobjects__1 ------------------------------------------------------------tkinter__has 169names__------------------------------------------------------------You__llmeet__getattrand__itsrelatives__again later.The__pointto__noticehere__isthat__mydiris__aprogram__thatlets__youbrowse__other programs.Because__Pythonexposes__its internals,you__canprocess__objects generically.NOTE__REPLstartup__tip:You__canpreload__toolssuch__as mydir.listingand__thereloader__well__codein__amoment__intothe__interactiveREPL__byimporting__themin__afile__namedby__thePYTHONSTARTUP__environment variable.Because__codein__thestartup__fileruns__inthe__interactive namespace,importing__commontools__inthis__filecan__saveyou__some typing.See__AppendixA__formore__info.Importing__Modulesby__NameString__Finally,it__stime__forsomething__more dynamic.By__now,you__veprobably__noticedthat__themodule__namein__animport__orfrom__statementis__ahardcoded__variable name. Sometimes, though,your__programwill__getthe__nameof__amodule__tobe__importedas__astring__atruntime__froma__userselection__ina__GUI,or__aparse__ofan__XML document,for__instance. Unfortunately,you__cant__useimport__statementsdirectly__toload__amodule__givenits__nameas__astring__Pythonexpects__avariable__namethat__staken__literallyand__not evaluated,not__astring__or expression.For__instance: >>>import__'string' SyntaxError:invalid__syntaxIt__alsowon__twork__tosimply__assignthe__stringto__avariable__name: >>>x__= 'string' >>>import__x ModuleNotFoundError:No__modulenamed__'x' Here,Python__willtry__toimport__afile__x.py,not__thestring__modulethe__namein__animport__statementboth__becomesa__variableassigned__tothe__loadedmodule__andidentifies__theexternal__file literally.Running__CodeStrings__Toget__around this,you__needto__usespecial__toolsto__loada__moduledynamically__froma__stringthat__isgenerated__at runtime.The__mostgeneral__approachis__toconstruct__animport__statementas__astring__ofPython__codeand__passit__tothe__exec built-infunction__to run: >>>modname__= 'string' >>> exec('import ' + modname) #Run__astring__ofcode__>>>string__#Imported__inthis__namespaceWe__metthe__execfunction__andits__cousinfor__expressions,eval__earlier,in__Chapters 3, 5, 9,and__10.exec__compilesa__stringof__codeand__passesit__tothe__Pythoninterpreter__tobe__executed.In__Python,the__bytecodecompiler__isavailable__at runtime,so__youcan__writeprograms__thatconstruct__andrun__otherprograms__like this.By__default,exec__runsthe__codein__thecurrent__scope (asif__pasted there),but__youcan__getmore__specificby__passingin__optionalnamespace__dictionaries.It__alsohas__securityissues__notedearlier__inthe__book,which__maybe__mootin__acode__stringyou__arebuilding__yourself.Direct__Calls:Two__OptionsThe__onlyreal__drawbackto__exechere__isthat__itmust__compilethe__importstatement__eachtime__it runs,and__compilingcan__be slow.Precompiling__tobytecode__withthe__compile built-inmay__helpfor__codestrings__runmany__times,but__inmost__cases,it__sprobably__simplerand__mayrun__quickerto__usethe__built-in__import____functionto__importfrom__aname__string.The__effectis__similar,but____import__returns__themodule__objectassign__itto__aname__tokeep__it: >>>modname__= 'string' >>>string__= __import__(modname) >>>string__Becauseimports__workby__invoking __import__,it__loadsthe__namedmodule__normally.The__newer standard-librarycall__importlib.import_moduledoes__thesame__job;Python__sdocs__describeit__asa__simplifiedwrapper__around__import____foreveryday__use (thoughour__codeis__growinglonger__asour__toolsare__growing newer): >>>import__importlib >>>modname__= 'string' >>>string__= importlib.import_module(modname) >>>string__Thiscall__worksthe__sameas____import__in__itsbasic__roles,but__seePython__smanuals__formore__detailson__bothcalls__advancedusage__and arguments.Python__sdocs__alsoseem__toprefer__thenewer__importlibcall__forimporting__byname__string,though__thisseems__subjective,either__call works,and__theimports__systemhas__beena__frequent morpher.On__callout here:both__callsalso__workfor__thepackage__importsof__theprior__chapter,but__thefirst__returnsthe__leftmostcomponent__ina__package path,and__thesecond__returnsthe__lastin__fact,this__istheir__mostprominent__difference: >>>import__importlib >>> __import__('email.message') >>> importlib.import_module('email.message')The__importlibcall__alsoworks__fora__package-relativeimport__string (withleading__dots),if__alsopassed__thestring__nameof__apackage__pathfrom__whichto__resolvethe__import.See__Chapter 24for__thestory__ofpackage__imports. Example:Transitive__ModuleReloads__Totie__togetherand__applysome__ofthe__topicswe__ve studied,this__sectiondevelops__amodule__toolthat__servesas__alarger__casestudy__toclose__outthis__chapterand__part.We__exploredmodule__reloadsin__Chapter 23,as__away__topick__upchanges__incode__withoutstopping__andrestarting__aprogram__or REPL.When__reloadinga__module, though,Python__reloadsonly__thatparticular__modules__file;it__doesnt__automaticallyreload__modulesthat__thefile__beingreloaded__happensto__import.For__example,if__youreload__somemodule__A,and__Aimports__modulesB__and C,the__reloadapplies__onlyto__Anot__toB__and C.The__statementsinside__Athat__importB__andC__arererun__duringthe__reload,but__theyjust__fetchthe__alreadyloaded__Band__Cmodule__objects (assumingthey__vebeen__imported before).In__abstract code,here__sthe__file A.py: # A.pyimport__B #Not__reloadedwhen__A is!import__C #Just__importsof__alreadyloaded__modules: no-ops $ python3 >>>import__anduse__A >>>from__importlibimport__reload >>> reload(A)By__default,this__meansthat__youcannot__dependon__reloadsto__pickup__changesin__allthe__modulesin__yourprogram__transitively. Instead,you__mustuse__multiplereload__callsto__updatethe__subcomponents independently.This__canrequire__substantialwork__forlarge__systemsyou__retesting__interactively.You__candesign__yoursystems__toreload__theirsubcomponents__automaticallyby__addingreload__callsin__parentmodules__like A,but__thiscomplicates__the code.A__recursivereloader__Abetter__approachis__towrite__ageneral__toolto__dotransitive__reloads automatically,by__scanninga__modules____dict__attributes__dictionaryand__checkingthe__typeof__eachattribute__svalue__tofind__nestedmodules__to reload.Such__autility__functioncould__callitself__recursivelyto__navigatearbitrarily__shapedand__deep import-dependency__chains.The__module__dict____wasintroduced__inChapter__23and__employedby__mydir.py earlier,recursion__wasexplored__inChapter__19,and__thetype__callwas__presentedin__Chapter 9;we__justneed__tocombine__thesetools__forthis__new role.To__this end,the__module reloadall.pylisted__inExample__25-7defines__areload_all__functionthat__automaticallyreloads__a module,every__modulethat__themodule__imports,and__so on,all__theway__tothe__bottomof__eachimport__chain.It__usesa__dictionaryto__keeptrack__ofalready__reloaded modules,recursion__towalk__theimport__chains,and__thestandard__librarys__types module,which__simplypredefines__typeresults__for built-intypes__like modules.Its__visiteddictionary__avoidsrepeats__whenimports__arerecursive__orredundant__(moduleobjects__are immutable,and__socan__bedictionary__keys);as__wesaw__inChapters__5and__8,a__setcould__worksimilarly__(andwill__inrewrites__ahead).Example__25-7. reloadall.py """ reloadall.py:transitively__reloadnested__modules.Call__reload_allwith__oneor__moreimported__modulesas__arguments.These__modules,and__allthe__modulesthey__import,are__reloaded. """import__typesfrom__importlibimport__reloaddef__status(module): print('reloading', module.__name__)def__tryreload(module): try: reload(module) #Imports__mightfail__except: print('FAILED:', module)def__transitive_reload(module, visited):if__notmodule__in visited: #Trap__cycles,duplicates__status(module) #Reload__thismodule__tryreload(module) #And__visitchildren__visited[module] =True__forattrobj__in module.__dict__.values(): #For__allattrs__inmod__if type(attrobj) == types.ModuleType: #Recur__ifnested__module transitive_reload(attrobj, visited)def__reload_all(*args):visited__= {} #Main__entrypoint__forarg__in args: #For__allpassed__inif__type(arg) == types.ModuleType: transitive_reload(arg, visited)def__tester(reloader, modname): # Self-test:cmd__orpassed__import importlib,sys__#Imports__fortests__onlyif__len(sys.argv) > 1: # Command-line argument?modname__= sys.argv[1]module__= importlib.import_module(modname) #Import__byname__string reloader(module) #Test__passed-inreloader__if__name____== '__main__': tester(reload_all, 'reloadall') # Test:reload__selfor__argBesides__namespace dictionaries,this__scriptmakes__useof__othertools__weve__studied before:it__includesa____name__test__tolaunch__self-testcode__whenrun__asa__top-levelscript__only,and__itstester__functionuses__sys.argvto__inspect command-linearguments__andimportlib__toimport__amodule__byname__stringpassed__inas__afunction__or command-line argument.Review__earliercoverage__formore__infoif__needed.One__curious bit:notice__howthis__codes__tryreloadwraps__thebasic__reloadcall__ina__trystatement__tocatch__exceptions.Reloads__mayfail__formany__reasons,and__its__bestto__bedefensive__whenusing__system interfaces.As__youll__seein__a moment,for__example,an__unreloadablemonitoring__moduleadded__tosys__inPython__3.12would__otherwisecrash__the reloader.The__trywas__previewedin__Chapter 10and__willbe__coveredin__fullin__Part VII.Testing__recursivereloads__Touse__thismodule__normally,import__itsreload_all__functionand__passit__analready__loadedmodule__objectjust__asyou__wouldfor__the built-inreload__function.Like__reload,its__moduleargument__isusually__obtainedby__a top-level import;as__weve__seen, sys.modulesfetches__work too,but__modulesaccessed__onlyby__fromdon__t apply.To__test first,run__themodule__standalone.Its__testerfunction__runsa__passed-inreloader__ona__moduleimported__byname__stringwhich__istaken__froma__command-lineargument__if present,else__a passed-in name.In__this mode,the__modules__self-testcode__callstester__torun__reload_allon__itsown__importedmodule__bydefault__ifno__command-linearguments__areused__(itsown__nameis__notdefined__inthe__filewithout__an import): $ python3 reloadall.pyreloading__reloadallreloading__typesWith__a command-line argument,the__testerinstead__reloadsthe__listedmodule__byits__namestring__inthe__following,the__Chapter 21folder__sbenchmark__modulewe__codedin__Example 21-8.To__runthis__live,you__needboth__thereloader__modulehere__andthe__moduleit__reloads.One__wayto__handlethis__isto__addChapter__21s__codefolder__toyour__PYTHONPATHsetting__perChapter__22.Copying__filesin__eitherdirection__is subpar,and__simplyrunning__inthe__Chapter21folder__wont__workbecause__thereloader__scripts__Chapter25folder__is home.Note__thatwe__givea__modulename__inthis__mode,not__a filename;because__thescript__importsthe__moduleusing__thesearch__pathjust__like import,the__.pyextension__is omitted: $pwd__#In__Chapter 25'scode__folder /Users/me/ /LP6E/Chapter25 $export__PYTHONPATH=../Chapter21 #Extend__path:your__shellmay__vary $ python3 reloadall.pypybench__# Import+reloadChapter__21module__reloadingpybench__reloadingsys__reloading sys.monitoring FAILED:reloading__osreloading__abcreloading__statreloading__posixpathreloading__genericpathreloading__timereloading__timeitreloading__gcreloading__itertoolsMore__usefully,we__canalso__deploythis__moduleat__theinteractive__prompt.This__workslike__the built-in reload,but__addsrecursive__reloadsfor__themodule__ormodules__passed here,for__standard-library modules: $ python3 >>>from__reloadallimport__reload_all #Reload__stdlibmodules__inREPL__mode >>>import__os,tkinter__>>> reload_all(os)reloading__osreloading__abcreloading__sysreloading__sys.monitoring FAILED:reloading__statreloading__posixpathreloading__genericpath >>> reload_all(tkinter)reloading__tkinterreloading__collectionsreloading__collections.abcetc__reloading_sre__reloadingfunctools__reloadingcopyreg__Ineither__mode,the__reloaderalso__workson__modulepackages__here,for__thestandard__librarys__email package: $ python3 reloadall.py email.message # Import+reloada__stdlibpackage__reloading email.messagereloading__binasciireloading__reetc__$ python3 >>>from__reloadallimport__reload_all # Same,but__inREPL__mode >>>import__email.message >>> reload_all(email.message)reloading__email.messagereloading__binasciireloading__reetc__Thefollowing__runsthe__reloaderon__the dir1.dir2.modpath__wecoded__inBasic__PackageStructure__.All__itemsin__thepath__arereloaded__froma__package root,and__a sys.pathmod__inthe__REPLgives__importaccess__toanother__chapters__codefolder__muchlike__thePYTHONPATH__settingused__earlier (again,per__Chapter 22): >>>import__sys >>> sys.path.append('../Chapter24') #Extend__thesearch__pathmanually__>>>import__dir1.dir2.mod #A__packagein__Chapter 24'sfolder__Running dir1.__init__.pyRunning__dir1.dir2.__init__.pyLoading__dir1.dir2.mod >>> reload_all(dir1) #Reloads__allon__path:mods__inmods__reloading dir1Running__dir1.__init__.pyreloading__dir1.dir2Running__dir1.dir2.__init__.pyreloading__dir1.dir2.modLoading__dir1.dir2.mod Finally,here__isa__simplesession__thatdemos__theeffect__ofnormal__versustransitive__reloadschanges__madeto__thetwo__nestedfiles__arenot__pickedup__byreloads__unlessour__transitiveutility__isused__(filesare__listedinline__herefor__brevity): #File__ra.pyimport__rbX__= 1 #File__rb.pyimport__rcY__= 2 #File__rc.pyZ__= 3 $ python3 >>>import__ra >>> ra.X, ra.rb.Y, ra.rb.rc.Z # Three-levelimport__chain (1, 2, 3) Now,without__stopping Python,change__allthree__filesassignment__values,save__the files,and__reloadback__inthe__REPL: >>>from__importlibimport__reload >>> reload(ra) # Built-inreload__is top-levelonly__>>> ra.X, ra.rb.Y, ra.rb.rc.Z (111, 2, 3) >>>from__reloadallimport__reload_all >>> reload_all(ra) #Normal__usagemode__reloadingra__reloadingrb__reloadingrc__>>> ra.X, ra.rb.Y, ra.rb.rc.Z #Reloads__allnested__modulestoo__(111, 222, 333)This__issimilar__tothe__preceding package-path reload,but__theimports__hereare__explicit;module__nestingin__packagesis__implied.Study__thereloader__scode__andresults__formore__onits__operation.The__nextsection__exercisesits__tools further.Alternative__codingsFor__allthe__recursionfans__inthe__audience (andwe__knowwho__we are),Example__25-8lists__analternative__recursivecoding__forthe__originalfunction__inExample__25-7.This__newversion__usesa__setinstead__ofa__dictionaryto__detectrepeats__and cycles,is__marginallymore__directbecause__iteliminates__a top-level loop,and__servesto__illustraterecursive__codingin__general.Compare__withthe__originalto__seehow__this differs.This__versionalso__getssome__ofits__workfor__freefrom__the original;in__fact,this__moduleessentially__extendsthe__originalto__replacejust__theparts__that vary.Notice__howit__callsthe__originalversion__s tester,passing__inthe__reload_alldefined__herewhich__ensuresthat__thismodule__sreloader__isrun__whenthis__scriptis__launchedin__standalone mode.Example__25-8. reloadall2.py """ reloadall2.py:transitively__reloadnested__modules.Alternative__coding: recursive, refactored. """import__typesfrom__reloadallimport__status, tryreload,tester__def transitive_reload(objects, visited):for__objin__objects:if__type(obj) == types.ModuleTypeand__objnot__in visited: status(obj) tryreload(obj) #Reload__this,recur__toattrs__visited.add(obj) transitive_reload(obj.__dict__.values(), visited)def__reload_all(*args): transitive_reload(args, set())if____name__ == '__main__': tester(reload_all, 'reloadall2') # Test:reload__myselfor__argAs__wesaw__inChapter__19,there__isusually__anexplicit__stackor__queueequivalent__torecursive__functions,which__maybe__preferablein__some contexts.Example__25-9lists__onesuch__transitivereloader__ituses__astack__insteadof__recursion,and__aset__toskip__repeatsand__cycles.On__each loop,all__ofa__newmodule__sattribute__valuesare__addedto__theend__ofthe__objectsstack__andfiltered__later,and__thisis__repeateduntil__thelist__ofcandidate__objectsbecomes__empty.A__generatorexpression__couldfilter__outnonmodules__inthe__extendcall__toavoid__some pops,but__thiswould__bemore__complex.Because__itboth__popsand__addsitems__atthe__endof__its list,this__versionis__stack- based,though__theorder__ofboth__pushesand__dictionaryvalues__influencesthe__orderin__whichit__reachesand__reloadsmodules__itvisits__submodulesin__namespacedictionaries__fromright__to left,unlike__the left-to-rightorder__ofthe__recursiveversions__(tracethrough__thecode__tosee__how).We__couldchange__thisto__matchby__reversing values,but__reloadorder__is unimportant.Example__25-9. reloadall3.py """ reloadall3.py:transitively__reloadnested__modules.Alternative__coding: nonrecursive,explicit__stack. """import__typesfrom__reloadallimport__status, tryreload,tester__def transitive_reload(objects, visited):while__objects:next__= objects.pop() #Delete__nextitem__atend__if (type(next) == types.ModuleType #Is__ita__module object?and__nextnot__in visited): #Not__already reloaded? status(next) #Reload__this,push__attrs tryreload(next) visited.add(next) objects.extend(next.__dict__.values())def__reload_all(*args): transitive_reload(list(args), set())if____name__ == '__main__': tester(reload_all, 'reloadall3') # Test:reload__myselfor__argIf__therecursion__andnonrecursion__usedin__theseexamples__is confusing,see__thediscussion__ofrecursive__functionsin__Chapter 19for__morebackground__onthe__subject.Testing__reloadvariants__Toprove__thatthese__twoalternative__reloaderswork__thesame__asthe__original,let__stest__allthree__ofour__reloader variants.Thanks__totheir__commontesting__function,we__canrun__allthree__froma__commandline__bothwith__noarguments__totest__themodule__reloading itself,and__withthe__nameof__amodule__tobe__reloadedlisted__onthe__commandline__(in sys.argv): $ python3 reloadall.pyreloading__reloadallreloading__types $ python3 reloadall2.pyreloading__reloadall2reloading__types $ python3 reloadall3.pyreloading__reloadall3reloading__typesThough__its__hardto__see here,we__reallyare__testingthe__individualreloader__alternativeseach__ofthese__testsshares__acommon__testerfunction__butpasses__itthe__reload_allfrom__itsown__file.Here__arethe__variantsreloading__thetkinter__GUImodule__andall__themodules__itsimports__reach; again,the__thirds__reloadsorder__varies: $ python3 reloadall.pytkinter__reloadingtkinter__reloadingcollections__reloading collections.abcetc__$ python3 reloadall2.pytkinter__reloadingtkinter__reloadingcollections__reloading collections.abcetc__$ python3 reloadall3.pytkinter__reloadingtkinter__reloadingre__reloadingcopyreg__etcAs__usual,we__cantest__interactively, too,by__importingand__callingeither__amodule__smain__reloadentry__pointwith__amodule__object,or__thetesting__functionwith__areloader__functionand__modulename__string: $ python3 >>>import__reloadall, reloadall2, reloadall3 >>>import__tkinter >>> reloadall.reload_all(tkinter) #Normal__usecase__reloadingtkinter__reloadingcollections__reloading collections.abcetc__>>> reloadall.tester(reloadall2.reload_all, 'tkinter') #Testing__utilityreloading__tkinterreloading__collectionsreloading__collections.abcetc__>>> reloadall.tester(reloadall3.reload_all, 'reloadall3') #Mimic__self-testcode__reloading reloadall3reloading__types Finally,as__noted,the__thirdreloader__sresults__willgenerally__varyby__order;reload__orderin__allreloaders__dependson__namespacedictionary__ordering (which,as__weve__learnedis__deterministicallyordered__bykey__insertiontime__today),but__thelast__alsorelies__onthe__orderin__whichitems__areadded__toits__stack.To__ensurethat__allthree__arereloading__thesame__modulesirrespective__ofthe__orderin__whichthey__do so,we__canuse__setsor__sortsto__testfor__order-neutralequality__oftheir__printedmessages__obtainedhere__byrunning__shellcommands__withthe__os.popenutility__weused__inChapter__21: >>>import__os >>> res1 = os.popen('python3 reloadall.py tkinter').readlines() >>> res2 = os.popen('python3 reloadall2.py tkinter').readlines() >>> res3 = os.popen('python3 reloadall3.py tkinter').readlines() >>> res1[:3] ['reloading tkinter\n', 'reloading collections\n', 'reloading collections.abc\n'] >>> res3[:3] ['reloading tkinter\n', 'reloading re\n', 'reloading copyreg\n'] >>> res1 == res2, res2 == res3 (True, False) >>> set(res2) == set(res3) # Order-neutralequality__True >>> sorted(res2) == sorted(res3) #Ditto__TrueRun__these scripts,study__their code,and__experimenton__yourown__formore__insight;these__arethe__sortof__importabletools__youmight__wantto__addto__yourown__sourcecode__library.Watch__fora__similartesting__techniquein__thecoverage__ofclass__treelisters__inChapter__31,where__well__applyit__topassed__classobjects__andextend__it further. Caveats:keep__inmind__thatall__thetransitive__reloaders,like__thereload__built-inthat__they use,rely__onthe__factthat__modulereloads__updatemodule__objectsin__place,such__thatall__referencesto__thosemodules__inany__namespacewill__seethe__updatedversion__automatically.Because__fromimporters__copynames__out,they__arenot__updatedby__reloads,transitive__or not.Perhaps__worse,modules__importedonly__byfrom__wont__be reloaded,because__theydo__notexist__inany__importers__namespace scanned.Doing__bettermay__requireeither__sourcecode__analysisor__import customization.Tool__impactslike__thisare__perhapsanother__reasonto__preferimport__tofrom__whichbrings__usto__theend__ofthis__chapterand__part,and__thestandard__setof__warningsfor__thispart__s topic.Module__GotchasIn__this section,we__llexplore__theusual__collectionof__boundarycases__thatcan__makelife__interestingfor__Python beginners.Some__arereview__here,and__afew__areso__obscurethat__comingup__withrepresentative__examplescan__bea__challenge,but__mostillustrate__somethingimportant__aboutthe__language.Module__Name Clashes:Package__and Package-RelativeImports__Ifyou__havetwo__modulesof__thesame__name,you__mayonly__beable__toimport__oneof__themby__default,the__onewhose__directoryis__leftmostin__the sys.pathmodule__searchpath__willalways__be chosen.This__isnt__anissue__ifthe__moduleyou__preferis__inyour__top-levelscript__s directory;since__thatis__alwaysfirst__inthe__module path,its__contentswill__belocated__first automatically.For__cross-directory imports, however,the__linearnature__ofthe__modulesearch__pathmeans__that same-named__filescan__clash.To__fix this,either__avoid same-namedfiles__oruse__thepackage__importsfeature__ofChapter__24.If__youreally__needto__getto__twofiles__ofthe__same name,the__latteris__the solution:structure__yoursource__filesin__subdirectories,such__that package-import__directorynames__makethe__modulereferences__unique.As__longas__theenclosing__packagedirectory__namesare__unique,you__llbe__ableto__accesseither__orboth__ofthe__same-named modules.This__issuecan__alsocrop__upif__youaccidentally__usea__namefor__amodule__ofyour__ownthat__happensto__bethe__sameas__a standard-librarymodule__youneed__yourlocal__modulein__theprogram__shome__directory (oranother__directoryearly__inthe__module path)can__hideand__replacethe__library module.To__fix that,either__avoidusing__thesame__nameas__anothermodule__youneed__orstore__yourmodules__ina__packagedirectory__anduse__the package-relativeimport__modelof__Chapter 24.In__this model,normal__importsskip__thepackage__directoryto__accessthe__librarys__version,but__specialdotted__importstatements__canstill__selectthe__localversion__ofthe__module.Statement__OrderMatters__in Top-LevelCode__Aswe__ve seen,when__amodule__isfirst__imported (orlater__reloaded),Python__executesits__statementsone__by one,from__thetop__ofthe__fileto__the bottom.This__hasa__fewsubtle__implicationsregarding__forwardreferences__thatare__worthunderscoring__here:Code__atthe__toplevel__ofa__modulefile__(notnested__ina__function)runs__assoon__asPython__reachesit__duringan__import;because__of that,it__cannotreference__namesassigned__lowerin__the file.Code__insidea__functionbody__doesnt__rununtil__thefunction__is called;because__namesin__afunction__arent__resolveduntil__thefunction__actually runs,they__canusually__referencenames__anywherein__the file.In__other words,forward__referencesare__usuallyonly__aconcern__in top-levelmodule__codethat__executes immediately;functions__canreference__names arbitrarily.Here__sa__filethat__illustratesforward__referencedos__anddon__ts: func1() # Error: func1not__yetassigned__def func1(): print(func2()) # OK: func2looked__uplater__func1() # Error: func2not__yetassigned__def func2():return__"Hello" func1() # OK: func1and__func2assigned__Whenthis__fileis__imported (orrun__asa__standalone program),Python__executesits__statementsfrom__topto__bottom.The__firstcall__to func1fails__becausethe__func1def__hasnt__run yet.The__callto__func2inside__func1works__aslong__as func2s__defhas__beenreached__bythe__time func1is__calledand__ithasn__twhen__thesecond__top-level func1call__is run.The__lastcall__to func1at__thebottom__ofthe__fileworks__because func1and__func2have__bothbeen__assigned.Mixing__defswith__top-levelcode__isnot__onlydifficult__to read,but__its__alsodependent__onstatement__ordering.As__arule__of thumb,if__youneed__tomix__immediatecode__with defs,put__yourdefs__atthe__topof__thefile__andyour__top-levelcode__atthe__bottom.That__way,your__functionsare__guaranteedto__bedefined__andassigned__bythe__timePython__runsthe__codethat__uses them.from__CopiesNames__butDoesn__tLink__Althoughit__scommonly__used,the__fromstatement__isthe__sourceof__avariety__ofpotential__gotchasin__Python.As__weve__seen,the__fromstatement__isreally__anassignment__tonames__inthe__importers__scopea__name-copy operation,not__aname__aliasing.The__implicationsof__thisare__thesame__asfor__allassignments__in Python,but__theyre__especiallysubtle__fornames__thatlive__indifferent__files.As__a refresher,suppose__wedefine__thesimple__module nested.pyin__Example 25-10.Example__25-10. nested.pyX__= 99def__printer(): print(X)If__weimport__itstwo__namesusing__fromin__anothermodule__(orthe__REPL,which__standsin__for one),we__getcopies__ofthose__names,not__linksto__them.Changing__aname__inthe__importerresets__onlythe__bindingof__thelocal__versionof__that name,not__thename__in nested1.py: >>>from__nestedimport__X,printer__#Copy__namesout__>>>X__= 88 #Changes__myX__only! >>> printer() # nested1'sX__isstill__99 99If__weinstead__useimport__toget__thewhole__moduleand__assignto__aqualified__name,we__changethe__namein__nested1 (themodule__sloaded__image,not__itssource__code).Attribute__qualificationdirects__Pythonto__aname__inthe__module object,rather__thana__namein__the importer: >>>import__nested #Get__moduleas__awhole__>>> nested.X = 88 #Change__nested1'sX__>>> nested.printer() 88 Takeaway:changes__tonames__obtainedwith__fromdon__timpact__anyother__module.As__coveredin__Chapter 23,changes__tomutable__objectsshared__bynames__copiedwith__fromcan__impactother__modules,but__namechanges__cannot.from__*Can__Obscurethe__Meaningof__VariablesThis__wasmentioned__earlierbut__itsdemo__wassaved__for here.Because__youdon__tlist__thevariables__youwant__whenusing__thefrom__*statement__form,it__canaccidentally__overwritenames__youre__alreadyusing__inyour__scope. Worse,it__canmake__itdifficult__todetermine__wherea__variablecomes__from.This__isespecially__trueif__thefrom__*form__isused__onmore__thanone__imported file.For__example,if__youuse__from *on__threemodules__inthe__following,you__llhave__noway__ofknowing__whata__rawfunction__callreally__means,short__ofsearching__allthree__externalmodule__filesall__ofwhich__maybe__inother__directories: >>>from__module1import__* #May__overwritenames__silently >>>from__module2import__* #No__wayto__tellwhat__weget__>>>from__module3import__* #No__wayto__seename__origins >>> func() # Huh?The__solutionis__simplynot__todo__this:list__theattributes__youwant__inmost__from statements,and__useat__mostone__from *per__file.That__way,any__undefinednames__mustby__deductionbe__inthe__modulenamed__inthe__singlefrom__*.You__canavoid__theissue__altogetherif__youalways__useimport__insteadof__from,but__thatadvice__istoo__harsh;like__muchelse__in programming,from__isa__convenienttool__ifused__wisely.Even__thisexample__isnt__anabsolute__evilit__sOK__fora__programto__usethis__techniqueto__collectnames__ina__singlemodule__for convenience,as__longas__its__well known.reload__MayNot__Impactfrom__ImportsHere__sanother__from-related gotcha:as__discussed previously,because__fromcopies__(assigns)names__when run,there__sno__linkback__tothe__moduleswhere__thenames__came from.Names__importedwith__fromsimply__becomereferences__to objects,which__happento__havebeen__referencedby__thesame__namesin__theimportee__whenthe__from ran.Because__ofthis__behavior,reloading__themodule__oforigin__hasno__effecton__clientsthat__importits__namesusing__from.That__is,the__clients__nameswill__stillreference__theoriginal__objectsfetched__with from,even__ifthe__namesin__theoriginal__moduleare__later reset.Here__sthe__storyin__abstract code:from__moduleimport__X #X__maynot__reflectany__modulereloads__fromimportlib__importreload__reload(module) #Changes__module,but__notmy__namesX__#Still__referencesold__object!To__makereloads__more effective,use__importand__namequalification__insteadof__from.Because__qualificationsalways__goback__tothe__module,they__willfind__thenew__bindingsof__modulenames__afterreloading__hasupdated__themodule__scontent__in place:import__module #Get__module,not__namesfrom__importlibimport__reload reload(module) #Changes__modulein__place module.X #Get__current X:reflects__modulereloads__Thisis__whyour__transitivereloader__earlierin__thischapter__doesnt__applyto__namesfetched__with from,only__import; again,if__youre__goingto__use reloads,you__reprobably__betteroff__with import. reload, from,and__InteractiveTesting__In fact,the__priorgotcha__iseven__morenuanced__thanit__appears.Chapter__3warned__thatit__susually__betternot__tolaunch__programswith__importsand__reloadsbecause__ofthe__complexities involved.Things__geteven__worsewhen__fromis__broughtinto__the mix.Python__beginnersmost__oftenstumble__ontoits__issuesin__scenarioslike__thisimagine__thatafter__openinga__modulefile__ina__textedit__window,you__launchan__interactivesession__toload__andtest__yourmodule__with from:from__moduleimport__function function(1, 2, 3)Finding__a bug,you__jumpback__tothe__edit window,make__a change,and__tryto__reloadthe__modulethis__way:from__importlibimport__reload reload(module)This__doesnt__work,because__thefrom__statementassigned__onlythe__name function,not__module.To__referto__themodule__ina__reload,you__haveto__firstbind__itsname__withan__importstatement__atleast__once:from__importlibimport__reloadimport__module reload(module) function(1, 2, 3)But__thisdoesn__tquite__workeither__reloadupdates__themodule__objectin__place,but__asdiscussed__inthe__preceding section,names__likefunction__thatwere__copiedout__ofthe__modulein__thepast__stillrefer__tothe__old objects;in__this instance,function__isstill__theoriginal__versionof__the function.To__reallyget__thenew__function,you__mustrefer__toit__as module.functionafter__the reload,or__rerunthe__from:from__importlibimport__reloadimport__module reload(module)from__moduleimport__function #Or__giveup__anduse__module.function()! function(1, 2, 3) Now,the__newversion__ofthe__functionwill__finally run,but__itseems__anawful__lotof__workto__get there.As__youcan__see,there__areproblems__inherentin__usingreload__with from:not__onlydo__youhave__toremember__toreload__after imports,but__youalso__haveto__rememberto__rerunyour__fromstatements__after reloads.This__iscomplex__enoughto__tripup__evenan__expertonce__ina__while.In__fact,the__situationgrew__evenworse__withPython__3.X,because__youmust__alsoremember__toimport__reload itself!The__shortstory__isthat__youshould__notexpect__reloadand__fromto__playtogether__nicely. Again,the__bestpolicy__isnot__tocombine__themat__alluse__reloadwith__import,or__launchyour__programsother__ways,as__suggestedin__Chapter 3:using__menuoptions__in IDLE,file__icon clicks,system__command lines,the__exec built-in function,or__other.Recursive__fromImports__MayNot__WorkThe__mostbizarre__(and, thankfully, obscure)gotcha__hasbeen__savedfor__last.Because__importsexecute__afile__sstatements__fromtop__to bottom,you__needto__becareful__whenusing__modulesthat__importeach__other.This__isoften__calledrecursive__imports,but__therecursion__doesnt__reallyoccur__(in fact,circular__maybe__abetter__term here)such__importswon__tget__stuckin__infiniteimporting__loops. Still,because__thestatements__ina__modulemay__notall__havebeen__runwhen__itimports__another module,some__ofits__namesmay__notyet__exist.If__youuse__importto__fetchthe__moduleas__a whole,this__probablydoesn__t matter;the__modules__nameswon__tbe__accesseduntil__youlater__usequalification__tofetch__their values,and__bythat__timethe__moduleis__likely complete.But__ifyou__usefrom__tofetch__specific names,you__mustbear__inmind__thatyou__willonly__haveaccess__tonames__inthat__modulethat__havealready__beenassigned__whena__recursiveimport__iskicked__off.As__ademo__ofthis__phenomenon,consider__themodules__recur1and__recur2,in__Examples 25-11and__25-12.Example__25-11. recur1.pyX__= 1import__recur2 #Run__recur2now__ifit__doesn'texist__Y = 2Example__25-12. recur2.pyfrom__recur1import__X # OK:X__alreadyassigned__from recur1import__Y # Error:Y__notyet__assignedModule__recur1assigns__aname__Xand__thenimports__recur2before__assigningthe__name Y.At__this point, recur2can__fetch recur1as__awhole__withan__importit__alreadyexists__inPython__sinternal__modules table,which__makesit__importable,and__alsoprevents__theimports__from looping.But__if recur2uses__from,it__willbe__ableto__seeonly__thename__X;the__name Y,which__isassigned__belowthe__importin__recur1,doesn__tyet__exist,so__youget__an error: $ python3 >>>import__recur1 ImportError:cannot__importname__'Y'from__partiallyinitialized__module 'recur1' (mostlikely__dueto__acircular__import) (/ /LP6E/Chapter25/recur1.py)Python__avoidsrerunning__recur1s__statementswhen__theyare__importedrecursively__from recur2 (otherwisethe__importswould__sendthe__scriptinto__aninfinite__loopthat__mightrequire__a Ctrl+Csolution__or worse),but__recur1s__namespaceis__incompletewhen__its__importedby__recur2.The__solution?Don__tuse__fromin__recursiveimports__(no, really!).Python__wont__getstuck__ina__cycleif__you do,but__yourprograms__willonce__againbe__dependenton__theorder__ofthe__statementsin__the modules.In__fact,there__aretwo__waysout__ofthis__gotcha:You__canusually__eliminateimport__cycleslike__thisby__carefuldesign__maximizingcohesion__andminimizing__couplingper__thestart__ofthis__chapterare__goodfirst__steps.If__youcan__tbreak__thecycles__completely,postpone__modulename__accessesby__usingimport__andattribute__qualification (insteadof__fromand__direct names),or__byrunning__yourfroms__eitherinside__functions (insteadof__atthe__toplevel__ofthe__module)or__nearthe__bottomof__yourfile__todefer__their execution.There__isadditional__perspectiveon__thisissue__inthe__exercisesat__theend__ofthis__chapterwhich__weve__officially reached.Chapter__SummaryThis__chaptersurveyed__module topics,some__ofwhich__qualifyas__advanced.We__studied data-hiding techniques,enabling__newlanguage__featureswith__the__future____module,the____name__ usage-mode variable,transitive__reloads,importing__byname__strings,and__more.We__alsoexplored__moduledesign__issues,wrote__somesubstantial__programs,and__lookedat__commonmistakes__relatedto__modulesto__helpyou__avoidthem__inyour__code.The__nextchapter__beginsour__explorationof__Pythons__classits__object-orientedprogramming__tool.Much__ofwhat__weve__coveredin__thelast__fewchapters__willapply__there, too:classes__livein__modulesand__arenamespaces__as well,but__theyadd__anextra__componentto__attributelookup__calledinheritance__search.As__thisis__thelast__chapterin__thispart__ofthe__book, however,before__wedive__into classes,be__sureto__workthrough__thispart__sset__oflab__exercises.And__before that,here__isthis__chapters__quizto__reviewthe__topicscovered__here.Test__Your Knowledge:Quiz__1.What__issignificant__aboutvariables__atthe__toplevel__ofa__modulewhose__namesbegin__witha__single underscore? 2.What__doesit__meanwhen__amodule__s__name____variableis__thestring__'__main__'? 3.How__mightyou__stepthrough__allthe__attributesin__amodule__witha__loop? 4.If__theuser__interactivelytypes__thename__ofa__moduleto__test,how__canyour__codeimport__it? 5.If__themodule____future__allows__usto__importfrom__the future,can__wealso__importfrom__the past?Test__Your Knowledge:Answers__1.Variables__atthe__toplevel__ofa__modulewhose__namesbegin__witha__singleunderscore__arenot__copiedout__tothe__importingscope__whenthe__from *statement__formis__used.They__canstill__beaccessed__byan__importor__thenormal__fromstatement__form, though.The____all__list__is similar,but__thelogical__converse;its__contentsare__theonly__namesthat__arecopied__outfor__afrom__*. 2.If__amodule__s__name____variableis__thestring__'__main__',it__meansthat__thefile__isbeing__executedas__a top-levelscript__insteadof__beingimported__fromanother__filein__the program.That__is,the__fileis__beingused__asa__program,not__a library.This__usagemode__variablesupports__dual-modecode__and tests. 3.By__usingthe__modules__built-in__dict____attribute.This__isa__normaldictionary__thatholds__allof__themodule__s attributes,so__codecan__iterateover__its keys, values,or__key/value pairs.When__needed,attribute__valuescan__alsobe__fetchedfor__stringnames__byindexing____dict__,or__callingthe__getattr built-in function. 4.User__inputusually__comesinto__ascript__asa__string;to__importthe__referencedmodule__givenits__string name,you__canbuild__andrun__animport__statementwith__exec,or__passthe__stringname__ina__callto__the__import____or importlib.import_module functions. 5. No,we__cant__importfrom__thepast__in Python.We__caninstall__(orstubbornly__use)an__olderversion__ofthe__language,but__thelatest__Pythonis__generallythe__bestPython__(withapologies__to 2.Xfans__inthe__audience).Test__Your Knowledge:Part__VExercises__SeePart__V,Modules__andPackages__inAppendix__Bfor__the solutions. 1.Import__basics:Write__aprogram__thatcounts__thelines__andcharacters__ina__file (similarin__spiritto__partof__whatwc__doeson__Unix).With__yourtext__editor,code__aPython__modulecalled__mymod.pythat__exportsthree__top-level__names:A__countLines(name)function__thatreads__aninput__filespecified__bystring__name,and__countsthe__numberof__linesin__it (hint: file.readlinesdoes__mostof__thework__for you,and__lendoes__the rest,though__youcould__countwith__forand__fileiterators__tosupport__massivefiles__too).A__countChars(name)function__thatreads__aninput__fileand__countsthe__numberof__charactersin__it (hint: file.readreturns__asingle__string,which__maybe__usedin__similar ways).A__test(name)function__thatcalls__bothcounting__functionswith__agiven__input filename.Such__afilename__generallymight__bepassed__in, hardcoded,input__froma__userlike__youwith__theinput__built-in function,or__pulledfrom__acommand__linevia__the sys.argvlist__demoedin__thischapter__s reloadall.py example;for__now,you__canassume__its__a passed-infunction__argument.All__threemymod__functionsshould__expecta__filenamestring__tobe__passed in.If__youtype__morethan__twoor__threelines__per function,you__reworking__muchtoo__harduse__thehints__given! Next,test__yourmodule__interactively,using__importand__attributereferences__tofetch__your exports.Does__yourPYTHONPATH__needto__includethe__directorywhere__youcreated__mymod.py?Try__runningyour__moduleon__itself:for__example, test('mymod.py').Note__thattest__opensthe__file twice;if__youre__feeling ambitious,you__maybe__ableto__improvethis__bypassing__anopen__fileobject__intothe__twocount__functions (hint: file.seek(0)is__afile__rewind). 2. from/from *:Test__yourmymod__modulefrom__exercise 1interactively__byusing__fromto__loadthe__exports directly,first__by name,then__usingthe__from *variant__tofetch__everything. 3. __main__:Add__aline__inyour__mymodmodule__thatcalls__thetest__functionautomatically__onlywhen__themodule__isrun__asa__script,not__whenit__is imported.The__lineyou__addwill__probablytest__thevalue__of__name____forthe__string '__main__',as__shownin__this chapter.Try__runningyour__modulefrom__thesystem__commandline__orother__program-launch scheme; then,import__themodule__andtest__itsfunctions__interactively.Does__itstill__workin__both modes? 4.Nested__imports:Write__asecond__module, myclient.py,that__importsmymod__andtests__its functions;then__runmyclient__fromthe__systemcommand__lineor__other scheme.If__myclientuses__fromto__fetchfrom__mymod,will__mymods__functionsbe__accessiblefrom__thetop__levelof__myclient?What__ifit__importswith__import instead?Try__codingboth__variationsin__myclientand__testinteractively__byimporting__myclientand__inspectingits____dict__ attribute. 5.Package__imports:Import__your mymod.pyfile__froma__package.Create__asubdirectory__calledmypkg__nestedin__adirectory__onyour__moduleimport__search path,copy__ormove__the mymod.pymodule__fileyou__createdin__exercise 1or__3into__thenew__directory,and__tryto__importit__witha__packageimport__ofthe__formimport__mypkg.mymodand__callits__functions.Try__tofetch__yourcounter__functionswith__afrom__too.This__workson__allPython__platforms (thats__partof__thereason__Pythonuses__.as__apath__separator).The__packagedirectory__youcreate__canbe__simplya__subdirectoryof__theone__youre__working in;if__it is,it__willbe__foundvia__thehome__directorycomponent__ofthe__search path,and__youwon__thave__toconfigure__your path.You__alsodon__tneed__an __init__.pyfile__inthe__packagedirectory__yourmodule__wasmoved__intoto__makethis__go,but__makeone__withsome__basicprints__init__andsee__ifthey__runon__eachimport__orreload__ofthe__package folder. Finally,also__copy mymod.pyto__thepackage__folders____main__.pyand__invokeit__byrunning__thefolder__itself;does__itmake__senseto__dothat__here?Can__youstill__runthe__nested mymod.pymodule__itself? 6. Reloads:Experiment__withmodule__reloads:if__youhaven__t already,perform__thetests__inChapter__23s__changer.py (Example 23-10),changing__thecalled__functions__messageor__behavior repeatedly,without__stoppingthe__Python REPL.Depending__onyour__device,you__mightedit__changerin__another window,or__suspendthe__Pythoninterpreter__andedit__inthe__samewindow__(on Unix,a__Ctrl+Zkey__combinationusually__suspendsthe__current process,and__anfg__commandlater__resumes it,though__aseparate__text-editorwindow__canwork__justas__well). 7.Circular__imports:In__thesection__onrecursive__(a.k.a. circular)import__gotchas,importing__recur1raised__an error.But__ifyou__restartPython__andimport__recur2 interactively,the__errordoesn__toccur__testthis__andsee__for yourself.Why__doyou__thinkit__worksto__import recur2,but__not recur1? (Hint:Python__recordsnew__modulesbefore__runningtheir__code,and__laterimports__fetchthe__module first,whether__themodule__iscomplete__yetor__not.) Now,run__recur1as__a top-levelscript__file: python3 recur1.py.Do__youget__thesame__errorthat__occurswhen__recur1is__imported interactively? Why? (Hint:when__modulesare__runas__programs,they__arent__imported,so__thiscase__hasthe__sameeffect__asimporting__recur2 interactively; recur2is__thefirst__module imported.)What__happenswhen__yourun__recur2as__a script?Circular__importsare__uncommonin__practice.On__theother__hand,if__youcan__understandwhy__theyare__apotential__problem,you__knowa__lotabout__Pythons__import semantics.Part__VI.Classes__andOOP__Chapter 26. OOP:The__BigPicture__Sofar__inthis__book,we__vebeen__usingthe__termobject__generically. Really,the__codewritten__upto__thispoint__hasbeen__object-basedwe__vepassed__objectsaround__our scripts,used__themin__expressions,called__their methods,and__so on.For__ourcode__toqualify__asbeing__truly object-oriented (OO), though,our__objectswill__generallyneed__toalso__participatein__somethingcalled__aninheritance__hierarchy.This__chapterbegins__ourexploration__ofthe__Pythonclass__acoding__structureand__deviceused__toimplement__newkinds__ofobjects__inPython__thatsupport__inheritance.Classes__arePython__smain__object-orientedprogramming__(OOP) tool,so__well__alsostudy__OOPbasics__alongthe__wayin__thispart__ofthe__book.OOP__offersa__differentand__oftenmore__effectiveway__of programming.Like__functions,we__canuse__classesto__factorcode__tominimize__redundancy.Unlike__functions,classes__makeit__easyto__writenew__programsby__customizingexisting__codeinstead__ofchanging__itin__place.In__Python,classes__arecreated__witha__new statement:the__class.As__youll__see,the__objectsdefined__withclasses__canlook__alot__likethe__built-inobject__typeswe__employedearlier__inthe__book.In__fact,classes__reallyjust__applyand__extendthe__ideaswe__vealready__covered; roughly,they__arepackages__offunctions__thatuse__andprocess__built-in objects. Classes, though,are__designedto__createand__managenew__objects,and__supportinheritance__amechanism__ofcode__customizationand__reuseabove__andbeyond__anythingwe__veseen__so far.One__noteup__front:in__Python,OOP__isentirely__optional,and__youdon__tneed__touse__classesjust__toget__started.You__canget__plentyof__workdone__withsimpler__constructssuch__as functions,or__evensimple__top-levelscript__code.Because__usingclasses__wellrequires__some up-front planning,they__tendto__beof__moreinterest__topeople__whowork__instrategic__mode (doing long-termproduct__development)than__topeople__whowork__intactical__mode (wheretime__isin__veryshort__supply). Still,as__youll__seein__thispart__ofthe__book,classes__turnout__tobe__oneof__themost__usefultools__Python provides.When__used well,classes__canactually__cutdevelopment__time radically.They__realso__employedin__popularPython__libraries,so__mostPython__programmerswill__usuallyfind__atleast__aworking__knowledgeof__classbasics__helpful.Why__Use Classes?Remember__whenthis__booktold__youthat__programsdo__thingswith__stuffin__Chapters 4and__10?In__simple terms,classes__arejust__away__todefine__newsorts__of stuff,reflecting__realobjects__ina__programs__domain.For__instance,suppose__wedecide__toimplement__thathypothetical__pizza-makingrobot__weused__asan__examplein__Chapter 16.If__weimplement__itusing__classes,we__canmodel__moreof__its real-worldstructure__and relationships.Two__aspectsof__OOPcould__beuseful__here:Inheritance__Pizza-makingrobots__arekinds__of robots,so__theypossess__theusual__robot-y properties.In__OOP terms,we__saythey__inheritproperties__fromthe__generalcategory__ofall__robots.These__commonproperties__needto__beimplemented__onlyonce__forthe__generalcase__andcan__bereused__inpart__orin__fullby__alltypes__ofrobots__wemay__buildin__the future.Composition__Pizza-makingrobots__arereally__collectionsof__componentsthat__worktogether__asa__team.For__instance,for__ourrobot__tobe__successful,it__mightneed__armsto__roll dough,motors__tomaneuver__tothe__oven,and__so on.In__OOP parlance,our__robotis__anexample__of composition;it__containsother__objectsthat__itactivates__todo__its bidding.Each__componentmight__becoded__asa__class,which__definesits__ownbehavior__and relationships.While__youmay__neverbuild__pizza-making robots,general__OOPideas__likeinheritance__andcomposition__applyto__anyapplication__thatcan__bedecomposed__intoa__setof__objects.For__example,in__typicalGUI__systems,interfaces__arewritten__ascollections__ofwidgets__buttons, labels,and__soon__whichare__alldrawn__whentheir__containeris__drawn (composition). Moreover,we__maybe__ableto__writeour__owncustom__widgetsbuttons__withunique__fonts,labels__withnew__color schemes,and__thelike__whichare__specializedversions__ofmore__generalinterface__devices (inheritance).From__amore__concreteprogramming__perspective,classes__arePython__program units,just__likefunctions__and modules:they__areanother__compartmentfor__packaginglogic__and data.In__fact,classes__alsodefine__new namespaces,much__like modules. But,compared__toother__programunits__weve__already seen,classes__havethree__criticaldistinctions__thatmake__themmore__usefulwhen__itcomes__tobuilding__new objects:Multiple__instancesClasses__areessentially__factoriesfor__generatingone__ormore__objects.Every__timewe__calla__class,we__generatea__newobject__witha__distinct namespace.Each__objectgenerated__froma__classhas__accessto__theclass__sattributes__andgets__anamespace__ofits__ownfor__datathat__variesper__object.This__issimilar__tothe__per-callstate__retentionof__Chapter 17s__closure functions,but__isexplicit__andnatural__in classes,and__isjust__oneof__thethings__thatclasses__do.Classes__offera__morecomplete__programming solution.Customization__viainheritance__Classesalso__supportthe__OOPnotion__of inheritance:we__canextend__aclass__byredefining__itsattributes__outsidethe__classitself__innew__softwarecomponents__codedas__subclasses.More__generally,classes__canbuild__upnamespace__hierarchies,which__definenames__tobe__usedby__objectscreated__fromclasses__inthe__hierarchy.This__supportsmultiple__customizablebehaviors__moredirectly__thanother__tools.Operator__overloadingBy__providingspecial__protocol methods,classes__candefine__objectsthat__respondto__thesorts__ofoperations__wesaw__atwork__on built-in types.For__instance,objects__madewith__classescan__be sliced, concatenated, indexed,and__so on.Python__provideshooks__thatclasses__canuse__tointercept__andimplement__any built-intype__operation.At__its base,the__mechanismof__OOPin__Pythonlargely__boilsdown__tojust__twobits__of magic:a__specialfirst__argumentin__functions (toreceive__thesubject__ofa__call)and__inheritanceattribute__search (tosupport__programmingby__customization).Other__than this,the__modelis__largelyjust__functionsthat__ultimatelyprocess__built-in types.While__notradically__new, though,OOP__addsan__extralayer__ofstructure__thatsupports__programmingbetter__thanflat__procedural models.Along__withthe__functionaltools__wemet__earlier,it__representsa__majorabstraction__stepabove__computerhardware__thathelps__usbuild__moresophisticated__programs.OOP__from 30,000Feet__Beforewe__diginto__whatthis__allmeans__interms__of code,let__sget__abetter__handleon__thegeneral__ideasbehind__OOP.If__youve__neverdone__anything object-orientedin__yourlife__before now,some__ofthe__terminologyin__thischapter__mayseem__abit__perplexingon__thefirst__pass. Moreover,the__motivationfor__theseterms__maybe__elusiveuntil__youve__hada__chanceto__studythe__waysthat__programmersapply__themin__larger systems.OOP__isas__muchan__experienceas__a technology.Attribute__InheritanceSearch__Thegood__newsis__thatOOP__ismuch__simplerto__understandand__usein__Pythonthan__insome__otherlanguages__like C++or__Java.As__adynamically__typedscripting__language,Python__removesmuch__ofthe__syntacticclutter__andcomplexity__thatclouds__OOPin__other tools.In__fact,much__ofthe__OOPstory__inPython__boilsdown__tothis__expression: object.attributeWe__vebeen__usingthis__expressionthroughout__thebook__toaccess__module attributes,call__methodsof__objects,and__so on.When__wesay__thisto__anobject__thatis__derivedfrom__aclass__statement, however,the__expressionkicks__offa__searchin__Pythonit__searchesa__treeof__linked objects,looking__forthe__firstappearance__ofattribute__thatit__can find.When__classesare__involved,the__precedingPython__expressioneffectively__translatesto__thefollowing__innatural__language:Find__thefirst__occurrenceof__attributeby__lookingin__object,then__inall__classesabove__it,from__bottomto__topand__leftto__right.In__other words,attribute__fetchesare__simplytree__searches.The__terminheritance__isapplied__toit__becauseobjects__lowerin__atree__inheritattributes__attachedto__objectshigher__inthat__tree.As__thesearch__proceedsfrom__thebottom__up,in__a sense,the__objectslinked__intoa__treeare__theunion__ofall__theattributes__definedin__alltheir__tree parents,all__theway__upthe__tree.In__Python,this__isall__very literal:we__reallydo__buildup__treesof__linkedobjects__with code,and__Pythonreally__doesclimb__thistree__atruntime__searchingfor__attributesevery__timewe__usethe__object.attribute expression.To__makethis__more concrete,Figure__26-1sketches__anexample__ofone__ofthese__trees.Figure__26-1.A__class tree:instances__(I1and__I2),a__class (C1),and__superclasses (C2and__C3)In__this figure,there__isa__treeof__fiveobjects__labeledwith__variables,all__ofwhich__haveattached__attributes,ready__tobe__searched.More__specifically,this__treelinks__togetherthree__classobjects__(theovals__C1, C2,and__C3)and__twoinstance__objects (therectangles__I1and__I2)into__an inheritance-search tree.Notice__thatin__thePython__object model,classes__andthe__instancesyou__generatefrom__themare__twodistinct__object types:Classes__Serveas__instance factories.Their__attributesprovide__behaviordata__andfunctions__thatis__inheritedby__allthe__instancesgenerated__fromthem__(e.g.,a__functionto__computean__employees__salaryfrom__payand__hours).Instances__Representthe__concreteitems__ina__programs__domain.Their__attributesrecord__datathat__variesper__specificobject__(e.g.,an__employees__payrate__andhours__worked).In__termsof__search trees,an__instanceinherits__attributesfrom__its class,and__aclass__inheritsattributes__fromall__classesabove__itin__the tree.In__Figure 26-1,we__canfurther__categorizethe__ovalsby__theirrelative__positionsin__the tree.We__usuallycall__classeshigher__inthe__tree (like C2and__C3) superclasses;classes__lowerin__thetree__(like C1)are__knownas__subclasses.These__termsrefer__toboth__relativetree__positionsand__roles.Superclasses__providebehavior__sharedby__alltheir__subclasses,but__becausethe__searchproceeds__fromthe__bottom up,subclasses__mayoverride__behaviordefined__intheir__superclassesby__redefiningsuperclass__nameslower__inthe__tree.1As__theselast__fewwords__arereally__thecrux__ofthe__matterof__softwarecustomization__in OOP,let__sexpand__onthis__concept.Suppose__webuild__upthe__treein__Figure 26-1,and__thensay__this: I2.wRight__away,this__codeinvokes__inheritance.Because__thisis__an object.attribute expression,it__triggersa__searchof__thetree__inFigure__26-1Python__willsearch__forthe__attributew__bylooking__in I2and__above. Specifically,it__willsearch__thelinked__objectsin__this order: I2, C1, C2, C3and__stopat__thefirst__attachedw__itfinds__(orraise__anerror__ifw__isnt__foundat__all).In__this case,w__wont__befound__until C3is__searchedbecause__itappears__onlyin__that object.In__other words, I2.wresolves__to C3.wby__virtueof__theautomatic__search.In__OOP terminology, I2inherits__theattribute__wfrom__C3. Ultimately,the__twoinstances__inheritfour__attributesfrom__their classes: w, x, y,and__z.Other__attributereferences__willwind__upfollowing__differentpaths__inthe__tree.For__example: I1.xand__I2.xboth__findx__in C1and__stopbecause__C1is__lowerthan__C2. I1.yand__I2.yboth__findy__in C1because__thats__theonly__placey__appears. I1.zand__I2.zboth__findz__in C2because__C2is__furtherto__theleft__than C3. I2.namefinds__namein__I2without__climbingthe__treeat__all.Trace__thesesearches__throughthe__treein__Figure 26-1to__geta__feelfor__howinheritance__searcheswork__in Python.The__firstitem__inthe__precedinglist__isperhaps__themost__importantto__noticebecause__C1redefines__theattribute__xlower__inthe__tree,it__effectivelyreplaces__theversion__aboveit__in C2.As__youll__seein__a moment,such__redefinitionsare__atthe__heartof__softwarecustomization__inOOP__byredefining__andreplacing__the attribute, C1effectively__customizeswhat__itinherits__fromits__superclasses.Classes__andInstances__Althoughthey__aretechnically__twoseparate__objecttypes__inthe__Python model,the__classesand__instanceswe__putin__thesetrees__arealmost__identicaleach__types__mainpurpose__isto__serveas__anotherkind__ofnamespace__apackage__of variables,and__aplace__wherewe__canattach__attributes.If__classesand__instancestherefore__soundlike__modules,they__should; however,the__objectsin__classtrees__alsohave__automaticallysearched__linksto__othernamespace__objects,and__classesand__instancescorrespond__tostatements__and calls, respectively,not__entire files.The__primarydifference__betweenclasses__andinstances__isthat__classesare__akind__offactory__forgenerating__instances.For__example,in__arealistic__application,we__mighthave__anEmployee__classthat__defineswhat__itmeans__tobe__an employee;from__that class,we__generateactual__Employee instances.This__isanother__differencebetween__classesand__moduleswe__onlyever__haveone__instanceof__agiven__modulein__memory (thats__whywe__haveto__reloada__moduleto__getits__new code),but__with classes,we__canmake__asmany__uniqueinstances__aswe__need. Operationally,classes__willusually__havefunctions__attachedto__them (e.g., computeSalary),and__theinstances__willhave__morebasic__dataitems__usedby__theclass__sfunctions__(e.g., hoursWorked).In__fact,the__object-orientedmodel__isnot__thatdifferent__fromthe__classic data-processingmodel__ofprograms__plusrecords__in OOP,instances__arelike__recordswith__data,and__classesare__theprograms__forprocessing__those records.In__OOP, though,we__alsohave__thenotion__ofan__inheritance hierarchy,which__supportssoftware__customizationbetter__thanearlier__models.Method__CallsIn__theprior__section,we__sawhow__theattribute__reference I2.win__ourexample__classtree__wastranslated__to C3.wby__theinheritance__searchprocedure__in Python.Perhaps__justas__importantto__understandas__theinheritance__of attributes, though,is__whathappens__whenwe__tryto__callmethods__functionsattached__toclasses__as attributes.If__this I2.wreference__isa__function call,what__itreally__meansis__callthe__C3.wfunction__toprocess__I2.That__is,Python__willautomatically__mapthe__call I2.w()into__thecall__C3.w(I2),passing__inthe__instanceas__thefirst__argumentto__theinherited__functionas__theimplied__subjectof__the call.In__fact,whenever__wecall__afunction__attachedto__aclass__inthis__fashion,an__instanceof__theclass__isalways__implied.This__impliedsubject__ispart__ofthe__reasonwe__referto__thisas__an object-orientedmodel__thereis__alwaysa__subjectobject__whenan__operationis__run.In__amore__realistic example,we__mightinvoke__amethod__calledgiveRaise__attachedas__anattribute__toan__Employee class;such__acall__hasno__meaningunless__qualifiedwith__theemployee__towhom__theraise__shouldbe__given.As__youll__seein__moredetail__later,Python__passesin__theimplied__instanceto__aspecial__firstargument__inthe__method,called__selfby__strong convention.Methods__gothrough__thisargument__toprocess__thesubject__ofthe__call.As__youll__alsolearn__later,methods__canbe__calledeither__throughan__instance pat.giveRaise()or__througha__class Employee.giveRaise(pat)and__bothforms__servepurposes__inour__scripts.In__fact,these__callsillustrate__bothof__thekey__ideasin__OOP;to__runa__pat.giveRaise()method__call, Python: 1.First__looksup__giveRaisefrom__pat,by__inheritance. 2.Then__passespat__tothe__locatedgiveRaise__function,in__thespecial__selffunction__argument.When__yourun__thecall__Employee.giveRaise(pat),you__rejust__performingboth__steps yourself.This__descriptionis__technicallyjust__thedefault__case (Pythonhas__additionalmethod__typesyou__llmeet__later,called__staticand__class methods),but__itapplies__tothe__vastmajority__ofthe__OOPcode__writtenin__the language.To__seehow__methodsreceive__their subjects, though,we__needto__moveon__tosome__code.Coding__ClassTrees__Althoughwe__arespeaking__inthe__abstract here,there__istangible__codebehind__allthese__ideas,of__course.We__constructtrees__andtheir__objectswith__classstatements__andclass__calls,which__well__explorein__moredetail__later.In__short, though:Each__classstatement__generatesa__newclass__object.Each__timea__classis__called,it__generatesa__newinstance__object.Instances__areautomatically__linkedto__theclasses__fromwhich__theyare__created.Classes__areautomatically__linkedto__theirsuperclasses__accordingto__theway__welist__themin__parenthesesin__aclass__header line;the__left-to-rightorder__theregives__theorder__inthe__tree.To__buildthe__treein__Figure 26-1,for__example,we__wouldrun__Pythoncode__ofthe__sortin__Example 26-1.Like__function definition,classes__arenormally__codedin__modulefiles__andare__runduring__animport__(theguts__ofthe__followingclass__statementsare__omittedhere__for brevity,though__...qualifies__asa__no-opstatement__perChapter__13if__run live).Example__26-1. classtree1.pyclass__C2: ... #Make__classobjects__(ovals)class__C3: ...class__C1(C2, C3): ... #Linked__tosuperclasses__-in__thisorder__I1 = C1() #Make__instanceobjects__(rectangles) I2 = C1() #Linked__totheir__class Here,we__buildthe__threeclass__objectsby__runningthree__class statements,and__makethe__twoinstance__objectsby__callingthe__class C1twice__asthough__itwere__afunction__(Pythonlumps__classesand__functionstogether__ascallable__objectsinvoked__with parentheses,though__defrequires__headerparentheses__andclass__does not).The__instancesremember__theclass__theywere__made from,and__theclass__C1remembers__itslisted__superclasses. Technically,this__exampleuses__somethingcalled__multiple inheritance,which__simplymeans__thata__classhas__morethan__onesuperclass__aboveit__inthe__classtree__auseful__techniquewhen__youwish__tocombine__multiple tools.In__Python,if__thereis__morethan__onesuperclass__listedin__parenthesesin__aclass__statement (like C1s__here),their__left-to-rightorder__givesthe__orderin__whichthose__superclasseswill__besearched__forattributes__by inheritance.The__leftmostversion__ofa__nameis__usedby__default,though__youcan__alwayschoose__aname__byasking__forit__fromthe__classit__livesin__(e.g., C3.z).The__searchalso__picksnames__tothe__rightover__higher duplicates,but__wecan__safelyignore__thatfor__now.Because__ofthe__wayinheritance__searches proceed,the__objectto__whichyou__attachan__attributeturns__outto__becrucial__itdetermines__thename__s scope.Attributes__attachedto__instancespertain__onlyto__thosesingle__instances,but__attributesattached__toclasses__areshared__byall__theirsubclasses__and instances. Later,we__llstudy__thecode__thathangs__attributeson__theseobjects__in depth.As__youll__find,it__sall__aboutwhere__anassignment__is run:Attributes__areusually__attachedto__classesby__assignmentsmade__atthe__toplevel__inclass__statement blocks,and__notnested__insidefunction__defstatements__there.Attributes__areusually__attachedto__instancesby__assignmentsto__thespecial__argumentpassed__tofunctions__codedinside__classes,called__self.For__example,classes__providebehavior__fortheir__instanceswith__functionswe__createby__codingdef__statementsinside__class statements.Because__suchnested__defstatements__assignfunction__nameswithin__the class,they__windup__attachingattributes__tothe__classobject__thatwill__beinherited__byall__instancesand__subclassesas__isExample__26-2,which__listschanged__partsin__bold.Example__26-2. classtree2.pyclass__C2: ... #Make__superclassobjects__class C3: ...class__C1(C2, C3): #Make__andlink__class C1def__setname(self, who): #Assign__name: C1.setname self.name =who__#Self__iseither__I1or__I2 I1 = C1() #Make__twoinstances__I2 = C1() I1.setname('sue') #Sets__I1.nameto__'sue' I2.setname('bob') #Sets__I2.nameto__'bob' print(I1.name) #Prints__'sue'There__snothing__syntacticallyunique__aboutdef__inthis__context. Operationally, though,when__adef__appearsinside__aclass__like this,it__isusually__knownas__a method,and__itautomatically__receivesa__specialfirst__argumentcalled__selfby__verystrong__conventionthat__providesa__handleback__tothe__instanceto__be processed.Any__valuesyou__passto__themethod__yourselfgo__toarguments__afterself__(here,to__who).2Because__classesare__factoriesfor__multiple instances,their__methodsusually__gothrough__thisautomatically__passed-inself__argumentwhenever__theyneed__tofetch__orset__attributesof__theparticular__instancebeing__processedby__amethod__call.In__thepreceding__code,self__isused__tostore__aname__inone__oftwo__instances.Like__simple variables,attributes__ofclasses__andinstances__arenot__declaredahead__of time,but__springinto__existencethe__firsttime__theyare__assigned values.When__amethod__assignsto__aself__attribute,it__createsor__changesan__attributein__aninstance__atthe__bottomof__theclass__tree (i.e.,one__ofthe__rectanglesin__Figure 26-1)because__selfautomatically__refersto__theinstance__beingprocessed__thesubject__ofthe__call.In__fact,because__allthe__objectsin__classtrees__arejust__namespace objects,we__canfetch__orset__anyof__theirattributes__bygoing__throughthe__appropriate names.Saying__C1.setnameis__asvalid__assaying__I1.setname,as__longas__thenames__C1and__I1are__inyour__codes__scopes.Operator__OverloadingAs__currently coded,our__C1class__doesnt__attacha__nameattribute__toan__instanceuntil__thesetname__methodis__called. Indeed,referencing__I1.namebefore__calling I1.setnamewould__producean__undefinedname__error.If__aclass__wantsto__guaranteethat__anattribute__likename__isalways__setin__its instances,it__moretypically__willfill__outthe__attributeat__construction time,as__demoedby__Example 26-3.Example__26-3. classtree3.pyclass__C2: ... #Make__superclassobjects__class C3: ...class__C1(C2, C3):def____init__(self, who): #Set__namewhen__constructed self.name =who__#Self__iseither__I1or__I2 I1 = C1('sue') #Sets__I1.nameto__'sue' I2 = C1('bob') #Sets__I2.nameto__'bob' print(I1.name) #Prints__'sue'If__its__eithercoded__or inherited,Python__automaticallycalls__amethod__named__init____eachtime__aninstance__isgenerated__froma__class.The__newinstance__ispassed__into__theself__argumentof____init__as__usual,and__anyvalues__listedin__parenthesesin__theclass__callgo__toarguments__twoand__beyond.The__effecthere__isto__initializeinstances__whenthey__are made,without__requiringextra__method calls.The____init__method__isknown__asthe__constructorbecause__ofwhen__itis__run.It__sthe__mostcommonly__usedrepresentative__ofa__largercategory__called operator-overloading__methods,which__well__explorein__later chapters.Such__methodsare__inheritedin__classtrees__asusual__andhave__doubleunderscores__atthe__startand__endof__theirnames__tomake__them distinct.Python__runsthem__automaticallywhen__instancesthat__supportthem__appearin__thecorresponding__operations,and__theyare__mostlyan__alternativeto__usingsimple__method calls.They__realso__optional:if__omitted,the__operationsare__not supported.If__no__init____is present,class__callsreturn__anempty__instance,without__initializing it.For__example,a__customset__intersectionmight__becoded__asa__methodnamed__intersectcalled__explicitly,or__asa__methodnamed____and__that__iscalled__automaticallyby__the &expression__operator.Because__theoperator__schememakes__instanceslook__andfeel__morelike__built-in types,it__allowssome__classesto__providea__consistentand__natural interface,and__becompatible__withcode__thatexpects__a built-in type. Still,apart__fromthe____init__constructor__whichappears__inmost__realisticclasses__manyprograms__maybe__betteroff__withsimpler__namedmethods__unlesstheir__objectsare__similarto__built-ins.A__giveRaisemay__makesense__foran__Employee,but__an &might__not.OOP__IsAbout__CodeReuse__And that,along__witha__fewsyntax__details,is__mostof__theOOP__storyin__Python.Of__course,there__sa__bitmore__toit__thanjust__inheritance.For__example,operator__overloadingis__muchmore__generalthan__describedso__farclasses__mayalso__providetheir__ownimplementations__ofoperations__suchas__indexing,fetching__attributes, printing,and__more.By__and large, though,OOP__isabout__lookingup__attributesin__treeswith__aspecial__firstargument__in functions.So__whywould__webe__interestedin__buildingand__searchingtrees__of objects?Although__ittakes__someexperience__tosee__how,when__used well,classes__supportcode__reusein__waysthat__otherPython__programcomponents__cannot.In__fact,this__is,by__most accounts,their__highest purpose.With__classes,we__codeby__customizingexisting__software,instead__ofeither__changingexisting__codein__placeor__startingfrom__scratchfor__eachnew__project.This__turnsout__tobe__apowerful__paradigmin__realistic programming.At__afundamental__level,classes__arereally__justpackages__offunctions__andother__names,much__like modules. However,the__automaticattribute__inheritancesearch__thatwe__getwith__classessupports__customizationof__softwareabove__andbeyond__whatwe__cando__withmodules__and functions. Moreover,classes__providea__naturalstructure__forcode__thatpackages__andlocalizes__bothlogic__and names,and__soaids__in debugging.To__be fair,because__methodsare__simplyfunctions__witha__specialfirst__argument,we__canmimic__someof__theirbehavior__bymanually__passingsubject__objectsto__simple functions.The__participationof__methodsin__class inheritance, though,allows__usto__naturallyextend__andcustomize__softwareby__codingsubclasses__withnew__methods,rather__thanmodifying__codethat__already works.There__isreally__nosuch__conceptwith__modulesand__functions.Polymorphism__andclasses__Asan__abstract example,suppose__youre__assignedthe__taskof__implementingan__employeedatabase__application.As__aPython__OOP programmer,you__mightbegin__bycoding__ageneral__superclassthat__definesdefault__behaviorscommon__toall__thekinds__ofemployees__inyour__organization (codein__thissection__ishypothetical__and partial):class__Employee: #General__superclassdef__computeSalary(self): #Common__ordefault__behaviorsdef__giveRaise(self):def__promote(self):def__retire(self):Once__youve__codedthis__general behavior,you__canspecialize__itfor__eachspecific__kindof__employeeto__reflecthow__thevarious__typesdiffer__fromthe__norm.That__is,you__cancode__subclassesthat__customizejust__thebits__ofbehavior__thatvary__peremployee__type;the__restof__theemployee__typesbehavior__willbe__inheritedfrom__themore__general class.For__instance,if__engineershave__aunique__salarycomputation__rule (perhapsit__snot__hourstimes__rate),you__canreplace__justthat__onemethod__ina__subclass:class__Engineer(Employee): #Specialized__subclassdef__computeSalary(self): #Something__customhere__Becausethe__computeSalaryversion__hereappears__lowerin__theclass__tree,it__willreplace__(override)the__generalversion__in Employee.All__other methods, though,are__inheritedfrom__thesuperclass__verbatim.You__thencreate__instancesof__thekinds__ofemployee__classesthat__thereal__employeesbelong__to,to__getthe__correct behavior:sue__= Employee() #Default__behaviorbob__= Employee() #Default__behaviorpat__= Engineer() #Custom__salarycalculator__Noticethat__youcan__makeinstances__ofany__classin__a tree,not__justthe__onesat__thebottom__theclass__youmake__aninstance__fromdetermines__thelevel__atwhich__theattribute__searchwill__begin,and__thuswhich__versionsof__themethods__itwill__employ (pun accidental). Ultimately,these__threeinstance__objectsmight__windup__embeddedin__alarger__containerobject__for instance,a__list, dictionary,or__aninstance__ofanother__classthat__representsa__departmentor__companyusing__thecomposition__ideamentioned__atthe__startof__this chapter.When__youlater__askfor__theseemployees__salaries,they__willbe__computedaccording__tothe__classesfrom__whichthe__objectswere__made,due__tothe__principlesof__theinheritance__search:company__= [sue, bob, pat] #A__compositeobject__foremp__in company: print(emp.computeSalary()) #Run__this emp's version:default__orcustom__Thisis__yetanother__instanceof__theidea__ofpolymorphism__introducedin__Chapter 4and__expandedin__Chapter 16.Recall__thatpolymorphism__meansthat__themeaning__ofan__operationdepends__onthe__objectbeing__operated on.That__is,code__shouldnt__careabout__whatan__object is,only__aboutwhat__it does. Here,the__methodcomputeSalary__islocated__byinheritance__searchin__eachobject__beforeit__is called,per__theobject__s class.The__neteffect__isthat__weautomatically__runthe__correctversion__forthe__objectbeing__processeddefault__or custom.Trace__thecode__tosee__why.In__other applications,polymorphism__mightalso__beused__toencapsulate__(i.e.,abstract__away)interface__differences.For__example,a__programthat__processesdata__streamsmight__becoded__toexpect__objectswith__inputand__output methods,without__caringwhat__thosemethods__actually do:def__processor(reader, converter, writer):while__True:data__= reader.read()if__not data:break__data = converter(data) writer.write(data)By__passingin__instancesof__subclassesthat__specializethe__requiredread__andwrite__methodinterfaces__forvarious__data sources,we__canreuse__theprocessor__functionfor__anydata__sourcewe__needto__use,both__nowand__inthe__future:class__Reader:def__other(self): #Default__behaviorand__toolsclass__FileReader(Reader):def__read(self): #Read__froma__localfile__class SocketReader(Reader):def__read(self): #Read__froma__networksocket__andothers__processor(FileReader( ), converter, FileWriter( )) processor(SocketReader( ), converter, FileWriter( )) processor(FtpReader( ), converter, JsonWriter( )) Moreover,because__theinternal__implementationsof__thoseread__andwrite__methodshave__beenfactored__intosingle__locations,they__canbe__changedwithout__impactingcode__thatuses__them.The__processorfunction__mighteven__bea__classitself__toallow__theconversion__logicof__converterto__befilled__inby__inheritance,and__toallow__readersand__writersto__beembedded__bycomposition__(youll__seehow__thisworks__laterin__thispart__ofthe__book).Programming__bycustomization__Onceyou__getused__toprogramming__thisway__(bysoftware__customization),you__llfind__thatwhen__its__timeto__writea__new program,much__ofyour__workmay__alreadybe__doneyour__tasklargely__becomesone__ofmixing__togetherexisting__superclassesthat__alreadyimplement__thebehavior__requiredby__your program.For__example,someone__elsemight__havewritten__theEmployee__andReader__classesin__thissection__sexamples__foruse__incompletely__different programs.If__so,you__getall__ofthat__persons__codefor__free.In__fact,in__manyapplication__domains,you__canfetch__orpurchase__collectionsof__superclasses,known__as frameworks,that__implementcommon__programmingtasks__as classes,ready__tobe__mixedinto__your applications.These__frameworksmight__providedatabase__interfaces,testing__protocols,GUI__toolkits,and__so on.With__frameworks,you__oftensimply__codea__subclassthat__fillsin__ahandful__ofexpected__methods;the__frameworkclasses__higherin__thetree__domost__ofthe__workfor__you.Programming__insuch__anOOP__worldis__justa__matterof__combiningand__specializingalready__debuggedcode__bywriting__subclassesof__your own.Of__course,it__takesa__whileto__learnhow__toleverage__classesto__achievesuch__OOP utopia.In__practice, object-orientedwork__alsoentails__substantialdesign__workto__fullyrealize__thecode__reusebenefits__of classes.To__this end,programmers__catalogcommon__OOP structures,known__asdesign__patterns,to__helpwith__design choices.The__actualcode__youwrite__todo__OOPin__Python, though,is__sosimple__thatit__willnot__initself__posean__additionalobstacle__toyour__OOP quest.To__see why,you__llhave__tomove__onto__Chapter 27.Chapter__SummaryWe__madean__initial,abstract__passover__classesand__OOPin__this chapter,taking__inthe__bigpicture__beforewe__diveinto__syntax details.As__weve__seen,OOP__ismostly__aboutan__argumentnamed__self,and__asearch__forattributes__intrees__oflinked__objectscalled__inheritance.Objects__atthe__bottomof__thetree__inheritattributes__fromobjects__higherup__inthe__treea__featurethat__enablesus__toprogram__bycustomizing__code,rather__thanchanging__itor__startingfrom__scratch.When__used well,this__modelof__programmingcan__cutdevelopment__time radically.The__nextchapter__willbegin__tofill__inthe__codingdetails__behindthe__picturepainted__here.As__weget__deeperinto__Python classes, though,keep__inmind__thatthe__OOPmodel__inPython__isvery__simple;as__weve__seen here,it__sreally__justabout__lookingup__namesin__objecttrees__anda__specialfunction__argument.Before__wemove__on,here__sa__quickquiz__toreview__whatwe__vecovered__here.Test__Your Knowledge:Quiz__1.What__isthe__mainpoint__ofOOP__in Python? 2.Where__doesan__inheritancesearch__lookfor__an attribute? 3.What__isthe__differencebetween__aclass__objectand__aninstance__object? 4.Why__isthe__firstargument__ina__classs__methodfunction__special? 5.What__isthe____init__method__used for? 6.How__doyou__createa__class instance? 7.How__doyou__createa__class? 8.How__doyou__specifya__classs__superclasses?Test__Your Knowledge:Answers__1.OOP__isabout__codereuse__youfactor__codeto__minimize redundancy,and__programby__customizingwhat__alreadyexists__insteadof__changingcode__inplace__orstarting__from scratch. 2.An__inheritancesearch__looksfor__anattribute__firstin__theinstance__object,then__inthe__classthe__instancewas__created from,then__inall__higher superclasses,progressing__fromthe__bottomto__thetop__ofthe__object tree,and__fromleft__toright__(normally).The__searchstops__atthe__firstplace__theattribute__is found.Because__thelowest__versionof__aname__foundalong__theway__wins,class__hierarchiesnaturally__supportcustomization__byextension__innew__subclasses. 3.Both__classand__instanceobjects__arenamespaces__packagesof__variablesthat__appearas__attributes.The__maindifference__betweenthem__isthat__classesare__akind__offactory__forcreating__multiple instances.Classes__alsosupport__operator-overloading methods,which__instances inherit,and__treatany__functionsnested__inthe__classas__methodsfor__processing instances. 4.The__firstargument__ina__classs__methodfunction__isspecial__becauseit__alwaysreceives__theinstance__objectthat__isthe__impliedsubject__ofthe__method call.It__susually__calledself__by convention.Because__methodfunctions__alwayshave__thisimplied__subjectand__objectcontext__by default,we__saythey__are object-oriented (i.e.,designed__toprocess__orchange__objects). 5.If__the__init____methodis__codedor__inheritedin__a class,Python__callsit__automaticallyeach__timean__instanceof__thatclass__is created.It__sknown__asthe__constructor method;it__ispassed__thenew__instance implicitly,as__wellas__anyarguments__passedexplicitly__tothe__class name.It__salso__themost__commonlyused__operator-overloading method.If__no__init____methodis__present,instances__simplybegin__lifeas__empty namespaces. 6.You__createa__classinstance__bycalling__theclass__nameas__thoughit__werea__function;any__argumentspassed__intothe__classname__showup__asarguments__twoand__beyondin__the__init____constructormethod__(ifthere__is one).The__newinstance__remembersthe__classit__wascreated__fromfor__inheritance purposes. 7.You__createa__classby__runninga__class statement;like__function definitions,these__statementsnormally__runwhen__theenclosing__modulefile__isimported__(moreon__thisin__thenext__chapter). 8.You__specifya__classs__superclassesby__listingthem__inparentheses__inthe__class statement,after__thenew__classs__name.The__left-to-rightorder__inwhich__theclasses__arelisted__inthe__parenthesesgives__the left-to-rightinheritance__searchorder__inthe__class tree. 1In__otherliterature__and circles,you__mayalso__occasionallysee__theterms__baseclasses__andderived__classesused__todescribe__superclassesand__subclasses, respectively.Most__Pythonpeople__andthis__booktend__touse__thelatter__terms. 2If__youve__everused__C++or__Java,you__llrecognize__thatPython__sself__ismuch__likethese__languagesthis__pointer/reference,but__selfis__alwaysexplicit__inboth__headersand__bodiesof__Pythonmethods__tomake__attributeaccesses__more obvious:a__namehas__fewerpossible__meaningsto__consider,if__itcannot__bemagically__associatedwith__ahidden__object.Explicit__isgenerally__better.Chapter__27.Class__CodingBasics__Nowthat__weve__talkedabout__OOPin__the abstract,it__stime__tosee__howthis__translatesto__actual code.This__chapterbegins__tofill__inthe__syntaxdetails__behindthe__classmodel__in Python.If__youve__neverbeen__exposedto__OOPin__the past,classes__canseem__somewhatcomplicated__iftaken__ina__single dose.To__makeclass__codingeasier__to absorb,we__llbegin__ourdetailed__explorationof__OOPby__takinga__firstlook__atsome__basicclasses__inaction__inthis__chapter.We__llexpand__onthe__detailsintroduced__herein__laterchapters__ofthis__partof__the book,but__intheir__basic form,Python__classesare__easyto__understand.In__fact,classes__havejust__threeprimary__distinctions.At__abase__level,they__aremostly__just namespaces,much__likethe__moduleswe__studiedin__Part V.Unlike__modules, though,classes__alsohave__supportfor__generatingmultiple__objects,for__namespace inheritance,and__foroperator__overloading.Let__sbegin__ourclass__statementtour__byexploring__eachof__thesethree__distinctionsin__turn.Classes__GenerateMultiple__InstanceObjects__Tounderstand__howthe__multipleobjects__idea works,you__haveto__firstunderstand__thatthere__aretwo__kindsof__objectsin__Pythons__OOP model:class__objectsand__instance objects.Class__objectsprovide__defaultbehavior__andare__usedto__createinstance__objects.Instance__objectsare__thetangible__objectsyour__programsprocess__eachis__anamespace__inits__ownright__butinherits__(i.e.,has__automaticaccess__to)names__inthe__classfrom__whichit__was created.Class__objectscome__from statements,and__instancescome__from calls;each__timeyou__calla__class,you__geta__newinstance__ofthat__class.This__object-generationconcept__isvery__differentfrom__mostof__theother__programconstructs__weve__seenso__farin__this book.In__effect,classes__areessentially__factoriesfor__generatingmultiple__instances.By__contrast,only__onecopy__ofeach__moduleis__everimported__intoa__single program.In__fact,this__iswhy__reloadworks__asit__does,updating__asingle__instanceand__sharedobject__in place.With__classes,each__instancecan__haveits__ownindependent__data,supporting__multipleversions__ofthe__objectthat__theclass__models.In__this role,class__instancesare__similarto__the per-callstate__ofthe__closure (a.k.a. factory)functions__ofChapter__17,but__thisis__anatural__partof__theclass__model,and__statein__classesis__explicitattributes__insteadof__implicitscope__references. Moreover,this__isjust__partof__whatclasses__dothey__alsosupport__customizationby__inheritance,operator__overloading,and__multiplebehaviors__via methods. Hence,classes__area__morecomplete__programming tool,though__OOPand__functionalprogramming__arenot__mutuallyexclusive__paradigms.We__maycombine__themby__usingfunctional__toolsin__methods,by__codingmethods__thatare__themselves generators,by__writing user-defined iterators,and__so on.The__followingis__aquick__summaryof__thebare__essentialsof__PythonOOP__interms__ofits__twoobject__types.As__youll__see,Python__classesare__insome__wayssimilar__toboth__defsand__modules,but__theymay__bequite__differentfrom__whatyou__reused__toin__other languages.Class__ObjectsProvide__DefaultBehavior__Whenwe__runa__class statement,we__geta__class object.Here__sa__rundownof__themain__propertiesof__Python classes:The__classstatement__createsa__classobject__andassigns__ita__name.Just__likethe__functiondef__statement,the__Pythonclass__isan__executable statement.When__reachedand__run,it__generatesa__newclass__objectand__assignsit__tothe__firstname__inthe__class header. Also,like__defs,class__statementstypically__runwhen__thefiles__theyare__codedin__arefirst__importedor__runas__a top-level script.Assignments__insideclass__statementsmake__class attributes.Just__likein__module files, top-levelassignments__withina__classstatement__(notnested__ina__def)generate__attributesin__aclass__object. Technically,the__classstatement__definesa__localscope__thatmorphs__intothe__attributenamespace__ofthe__class object,just__likea__modules__global scope.After__runninga__class statement,class__attributesmay__beaccessed__byname__qualification: class.name.Class__attributesprovide__objectstate__and behavior.Attributes__ofa__classobject__recordstate__informationand__behaviorto__beshared__byall__instancescreated__fromthe__class.Most__notablyand__commonly,function__defstatements__nestedinside__aclass__generate methods,which__process instances.Instance__ObjectsAre__ConcreteItems__Whenwe__calla__class object,we__getan__instance object.Here__san__overviewof__thekey__pointsbehind__class instances:Calling__aclass__objectlike__afunction__makesa__newinstance__object.Each__timea__classis__called,it__createsand__returnsa__newinstance__object.Instances__representmaterial__itemsin__yourprogram__s domain.Each__instanceobject__inheritsclass__attributesand__getsits__own namespace.Instance__objectscreated__fromclasses__arenew__namespaces;they__startout__emptybut__inheritattributes__thatlive__inthe__classobjects__fromwhich__theywere__generated.Assignments__toattributes__ofself__inmethods__make per-instance attributes.Inside__aclass__smethod__functions,the__firstargument__(calledself__by convention)references__theinstance__objectbeing__processed;assignments__toattributes__ofself__createor__changedata__inthe__instance,not__the class.The__endresult__isthat__classesdefine__common,shared__dataand__behavior,and__generate instances.Instances__reflectpalpable__applicationentities__andrecord__per-instance__datathat__mayvary__per object.A__FirstExample__Lets__turnto__areal__exampleto__showhow__theseideas__workin__practice.To__begin,let__sdefine__aclass__namedFirstClass__byrunning__aPython__classstatement__interactivelyin__any REPL: >>>class__FirstClass: #Define__aclass__objectdef__setdata(self, value): #Define__class'smethods__self.data =value__#self__isthe__instancedef__display(self): print(self.data) # self.data:per__instanceWe__reworking__interactively here,but__typically,such__astatement__wouldbe__runwhen__themodule__fileit__iscoded__inis__imported.Like__functionscreated__with defs,this__classwon__teven__existuntil__Pythonreaches__andruns__this statement.Like__allcompound__statements,the__classstarts__witha__headerline__thatlists__theclass__name,followed__bya__bodyof__oneor__morenested__and (usually)indented__statements. Here,the__nestedstatements__are defs;they__definefunctions__thatimplement__thebehavior__theclass__meansto__export.As__welearned__inPart__IV,def__isreally__an assignment. Here,it__assignsfunction__objectsto__thenames__setdataand__displayin__theclass__statements__scope,and__sogenerates__attributesattached__tothe__class FirstClass.setdataand__FirstClass.display.In__fact,any__nameassigned__atthe__toplevel__ofthe__classs__nestedblock__becomesan__attributeof__the class.Functions__insidea__classare__usuallyand__traditionallycalled__methods.They__recoded__withnormal__defs,and__theysupport__everythingwe__velearned__aboutfunctions__alreadythey__canhave__defaults,return__values,yield__itemson__request,and__so on.But__ina__method function,the__firstargument__automaticallyreceives__animplied__instanceobject__whencalled__thesubject__ofthe__call.Let__screate__acouple__ofinstances__ofour__classto__seehow__this works: >>>x__= FirstClass() #Make__twoinstances__>>>y__= FirstClass() #Each__isa__newnamespace__Bycalling__theclass__thisway__(noticethe__parentheses),we__generateinstance__objects,which__arejust__namespacesthat__haveaccess__totheir__classes attributes.Properly__speaking,at__this point,we__havethree__objects:two__instancesand__a class.And__really,we__havethree__linked namespaces,as__sketchedin__Figure 27-1.In__OOP terms,we__saythat__xis__a FirstClass,as__isy__theyboth__inheritnames__attachedto__the class.Figure__27-1.Classes__and instances:namespaces__ina__classtree__searchedby__inheritanceThe__twoinstances__startout__emptybut__havelinks__backto__theclass__fromwhich__theywere__generated.If__wequalify__aninstance__withthe__nameof__anattribute__thatlives__inthe__class object,Python__fetchesthe__namefrom__theclass__byinheritance__search (unlessit__alsolives__inthe__instance): >>> x.setdata('coding') #Call__methods:self__isx__>>> y.setdata(3.14159) # Runs: FirstClass.setdata(y, 3.14159)Neither__xnor__yhas__asetdata__attributeof__its own,so__tofind__it,Python__followsthe__linkfrom__instanceto__class.And__thats__aboutall__thereis__toinheritance__in Python:it__happensat__attributequalification__time,and__itjust__involveslooking__upnames__inlinked__objects here,by__followingthe__is-alinks__inFigure__27-1.In__thesetdata__functioninside__FirstClass,the__valuepassed__inis__assignedto__self.data.Within__a method,self__thename__givento__theleftmost__argumentby__conventionautomatically__refersto__theinstance__beingprocessed__(xor__yat__this point),so__theassignments__storevalues__inthe__instances namespaces,not__theclass__s.That__show__thedata__namesin__Figure 27-1are__created.Because__classescan__generatemultiple__instances,methods__mustgo__throughthe__selfargument__toget__tothe__instanceto__be processed.When__wecall__theclass__sdisplay__methodto__print self.data,we__seethat__its__differentin__each instance;on__theother__hand,the__namedisplay__itselfis__thesame__inx__and y,as__itcomes__(is inherited)from__the class: >>> x.display() # Runs: FirstClass.display(x)coding__>>> y.display() # self.datadiffers__ineach__instance 3.14159Notice__thatwe__storeddifferent__objecttypes__inthe__datamember__ineach__instancea__stringand__a floating-point number.As__witheverything__elsein__Python,instance__attributes (sometimescalled__members)are__notpredeclared__andhave__notype__constraints;they__springinto__existencethe__firsttime__theyare__assigned values,just__likesimple__variables.In__fact,if__wewere__tocall__displayon__oneof__ourinstances__beforecalling__setdata,we__wouldtrigger__anundefined__nameerror__theattribute__nameddata__doesnt__evenexist__inmemory__untilit__isassigned__withinthe__setdata method.As__anotherway__toappreciate__howdynamic__thismodel__is,consider__thatwe__canchange__instanceattributes__eitherinside__theclass__itself,by__assigningto__selfin__methods,or__outsidethe__class,by__assigningto__anexplicit__instance object: >>> x.data = 'hacking' #Can__get/setattributes__>>> x.display() #Outside__theclass__toohacking__Althoughless__common,we__couldeven__generatean__entirelynew__attributein__theinstance__snamespace__byassigning__toits__nameoutside__theclass__smethod__functions: >>> x.anothername = 'apps' #Can__setnew__attributeshere__too!This__wouldattach__anew__attributecalled__anothername,which__mayor__maynot__beused__byany__ofthe__classs__methods,to__theinstance__object x.Classes__usuallycreate__allof__theinstance__sattributes__byassignment__tothe__self argument,but__theydon__thave__toprograms__can fetch, change,or__createattributes__onany__objectsto__whichthey__have references.It__usuallydoesn__tmake__senseto__adddata__thatthe__classcannot__use,and__its__possibleto__preventthis__withextra__privacycode__basedon__attribute-accessoperator__overloading,as__well__discusselsewhere__inthis__book (inChapters__30and__39). Still,free__attributeaccess__translatesto__less syntax,and__thereare__caseswhere__its__evenuseful__for example,in__codingdata__recordsof__thesort__well__buildlater__inthis__chapter.Classes__AreCustomized__byInheritance__Lets__moveon__tothe__secondmajor__distinctionof__classes.Besides__servingas__factoriesfor__generatingmultiple__instance objects,classes__alsoallow__usto__makechanges__byintroducing__newcomponents__(called subclasses),instead__ofchanging__existingcomponents__in place.As__weve__seen,instance__objectsgenerated__froma__classinherit__theclass__s attributes.Python__alsoallows__classesto__inheritfrom__other classes,opening__thedoor__tocoding__hierarchiesof__classesthat__specializebehavior__byredefining__attributesin__subclassesthat__appearlower__inthe__hierarchy,we__overridethe__moregeneral__definitionsof__thoseattributes__higherin__the tree.In__effect,the__furtherdown__thehierarchy__we go,the__morespecific__thesoftware__becomes. Here, too,there__isno__parallelwith__modules,whose__attributeslive__ina__single,flat__namespacethat__isnot__asamenable__to customization.In__Python,instances__inheritfrom__classes,and__classesinherit__from superclasses.Here__arethe__keyideas__behindthe__machineryof__attribute inheritance:Superclasses__arelisted__inparentheses__ina__class header.To__makea__classinherit__attributesfrom__another class,just__listthe__otherclass__inparentheses__inthe__newclass__statements__header line.The__classthat__inheritsis__usuallycalled__a subclass,and__theclass__thatis__inheritedfrom__isits__superclass.Classes__inheritattributes__fromtheir__superclasses.Just__asinstances__inheritthe__attributenames__definedin__their classes,classes__inheritall__ofthe__attributenames__definedin__their superclasses.Python__findsthese__namesautomatically__whenthey__reaccessed__ifthey__dont__existin__the subclasses.Instances__inheritattributes__fromall__accessible classes.Each__instancegets__namesfrom__theclass__its__generated from,as__wellas__allof__thatclass__s superclasses.When__lookingfor__a name,Python__checksthe__instance,then__its class,then__allsuperclasses__aboveits__class.Each__object.attributereference__invokesa__new,independent__search.Python__performsan__independentsearch__ofthe__classtree__foreach__attributefetch__expression.This__includesreferences__toinstances__andclasses__madeoutside__classstatements__(e.g., X.attr),as__wellas__referencesto__attributesof__theself__instanceargument__ina__classs__method functions.That__is,each__self.attrexpression__ina__methodinvokes__anew__searchfor__attrin__selfand__above.The__neteffect__andthe__mainpurpose__ofall__thissearching__isthat__classessupport__factoringand__customizationof__codebetter__thanany__otherlanguage__toolwe__veseen__so far.On__theone__hand,they__allowus__tominimize__coderedundancy__(andso__reducemaintenance__costs)by__factoringoperations__intoa__single,shared__implementation;on__the other,they__allowus__toprogram__bycustomizing__whatalready__exists,rather__thanchanging__itin__placeor__startingfrom__scratch.NOTE__Fullinheritance__disclosure:Strictly__speaking,Python__sinheritance__isricher__thandescribed__here,when__wefactor__indiamond__inheritancepatterns__andmetaclasses__advancedtopics__well__studylater__butwe__cansafely__restrictour__scopeto__instancesand__their classes,both__atthis__pointin__thebook__andin__mostPython__application code.We__llexplore__diamondsand__theMRO__inheritancesearch__orderthat__accommodatesthem__inChapter__31,but__ourdefinition__ofinheritance__wont__befully__completeuntil__Chapter 40,because__itregrettably__requiresmetaclass__infothat__sbeyond__almostall__Pythonprogrammers__interestlevels__andpay__grades (thankfully!).A__SecondExample__Toillustrate__therole__of inheritance,this__nextexample__buildson__theprevious__one. First,we__lldefine__anew__class, SecondClass,that__inheritsall__ofFirstClass__snames__andprovides__oneof__its own: >>>class__SecondClass(FirstClass): #Inherits__setdatadef__display(self): #Changes__display print(f'Currentvalue__= "{self.data}"')SecondClass__definesthe__displaymethod__toprint__witha__different format.By__definingan__attributewith__thesame__nameas__anattribute__in FirstClass,SecondClass__effectivelyreplaces__thedisplay__attributein__its superclass.Recall__thatinheritance__searchesproceed__upwardfrom__instancesto__subclassesto__superclasses,stopping__atthe__firstappearance__ofthe__attributename__thatit__finds.In__this case,since__thedisplay__namein__SecondClasswill__befound__beforethe__onein__FirstClass,we__saythat__SecondClassoverrides__FirstClasss__display.Sometimes__wecall__thisact__ofreplacing__attributesby__redefiningthem__lowerin__thetree__overloading.The__neteffect__hereis__thatSecondClass__specializesFirstClass__bychanging__thebehavior__ofthe__display method.On__theother__hand,SecondClass__(andany__instancescreated__from it)still__inheritsthe__setdatamethod__inFirstClass__verbatim.Let__smake__anew__instanceto__demonstrate: >>>z__= SecondClass() >>> z.setdata('LP6e') #Finds__setdatain__FirstClass >>> z.display() #Finds__overriddenmethod__inSecondClass__Currentvalue__= "LP6e"As__before,we__makea__SecondClassinstance__objectby__calling it.The__setdatacall__stillruns__theversion__in FirstClass,but__thistime__thedisplay__attributecomes__fromSecondClass__andprints__acustom__message.Figure__27-2sketches__thenamespaces__involved.Figure__27-2. Specialization:overriding__inheritednames__byredefining__themin__subclasses Now,here__sa__crucialthing__tonotice__about OOP:the__specializationintroduced__inSecondClass__iscompletely__externalto__FirstClass.That__is,it__doesnt__affectexisting__orfuture__FirstClass objects,like__thex__fromthe__priorexample__(assumingwe__recontinuing__thesame__REPL session): >>> x.display() #x__isstill__aFirstClass__instance (old message)hacking__Ratherthan__changing FirstClass,we__customized it. Naturally,this__isan__artificial example,but__asa__rule,because__inheritanceallows__usto__makechanges__likethis__inexternal__components (i.e.,in__subclasses),classes__oftensupport__extensionand__reusebetter__thanfunctions__ormodules__can.Classes__AreAttributes__inModules__Beforewe__move on,remember__thatthere__snothing__magicabout__aclass__name.It__sjust__avariable__assignedto__anobject__whenthe__classstatement__runs,and__theobject__canbe__referencedwith__anynormal__expression.For__instance,if__ourFirstClass__werecoded__ina__modulefile__insteadof__beingtyped__interactively,we__couldimport__itand__useits__namenormally__ina__classheader__line:from__modulenameimport__FirstClass #Copy__nameinto__myscope__class SecondClass(FirstClass): #Use__classname__directlydef__display(self):Or__equivalently:import__modulename #Access__thewhole__moduleclass__SecondClass(modulename.FirstClass): #Qualify__toreference__def display(self):Like__everything else,class__namesalways__livewithin__a module,so__theymust__followall__therules__westudied__inPart__V.For__example,more__thanone__classcan__becoded__ina__singlemodule__filelike__otherstatements__ina__module,class__statementsare__runduring__importsto__define names,and__thesenames__becomedistinct__module attributes.More__generally,each__modulemay__arbitrarilymix__anynumber__of variables, functions,and__classes,and__allnames__ina__modulebehave__thesame__way.The__followinghypothetical__file demonstrates: # names.py var1 = 6 # names.var1 var2 = 3.12def__func1(): # names.func1def__func2():class__Cls1: # names.Cls1class__Cls2: # names.Cls2This__holdstrue__evenif__themodule__andclass__happento__havethe__same name.For__example,given__thefollowing__imaginary file, person.py:class__person:we__needto__gothrough__themodule__tofetch__theclass__as usual:import__person #Import__modulex__= person.person() #Class__withinmodule__Althoughthis__pathmay__look redundant,it__s required: person.personrefers__tothe__personclass__insidethe__person module.Saying__justperson__getsthe__module,not__the class,unless__thefrom__statementis__used:from__personimport__person #Get__classfrom__modulex__= person() #Use__classname__Aswith__anyother__variable,we__cannever__seea__classin__afile__withoutfirst__importingand__somehowfetching__itfrom__itsenclosing__file.If__thisseems__confusing,don__tuse__thesame__namefor__amodule__anda__classwithin__it.In__fact,common__conventionin__Pythonrecommends__thatclass__namesshould__beginwith__anuppercase__letter,and__modulenames__witha__lowercase letter,to__helpmake__themmore__distinct (its__not required,but__nearlycommon__enoughto__bea__rule):import__person #Lowercase__formodules__x = person.Person() #Uppercase__forclasses__Also,keep__inmind__thatalthough__classesand__modulesare__bothnamespaces__forattaching__attributes,they__correspondto__verydifferent__sourcecode__structures:a__modulereflects__anentire__file,but__aclass__isa__statementwithin__a file.We__llsay__moreabout__suchdistinctions__laterin__thispart__ofthe__book.Classes__CanIntercept__PythonOperators__Lets__moveon__tothe__thirdand__finalmajor__differencebetween__classesand__modules:operator__overloading.In__simple terms,operator__overloadinglets__objectscoded__withclasses__interceptand__respondto__operationsthat__workon__built-in types: addition, slicing, printing, qualification,and__so on.It__smostly__justan__automaticdispatch__mechanismexpressions__andother__built-inoperations__routecontrol__toimplementations__in classes. Here, too,there__isnothing__similarin__modules:modules__canimplement__function calls,but__notthe__behaviorof__expressions (apart,that__is,from__theodd__specialcase__addedin__Python 3.7for__module__getattr____and__dir____functionscovered__inChapter__25,and__bemoanedthere__asa__confusingconflation__withclasses__forreasons__youre__aboutto__seefor__yourself).Although__wecould__implementall__classbehavior__asnormally__named methods,operator__overloadinglets__objectsbe__moretightly__integratedwith__Pythons__object model. Moreover,because__operatoroverloading__makesour__ownobjects__actlike__built-ins,it__tendsto__fosterobject__interfacesthat__aremore__consistentand__easierto__learn,and__itallows__class-basedobjects__tobe__processedby__codewritten__toexpect__a built-inobject__s interface.Here__isa__quickrundown__ofthe__mainideas__behindoverloading__operators:Methods__namedwith__doubleunderscores__(__X__)are__special hooks.In__Python classes,we__implementoperator__overloadingby__providingspecially__namedmethods__tointercept__operations.The__Pythonlanguage__definesa__fixedand__unchangeablemapping__fromeach__ofthese__operationsto__aspecially__named method.Such__methodsare__calledautomatically__wheninstances__appearin__built-in operations.For__instance,if__aninstance__objectinherits__an__add____method,that__methodis__calledwhenever__theobject__appearsin__a + expression.The__methods__returnvalue__becomesthe__resultof__thecorresponding__expression.Classes__mayoverride__most built-intype__operations.There__aredozens__ofspecial__operator-overloadingmethod__namesfor__interceptingand__implementingnearly__everyoperation__availablefor__built-inobject__types.This__includes expressions,but__alsobasic__operationslike__printingand__object creation.Most__operator-overloadingmethods__haveno__default,and__noneare__required.If__aclass__doesnot__defineor__inheritan__operator-overloading method,it__justmeans__thatthe__correspondingoperation__isnot__supportedfor__theclass__s instances.If__thereis__no __add__,for__example, +expressions__raise exceptions.As__youll__learn later,a__rootclass__namedobject__thats__animplicit__superclassto__everyclass__doesprovide__defaultsfor__some__X____methods,but__notfor__many (e.g.,object__hasa__defaultfor__print strings,but__not +). Importantly,operator__overloadingis__anoptional__feature;it__sused__primarilyby__peopledeveloping__toolsfor__otherPython__programmers,not__byapplication__developers. And, candidly,you__probablyshouldn__tuse__itjust__becauseit__seems clever.Unless__aclass__needsto__mimic built-inobject__interfaces,it__shouldusually__stickto__nonoperatormethod__nameswhose__callsare__more explicit.Expressions__like *and__+,for__example,may__makesense__fora__numericobject__likea__matrix,but__othercode__wouldgenerally__serveits__clientsbetter__withmnemonically__named methods.Because__of this,we__wont__gointo__detailson__every operator-overloadingmethod__availablein__Pythonin__thislearner__s book. Still,as__previewedin__theprior__chapter,there__isone__operator-overloadingmethod__youare__likelyto__seein__almostevery__Python class:the____init__ method,which__isknown__asthe__constructormethod__andis__usedto__initializeinstance__objects state.Pay__specialattention__tothis__method,because____init__,along__withthe__selfargument__andinheritance__search,turns__outto__bea__corerequirement__forreading__andunderstanding__mostOOP__codein__Python.A__ThirdExample__Onto__another example.This__time,we__lldefine__asubclass__ofthe__priorsection__sSecondClass__thatimplements__threespecially__namedattributes__thatPython__willcall__automatically:__init____isrun__whena__newinstance__objectis__created:self__isthe__newThirdClass__object.1__add____isrun__whena__ThirdClassinstance__appearsin__a + expression.__str____isrun__whenan__objectis__printed (technically,when__its__convertedto__itsprint__stringby__thestr__built-infunction__orits__Python-internals__equivalent).Our__newsubclass__alsodefines__anormally__namedmethod__called mul,which__changesthe__instanceobject__in place.Here__sthe__newsubclass__(copy-and-pasters:in__REPLs,you__mayneed__toomit__blanklines__addedhere__for clarity): >>>class__ThirdClass(SecondClass): #Inherit__fromSecondClass__def __init__(self, value): #On__"ThirdClass(value)" self.data =value__def __add__(self, other): #On__"self + other"return__ThirdClass(self.data + other)def____str__(self): #On__"print(self)", "str()"return__f'[ThirdClass: {self.data}]'def__mul(self, other): # In-place change:named__self.data *=other__ThirdClassis__a SecondClass,so__itsinstances__inheritthe__customizeddisplay__methodfrom__SecondClassof__thepreceding__section.This__time, though,ThirdClass__creationcalls__passan__objectto__thevalue__argumentin__the__init____constructor,where__itis__assignedto__self.data.The__neteffect__isthat__ThirdClassarranges__toset__thedata__attributeautomatically__atconstruction__time,instead__ofrequiring__latersetdata__calls: >>>a__= ThirdClass(3) #__init____called >>> a.display() #Inherited__methodcalled__Currentvalue__= "3"ThirdClass__objectscan__alsonow__showup__in +expressions__andprint__calls.For__+,Python__passesthe__instanceobject__onthe__leftto__theself__argumentin____add__and__thevalue__onthe__rightto__other,as__illustratedin__Figure 27-3;whatever____add__returns__becomesthe__resultof__the +expression__(moreon__itsresult__ina__moment): >>>b__=a__+ 3 # __add__:makes__anew__instance >>> b.display() #b__hasall__ThirdClassmethods__Currentvalue__= "6"For__print,Python__passesthe__objectbeing__printedto__selfin____str__;whatever__stringthis__methodreturns__istaken__tobe__theprint__stringfor__the object.With____str__ (orits__broadertwin____repr__,which__well__leveragein__thenext__chapter),we__canuse__anormal__printto__displayobjects__ofthis__class,instead__ofcalling__thedisplay__method.As__a contrast,the__addedmul__methodalso__changesthe__instancein__placefor__anamed__call: >>> print(b) # __str__:returns__displaystring__[ThirdClass: 6] >>> a.mul(3) # mul:changes__instancein__place >>> print(a) #Print__this instance'sdata__[ThirdClass: 9]Figure__27-3.Operator__overloading:class__methodsare__runfor__operatorsand__operationsSpecially__namedmethods__suchas____init__, __add__,and____str__are__inheritedby__subclassesand__instances,just__likeany__othernames__assignedin__a class.If__theyre__notcoded__ina__class,Python__looksfor__suchnames__inall__its superclasses,as__usual.As__forall__attributes,the__lowest (most specific)version__is used. Operator-overloadingmethod__namesare__alsonot__built-inor__reserved words;they__arejust__attributesthat__Pythonlooks__forwhen__objectsappear__invarious__contexts.Python__usuallycalls__them automatically,but__theymay__occasionallybe__calledby__yourcode__as well.For__example,the____init__method__isoften__calledmanually__totrigger__requiredinitialization__stepsin__asuperclass__constructor,as__youll__seein__thenext__chapter.Returning__resultsor__notSome__operator-overloadingmethods__like__str____require results,but__othersare__more flexible.For__example,notice__howthe____add__method__makesand__returnsa__newinstance__objectof__its class,by__callingThirdClass__withthe__resultvalue__whichin__turntriggers____init__to__initializethe__result.This__isa__common convention,and__explainswhy__bin__thelisting__hasa__display method;it__sa__ThirdClassobject__too,because__thats__what +returns__forthis__classs__objects.This__essentiallypropagates__theobject__type.By__contrast,mul__changesthe__currentinstance__objectin__place,by__reassigningthe__self attribute.We__couldoverload__the *expression__todo__thesame__with __mul__,but__thiswould__betoo__differentfrom__thebehavior__of *for__built-intypes__suchas__numbersand__strings,for__whichit__alwaysmakes__new objects.Per__common practice,overloaded__operatorsshould__workthe__sameway__that built-inoperations__do.Because__operatoroverloading__isreally__justan__expression-to-methoddispatch__mechanism, though,you__caninterpret__operatorsany__wayyou__likein__yourown__classes. Also,stay__tunedfor__Chapter 30s__relatedcoverage__of in-placeoperator__methods (preview:__imul____handles *=).Other__operator-overloadingmethods__Althoughwe__wont__coverevery__operator-overloadingmethod__inthis__book,we__llsurvey__additionalcommon__operator-overloadingtechniques__inChapter__30. Again,while__thisis__anoptional__toolthat__doesnt__applyto__mostapplication__programs,__str____isnot__uncommon,and__the__init____constructormethod__isa__normthat__willbe__presentin__mostPython__classesyou__llcome__across.In__fact,even__thoughinstance__attributesneed__notbe__predeclaredin__Python,you__canusually__findout__whichattributes__aninstance__willhave__byinspecting__itsclass__s__init____method.The__Worlds__SimplestPython__ClassDespite__thedetails__ofthe__classstatement__thatwe__vebegun__touncover__inthis__chapter,you__shouldkeep__inmind__thatthe__basicinheritance__modelbehind__classesis__verysimple__allit__reallyinvolves__issearching__forattributes__intrees__oflinked__objects.In__fact,we__cancreate__aclass__withnothing__init__at all.The__followingstatement__makesa__classwith__noattributes__attached,an__emptynamespace__object: >>>class__rec:pass__#Empty__namespaceobject__Weneed__the no-operationpass__placeholderstatement__(discussedin__Chapter 13)here__becausewe__dont__haveany__methodsto__code.After__wemake__theclass__byrunning__thisstatement__interactively,we__canstart__attachingattributes__tothe__classby__assigningnames__toit__completelyoutside__ofthe__originalclass__statement: >>> rec.name = 'Pat' #Just__objectswith__attributes >>> rec.age = 40 And,after__weve__createdthese__attributesby__assignment,we__canfetch__themwith__theusual__syntax.When__usedthis__way,a__classis__roughlysimilar__toa__structin__C,or__arecord__in Pascal.It__sbasically__anobject__withfield__namesattached__to it,and__maybe__easierto__codethan__alternativeslike__dictionaries: >>> print(rec.name) #Like__aC__structor__arecord__PatNotice__thatthis__workseven__thoughthere__areno__instancesof__theclass__yet;classes__areobjects__intheir__own right,even__without instances.In__fact,they__arejust__self-contained__namespaces;as__longas__wehave__areference__toa__class,we__canset__orchange__itsattributes__anytimewe__wish.Watch__whathappens__whenwe__docreate__two instances, though: >>>x__= rec() #Instances__inheritclass__names >>>y__= rec()These__instancesbegin__theirlives__ascompletely__emptynamespace__objects.Because__theyremember__theclass__fromwhich__theywere__made, though,they__willobtain__theattributes__weattached__tothe__classby__inheritance: >>> x.name, y.name #name__isstored__onthe__classonly__('Pat', 'Pat') Really,these__instanceshave__noattributes__oftheir__own;they__simplyfetch__thename__attributefrom__theclass__objectwhere__itis__stored.If__wedo__assignan__attributeto__an instance, though,it__creates (or changes)the__attributein__that object,and__noother__crucially,attribute__referenceskick__offinheritance__searches,but__attributeassignments__affectonly__theobjects__inwhich__theassignments__are made. Here,this__meansthat__xgets__itsown__name,but__ystill__inheritsthe__nameattached__tothe__classabove__it: >>> x.name = 'Sue' #But__assignmentchanges__xonly__>>> rec.name, x.name, y.name ('Pat', 'Sue', 'Pat') Classes:Under__theHood__In fact,as__well__explorein__moredetail__inChapter__29,the__attributesof__anamespace__objectare__usuallyimplemented__as dictionaries,and__classinheritance__trees are,generally__speaking,just__dictionarieswith__linksto__other dictionaries.If__youknow__whereto__look,you__cansee__this explicitly.For__example,the____dict__attribute__isthe__namespacedictionary__formost__class-based__objects,much__asin__modules.Some__classesmay__alsoor__insteaddefine__attributesin____slots__,an__advancedand__seldom-usedfeature__calledslots__withimpacts__thatwe__llnote__alongthe__way,but__whosefull__coveragewe__lllargely__postponeuntil__Chapter 32. Normally, though,__dict____literallyis__theattribute__namespaceof__aninstance__or class.To__illustrate,the__followinginspects__thenamespaces__ofobjects__inthe__priorsection__sREPL__session,filtering__out built-insin__theclass__witha__generatorexpression__aswe__vedone__beforeleaving__justthe__nameswe__ve assigned: >>> list(keyfor__keyin__rec.__dict__if__not key.startswith('__')) ['name', 'age'] >>> list(x.__dict__) ['name'] >>> list(y.__dict__) [] Here,the__classs__namespacedictionary__showsthe__nameand__ageattributes__weassigned__to it,x__hasits__own name,and__yis__still empty.Because__ofthis__model,an__attributecan__oftenbe__fetchedby__eitherdictionary__indexingor__attribute notation,but__onlyif__its__presenton__theobject__inquestion__attributenotation__kicksoff__inheritance search,but__indexinglooks__inthe__singleobject__only.As__youll__see later,both__havevalid__roles,and__thedir__built-incollects__inherited names: >>> x.name, x.__dict__['name'] #Attributes__presenthere__aredict__keys ('Sue', 'Sue') >>> x.age #But__attributefetch__checksclasses__too 40 >>> x.__dict__['age'] #Indexing__dictdoes__notdo__inheritance KeyError: 'age' >>> x.__dict__ #Object__namespaceversus__inheritance {'name': 'Sue'} >>> [attrfor__attrin__dir(x)if__attr[:2] != '__'] ['age', 'name']In__addition,to__facilitateinheritance__searchon__attribute fetches,each__instancehas__alink__toits__classthat__Pythoncreates__forus__its__called __class__,if__youwant__toinspect__it: >>> x.__class__ # Instance-to-classlink__Classesalso__havea____bases__ attribute,which__isa__tupleof__referencesto__aclass__ssuperclass__objectsin__thisexample__justthe__implicitand__automaticobject__rootclass__well__explore later: >>> rec.__bases__ # Class-to-superclasseslink__(,)These__twoattributes__arehow__classtrees__areliterally__representedin__memoryby__Python.Internal__detailslike__theseare__notrequired__knowledgeclass__treesare__impliedby__thecode__you run,and__theirsearch__isnormally__automaticbut__theycan__oftenhelp__demystifythe__model.The__mainpoint__hereis__thatPython__sclass__modelis__extremely dynamic.Classes__andinstances__arejust__linkednamespace__objects,with__attributescreated__onthe__flyby__assignment.Those__assignmentsusually__happenwithin__theclass__statementsyou__code,but__theycan__occuranywhere__youhave__areference__toone__ofthe__objectsin__the tree.In__fact,even__methods,normally__createdby__adef__nestedin__a class,can__becreated__completelyindependently__ofany__class object.The__following,for__example,defines__asimple__functionoutside__ofany__classthat__takesone__argument: >>>def__uppername(obj):return__obj.name.upper() #Still__needsa__selfargument__(obj)There__isnothing__abouta__classhere__yetit__sa__simple function,and__itcan__becalled__assuch__atthis__point,provided__wepass__inan__objectobj__witha__name attribute,whose__valuein__turnhas__anupper__methodour__classand__instanceshappen__tofit__theexpected__interfaceand__kickoff__stringuppercase__conversion: >>> uppername(rec), uppername(x), uppername(y) ('PAT', 'SUE', 'PAT')If__weassign__thissimple__functionto__anattribute__ofour__class, though,it__becomesa__method,callable__throughany__instance,as__wellas__throughthe__classname__itselfas__longas__wepass__inan__instancemanually__atechnique__well__leveragefurther__inthe__next chapter:2 >>> rec.method =uppername__#Now__it'sa__class's method! >>> x.method() #Run__methodto__processx__'SUE' >>> y.method() # Same,but__passy__toself__'PAT' >>> rec.method(x) #Can__callthrough__instanceor__class 'SUE' Normally,classes__arefilled__outby__class statements,and__instanceattributes__arecreated__byassignments__toself__attributesin__method functions.The__point again, though,is__thatthey__dont__haveto__be;OOP__inPython__reallyis__mostlyabout__lookingup__attributesin__linkednamespace__objects.Records__Revisited:Classes__VersusDictionaries__Althoughthe__simpleclasses__ofthe__priorsection__aremeant__toillustrate__classmodel__basics,the__techniquesthey__employcan__alsobe__usedfor__real work.For__example,Chapters__8and__9showed__howto__use dictionaries, tuples,and__liststo__recordproperties__ofentities__inour__programs,generically__called records.It__turnsout__thatclasses__canoften__servebetter__inthis__rolethey__packageinformation__like dictionaries,but__canalso__bundleprocessing__logicin__theform__of methods.For__reference,here__isan__examplefor__tuple-and__dictionary-basedrecords__weused__earlierin__thebook__(usingone__ofmany__dictionarycoding__techniques): >>>rec__= ('Pat', 40.5, ['dev', 'mgr']) # Tuple-basedrecord__>>> print(rec[0])Pat__>>>rec__= {} >>> rec['name'] = 'Pat' # Dictionary-basedrecord__>>> rec['age'] = 40.5 #Or__{...}, dict(n=v), etc. >>> rec['jobs'] = ['dev', 'mgr'] >>> >>> print(rec['name'])Pat__Aswe__just saw, though,there__arealso__multipleways__todo__thesame__with classes.Perhaps__thesimplest__isthis__tradingkeys__for attributes: >>>class__rec:pass__>>> rec.name = 'Pat' # Class-basedrecord__>>> rec.age = 40.5 >>> rec.jobs = ['dev', 'mgr'] >>> >>> print(rec.name)Pat__Thiscode__hassubstantially__lesssyntax__thanthe__dictionary equivalent.It__usesan__emptyclass__statementto__generatean__emptynamespace__object,which__wethen__fillout__byassigning__classattributes__over time,as__before.This__works,but__anew__classstatement__willbe__requiredfor__eachdistinct__recordwe__will need.Perhaps__more typically,we__caninstead__generateinstances__ofan__emptyclass__torepresent__eachdistinct__entity: >>>class__rec:pass__>>> pers1 = rec() # Instance-basedrecords__>>> pers1.name = 'Bob' >>> pers1.jobs = ['dev', 'mgr'] >>> pers1.age = 40.5 >>> >>> pers2 = rec() >>> pers2.name = 'Sue' >>> pers2.jobs = ['dev', 'cto'] >>> >>> pers1.name, pers2.name ('Bob', 'Sue') Here,we__maketwo__recordsfrom__thesame__class.Instances__startout__life empty,just__like classes.We__thenfill__inthe__recordsby__assigningto__attributes.This__time, though,there__aretwo__separate objects,and__hencetwo__separatename__attributes.In__fact,instances__ofthe__sameclass__dont__evenhave__tohave__thesame__setof__attribute names;in__this example,one__hasa__uniqueage__name.Instances__reallyare__distinct namespaces,so__eachhas__adistinct__attribute dictionary.Although__theyare__normallyfilled__outconsistently__bya__classs__methods,they__aremore__flexiblethan__youmight__expect. Finally,we__mightinstead__codea__more full-blownclass__toimplement__therecord__andits__processingsomething__that data-orienteddictionaries__donot__directly support: >>>class__Person:def____init__(self, name, jobs, age=None): #class__=data__+logic__self.name =name__self.jobs =jobs__self.age =age__def info(self):return__(self.name, self.jobs) >>> rec1 = Person('Bob', ['dev', 'mgr'], 40.5) #Construction__calls >>> rec2 = Person('Sue', ['dev', 'cto']) >>> >>> rec1.jobs, rec2.info() #Attributes__+methods__(['dev', 'mgr'], ('Sue', ['dev', 'cto']))This__schemealso__makesmultiple__instances,but__theclass__isnot__emptythis__time:we__veadded__logic (methods)to__initializeinstances__atconstruction__timeand__collectattributes__intoa__tupleon__request.The__constructorimposes__someconsistency__oninstances__hereby__alwayssetting__the name, job,and__age attributes,even__thoughthe__lattercan__beomitted__whenan__objectis__made. Together,the__classs__methodsand__instanceattributes__createa__package,which__combinesboth__dataand__logic.We__couldfurther__extendthis__codeby__addinglogic__tocompute__salaries,parse__names,and__so on. Ultimately,we__mightlink__theclass__intoa__largerhierarchy__toinherit__andcustomize__anexisting__setof__methodsvia__theautomatic__attributesearch__of classes,or__perhapseven__storeinstances__ofthe__classin__afile__withPython__objectpickling__tomake__them persistent.In__fact,we__willin__thenext__chapter,we__llexpand__onthis__analogybetween__classesand__recordswith__amore__realisticrunning__examplethat__demonstratesclass__basicsin__action.To__befair__toother__tools,in__this form,the__twopreceding__classconstruction__callsmore__closelyresemble__dictionariesmade__allat__once,but__stillseem__lesscluttered__andprovide__extraprocessing__methods.In__fact,the__classs__constructioncalls__moreclosely__resembleChapter__9s__namedtuples__whichmakes__sense,given__thatnamed__tuplesreally__areclasses__withextra__logicto__mapattributes__totuple__offsets: >>>rec__= dict(name='Pat', jobs=['dev', 'mgr'], age=40.5) #Dictionaries__>>>rec__= {'name': 'Pat', 'jobs': ['dev', 'mgr'], 'age': 40.5} #Ditto__>>>setup__code >>>rec__= Rec('Pat', ['dev', 'mgr'], 40.5) #Named__tuplesIn__the end,although__typeslike__dictionariesand__tuplesare__flexible,classes__allowus__toadd__behaviorto__objectsin__waysthat__built-intypes__andsimple__functionsdo__notdirectly__support.Although__wecan__storefunctions__indictionaries__too (e.g.,under__keyinfo__tomimic__theclass__s method),using__themto__processimplied__instancesis__nowherenear__asnatural__andstructured__asit__isin__classes,and__keylookup__hasno__notionof__inheritanceto__enable customization.But__tovet__thepurported__benefitsof__classes firsthand,you__llhave__tomove__aheadto__thenext__chapter.Chapter__SummaryThis__chapterintroduced__thebasics__ofcoding__classesin__Python.We__studiedthe__syntaxof__theclass__statementand__learnedhow__touse__itto__buildup__aclass__inheritance tree.We__alsostudied__howPython__automaticallyfills__inthe__firstargument__inmethod__functions,how__attributesare__attachedto__objectsin__aclass__treeby__simple assignment,and__howspecially__named operator-overloadingmethods__interceptand__implement built-inoperations__forour__instances (e.g.,expressions__and printing).Now__thatwe__veexplored__themechanics__ofclasses__in Python,the__nextchapter__turnsto__alarger__andmore__realisticexample__thatties__togethermuch__ofwhat__weve__learnedabout__OOPso__farand__introducessome__new topics.After__that,we__llcontinue__ourlook__atclass__coding,taking__asecond__passover__themodel__tofill__insome__ofthe__detailsthat__wereomitted__hereto__keepthings__simple. First, though,let__swork__througha__quizto__reviewthe__basicswe__vecovered__so far.Test__Your Knowledge:Quiz__1.How__areclasses__relatedto__modules? 2.How__areinstances__andclasses__created? 3.Where__andhow__areclass__attributes created? 4.Where__andhow__areinstance__attributes created? 5.What__doesself__meanin__aPython__class? 6.How__isoperator__overloadingcoded__ina__Python class? 7.When__mightyou__wantto__supportoperator__overloadingin__your classes? 8.Which__operator-overloadingmethod__ismost__commonly used? 9.What__arethe__threekey__conceptsrequired__tounderstand__PythonOOP__code?Test__Your Knowledge:Answers__1.Classes__arealways__nestedinside__a module;they__areattributes__ofa__module object.Classes__andmodules__areboth__namespaces,but__classescorrespond__tostatements__(notentire__files)and__supportthe__OOPnotions__ofmultiple__instances, inheritance,and__operatoroverloading__(modulesmostly__do not).In__a sense,a__moduleis__likea__single-instance class,without__inheritance,which__correspondsto__anentire__fileof__code. 2.Classes__aremade__byrunning__class statements;instances__arecreated__bycalling__aclass__asthough__itwere__a function. 3.Class__attributesare__createdby__assigningattributes__toa__class object.They__arenormally__generatedby__top-levelassignments__nestedin__aclass__statementeach__nameassigned__inthe__classstatement__blockbecomes__anattribute__ofthe__classobject__(technically,the__classstatement__slocal__scopemorphs__intothe__classobject__sattribute__namespace,much__likea__module).Class__attributescan__alsobe__created, though,by__assigningattributes__tothe__classanywhere__areference__tothe__classobject__existseven__outsidethe__class statement. 4.Instance__attributesare__createdby__assigningattributes__toan__instance object.They__arenormally__createdwithin__aclass__smethod__functionscoded__insidethe__class statement,by__assigningattributes__tothe__selfargument__(whichis__alwaysthe__implied instance). Again, though,they__maybe__createdby__assignmentanywhere__areference__tothe__instance appears,even__outsidethe__class statement. Usually,all__instanceattributes__areinitialized__inthe____init__constructor__method;that__way,later__methodcalls__canassume__theattributes__already exist. 5.self__isthe__namecommonly__givento__thefirst__(leftmost)argument__ina__classs__method function;Python__automaticallyfills__itin__withthe__instanceobject__thatis__theimplied__subjectof__themethod__call.This__argumentneed__notbe__calledself__(thoughthis__isa__verystrong__convention);its__positionis__whatis__significant. (Ex-C++or__Javaprogrammers__mightprefer__tocall__itthis__becausein__thoselanguages__thatname__reflectsthe__same idea;in__Python, though,this__argumentmust__alwaysbe__explicitin__methodheaders__and code.) 6.Operator__overloadingis__codedin__aPython__classwith__speciallynamed__methods;they__allbegin__andend__withdouble__underscoresto__makethem__unique.These__arenot__built-inor__reserved names;Python__justruns__themautomatically__whenan__instanceappears__inthe__corresponding operation.Python__itselfdefines__themappings__fromoperations__tospecial__method names. 7.Operator__overloadingis__usefulto__implementobjects__thatresemble__built-in__types (e.g.,sequences__ornumeric__objectssuch__as matrixes),and__tomimic__the built-intype__interfaceexpected__bya__pieceof__code.Mimicking__built-intype__interfacesenables__youto__passin__classinstances__thatalso__havestate__information (i.e.,attributes__thatremember__databetween__operation calls).You__generallyshouldn__tuse__operatoroverloading__whena__simplenamed__methodwill__suffice, though. 8.The____init__constructor__methodis__themost__commonly used;almost__everyclass__usesthis__methodto__setinitial__valuesfor__instanceattributes__andperform__otherstartup__tasks.The____str__method__(andits____repr__ sibling)is__not uncommon,but__notas__muchof__afixture__as __init__. 9.The__specialself__argumentin__method functions,the__inheritancesearch__for attributes,and__the__init____constructormethod__arethe__cornerstonesof__OOPcode__in Python.If__youget__these,you__shouldbe__ableto__readthe__textof__mostOOP__Pythoncode__apartfrom__these,it__slargely__justpackages__of functions.In__classes,self__representsthe__automaticobject__argument,and____init__is__commonlyused__toinitialize__instances. 1Not__tobe__confusedwith__the __init__.pyfiles__inmodule__packages!The__methodhere__isa__classconstructor__functionused__toinitialize__thenewly__created instance,not__anamespace__fora__module-package__folder.See__Chapter 24for__more details. 2In__fact,this__isone__ofthe__reasonsthe__selfargument__mustalways__beexplicit__inPython__methodsbecause__methodscan__becreated__assimple__functionsindependent__ofa__class,they__needto__includethe__impliedinstance__argument explicitly.They__canbe__calledas__eitherfunctions__or methods,and__Pythoncan__neitherguess__norassume__thata__simplefunction__mighteventually__becomea__classs__method.The__mainreason__forthe__explicitself__argument, though,is__tomake__themeanings__ofnames__more apparent:names__notreferenced__throughself__aresimple__variablesmapped__to scopes,while__namesreferenced__throughself__withattribute__notationare__obviouslyinstance__attributes.Chapter__28.A__MoreRealistic__ExampleWe__lldig__intomore__classsyntax__detailsin__thenext__chapter.Before__we do, though,let__stake__ashort__detourto__explorea__realisticexample__ofclasses__inaction__thats__morepractical__thanwhat__weve__seenso__far.In__this chapter,we__regoing__tobuild__aset__ofclasses__thatdo__somethingconcrete__recordingand__processinginformation__about people.As__youll__see,what__wecall__instancesand__classesin__Pythonprogramming__canoften__servethe__sameroles__asrecords__andprograms__inmore__traditional terms.The__maindifference__hereis__thecustomization__thatinheritance__will enable. Specifically,in__thischapter__were__goingto__codetwo__classes:Person__aclass__thatcreates__andprocesses__informationabout__peopleManager__acustomization__ofPerson__thatmodifies__inheritedbehavior__Alongthe__way,we__llmake__instancesof__bothclasses__andtest__outtheir__functionality.When__were__done,this__chapterwill__alsoshow__youa__niceexample__usecase__forclasses__well__storeour__instancesin__asimple__object-oriented database,to__makethem__permanent.That__way,you__canuse__thiscode__asa__templatefor__fleshingout__a full-blownpersonal__databaseof__yourown__writtenentirely__in Python.Besides__actual utility, though,our__aimhere__isalso__educational:this__chapterprovides__atutorial__on object-orientedprogramming__in Python. Often,people__graspthe__lastchapter__sclass__syntaxin__theabstract__buthave__troubleseeing__howto__getstarted__whenconfronted__withcoding__anew__classfrom__scratch.Toward__this end,we__lltake__itone__stepat__atime__here,to__helpyou__learnthe__basics;we__llbuild__upthe__classes gradually,so__youcan__seehow__theirfeatures__cometogether__incomplete__programs.In__the end,our__classeswill__stillbe__relativelysmall__interms__of code,but__theywill__demonstrateall__ofthe__mainideas__inPython__sOOP__model.Despite__itssyntax__details,Python__sclass__systemreally__islargely__justa__matterof__searchingfor__anattribute__ina__treeof__objects,along__witha__specialfirst__argumentfor__functions.Step__1:Making__Instances OK,so__muchfor__thedesign__phaselet__smove__onto__implementation.Our__firsttask__isto__startcoding__themain__class, Person.In__yourfavorite__text editor,open__anew__filefor__thecode__well__be writing.As__notedin__theprior__chapter,it__sa__fairlystrong__conventionin__Pythonto__beginmodule__nameswith__alowercase__letterand__classnames__withan__uppercase letter.Like__thename__ofself__argumentsin__methods,this__isnot__requiredby__the language,but__its__socommon__thatdeviating__mightbe__confusingto__peoplewho__laterread__your code.To__conform,we__llcall__ournew__modulefile__person.pyand__ourclass__withinit__Person,as__inExample__28-1.Example__28-1. person_1.py (start)class__Person: #Start__aclass__Were__goingto__changethis__fileas__we go.To__helpyou__keeptrack__ofits__variations,we__llappend__anexample__numberto__thefilename__in captions,and__usethat__numberboth__inthe__examplespackage__andin__launchesand__imports here.Changes__willalso__beshown__inbold__fonton__each revision.The__intentis__toshow__modsto__asingle__file,but__booksare__linear.As__notedin__theprior__chapter,we__cancode__anynumber__offunctions__andclasses__ina__singlemodule__filein__Python,and__thisone__s person.pyname__mightnot__makemuch__senseif__weadd__unrelatedcomponents__toit__later.For__now,we__llassume__everythingin__itwill__be Person-related.It__probablyshould__beanyhow__aswe__ve learned,modules__tendto__workbest__whenthey__havea__single,cohesive__purpose.Coding__Constructors Now,the__firstthing__wewant__todo__withour__Personclass__isrecord__basicinformation__aboutpeople__tofill__outrecord__fields,if__you will.Of__course,these__areknown__asinstance__objectattributes__in Python-speak,and__theygenerally__arecreated__byassignment__toself__attributesin__aclass__smethod__functions.The__normalway__togive__instanceattributes__theirfirst__valuesis__toassign__themto__selfin__the__init____constructor method,which__containscode__runautomatically__byPython__eachtime__aninstance__is created.Let__sadd__oneto__our class,in__Example 28-2.Example__28-2. person_2.py (addattribute__initialization)class__Person:def____init__(self, name, job, pay): #Constructor__takesthree__arguments self.name =name__#Fill__outfields__whencreated__self.job =job__#self__isthe__newinstance__object self.pay =pay__Thisis__avery__commoncoding__pattern:we__passin__thedata__tobe__attachedto__aninstance__asarguments__tothe__constructormethod__andassign__themto__selfto__retainthem__permanently.In__OO terms,self__isthe__newlycreated__instance object,and__name, job,and__paybecome__stateinformation__descriptivedata__savedon__anobject__forlater__use.Although__othertechniques__(suchas__enclosingscope__reference closures)can__save details, too,instance__attributesmake__thisvery__explicitand__easyto__understand.Notice__thatthe__argumentnames__appeartwice__here.This__codemight__evenseem__abit__redundantat__first,but__its__not.The__job argument,for__example,is__alocal__variablein__thescope__ofthe____init__ function,but__self.jobis__anattribute__ofthe__instancethat__sthe__impliedsubject__ofthe__method call.They__aretwo__different variables,which__happento__havethe__same name.By__assigningthe__joblocal__tothe__self.jobattribute__with self.job=job,we__savethe__passed-injob__onthe__instancefor__later use.As__usualin__Python,where__aname__is assigned,or__whatobject__itis__assigned to,determines__whatit__means.Speaking__of arguments,there__sreally__nothingmagical__about __init__,apart__fromthe__factthat__its__calledautomatically__whenan__instanceis__made,and__hasa__specialfirst__argument.Despite__itsweird__name,it__sa__normalfunction__andsupports__allthe__featuresof__functionswe__vealready__covered.We__can,for__example,provide__defaultsfor__someof__its arguments,so__theyneed__notbe__providedin__caseswhere__theirvalues__arent__availableor__useful.To__demonstrate,let__smake__thejob__argumentoptional__itwill__defaultto__None,meaning__theperson__beingcreated__isnot__(currently?) employed.If__jobdefaults__to None,we__llprobably__wantto__defaultpay__to 0, too,for__consistency (unlesssome__ofthe__peopleyou__knowmanage__toget__paidwithout__having jobs).In__fact,we__haveto__specifya__defaultfor__paybecause__accordingto__Pythons__syntaxrules__andChapter__18,any__argumentsin__afunction__sheader__afterthe__firstdefault__mustall__have defaults, too.Example__28-3codes__the mod.Example__28-3. person_3.py (addconstructor__defaults)class__Person:def____init__(self, name, job=None, pay=0): #Normal__functionargs__self.name =name__self.job =job__self.pay =pay__Whatthis__codemeans__isthat__well__needto__passin__aname__whenmaking__Persons,but__joband__payare__now optional;they__lldefault__toNone__and 0if__omitted.The__self argument,as__usual,is__filledin__byPython__automaticallyto__referto__theinstance__objectassigning__valuesto__attributesof__selfattaches__themto__thenew__instance.Testing__asYou__GoThis__classdoesn__tdo__muchyet__itessentially__justfills__outthe__fieldsof__anew__recordbut__its__areal__working class.At__this point,we__couldadd__morecode__toit__formore__features,but__wewon__tdo__that yet.As__youve__probablybegun__toappreciate__already,programming__inPython__isreally__amatter__ofincremental__prototypingyou__writesome__code,test__it,write__more code,test__again,and__so on.Because__Pythonprovides__bothan__interactivesession__andnearly__immediateturnaround__aftercode__changes,it__smore__naturalto__testas__yougo__thanto__writea__hugeamount__ofcode__totest__allat__once.Before__addingmore__features, then,let__stest__whatwe__vegot__sofar__bymaking__afew__instancesof__ourclass__anddisplaying__theirattributes__ascreated__bythe__constructor.We__coulddo__this interactively,but__asyou__vealso__probablysurmised__by now,interactive__testinghas__itslimits__itgets__tediousto__haveto__reimportmodules__andretype__testcases__eachtime__youstart__anew__testing session.More__commonly,Python__programmersuse__theinteractive__promptfor__simple one-offtests__butdo__moresubstantial__testingby__writingcode__atthe__bottomof__thefile__thatcontains__theobjects__tobe__tested,as__inExample__28-4.Example__28-4. person_4.py (addincremental__self-test code)class__Person:def____init__(self, name, job=None, pay=0): self.name =name__self.job =job__self.pay =pay__bob = Person('Bob Smith') #Test__theclass__sue = Person('Sue Jones', job='dev', pay=100000) #Runs____init__automatically__print(bob.name, bob.pay) #Fetch__attachedattributes__print(sue.name, sue.pay) # sue'sand__bob'sattrs__differNotice__herethat__thebob__objectaccepts__thedefaults__forjob__and pay,but__sueprovides__values explicitly. Also,note__howwe__usekeyword__argumentswhen__making sue;we__couldpass__byposition__instead,but__thekeywords__mayhelp__remindus__laterwhat__thedata__is,and__theyallow__usto__passthe__argumentsin__any left-to-rightorder__we like. Again,despite__itsunusual__name,__init____isa__normal function,supporting__everythingyou__alreadyknow__aboutfunctions__includingboth__defaultsand__pass-by-namekeyword__arguments.When__thisfile__runsas__a script,the__testcode__atthe__bottommakes__twoinstances__ofour__classand__printstwo__attributesof__eachname__and pay: $ python3 person_4.pyBob__Smith 0Sue__Jones 100000You__canalso__typethis__files__testcode__atPython__sinteractive__prompt (assumingyou__importthe__Personclass__there first),but__codingcanned__testsinside__themodule__filelike__thismakes__itmuch__easierto__rerunthem__inthe__future.Although__thisis__fairlysimple__code,it__salready__demonstratingsomething__important.Notice__thatbob__sname__isnot__sue s,and__sues__payis__notbob__s.Each__isan__independentrecord__of information. Technically,bob__andsue__areboth__namespaceobjects__likeall__class instances,they__eachhave__theirown__independentcopy__ofthe__stateinformation__createdby__the class.Because__eachinstance__ofa__classhas__itsown__setof__self attributes,classes__area__naturalfor__recordinginformation__formultiple__objectsthis__way;just__like built-intypes__suchas__listsand__dictionaries,classes__serveas__asort__ofobject__factory.Other__Pythonprogram__structures,such__asfunctions__and modules,have__nosuch__concept.Chapter__17s__closurefunctions__comeclose__interms__of per-callstate__butdon__thave__themultiple__methods, inheritance,and__largerstructure__weget__from classes.Using__CodeTwo__WaysAs__is,the__testcode__atthe__bottomof__thefile__works,but__theres__abig__catchits__top-levelprint__statementsrun__bothwhen__thefile__isrun__asa__scriptand__whenit__isimported__asa__module.This__meansif__weever__decideto__importthe__classin__thisfile__inorder__touse__itsomewhere__else (andwe__willsoon__inthis__chapter),we__llsee__theoutput__ofits__testcode__everytime__thefile__is imported.That__snot__verygood__software citizenship, though:client__programsprobably__dont__careabout__ourinternal__testsand__wont__wantto__seeour__outputmixed__inwith__their own.Although__wecould__splitthe__testcode__offinto__aseparate__file,it__soften__moreconvenient__tocode__testsin__thesame__fileas__theitems__tobe__tested.It__wouldbe__betterto__arrangeto__runthe__teststatements__atthe__bottomonly__whenthe__fileis__runfor__testing,not__whenthe__fileis__imported.As__linearreaders__ofthis__bookhave__already learned,that__sexactly__whatthe__module__name____checkis__designed for.Example__28-5shows__whatthis__additionlooks__likesimply__addthe__requiredtest__andindent__your self-test code.Example__28-5. person_5.py (supportboth__importsand__run/tests)class__Person:def____init__(self, name, job=None, pay=0): self.name =name__self.job =job__self.pay =pay__if__name____== '__main__': #When__runfor__testingonly__bob = Person('Bob Smith')sue__= Person('Sue Jones', job='dev', pay=100000) print(bob.name, bob.pay) print(sue.name, sue.pay) Now,we__getexactly__thebehavior__were__afterrunning__thefile__asa__top-levelscript__testsit__becauseits____name__is____main__,but__importingit__asa__libraryof__classeslater__does not: $ python3 person_5.pyBob__Smith 0Sue__Jones 100000 $ python3 >>>import__person_5 >>>When__imported,the__filenow__definesthe__classbut__doesnot__use it.When__run directly,this__filecreates__twoinstances__ofour__classas__before,and__printstwo__attributesof__each; again,because__eachinstance__isan__independentnamespace__object,the__valuesof__theirattributes__differ.Step__2:Adding__BehaviorMethods__Everythinglooks__goodso__farat__this point,our__classis__essentiallya__record factory;it__createsand__fillsout__fieldsof__records (attributesof__instances,in__Pythonic terms).Even__aslimited__asit__is, though,we__canstill__runsome__operationson__its objects.Although__classesadd__anextra__layerof__structure,they__ultimatelydo__mostof__theirwork__byembedding__andprocessing__coreobject__typeslike__listsand__strings.In__other words,if__youalready__knowhow__touse__Pythons__simplecore__objects,you__alreadyknow__muchof__thePython__class story;classes__arereally__justa__minorstructural__extension.For__example,the__namefield__ofour__objectsis__asimple__string,so__wecan__extractlast__namesfrom__ourobjects__bysplitting__onspaces__and indexing.These__areall__core-object operations,which__workwhether__theirsubjects__areembedded__inclass__instancesor__not: >>>name__= 'Bob Smith' #Simple__string,outside__class >>> name.split() #Extract__lastname__['Bob', 'Smith'] >>> name.split()[-1] #Or__[1],if__alwaysjust__twoparts__'Smith' Similarly,we__cangive__anobject__apay__raiseby__updatingits__payfield__that is,by__changingits__stateinformation__inplace__withan__assignment.This__taskalso__involvesbasic__operationsthat__workon__Pythons__core objects,regardless__ofwhether__theyare__standaloneor__embeddedin__aclass__structure (formattinghere__masksany__extraneous digits): >>>pay__= 100000 #Simple__variable,outside__class >>>pay__*= 1.10 #Give__a 10%raise__>>> print(f'{pay:,.2f}') # Or:pay__=pay__* 1.10,if__youlike__totype__110,000.00 # Or:pay__=pay__+ (pay * .10),if__youreally__doTo__applythese__operationsto__thePerson__objectscreated__byour__script,simply__doto__bob.nameand__sue.paywhat__wejust__didto__nameand__pay,as__listedin__Example 28-6.The__operationsare__the same,but__thesubjects__areattached__asattributes__toobjects__createdfrom__our class.Example__28-6. person_6.py (processembedded__built-in objects)class__Person:def____init__(self, name, job=None, pay=0): self.name =name__self.job =job__self.pay =pay__if__name____== '__main__':bob__= Person('Bob Smith')sue__= Person('Sue Jones', job='dev', pay=100000) print(bob.name, bob.pay) print(sue.name, sue.pay) print(bob.name.split()[-1]) #Extract__object'slast__name sue.pay *= 1.10 #Give__thisobject__araise__print(f'{sue.pay:,.2f}')We__veadded__thelast__threelines__here;when__theyre__run,we__extractbob__slast__nameby__usingbasic__stringand__listoperations__onhis__name field,and__givesue__apay__raiseby__modifyingher__payattribute__inplace__withbasic__number operations.In__a sense,sue__isalso__amutable__objecther__statechanges__inplace__justlike__alist__afteran__append call.Here__sthe__newversion__soutput__whenrun__asa__top-level script: $ python3 person_6.pyBob__Smith 0Sue__Jones 100000Smith__110,000.00The__precedingcode__worksas__planned,but__ifyou__showit__toa__veteransoftware__developerhe__orshe__willprobably__tellyou__thatits__generalapproach__isnot__agreat__ideain__practice.Hardcoding__operationslike__theseoutside__ofthe__classcan__leadto__maintenanceproblems__inthe__future.For__example,what__ifyou__vehardcoded__the last-name-extractionformula__atmany__differentplaces__inyour__program?If__youever__needto__changethe__wayit__works (tosupport__anew__name structure,for__instance),you__llneed__tohunt__downand__updateevery__occurrence. Similarly,if__the pay-raisecode__everchanges__(e.g.,to__requireapproval__ordatabase__updates),you__mayhave__multiplecopies__to modify.Just__findingall__theappearances__ofsuch__codemay__beproblematic__inlarger__programsthey__maybe__scatteredacross__manyfiles__and folders,split__intoindividual__steps,and__so on.In__aprototype__like this,frequent__changeis__almost guaranteed.Coding__MethodsWhat__wereally__wantto__dohere__isemploy__asoftware__designconcept__knownas__encapsulationwrapping__upoperation__logicbehind__interfaces,such__thateach__operationis__codedonly__oncein__our program.That__way,if__ourneeds__changein__the future,there__isjust__onecopy__to update. Moreover,we__refree__tochange__thesingle__copys__internalsalmost__arbitrarily,without__breakingthe__codethat__uses it.In__Python terms,we__wantto__codeoperations__onobjects__ina__classs__methods,instead__oflittering__themthroughout__our program.In__fact,this__isone__ofthe__thingsthat__classesare__verygood__atfactoring__codeto__removeredundancy__andthus__optimize maintainability.As__anadded__bonus,turning__operationsinto__methodsenables__themto__beapplied__toany__instanceof__the class,not__justthose__thatthey__vebeen__hardcodedto__process.This__isall__simplerin__codethan__itmay__soundin__theory.Example__28-7achieves__encapsulationby__movingthe__twooperations__fromcode__outsidethe__classto__methodsinside__the class.While__were__at it,let__schange__our self-testcode__atthe__bottomto__usethe__newmethods__were__creating,instead__ofhardcoding__operations.Example__28-7. person_7.py (addmethods__toencapsulate__operations)class__Person:def____init__(self, name, job=None, pay=0): self.name =name__self.job =job__self.pay =pay__def lastName(self): #Behavior__methodsreturn__self.name.split()[-1] #self__isimplied__subjectdef__giveRaise(self, percent): self.pay = int(self.pay * (1 + percent)) #Must__changehere__onlyif____name__ == '__main__':bob__= Person('Bob Smith')sue__= Person('Sue Jones', job='dev', pay=100000) print(bob.name, bob.pay) print(sue.name, sue.pay) print(bob.lastName(), sue.lastName()) #Use__thenew__methods sue.giveRaise(.10) #instead__ofhardcoding__print(sue.pay)As__weve__learned,methods__aresimply__normalfunctions__thatare__attachedto__classesand__designedto__processinstances__ofthose__classes.The__instanceis__thesubject__ofthe__methodcall__andis__passedto__themethod__sself__argument automatically.The__transformationto__themethods__inthis__versionis__straightforward.The__newlastName__method,for__example,simply__doesfor__selfwhat__theprevious__versionhardcoded__for bob,because__selfis__theimplied__subjectwhen__themethod__is called.lastName__alsoreturns__theresult__becausethis__operationis__acalled__function now;it__computesa__valuefor__itscaller__touse__arbitrarily,even__ifit__isjust__tobe__printed. Similarly,the__newgiveRaise__methodjust__doesfor__selfwhat__wedid__forsue__before.When__run now,our__files__outputis__similarto__beforewe__vemostly__justrefactored__thecode__toallow__foreasier__changesin__thefuture__(commandlines__thatrun__themost__recentmod__areoften__omittedfrom__hereon__for space):Bob__Smith 0Sue__Jones 100000Smith__Jones 110000A__fewcoding__detailsare__worthpointing__out here. First,notice__thatsue__spay__isnow__stillan__integerafter__apay__raisewe__convertthe__mathresult__backto__aninteger__bycalling__theint__built-inwithin__the method.Changing__thevalue__toeither__intor__floatis__probablynot__asignificant__concernfor__this demo:integer__and floating-pointobjects__havethe__sameinterfaces__andcan__bemixed__within expressions. Still,we__mayneed__toaddress__truncationand__roundingissues__ina__realsystem__moneyprobably__issignificant__to Persons!As__coveredin__Chapter 5,we__mighthandle__thisby__usingthe__round(N, 2) built-in__toround__andretain__cents,using__thedecimal__typeto__fix precision,or__storingmonetary__valuesas__full floating-pointnumbers__anddisplaying__themwith__aformatting__stringto__showcents__aswe__did earlier.For__now,we__llsimply__truncateany__centswith__int. Second,notice__thatwe__realso__printingsue__slast__namethis__timebecause__the last-namelogic__hasbeen__encapsulatedin__a method,we__getto__useit__onany__instanceof__the class.As__weve__seen,Python__tellsa__methodwhich__instanceto__processby__automaticallypassing__itin__tothe__first argument,usually__called self. Specifically:In__thefirst__call, bob.lastName(),bob__isthe__impliedsubject__passedto__self.In__thesecond__call, sue.lastName(),sue__goesto__self instead.Trace__throughthese__callsto__seehow__theinstance__windsup__inself__its__akey__concept.The__neteffect__isthat__themethod__fetchesthe__nameof__theimplied__subjecteach__time.The__samehappens__for giveRaise.We__could,for__example,give__boba__raiseby__callinggiveRaise__forboth__instancesthis__way, too.Unfortunately__for bob, though,his__zerostarting__paywill__preventhim__fromgetting__araise__asthe__programis__currentlycoded__nothingtimes__anythingis__nothing,something__wemay__wantto__addressin__afuture__2.0release__ofour__software. Finally,notice__thatthe__giveRaisemethod__assumesthat__percentis__passedin__asa__floating-pointnumber__betweenzero__and one.That__maybe__tooradical__anassumption__inthe__realworld__(a 1,000%raise__wouldprobably__bea__bugfor__mostof__us!);we__lllet__itpass__forthis__prototype,but__wemight__wantto__testor__atleast__documentthis__ina__futureiteration__ofthis__code.Stay__tunedfor__arehash__ofthis__ideain__later chapters,where__well__explorefunction__decoratorsand__Pythons__assertstatement__asalternatives__thatcan__dothe__validitytest__forus__automaticallyduring__development.In__Chapter 39,for__example,we__llwrite__atool__thatlets__usvalidate__withstrange__incantationslike__the following: @rangetest(percent=(0.0, 1.0)) #Use__decoratorto__validatedef__giveRaise(self, percent): self.pay = int(self.pay * (1 + percent))Step__3:Operator__OverloadingAt__this point,we__havea__fairly full-featuredclass__thatgenerates__andinitializes__instances,along__withtwo__newbits__ofbehavior__forprocessing__instancesin__theform__of methods.So__far,so__good.As__it stands, though,testing__isstill__abit__lessconvenient__thanit__needsto__beto__traceour__objects,we__haveto__manuallyfetch__andprint__individualattributes__(e.g., bob.name, sue.pay).It__wouldbe__niceif__displayingan__instanceall__atonce__actuallygave__ussome__useful information. Unfortunately,the__defaultdisplay__formatfor__aninstance__objectisn__tvery__goodit__displaysthe__objects__classname__andits__addressin__memory (whichis__essentiallyuseless__in Python,except__asa__unique identifier).To__see this,change__thelast__linein__thelatest__versionof__ourscript__to print(sue)so__itdisplays__theobject__asa__whole.Here__swhat__youll__getas__coded,the__outputsays__thatsue__isan__object,but__notmuch__more:Bob__Smith 0Sue__Jones 100000Smith__Jones <__main__.Personobject__at 0x104972630>Providing__PrintDisplays__Fortunately,it__seasy__todo__betterby__employingoperator__overloadingcoding__methodsin__aclass__thatintercept__andprocess__built-inoperations__whenrun__onthe__classs__instances. Specifically,we__canmake__useof__whatare__probablythe__secondmost__commonlyused__operator-overloadingmethods__in Python,after____init__:the____repr__method__well__deploy here,and__its__str____twinintroduced__inthe__preceding chapter.These__methodsare__runautomatically__everytime__aninstance__isconverted__toits__print string.Because__thats__whatprint__normally does,the__nettransitive__effectis__thatprinting__anobject__displayswhatever__isreturned__bythe__objects____str__or____repr__ method,if__theobject__eitherdefines__oneitself__orinherits__onefrom__a superclass. Double-underscorednames__areinherited__justlike__any other. Technically,__str____ispreferred__byprint__and str,and____repr__is__usedboth__asa__fallbackfor__these,as__wellas__byinteractive__echoesand__nested appearances.Although__thetwo__canbe__usedto__implementdifferent__displaysin__differentcontexts__(e.g., user-or__developer-focused),coding____repr__alone__sufficesto__givea__singledisplay__inall__cases.This__allowsclients__toprovide__analternative__displaywith____str__,though__thisis__amoot__pointfor__this demo.The____init__constructor__methodwe__vealready__coded is,strictly__speaking,operator__overloadingtoo__itis__runautomatically__atconstruction__timeto__initializea__newlycreated__instance.Constructors__areso__common, though,that__theyalmost__seemlike__aspecial__case.More__focusedmethods__like__repr____allowus__totap__intospecific__operationsand__providespecialized__behaviorwhen__ourobjects__areused__inthose__contexts.Let__sput__thisinto__code.Example__28-8extends__ourclass__togive__acustom__displaythat__listsattributes__whenour__classs__instancesare__displayedas__a whole,instead__ofrelying__onthe__lessuseful__default display.Example__28-8. person_8.py (add__repr____overloadmethod__for displays)class__Person:def____init__(self, name, job=None, pay=0): self.name =name__self.job =job__self.pay =pay__def lastName(self):return__self.name.split()[-1]def__giveRaise(self, percent): self.pay = int(self.pay * (1 + percent))def____repr__(self): #Added__methodreturn__f'[Person: {self.name} ${self.pay:,}]' #String__toprint__if__name____== '__main__':bob__= Person('Bob Smith')sue__= Person('Sue Jones', job='dev', pay=100000) print(bob) print(sue) print(bob.lastName(), sue.lastName()) sue.giveRaise(.10) print(sue)Notice__thatwe__redoing__f-stringformatting__tobuild__thedisplay__stringin____repr__ here,with__commaseparators__for pay;at__the bottom,classes__use built-in__operationslike__theseto__gettheir__work done. Again,everything__youve__alreadylearned__aboutboth__built-inobjects__and user-definedfunctions__appliesto__class-based__code.Classes__largelyjust__addan__additionallayer__ofstructure__thatpackages__functionsand__datatogether__andsupports__extensions.We__vealso__changedour__self-testcode__toprint__objects directly,instead__ofprinting__individual attributes.When__run,the__outputis__moreuniform__now;the__[ ]lines__arereturned__by __repr__,run__automaticallyby__print operations: [Person:Bob__Smith $0] [Person:Sue__Jones $100,000]Smith__Jones [Person:Sue__Jones $110,000]Step__4:Customizing__Behaviorby__SubclassingAt__this point,our__classcaptures__muchof__theOOP__machineryin__Python:it__makes instances,provides__behaviorin__methods,and__evendoes__abit__ofoperator__overloadingnow__tointercept__printoperations__in __repr__.It__effectivelypackages__ourdata__andlogic__togetherinto__a single, self-containedsoftware__component,making__iteasy__tolocate__codeand__straightforwardto__changeit__inthe__future.By__allowingus__toencapsulate__behavior,it__alsoallows__usto__factorthat__codeto__avoidredundancy__andits__associatedmaintenance__headaches.The__onlymajor__OOPconcept__itdoes__notyet__captureis__customizationby__inheritance.In__some sense,we__realready__doing inheritance,because__instancesinherit__methodsfrom__their classes.To__demonstratethe__realpower__of OOP, though,we__needto__definea__superclass/subclassrelationship__thatallows__usto__extendour__softwareand__replacebits__ofinherited__behavior.That__sthe__mainidea__behind OOP,after__all;by__fosteringa__codingmodel__basedupon__customizationof__workalready__done,it__candramatically__cutdevelopment__timewhen__used well.Coding__SubclassesAs__anext__step, then,let__sput__OOPs__methodologyto__useand__customizeour__Personclass__byextending__oursoftware__hierarchy.For__thepurpose__ofthis__tutorial,we__lldefine__asubclass__ofPerson__calledManager__thatreplaces__theinherited__giveRaisemethod__witha__morespecialized__version.Our__newclass__beginsas__follows:class__Manager(Person): #Define__asubclass__ofPerson__Thiscode__meansthat__were__defininga__newclass__named Manager,which__inheritsfrom__andmay__addcustomizations__tothe__superclass Person.In__plain terms,a__Manageris__almostlike__aPerson__(admittedly,a__verylong__journeyfor__avery__small joke),but__Managerhas__acustom__wayto__give raises.1For__thesake__of argument,let__sassume__thatwhen__aManager__getsa__raise,it__receivesthe__passed-inpercentage__as usual,but__alsogets__anextra__bonusthat__defaultsto__10%.For__instance,if__aManager__sraise__isspecified__as 10%,it__willreally__get 20%. (Anyrelation__toPersons__livingor__dead is,of__course,strictly__coincidental.)Our__newmethod__beginsas__follows;because__thisredefinition__ofgiveRaise__willbe__closerin__theclass__treeto__Managerinstances__thanthe__originalversion__in Person,it__effectively replaces,and__thereby customizes,the__operation.Recall__thataccording__tothe__inheritancesearch__rules,the__lowestversion__ofthe__namewins__(well__addthis__codeto__thefile__ina__moment):class__Manager(Person): #Inherit__Personattrs__def giveRaise(self, percent, bonus=.10): #Redefine__tocustomize__Augmenting Methods:The__BadWay__Now,there__aretwo__wayswe__mightcode__thisManager__customization:a__goodway__anda__bad way.Let__sstart__withthe__badway__sinceit__mightbe__abit__easierto__understand.The__badway__isto__cutand__pastethe__codeof__giveRaisein__Personand__modifyit__for Manager,like__this:class__Manager(Person):def__giveRaise(self, percent, bonus=.10): self.pay = int(self.pay * (1 +percent__+ bonus)) # Bad:cut__andpaste__Thiswould__workas__advertisedwhen__welater__callthe__giveRaisemethod__ofa__Manager instance,it__wouldrun__thiscustom__version,which__tackson__theextra__bonus.So__whats__wrongwith__somethingthat__runs correctly?The__problemhere__isa__verygeneral__one:anytime__youcopy__codewith__cutand__paste,you__essentiallydouble__yourmaintenance__effortin__the future.Think__about it:because__wecopied__theoriginal__version,if__weever__haveto__changethe__wayraises__aregiven__(andwe__probably will),we__llhave__tochange__thecode__intwo__places,not__one.Although__thisis__asmall__andartificial__example,it__salso__representativeof__auniversal__issueanytime__youre__temptedto__programby__copyingcode__this way,you__probablywant__tolook__fora__better approach.Augmenting__Methods:The__GoodWay__Whatwe__reallywant__todo__hereis__somehowaugment__theoriginal__giveRaise,instead__ofreplacing__it altogether.The__goodway__todo__thatin__Pythonis__bycalling__tothe__originalversion__directly,with__augmented arguments,like__this:class__Manager(Person):def__giveRaise(self, percent, bonus=.10): Person.giveRaise(self,percent__+ bonus) # Good:augment__originalThis__codeleverages__thefact__thata__classs__methodcan__alwaysbe__calledeither__throughan__instance (theusual__way,where__Pythonsends__theinstance__tothe__selfargument__automatically)or__throughthe__class (theless__common scheme,where__youmust__passthe__instance manually).In__moresymbolic__terms,a__normalmethod__callof__this form: instance.method(args )is__automaticallytranslated__byPython__intothis__equivalent form: class.method(instance,args__)where__theclass__containingthe__methodto__berun__isdetermined__bythe__inheritancesearch__ruleapplied__tothe__methods__name.You__cancode__eitherform__inyour__script,but__thereis__aslight__asymmetrybetween__thetwo__youmust__rememberto__passalong__theinstance__manuallyif__youcall__throughthe__class directly.The__methodalways__needsa__subjectinstance__oneway__or another,and__Pythonprovides__itautomatically__onlyfor__callsmade__throughan__instance.For__callsthrough__theclass__name,you__needto__sendan__instanceto__self yourself;and__forcode__insidea__methodlike__giveRaise,self__alreadyis__thesubject__ofthe__call,and__hencethe__instanceto__pass along.Calling__throughthe__classdirectly__effectivelysubverts__inheritanceand__kicksthe__callhigher__upthe__classtree__torun__aspecific__version.In__our case,we__canuse__thistechnique__toinvoke__thedefault__giveRaisein__Person,even__thoughit__sbeen__redefinedat__theManager__level.In__fact,we__mustcall__throughPerson__this way,because__a self.giveRaise()inside__Managers__giveRaisecode__wouldloop__sinceself__alreadyis__a Manager, self.giveRaise()would__resolveagain__toManager__s giveRaise,and__so on, recursively,until__availablememory__is exhausted.Call__syntax aside,this__goodversion__mayseem__likea__smalldifference__in code,but__itcan__makea__hugedifference__forfuture__codemaintenance__becausethe__giveRaiselogic__livesin__justone__placenow__(Persons__method),we__haveonly__oneversion__tochange__inthe__futureas__needs evolve.And__really,this__formcaptures__ourintent__moredirectly__anyhowwe__wantto__performthe__standardgiveRaise__operation,but__simplytack__onan__extra bonus.Example__28-9lists__ourentire__modulefile__withthis__step applied.Example__28-9. person_9.py (addmethod__customizationin__a subclass)class__Person:def____init__(self, name, job=None, pay=0): self.name =name__self.job =job__self.pay =pay__def lastName(self):return__self.name.split()[-1]def__giveRaise(self, percent): self.pay = int(self.pay * (1 + percent))def____repr__(self):return__f'[Person: {self.name} ${self.pay:,}]'class__Manager(Person):def__giveRaise(self, percent, bonus=.10): #Redefine__atthis__level Person.giveRaise(self,percent__+ bonus) #Call__Person'sversion__if__name____== '__main__':bob__= Person('Bob Smith')sue__= Person('Sue Jones', job='dev', pay=100000) print(bob) print(sue) print(bob.lastName(), sue.lastName()) sue.giveRaise(.10) print(sue)pat__= Manager('Pat Jones', 'mgr', 50000) #Make__a Manager:__init____pat.giveRaise(.10) #Runs__customversion__print(pat.lastName()) #Runs__inheritedmethod__print(pat) #Runs__inherited__repr____Totest__ourManager__subclass customization,we__vealso__added self-testcode__thatmakes__a Manager,calls__its methods,and__prints it.When__wemake__a Manager,we__passin__a name,and__anoptional__joband__payas__beforebecause__Managerhad__no__init____constructor,it__inheritsthat__in Person.Here__sthe__newversion__s output: [Person:Bob__Smith $0] [Person:Sue__Jones $100,000]Smith__Jones [Person:Sue__Jones $110,000]Jones__[Person:Pat__Jones $60,000]Everything__looksgood__here:bob__andsue__areas__before,and__whenpat__theManager__isgiven__a 10% raise,he__orshe__reallygets__20% (paygoes__from $50Kto__$60K),because__thecustomized__giveRaisein__Manageris__runfor__thisperson__only.Also__noticehow__printingpat__asa__wholeat__theend__ofthe__testcode__displaysthe__niceformat__definedin__Persons____repr__:Manager__objectsget__this, lastName,and__the__init____constructormethod__scode__forfree__from Person,by__inheritance.THE__SUPERALTERNATIVE__Toextend__inherited methods,the__examplesin__thischapter__simplycall__theoriginal__throughthe__superclass name: Person.giveRaise( ).This__isthe__explicit, traditional,and__simplestscheme__in Python,and__theone__usedin__mostof__this book.It__alsofollows__thesame__patternwe__llcode__toaccess__class attributes:names__attachedto__aclass__andshared__byall__instances,introduced__ahead.Methods__arejust__callableclass__attributes.Java__programmersmay__especiallybe__interestedto__knowthat__Pythonalso__hasa__super built-infunction__thatallows__callingback__toa__superclasss__methodsmore__generically.In__thecustom__giveRaiseof__Example 28-9s__Manager class,both__ofthe__followingwould__workthe__same way: Person.giveRaise(self,percent__+ bonus) # Explicit,general__use super().giveRaise(percent + bonus) # Implicit,special__caseThe__super built-in, however,relies__onunusual__semantics;works__unevenlywith__Pythons__operator overloading;and__doesnot__alwaysmesh__wellwith__multiple inheritance,where__asingle__methodcall__maynot__suffice.It__sa__special-casetool__witha__single role,which__isredundant__withgeneral__class-name__references.In__its defense,the__supercall__hasa__validrole__toocooperative__same-namedmethod__dispatchin__multipleinheritance__treesbut__thisrelies__onthe__MROclass__orderingof__Chapter 31,which__manyfind__artificial;requires__universaldeployment__tobe__used reliably;does__notfully__supportmethod__replacementand__varyingargument__lists;and__tomany__observersseems__anesoteric__solutionto__arole__thatis__rarein__realPython__code.Because__ofthese__downsides,this__bookprefers__tocall__superclassesby__explicitname__insteadof__super,recommends__thesame__policyfor__newcomers,and__deferspresenting__superuntil__Chapter 32.You__reof__coursefree__todraw__yourown__conclusions there,but__superis__usuallybest__hadafter__youlearn__thesimpler__andmore__explicitways__ofachieving__thesame__goalsin__Python,especially__ifyou__renew__to OOP.Topics__likecooperative__multiple-inheritance__dispatchare__alot__todigest__forbeginners__andexperts__alike.And__toany__Javaprogrammers__inthe__audience:try__resistingthe__temptationto__usePython__ssuper__untilyou__vehad__achance__tostudy__itssubtle__implications.This__callis__benignin__single-inheritanceof__thesort__youre__used to,but__onceyou__stepup__toPython__smultiple__inheritance,super__isnot__whatyou__thinkit__is,and__morethan__youprobably__expect.The__classit__pickscan__varyper__context,and__maynot__evenbe__asuperclass__at all!Polymorphism__inAction__Tomake__thisacquisition__ofinherited__behavioreven__more striking,add__thefollowing__codeat__theend__ofour__filetemporarily__(thisis__file person_9_plus.pyin__theexamples__package,but__doesnt__warranta__fulllisting__orcaption__here):if____name__ == '__main__': print('--All three--')for__objin__(bob, sue, pat): #Process__objectsgenerically__obj.giveRaise(.10) #Run__this object'sgiveRaise__print(obj) #Run__thecommon____repr__Here__sthe__resulting output,showing__justits__newparts__(andthe__accumulatedeffects__oftwo__raisesper__person): --All three-- [Person:Bob__Smith $0] [Person:Sue__Jones $121,000] [Person:Pat__Jones $72,000]In__theadded__code,object__iseither__aPerson__ora__Manager,and__Pythonruns__theappropriate__giveRaiseautomatically__ouroriginal__versionin__Personfor__boband__sue,and__ourcustomized__versionin__Managerfor__pat.Trace__themethod__callsyourself__tosee__howPython__selectsthe__rightgiveRaise__methodfor__each object.This__isjust__Pythons__notionof__polymorphism,which__wemet__earlierin__the book,at__workagain__whatgiveRaise__doesdepends__onwhat__youdo__it to. Here,it__smade__allthe__moreobvious__whenit__selectsfrom__codewe__vewritten__ourselvesin__classes.The__practicaleffect__inthis__codeis__thatsue__getsanother__10%but__patgets__another 20%because__giveRaiseis__dispatchedbased__onthe__objects__type.As__weve__seen,polymorphism__isat__theheart__ofPython__s flexibility.Passing__anyof__ourthree__objectsto__afunction__thatcalls__agiveRaise__method,for__example,would__havethe__same effect:the__appropriateversion__wouldbe__run automatically,depending__onwhich__typeof__objectwas__passed.On__theother__hand,printing__runsthe__same__repr____forall__three objects,because__its__codedjust__oncein__Person.Manager__bothspecializes__andapplies__thecode__weoriginally__wrotein__Person.Although__thisexample__is small,it__salready__leveragingOOP__stalent__forcode__customizationand__reuse;with__classes,this__almostseems__automaticat__times. Inherit, Customize,and__ExtendIn__fact,classes__canbe__evenmore__flexiblethan__ourexample__implies.In__general,classes__can inherit, customize,or__extendexisting__codein__superclasses.For__example,although__were__focusedon__customization here,we__canalso__addunique__methodsto__Managerthat__arenot__presentin__Person,if__Managersrequire__something different.The__followingabstract__snippet illustrates. Here,giveRaise__redefinesa__superclasss__methodto__customize it,but__someThingElsedefines__somethingnew__to extend:class__Person:def__lastName(self):def__giveRaise(self):def____repr__(self):class__Manager(Person): #Inherit__def giveRaise(self, ): #Customize__def someThingElse(self, ): #Extend__pat = Manager() pat.lastName() #Inherited__verbatim pat.giveRaise() #Customized__version pat.someThingElse() #Extension__here print(pat) #Inherited__overloadmethod__Extramethods__likethis__codes__someThingElseaugment__theexisting__softwareand__areavailable__onManager__objects only,not__on Persons.For__thepurposes__ofthis__tutorial, however,we__lllimit__ourscope__tocustomizing__someof__Persons__behaviorby__redefining it,not__addingto__it. OOP:The__BigIdea__As is,our__codemay__be small,but__its__fairly functional.And__really,it__alreadyillustrates__themain__pointbehind__OOPin__general:in__OOP,we__programby__customizingwhat__hasalready__been done,rather__thancopying__orchanging__existing code.This__isnt__alwaysan__obviouswin__tonewcomers__atfirst__glance,especially__giventhe__extracoding__requirementsof__classes.But__overall,the__programmingstyle__impliedby__classescan__cutdevelopment__timeradically__comparedto__other approaches.For__instance,in__ourexample__wecould__theoreticallyhave__implementeda__customgiveRaise__operationwithout__subclassing,but__noneof__theother__optionsyield__codeas__optimalas__ours:Although__wecould__havesimply__codedManager__fromscratch__as new,independent__code,we__wouldhave__hadto__reimplementall__thebehaviors__inPerson__thatare__thesame__for Managers.Although__wecould__havesimply__changedthe__existingPerson__classin__placefor__therequirements__ofManager__s giveRaise,doing__sowould__breakcode__thatstill__needsthe__originalPerson__behavior.Although__wecould__havesimply__copiedthe__Personclass__inits__entirety,renamed__thecopy__to Manager,and__changedits__giveRaise,doing__sowould__introducecode__redundancythat__woulddouble__ourwork__inthe__futurechanges__madeto__Personin__thefuture__wouldnot__bepicked__up automatically,but__wouldhave__tobe__manuallypropagated__toManager__s code.As__usual,the__cut-and-pasteapproach__mayseem__quick now,but__itdoubles__yourwork__inthe__future.The__customizablehierarchies__wecan__buildwith__classesprovide__amuch__bettersolution__forsoftware__thatwill__evolveover__time.No__othertools__inPython__supportthis__development mode.Because__wecan__tailorand__extendour__priorwork__bycoding__new subclasses,we__canleverage__whatwe__vealready__done,rather__thanstarting__aneweach__time,breaking__whatalready__works,or__introducingmultiple__redundant copies.When__done right,OOP__isa__powerful ally.Step__5:Customizing__Constructors,Too__Ourcode__worksas__it is,but__ifyou__studythe__currentversion__closely,you__maybe__struckby__somethinga__bitodd__itseems__pointlessto__haveto__providea__mgrjob__namefor__Managerobjects__whenwe__create them:this__isalready__impliedby__theclass__itself.It__wouldbe__betterif__wecould__somehowfill__inthis__valueautomatically__whena__Manageris__made.The__trickwe__needto__improveon__thisturns__outto__bethe__sameas__theone__weemployed__inthe__prior section:we__wantto__customizethe__constructorlogic__forManagers__insuch__away__asto__providea__jobname__automatically.In__termsof__code,we__wantto__redefinean____init__method__inManager__thatprovides__themgr__stringfor__us.And__asin__giveRaise customization,we__alsowant__torun__theoriginal____init__in__Personby__callingthrough__theclass__name,so__itstill__initializesour__objectsstate__information attributes.The__modsin__Example 28-10will__dothe__jobwe__vecoded__thenew__Managerconstructor__andchanged__thecall__thatcreates__patto__notpass__inthe__mgrjob__name.Example__28-10. person_10.py (addconstructor__customizationin__a subclass)class__Person:def____init__(self, name, job=None, pay=0): self.name =name__self.job =job__self.pay =pay__def lastName(self):return__self.name.split()[-1]def__giveRaise(self, percent): self.pay = int(self.pay * (1 + percent))def____repr__(self):return__f'[Person: {self.name} ${self.pay:,}]'class__Manager(Person):def____init__(self, name, pay): #Redefine__constructor Person.__init__(self, name, 'mgr', pay) #Run__originalwith__'mgr'def__giveRaise(self, percent, bonus=.10): Person.giveRaise(self,percent__+ bonus)if____name__ == '__main__':bob__= Person('Bob Smith')sue__= Person('Sue Jones', job='dev', pay=100000) print(bob) print(sue) print(bob.lastName(), sue.lastName()) sue.giveRaise(.10) print(sue)pat__= Manager('Pat Jones', 50000) #Job__nameset__byclass__pat.giveRaise(.10) print(pat.lastName()) print(pat) Again,we__reusing__thesame__techniqueto__augmentthe____init__constructor__herethat__weused__forgiveRaise__earlierrunning__thesuperclass__versionby__callingthrough__theclass__namedirectly__andpassing__theself__instancealong__explicitly.Although__theconstructor__hasa__strange name,the__effectis__identical.Because__weneed__Persons__constructionlogic__torun__too (toinitialize__instance attributes),we__reallyhave__tocall__itthis__way; otherwise,instances__wouldnot__haveany__attributes attached.Calling__superclassconstructors__fromredefinitions__thisway__turnsout__tobe__avery__commoncoding__patternin__Python.By__itself,Python__usesinheritance__tolook__forand__callonly__one__init____methodat__constructiontime__thelowest__onein__theclass__tree.If__youneed__higher__init____methodsto__berun__atconstruction__time (andyou__usually do),you__mustcall__them manually,and__usuallythrough__thesuperclass__s name.The__upsideto__thisis__thatyou__canbe__explicitabout__whichargument__topass__upto__thesuperclass__sconstructor__andcan__chooseto__notcall__itat__all:not__callingthe__superclassconstructor__allowsyou__toreplace__itslogic__altogether,rather__thanaugmenting__it.The__outputof__thisfile__s self-testcode__isthe__sameas__beforewe__havent__changedwhat__thisexample__does,we__vesimply__restructuredit__toget__ridof__somelogical__redundancy: $ python3 person_10.py [Person:Bob__Smith $0] [Person:Sue__Jones $100,000]Smith__Jones [Person:Sue__Jones $110,000]Jones__[Person:Pat__Jones $60,000]Per__thesidebar__Thesuper__Alternative ,an__implicit super().__init__( )sans__selfwould__runthe__superclassconstructor__too,and__thisis__acommon__rolefor__this built-inin__single-inheritanceclass__trees.For__allthe__reasonsnoted__earlier, though,let__sstick__tothe__explicitand__generalfor__now.OOP__IsSimpler__ThanYou__MayThink__Inthis__complete form,and__despitetheir__relativelysmall__sizes,our__classescapture__nearlyall__theimportant__conceptsin__Pythons__OOP machinery:Instance__creationfilling__outinstance__attributesBehavior__methodsencapsulating__logicin__aclass__smethods__Operatoroverloading__providingbehavior__for built-inoperations__likeprinting__Customizingbehavior__redefiningmethods__insubclasses__tospecialize__themCustomizing__constructorsadding__initializationlogic__tosuperclass__stepsMost__ofthese__conceptsare__basedupon__justthree__simple ideas:the__inheritancesearch__forattributes__inobject__trees,the__specialself__argumentin__methods,and__operatoroverloading__sautomatic__dispatchto__methods.Along__the way,we__vealso__madeour__codeeasy__tochange__inthe__future,by__harnessingthe__classs__propensityfor__factoringcode__toreduce__redundancy.For__example,we__wrappedup__logicin__methodsand__calledback__tosuperclass__methodsfrom__extensionsto__avoidhaving__multiplecopies__ofthe__same code.Most__ofthese__stepswere__anatural__outgrowthof__thestructuring__powerof__classes.By__and large,that__sall__thereis__toOOP__in Python.Classes__certainlycan__becomelarger__than this,and__thereare__somemore__advancedclass__concepts,such__asdecorators__and metaclasses,which__wewill__explorein__later chapters.In__termsof__the basics, though,our__classesalready__doit__all.In__fact,if__youve__graspedthe__workingsof__theclasses__weve__written,most__OOPPython__codeshould__nowbe__withinyour__reach.Other__Waysto__Combine Classes:Composites__Havingsaid__that,it__shouldbe__notedthat__althoughthe__basicmechanics__ofOOP__aresimple__in Python,some__ofthe__artin__largerprograms__liesin__theway__thatclasses__areput__together.We__refocusing__oninheritance__inthis__tutorialbecause__thats__themechanism__thePython__language provides,but__programmerssometimes__combineclasses__inother__ways, too.For__example,a__commoncoding__patterninvolves__nestingobjects__insideeach__otherto__buildup__composites.We__llexplore__thispattern__inmore__detailin__Chapter 31,which__isreally__moreabout__designthan__about Python.As__aquick__example, though,we__coulduse__thiscomposition__ideato__codeour__Managerextension__byembedding__a Person,instead__ofinheriting__from it.The__alternativeManager__inExample__28-11does__soin__partby__usingthe____getattr__ operator-overloadingmethod__tointercept__undefinedattribute__fetches,and__thegetattr__built-into__delegatethem__tothe__embedded object:The____getattr__method__isnt__coveredin__fulluntil__Chapter 30,but__itsusage__issimple__enoughto__employhere__its__automaticallyrun__forall__fetchesof__undefinedattributes__(thosenot__foundin__theinstance__bynormal__inheritance search).And__yes,this__isthe__samename__usedfor__thenonclass__module-attributeshook__ofChapter__25.The__getattrcall__wasintroduced__inChapter__25it__sthe__sameas__X.Yattribute__fetchnotation__andthus__performs inheritance,but__theattribute__nameY__isevaluated__toyield__a string,not__aname__interpreted literally.More__specifically here,the__constructormakes__theembedded__objectwith__job name;giveRaise__customizesby__changingthe__argumentpassed__alongto__theembedded__object;and__lastNametriggers____getattr__to__rerouteto__theembedded__object.In__effect,Manager__becomesa__controllerlayer__thatpasses__callsdown__tothe__embedded object,rather__thanup__tosuperclass__methods.Example__28-11. person-composite.py (embedding-basedManager__alternative)from__person_10import__Person #Example__28-10'sPerson__class Manager:def____init__(self, name, pay): self.person = Person(name, 'mgr', pay) #Embed__aPerson__objectdef__giveRaise(self, percent, bonus=.10): self.person.giveRaise(percent + bonus) #Intercept__anddelegate__def __getattr__(self, attr):return__getattr(self.person, attr) #Delegate__allother__attrsdef____repr__(self):return__str(self.person) #Must__overloadagain__perahead__if__name____== '__main__':pat__= Manager('Pat Jones', 50000) #Embed__aPerson__pat.giveRaise(.10) #Run__Manager.giveRaise print(pat.lastName()) #Delegate__toembedded__print(pat) #Run__Manager.__repr__The__outputof__thisversion__testsjust__itsManager__class (theimported__Example 28- 10tests__itsown__code).As__before,a__10%raise__ismunged__to 20%by__thecustom__giveRaise here,but__othercalls__arehandled__bythe__embedded Person,by__eitherdirect__callsor__genericattribute__rerouting: $ python3 person-composite.pyJones__[Person:Pat__Jones $60,000]The__moreimportant__pointhere__isthat__thisManager__alternativeis__representativeof__ageneral__codingpattern__usuallyknown__asdelegation__a composite-basedstructure__thatmanages__awrapped__objectand__propagatesmethod__callsto__it.This__patternworks__inour__example,but__itrequires__abouttwice__asmuch__codeand__isless__wellsuited__thaninheritance__tothe__kindsof__directcustomizations__wemeant__to express.In__fact,reasonable__Pythonprogrammers__wouldalmost__certainlynot__codethis__examplethis__wayin__practice.Manager__isnt__reallya__Person here,so__weneed__extracode__tomanually__dispatchmethod__callsto__theembedded__object; operator-overloadingmethods__like__repr____mustbe__redefinedfor__reasonsexplained__inthe__sidebarDelegating__Built-insor__Not ;and__addingnew__Managerbehavior__isless__straightforwardsince__stateinformation__isone__level removed. Still,object__embedding,and__designpatterns__basedupon__it,can__bea__goodfit__whenembedded__objectsrequire__morelimited__interactionwith__thecontainer__thandirect__customization implies.A__controller layer,or__proxy,like__thisalternative__Manager,for__example,might__comein__handyif__wewant__toadapt__aclass__toan__expectedinterface__itdoes__not support,or__traceor__validatecalls__toanother__objects__methods (indeed,we__willuse__anearly__identicalcoding__patternwhen__westudy__classdecorators__laterin__the book). Moreover,a__Departmentclass__prototypelike__thatin__Example 28-12could__aggregateother__objectsin__orderto__treatthem__asa__set.Example__28-12. person-department.py (aggregateembedded__objectsinto__a composite)from__person_10import__Person,Manager__#Example__28-10'sclasses__class Department:def____init__(self, *args): self.members = list(args) #Manage__anobjects__listdef__addMember(self, person): self.members.append(person)def__giveRaises(self, percent): #Apply__methodsto__allobjects__forperson__in self.members: person.giveRaise(percent)def__showAll(self): #Display__allnested__objectsfor__personin__self.members: print(person)if____name__ == '__main__':bob__= Person('Bob Smith')sue__= Person('Sue Jones', job='dev', pay=100000)pat__= Manager('Pat Jones', 50000)development__= Department(bob, sue) #Embed__objectsin__acomposite__development.addMember(pat) development.giveRaises(.10) #Runs__embedded objects'giveRaise__development.showAll() #Runs__embedded objects'__repr____When run,the__departments__showAllmethod__listsall__ofits__containedobjects__afterupdating__theirstate__intrue__polymorphicfashion__with giveRaises: $ python3 person-department.py [Person:Bob__Smith $0] [Person:Sue__Jones $110,000] [Person:Pat__Jones $60,000] Interestingly,this__codeuses__bothinheritance__andcomposition__Departmentis__acomposite__thatembeds__andcontrols__otherobjects__to aggregate,but__theembedded__Personand__Managerobjects__themselvesuse__inheritanceto__customize.As__another example,a__GUImight__similarlyuse__inheritanceto__customizethe__behavioror__appearanceof__labelsand__buttons,but__alsocomposition__tobuild__uplarger__packagesof__embedded widgets,such__asinput__forms, calculators,and__text editors.The__classstructure__touse__dependson__theobjects__youare__tryingto__modelin__fact,the__abilityto__model real-worldentities__thisway__isone__ofOOP__s strengths.Design__issueslike__compositionare__exploredin__Chapter 31,so__well__postponefurther__investigationsfor__now.But__again,in__termsof__thebasic__mechanicsof__OOPin__Python,our__Personand__Managerclasses__alreadytell__theentire__story.Now__thatyou__vemastered__thebasics__of OOP, though,developing__generaltools__forapplying__itmore__easilyin__yourscripts__isoften__anatural__nextstep__andthe__topicof__thenext__section.DELEGATING__BUILT-INSOR__NOTNotice__howthe__delegation-basedManager__classof__Example 28-11redefines__the__repr____runby__print,instead__ofallowing__itto__becaught__by__getattr____likeother__attributes.In__general,classes__cannotintercept__anddelegate__operator-overloadingmethod__attributesused__by built-inoperations__withoutredefining__themthis__way.Although__weknow__that__repr____isthe__onlysuch__nameused__inour__specific example,this__isa__broaderissue__for delegation-based classes.Recall__that built-inoperations__likeprinting__andaddition__implicitlyinvoke__operator-overloadingmethods__suchas____repr__and____add__. Built-inoperations__like these, however,do__notroute__theirimplicit__attributefetches__throughgeneric__attribute managers:neither____getattr__ (runfor__undefined attributes,and__used here)nor____getattribute__ (runfor__all attributes,and__covered later)is__invoked. Moreover,the__implicitobject__superclassat__thetop__ofall__classtrees__definesdefaults__thatcan__preclude__getattr____too. Hence,Manager__mustredefine____repr__ redundantly,in__orderto__routeprinting__tothe__embeddedPerson__object.Comment__outthis__classs____repr__method__tosee__thislive__theManager__instancethen__printswith__adefault__insteadof__ourcustom__display,because____getattr__is__neverrun__for printing: $ python3 person-composite.pyJones__<__main__.Managerobject__at 0x10a292c30> Technically, built-inoperations__begintheir__implicitsearch__formethod__namesat__the class,skipping__theinstance__entirely.By__contrast,explicit__by-nameattribute__fetchesare__alwaysrouted__tothe__instance first.Classes__alsoinherit__adefault____repr__from__theirautomatic__objectsuperclass__thatwould__prevent__getattr____fromrunning__too,but__themore__absolute__getattribute____doesnt__interceptthe__name either,and__othermethods__notin__objectalso__wont__becaught__by __getattr__,like____add__for__+.This__wasa__modin__Python 3.X,but__isnt__a showstopper: delegation-basedclasses__canstill__redefine operator-overloadingmethods__todelegate__themto__wrapped objects,either__manuallyor__viatools__or superclasses.It__salso__tooadvanced__toexplore__furtherin__this tutorial,but__watchfor__itto__cropup__inChapter__38,be__solvedin__Chapter 39,and__makea__cameoappearance__asa__specialcase__inthe__formalinheritance__definitionof__Chapter 40.Step__6:Using__IntrospectionTools__Lets__makeone__finaltweak__beforewe__throwour__objectsonto__a database.As__they are,our__classesare__completeand__demonstratemost__ofthe__basicsof__OOPin__Python.They__stillhave__tworemaining__issueswe__probablyshould__iron out, though,before__wego__livewith__them: First,if__youlook__atthe__displayof__theobjects__asthey__areright__now,you__llnotice__thatwhen__youprint__patthe__Manager,the__displaylabels__itas__a Person.That__snot__technically incorrect,since__Manageris__akind__ofcustomized__andspecialized__Person. Still,it__wouldbe__moreaccurate__todisplay__anobject__withthe__mostspecific__(that is, lowest)class__possible:the__onean__objectis__made from. Second,and__perhapsmore__importantly,the__currentdisplay__formatshows__onlythe__attributeswe__includein__our __repr__,and__thatmight__notaccount__forfuture__goals.For__example,we__cant__yetverify__thatpat__sjob__namehas__beenset__tomgr__correctlyby__Managers__constructor,because__the__repr____wecoded__forPerson__doesnot__printthis__field. Worse,if__weever__expandor__otherwisechange__theset__ofattributes__assignedto__ourobjects__in __init__,we__llhave__toremember__toalso__update__repr____fornew__namesto__be displayed,or__itwill__becomeout__ofsync__over time.The__lastpoint__means that,yet__again,we__vemade__potentialextra__workfor__ourselvesin__thefuture__byintroducing__redundancyin__our code.Because__anydisparity__in__repr____willbe__reflectedin__theprogram__s output,this__redundancymay__bemore__obviousthan__theother__formswe__addressed earlier; still,avoiding__extrawork__inthe__futureis__agenerally__good thing.Special__ClassAttributes__Wecan__addressboth__issueswith__Pythons__introspectiontools__specialattributes__andfunctions__thatgive__usaccess__tosome__ofthe__internalsof__objects implementations.These__toolsare__somewhatadvanced__andgenerally__usedmore__bypeople__writingtools__forother__programmersto__usethan__byprogrammers__developing applications.Even__so,a__basicknowledge__ofsome__ofthese__toolsis__usefulbecause__theyallow__usto__writecode__thatprocesses__classesin__generic ways.In__our code,for__example,there__aretwo__hooksthat__canhelp__us out,both__ofwhich__wereintroduced__nearthe__endof__thepreceding__chapterand__usedin__earlier examples:The__built-in instance.__class__attribute__providesa__linkfrom__aninstance__tothe__classfrom__whichit__was created.Classes__inturn__havea____name__,just__like modules,and__a__bases____sequencethat__providesaccess__to superclasses.We__canuse__thesehere__toprint__thename__ofthe__classfrom__whichan__instanceis__maderather__thanone__weve__hardcoded.The__built-in object.__dict__attribute__providesa__dictionarywith__one key/valuepair__forevery__attributeattached__toa__namespaceobject__(including modules, classes,and__instances).Because__itis__a dictionary,we__canfetch__itskeys__list,index__by key,iterate__overits__keys,and__so on,to__processall__attributes generically.We__canuse__thishere__toprint__everyattribute__inany__instance,not__justthose__wehardcode__incustom__displays,much__aswe__didin__Chapter 25s__module tools.We__metthe__firstof__thesecategories__inthe__prior chapter,but__heres__aquick__reviewat__Pythons__interactiveprompt__withthe__latestversions__ofour__person.pyclasses__(Example 28-10).Notice__howwe__loadPerson__atthe__interactiveprompt__witha__fromstatement__hereclass__nameslive__inand__areimported__from modules,exactly__likefunction__namesand__other variables: >>>from__personimport__Person >>>pat__= Person('Pat Jones') >>>pat__#Run__pat's__repr____[Person:Pat__Jones $0] >>> pat.__class__ #Show__pat'sclass__andits__name >>> pat.__class__.__name__ 'Person' >>> list(pat.__dict__.keys()) #Attributes__aredict__keys ['name', 'job', 'pay'] >>>for__keyin__pat.__dict__: print(key, '=>', pat.__dict__[key]) #Index__manually:no__inheritancename__=>Pat__Jonesjob__=>None__pay => 0 >>>for__keyin__pat.__dict__: # obj.attr,but__attris__astring__print(key, '=>', getattr(pat, key)) #Runs__attrinheritance__sameas__prioroutput__Asnoted__brieflyin__theprior__chapter,some__attributesaccessible__froman__instancemight__notbe__storedin__the__dict____dictionaryif__theinstance__sclass__definesa____slots__:an__optionaland__relativelyobscure__featureof__classesthat__storesattributes__sequentiallyin__the instance;may__precludean__instance__dict____altogether;and__whichwe__wont__studyin__fulluntil__Chapter 32.Since__slotsreally__belongto__classesinstead__of instances,and__sincethey__arerarely__usedin__any event,we__canreasonably__ignorethem__hereand__focuson__thenormal____dict__.As__we do, though,keep__inmind__thatsome__programsmay__needto__catchexceptions__fora__missing __dict__,or__use built-infunctions__like hasattr, getattr,and__dirif__itsusers__mightdeploy__slots.As__youll__learnin__Chapter 32,the__nextsection__scode__wont__failif__usedby__aclass__withslots__(itslack__ofthem__isenough__toguarantee__a __dict__)but__slotsand__othervirtual__attributeswon__tbe__reportedas__instance data.A__GenericDisplay__ToolWe__canput__theseinterfaces__towork__ina__superclassthat__displaysaccurate__classnames__andformats__allattributes__ofan__instanceof__any class.This__superclassis__codedin__Example 28-13it__sa__new,independent__modulenamed__classtools.py.Because__its__repr____displayoverload__usesgeneric__introspection tools,it__willwork__onany__instance,regardless__ofthe__instances__attributes set.And__becausethis__isa__class,it__automaticallybecomes__ageneral__formatting tool:thanks__to inheritance,it__canbe__mixedinto__anyclass__thatwishes__touse__itsdisplay__format.As__anadded__bonus,if__weever__wantto__changehow__instancesare__displayedwe__needonly__changethis__classevery__classthat__inheritsits____repr__will__automaticallypick__upthe__newformat__whennext__usedby__a program.Example__28-13. classtools.py (new) "Assortedclass__utilitiesand__tools"class__AttrDisplay: """Provides__aninheritable__displayoverload__methodthat__showsinstances__withtheir__classnames__anda__name=valuepair__foreach__attributestored__onthe__instanceitself__(butnot__attrsinherited__fromits__classes).Can__bemixed__intoany__class,and__willwork__onany__instance. """def__gatherAttrs(self):attrs__= []for__keyin__sorted(self.__dict__): attrs.append(f'{key}={getattr(self, key)}')return__', '.join(attrs)def____repr__(self):return__f'[{self.__class__.__name__}: {self.gatherAttrs()}]'if____name__ == '__main__':class__TopTest(AttrDisplay):count__= 0def____init__(self): self.attr1 = TopTest.count self.attr2 = TopTest.count+1 TopTest.count += 2class__SubTest(TopTest):pass__X,Y__= TopTest(), SubTest() #Make__twoinstances__print(X) #Show__allinstance__attrs print(Y) #Show__lowestclass__nameNotice__thedocstrings__herebecause__thisis__a general-purpose tool,we__wantto__addsome__functionaldocumentation__forpotential__usersto__read.As__wesaw__inChapter__15,docstrings__canbe__placedat__thetop__ofsimple__functionsand__modules,and__alsoat__thestart__ofclasses__andany__oftheir__methods;the__helpfunction__andthe__PyDoctool__extractand__displaythese__automatically.We__llrevisit__docstringsfor__classesin__Chapter 29.When__run directly,this__modules__self-testmakes__twoinstances__andprints__them;the____repr__defined__hereshows__theinstance__s class,and__allits__attributesnames__and values,in__sortedattribute__name order: $ python3 classtools.py [TopTest: attr1=0, attr2=1] [SubTest: attr1=2, attr2=3]Another__designnote__here:because__thisclass__uses__repr____insteadof____str__its__displaysare__usedin__all contexts,but__itsclients__alsowon__thave__theoption__ofproviding__analternative__low-leveldisplay__theycan__stilladd__a __str__,but__thisapplies__toprint__andstr__only.In__amore__general tool,using____str__instead__limitsa__displays__scope,but__leavesclients__theoption__ofadding__a__repr____fora__secondarydisplay__atinteractive__promptsand__nested appearances.We__llfollow__thisalternative__policywhen__wecode__expandedversions__ofthis__classin__Chapter 31;for__this demo,we__llstick__withthe__all-inclusive __repr__.Instance__VersusClass__AttributesIf__youstudy__theclasstools__modules__self-testcode__long enough,you__llnotice__thatits__classdisplays__onlyinstance__attributes,attached__tothe__selfobject__atthe__bottomof__theinheritance__tree;that__swhat__selfs____dict__ contains.As__anintended__consequence,we__dont__seeattributes__inheritedby__theinstance__fromclasses__aboveit__inthe__tree.For__example,the__attribute TopTest.countused__asan__instancecounter__inthis__files__self-testcode__isa__classattribute__thatlives__onlyon__the class:it__sassigned__inthe__classblock__like methods,and__referencedin__methodsby__explicitclass__namemuch__likeexplicit__callsto__customizedclass__methods.It__salso__inheritedby__instances,but__inheritedclass__attributesare__attachedto__theclass__only,not__copieddown__to instances.There__smore__onsuch__nonmethodclass__attributesin__thenext__chapter;the__mainpoint__hereis__thatcount__wont__bedisplayed__by AttrDisplay.If__youever__dowish__toinclude__inheritedattributes__too,you__canclimb__the__class____linkto__theinstance__s class,use__the__dict____thereto__fetchclass__attributes,and__theniterate__throughthe__classs____bases__attribute__toclimb__toeven__higher superclasses,repeating__as necessary.If__youre__afan__ofsimple__code,running__a built-indir__callon__theinstance__insteadof__using__dict____andclimbing__wouldhave__muchthe__same effect,since__dirresults__includeinherited__namesin__sortedresults__lists (alongwith__built-in__X____methodsthat__areeasy__tofilter__outas__usual): $ python3 >>>from__person_10import__Person >>>pat__= Person('Pat Jones') >>> list(pat.__dict__) ['name', 'job', 'pay'] >>> [afor__ain__dir(pat)if__not a.startswith('__')] ['giveRaise', 'job', 'lastName', 'name', 'pay']In__theinterest__of space,we__llleave__optionaldisplay__ofinherited__classattributes__witheither__treeclimbs__ordir__assuggested__experimentsfor__now.For__morehints__onthis__front, though,watch__forthe__classtree.py inheritance-treeclimber__wewill__writein__Chapter 29,and__the lister.pyattribute__listersand__climberswe__llcode__inChapter__31.Name__Considerationsin__ToolClasses__Onelast__subtlety here:because__ourAttrDisplay__classin__theclasstools__moduleis__ageneral__tooldesigned__tobe__mixedinto__otherarbitrary__classes,we__haveto__beaware__ofthe__potentialfor__unintendedname__collisionswith__client classes.As__is,the__codeassumes__thatclient__subclassesmay__wantto__useboth__its__repr____and gatherAttrs,but__thelatter__ofthese__maybe__morethan__asubclass__expectsif__asubclass__innocentlydefines__agatherAttrs__nameof__its own,it__willlikely__breakour__class,because__thelower__versionin__thesubclass__willbe__usedinstead__of ours.To__seethis__for yourself,add__agatherAttrs__toTopTest__inthe__files__self-test code;unless__thenew__methodis__identical,or__intentionallycustomizes__the original,our__toolclass__willno__longerwork__asplanned__self.gatherAttrswithin__AttrDisplaysearches__anewfrom__theTopTest__instance:class__TopTest(AttrDisplay):def__gatherAttrs(self): #Replaces__methodin__AttrDisplay!return__'Oops'This__isnt__necessarilybad__sometimeswe__wantother__methodsto__beavailable__to subclasses,either__fordirect__callsor__forcustomization__this way.If__wereally__meantto__providea____repr__ only, though,this__isless__than ideal.To__minimizethe__chancesof__namecollisions__like this,Python__programmersoften__prefixmethods__notmeant__forexternal__usewith__asingle__underscore:_gatherAttrs__inour__case.This__isnt__foolproof (whatif__anotherclass__definesits__ownprivate___gatherAttrs, too?),but__its__usually sufficient,and__its__acommon__Pythonnaming__conventionfor__methodsinternal__toa__class.A__bettersolution__wouldbe__touse__twounderscores__atthe__frontof__themethod__name only:__gatherAttrs__for us.Python__automaticallyexpands__suchnames__toinclude__theenclosing__classs__name,which__makesthem__trulyunique__whenlooked__upby__theinheritance__search.This__isa__featureusually__calledpseudoprivate__class attributes,which__well__expandon__inChapter__31and__deployin__anexpanded__versionof__thisclass__there.For__now,we__llmake__bothour__methods available.Our__ClassesFinal__Form Now,to__usethe__precedingsection__sgeneric__displaytool__inour__classes,all__weneed__todo__isimport__itfrom__its module,mix__itin__byinheritance__inour__top-level class,and__getrid__ofthe__morespecific____repr__we__coded before.The__newdisplay__overloadmethod__willbe__inheritedby__instancesof__Person,as__wellas__Manager;Manager__gets__repr____from Person,which__nowobtains__itfrom__theAttrDisplay__codedin__another module.Example__28-14codes__thefinal__versionof__our person.pyfile__withthese__changes applied,and__importsand__usesthe__separateExample__28-13.Example__28-14. person_14.py (final) """Record__andprocess__informationabout__people.Run__thisfile__directlyto__testits__classes. """from__classtoolsimport__AttrDisplay #Use__genericdisplay__toolclass__Person(AttrDisplay): #Mix__ina__reprat__thislevel__"""Create__andprocess__personrecords__"""def____init__(self, name, job=None, pay=0): self.name =name__self.job =job__self.pay =pay__def lastName(self): #Assumes__lastis__lastreturn__self.name.split()[-1]def__giveRaise(self, percent): #Percent__mustbe__0..1 self.pay = int(self.pay * (1 + percent))class__Manager(Person): """A__customizedPerson__withspecial__requirements """def____init__(self, name, pay): Person.__init__(self, name, 'mgr', pay) #Job__nameis__implieddef__giveRaise(self, percent, bonus=.10): Person.giveRaise(self,percent__+ bonus)if____name__ == '__main__':bob__= Person('Bob Smith')sue__= Person('Sue Jones', job='dev', pay=100000) print(bob) print(sue) print(bob.lastName(), sue.lastName()) sue.giveRaise(.10) print(sue)pat__= Manager('Pat Jones', 50000) pat.giveRaise(.10) print(pat.lastName()) print(pat)As__thisis__thefinal__revision,we__veadded__afew__commentshere__todocument__ourwork__docstringsfor__functionaldescriptions__and #for__smaller notes,per__best-practice__conventions,as__wellas__blanklines__betweenmethods__forreadability__agenerally__goodstyle__choicewhen__classesor__methodsgrow__large,which__hasbeen__resistedearlier__forthese__small classes,in__partto__savespace__andkeep__thecode__more compact.When__werun__thiscode__now,we__seeall__theattributes__ofour__objects,not__justthe__oneswe__hardcodedin__theoriginal____repr__.And__ourfinal__issueis__resolved:because__AttrDisplaytakes__classnames__offthe__selfinstance__directly,each__objectis__shownwith__thename__ofits__closest (lowest)class__patdisplays__asa__Manager now,not__a Person,and__wecan__finallyverify__thatjob__nameis__correctlyfilled__inby__theManager__constructor: $ python3 person_14.py [Person: job=None, name=Bob Smith, pay=0] [Person: job=dev, name=Sue Jones, pay=100000]Smith__Jones [Person: job=dev, name=Sue Jones, pay=110000]Jones__[Manager: job=mgr, name=Pat Jones, pay=60000]This__isthe__moreuseful__displaywe__were after.From__alarger__perspective, though,our__attributedisplay__classhas__becomea__general tool,which__wecan__mixinto__anyclass__byinheritance__toleverage__thedisplay__formatit__defines. Further,all__itsclients__willautomatically__pickup__futurechanges__inour__tool.Later__inthe__book,we__llexplore__evenmore__powerfulclass__tool concepts,such__asdecorators__and metaclasses;along__withPython__smany__introspection tools,they__allowus__towrite__codethat__augmentsand__managesclasses__instructured__andmaintainable__ways.Step__7 (Final):Storing__Objectsin__aDatabase__Atthis__point,our__workis__almost complete.We__nowhave__a two-modulesystem__thatnot__onlyimplements__ouroriginal__designgoals__forrepresenting__peoplebut__alsoprovides__ageneral__attributedisplay__toolwe__canuse__inother__programsin__the future.By__codingfunctions__andclasses__inmodule__files,we__veensured__thatthey__naturallysupport__reuse.And__bycoding__oursoftware__as classes,we__veensured__thatit__naturallysupports__extension.Although__ourclasses__workas__planned, though,the__objectsthey__createare__notreal__database records.That__is,if__wekill__Pythonor__our program,our__instanceswill__disappearthey__retransient__objectsin__memoryand__arenot__storedin__amore__permanentmedium__likea__file,so__theywon__tbe__availablein__futureprogram__runs.It__turnsout__thatit__seasy__tomake__instanceobjects__more permanent,with__aPython__featurecalled__objectpersistence__makingobjects__liveon__afterthe__programthat__createsthem__exits.As__afinal__stepin__this tutorial,let__smake__ourobjects__permanent.Pickles__andShelves__Objectpersistence__isimplemented__bythree__standard-library modules,installed__withPython__itself:pickle__Serializesarbitrary__Pythonobjects__toand__froma__stringof__bytesdbm__Implementsan__access-by-keyfilesystem__forstoring__stringsshelve__Usesthe__othertwo__modulesto__storePython__objectson__afile__bykey__Weused__pickleand__notedshelve__brieflyin__Chapter 9when__westudied__file basics.They__providesimple__yetuseful__data-storage options.Although__wecan__tdo__themcomplete__justicein__thistutorial__or book,they__arestraightforward__enoughthat__abrief__introductionshould__sufficeto__getyou__started.The__picklemodule__Thepickle__moduleis__ageneral__formattingand__deformatting tool:given__anearly__arbitraryPython__objectin__memory,it__convertsthe__objectto__astring__of bytes,which__itcan__uselater__toreconstruct__theoriginal__objectin__memory.The__picklemodule__canhandle__mostPython__objectsincluding__lists, dictionaries,nested__combinations thereof,and__class instances.The__latterare__especiallyuseful__thingsto__picklebecause__theyprovide__bothdata__(attributes)and__behavior (methods);the__combinationis__roughlyequivalent__torecords__and programs.Because__pickleis__so general,it__canreplace__extracode__youmight__otherwisewrite__tocreate__andparse__custom text-filerepresentations__foryour__objects.By__storingan__objects__picklestring__ona__file,you__effectivelymake__it persistent:simply__loadand__unpickleit__laterto__re-createthe__original object.The__shelvemodule__Althoughit__seasy__touse__pickleby__itselfto__storeobjects__insimple__flatfiles__andload__themfrom__there later,the__shelvemodule__providesan__extralayer__ofstructure__thatallows__youto__storepickled__objectsby__key.shelve__translatesan__objectto__itspickled__stringwith__pickleand__storesthat__stringunder__akey__ina__dbm file;when__later loading,shelve__fetchesthe__pickledstring__bykey__and re-creates__theoriginal__objectin__memorywith__pickle.To__yourscript__ashelf__ofpickled__objectslooks__likea__dictionaryyou__indexby__keyto__fetch,assign__tokeys__to store,and__usedictionary__toolssuch__as len, in,and__dict.keysto__get information.Shelves__automaticallymap__mostdictionary__operationsto__pickledobjects__storedin__a file.2In__fact,to__your script,the__maincoding__differencebetween__shelvesand__normaldictionaries__isthat__youmust__openshelves__initiallyand__mustclose__themafter__making changes.The__neteffect__isthat__shelveprovides__asimple__databasefor__storingand__fetchingnative__Pythonobjects__by keys,and__thusmakes__thempersistent__acrossprogram__runs.It__doesnot__supportquery__toolssuch__asSQL__(butPython__s sqlite3 standard-librarymodule__does)and__doesnot__havesome__advancedfeatures__foundin__enterprise-leveldatabases__suchas__truetransaction__processing (butother__Pythondatabase__tools do).It__does, however,store__nativePython__objectsthat__maybe__processedwith__thefull__powerof__thePython__languageonce__theyare__fetchedback__by key.Storing__Objectson__ashelve__DatabasePickles__andshelves__aresomewhat__advanced topics,and__wewon__tgo__intoall__theirdetails__here;you__canread__moreabout__themin__the standard-library manuals.This__isall__simplerin__codethan__narrative, though,so__lets__jumpright__in.First__upis__anew__scriptto__storeobjects__ofour__classeson__a shelf.Since__thisis__anew__file,we__llneed__toimport__ourclasses__inorder__tomake__instancesto__store.We__usedfrom__toload__aclass__earlier,but__asnoted__inthe__prior chapter,there__aretwo__waysto__geta__classfrom__afile__(classnames__arevariables__likeany__other,and__notat__allmagic__inthis__context).As__anabstract__refresher:import__person #Load__classwith__importbob__= person.Person( ) #Go__throughmodule__namefrom__personimport__Person #Load__classwith__frombob__= Person( ) #Use__namedirectly__Well__usefrom__toload__inour__script,just__becauseit__sless__to type.To__alsokeep__this simple,we__llduplicate__someof__the self-testlines__from person.pythat__makeinstances__ofour__classes,so__wehave__somethingto__store (wewon__tfret__overthe__test-coderedundancy__inthis__simple demo).Once__wehave__some instances,it__salmost__trivialto__storethem__ona__shelf.We__simplyimport__theshelve__module,open__anew__shelfwith__anexternal__filename,assign__theobjects__tokeys__inthe__shelf,and__closethe__shelfwhen__were__donebecause__weve__madechanges__allper__Example 28-15.Example__28-15. makedb.py (storePerson__objectsin__ashelve__database)from__person_14import__Person,Manager__#Load__ourclasses__bob = Person('Bob Smith') # Re-createobjects__tobe__storedsue__= Person('Sue Jones', job='dev', pay=100000)pat__= Manager('Pat Jones', 50000)import__shelvedb__= shelve.open('persondb') #Filename__whereobjects__arestored__forobj__in (bob, sue, pat): #Use__object'sname__attras__key db[obj.name] =obj__#Store__objectin__shelfby__key db.close() #Close__aftermaking__changesNotice__howwe__assignobjects__tothe__shelfusing__theirown__namesas__keys.This__isjust__for convenience;in__a shelf,the__keycan__beany__string,including__onewe__mightcreate__tobe__uniqueusing__toolssuch__asprocess__IDsand__timestamps (availablein__theos__andtime__standard-library modules).The__onlyrule__isthat__thekeys__mustbe__stringsand__shouldbe__uniquesince__wecan__storejust__oneobject__perkey__thoughthat__objectcan__bea__list, dictionary,or__otherobject__containingmany__objects itself.In__fact,the__valueswe__storeunder__keyscan__bePython__objectsof__almostany__sort: built-intypes__like strings, lists, tuples,and__dictionaries,as__wellas__user-definedclass__instances,and__nestedcombinations__ofall__ofthese__and more.For__example,the__nameand__jobattributes__ofour__objectscould__benested__dictionariesand__listsas__inearlier__incarnationsin__thisbook__(thoughthis__wouldrequire__abit__ofredesign__tothe__current code).That__sall__thereis__toit__ifthis__scripthas__nooutput__when run,it__meansit__probably worked;we__renot__printing anything,just__creatingand__storingobjects__ina__file-based database: $ python3 makedb.pyExploring__ShelvesInteractively__Atthis__point,there__areone__ormore__filesin__thecurrent__directorywhose__namesall__startwith__persondb.The__actualfiles__createdcan__vary,and__justas__inthe__built-inopen__function,the__filenamein__shelve.open()is__relativeto__thecurrent__workingdirectory__(CWD)unless__itincludes__adirectory__path.Wherever__theyare__stored,these__filesimplement__a keyed-accessfile__thatcontains__thepickled__representationof__ourthree__Python objects.Don__tdelete__thesefiles__theyare__yourdatabase__andare__whatyou__llneed__tocopy__ortransfer__whenyou__backup__ormove__your storage.You__caninspect__theshelf__sfiles__eitherfrom__afile__explorer,console__shell,or__Python REPL,but__theyare__binaryhash__files,and__mostof__theircontent__makeslittle__senseoutside__thecontext__ofthe__shelve module.For__example,Python__s standard-libraryglob__moduleallows__usto__getdirectory__listingsto__verifythe__shelf (its__justone__fileon__macOS, persondb.db),and__wecan__openit__inbinary__modeto__explorestored__bytes: >>>import__glob >>> glob.glob('persondb*') ['persondb.db'] >>> print(open('persondb.db', 'rb').read()) b'\x00\x06\x15a\x00\x00\x00\x02\x00\x00\x04\xd2\x00\x00much__moreomitted__Thiscontent__can vary,but__its__nearlyimpossible__todecipher__here,and__doesnt__exactlyqualify__asa__user-friendlydatabase__interface.To__verify better,we__canwrite__another script,or__pokearound__ourshelf__atthe__interactive prompt.Because__shelvesare__Pythonobjects__containingPython__objects,we__canprocess__themwith__normalPython__syntaxand__development modes. Here,the__REPLeffectively__becomesa__database client: $ python3 >>>import__shelve >>>db__= shelve.open('persondb') #Reopen__theshelf__>>> len(db) #Three__objectsstored__3 >>> list(db.keys()) #keys__isthe__index ['Bob Smith', 'Sue Jones', 'Pat Jones'] >>>pat__= db['Pat Jones'] #Fetch__anobject__bykey__>>> pat.lastName() #Runs__lastNamefrom__Person 'Jones' >>>pat__#Runs____repr__from__AttrDisplay [Manager: job=mgr, name=Pat Jones, pay=50000] >>>for__keyin__sorted(db): # Iterate, sort, fetch,print__print(key, '=>', db[key])Bob__Smith => [Person: job=None, name=Bob Smith, pay=0]Pat__Jones => [Manager: job=mgr, name=Pat Jones, pay=50000]Sue__Jones => [Person: job=dev, name=Sue Jones, pay=100000]Notice__thatwe__dont__haveto__importour__Personor__Managerclasses__herein__orderto__loador__useour__stored objects.For__example,we__cancall__pats__lastNamemethod__freely,and__getits__customprint__displayformat__automatically,even__thoughwe__dont__havethe__Personclass__inscope__here.This__worksbecause__whenPython__picklesa__class instance,it__recordsthe__instances__self attributes,along__withthe__namesof__theclass__itwas__createdfrom__andthe__modulewhere__thatclass__lives.When__aninstance__islater__fetchedfrom__theshelf__and unpickled,Python__automaticallyreimports__theclass__byname__andmakes__anew__instanceof__ithaving__thepreviously__storedinstance__attributes.The__upshotof__thisscheme__isthat__classinstances__automaticallyacquire__alltheir__classbehavior__whenthey__areloaded__inthe__future.We__haveto__importour__classesonly__tomake__new instances,not__toprocess__existing ones.Although__adeliberate__feature,this__schemehas__somewhatmixed__consequences:The__downsideis__thatclasses__andtheir__modules__filesmust__beimportable__whenan__instanceis__later loaded.That__is,picklable__classesmust__becoded__atthe__toplevel__ofa__modulefile__thatis__accessiblefrom__adirectory__listedon__the sys.pathmodule__searchpath__(andshouldn__tlive__inthe__topmostscript__filesmodule____main__unless__theyre__alwaysin__thatmodule__when used).Because__ofthis__externalfile__requirement,some__programspickle__simplerobjects__suchas__dictionariesor__lists,especially__ifthey__areto__betransferred__across networks.The__upsideis__thatchanges__ina__classs__sourcecode__fileare__automaticallypicked__upwhen__instancesof__theclass__areloaded__again.There__isoften__noneed__toupdate__storedobjects__themselvessince__updatingtheir__classs__codechanges__their behavior.Shelves__haveother__well-knownlimitations__coveredin__Pythons__library manual.For__simpleobject__storage, though,shelves__andpickles__are easy-to-usetools__forpersonal__databases,program__configurations,and__more.Updating__Objectson__aShelf__Onelast__script:let__swrite__aprogram__thatupdates__aninstance__(record)each__timeit__runs,to__showthat__ourobjects__reallyare__persistentthat__theircurrent__valuesare__availableevery__timea__Pythonprogram__runs.The__filecoded__inExample__28- 16prints__thedatabase__andgives__araise__toone__ofour__storedobjects__oneach__run.If__youtrace__throughwhat__sgoing__on here,you__llnotice__thatwe__regetting__alot__ofutility__forfree__printingour__objectsautomatically__employsthe__general__repr____overloading method,and__wegive__raisesby__callingthe__giveRaisemethod__wewrote__earlier.This__alljust__worksfor__objectsbased__onOOP__sinheritance__model,even__whenthey__livein__a file.Example__28-16. updatedb.py (modifyPerson__objectin__ashelve__database)import__shelvedb__= shelve.open('persondb') #Reopen__shelfwith__samefilename__forkey__in sorted(db): #Iterate__todisplay__databaseobjects__print(key, '\t=>', db[key]) #Prints__withcustom__formatsue__= db['Sue Jones'] #Index__bykey__tofetch__sue.giveRaise(.10) #Update__inmemory__using class'smethod__db['Sue Jones'] =sue__#Assign__tokey__toupdate__inshelf__db.close() #Close__aftermaking__changesBecause__thisscript__printsthe__databasewhen__itstarts__up,we__haveto__runit__atleast__twiceto__seeour__objects change.Here__itis__in action,displaying__allrecords__andincreasing__sues__payeach__timeit__isrun__(its__apretty__goodscript__for sue;something__toschedule__torun__regularlyas__acron__job perhaps?): $ python3 updatedb.pyBob__Smith => [Person: job=None, name=Bob Smith, pay=0]Pat__Jones => [Manager: job=mgr, name=Pat Jones, pay=50000]Sue__Jones => [Person: job=dev, name=Sue Jones, pay=100000] $ python3 updatedb.pyBob__Smith => [Person: job=None, name=Bob Smith, pay=0]Pat__Jones => [Manager: job=mgr, name=Pat Jones, pay=50000]Sue__Jones => [Person: job=dev, name=Sue Jones, pay=110000] $ python3 updatedb.pyBob__Smith => [Person: job=None, name=Bob Smith, pay=0]Pat__Jones => [Manager: job=mgr, name=Pat Jones, pay=50000]Sue__Jones => [Person: job=dev, name=Sue Jones, pay=121000] Again,what__wesee__hereis__aproduct__ofthe__shelveand__pickletools__weget__from Python,and__ofthe__behaviorwe__codedin__ourclasses__ourselves.And__once again,we__canverify__ourscript__swork__atthe__interactiveprompt__theshelf__sequivalent__ofa__database client: $ python3 >>>import__shelve >>>db__= shelve.open('persondb') #Reopen__database >>>rec__= db['Sue Jones'] #Fetch__objectby__key >>>rec__[Person: job=dev, name=Sue Jones, pay=133100] >>> rec.lastName(), rec.pay ('Jones', 133100)For__anotherexample__ofobject__persistencein__this book,watch__forthe__sidebarWhy__YouWill__Care:Classes__andPersistence__.It__storesa__somewhatlarger__compositeobject__ina__flatfile__withpickle__insteadof__shelve,but__theeffect__is similar.For__moredetails__andexamples__of pickles,see__alsoChapter__9 (file basics)and__Chapter 37 (stringtools__and Unicode),as__wellas__Pythons__manuals.Future__DirectionsAnd__thats__awrap__forthis__chapters__tutorial.At__this point,you__veseen__allthe__basicsof__Pythons__OOPmachinery__in action,and__youve__learnedways__toavoid__redundancyand__itsassociated__maintenanceissues__inyour__code.You__vebuilt__full-featuredclasses__thatdo__real work.As__anadded__bonus,you__vemade__themreal__databaserecords__bystoring__themin__aPython__shelf,so__theirinformation__liveson__persistently.There__ismuch__morewe__couldexplore__here,of__course.For__example,we__couldextend__ourclasses__tomake__themmore__realistic,add__newkinds__ofbehavior__to them,and__so on.Giving__a raise,for__instance,should__inpractice__verifythat__payincrease__ratesare__betweenzero__andone__anextension__well__addwhen__wemeet__decoratorslater__inthis__book.You__mightalso__mutatethis__exampleinto__apersonal__contacts database,by__changingthe__stateinformation__storedon__objects,as__wellas__theclasses__methodsused__toprocess__it.We__llleave__thisa__suggestedexercise__opento__your imagination.We__couldalso__expandour__scopeto__usetools__thateither__comewith__Pythonor__arefreely__availablein__theopen__source world.For__instance, GUIs, websites,or__appswould__makeour__databasemore__accessibleto__nonprogrammers,and__otherdatabase__interfaceslike__sqlite3and__content-representationschemes__likeJSON__offeradditional__possibilities.While__thischapter__hashopefully__sparkedyour__interestfor__future exploration,such__topicsare__ofcourse__beyondthe__scopeof__thistutorial__andthis__bookat__large.If__youwant__toexplore__anyof__themon__your own,see__the web,Python__s standard-library__manuals,and__follow-upapplication__texts. First, though,let__sreturn__toclass__fundamentalsand__finishup__therest__ofthe__Python core-language story.Chapter__SummaryIn__this chapter,we__exploredall__thefundamentals__ofPython__classesand__OOPin__action,by__buildingupon__asimple__butreal__example,step__by step.We__added constructors, methods,operator__overloading,customization__with subclasses,and__introspection-based tools,and__wemet__conceptssuch__as composition, delegation,and__polymorphismalong__the way.In__the end,we__tookobjects__createdby__ourclasses__andmade__thempersistent__bystoring__themon__ashelve__objectdatabase__asimple__systemfor__savingand__retrievingnative__Pythonobjects__by key.While__exploringclass__basics,we__alsoencountered__multipleways__tofactor__ourcode__toreduce__redundancyand__minimizefuture__maintenance costs.In__thenext__chaptersof__thispart__ofthe__book,we__llresume__ourstudy__ofthe__detailsbehind__Pythons__classmodel__andinvestigate__itsapplication__tosome__ofthe__designconcepts__usedto__combineclasses__inlarger__programs.Before__wemove__ahead, though,let__swork__throughthis__chapters__quizto__reviewwhat__wecovered__here.Since__weve__alreadydone__alot__of hands-onwork__inthis__chapter,we__llclose__witha__setof__mostly theory-orientedquestions__designedto__makeyou__tracethrough__someof__thecode__andponder__someof__thebigger__ideasbehind__it.Test__Your Knowledge:Quiz__1.When__wefetch__aManager__objectfrom__theshelf__andprint__it,where__doesthe__displayformat__logiccome__from? 2.When__wefetch__aPerson__objectfrom__ashelf__withoutimporting__its module,how__doesthe__objectknow__thatit__hasa__giveRaisemethod__thatwe__can call? 3.Why__isit__soimportant__tomove__processinginto__methods,instead__ofhardcoding__itoutside__the class? 4.Why__isit__betterto__customizeby__subclassingrather__thancopying__theoriginal__and modifying? 5.Why__isit__betterto__callback__toa__superclassmethod__torun__default actions,instead__ofcopying__andmodifying__itscode__ina__subclass? 6.Why__isit__betterto__usetools__like__dict____thatallow__objectsto__beprocessed__genericallythan__towrite__morecustom__codefor__eachtype__of class? 7.In__general terms,when__mightyou__chooseto__useobject__embeddingand__compositioninstead__of inheritance? 8.What__wouldyou__haveto__changeif__theobjects__codedin__thischapter__useda__dictionaryfor__namesand__alist__for jobs,as__insimilar__examplesearlier__inthis__book? 9.How__mightyou__modifythe__classesin__thischapter__toimplement__apersonal__contactsdatabase__in Python?Test__Your Knowledge:Answers__1.In__thefinal__versionof__our classes,Manager__ultimatelyinherits__its__repr____printingmethod__fromAttrDisplay__inthe__separateclasstools__module,and__twolevels__upin__theclass__tree.Manager__doesnt__haveone__itself,so__theinheritance__searchclimbs__toits__Person superclass;because__thereis__no__repr____there either,the__searchclimbs__higherand__findsit__in AttrDisplay.The__classnames__listedin__parenthesesin__aclass__statements__headerline__providethe__linksto__higher superclasses. 2.Shelves__(really,the__picklemodule__they use)automatically__relinkan__instanceto__theclass__itwas__createdfrom__whenthat__instanceis__laterloaded__backinto__memory.Python__reimportsthe__classfrom__itsmodule__internallyand__createsa__newinstance__withthe__previouslystored__attributes.This__way,loaded__instancesautomatically__obtainall__theiroriginal__methods (like lastName, giveRaise,and____repr__),even__ifwe__havenot__importedthe__instances__classinto__theloading__scope. 3.It__simportant__tomove__processinginto__methodsso__thatthere__isonly__onecopy__tochange__inthe__future,and__sothat__themethods__canbe__runon__any instance.This__isPython__snotion__ofencapsulation__wrappingup__logicbehind__interfaces,to__bettersupport__futurecode__maintenance.If__youdon__tdo__so,you__createcode__redundancythat__canmultiply__yourwork__effortas__thecode__evolvesin__the future. 4.Customizing__withsubclasses__reducesdevelopment__effort.In__OOP,we__codeby__customizingwhat__hasalready__been done,rather__thancopying__orchanging__existing code.This__isthe__realbig__ideain__OOPbecause__wecan__easilyextend__ourprior__workby__codingnew__subclasses,we__canleverage__whatwe__vealready__done.This__ismuch__betterthan__eitherstarting__fromscratch__each time,or__introducingmultiple__redundantcopies__ofcode__thatmay__allhave__tobe__updatedin__the future. 5.Copying__andmodifying__codedoubles__yourpotential__workeffort__inthe__future,regardless__ofthe__context.If__asubclass__methodneeds__toperform__defaultactions__codedin__asuperclass__method,it__smuch__betterto__callback__tothe__originalthrough__thesuperclass__sname__(orthe__super built- in)than__tocopy__its code.This__alsoholds__truefor__superclass constructors. Again,copying__codecreates__redundancy,which__isa__majorissue__ascode__evolves. 6.Generic__toolscan__avoidhardcoded__solutionsthat__mustbe__keptin__syncwith__therest__ofthe__classas__itevolves__over time.A__generic__repr____print method,for__example,need__notbe__updatedeach__timea__newattribute__isadded__toinstances__inan____init__ constructor.In__addition,a__genericprint__methodinherited__byall__classesappears__andneed__bemodified__inonly__oneplace__changesin__thegeneric__versionare__pickedup__byall__classesthat__inheritfrom__thegeneric__class. Again,eliminating__coderedundancy__cutsfuture__development effort;that__sone__ofthe__primaryassets__classesbring__tothe__table. 7.Inheritance__isbest__atcoding__extensionsbased__ondirect__customization (likeour__Managerspecialization__of Person).Composition__iswell__suitedto__scenarioswhere__multipleobjects__areaggregated__intoa__wholeand__directedby__a controller-layer class.Inheritance__passescalls__upto__reuse,and__compositionpasses__downto__delegate.Inheritance__andcomposition__arenot__mutually exclusive; often,the__objectsembedded__ina__controllerare__themselvescustomizations__basedupon__inheritance. 8.Not__muchsince__thiswas__reallya__first-cut prototype,but__thelastName__methodwould__needto__beupdated__forthe__newname__format;the__Personconstructor__wouldhave__tochange__thejob__defaultto__anempty__list;and__theManager__classwould__probablyneed__topass__alonga__joblist__inits__constructorinstead__ofa__singlestring__(self-testcode__wouldchange__as well,of__course).The__goodnews__isthat__thesechanges__wouldneed__tobe__madein__justone__placein__our classes,where__suchdetails__are encapsulated.Apart__fromtheir__object-construction calls,the__databasescripts__shouldwork__as is,as__shelvessupport__arbitrarilynested__data. 9.The__classesin__thischapter__couldbe__usedas__boilerplatetemplate__codeto__implementa__varietyof__typesof__databases. Essentially,you__canrepurpose__themby__modifyingthe__constructorsto__recorddifferent__attributesand__providingwhatever__methodsare__appropriatefor__thetarget__application.For__instance,you__mightuse__attributessuch__as name, address, birthday, phone, email,and__soon__fora__contacts database,and__methodsappropriate__forthis__purpose.A__methodnamed__sendmail,for__example,might__usePython__s standard-librarysmtplib__moduleto__sendan__emailto__oneof__thecontacts__automaticallywhen__run (seePython__smanuals__or application-levelbooks__formore__detailson__such tools).The__AttrDisplaytool__wewrote__herecould__beused__verbatimto__printyour__objectsbecause__itis__intentionally generic.Most__ofthe__shelvedatabase__codehere__canbe__usedto__storeyour__objects, too,with__minor changes. 1And__nooffense__toany__managersin__the audience,of__course.This__jokewas__oncedelivered__ata__Pythonclass__inNew__Jersey,and__nobody laughed.The__organizerslater__revealedthat__theattendees__wereall__managersevaluating__Python.Hence__the silence. 2Terminology__note:this__booknow__usesthe__nounshelf__forthe__objectstorage__managedby__module shelve,and__itsplural__shelvesfor__morethan__oneshelf__managedby__shelve.In__the past,the__modules__verbname__shelvewas__alsoconfusingly__usedas__thenoun__muchto__thechagrin__ofthis__books__editorsover__the years,both__electronicand__human.Chapter__29.Class__CodingDetails__Ifyou__havent__quitegrasped__allof__PythonOOP__yet,don__tworry__nowthat__weve__takena__first pass,we__regoing__todig__abit__deeperand__studythe__conceptsintroduced__earlierin__further detail.In__thisand__thefollowing__chapter,we__lltake__anotherlook__atclass__mechanics. Here,we__llstudy__classes, methods,and__inheritance,formalizing__andexpanding__onsome__ofthe__codingideas__introducedin__Chapter 27and__demoedin__Chapter 28.Because__theclass__isour__lastnamespace__tool,we__llsummarize__Pythons__namespaceand__scopeconcepts__as well.If__youve__beenreading__linearly,some__ofthis__chapterwill__bepartly__reviewand__summaryof__topicsintroduced__inthe__precedingchapter__scase__study,revisited__hereby__languagetopics__with self-containedexamples__thatmay__helpreaders__newto__OOP.While__youmay__betempted__toskip__somematerial__here,it__includesextra__detailsworth__abrowse__andunveils__moresubtleties__inPython__sclass__modelalong__the way.The__nextchapter__continuesthis__in-depthsecond__passover__classmechanics__bycovering__onespecific__aspect:operator__overloading. First, though,let__sfill__inmore__ofthe__PythonOOP__picture.The__classStatement__Althoughthe__Pythonclass__statementmay__seemsimilar__totools__inother__OOPlanguages__onthe__surface,on__closer inspection,it__isquite__differentfrom__whatsome__programmersmay__beused__to.For__example,as__in C++,the__classstatement__isPython__smain__OOP tool,but__unlikein__C++,Python__sclass__isnot__a declaration.Like__a def,a__classstatement__isan__objectbuilder__andan__implicitassignment__when run,it__generatesa__classobject__andstores__areference__toit__inthe__nameused__inthe__header.Also__likea__def,a__classstatement__istrue__executablecode__yourclass__doesnt__existuntil__Pythonreaches__andruns__theclass__statementthat__defines it.This__typicallyoccurs__whileimporting__themodule__itis__coded in,but__not before.General__Syntaxand__UsageAs__weve__seen,class__isa__compoundstatement__witha__bodyof__statementstypically__indentedunder__the header.In__the header,superclasses__arelisted__inparentheses__afterthe__class name,separated__by commas.Listing__morethan__onesuperclass__leadsto__multiple inheritance,which__well__discussmore__formallyin__Chapter 31 (in brief,the__left-to-rightorder__ofsuperclasses__inparentheses__givesthe__search order).Here__isthe__statements__generalform__and usage:class__name(superclass, ): #Assign__toname__attr =value__#Shared__classdata__def method(self, ): #Methods__self.attr =value__# Per-instancedata__x = name( ) #Make__aninstance__x.method( ) #Call__amethod__Withinthe__class statement,any__assignmentsgenerate__classattributes__(bothdata__itemsand__callablefunctions__knownas__methods);specially__namedmethods__implement built-inoperations__(e.g.,a__functionnamed____init__is__runat__instance-objectconstruction__timeif__defined);and__callingthe__classafter__itsclass__hasrun__makesinstances__of it. Example:Class__AttributesAs__weve__also seen,classes__aremostly__justnamespaces__toolsfor__definingnames__(i.e., attributes)that__exportdata__andlogic__to clients.Just__asin__amodule__file,the__statementsnested__ina__classstatement__bodycreate__itsnamespace__and attributes.When__Pythonreaches__andruns__aclass__statement,it__runsall__thestatements__nestedin__its body,from__topto__bottom.Assignments__thathappen__duringthis__processcreate__namesin__theclass__slocal__scope,which__becomeattributes__inthe__associatedclass__object.Because__of this,classes__resembleboth__modulesand__functions:Like__functions,class__statementsare__localscopes__wherenames__createdby__nestedassignments__live.Like__modules,names__assignedin__aclass__statementbecome__attributesin__aclass__object.The__maindistinction__forclasses__isthat__theirnamespaces__arealso__thebasis__ofinheritance__in Python:referenced__attributesthat__arenot__foundin__aclass__orinstance__objectmay__befetched__fromother__classes.Because__classis__acompound__statement,any__sortof__statementcan__benested__insideits__body print, assignments, if, def,and__so on.All__thestatements__insidethe__classstatement__runwhen__theclass__statementitself__runs (notwhen__theclass__islater__calledto__makean__instance). Typically,assignment__statementsinside__theclass__statementmake__dataattributes__andnested__defsmake__method attributes.In__general, though,any__typeof__nameassignment__atthe__toplevel__ofa__classstatement__createsa__same-namedattribute__inthe__resultingclass__object.For__example,assignments__ofsimple__nonfunctionobjects__toclass__attributesproduce__dataattributes__sharedby__all instances.In__theREPL__ofyour__choosing: >>>class__SharedData:attr__= 16 #Generates__aclass__dataattribute__>>>x__= SharedData() #Make__twoinstances__>>>y__= SharedData() >>> x.attr, y.attr #They__inheritand__share 'attr' (a.k.a. SharedData.attr) (16, 16) Here,because__thename__attris__assignedat__thetop__levelof__aclass__statement,it__isattached__tothe__classwhich__meansit__willbe__sharedby__allinstances__viathe__usualinheritance__searchfrom__instanceto__class.We__canchange__itby__goingthrough__theclass__name,and__wecan__referto__itthrough__eitherinstances__orthe__class: >>> SharedData.attr = 32 >>> x.attr, y.attr, SharedData.attr (32, 32, 32)Such__classattributes__canbe__usedto__manageinformation__thatspans__allthe__instancesa__counterof__thenumber__ofinstances__generated,for__example (anidea__well__expandon__byexample__inChapter__32). Now,watch__whathappens__ifwe__assignthe__nameattr__throughan__instanceinstead__ofthe__class: >>> x.attr = 64 >>> x.attr, y.attr, SharedData.attr (64, 32, 32)Assignments__toinstance__attributescreate__orchange__thenames__inthe__instance,not__theshared__class.More__generally,inheritance__searchesoccur__onlyon__attribute references,not__onattribute__assignments:assigning__toan__objects__attributealways__changesthat__objectand__noother__(subjectto__thenote__ahead).For__example, y.attris__stilllooked__upin__theclass__by inheritance,but__theassignment__to x.attrattaches__aname__tox__itselfand__soreplaces__theversion__inthe__class.Readers__whove__doneOOP__beforemay__recognizeclass__attributeslike__SharedData.attras__similarto__otherlanguages__staticdata__membersvalues__thatare__storedin__the class,independent__of instances.In__Python,it__snothing__special:all__classattributes__arejust__namesassigned__inthe__class statement,whether__theyhappen__toreference__functionsor__something else.When__theyare__functions (a.k.a. methods),they__simplyreceive__aninstance__whencalled__through one.Here__sa__morecomprehensive__exampleof__thisbehavior__thatstores__thesame__namein__two places.Suppose__werun__thefollowing__classin__a REPL: >>>class__MixedNames: #Define__classdata__= 'text' #Assign__classattr__def __init__(self, value): #Assign__methodname__self.data =value__#Assign__instanceattr__def display(self): print(self.data, MixedNames.data) #Instance__attr,class__attrThis__classcontains__two defs,which__assignclass__attributesto__method functions.It__alsocontains__a top-level =assignment__statement;because__thisassignment__assignsthe__namedata__insidethe__class,it__livesin__theclass__slocal__scopeand__becomesan__attributeof__theclass__object.Like__allclass__attributes,this__datais__inheritedand__sharedby__allinstances__ofthe__classthat__dont__havedata__attributesof__their own.When__wemake__instancesof__this class, though,the__namedata__isalso__attachedto__thoseinstances__bythe__assignmentto__self.datain__the__init____methodrun__automaticallyat__instance-construction time: >>>x__= MixedNames(1) #Make__twoinstance__objects >>>y__= MixedNames(2) #Each__hasits__owndata__>>> x.display(); y.display() # self.data differs, MixedNames.datais__thesame__1text__2text__Thenet__resultis__thatdata__livesin__two places:in__theinstance__objects (createdby__the self.dataassignment__in __init__)and__inthe__classfrom__whichthey__inheritnames__(createdby__thedata__assignmentin__the class).The__classs__displaymethod__printsboth__versionsby__firstqualifying__theself__instanceand__thenthe__class.By__usingthese__techniquesto__storeattributes__indifferent__objects,we__determinetheir__scopeof__visibility.When__attachedto__classes,names__are shared.When__attachedto__instances,names__record per-instance data,not__sharedbehavior__or data.Although__inheritancesearches__lookup__namesfor__us,we__canalways__getto__anattribute__anywherein__atree__byaccessing__thedesired__object directly.The__objectfrom__whichan__attributeis__requestedfocuses__andlimits__search.In__thepreceding__example,for__instance,specifying__x.dataor__self.datawill__returnan__instance name,which__normallyhides__thesame__namein__the class. However, MixedNames.datagrabs__theclass__sversion__ofthe__name explicitly.The__nextsection__describesanother__commonrole__forsuch__through-the-classcoding__patternsand__explainsmore__aboutthe__waywe__deployed class-levelfetches__inthe__prior chapter.NOTE__Assignment-rule exceptions:Assigning__toan__objects__attributealways__changesonly__thatobject__unless,that__is,the__objectinherits__froma__classthat__hasredefined__attributeassignment__todo__somethingunique__withthe____setattr__ operator-overloadingmethod__(discussedin__Chapter 30)or__usesadvanced__attribute-managementtools__suchas__propertiesand__descriptors (discussedin__Chapters 32and__38).Much__ofthis__chapterpresents__thenormal__case,which__sufficesat__thispoint__inthe__bookand__formost__Python code.As__youll__see later, though,Python__classes are, well,richly__endowedwith__hooksthat__allowprograms__todeviate__fromthe__normand__rendersimple__rules fanciful.Methods__Becauseyou__alreadyknow__about functions,you__alsoknow__aboutmethods__in classes.As__youve__learned,methods__arejust__functionobjects__createdby__defstatements__nestedin__aclass__statements__body.From__anabstract__perspective,methods__providebehavior__forinstance__objectsto__inherit.From__aprogramming__perspective,methods__workin__exactlythe__sameway__assimple__functions,with__onecrucial__exception:a__methods__firstargument__receivesthe__instanceobject__thatis__theimplied__subjectof__themethod__call.By__wayof__reviewfrom__thelast__chapter,a__methodcall__madethrough__aninstance__like this: instance.method(args )is__automaticallytranslated__intoa__callof__methodfunction__ina__classlike__this: class.method(instance,args__)where__Pythondetermines__theclass__touse__bylocating__themethod__nameusing__theinheritance__search procedure.In__fact,both__callforms__arevalid__in Python:in__the second,the__classname__narrowsthe__method search,and__theinstance__isprovided__explicitly,but__thenet__resultis__thesame__forthe__same method.Besides__theinheritance__ofmethod__names,the__specialfirst__argumentis__theonly__realmagic__behindmethod__calls.In__aclass__s method,the__firstargument__isusually__calledself__byconvention__(technically,only__itsposition__is significant,not__its name).This__argumentprovides__methodswith__ahook__backto__theinstance__thatis__thesubject__ofthe__callbecause__classesgenerate__manyinstance__objects,they__useself__tomanage__per-instance data.In__Python,self__isalways__explicitin__your code:methods__mustalways__bothlist__anduse__selfto__fetchor__changeattributes__ofthe__instancebeing__processedby__thecurrent__method call.This__isby__designthe__presenceof__thisname__makesit__obviousthat__youare__usinginstance__attributenames__inyour__script,not__namesin__thelocal__orglobal__scope.Method__ExampleTo__solidifythese__concepts,let__sturn__toan__example.Define__thefollowing__classby__runningits__codein__a REPL: >>>class__NextClass: #Define__classdef__printer(self, text): #Define__method self.message =text__#Change__instance print(self.message) #Access__instanceThe__nameprinter__referencesa__normalfunction__object;because__its__assignedin__theclass__statements__scope,it__becomesa__class-objectattribute__andis__inheritedby__everyinstance__madefrom__theclass__andearns__thetitle__method. Normally,because__methodslike__printerare__designedto__process instances,we__callthem__through instances: >>>x__= NextClass() #Make__instance >>> x.printer('instance call') #Call__itsmethod__instancecall__>>> x.message #Instance__changed 'instance call'When__wecall__themethod__byqualifying__aninstance__like this,printer__isfirst__locatedby__inheritance,and__thenits__selfargument__isautomatically__assignedthe__instanceobject__(x);the__textargument__getsthe__stringpassed__atthe__call ('instance call').Notice__thatbecause__Pythonautomatically__passesthe__firstargument__toself__for us,we__can (and must)pass__injust__one argument.Inside__printer,the__nameself__isused__toaccess__orset__per-instancedata__becauseit__refersback__tothe__instancecurrently__being processed.As__weve__seen, though,methods__maybe__calledin__oneof__twoways__throughan__instanceor__throughthe__class itself.For__example,we__canalso__callprinter__bygoing__throughthe__class name,provided__wepass__aninstance__tothe__selfargument__explicitly: >>> NextClass.printer(x, 'class call') #Direct__classcall__classcall__>>> x.message #Instance__changedagain__'class call'Calls__routedthrough__theinstance__andthe__classhave__theexact__sameeffect__aslong__aswe__passthe__sameinstance__objectourselves__inthe__class form.In__fact,you__getan__errormessage__ifyou__tryto__callour__methodwithout__any instance: >>> NextClass.printer('bad call') TypeError: NextClass.printer()missing__1required__positional argument: 'text' Really,class__methodsare__justfunctions__assignedto__class attributes,some__ofwhich__happento__expectan__instancethat__Pythonprovides__automaticallyonly__whenmethods__arecalled__throughan__instance. Moreover,calling__amethod__througha__classthis__wayuses__thesame__patternwe__codedpreviously__tofetch__nonfunctionclass__attributes.This__same expression, class.attribute,works__the same,whether__theresult__isa__callableobject__or not.It__sa__general tool.Other__Method-CallPossibilities__Thispattern__ofcalling__methodsthrough__aclass__isthe__generalbasis__ofextending__insteadof__completelyreplacing__inheritedmethod__behavior.It__requiresan__explicitinstance__tobe__passedbecause__allmethods__doby__default. Technically,this__isbecause__methodscalled__throughinstances__areinstance__methodsin__theabsence__ofany__special code.In__Chapter 32,we__llalso__studya__lesscommon__option,static__methods,that__allowsus__tocode__methodsthat__donot__expectinstance__objectsin__theirfirst__arguments,even__whencalled__throughan__instance.Such__methodscan__actlike__simpleinstanceless__functions,with__namesthat__arelocal__tothe__classesin__whichthey__are coded,and__maybe__usedto__manageclass__data.A__relatedconcept__well__explorein__thesame__chapter,class__methodsreceive__aclass__whencalled__insteadof__aninstance__andcan__beused__tomanage__per-class data,and__areimplied__inmetaclasses__yetanother__topicwe__llreach__later.These__areall__advanced, optional,and__atypical extensions, though. Normally,an__instancemust__alwaysbe__passedto__amethod__whetherautomatically__whenit__iscalled__throughan__instance,or__manuallywhen__youcall__througha__class.Inheritance__Of course,the__wholepoint__ofthe__namespacecreated__bythe__classstatement__isto__supportname__inheritance.This__sectionexpands__onsome__ofthe__mechanismsand__rolesof__attributeinheritance__in Python.As__weve__seen,in__Python,inheritance__happenswhen__anobject__is qualified,and__itinvolves__searchingan__attributedefinition__treeone__ormore__namespaces.Every__timeyou__usean__expressionof__theform__object.attrwhere__objectis__aninstance__orclass__object,Python__searchesthe__namespacetree__frombottom__to top,beginning__with object,and__lookingfor__thefirst__attrit__can find.This__alsohappens__forreferences__toself__attributesin__your methods.Because__lowerdefinitions__inthe__treeoverride__higher ones,inheritance__formsthe__basisof__specialization.Attribute__TreeConstruction__Figure 29-1summarizes__theway__namespacetrees__areconstructed__andpopulated__with names. Generally:Instance__attributesare__generatedby__assignmentsto__selfattributes__in methods.Class__attributesare__createdby__statements (assignments)nested__inclass__statements.Superclass__linksare__madeby__listingclasses__inparentheses__ina__classstatement__header.Figure__29-1.Program__codecreates__atree__ofobjects__searchedby__attributeinheritance__Thenet__resultis__atree__ofattribute__namespacesthat__leadsfrom__aninstance__tothe__classit__wasgenerated__fromto__allthe__superclasseslisted__inthe__class header.Python__searchesupward__inthis__treefrom__instancesto__superclasses,and__leftto__rightthrough__multiplesuperclasses__eachtime__youfetch__anattribute__namefrom__aninstance__object.Inheritance__FinePrint__Technically speaking,the__precedingdescription__isnt__completebecause__wecan__alsocreate__instanceand__classattributes__byassigning__themto__objectsoutside__ofclass__statements.In__Python,all__attributesare__alwaysaccessible__by default,and__privacyis__an add-on (well__talkabout__attributeprivacy__inChapter__30when__westudy____setattr__,in__Chapter 31when__wemeet____X names,and__againin__Chapter 39when__weimplement__itwith__aclass__decorator).Even__so,changes__outsideof__aclass__areuncommon__and error-prone:classes__workbest__whenthey__managetheir__instances.Also__technically speaking,as__hintedin__Chapter 27,the__fullinheritance__storygrows__moreconvoluted__whenadvanced__topicswe__havent__yetmet__areadded__tothe__mix. Metaclasses, diamond-pattern MROs,and__descriptors,for__example,may__allplay__arole__insome__programs.Because__of this,we__llbegin__formalizingthe__inheritancealgorithm__inChapter__31but__wont__finishit__untilChapter__40.In__thevast__majorityof__Python code, though,inheritance__isa__simpleway__to redefine,and__hence customize,behavior__codedin__classesas__thenext__section demos.Specializing__InheritedMethods__The tree-searchingmodel__ofinheritance__justdescribed__turnsout__tobe__agreat__wayto__specialize systems.Because__inheritancefinds__namesin__subclassesbefore__itchecks__superclasses,subclasses__canreplace__defaultbehavior__byredefining__theirsuperclasses__attributes.In__fact,you__canbuild__entiresystems__ashierarchies__of classes,which__youextend__byadding__newexternal__subclassesrather__thancopying__existinglogic__orchanging__itin__place.The__ideaof__redefininginherited__namesleads__toa__varietyof__specialization techniques.For__instance,subclasses__mayreplace__inheritedattributes__completely,provide__attributesthat__asuperclass__expectsto__find,and__extendsuperclass__methodsby__callingback__tothe__superclassfrom__anoverridden__method.We__vealready__seensome__ofthese__patternsin__action;here__sa__self-containedexample__ofextension__at work: >>>class__Super:def__method(self): print('in Super.method') >>>class__Sub(Super):def__method(self): #Override__method print('starting Sub.method') #Add__actionshere__Super.method(self) #Run__defaultaction__print('ending Sub.method')Direct__superclassmethod__callsare__thecrux__ofthe__matter here.The__Subclass__replacesSuper__smethod__functionwith__itsown__specialized version,but__withinthe__replacement,Sub__callsback__tothe__versionexported__bySuper__tocarry__outthe__default behavior.In__other words, Sub.methodjust__extends Super.methods__behaviorrather__thanreplacing__it completely: >>>x__= Super() #Make__aSuper__instance >>> x.method() #Runs__Super.methodin__Super.method >>>x__= Sub() #Make__aSub__instance >>> x.method() #Runs__Sub.method,calls__Super.methodstarting__Sub.methodin__Super.methodending__Sub.methodPerhaps__themost__commonplaces__that superclass-methodcalls__showup__arein__constructors.The____init__ method,like__all attributes,is__lookedup__by inheritance.This__meansthat__atconstruction__time,Python__locatesand__callsjust__one __init__,not__onein__every superclass.If__subclassconstructors__needto__ensurethat__superclass construction-timelogic__runs too,they__mustcall__thesuperclass__s__init____method explicitly.Calling__itthrough__theclass__nameleverages__thesame__generalcoding__patternwe__vebeen__usingin__multiple roles: >>>class__Super:def____init__(self, x): print('default code') >>>class__Sub(Super):def____init__(self, x, y): Super.__init__(self, x) #Run__superclass__init____print('custom code') #Do__myextra__initactions__>>>I__= Sub(1, 2)default__codecustom__codeThis__isone__ofthe__fewcontexts__inwhich__yourcode__islikely__tocall__an operator-overloading__method directly. Naturally,you__shouldcall__thesuperclass__constructorthis__wayonly__ifyou__reallywant__itto__runwithout__the call,the__subclassreplaces__it completely.For__amore__realisticillustration__ofthis__techniquein__action,see__theManager__classexample__inthe__priorchapter__s tutorial.On__arelated__note,readers__withprior__OOPexperience__mayalso__beinterested__toknow__thatredefining__theconstructor__withdiffering__argumentlists__inthe__sameclass__meansthat__onlythe__lastis__usedlater__defssimply__reassignthe__methodname__in Python.Starred__argumentscan__beused__inthis__role,but__rarely are.We__llexplore__thisphenomenon__morefully__inChapter__31s__coverageof__polymorphism (short story:it__sabout__interfaces,not__call signatures).NOTE__Thesuper__reminder:Per__thesidebar__Thesuper__Alternative ,Python__alsohas__asuper__built-infunction__thatallows__callingback__toa__superclasss__methodsmore__generically,but__were__deferringits__coverageuntil__Chapter 32due__toits__downsidesand__complexities.As__a preview, though,the__priorsection__sfirst__ofthe__followingcan__alsobe__codedas__thesecond__whichessentially__automatesthe__selfargument__viadeep__magicbeyond__ourscope__here (noteits__lowercase): Super.method(self) # Explicit,general__tool super().method() # Implicit,special__case Likewise,the__sameequivalence__goesfor__theconstructor__callsof__this section: Super.__init__(self, x) #Explicit__fundamental super().__init__(x) #Implicit__alternativePer__theaforementioned__sidebar, though,super__has well-known trade-offsin__basicusage__andan__esotericadvanced__usecase__thatrequires__universaldeployment__tobe__most effective.Because__ofsuch__issues,this__bookprefers__tocall__superclassesby__explicitname__insteadof__super.If__youre__newto__Python,consider__followingthe__same policy,especially__foryour__firstpass__over OOP.Learn__thesimple__andgeneral__nowso__youcan__weighit__againstthe__complicatedand__narrow later.Class__InterfaceTechniques__Broadly speaking,the__priorsection__sextension__isonly__oneway__tointerface__witha__superclass.The__filelisted__inExample__29-1, specialize.py,defines__multipleclasses__thatillustrate__avariety__ofcommon__techniques:Super__Definesa__methodfunction__anda__delegatethat__expectsan__actionin__asubclass__InheritorDoesn__tprovide__anynew__names,so__itgets__everythingdefined__inSuper__ReplacerOverrides__Supers__methodwith__aversion__ofits__ownExtender__CustomizesSuper__smethod__byoverriding__andcalling__backto__runthe__defaultProvider__Implementsthe__actionmethod__expectedby__Supers__delegatemethod__Studyeach__ofthese__subclassesto__geta__feelfor__thevarious__waysthey__customizetheir__common superclass.Example__29-1. specialize.pyclass__Super:def__method(self): print('in Super.method') #Default__behaviordef__delegate(self): self.action() #Expected__tobe__definedclass__Inheritor(Super): #Inherit__methodverbatim__passclass__Replacer(Super): #Replace__methodcompletely__def method(self): print('in Replacer.method')class__Extender(Super): #Extend__methodbehavior__def method(self): print('starting Extender.method') Super.method(self) # Or: super().method() print('ending Extender.method')class__Provider(Super): #Fill__ina__requiredmethod__def action(self): print('in Provider.action')if____name__ == '__main__':for__klassin__(Inheritor, Replacer, Extender): print('\n' + klass.__name__ + '...') klass().method() print('\nProvider...')x__= Provider() x.delegate()Two__thingsare__worthpointing__out here. First,notice__howthe__self-testcode__atthe__endof__thisexample__createsinstances__ofthree__differentclasses__ina__for loop.Because__classes,like__functions,are__first-class objects,you__canstore__themin__atuple__andcreate__instancesgenerically__withno__extra syntax. Second,classes__alsohave__a built-in__name____attribute,like__modules;it__spreset__toa__stringcontaining__thename__inthe__class header.Here__swhat__happenswhen__werun__the file: $ python3 specialize.py Inheritor...in__Super.method Replacer...in__Replacer.method Extender...starting__Extender.methodin__Super.methodending__Extender.method Provider...in__Provider.actionTrace__throughthe__codeto__seehow__eachof__theseoutputs__is produced.Abstract__SuperclassesOf__theprior__examples__classes,Provider__maybe__oneof__themost__crucialto__understand.When__wecall__thedelegate__methodthrough__aProvider__instance,two__independentinheritance__searches occur: 1.On__theinitial__x.delegate call,Python__findsthe__delegatemethod__inSuper__bysearching__theProvider__instanceand__above.The__instancex__ispassed__intothe__methods__selfargument__as usual. 2.Inside__the Super.delegate method, self.actioninvokes__a new,independent__inheritancesearch__ofself__and above.Because__selfreferences__aProvider__instance,the__actionmethod__islocated__inthe__Provider subclass.This__fillingin__theblanks__sortof__codingstructure__istypical__ofOOP__frameworks.In__amore__realistic context,the__methodfilled__inthis__waymight__handlean__eventin__a GUI,provide__datato__berendered__aspart__ofa__web page,process__atag__stext__inan__XML file,and__soon__yoursubclass__providesspecific__actions,but__theframework__handlesthe__restof__theoverall__joband__runsyour__actionswhen__needed.At__leastin__termsof__thedelegate__method,the__superclassin__thisexample__iswhat__issometimes__calledan__abstractsuperclass__aclass__thatexpects__partsof__itsbehavior__tobe__providedby__its subclasses.If__anexpected__methodis__notdefined__ina__subclass,Python__raisesan__undefinedname__exceptionwhen__theinheritance__search fails.Class__coderssometimes__makesuch__subclassrequirements__moreobvious__withassert__statementsor__byraising__the built-inNotImplementedError__exceptionwith__raise statements.We__llstudy__statementsthat__maytrigger__exceptionsin__depthin__thenext__partof__this book;as__aquick__preview,here__sthe__assertscheme__in action: >>>class__Super:def__delegate(self): self.action()def__action(self):assert__False, 'actionmust__be defined!' #Error__ifcalled__>>>X__= Super() >>> X.delegate() AssertionError:action__mustbe__defined!We__llstudy__assertin__Chapters 33and__34;in__short,if__itsfirst__expressionevaluates__to false,it__raisesan__exceptionwith__theprovided__error message. Here,the__expressionis__alwaysfalse__soas__totrigger__anerror__messageif__amethod__isnot__redefined,and__inheritancelocates__thestub__version here. Alternatively,some__classessimply__raisea__NotImplementedErrorexception__directlyin__suchmethod__stubsto__signalthe__mistake: >>>class__Super:def__delegate(self): self.action()def__action(self):raise__NotImplementedError('actionmust__be defined!') >>>X__= Super() >>> X.delegate() NotImplementedError:action__mustbe__defined!For__instancesof__subclasses,we__stillget__theexception__unlessthe__subclassprovides__theexpected__methodto__replacethe__defaultin__the superclass: >>>class__Sub(Super):pass__>>>X__= Sub() >>> X.delegate() NotImplementedError:action__mustbe__defined! >>>class__Sub(Super):def__action(self): print('okay') >>>X__= Sub() >>> X.delegate()okay__Fora__somewhatmore__realisticexample__ofthis__sections__conceptsin__action,see__theZoo__animalhierarchy__exercise (Exercise 8)in__TestYour__Knowledge:Part__VIExercises__andits__solutionin__Appendix B.Such__taxonomiesare__atraditional__wayto__introduce OOP,but__theyre__abit__removedfrom__mostdevelopers__jobdescriptions__(withapologies__toany__readerswho__happento__workat__the zoo). Preview:Abstract__superclasseswith__librarytools__Thepreceding__abstractsuperclasses__(a.k.a.abstract__baseclasses__),which__requiremethods__tobe__filledin__by subclasses,may__alsobe__implementedwith__specialclass__syntaxand__alibrary__module.This__iscoded__witha__keywordargument__ina__class header,along__withspecial__@decorator__syntax,both__ofwhich__well__studylater__inthis__book.While__necessarilya__previewin__part,here__isthe__specialsyntax__equivalentof__thepreceding__example: >>>from__abcimport__ABCMeta,abstractmethod__>>>class__Super(metaclass=ABCMeta):def__delegate(self): self.action() @abstractmethoddef__action(self):pass__Thenet__effectmore__rigidlyprevents__instancecreation__unlessthe__methodis__definedlower__inthe__class tree: >>>X__= Super() TypeError: Can'tinstantiate__abstractclass__Superwithout__animplementation__forabstract__method 'action' >>>class__Sub(Super):pass__>>>X__= Sub() TypeError: Can'tinstantiate__abstractclass__Subwithout__animplementation__forabstract__method 'action' >>>class__Sub(Super):def__action(self): print('okay') >>>X__= Sub() >>> X.delegate()okay__Codedthis__way,a__classwith__anabstract__methodcannot__beinstantiated__(that is,we__cannotcreate__aninstance__bycalling__it)unless__allof__itsabstract__methodshave__beendefined__in subclasses.Although__thisrequires__morecode__andextra__knowledge,the__potentialadvantage__ofthis__approachis__thaterrors__formissing__methodsare__issuedwhen__weattempt__tomake__aninstance__ofthe__class,not__laterwhen__wetry__tocall__amissing__method.This__schememay__alsobe__usedto__definean__expected interface,automatically__verifiedin__client classes. Unfortunately,this__schemealso__relieson__twoadvanced__languagetools__wehave__notmastered__yetfunction__decorators,introduced__inChapter__32and__coveredin__depthin__Chapter 39,as__wellas__metaclass declarations,mentioned__inChapter__32and__coveredin__Chapter 40so__wewill__postponeother__facetsof__thisoption__here.See__Pythons__standardmanuals__formore__on this,as__wellas__precodedabstract__superclassesPython__provides. Namespaces:The__ConclusionNow__thatwe__veexamined__classand__instance objects,the__Pythonnamespace__storyis__complete.For__reference,this__sectionsummarizes__allthe__rulesused__toresolve__namesand__extendsthem__to classes.The__firstthings__youneed__toremember__arethat__qualifiedand__unqualifiednames__aretreated__differently,and__thatsome__scopesserve__toinitialize__object namespaces:Unqualified__names (e.g., X)deal__with scopes.Qualified__attributenames__(e.g., object.X)use__object namespaces.Some__scopesinitialize__objectnamespaces__(formodules__and classes).These__conceptssometimes__interactin__object.X,for__example,object__isfirst__lookedup__per scopes,and__thenX__islooked__upin__thelocated__object.Since__scopesand__namespacesare__essentialto__understandingPython__code,let__sflesh__outthe__rulesin__more detail.Simple__Names:Global__UnlessAssigned__Aswe__ve seen,unqualified__simplenames__followthe__LEGBlexical__scopingrule__outlinedwhen__weexplored__functionsin__Chapter 17:Assignment__(X = value)Makes__nameslocal__by default:creates__orchanges__thename__Xin__thecurrent__local scope,unless__declaredglobal__ornonlocal__inthat__scope.These__declarationswork__inboth__deffor__functionsand__classfor__classes.Reference__(X)Looks__forthe__nameX__inthe__currentlocal__scope (L),then__anyand__allenclosing__functionsfrom__innerto__outer (E),then__thecurrent__global-scopemodule__(G),then__the built-insmodule__(B)per__theLEGB__rule.Notably__absent here,enclosing__classesare__not searched;class__namesare__referencedas__objectattributes__instead.Also__perChapter__17,some__special-caseconstructs__localizenames__further (e.g.,variables__insome__comprehensionsand__sometry__statement clauses),and__nestedclass__scopescurrently__havesome__peculiaritiesthat__reflectlongstanding__bugreports__andare__tooobscure__tomerit__coverage here.The__vastmajority__of names, however,follow__theLEGB__rule.New__here,the__classstatement__allowsglobal__andnonlocal__tomodify__assignmentrules__thesame__as def,though__wehave__tonest__itto__seehow__thelatter__ofthese__come online: >>>gvar__= 111 >>>class__C:global__gvar #Change__namegvar__inenclosing__modulegvar__= 222 #Else__itwould__beclass__attribute C.gvar >>>gvar__222 >>>def__outer():nvar__= 111class__C:nonlocal__nvar #Change__namenvar__inenclosing__functionnvar__= 222 #Else__itwould__beclass__attribute C.nvar print(nvar) >>> outer() 222Though__rare,namespace__declarationsin__classmap__assignmentsto__outer scopes,instead__ofmaking__classattributes__thesame__waythey__preventassignments__frommaking__localvariables__in functions.There__smore__onhow__nestedclasses__interactwith__scopesin__defaultcases__laterin__this section.Attribute__Names:Object__NamespacesWe__vealso__seenthat__qualifiedattribute__namesrefer__toattributes__ofspecific__objectsand__obeythe__rulesfor__modulesand__classes.For__classand__instance objects,the__referencerules__areaugmented__toinclude__theinheritance__search procedure:Assignment__(object.X = value)Creates__oralters__theattribute__nameX__inthe__namespaceof__theobject__being qualified,and__none other. Inheritance-treeclimbing__happensonly__onattribute__reference,not__onattribute__assignment.Reference__(object.X)For__class-based objects,searches__forthe__attributename__Xin__object,then__inall__accessibleclasses__above it,using__theinheritance__search procedure.For__nonclassobjects__suchas__modules,fetches__Xfrom__object directly.As__noted earlier,the__precedingcaptures__thenormal__casefor__typical code,but__theseattribute__rulescan__varyin__classesthat__utilizemore__advancedtools__youll__meet later.For__example,reference__inheritancecan__bericher__thanimplied__herewhen__metaclassesare__deployed,and__classesthat__leverageattribute__managementtools__suchas__properties, descriptors,and____setattr__can__interceptand__routeattribute__assignments arbitrarily.In__fact,some__inheritanceis__runon__assignment, too,to__locatedescriptors__witha____set__ method;such__toolsoverride__thenormal__rulesfor__bothreference__and assignment.We__llexplore__attributemanagement__toolsin__depthin__Chapter 38and__formalizeinheritance__andits__useof__descriptorsin__Chapter 40.For__now,most__readersshould__focuson__thenormal__rulesgiven__here,which__covermost__Pythonapplication__codeyou__relikely__to read, write,or__run.The__Zenof__Namespaces:Assignments__ClassifyNames__Withdistinct__searchprocedures__forqualified__andunqualified__names,and__multiplelookup__layersfor__both,it__cansometimes__bedifficult__totell__wherea__namewill__windup__going.In__Python,the__placewhere__youassign__aname__iscrucial__itfully__determinesthe__scopeor__objectin__whicha__namewill__reside.The__filein__Example 29-2, manynames.py,illustrates__howthis__principletranslates__tocode__andsummarizes__thenamespace__ideaswe__haveseen__throughoutthis__book (sansobscure__special-casescopes__like comprehensions):Example__29-2. manynames.py (first half)X__= 11 #Global__(module)X__(manynames.Xpost__import)def__f(): print(X) #Access__globalX__perLEGB__lookupdef__g():X__= 22 #Local__(function)X__(hidesmodule__X) print(X)class__C:X__= 33 #Class__attribute C.X (self.Xpre__self.m())def__m(self):X__= 44 #Local__(function)X__inmethod__(unused here) self.X = 55 #Instance__attribute self.X (hidesclass__X)This__fileassigns__thesame__name, X,five__times illustrative,though__notexactly__best practice!Because__thisname__isassigned__infive__different locations, though,all__fiveXs__inthis__programare__completelydifferent__variables.From__topto__bottom,the__assignmentsto__Xhere__generatea__moduleattribute__(11),a__localvariable__ina__function (22),a__classattribute__(33),a__localvariable__ina__method (44),and__aninstance__attribute (55).Although__allfive__arenamed__X,the__factthat__theyare__allassigned__atdifferent__placesin__thesource__codeor__todifferent__objectsmakes__allof__theseunique__variables.You__shouldstudy__thisexample__carefullybecause__itcollects__ideaswe__vebeen__exploringthroughout__thelast__fewparts__ofthis__book.When__itmakes__senseto__you,you__willhave__achievedPython__namespace enlightenment.Or__youcan__runthe__codeand__seewhat__happensExample__29-3lists__theremainder__ofthe__sourcefile__inExample__29-2,with__self-testcode__thatmakes__aninstance__andprints__allthe__Xsthat__itcan__fetch.Example__29-3. manynames.py (second half)if____name__ == '__main__': print(X) # 11:module__(a.k.a. manynames.Xoutside__file) f() # 11:global__g() # 22:local__print(X) # 11:module__nameunchanged__I = C() #Make__instance print(I.X) # 33:class__nameinherited__byinstance__I.m() #Attach__attributename__Xto__instancenow__print(I.X) # 55:instance__print(C.X) # 33:class__(a.k.a. I.Xif__noX__in I) #print(C.m.X) # FAILS:only__visiblein__method #print(g.X) # FAILS:only__visiblein__functionThe__outputsthat__areprinted__whenthe__fileis__runare__notedin__thecomments__inthe__code;trace__throughthem__tosee__whichvariable__namedX__isbeing__accessedeach__time.Notice__inparticular__thatwe__cango__throughthe__classto__fetchits__attribute (C.X),but__wecan__neverfetch__localvariables__infunctions__ormethods__fromoutside__theirdef__statements.Locals__arevisible__onlyto__othercode__withinthe__def, and,in__fact,only__livein__memorywhile__acall__tothe__functionor__methodis__executing.Some__ofthe__namesdefined__bythis__fileare__visibleoutside__thefile__toother__modules, too,but__recallthat__wemust__alwaysimport__beforewe__canaccess__namesin__anotherfile__namesegregation__isthe__mainpoint__of modules,after__all.Example__29-4shows__hownames__appearoutside__themodule__inExample__29-3,again__withexpected__outputsin__comments:Example__29-4. manynames-client.pyimport__manynamesX__= 66 print(X) # 66:the__globalhere__print(manynames.X) # 11:globals__becomeattributes__afterimports__manynames.f() # 11: manynames's X,not__theone__here! manynames.g() # 22:local__inother__file'sfunction__print(manynames.C.X) # 33:attribute__ofclass__inother__moduleI__= manynames.C() print(I.X) # 33:still__fromclass__here I.m() print(I.X) # 55:now__from instance!Notice__herehow__manynames.f()prints__theX__in manynames,not__theX__assignedin__thisfile__scopesare__alwaysdetermined__bythe__positionof__assignmentsin__yoursource__code (i.e., lexically)and__arenever__influencedby__whatimports__whator__whoimports__whom. Also,notice__thatthe__instances__ownX__isnot__createduntil__wecall__I.m() attributes,like__all variables,spring__intoexistence__when assigned,and__not before. Normally,we__createinstance__attributesby__assigningthem__inclass____init__constructor__methods,but__thisisn__tthe__only option. Finally,as__coveredin__Chapter 17,it__salso__possiblefor__afunction__tochange__namesoutside__itselfwith__globaland__nonlocalstatements__thesestatements__providewrite__access,but__alsomodify__assignments__namespacebinding__rules.Example__29-5provides__arefresher__onthese__points.Example__29-5. funcscope.pyX__= 11 #Global__inmodule__def g1(): print(X) #Reference__globalin__module (11)def__g2():global__XX__= 22 #Change__globalin__moduledef__h1():X__= 33 #Local__infunction__def nested(): print(X) #Reference__localin__enclosingscope__(33)def__h2():X__= 33 #Local__infunction__def nested():nonlocal__XX__= 44 #Change__localin__enclosingscope__Of course,you__generallyshouldn__tuse__thesame__namefor__everyvariable__inyour__scriptbut__asthis__example demonstrates,even__ifyou__do,Python__snamespaces__willwork__tokeep__namesused__inone__contextfrom__accidentallyclashing__withthose__usedin__another.Nested__Classes:The__LEGBScopes__RuleRevisited__Thepreceding__examplesummarized__theeffect__ofnested__functionson__scopes,which__westudied__inChapter__17.As__wesaw__brieflynear__thestart__ofthis__section,classes__canbe__nested,too__auseful__codingpattern__insome__typesof__programs.This__hasscope__implicationsthat__follownaturally__fromwhat__youalready__know,but__thatmay__notbe__obviouson__first encounter.This__sectionillustrates__theconcept__by example.Though__theyare__normallycoded__atthe__toplevel__ofa__module,classes__alsoappear__nestedin__functionsthat__generatethem__avariation__onthe__factoryfunction__(a.k.a. closure)theme__inChapter__17,with__similarstate__retention roles. There,we__notedthat__classstatements__introducenew__local scopes,much__likefunction__def statements,which__followthe__sameLEGB__scopelookup__ruleas__function definitions.This__ruleapplies__bothto__thetop__levelof__theclass__itselfas__wellas__tothe__toplevel__ofmethod__functionsnested__within it.Both__formthe__Llayer__inthis__rulethey__arelocal__scopeswith__accessto__their names,names__inany__enclosing functions,globals__inthe__enclosing module,and__built-ins.Like__modules,the__classs__localscope__morphsinto__anattribute__namespaceafter__theclass__statementis__run,but__its top-levelcode__isa__localscope__whilethe__class runs. Importantly, though,although__classeshave__accessto__enclosingfunctions__scopes,they__donot__themselvesact__asenclosing__scopesto__codenested__withinthe__classPython__searchesenclosing__functionsfor__referencednames__butnever__anyenclosing__classes.That__is,a__classis__alocal__scopeand__hasaccess__toenclosing__local scopes,but__itdoes__notserve__asan__enclosinglocal__scopeto__furthernested__code.Because__thesearch__fornames__usedin__methodfunctions__skipsthe__enclosing class,class__attributesmust__befetched__asobject__attributesusing__inheritance.For__example,in__thenester__functionof__Example 29-6,all__referencesto__Xare__routedto__theglobal__scopeexcept__the last,which__picksup__a local-scoperedefinition__in method2 (theoutput__ofeach__examplein__thissection__isdescribed__inits__lasttwo__comments).Example__29-6. classscope1.pyX__= 1def__nester(): print(X) # Global: 1class__C: print(X) # Global: 1def__method1(self): print(X) # Global: 1def__method2(self):X__= 3 #Hides__global print(X) # Local: 3I__= C() I.method1() I.method2() print(X) # Global: 1 nester() # Rest: 1, 1, 1, 3Watch__what happens, though,when__wereassign__thesame__namein__nestedfunction__layersin__Example 29-7:the__redefinitionsof__Xcreate__localsthat__hidethose__inenclosing__scopes,just__asfor__simplenested__functions;the__enclosingclass__layerdoes__notchange__this rule,and__infact__isirrelevant__to it.Example__29-7. classscope2.pyX__= 1def__nester():X__= 2 #Hides__global print(X) # Local: 2class__C: print(X) #In__enclosingdef__(nester): 2def__method1(self): print(X) #In__enclosingdef__(nester): 2def__method2(self):X__= 3 #Hides__enclosing (nester) print(X) # Local: 3I__= C() I.method1() I.method2() print(X) # Global: 1 nester() # Rest: 2, 2, 2, 3 Finally,Example__29-8shows__whathappens__whenwe__reassignthe__samename__atmultiple__stopsalong__the way:assignments__inthe__localscopes__ofboth__functionsand__classeshide__globalsor__enclosingfunction__localsof__thesame__name,regardless__ofthe__nesting involved.Example__29-8. classscope3.pyX__= 1def__nester():X__= 2 #Hides__global print(X) # Local: 2class__C:X__= 3 #Class__localhides__nester's: C.Xor__I.X (not scoped) print(X) # Local: 3def__method1(self): print(X) #In__enclosingdef__(not 3in__class!): 2 print(self.X) #Inherited__class local: 3def__method2(self):X__= 4 #Hides__enclosing (nester,not__class) print(X) # Local: 4 self.X = 5 #Hides__class's print(self.X) #Located__in instance: 5I__= C() I.method1() I.method2() print(X) # Global: 1 nester() # Rest: 2, 3, 2, 3, 4, 5Most__importantly,the__lookuprules__forsimple__nameslike__Xnever__searchenclosing__classstatements__just defs, modules,and__built-ins (its__theLEGB__rule,not__LCEGB!).In__method1,for__example,X__isfound__ina__defoutside__theenclosing__classthat__hasthe__samename__inits__local scope.To__getto__namesassigned__inthe__class (e.g., methods),we__mustfetch__themas__classor__instanceobject__attributes,via__self.Xin__this case.Believe__itor__not,you__llsee__validroles__forthis__nested-classescoding__patternlater__inthis__book,especially__insome__ofChapter__39s__decorators.In__this role,the__enclosingfunction__usuallyboth__servesas__aclass__orinstance__factoryand__providesretained__statefor__lateruse__inthe__enclosedclass__orits__methods.Namespace__Dictionaries:Review__InChapter__23,we__sawthat__modulenamespaces__havea__concreteimplementation__as dictionaries,exposed__withthe__built-in__dict____attribute.In__Chapters 27and__28,we__sawthat__thesame__holdstrue__forclass__andinstance__objectsattribute__qualificationis__mostlya__dictionaryindexing__operation internally,and__attributeinheritance__islargely__amatter__ofsearching__linked dictionaries.In__fact,within__Python,instance__andclass__objectsare__mostlyjust__dictionarieswith__linksbetween__them.Python__exposesthese__dictionaries,as__wellas__their links,for__usein__advanced roles.We__putsome__ofthese__toolsto__workin__theprior__chapter,but__tosummarize__andhelp__youbetter__understandhow__attributeswork__internally,let__swork__throughan__interactivesession__thattraces__theway__namespacedictionaries__growwhen__classesare__involved.Now__thatwe__knowmore__aboutmethods__and superclasses,we__canalso__embellishthe__coveragehere__fora__better look. First,let__sdefine__asuperclass__anda__subclasswith__methodsthat__willstore__datain__their instances: >>>class__Super:def__hello(self): self.data1 = 'hack' >>>class__Sub(Super):def__hola(self): self.data2 = 'code'When__wemake__aninstance__ofthe__subclass,the__instancestarts__outwith__anempty__namespace dictionary,but__ithas__linksback__tothe__classfor__theinheritance__searchto__follow.In__fact,the__inheritancetree__isexplicitly__availablein__special attributes,which__youcan__inspect.Instances__havea____class__attribute__thatlinks__totheir__class,and__classeshave__a__bases____attributethat__isa__tuplecontaining__linksto__higher superclasses: >>>X__= Sub() >>> X.__dict__ #Instance__namespacedict__{} >>> X.__class__ #Class__ofinstance__>>> Sub.__bases__ #Superclasses__ofclass__(,) >>> Super.__bases__ #Implied__above top-levels (,)As__classesassign__toself__attributes,they__populatethe__instanceobjects__that is,attributes__windup__inthe__instancesattribute__namespace dictionaries,not__inthe__classes .An__instanceobject__snamespace__recordsdata__thatcan__varyfrom__instanceto__instance,and__selfis__ahook__intothat__namespace: >>>Y__= Sub() >>> X.hello() >>> X.__dict__ {'data1': 'hack'} >>> X.hola() >>> X.__dict__ {'data1': 'hack', 'data2': 'code'} >>> list(Sub.__dict__.keys()) ['__module__', 'hola', '__doc__'] >>> list(Super.__dict__.keys()) ['__module__', 'hello', '__dict__', '__weakref__', '__doc__'] >>> Y.__dict__ {}Notice__theextra__underscorenames__inthe__class dictionaries;Python__setsthese__automatically,and__wecan__filterthem__outwith__thegenerator__expressionswe__codedin__Chapters 27and__28omitted__herefor__space.Most__arenot__usedin__typicalprograms__butmay__beused__bytools__(e.g.,__doc____holdsthe__docstringsdiscussed__inChapter__15). Also,observe__that Y,a__secondinstance__madeat__thestart__ofthis__series,still__hasan__emptynamespace__dictionaryat__the end,even__thoughX__sdictionary__hasbeen__populatedby__assignmentsin__methods. Again,each__instancehas__anindependent__namespace dictionary,which__startsout__emptyand__canrecord__completelydifferent__attributesthan__thoserecorded__bythe__namespacedictionaries__ofother__instancesof__thesame__class.Because__instanceattributes__areactually__dictionarykeys__inside Python,there__arereally__twoways__tofetch__andassign__theirvalues__byqualification__orby__key indexing: >>> X.data1, X.__dict__['data1'] ('hack', 'hack') >>> X.data3 = 'docs' >>> X.__dict__ {'data1': 'hack', 'data2': 'code', 'data3': 'docs'} >>> X.__dict__['data3'] = 'apps' >>> X.data3 'apps'This__equivalenceapplies__onlyto__attributesactually__attachedto__the instance, though.Because__attributefetch__qualificationalso__performsan__inheritance search,it__canaccess__inheritedattributes__thatnamespace__dictionaryindexing__cannot.The__inheritedattribute__X.hello,for__instance,cannot__beaccessed__by X.__dict__['hello'].Experiment__withthese__specialattributes__onyour__ownto__geta__betterfeel__forhow__namespacesactually__dotheir__attribute business. Also,try__runningthese__objectsthrough__thedir__functionwe__metin__theprior__twochapters__dir(X)is__similarto__X.__dict__.keys(),but__dirsorts__itslist__andincludes__inherited attributes.Even__ifyou__willnever__usethese__inthe__kindsof__programsyou__write,seeing__howattributes__arestored__canhelp__solidifynamespaces__in general.NOTE__Theslots__exception:In__Chapter 32,you__lllearn__about slots,an__advancedclass__toolthat__storesattributes__ininstances__butnot__intheir__namespace dictionaries.It__stempting__totreat__theseas__class attributes,and__indeed,they__appearin__classnamespaces__wherethey__manage per-instance values.As__youll__find, though,slots__mayprevent__a__dict____frombeing__createdin__theinstance__apotential__thatgeneric__toolsmust__sometimesaccount__forby__using storage-neutral built-inslike__dirto__listand__getattrto__fetch.The__goodnews__isthat__slotsare__usedvery__rarelyas__theyshould__be!Namespace__Links:A__TreeClimber__Theprior__sectiondemonstrated__thespecial____class__and____bases__instance__andclass__attributeswithout__reallyexplaining__whyyou__mightcare__about them.In__short,these__attributesallow__youto__inspectinheritance__hierarchieswithin__yourown__code.For__example,they__canbe__usedto__displaya__class tree,as__codedin__themodule__ofExample__29-9.Example__29-9. classtree.py """ classtree.py:Climb__inheritancetrees__usingnamespace__links,displaying__highersuperclasses__withindentation__forheight__"""def__classtree(cls, indent): print('.' *indent__+ cls.__name__) #Print__classname__herefor__superclsin__cls.__bases__: #Recur__toall__superclasses classtree(supercls, indent+3) #May__visitsuper__>once__def instancetree(inst): print('Tree of', inst) #Show__instance classtree(inst.__class__, 3) #Climb__toits__classdef__selftest():class__A:pass__class B(A):pass__class C(A):pass__class D(B,C):pass__class E:pass__class F(D,E):pass__instancetree(B()) instancetree(F())if____name__ == '__main__': selftest()The__classtreefunction__inthis__scriptis__recursiveit__printsa__classs__nameusing____name__,then__climbsup__tothe__superclassesby__calling itself.This__allowsthe__functionto__traversearbitrarily__shapedclass__trees;the__recursionclimbs__tothe__topand__stopsat__rootsuperclasses__thathave__empty__bases____attributes.As__exploredin__Chapter 19,when__using recursion,each__activelevel__ofa__functiongets__itsown__copyof__thelocal__scope. Here,this__meansthat__clsand__indentare__differentat__eachclasstree__level.Most__ofthis__fileis__self-test code.When__run standalone,it__buildsan__emptyclass__tree,makes__twoinstances__from it,and__printstheir__classtree__structures.The__treesinclude__theimplied__objectsuperclass__thatis__automaticallyadded__abovestandalone__root (i.e., topmost) classes;there__smore__onobject__inChapter__32: $ python3 classtree.pyTree__of <__main__.selftest..Bobject__at 0x10733a000> ...B ......A .........objectTree__of <__main__.selftest..Fobject__at 0x10733a000> ...F ......D .........B ............A ...............object .........C ............A ...............object ......E .........object Here,indentation__markedby__periodsis__usedto__denoteclass__tree height.Of__course,we__couldimprove__onthis__outputformat__andperhaps__evensketch__itin__aGUI__display.Even__as is, though,we__canimport__thesefunctions__anywherewe__wanta__quickdisplay__ofa__physicalclass__tree: $ python3 >>>class__Employee:pass__>>>class__Person(Employee):pass__>>>pat__= Person() >>>import__classtree >>> classtree.instancetree(pat)Tree__of <__main__.Personobject__at 0x1072a1b80> ...Person ......Employee .........objectRegardless__ofwhether__youwill__evercode__oruse__such tools,this__exampledemonstrates__oneof__themany__waysthat__youcan__makeuse__ofspecial__attributesthat__exposeinterpreter__internals.You__llsee__otherswhen__wecode__general-purpose__classdisplay__toolsin__MultipleInheritance__andthe__MRO there,we__willextend__thistechnique__toalso__displayattributes__ineach__objectin__aclass__treeand__functionas__areusable__superclass.In__thelast__partof__this book,we__llrevisit__suchtools__inthe__contextof__Pythontool__buildingat__large,to__codetools__thatimplement__attribute privacy,argument__validation,and__more.While__notin__everyPython__programmers__job description,access__tointernals__enablespowerful__development tools.Documentation__StringsRevisited__Thelast__sections__exampleincludes__adocstring__forits__module,but__rememberthat__docstringscan__beused__forclass__componentsas__well. Docstrings,which__wecovered__indetail__inChapter__15,are__stringliterals__thatshow__upat__thetop__ofvarious__structuresand__areautomatically__savedby__Pythonin__thecorresponding__objects__doc____attributes.This__worksfor__module files,function__defs,and__classesand__methods.Now__thatwe__veseen__moreabout__classesand__methods,Example__29-10, a.k.a. docstr.py,provides__aquick__butcomprehensive__examplethat__summarizesthe__placeswhere__docstringscan__showup__inyour__code.All__ofthese__canbe__triple-quoted__blocksor__simpler one-linerliterals__likethose__here.Example__29-10. docstr.py "I am: docstr.__doc__"def__func(args): "I am: docstr.func.__doc__"pass__class Klass: "I am: Klass.__doc__or__docstr.Klass.__doc__or__self.__doc__"def__method(self): "I am: Klass.method.__doc__or__self.method.__doc__" print(self.__doc__) print(self.method.__doc__)The__mainadvantage__ofdocumentation__stringsis__thatthey__stickaround__at runtime. Thus,if__its__beencoded__asa__docstring,you__canqualify__anobject__withits____doc__attribute__tofetch__itsdocumentation__(callingprint__onthe__resultinterprets__linebreaks__ifit__sa__multiline string): $ python3 >>>import__docstr >>> docstr.__doc__ 'I am: docstr.__doc__' >>> docstr.func.__doc__ 'I am: docstr.func.__doc__' >>> docstr.Klass.__doc__ 'I am: Klass.__doc__or__docstr.Klass.__doc__or__self.__doc__' >>> docstr.Klass.method.__doc__ 'I am: Klass.method.__doc__or__self.method.__doc__' >>>x__= docstr.Klass() >>> x.method()I__am: Klass.__doc__or__docstr.Klass.__doc__or__self.__doc__I__am: Klass.method.__doc__or__self.method.__doc__A__discussionof__thePyDoc__tool,which__knowshow__toformat__allthese__stringsin__reportsand__web pages,appears__inChapter__15.Here__itis__runningits__helpfunction__onour__code: >>> help(docstr)Help__onmodule__docstr:NAME__docstr -I__am: docstr.__doc__CLASSES__builtins.objectKlass__class Klass(builtins.object) |I__am: Klass.__doc__or__docstr.Klass.__doc__or__self.__doc__ | |Methods__defined here: | | method(self) |I__am: Klass.method.__doc__or__self.method.__doc__ | | ---------------------------------------------------------------------- |Data__descriptorsdefined__here: | |__dict____|dictionary__forinstance__variables | |__weakref____|list__ofweak__referencesto__theobject__FUNCTIONS func(args)I__am: docstr.func.__doc__FILE__/ /LP6E/Chapter29/docstr.pyDocumentation__stringsare__availableat__runtime,but__theyare__lessflexible__syntacticallythan__# comments,which__canappear__anywherein__a program.Both__formsare__useful,and__anyprogram__documentationis__good (aslong__asit__s accurate,of__course!).As__stated before,the__Pythonbest__practicerule__ofthumb__isto__usedocstrings__for higher-levelfunctional__documentationand__hash-markcomments__formore__fine-grainedcoding__documentation.Classes__VersusModules__Finally,let__swrap__upthis__chapterby__brieflycomparing__thetopics__ofthis__books__lasttwo__parts:modules__and classes.Because__theyre__bothabout__namespaces,the__distinctioncan__be confusing.In__short:Modules__Implement data+logicpackages__Arecreated__withPython__filesor__other-languageextensions__Areused__bybeing__importedForm__thetop__levelin__Pythonprogram__structureClasses__Implementnew__full-featuredobjects__Arecreated__withclass__statementsAre__usedby__beingcalled__Alwayslive__withina__moduleClasses__alsosupport__extrafeatures__thatmodules__don t,such__asoperator__overloading,multiple__instance generation,and__inheritance.Although__bothclasses__andmodules__are namespaces,you__shouldbe__ableto__tellby__nowthat__theyare__verydifferent__things.We__needto__moveahead__tosee__justhow__uniqueclasses__can be.Chapter__SummaryThis__chaptertook__uson__a second,more__in-depthtour__ofthe__OOPmechanisms__ofthe__Python language.We__learnedmore__about classes, methods,and__inheritance,and__wewrapped__upthe__namespacesand__scopesstory__inPython__byextending__itto__coverits__applicationto__classes.Along__the way,we__encounteredcore__OOPconcepts__suchas__abstract superclasses,class__data attributes,namespace__links,and__manualcalls__tosuperclass__methodsand__constructors.Now__thatwe__veexplored__allthe__basicmechanics__ofcoding__classesin__Python,the__nextchapter__turnsto__aspecific__facetof__those mechanics:operator__overloading.After__that,we__llexplore__commondesign__patterns,looking__atsome__ofthe__waysthat__classesare__commonlyused__andcombined__tooptimize__code reuse.Before__youread__ahead, though,be__sureto__workthrough__theusual__chapterquiz__toreview__whatwe__vecovered__here.Test__Your Knowledge:Quiz__1.What__isan__abstract superclass? 2.What__happenswhen__asimple__assignmentstatement__appearsat__thetop__levelof__aclass__statement? 3.Why__mighta__classneed__tomanually__callthe____init__method__ina__superclass? 4.How__canyou__augment,instead__ofcompletely__replacing,an__inherited method? 5.How__doesa__classs__localscope__differfrom__thatof__a function?Test__Your Knowledge:Answers__1.An__abstractsuperclass__isa__classthat__callsa__method,but__doesnot__inheritor__defineit__itexpects__themethod__tobe__filledin__bya__subclass.This__isoften__usedas__away__togeneralize__classeswhen__behaviorcannot__bepredicted__untila__morespecific__subclassis__coded.OOP__frameworksalso__usethis__asa__wayto__dispatchto__client-defined,customizable__operations. 2.When__asimple__assignmentstatement__(X = Y)appears__atthe__toplevel__ofa__class statement,it__attachesa__dataattribute__tothe__class (Class.X).Like__allclass__attributes,this__willbe__sharedby__allinstances__thatdo__nothave__thesame__attribute.Methods__aregenerally__createdinstead__bydef__statementsnested__ina__class. 3.A__classmust__manuallycall__the__init____methodin__asuperclass__ifit__definesan____init__constructor__ofits__ownand__stillwants__thesuperclass__sconstruction__codeto__run (andit__often will).Python__itselfautomatically__runsjust__oneconstructor__thelowest__onein__theinheritance__tree.Superclass__constructorsare__oftencalled__throughthe__class name,passing__inthe__selfinstance__manually: Superclass.__init__(self, );they__mayalso__becalled__by super().__init__( ),though__wehaven__tyet__studiedthis__formin__full. 4.To__augmentinstead__ofcompletely__replacingan__inherited method,redefine__itin__a subclass,but__callback__tothe__superclasss__versionof__themethod__manuallyfrom__thenew__versionof__themethod__inthe__subclass.That__is,pass__theself__instanceto__thesuperclass__sversion__ofthe__method manually: Superclass.method(self, );or__doso__implicitlywith__super().method( ).The__prioranswer__isreally__justa__specialcase__ofthis__one. 5.A__classis__alocal__scopeand__hasaccess__toenclosing__local scopes,but__itdoes__notserve__asan__enclosinglocal__scopeto__furthernested__code.Like__modules,the__classlocal__scopemorphs__intoan__attributenamespace__afterthe__classstatement__is run.Chapter__30.Operator__OverloadingThis__chaptercontinues__our in-depthsurvey__ofclass__mechanicsby__focusingon__operator overloading.We__lookedbriefly__atoperator__overloadingin__prior chapters. Here,we__llfill__inmore__detailsand__explorea__handfulof__commonlyused__overloading methods,most__ofwhich__wehaven__tyet__encountered.Although__wedon__thave__spaceto__demonstrateeach__ofthe__many operator-overloadingmethods__available,those__wewill__codehere__area__representativesample__largeenough__touncover__thepossibilities__ofthis__Pythonclass__feature.The__BasicsReally__operatoroverloading__simplymeans__intercepting built-inoperations__ina__classs__methodsPython__automaticallyinvokes__yourmethods__wheninstances__ofthe__classappear__in built-in operations,and__yourmethod__sreturn__valuebecomes__theresult__ofthe__corresponding operation.Here__sa__reviewof__thekey__ideasbehind__overloading:Operator__overloadinglets__classesintercept__normalPython__operations.Classes__canoverload__allPython__built-inexpression__operators.Classes__canalso__overloadother__built-inoperations__suchas__printing,function__calls,and__attribute access.Overloading__isimplemented__byproviding__speciallynamed__methodsin__a class.Python__predefinesthe__specialmethod__namesthat__correspondto__built-in operations.In__other words,when__methodsof__predefinedspecial__namesare__providedin__a class,Python__automaticallycalls__themwhen__instancesof__theclass__appearin__theirassociated__built-inoperations__or expressions.Your__classprovides__thebehavior__ofthe__correspondingoperation__forinstance__objectscreated__from it.As__youve__learned, operator-overloadingmethods__arenever__requiredand__generallydon__thave__defaults (apartfrom__ahandful__thatall__classesget__fromthe__impliedobject__root class).If__youdon__tcode__orinherit__anoverloading__method,it__justmeans__thatyour__classdoes__notsupport__thecorresponding__operation.When__used, though,these__methodsallow__classesto__emulatethe__interfacesof__built-in objects,which__makesthem__consistent,and__compatiblewith__more code.Constructors__and Expressions:__init____and__sub____Asa__warm-up,consider__thesimple__classin__Example 30-1:its__Number class,coded__inmodule__file number.py,provides__amethod__tointercept__instanceconstruction__(__init__),as__wellas__onefor__catchingsubtraction__expressions (__sub__).Special__methodslike__theseare__thehooks__thatlet__youtie__into built-in operations.Example__30-1. number.pyclass__Number:def____init__(self, start): #On__Number(start) self.data =start__def __sub__(self, other): #On__instance -other__return Number(self.data - other) #Result__isa__newinstance__Aswe__vealready__learned,the____init__constructor__methodseen__inthis__codeis__themost__commonlyused__operator-overloadingmethod__in Python;it__spresent__inmost__classesand__usedto__initializethe__newlycreated__instanceobject__usingany__argumentspassed__tothe__class name.The____sub__method__playsthe__binary-operator__rolethat____add__did__inChapter__27s__introduction,intercepting__subtractionexpressions__andreturning__anew__instanceof__theclass__asits__result (andrunning____init__along__the way): >>>from__numberimport__Number #Fetch__classfrom__module >>>X__= Number(5) # Number.__init__(X, 5) >>>Y__=X__- 2 # Number.__sub__(X, 2) >>> Y.data #Y__isnew__Numberinstance__3We__vealready__studied__init____andbasic__binaryoperators__like__sub____insome__depth,so__wewon__trehash__theirusage__further here.In__this chapter,we__willtour__someother__toolsavailable__inthis__domainand__lookat__examplecode__thatapplies__themin__commonuse__cases.NOTE__Construction convolution: Technically,instance__creationfirst__triggersthe____new__ method,which__createsand__returnsthe__newinstance__object,which__isthen__passedinto____init__for__initialization.Since____new__has__a built-inimplementation__andis__redefinedin__onlyvery__limited roles, though,nearly__allPython__classesinitialize__bydefining__an__init____method.We__llexplore__oneuse__casefor____new__when__westudy__metaclassesin__Chapter 40;though__rare,it__issometimes__alsoused__tocustomize__creationof__instancesof__immutable types.Common__Operator-OverloadingMethods__Justabout__everythingyou__cando__to built-inobjects__suchas__integersand__listshas__acorresponding__speciallynamed__methodfor__overloadingin__classes.Table__30-1lists__afew__ofthe__most common;there__aremany__more.In__fact,many__overloadingmethods__comein__multipleversions__(e.g., __add__, __radd__,and____iadd__for__addition),which__isone__reasonthere__areso__many.See__thePython__languagereference__manualfor__anexhaustive__listof__thespecial__methodnames__available.Table__30-1.Common__operator-overloadingmethods__MethodImplements__Calledfor____init__Constructor__Object creation:X__= Class(args)__del____DestructorObject__reclamationof__X__add____Operator + (among others)X__+ Y,X__+=Y__ifno____iadd____or____Operator | (bitwise OR)X__| Y,X__|=Y__ifno____ior__ __repr__,__str____ Printing,conversions__print(X), X, repr(X), str(X), f'{X!r}'__call____Functioncalls__X(*pargs, **kargs)__getattr____Attributefetch__X.undefined__setattr____Attributeassignment__X.any =value____delattr__Attribute__deletiondel__X.any__getattribute____Attributefetch__X.any__getitem____Indexing, slicing,iteration__X[i], X[i:j],for__andother__iterationsif__no__iter______setitem__Index__andslice__assignment X[i] = value, X[i:j] =iterable____delitem__Index__andslice__deletiondel__X[i],del__X[i:j]__len____Length len(X),truth__testsif__no__bool______bool__Boolean__tests bool(X),truth__tests __lt__, __gt__, __le__, __ge__, __eq__,__ne____ComparisonsX__< Y,X__> Y,X__<= Y,X__>= Y,X__== Y,X__!=Y____radd__ Right-sideoperators__other +X____iadd__ In-placeaugmented__operatorsX__+=Y__(orelse____add__) __iter__,__next____Iteration__tools I=iter(X), next(I),for__andother__iterations,in__ifno____contains____contains____Membershiptest__itemin__X__index____Integervalue__hex(X), bin(X), oct(X), O[X], O[X:]with__objas__var: __enter__,__exi__t__Context__manager (Chapter 34) __get__, __set__,__delete____Descriptorattributes__(Chapter 38) X.attr, X.attr = value,del__X.attr__new____Creation (Chapter 40)Object__creation,before____init__All__overloadingmethods__havenames__thatstart__andend__withtwo__underscoresto__keepthem__distinctfrom__othernames__youdefine__inyour__classes.The__mappingsfrom__specialmethod__namesto__expressionsor__operationsare__predefinedby__thePython__languageand__documentedin__fullin__itsstandard__language manual.For__example,the__name__add____alwaysmaps__to +expressions__byPython__language definition,regardless__ofwhat__an__add____methods__codeactually__does;it__slargely__justa__dispatch mechanism. Operator-overloadingmethods__maybe__inheritedfrom__superclassesif__not defined,just__likeany__other methods. Operator-overloadingmethods__arealso__alloptional__ifyou__dont__codeor__inherit one,that__operationis__simplyunsupported__byyour__class,and__attemptingit__willraise__an exception.Some__built-in operations,like__printing,have__defaultsinherited__fromthe__impliedobject__root class,but__most built-insfail__forclass__instancesif__nocorresponding__operator-overloadingmethod__is present.As__wego__along here,keep__inmind__thatmost__overloadingmethods__areused__onlyin__advancedprograms__thatrequire__objectsto__behavelike__built-ins,though__the__init____constructorwe__vealready__mettends__toappear__inmost__classes.With__that qualifier,let__sexplore__someof__theadditional__methodsin__Table 30-1by__example.NOTE__Measure twice,post__once:Although__expressionstrigger__operator methods,be__carefulnot__toassume__thatthere__isa__speedadvantage__tocutting__outthe__middlepersonand__callingthe__operatormethod__directly.In__fact,calling__theoperator__methoddirectly__mightbe__twiceas__slow,presumably__becauseof__theoverhead__ofa__function call,which__Pythonavoids__oroptimizes__in built-in cases.Here__sthe__storyfor__lenand____len__using__Chapter 21s__timingtechniques__onPython__3.12and__macOS.Calling____len__directly__takestwice__aslong__(andhas__sincePython__2.X): $ python3 -mtimeit__-n 10000 -r 10 \ -s "L = list(range(100))" "x = L.__len__()" 10000 loops,best__of 10: 53.4nsec__perloop__$ python3 -mtimeit__-n 10000 -r 10 \ -s "L = list(range(100))" "x = len(L)" 10000 loops,best__of 10: 25.3nsec__perloop__Thisis__notas__contrivedas__itmay__seemrecommendations__forusing__theslower__alternativein__thename__ofspeed__havebeen__knownto__cropup__invenues__thatshall__remainnameless__here.Indexing__and Slicing:__getitem____and__setitem____Ourfirst__newmethod__setallows__yourclasses__tomimic__someof__thebehaviors__ofsequences__and mappings.If__definedin__aclass__(orinherited__by it),the____getitem__method__iscalled__automaticallyfor__instance-indexing operations.When__aninstance__Xappears__inan__indexingexpression__like X[i],Python__callsthe____getitem__method__inheritedby__the instance,passing__Xto__thefirst__argumentand__theindex__iin__bracketsto__thesecond__argument.For__example,the__followingclass__returnsthe__squareof__anindex__valueatypical__perhapsbut__illustrativeof__themechanism__in general: >>>class__Indexer:def____getitem__(self, index):return__index ** 2 >>>X__= Indexer() >>> X[2] # X[i]calls__X.__getitem__(i) 4 >>>for__iin__range(5): print(X[i], end=' ') #Runs____getitem__(X, i)each__time 0 1 4 9 16It__sup__toyour__classto__definewhat__thisexpression__means,though__itshould__generallyimitate__asequence__indexor__mappingkey__fetch;returning__theindex__squaredas__donehere__worksbut__probablywon__tqualify__asbest__practice.Intercepting__Slices Surprisingly,in__additionto__indexing,__getitem____isalso__calledfor__slice expressions.Formally__speaking, built-inobject__typeshandle__slicingthe__same way.For__example,the__followingdemos__slicingat__workon__a built-in list,using__upperand__lower bounds,omitted__parts,and__astride__(seeChapter__7if__youneed__arefresher__on slicing): >>>L__= [5, 6, 7, 8, 9] >>> L[2:4] #Slice__withslice__syntax: 2..(4-1) [7, 8] >>> L[1:] [6, 7, 8, 9] >>> L[:-1] [5, 6, 7, 8] >>> L[::2] [5, 7, 9] Really, though,slicing__boundsare__bundledup__intoa__sliceobject__andpassed__tothe__lists__implementationof__indexing.In__fact,you__canalways__passa__sliceobject__manuallyslice__syntaxis__mostlysyntactic__sugarfor__indexingwith__aslice__object: >>> L[slice(2, 4)] #Slice__withslice__objects [7, 8] >>> L[slice(1, None)] [6, 7, 8, 9] >>> L[slice(None, -1)] [5, 6, 7, 8] >>> L[slice(None, None, 2)] [5, 7, 9]This__mattersin__classeswith__a__getitem____methodthis__methodwill__becalled__bothfor__basicindexing__(withan__indexor__key)and__forslicing__(witha__slice object).Our__previousclass__wont__handleslicing__becauseits__mathassumes__integerindexes__are passed,but__thefollowing__class will.When__calledfor__indexing,the__argumentis__aninteger__as before: >>>class__Indexer:def____init__(self, data): self.data =data__def __getitem__(self, index): #Called__forindex__orslice__print('getitem:', index)return__self.data[index] #Perform__indexor__slice >>>X__= Indexer([5, 6, 7, 8, 9]) >>> X[0] #Indexing__sends__getitem____aninteger__getitem: 0 5 >>> X[1] getitem: 1 6 >>> X[-1] getitem: 1 9When__calledfor__slicing, though,the__methodreceives__aslice__object,which__issimply__passedalong__tothe__embeddedlist__indexerin__anew__index expression: >>> X[2:4] #Slicing__sends__getitem____aslice__object getitem: slice(2, 4, None) [7, 8] >>> X[1:] getitem: slice(1, None, None) [6, 7, 8, 9] >>> X[:-1] getitem: slice(None, 1, None) [5, 6, 7, 8] >>> X[::2] getitem: slice(None, None, 2) [5, 7, 9]Where__needed,__getitem____cantest__thetype__ofits__argument,and__extractslice__objectbounds__sliceobjects__haveattributes__start, stop,and__step,any__ofwhich__canbe__Noneif__omitted: >>>class__Indexer:def____getitem__(self, index):if__isinstance(index, int): #Test__usagemode__print('indexing', index) else: print('slicing', index.start, index.stop, index.step) >>>X__= Indexer() >>> X[99]indexing__99 >>> X[1:99:2]slicing__1 99 2 >>> X[1:]slicing__1None__NoneRun__a help(slice)in__aREPL__formore__infoon__thisvery__special-case built-inobject__type,and__seethe__section Membership: __contains__, __iter__,and____getitem__for__anotherexample__ofslice__interceptionat__work.Intercepting__ItemAssignments__If used,the____setitem__index__assignmentmethod__similarlyintercepts__bothindex__andslice__assignmentsit__receivesa__sliceobject__forthe__latter,which__maybe__passedalong__inanother__indexassignment__orused__directlyin__thesame__way: >>>class__IndexSetter:def____init__(self, data): self.data =data__def __setitem__(self, index, value): #Catch__indexor__sliceassignment__print('setitem:', index) self.data[index] =value__#Assign__indexor__slice >>>X__= IndexSetter([5, 6, 7, 8, 9]) >>> X[0] = 555 setitem: 0 >>> X[-2:] = [888, 999, 111] setitem: slice(-2, None, None) >>> X.data [555, 6, 7, 888, 999, 111]In__fact,__getitem____maybe__calledautomatically__ineven__morecontexts__thanindexing__andslicing__its__alsoan__iterationfallback__option,as__youll__seein__a moment. First, though,let__sclear__upa__potentialpoint__ofconfusion__inthis__category.But____index__Means__As-IntegerDon__tmistake__the (perhapsunfortunately__named)__index____methodfor____getitem__index__interception.The____index__method__returnsan__integervalue__foran__instancewhen__oneis__neededand__in retrospect,might__havebeen__betternamed____asindex__.For__example,it__sused__by built-insthat__convertto__digit strings: >>>class__C:def____index__(self):return__255 >>>X__= C() >>> hex(X) #Integer__value '0xff' >>> bin(X) '0b11111111' >>> oct(X) '0o377'Although__thismethod__doesnot__interceptinstance__indexinglike____getitem__,it__isalso__usedin__contextsthat__requirean__integerincluding__indexingand__slicing: >>>eds__= [f'LP{i}e'for__iin__range(256)] >>> eds[255] 'LP255e' >>>X__= C() >>> eds[X] #As__index (not X[i]!) 'LP255e' >>> eds[X:] #As__index (not X[i:]!) ['LP255e']Though__arguably misnamed,there__isa__richhistory__offormer__methodsthat____index__ subsumes,which__well__mercifullyomit__here.The____getitem__method__alsosubsumes__formertools__butretains__afallback__roleup__next.Index__Iteration:__getitem____Ournext__hookisn__talways__obviousto__beginnersbut__turnsout__tobe__surprisingly useful.In__theabsence__ofthe__morespecific__iterationmethods__well__getto__inthe__next section,the__forstatement__worksby__repeatedlyindexing__anobject__fromzero__tohigher__indexes,until__an out-of-boundsIndexError__exceptionis__detected.Because__of that,__getitem____alsoturns__outto__beone__wayto__overloaditeration__inPython__ifonly__thismethod__is defined,for__loopscall__theclass__s__getitem____eachtime__through,with__successivelyhigher__offsets.It__sa__caseof__code one,get__onefree__any built-inor__user-definedobject__thatresponds__toindexing__alsoresponds__tofor__loop iteration: >>>class__StepperIndex:def____getitem__(self, i):return__self.data[i] >>>X__= StepperIndex() #X__isa__StepperIndexobject__>>> X.data = 'hack' >>> >>> X[1] #Indexing__calls__getitem____'a' >>>for__itemin__X: #for__loopscall____getitem__ print(item, end=' ') #for__indexesitems__0..Nhack__In fact,it__sreally__acase__ofcode__one,get__abunch__free.Any__classthat__supportsfor__loopsautomatically__supportsall__iterationtools__in Python,many__ofwhich__weve__exploredin__earlierchapters__(e.g.,iteration__toolswere__presentedin__Chapter 14).For__instance,the__inmembership__test,list__comprehensions,the__map built-in,list__andtuple__assignments,and__sometype__constructorswill__alsocall____getitem__automatically__toiterate__ifit__s defined: >>> 'k'in__X #All__call__getitem____tooTrue__>>> [cfor__cin__X] #Comprehension__['h', 'a', 'c', 'k'] >>> list(map(str.upper, X)) #map__calls ['H', 'A', 'C', 'K'] >>> (a, b, c, d) =X__#Sequence__assignments >>> a,d__('h', 'k') >>> list(X), tuple(X), ''.join(X) #And__so on... (['h', 'a', 'c', 'k'], ('h', 'a', 'c', 'k'), 'hack') >>>X__<__main__.StepperIndexobject__at 0x10c4bcc20>In__practice,this__techniquecan__beused__tocreate__objectsthat__providea__sequenceinterface__andto__addlogic__to built-insequence__type operations;we__llrevisit__thisidea__whenextending__built-intypes__inChapter__32.Iterable__Objects:__iter____and__next____Althoughthe____getitem__technique__ofthe__priorsection__works,it__sreally__justa__legacyfallback__for iteration. Today,all__iterationtools__inPython__willtry__the__iter____methodfirst__beforetrying____getitem__.That__is,they__preferthe__iterationprotocol__welearned__aboutin__Chapter 14over__repeatedlyindexing__an object;only__ifthe__objectdoes__notsupport__theiteration__protocolis__indexingattempted__instead.Generally__speaking,you__shouldprefer____iter__too__itsupports__generaliteration__toolsbetter__than__getitem____can.For__areview__ofthis__models__essentials,see__Figure 14-1in__Chapter 14.In__brief,iteration__toolswork__byrunning__aniterable__objects____iter__method__tofetch__aniterator__object.If__thisworks__as planned,Python__thenrepeatedly__callsthis__iteratorobject__s__next____methodto__produceitems__untilit__raisesa__StopIteration exception. Built-infunctions__iterand__nextare__alsoavailable__asa__conveniencesfor__manualiterations__iter(X)is__thesame__as X.__iter__()and__next(I)is__thesame__as I.__next__(),and__Pythoninternals__may vary.This__iterable-objectinterface__isgiven__priorityand__attempted first.Only__ifno__such__iter____methodis__found,Python__fallsback__onthe____getitem__scheme__andrepeatedly__indexesby__offsetsas__beforeuntil__anIndexError__exceptionis__raised. User-DefinedIterables__Inthe____iter__ scheme,classes__implement user-definediterables__bysimply__implementingthe__iterationprotocol__introducedin__Chapter 14and__elaboratedin__Chapter 20.For__example,the__codein__Example 30-2uses__aclass__todefine__a user-defined__iterablethat__generatessquares__on demand,instead__ofall__at once.Example__30-2. squares.pyclass__Squares:def____init__(self, start, stop): #Save__statewhen__created self.value =start__- 1 self.stop =stop__def __iter__(self): #Return__iteratorobject__returnself__#Also__calledby__iter() built-indef____next__(self): #Return__asquare__oneach__iterationif__self.value == self.stop: #Also__calledby__next() built-inraise__StopIteration self.value += 1return__self.value ** 2When__imported,its__instancescan__appearin__iterationtools__justlike__built-ins: $ python3 >>>from__squaresimport__Squares >>>for__iin__Squares(1, 5): #for__calls__iter____print(i, end=' ') #Each__iterationcalls____next__ 1 4 9 16 25 Here,the__iteratorobject__returnedby____iter__is__simplythe__instanceself__becausethe____next__method__ispart__ofthis__class itself.In__morecomplex__scenarios,the__iteratorobject__maybe__definedas__aseparate__classand__objectwith__itsown__stateinformation__tosupport__multipleactive__iterationsover__thesame__instancedata__(well__codean__exampleof__thisin__a moment).The__endof__theiteration__issignaled__witha__Pythonraise__statementintroduced__inChapter__29and__coveredin__fullin__thenext__partof__this book,but__whichsimply__raisesan__exceptionas__ifPython__itselfhad__done so.Because__ofall__this,manual__iterationswork__thesame__on user-definediterables__asthey__doon__built-in objects: >>>X__= Squares(1, 5) #Iterate__manually:what__loopsdo__>>>I__= iter(X) #iter__calls__iter____>>> next(I) #next__calls__next____1 >>> next(I) 4more__omitted >>> next(I) 25 >>> next(I) #Can__catchthis__intry__statementStopIteration__Anequivalent__codingof__thisiterable__with__getitem____mightbe__lessnatural__becausethe__forwould__theniterate__throughall__offsetszero__and higher;the__offsetspassed__inwould__beonly__indirectlyrelated__tothe__rangeof__valuesproduced__(0N__wouldneed__tomap__tostart__stop).Because____iter__objects__retainexplicitly__managedstate__betweennext__calls,they__canbe__moregeneral__than __getitem__.On__theother__hand,iterables__basedon____iter__can__sometimesbe__morecomplex__andless__functionalthan__thosebased__on __getitem__.They__arereally__designedfor__iteration,not__randomindexing__in fact,they__dont__overloadthe__indexingexpression__at all,though__youcan__collecttheir__itemsin__asequence__suchas__alist__toenable__other operations: >>>X__= Squares(1, 5) >>> X[1] TypeError: 'Squares'object__isnot__subscriptable >>> list(X)[1] 4Single__versusmultiple__scansThe____iter__scheme__isalso__theimplementation__forall__theother__iterationtools__wesaw__inaction__forthe____getitem__method__membership tests,type__constructors,sequence__assignment,and__so on.Unlike__ourprior____getitem__ example, though,we__alsoneed__tobe__awarethat__aclass__s__iter____maybe__designedfor__asingle__traversal only,not__many.Classes__canchoose__eitherbehavior__explicitlyin__their code.For__example,because__thecurrent__Squaresclass__s__iter____alwaysreturns__selfwith__justone__copyof__iteration state,it__isa__single-scan iteration;once__youve__iteratedover__aninstance__ofthat__class,it__s empty.Calling____iter__again__onthe__sameinstance__returnsself__againin__whateverstate__itmay__havebeen__left.As__coded,you__generallyneed__tomake__anew__iterableinstance__objectfor__eachnew__iteration: >>>X__= Squares(1, 5) #Make__aniterable__withstate__>>> [nfor__nin__X] #Exhausts__items:__iter____returnsself__[1, 4, 9, 16, 25] >>> [nfor__nin__X] #Now__it's empty:__iter____returnssame__self [] >>> [nfor__nin__Squares(1, 5)] #Make__anew__iterableobject__[1, 4, 9, 16, 25] >>> list(Squares(1, 3)) #A__newobject__foreach__new__iter____call [1, 4, 9]To__supportmultiple__iterationsmore__directly,we__couldalso__recodethis__examplewith__anextra__classor__other technique,as__wewill__ina__moment.As__is, though,by__creatinga__newinstance__foreach__iteration,you__geta__freshcopy__ofiteration__state: >>> 36in__Squares(1, 10) #Other__iterationtools__True >>> a, b,c__= Squares(1, 3) #Each__calls__iter____andthen____next__ >>> a, b,c__(1, 4, 9) >>> ':'.join(map(str, Squares(1, 5))) '1:4:9:16:25'Just__like single-scan built-inssuch__as map,converting__toa__listsupports__multiplescans__aswell__butadds__timeand__spaceperformance__costs,which__mayor__maynot__besignificant__toa__given program: >>>X__= Squares(1, 5) >>> tuple(X), tuple(X) #Iterator__exhaustedin__second tuple() ((1, 4, 9, 16, 25), ()) >>>X__= list(Squares(1, 5)) >>> tuple(X), tuple(X) ((1, 4, 9, 16, 25), (1, 4, 9, 16, 25))We__llimprove__thisto__supportmultiple__scansmore__directlyahead__aftera__bitof__compareand__contrast.Classes__versusgenerators__Noticethat__theSquares__iterableof__Example 30-2that__weve__beenusing__sofar__wouldprobably__besimpler__ifit__wascoded__withgenerator__functionsor__expressionstools__introducedin__Chapter 20that__automaticallyproduce__iterableobjects__andretain__localvariable__statebetween__iterations: >>>def__gsquares(start, stop): #Generator__functionfor__iin__range(start,stop__+ 1):yield__i ** 2 >>>for__iin__gsquares(1, 5): print(i, end=' ') 1 4 9 16 25 >>>for__iin__(x ** 2for__xin__range(1, 6)): #Generator__expression print(i, end=' ') 1 4 9 16 25Unlike__classes,generator__functionsand__expressionsimplicitly__savetheir__stateand__createthe__methodsrequired__toconform__tothe__iterationprotocol__withobvious__advantagesin__codeconciseness__forsimpler__exampleslike__these.That__is,generators__automaticand__implicit__iter____and__next____suffice here.On__theother__hand,the__classs__moreexplicit__attributesand__methods,extra__structure,inheritance__hierarchies,and__supportfor__multiplebehaviors__maybe__bettersuited__forricher__use cases.Of__course,for__thisartificial__example,you__couldin__factskip__bothtechniques__andsimply__usea__for loop, map,or__alist__comprehensionto__buildthe__listall__at once.Barring__performancedata__tothe__contrary,the__bestand__fastestway__toaccomplish__atask__inPython__isoften__alsothe__simplest: >>> [x ** 2for__xin__range(1, 6)] [1, 4, 9, 16, 25]That__said,classes__arebetter__atmodeling__morecomplex__iterations,especially__whenthey__canbenefit__fromthe__assetsof__classesin__general.An__iterablethat__producesitems__ina__complexdatabase__orweb__service result,for__example,might__beable__totake__fulleradvantage__ofclasses__andleverage__moreflexible__codingstructures__likethat__ofthe__next section.Multiple__Iteratorson__OneObject__Earlier,it__wasmentioned__inpassing__thatthe__iteratorobject__(witha____next__)produced__byan__iterablemay__bedefined__asa__separateclass__withits__ownstate__informationto__moredirectly__supportmultiple__activeiterations__overthe__same data.To__understandthis__better,consider__whathappens__whenwe__stepacross__a built-intype__likea__string: >>>S__= 'ace' >>>for__xin__S:for__yin__S: print(x + y, end=' ')aa__acae__cacc__ceea__ecee__Here,the__outerloop__grabsan__iteratorfrom__thestring__bycalling__iter,and__eachnested__loopdoes__thesame__toget__anindependent__iterator.Because__eachactive__iteratorhas__itsown__state information,each__loopcan__maintainits__ownposition__inthe__string,regardless__ofany__otheractive__loops. Moreover,we__renot__requiredto__makea__newstring__orconvert__toa__listeach__time;the__singlestring__objectitself__supportsmultiple__scans.We__sawrelated__examples earlier,in__Chapters 14and__20.For__instance,generator__functionsand__expressions,as__wellas__built-inslike__mapand__zip,proved__tobe__single-iterator objects,thus__supportinga__singleactive__scan.By__contrast,the__range built-in,and__other built-intypes__like lists,support__multipleactive__iteratorswith__independent positions.When__wecode__user-definediterables__with classes,it__sup__tous__todecide__whetherwe__willsupport__asingle__activeiteration__or many.To__achievethe__multiple-iterator effect,__iter____simplyneeds__todefine__anew__statefulobject__forthe__iteratorinstead__ofreturning__selffor__eachiterator__request.For__example,the__classSkipObject__inExample__30-3defines__aniterable__objectthat__skipsevery__otheritem__on iterations.Because__itsiterator__objectis__createdanew__froma__supplementalclass__foreach__iteration,it__supportsmultiple__activeloops__directly.Example__30-3. skipper.pyclass__SkipObject:def____init__(self, wrapped): #Save__itemto__beused__self.wrapped =wrapped__def __iter__(self):return__SkipIterator(self.wrapped) #New__iteratoreach__timeclass__SkipIterator:def____init__(self, wrapped): self.wrapped =wrapped__#Iterator__stateinformation__self.offset = 0def____next__(self):if__self.offset >= len(self.wrapped): #Terminate__iterationsraise__StopIteration else:item__= self.wrapped[self.offset] #else__returnand__skip self.offset += 2return__itemif____name__ == '__main__':alpha__= 'abcdef'skipper__= SkipObject(alpha) #Make__containerobject__I = iter(skipper) #Make__aniterator__onit__print(next(I), next(I), next(I)) #Visit__offsets 0, 2, 4for__xin__skipper: #for__calls__iter____automaticallyfor__yin__skipper: #Nested__forscall____iter__again__eachtime__print(x + y, end=' ') #Each__iteratorhas__itsown__state,offset__When run,this__exampleworks__likethe__earliernested__loopswith__built-in strings.Each__activeloop__hasits__ownposition__inthe__stringbecause__eachobtains__anindependent__iteratorobject__thatrecords__itsown__state information: $ python3 skipper.pyace__aaac__aeca__ccce__eaec__eeBy__contrast,our__earlierSquares__classof__Example 30-2supports__justone__activeiteration__unlesswe__callSquares__againin__nestedloops__toobtain__newobjects__(elsethe__outerfor__loopwould__runjust__once). Here,there__isjust__oneSkipObject__iterable,with__multipleiterator__objectscreated__from it.Classes__versusslices__As before,we__couldachieve__similarresults__with built-intools__for example,slicing__witha__thirdbound__toskip__items: >>>S__= 'abcdef' >>>for__xin__S[::2]:for__yin__S[::2]: #New__objectson__eachiteration__print(x + y, end=' ')aa__acae__cacc__ceea__ecee__Thisisn__tquite__the same, though,for__two reasons. First,each__sliceexpression__herewill__physicallystore__theresult__listall__atonce__in memory; iterables,on__theother__hand,produce__justone__valueat__a time,which__cansave__substantialspace__andstartup__timefor__largeresult__lists. Second,slices__producenew__objects,so__were__notreally__iteratingover__thesame__objectin__multipleplaces__here.To__becloser__tothe__class,we__wouldneed__tomake__asingle__objectto__stepacross__byslicing__aheadof__time: >>>S__= 'abcdef' >>>S__= S[::2] >>>S__'ace' >>>for__xin__S:for__yin__S: #Same__object,new__iterators print(x + y, end=' ')aa__acae__cacc__ceea__ecee__Thisis__moresimilar__toour__class-based solution,but__itstill__storesthe__sliceresult__inmemory__allat__once (thereis__nogenerator__formof__built-inslicing__today),and__its__onlyequivalent__forthis__particularcase__ofskipping__everyother__item.Because__user-definediterables__codedwith__classescan__doanything__aclass__can do,they__aremuch__moregeneral__thanthis__examplemay__imply.Though__suchgenerality__isnot__requiredin__all applications, user-definediterables__area__powerfultool__theyallow__usto__makearbitrary__objectslook__andfeel__likethe__othersequences__anditerables__wehave__metin__this book.We__coulduse__thistechnique__witha__database object,for__example,to__supportiterations__overlarge__database fetches,with__multiplecursors__intothe__samequery__result.Coding__Alternative:__iter____Plusyield__Nowfor__somethingmore__implicitbut__potentiallyuseful__nonetheless.In__some applications,it__spossible__tominimize__codingrequirements__for user-definediterables__bycombining__the__iter____methodwe__reexploring__hereand__theyield__generatorfunction__statementwe__studiedin__Chapter 20.Because__generatorfunctions__automaticallysave__local-variablestate__andcreate__requirediterator__methods,they__fitthis__rolewell__andcomplement__thestate__retentionand__otherutility__weget__from classes.As__aquick__review,recall__thatany__functionthat__containsa__yieldstatement__isturned__intoa__generator function.When__called,it__returnsa__newgenerator__objectwith__automaticretention__oflocal__scopeand__code position;an__automaticallycreated____iter__method__thatsimply__returns itself;and__anautomatically__created__next____methodthat__startsthe__functionor__resumesit__whereit__lastleft__off: >>>def__gen(x):for__iin__range(x):yield__i ** 2 >>>G__= gen(5) #Create__agenerator__with__iter____and__next____>>> G.__iter__()is__G #Both__methodsexist__onthe__sameobject__True >>>I__= iter(G) #Runs____iter__:generator__returnsitself__>>> next(I), next(I) #Runs____next__ (0, 1) >>> list(gen(5)) #Iteration__toolsautomatically__runiter__andnext__[0, 1, 4, 9, 16]This__isstill__trueeven__ifthe__generatorfunction__witha__yieldhappens__tobe__amethod__named__iter____.Whenever__invokedby__aniteration__tool,such__amethod__willreturn__anew__generatorobject__withthe__requisite __next__.As__anadded__bonus,generator__functionscoded__asmethods__inclasses__haveaccess__tosaved__statein__bothinstance__attributesand__local-scope variables.For__example,the__classin__Example 30-4is__equivalentto__theinitial__Squares user-defined__iterablewe__codedearlier__inExample__30-2,but__noticeablyshorter__(4 lines,for__anyone counting).Example__30-4. squares_yield.pyclass__Squares: #__iter____+yield__generatordef____init__(self, start, stop): #__next____is automatic/implied self.start =start__self.stop =stop__def __iter__(self):for__valuein__range(self.start, self.stop + 1):yield__value ** 2As__before,for__loopsand__otheriteration__toolsiterate__throughinstances__ofthis__class automatically: $ python3 >>>from__squares_yieldimport__Squares >>>for__iin__Squares(1, 5): print(i, end=' ') #Runs____iter__,then____next__ 1 4 9 16 25And__as always,we__canalso__lookunder__thehood__tosee__howthis__actuallyworks__initeration__toolslike__for.Running__ourclass__instancethrough__iterobtains__theresult__ofcalling____iter__as__usual.In__this case, though,the__resultis__agenerator__objectwith__anautomatically__created__next____ofthe__samesort__wealways__getwhen__callinga__generatorfunction__thatcontains__a yield.The__onlydifference__hereis__thatthe__generatorfunction__isautomatically__calledon__iter.Invoking__theresult__objects__nextinterface__producesresults__on demand: >>>S__= Squares(1, 5) #Runs____init__:class__savesinstance__state >>>S__>>>I__= iter(S) #Runs____iter__:returns__agenerator__>>>I__>>> next(I) 1 >>> next(I) #Runs__generator's__next____4etc__>>> next(I) #Generator__hasboth__instanceand__localscope__stateStopIteration__Itmay__alsohelp__tonotice__thatwe__couldname__thegenerator__methodsomething__otherthan____iter__and__callmanually__toiterate__Squares( ).gen(),for__example.Using__the__iter____nameinvoked__automaticallyby__iterationtools__simplyskips__amanual__attributefetch__andcall__step.Example__30-5demos__the idea.Example__30-5. squares_yield_manual.pyimport__squares_yield #Reuse__prior example's__init____class Squares(squares_yield.Squares): #Non____iter__equivalent__def gen(self):for__valuein__range(self.start, self.stop + 1):yield__value ** 2The__examplealso__importsExample__30-4to__inheritits__constructor.When__run,its__resultsare__the same,but__wemust__callthe__genmethod__explicitlyto__fetchan__iterablea__stepthat____iter__automates__and obviates: $ python3 >>>from__squares_yield_manualimport__Squares >>>for__iin__Squares(1, 5).gen(): print(i, end=' ')same__results >>>S__= Squares(1, 5) >>>I__= iter(S.gen()) #Call__generatormanually__for iterable/iterator >>> next(I)same__resultsCoding__thegenerator__as__iter____insteadcuts__outthe__middlepersonin__your code,though__bothschemes__ultimatelywind__upcreating__anew__generatorobject__foreach__iteration:With____iter__,iteration__triggers __iter__,which__returnsa__newgenerator__with __next__.Without____iter__,your__codecalls__tomake__a generator,which__returnsitself__for __iter__.See__Chapter 20for__moreon__yieldand__generatorsif__thisis__puzzling,and__compareit__withthe__moreexplicit____next__version__inExample__30-2 earlier.If__you do,you__llnotice__thatthe__squares_yield.pyversion__is 4lines__shorter (7versus__11,not__counting whitespace).In__a sense,this__schemereduces__classcoding__requirementsmuch__likethe__closurefunctions__ofChapter__17,but__inthis__casedoes__sowith__acombination__offunctional__andOOP__techniquesinstead__ofan__alternativeto__classes.For__example,the__generatormethod__stillleverages__self attributes.This__mayalso__seemlike__onetoo__manylevels__ofmagic__tosome__observersit__relieson__boththe__iterationprotocol__andthe__objectcreation__of generators,both__ofwhich__arehighly__implicit (incontradiction__oflongstanding__Python goals).Opinions__aside,it__simportant__tounderstand__the non-yieldflavor__ofclass__iterables too,because__its__explicit, general,and__sometimesbroader__in scope. Still,the____iter__/yieldtechnique__mayprove__effectivein__caseswhere__it applies.It__alsocomes__witha__substantialadvantage__asthe__nextsection__explains.Multiple__iteratorswith__yieldBesides__itscode__conciseness,the__user-definedclass__iterableof__theprior__sectionbased__uponthe____iter__/yieldcombination__hasan__importantadded__bonusit__alsosupports__multipleactive__iterators automatically.This__naturallyfollows__fromthe__factthat__eachcall__to__iter____isa__newcall__toa__generator function,which__returnsa__newgenerator__withits__owncopy__ofthe__localscope__forstate__retention.Using__Example 30-4 again: $ python3 >>>from__squares_yieldimport__Squares #Using__the __iter__/yieldSquares__>>>S__= Squares(1, 5) >>>I__= iter(S) >>> next(I); next(I) 1 4 >>>K__= iter(S) #With__yield,multiple__iteratorsautomatic__>>> next(K) 1 >>> next(I) #I__isindependent__of K:own__localstate__9Although__generatorfunctions__are single-scaniterables__by nature,the__implicitcalls__to__iter____initeration__toolsmake__newgenerators__supportingnew__independent scans: >>>S__= Squares(1, 3) >>>for__iin__S: #Each__"for"calls____iter__for__jin__S: print(f'{i}:{j}', end=' ') 1:1 1:4 1:9 4:1 4:4 4:9 9:1 9:4 9:9To__dothe__samewithout__yieldrequires__asupplemental__classthat__storesiterator__stateexplicitly__and manually,using__techniquesof__thepreceding__section.Per__Example 30-6,this__growsto__15 lines: 8more__thanwith__yield.Example__30-6. squares_nonyield.pyclass__Squares:def____init__(self, start, stop): # Non-yieldgenerator__self.start =start__# Multiscans:extra__object self.stop =stop__def __iter__(self):return__SquaresIter(self.start, self.stop)class__SquaresIter:def____init__(self, start, stop): self.value =start__- 1 self.stop =stop__def __next__(self):if__self.value == self.stop:raise__StopIteration self.value += 1return__self.value ** 2This__worksthe__sameas__theyield__multiscan version,but__withmore__andmore__explicit code: $ python3 >>>from__squares_nonyieldimport__Squares >>>for__iin__Squares(1, 5): print(i, end=' ') 1 4 9 16 25 >>>S__= Squares(1, 5) >>>I__= iter(S) >>> next(I); next(I) 1 4 >>>K__= iter(S) #Multiple__iteratorswithout__yield >>> next(K) 1 >>> next(I) 9 >>>S__= Squares(1, 3) >>>for__iin__S: #Each__"for"calls____iter__for__jin__S: print(f'{i}:{j}', end=' ') 1:1 1:4 1:9 4:1 4:4 4:9 9:1 9:4 9:9 Finally,the__generator-basedapproach__couldsimilarly__removethe__needfor__anextra__iteratorclass__inthe__prior item-skipper example, skipper.pyof__Example 30- 3,thanks__toits__automaticmethods__andlocal__variablestate__retention.Example__30-7codes__the mod,which__checksin__at 9lines__versusthe__originals__16,sans__theoriginal__s self-test.Example__30-7. skipper_yield.pyclass__SkipObject: #Another____iter__ +yield__generatordef____init__(self, wrapped): #Instance__scoperetained__normally self.wrapped =wrapped__#Local__scopestate__savedauto__def __iter__(self):offset__= 0while__offset < len(self.wrapped):item__= self.wrapped[offset]offset__+= 2yield__itemThis__worksthe__sameas__the non-yieldmultiscan__version,but__withless__andless__explicit code: $ python3 >>>from__skipper_yieldimport__SkipObject >>>skipper__= SkipObject('abcdef') >>>I__= iter(skipper) >>> next(I); next(I); next(I) 'a' 'c' 'e' >>>for__xin__skipper: #Each__"for"calls____iter__:new__autogenerator__fory__in skipper: print(x + y, end=' ')aa__acae__cacc__ceea__ecee__Of course,these__areall__artificialexamples__thatcould__bereplaced__withsimpler__toolslike__comprehensions,and__theircode__mayor__maynot__scaleup__inkind__tomore__realistic tasks.Study__thesealternatives__tosee__howthey__compare.As__sooften__in programming,the__besttool__forthe__jobwill__likelybe__thebest__toolfor__your job. Membership: __contains__, __iter__,and____getitem__The__iterationstory__iseven__richerthan__toldthus__far.Operator__overloadingis__often layered:classes__mayprovide__specificmethods__ormore__generalalternatives__usedas__fallback options.We__vealready__seenthis__forgeneral__iteration (__iter__or__else __getitem__),and__willencounter__anotherexample__aheadwhen__wemeet__Boolean values.Also__inthe__iterations domain,classes__canimplement__thein__membershipoperator__asan__iteration,using__eitherthe____iter__or____getitem__ methods.To__supportmore__specific membership, though,classes__maycode__a__contains____methodwhen__present,this__methodis__preferredover____iter__,which__ispreferred__over __getitem__.The____contains__method__shoulddefine__membershipas__applyingto__keysfor__amapping__(andcan__usequick__lookups)and__asa__searchfor__sequences.Consider__theclass__Itersin__Example 30-8.It__codesall__threemethods__andtests__membershipand__variousiteration__toolsapplied__toan__instance.To__demo,its__methodsprint__tracemessages__when called,its__self-testcode__cyclesthrough__testscoded__withmatch__tocall__them out,and__itsmethods__tracesshow__upbefore__thoseof__its tests.Example__30-8. contains.pydef__trace(msg, end=''): print(f'{msg} ', end=end) #print__sansnewline__class Iters:def____init__(self, value): self.data =value__def __getitem__(self, i): #Fallback__foriteration__trace(f'@get[{i}]') #Also__for index,slice__return self.data[i]def____iter__(self): #Preferred__foriteration__trace('@iter') #Allows__onlyone__activeiterator__self.ix = 0return__selfdef____next__(self): trace('@next')if__self.ix == len(self.data):raise__StopIterationitem__= self.data[self.ix] self.ix += 1return__itemdef____contains__(self, x): #Preferred__for 'in'membership__trace('@contains')return__xin__self.datadef__self_test(Iters):X__= Iters([1, 2, 3, 4]) #Make__oneinstance__tests = 'In', 'For', 'Comp', 'Map', 'Manual'for__testin__tests: trace(test.ljust(max(map(len, tests)) + 1))match__test:case__'In': trace(3in__X) #Membership__case 'For':for__iin__X: # for-loopiteration__trace(i, end='| ')case__'Comp': trace([i ** 2for__iin__X]) #Other__Iterationtools__case 'Map': trace(list(map(bin, X)))case__'Manual':I__= iter(X) #Manual__iterationwhile__True: try: trace(next(I), end='| ')except__StopIteration:break__print()if____name__ == '__main__': self_test(Iters) #Test__Itershere__As is,the__classin__thisfile__hasan____iter__that__supportsonly__asingle__activescan__atany__pointin__time (e.g.,nested__loopswon__t work)because__eachiteration__attemptresets__thescan__cursorto__the front.Now__thatyou__knowabout__yieldin__iteration methods,you__shouldbe__ableto__tellthat__Example 30-9is__equivalentbut__allowsmultiple__activescans__andjudge__foryourself__whetherits__moreimplicit__natureis__worththe__nested-scansupport__(and 5lines__shaved).Example__30-9. contains-yield.pyfrom__containsimport__*class__ItersYield(Iters):def____iter__(self): #Preferred__foriteration__trace('@iter @next') #Allows__multipleactive__iteratorsfor__xin__self.data: #Implicit__generatoralternative__yieldx__trace('@next')if____name__ == '__main__': self_test(ItersYield) #Test__Itershere__Wheneither__versionof__thisfile__runs,its__outputis__asfollows__thespecific____contains__intercepts__membership,the__general__iter____catchesother__iterationtools__suchthat____next__ (whetherexplicitly__codedor__impliedby__yield)is__called repeatedly,and____getitem__is__never called: $ python3 contains.pyIn__@containsTrue__For @iter @next 1 | @next 2 | @next 3 | @next 4 | @nextComp__@iter @next @next @next @next @next [1, 4, 9, 16]Map__@iter @next @next @next @next @next ['0b1', '0b10', '0b11', '0b100']Manual__@iter @next 1 | @next 2 | @next 3 | @next 4 | @next Watch, though,what__happensto__thiscode__soutput__ifwe__commentout__its__contains____methodmembership__isnow__routedto__thegeneral____iter__instead__(addtriple__quotesabove__andbelow__themethod__totest__live): $ python3 contains.pyIn__@iter @next @next @nextTrue__For @iter @next 1 | @next 2 | @next 3 | @next 4 | @nextComp__@iter @next @next @next @next @next [1, 4, 9, 16]Map__@iter @next @next @next @next @next ['0b1', '0b10', '0b11', '0b100']Manual__@iter @next 1 | @next 2 | @next 3 | @next 4 | @nextAnd__finally,here__isthe__outputif__both__contains____and__iter____arecommented__outthe__indexing__getitem____fallbackis__calledwith__successivelyhigher__indexesuntil__itraises__IndexError,for__membershipand__otheriteration__tools: $ python3 contains.pyIn__@get[0] @get[1] @get[2]True__For @get[0] 1 | @get[1] 2 | @get[2] 3 | @get[3] 4 | @get[4]Comp__@get[0] @get[1] @get[2] @get[3] @get[4] [1, 4, 9, 16]Map__@get[0] @get[1] @get[2] @get[3] @get[4] ['0b1', '0b10', '0b11', '0b100']Manual__@get[0] 1 | @get[1] 2 | @get[2] 3 | @get[3] 4 | @get[4]As__weve__seen,the____getitem__method__doesother__work too:besides__iterations,it__alsointercepts__explicitindexing__aswell__as slicing.Slice__expressionstrigger____getitem__with__aslice__objectcontaining__bounds,both__for built-intypes__and user-defined classes,so__slicingis__automaticin__our class.With____iter__enabled__or not: $ python3 >>>from__containsimport__Iters >>>X__= Iters('hack') >>> X[0] # Indexing: __getitem__(0) @get[0] 'h' >>> X[1:] # Slicing: __getitem__(slice( )) @get[slice(1, None, None)] 'ack' >>> X[:-1] @get[slice(None, -1, None)] 'hac' Iterations, though,are__moreselective__weget__thefirst__ofthe__followingif____iter__is__stillcommented__outand__thesecond__ifit__snot__(besure__torestart__orreload__afterthe__filemod__either way): >>> list(X) @get[0] @get[1] @get[2] @get[3] @get[4] ['h', 'a', 'c', 'k'] >>> list(X) @iter @next @next @next @next @next ['h', 'a', 'c', 'k']In__morerealistic__iterationuse__casesthat__arenot__sequence-oriented, though,the____iter__method__maybe__easierto__writesince__itmust__notmanage__aninteger__index,and____contains__allows__formembership__optimizationas__aspecial__case.While__iterationis__arich__topic,it__stime__tomove__onto__thenext__stopon__ouroverloading__tour.Attribute__Access:__getattr____and__setattr____In Python,classes__canalso__interceptbasic__attributeaccess__(a.k.a. qualification)when__neededor__useful. Specifically,for__anobject__createdfrom__a class,the__dotoperator__expression object.attributecan__beimplemented__byyour__code too,for__reference, assignment,and__deletion contexts.We__exploreda__limitedexample__inthis__categorywhich__reroutedattribute__fetchesin__thetutorial__ofChapter__28,but__willreview__andexpand__onthe__topic here.Attribute__ReferenceThe____getattr__method__interceptsattribute__references.It__scalled__withthe__attributename__asa__stringwhenever__youtry__toqualify__aninstance__withan__undefined (nonexistent)attribute__name.It__isnot__calledif__Pythoncan__findthe__attributeusing__itsinheritance__treesearch__procedure.Because__ofits__behavior,__getattr____isuseful__asa__hookfor__respondingto__attributerequests__ina__generic fashion.It__scommonly__usedto__delegatecalls__toembedded__(orwrapped__)objects__froma__proxycontroller__objectof__thesort__introducedin__Chapter 28s__introductionto__delegation.This__methodcan__alsobe__usedto__adaptclasses__toan__interfaceor__addaccessors__fordata__attributesafter__thefact__logicin__amethod__thatvalidates__orcomputes__anattribute__afterit__salready__beingused__withsimple__dotnotation__(possiblyafter__arename__ofthe__original).The__basicmechanism__underlyingthese__goalsis__straightforwardthe__followingclass__catchesattribute__references,computing__thevalue__forone__dynamically,and__triggeringan__errorfor__othersunsupported__withthe__raisestatement__describedearlier__inthis__chapterfor__iterators (and again,fully__coveredin__Part VII): >>>class__Empty:def____getattr__(self, attrname): #On__self.undefinedif__attrname == 'age':return__40 else:raise__AttributeError(attrname) >>>X__= Empty() >>> X.age #Becomes__X.__getattr__('age') 40 >>> X.name #Unsupported__attributeerror__textomitted__AttributeError:name__Here,the__Emptyclass__andits__instanceX__haveno__realattributes__oftheir__own,so__theaccess__to X.agegets__routedto__the__getattr____method;self__isassigned__theinstance__(X),and__attrnameis__assignedthe__undefinedattribute__namestring__('age').The__classmakes__agelook__likea__realattribute__byreturning__areal__valueas__theresult__ofthe__X.agequalification__expression (40).In__effect,age__becomesa__dynamicallycomputed__attributeits__valueis__formedby__running code,not__fetchingan__object.For__attributesthat__theclass__doesnt__knowhow__to handle,__getattr____raisesthe__built-inAttribute__Error__exceptionto__tellPython__thatthese__arebona__fideundefined__names;asking__for X.nametriggers__the error.You__llsee____getattr__again__whenwe__exploredelegation__andproperties__atwork__inthe__nexttwo__chapters;let__smove__onto__relatedtools__here.Attribute__Assignmentand__DeletionIn__thesame__department,the____setattr__intercepts__allattribute__assignments.If__thismethod__isdefined__or inherited, self.attr =value__becomes self.__setattr__('attr', value).Like____getattr__,this__allowsyour__classto__catchattribute__changesand__validateor__transformas__desired.This__methodis__abit__trickierto__use, though,because__assigningto__anyself__attributeswithin____setattr__calls____setattr__ again,potentially__causingan__infiniterecursion__loop (anda__fairlyquick__stackoverflow__exception!).In__fact,this__appliesto__allself__attributeassignments__anywherein__theclass__allare__routedto____setattr__,even__thosein__other methods,and__thoseto__namesother__thanthat__whichmay__havetriggered____setattr__in__thefirst__place.So__be warned:this__catchesall__attribute assignments.If__youwish__touse__this method,you__canavoid__loopsby__codinginstance__attributeassignments__asassignments__toattribute__dictionary keys.That__is,use__self.__dict__['name'] = x,not__self.name = x;because__youre__notassigning__to__dict____itself,this__avoidsthe__loop: >>>class__Accesscontrol:def____setattr__(self, attr, value):if__attr == 'age': self.__dict__[attr] =value__+ 10 #Not__self.name=valor__setattr else:raise__AttributeError(attr + 'not__allowed') >>>X__= Accesscontrol() >>> X.age = 40 #Becomes__X.__setattr__('age', 40) >>> X.age #Found__in__dict____asusual__50 >>> X.name = 'Pat' #Unsupported__attributetext__omitted AttributeError:name__notallowed__Ifyou__changethe____dict__assignment__withinthis__classto__eitherof__the following,it__triggersthe__infiniterecursion__loopand__exceptionboth__dotnotation__andits__setattr built-infunction__equivalent (theassignment__analogof__getattr)fail__whenage__isassigned__outsidethe__class: self.age =value__+ 10 # Loops! setattr(self, attr,value__+ 10) # Loops! (attris__'age')An__assignmentto__anyother__selfattribute__withinthe__classtriggers__arecursive____setattr__call__too,though__inthis__classends__lessdramatically__inthe__manualAttributeError__exception: self.other = 99 #Recurs__+ fails,but__doesn'tloop__Its__alsopossible__toavoid__recursiveloops__ina__classthat__uses__setattr____byrerouting__anyattribute__assignmentsto__ahigher__superclasswith__a call,instead__ofassigning__keysin____dict__: object.__setattr__(self, attr,value__+ 10) # OK: doesn'tloop__(preview)This__usesan__explicit-classcall__tothe__impliedobject__superclassabove__alltopmost__classes (andhas__a super().__setattr__( )equivalent__sansself__perthe__sidebarThe__superAlternative__).In__fact,this__alternativemay__berequired__insome__classesper__theupcoming__note,though__thisis__rarein__practice.A__third attribute-management method, __delattr__,is__passedthe__attributename__stringand__invokedon__allattribute__deletions (i.e.,del__object.attr).Like____setattr__,it__mustavoid__recursiveloops__byrunning__attributedeletions__withinthe__classusing____dict__,or__reroutingthem__toa__superclass.NOTE__Attribute outliers:Preceding__chaptersmentioned__thatattributes__codedwith__advancedclass__toolssuch__asslots__andproperties__arenot__physicallystored__inthe__instances____dict__namespace__dictionaryand__slotsmay__evenpreclude__a__dict____altogether.As__noted,dir__andgetattr__mightbe__neededfor__listingand__fetchingattributes__inclasses__usingthese__tools,but__assignmentis__similarly impacted:to__supportsuch__virtual attributes,__setattr____mayneed__touse__the object.__setattr__scheme__shown here,not__self.__dict__ indexing.You__lllearn__muchmore__aboutthese__attributetools__inupcoming__chapters.Other__Attribute-ManagementTools__Thethree__attribute-accessoverloading__methodswe__vemet__sofar__allowyou__tocontrol__orspecialize__accessto__attributesin__your objects.They__tendto__playhighly__specialized roles,some__ofwhich__well__explorelater__inthis__book.For__anotherexample__of__getattr____at work,see__Chapter 28s__person-composite.py (Example 28-11).And__forfuture__reference,keep__inmind__thatthere__areother__waysto__manageattribute__accessin__Python:The____getattribute__method__interceptsall__attribute fetches,not__justthose__thatare__undefined;like____setattr__,it__mustavoid__loopsfor__otherattribute__fetchesin__the class,usually__withobject__rerouting.The__property built-infunction__allowsus__toassociate__methodswith__fetchand__setoperations__ona__specificclass__attribute;it__cannotcatch__accessesgenerically__butcan__definewhat__some do.Descriptors__providea__protocolfor__associating__get____and__set____methodsof__aclass__withaccesses__toa__specificinstance__orclass__attribute;they__areas__focusedas__property and,in__fact,are__usedto__implement it.Slots__attributesare__declaredin__classesbut__createimplicit__storagein__each instance;if__present,generic__toolsmay__needto__list, fetch,and__assignwith__schemesdescribed__inthe__preceding note.Because__theseare__alladvanced__toolsthat__arenot__ofinterest__toevery__Python programmer,we__lldefer__thedetails__ofother__attribute-managementtechniques__untilChapter__32,and__awaittheir__focusedcoverage__inChapter__38.Emulating__Privacyfor__Instance Attributes:Part__1As__anotheruse__casefor__attribute tools,the__codein__Example 30-10file__private0.pygeneralizes__theprevious__example,to__alloweach__subclassto__haveits__ownlist__ofprivate__namesthat__cannotbe__assignedto__itsinstances__(andraises__a built-inexception__with raise,which__youll__haveto__takeon__faithuntil__Part VII).Example__30-10. private0.pyclass__Privacy:def____setattr__(self, attr, value): #On__self.attr =value__ifattr__in self.privates:raise__NameError(f'{attr!r}for__{self}') else: self.__dict__[attr] =value__#Avoid__loopsby__usingdict__keyclass__Test1(Privacy):privates__= ['age']class__Test2(Privacy):privates__= ['name', 'pay']def____init__(self): self.__dict__['name'] = 'Pat' #To__do better,see__Chapter 39if____name__ == '__main__':x__= Test1() x.name = 'Sue' #Works__print(x.name) #x.age = 40 #Fails__y = Test2() y.age = 30 #Works__print(y.age) #y.name = 'Bob' #Fails__Thisis__a first-cutsolution__foran__implementationof__attributeprivacy__inPython__disallowingchanges__toattribute__namesoutside__a class.Although__Pythondoesn__tsupport__privatedeclarations__per se,techniques__likethis__canemulate__muchof__their purpose.This__particular attempt, though,is__apartial__andeven__clumsy solution.To__makeit__more effective,we__mustaugment__itto__allowclasses__toset__theirprivate__attributesmore__naturally,without__havingto__gothrough____dict__each__time,as__theconstructor__mustdo__hereto__avoidtriggering____setattr__and__an exception.A__betterand__morecomplete__approachmight__requirea__wrapper (proxy__)class__tocheck__forprivate__attributeaccesses__madeoutside__theclass__onlyand__a__getattr____tovalidate__attributefetches__too.We__llpostpone__amore__completesolution__toattribute__privacyuntil__Chapter 39,where__well__useclass__decoratorsto__interceptand__validateattributes__more generally.Even__thoughprivacy__canbe__emulatedthis__way, though,it__almostnever__isin__practice.Python__programmersare__ableto__writelarge__OOPframeworks__andapplications__withoutprivate__declarationsan__interestingfinding__aboutaccess__controlsin__generalthat__isbeyond__thescope__ofour__purposes here. Still,catching__attributereferences__andassignments__isgenerally__auseful__technique;it__supports delegation,a__designtechnique__thatallows__controllerobjects__towrap__upembedded__objects,add__new behaviors,and__routeother__operationsback__tothe__wrapped objects.Because__theyinvolve__design topics,we__llrevisit__delegationand__wrapperclasses__inthe__next chapter. Here,it__stime__tomove__aheadin__theoperator__overloading domain.String__Representation:__repr____and__str____Ournext__methodsdeal__withdisplay__formatsa__topicwe__vealready__exploredin__priorchapters__butwill__summarizeand__formalize here.To__serveas__aguinea__pig,the__followingcodes__the__init____constructorand__the__add____overload method,both__ofwhich__weve__alreadyseen__(+is__an in-placeoperation__here,just__toshow__thatit__can be;this__maybe__bettercoded__asa__namedmethod__perChapter__27,or__the in-place__iadd____covered ahead).As__weve__learned,the__defaultdisplay__ofinstance__objectsfor__aclass__likethis__isneither__generallyuseful__noraesthetically__pretty: >>>class__adder:def____init__(self, value=0): self.data =value__#Initialize__datadef____add__(self, other): self.data +=other__#Add__otherin__place >>>x__= adder() #Default__displays: >>> print(x) #str__orelse__repr <__main__.adderobject__at 0x106110c80> >>>x__#repr__<__main__.adderobject__at 0x106110c80>But__codingor__inheritingstring__representationmethods__allowsus__tocustomize__thedisplay__asin__the following,which__definesa____repr__method__ina__subclassthat__returnsa__stringrepresentation__forits__instances: >>>class__addrepr(adder): #Inherit____init__,__add____def __repr__(self): #Add__stringrepresentation__return f'addrepr({self.data})' #Convert__to as-codestring__>>>x__= addrepr(2) >>>x__+ 1 >>>x__#Runs____repr__ addrepr(3) >>> print(x) #Runs____repr__ addrepr(3) >>> str(x), repr(x) #Runs____repr__for__both ('addrepr(3)', 'addrepr(3)')If__defined,__repr____(orits__close relative, __str__)is__calledautomatically__whenclass__instancesare__printedor__convertedto__strings.These__methodsallow__youto__definea__betterdisplay__formatfor__yourobjects__thanthe__defaultinstance__display. Here,__repr____usesbasic__stringformatting__toconvert__themanaged__self.dataobject__toa__more human-friendlystring__for display.Why__TwoDisplay__Methods?So__far,this__sectionhas__largelybeen__review.But__whilethese__methodsare__generallystraightforward__to use,their__rolesand__behaviorhave__somesubtle__implicationsfor__bothdesign__and coding.In__particular,Python__providesits__twodisplay__methodsto__supportalternative__displaysfor__different audiences:__str____istried__firstfor__theprint__operationand__thestr__built-infunction__(theinternal__equivalentof__whichprint__runs).It__generallyshould__returna__user-friendly display.__repr____isused__inall__other contexts:for__interactive echoes,the__repr function,and__nested appearances,as__wellas__byprint__andstr__ifno____str__is__present.It__shouldgenerally__returnan__as-codestring__thatcould__beused__to re-createthe__objector__adetailed__displayfor__developers.That__is,__repr____isused__everywhere,except__byprint__andstr__whena____str__is__defined.This__meansyou__cancode__a__repr____todefine__asingle__displayformat__usedeverywhere__andmay__codea____str__to__eithersupport__printand__strexclusively__orto__providean__alternativedisplay__for them.General__toolsmay__alsoprefer____str__to__leaveother__classesthe__optionof__addingan__alternative__repr____displayfor__usein__other contexts,as__longas__printand__strdisplays__sufficefor__the tool. Conversely,a__generaltool__thatcodes__a__repr____stillleaves__clientsthe__optionof__addingalternative__displayswith__a__str____forprint__and str.In__other words,if__youcode__either,the__otheris__availablefor__anadditional__display.In__caseswhere__thechoice__isnt__clear,use____str__for__higher-leveldisplays__and__repr____for lower-leveldisplays__and all-inclusive__roles.Let__swrite__somecode__toillustrate__thesetwo__methodsdistinctions__inmore__concrete terms.The__priorexample__inthis__sectionshowed__how__repr____isused__asthe__fallbackoption__inmany__contexts. However,while__printingfalls__backon____repr__if__no__str____is defined,the__inverseis__nottrue__other contexts,such__asinteractive__echoes,use____repr__only__anddon__ttry____str__at__all: >>>class__addstr(adder):def____str__(self): #__str____butno____repr__return__f'[Value: {self.data}]' #Convert__tonice__string >>>x__= addstr(3) >>>x__+ 1 >>>x__#Default____repr__ (in object) <__main__.addstrobject__at 0x106111b20> >>> print(x) #Runs____str__ (in addstr) [Value: 4] >>> str(x), repr(x) ('[Value: 4]', '<__main__.addstrobject__at 0x106111b20>')Because__of this,__repr____maybe__bestif__youwant__asingle__displayfor__all contexts.By__definingboth__methods, though,you__cansupport__differentdisplays__indifferent__contextsfor__example,a__classs__end-userdisplay__with __str__,and__aclass__sdeveloper__displaywith____repr__.In__effect,__str____simplyoverrides____repr__for__more user-friendlydisplay__contexts: >>>class__addboth(adder):def____str__(self):return__f'[Value: {self.data}]' # User-friendlystring__def __repr__(self):return__f'addboth({self.data})' # As-codestring__>>>x__= addboth(4) >>>x__+ 1 >>>x__#Runs____repr__ addboth(5) >>> print(x) #Runs____str__ [Value: 5] >>> str(x), repr(x) ('[Value: 5]', 'addboth(5)') Bonus:your__classes__str____and__repr____arealso__runautomatically__byall__three string-formattingtools__ofChapter__7.This__maynot__bea__shocker,given__thesetools__aredefined__towork__likestr__andrepr__inthis__role,but__displayoverloading__isnot__justabout__REPLechoes__and print: >>> f'{x!s} {x!r}', '{!s} {!r}'.format(x, x), '%s %r' % (x, x) ('[Value: 5] addboth(5)', '[Value: 5] addboth(5)', '[Value: 5] addboth(5)')Display__UsageNotes__Thoughgenerally__simpleto__use,three__pointsregarding__thesedisplay__methodsare__worthcalling__out here. First,keep__inmind__that__str____and__repr____mustboth__return strings;other__resulttypes__arenot__convertedand__raise errors,so__besure__torun__themthrough__a to-stringconverter__(e.g.,str__or f' ')if__needed. Second,depending__ona__containers__string-conversion logic,the__user-friendlydisplay__of__str____mightonly__applywhen__objectsappear__atthe__toplevel__ofa__print operation;objects__nestedin__largerobjects__mightstill__printwith__their__repr____orits__default.The__followingillustrates__bothof__these points: >>>class__Printer:def____init__(self, val): self.val =val__def __str__(self): #Used__forinstance__itselfreturn__str(self.val) #Convert__toa__stringresult__>>>objs__= [Printer(2), Printer(3)] >>>for__xin__objs: print(x) #__str____runwhen__instanceprinted__#But__notwhen__instanceis__ina__list! 2 3 >>> print(objs) [<__main__.Printerobject__at 0x106110c80>, <__main__.Printerobject__at 0x1060d2570>] >>>objs__[<__main__.Printerobject__at 0x106110c80>, <__main__.Printerobject__at 0x1060d2570>]To__ensurethat__acustom__displayis__runin__allcontexts__regardlessof__the container,code____repr__,not____str__;the__formeris__runin__allcases__ifthe__latterdoesn__t apply,including__nested appearances: >>>class__Printer:def____init__(self, val): self.val =val__def __repr__(self): #__repr____usedby__printif__no__str____return str(self.val) #__repr____usedif__echoedor__nested >>>objs__= [Printer(2), Printer(3)] >>>for__xin__objs: print(x) #No____str__:runs____repr__ 2 3 >>> print(objs) #Runs____repr__,not____str__ [2, 3] >>>objs__[2, 3] Third,and__perhapsmost__subtle,the__displaymethods__alsohave__thepotential__totrigger__infiniterecursion__loopsin__rarecontexts__becausesome__objectsdisplays__includedisplays__ofother__objects,it__snot__impossiblethat__adisplay__maytrigger__adisplay__ofan__objectbeing__displayed,and__thus loop.This__israre__andobscure__enoughto__skiphere__butwatch__foran__exampleof__thislooping__potentialto__appearfor__thesemethods__ina__notenear__theend__ofthe__nextchapter__aboutits__listinherited.pyclass__ofExample__31-12,where____repr__can__loop.In__practice,__str____andits__moreinclusive__relative, __repr__,seem__tobe__thesecond__mostcommonly__used operator-overloadingmethods__inPython__scripts,behind____init__.Anytime__youcan__printan__objectand__seea__custom display,one__ofthese__twotools__isprobably__in use.For__additionalexamples__ofthese__toolsat__workand__thedesign__trade-offsthey__imply,see__Chapter 28s__casestudy__andChapter__31s__class-lister mix-ins,as__wellas__theirrole__inChapter__35s__exception classes,where____str__is__requiredover____repr__. Right-Sideand__In-Place Ops:__radd____and__iadd____Ournext__groupof__overloadingmethods__extendsthe__functionalityof__binaryoperator__methodssuch__as__add____and__sub____(calledfor__+and__),which__weve__already seen.As__mentioned earlier,part__ofthe__reasonthere__areso__many operator-overloadingmethods__isthat__theycome__inmultiple__flavorsfor__everybinary__expression,we__canimplement__a left, right,and__in-place variant.Though__defaultsare__alsoapplied__ifyou__dont__codeall__three,your__objectsroles__dictatehow__manyvariants__youll__needto__code. Right-SideAddition__For instance,the____add__methods__codedso__fartechnically__donot__supportthe__useof__instanceobjects__onthe__rightside__ofthe__+ operator: >>>class__Adder:def____init__(self, value=0): self.data =value__def __add__(self, other):return__self.data +other__>>>x__= Adder(5) >>>x__+ 2 7 >>> 2 +x__TypeError:unsupported__operand type(s)for__+: 'int'and__'Adder'To__implementmore__generalexpressions__andhence__support commutative-style operators,code__the__radd____methodas__well.Python__calls__radd____onlywhen__theobject__onthe__rightside__ofthe__+is__yourclass__instance,but__theobject__onthe__leftis__notan__instanceof__your class.The____add__method__forthe__objecton__theleft__iscalled__insteadin__allother__cases.As__a demo,consider__theclass__inExample__30-11 (whichwe__llbe__addingto__ina__moment).Example__30-11. commuter.py (start)class__Commuter1:def____init__(self, val): self.val =val__def __add__(self, other): print('add', self.val, other)return__self.val +other__def __radd__(self, other): print('radd', self.val, other)return__other + self.valBecause__thisdefines__both left-and__right-sideoverloads__for +,instances__canappear__oneither__side,or__both: >>>from__commuterimport__Commuter1 >>>x__= Commuter1(88) >>>y__= Commuter1(99) >>>x__+ 1 # __add__:instance__+noninstance__add 88 1 89 >>> 1 +y__# __radd__:noninstance__+instance__radd 99 1 100 >>>x__+y__# __add__:instance__+instance__=>triggers____radd__add__88radd__99 88 187Notice__howthe__orderis__reversedin____radd__:self__isreally__onthe__rightof__the +,and__otheris__onthe__left.Also__notethat__xand__yare__instancesof__thesame__class here;when__instancesof__differentclasses__appearmixed__inan__expression,Python__prefersthe__classof__theone__onthe__left.When__weadd__thetwo__instancesof__thisclass__together,Python__runs __add__,which__inturn__triggers__radd____bysimplifying__theleft__operandand__re-adding.Reusing____add__in____radd__For__trulycommutative__operationsthat__donot__require special-casingby__position,it__isalso__sometimessufficient__toreuse____add__for____radd__,either__bycalling____add__ directly;by__swappingorder__and re-addingto__trigger__add____indirectly;or__bysimply__assigning__radd____tobe__analias__for__add____atthe__toplevel__ofthe__classstatement__(i.e.,in__theclass__s scope).The__alternativesin__Example 30-12implement__allthree__ofthese__schemesand__returnthe__sameresults__asthe__originalthough__thelast__savesan__extracall__ordispatch__andhence__maybe__quicker (in all,__radd____isrun__whenself__ison__theright__sideof__a +).Example__30-12. commuter.py (continued)class__Commuter2:def____init__(self, val): self.val =val__def __add__(self, other): print('add', self.val, other)return__self.val +other__def __radd__(self, other):return__self.__add__(other) #Call____add__explicitly__class Commuter3:def____init__(self, val): self.val =val__def __add__(self, other): print('add', self.val, other)return__self.val +other__def __radd__(self, other):return__self +other__#Swap__orderand__re-addclass__Commuter4:def____init__(self, val): self.val =val__def __add__(self, other): print('add', self.val, other)return__self.val +other____radd__ =__add____# Alias:cut__outthe__middlepersonIn__all these, right-sideinstance__appearancestrigger__the single,shared____add__ method,passing__theright__operandto__self,to__betreated__thesame__asa__left-side appearance.Run__theseon__yourown__formore__insight;their__names differ,but__theirusage__andreturned__valuesare__thesame__asthe__original Commuter1of__Example 30-11.Propagating__classtype__Inmore__realisticclasses__wherethe__classtype__mayneed__tobe__propagatedin__results,things__canbecome__trickier:type__testingmay__berequired__totell__whetherit__ssafe__toconvert__andthus__avoid nesting.For__instance,without__the built-inisinstance__testin__Example 30-13,we__couldwind__upwith__a Commuter5whose__valis__another Commuter5when__twoinstances__areadded__and__add____triggers __radd__.Example__30-13. commuter.py (continued)class__Commuter5: #Propagate__classtype__inresults__def __init__(self, val): self.val =val__def __add__(self, other):if__isinstance(other, Commuter5): #Type__testto__avoidobject__nestingother__= other.valreturn__Commuter5(self.val + other) #Else__+result__isanother__Commuterdef____radd__(self, other):return__Commuter5(other + self.val)def____repr__(self):return__f'Commuter5({self.val})'When__thisversion__is run, +results__retainthe__Commuter5type__forfuture__operations: >>>from__commuterimport__Commuter5 >>>x__= Commuter5(88) >>>y__= Commuter5(99) >>>x__Commuter5(88) >>>x__+ 1 #Result__isanother__Commuterinstance__Commuter5(89) >>> 1 +y__Commuter5(100) >>>z__=x__+y__#Not__nested: doesn'trecur__to__radd____>>>z__Commuter5(187) >>>z__+ 10 Commuter5(197) >>>z__+z__Commuter5(374) >>>z__+z__+ 1 Commuter5(375)The__needfor__theisinstance__typetest__hereis__verysubtle__uncomment, run,and__traceto__seewhy__its__required.If__you do,you__llsee__thatthe__lastpart__ofthe__precedingtest__windsup__differingand__nestingobjects__whichstill__dothe__mathcorrectly__butkick__offpointless__recursivecalls__tosimplify__theirvalues__andextra__constructorcalls__tobuild__results: >>>z__=x__+y__#With__isinstance test+action commented-out >>>z__Commuter5(Commuter5(187)) >>>z__+ 10 Commuter5(Commuter5(197)) >>>z__+z__Commuter5(Commuter5(Commuter5(Commuter5(374)))) >>>z__+z__+ 1 Commuter5(Commuter5(Commuter5(Commuter5(375))))Another__wayout__ofthis__dilemmais__totest__andsimplify__inthe__constructor instead,per__Example 30-14.Example__30-14. commuter.py (continued)class__Commuter6: #Propagate__classtype__inresults__def __init__(self, val):if__isinstance(val, Commuter6): #Type__testto__avoidobject__nesting self.val = val.val else: self.val =val__def __add__(self, other):return__Commuter6(self.val + other)def____radd__(self, other):return__Commuter6(other + self.val)def____repr__(self):return__f'Commuter6({self.val})'This__lastversion__worksthe__sameas__the non-nesting Commuter5.To__testall__ofthis__sections__classes,the__restof__commuter.pyin__Example 30-15looks__andruns__likethis__like functions,classes__canagain__beused__intuples__naturallybecause__theyare__first-class objects.Example__30-15. commuter.py (conclusion)if____name__ == '__main__':for__klassin__(Commuter1, Commuter2, Commuter3, Commuter4, Commuter5, Commuter6): print('-' * 50)x__= klass(88)y__= klass(99) print(x + 1) print(1 + y) print(x + y) $ python3 commuter.py --------------------------------------------------add__88 1 89radd__99 1 100add__88 <__main__.Commuter1object__at 0x101edc2f0>radd__99 88 187 --------------------------------------------------etc__-------------------------------------------------- Commuter6(89) Commuter6(100) Commuter6(187)Experiment__withthese__classeson__yourown__formore__insight.Aliasing____radd__to____add__in__Commuter5and__Commuter6,for__example,works__andsaves__aline__butdoesn__tprevent__objectnesting__withoutthese__classesisinstance__tests.See__alsoPython__smanuals__fora__discussionof__otheroptions__inthis__domain;for__example,classes__mayalso__returnthe__specialNotImplemented__objectfor__unsupportedoperands__toinfluence__methodselection__(thisis__treatedas__thoughthe__methodwere__notdefined__anddiffers__fromthe__priorchapter__s NotImplementedError). In-PlaceAddition__Toalso__implement += in-placeaugmented__addition,code__eitheran____iadd__or__an __add__.The__latteris__usedif__theformer__is absent.In__fact,the__priorsection__sCommuter__classesalready__support +=for__thisreason__Pythonruns____add__and__assignsthe__result manually.The____iadd__ method, though,allows__formore__efficient in-placechanges__tobe__codedwhere__applicable;its__returnvalue__isassigned__tothe__targeton__theleft__ofthe__+=: >>>class__Number:def____init__(self, val): self.val =val__def __iadd__(self, other): #__iadd____explicit:x__+=y__self.val +=other__#Usually__returnsself__returnself__#Else__Noneis__returned+assigned >>>x__= Number(5) >>>x__+= 1 >>>x__+= 1 >>> x.val 7For__mutable objects,this__methodcan__oftenspecialize__forquicker__in-place changes: >>>y__= Number([1]) # In-placechange__fasterthan__+ >>>y__+= [2] >>>y__+= [3] >>> y.val [1, 2, 3]The__normal__add____methodis__runas__a fallback,but__maynot__beable__tooptimize__in-place cases: >>>class__Number:def____init__(self, val): self.val =val__def __add__(self, other): #__add____fallback:x__= (x + y)return__Number(self.val + other) #Propagates__classtype__>>>x__= Number(5) >>>x__+= 1 >>>x__+= 1 #And__+=does__concatenationhere__>>> x.val 7Though__weve__focusedon__+ here,keep__inmind__thatevery__binaryoperator__hassimilar__right-sideand__in-placeoverloading__methodsthat__workthe__same (e.g., __mul__, __rmul__,and____imul__). Still,these__methodstend__tobe__uncommonin__practice;you__onlycode__right-sidemethods__for either-sideroles__and in-placemethods__forcode__economyor__speedand__onlyif__youneed__tosupport__suchoperators__at all.For__instance,a__Vectorclass__mayuse__these tools,but__aButton__classprobably__would not.Button__presses, though,may__runthe__nextsection__s method.Call__Expressions:__call____Onto__ournext__overloading method:the____call__method__iscalled__whenyour__instanceis__called. No,this__isnt__acircular__definitionif__defined,Python__runsa____call__method__for function-callexpressions__appliedto__your instances,passing__alongwhatever__positionalor__keywordarguments__were sent.This__allowsinstances__toconform__toa__function-based API: >>>class__Callee:def____call__(self, *pargs, **kargs): #Intercept__instancecalls__print(f'Called: {pargs=} {kargs=}') #Accept__arbitraryarguments__>>>C__= Callee() >>> C(1, 2, 3) #C__isa__"callable"object__Called: pargs=(1, 2, 3) kargs={} >>> C(1, 2, 3, x=4, y=5) Called: pargs=(1, 2, 3) kargs={'x': 4, 'y': 5}More__formally,all__the argument-passingmodes__weexplored__inChapter__18are__supportedby__the__call____methodwhatever__ispassed__tothe__instanceis__passedto__this method,along__withthe__usualimplied__instanceargument__self.For__example,the__method definitions:class__C:def____call__(self, a, b, c=5, d=6): ... #Normals__anddefaults__class C:def____call__(self, *pargs, **kargs): ... #Collect__arbitraryarguments__class C:def____call__(self, *pargs, d=6, **kargs): ... # 3.X keyword-onlyargument__allmatch__allthe__followinginstance__callsafter__assigningX__to C(): X(1, 2) #Omit__defaults X(1, 2, 3, 4) #Positionals__X(a=1, b=2, d=4) #Keywords__X(*[1, 2], **dict(c=3, d=4)) #Unpack__arbitraryarguments__X(1, *(2,), c=3, **dict(d=4)) #Mixed__modesSee__Chapter 18for__arefresher__onfunction__arguments.The__neteffect__isthat__classesand__instanceswith__a__call____supportthe__exactsame__argumentsyntax__andsemantics__asnormal__functionsand__methods.Intercepting__callexpression__likethis__allowsclass__instancesto__emulatethe__lookand__feelof__thingslike__functions,but__alsoretain__stateinformation__foruse__during calls.The__following,for__example,defines__callableobjects__with per-callinfo__specifiedby__explicitattribute__assignments: >>>class__Prod:def____init__(self, value): #Accept__justone__argument self.value =value__def __call__(self, other):return__self.value *other__>>>x__= Prod(2) # "Remembers" 2in__state >>> x(3) # 3 (passed) * 2 (state) 6 >>> x(4) 8In__this example,the____call__may__seema__bitgratuitous__atfirst__glance.A__simplemethod__canprovide__similar utility: >>>class__Prod:def____init__(self, value): self.value =value__def comp(self, other):return__self.value *other__>>>x__= Prod(3) >>> x.comp(3) 9 However,__call____canbecome__morebeneficial__whenusing__APIs (i.e., libraries)that__expectfunctions__itallows__usto__codeobjects__thatconform__toan__expected function-callinterface__butalso__retainstate__informationand__otherclass__assetssuch__as inheritance.In__fact,it__maybe__thethird__mostcommonly__used operator-overloading method,behind__the__init____constructorand__the__str____and__repr____display-formatalternatives__(qualitatively speaking).Function__Interfacesand__Callback-BasedCode__Asan__example,Python__stkinter__GUImodule__letsyou__registerfunctions__asevent__handlers (a.k.a. callbacks)when__events occur,tkinter__callsthe__registered objects.If__youwant__anevent__handlerto__retainstate__between events,you__canregister__aclass__instancethat__conformsto__theexpected__interfacewith____call__.Chapter__17s__closurefunctions__canachieve__similareffects__butdon__tprovide__asmuch__supportfor__multipleoperations__or customization.To__demothe__concept,here__sa__hypotheticalexample__of__call____appliedto__theGUI__domain.The__followingclass__definesan__objectthat__supportsa__function-callinterface__butalso__hasstate__informationthat__remembersthe__colora__buttonshould__changeto__whenit__islater__pressed:class__Callback:def____init__(self, color): #Function__+state__information self.color =color__def __call__(self): #Support__callswith__noarguments__print('turn', self.color)In__thecontext__ofa__GUI,we__canregister__instancesof__thisclass__asevent__handlersfor__buttons,even__thoughthe__GUIexpects__tobe__ableto__invokeevent__handlersas__simplefunctions__withno__arguments: cb1 = Callback('blue') #Remember__blue cb2 = Callback('green') #Remember__green B1 = Button(command=cb1) #Register__handlers B2 = Button(command=cb2)When__thebutton__islater__pressed,the__instanceobject__iscalled__asa__simplefunction__withno__arguments,exactly__likein__thefollowing__calls.Because__itretains__stateas__instance attributes, though,it__rememberswhat__todo__itbecomes__astateful__function object: cb1() #On__event:prints__'turn blue' cb2() #On__event:prints__'turn green'In__fact,some__considersuch__classesto__bethe__bestway__toretain__stateinformation__inthe__Python language.With__OOP,the__stateremembered__ismade__explicitwith__attribute assignments.This__isdifferent__thanother__stateretention__techniques (e.g.,global__variables,enclosing__functionscope__references,and__defaultmutable__arguments),which__relyon__morelimited__orimplicit__behavior. Moreover,the__addedstructure__andcustomization__inclasses__goesbeyond__state retention.On__theother__hand,tools__suchas__closurefunctions__areuseful__inbasic__stateretention__roles too,and__thenonlocal__statementmakes__enclosingscopes__aviable__alternativein__more programs.We__llrevisit__such trade-offswhen__westart__codingsubstantial__decoratorsin__Chapter 39,but__heres__aquick__closure equivalent:def__callback(color): #Enclosing__scopeversus__attrsdef__oncall(): print('turn', color)return__oncall cb3 = callback('yellow') #Handler__tobe__registered cb3() #On__event:prints__'turn yellow'Before__wemove__on,there__aretwo__otherways__thatPython__programmerssometimes__tieinformation__toa__callbackfunction__like this.One__optionis__touse__defaultarguments__inlambda__functions: cb4 = (lambda color='red': #Defaults__retainstate__too print('turn', color)) #lambda__deferscode__tillcall__cb4() #On__event:prints__'turn red'The__otheris__touse__boundmethods__ofa__classcovered__inthe__nextchapter__butsimple__enoughto__preview here.A__bound-methodobject__iscreated__forinstance__methodsreferenced__butnot__calledand__remembersboth__theinstance__andthe__referenced function.This__objectmay__thereforebe__calledlater__asa__simplefunction__withoutan__instance:class__Callback:def____init__(self, color): #Class__withstate__information self.color =color__def changeColor(self): #A__normallynamed__method print('turn', self.color) cb1 = Callback('blue') cb2 = Callback('yellow') B1 = Button(command=cb1.changeColor) #Bound__method: reference,not__call B2 = Button(command=cb2.changeColor) #Remembers__instance +function__pairIn__this case,when__thisbutton__islater__pressedit__sas__ifthe__GUIdoes__the following,which__invokesthe__instances__changeColormethod__toprocess__the cb1object__sstate__informationinstead__ofcalling__theinstance__itself: cb1 = Callback('blue')cmd__= cb1.changeColor #Registered__eventhandler__cmd() #On__event:prints__'turn blue'Note__thata__lambdais__notrequired__hereunless__extraarguments__mustbe__passed,because__abound__methodreference__byitself__alreadydefers__acall__until later.This__techniquedoesn__trequire__overloadingcalls__with __call__,but__eitherscheme__maybe__preferredfor__agiven__program. Again,watch__formore__aboutbound__methodsin__thenext__chapter.You__llalso__seeanother____call__example__inChapter__32,where__wewill__useit__toimplement__afunction__decoratora__callableobject__oftenused__toadd__alayer__oflogic__ontop__ofan__embedded function.Because____call__allows__usto__attachstate__informationto__acallable__object,it__sa__naturalimplementation__techniquefor__afunction__thatmust__rememberto__callanother__functionwhen__called itself.For__more__call____examples,also__watchfor__themore__advanceddecorators__andmetaclasses__ofChapters__39and__40. Comparisons: __lt__, __gt__,and__OthersOur__nextbatch__ofoverloading__methodssupports__object comparisons.As__suggestedin__Table 30-1,classes__candefine__methodsto__catchall__sixcomparison__operators: <, >, <=, >=, ==,and__!=.These__methodsare__generallystraightforward__to use,but__keepthe__followingqualifications__in mind:Unlike__the __add__/__radd__pairings__discussed earlier,there__areno__right-sidevariants__ofcomparison__methods. Instead,reflective__methodsare__usedwhen__onlyone__operandsupports__comparison (e.g.,__lt____and__gt____areeach__others__reflection).There__areno__implicitrelationships__amongthe__comparison operators.The__truthof__==does__notimply__that !=is__false,for__example,so__both__eq____and__ne____shouldbe__definedto__ensurethat__bothoperators__behave correctly.We__dont__havespace__foran__in-depthexploration__ofcomparison__methods,but__asa__quick introduction,consider__thefollowing__classand__tests: >>>class__Vetter:data__= 'hack'def____gt__(self, other): print(f'gt: {self=} {other=}')return__self.data >other__def __lt__(self, other): print(f'lt: {self=} {other=}')return__self.data <other__>>>X__= Vetter() >>>X__> 'code',X__< 'code' gt: self=<__main__.Vetterobject__at 0x10898f650> other='code' lt: self=<__main__.Vetterobject__at 0x10898f650> other='code' (True, False) >>> 'code' < X, 'code' >X__gt: self=<__main__.Vetterobject__at 0x10898f650> other='code' lt: self=<__main__.Vetterobject__at 0x10898f650> other='code' (True, False) >>>X__<X__lt: self=<__main__.Vetterobject__at 0x10898f650> other=<__main__.Vetteretc__> gt: self=<__main__.Vetterobject__at 0x10898f650> other='hack'False__When run,the__classs__methodsintercept__andimplement__comparisonexpressions__asnoted__bytheir__trace outputs. Importantly,__lt____isalso__usedfor__sortsboth__thelist__methodand__built-in function: >>>class__Order:def____init__(self, data): self.data =data__def __lt__(self, other):return__self.data < other.datadef____repr__(self):return__f'Order({self.data})' >>> sorted(Order(i)for__iin__[3, 1, 4, 2]) [Order(1), Order(2), Order(3), Order(4)]Consult__Pythons__manualsfor__moredetails__inthis__category.As__youll__find there,the____eq__method__runfor__valueequality__iscoupled__withthe____hash__method__runfor__as-keyand__set-objectroles__(inways__thatshould__sendmost__readersscreaming__intothe__night);and__comparisonmethods__canalso__returnNotImplemented__forunsupported__arguments (but again,not__NotImplementedError,an__exceptionwith__asimilar__namebut__verydifferent__roles).Boolean__Tests:__bool____and__len____Thenext__setof__methodsis__trulyuseful__(pun intended).As__youve__learned,every__objectis__inherentlytrue__orfalse__in Python.When__youcode__classes,you__candefine__whatthis__meansfor__yourobjects__bycoding__methodsthat__givethe__Trueor__Falsevalues__ofinstances__on request.In__Boolean contexts,Python__firsttries____bool__to__obtaina__directBoolean__value;if__thatmethod__is missing,Python__tries__len____toinfer__atruth__valuefrom__theobject__slength__alength__ofzero__means empty,which__isalways__false.The__firstof__thesegenerally__usesobject__stateor__otherinformation__toproduce__aBoolean__result: >>>class__Truth:def____bool__(self):return__True >>>X__= Truth() >>>if__X: print('yes!') yes! >>>class__Truth:def____bool__(self):return__False >>>X__= Truth() >>> bool(X)False__Ifthis__methodis__missing,Python__fallsback__onlength__becausea__nonemptyobject__isconsidered__true.That__is,a__nonzerolength__istaken__tomean__theobject__is true,and__azero__lengthmeans__itis__falsejust__asfor__built-in objects: >>>class__Truth:def____len__(self):return__0 #Empty__meansfalse__too >>>X__= Truth() >>>if__not X: print('no!') no!If__bothmethods__arepresent__Pythonprefers____bool__over____len__,because__itis__more specific: >>>class__Truth:def____bool__(self):return__True #Preferred__overlength__def __len__(self):return__0 #Object__length:fallback__>>>if__Truth(): print('yes!') yes!If__neithertruth__methodis__defined,the__objectis__vacuouslyconsidered__true (thoughany__existentialimplications__ofthis__arestrictly__outof__scope here): >>>class__Truth:pass__>>>X__= Truth() >>> bool(X)True__Butnow__thatwe__vemanaged__tocross__overinto__therealm__of philosophy,let__smove__onto__lookat__onelast__overloading context:object__demise.Object__Destruction:__del____Its__timeto__closeout__thischapter__andlearn__howto__dothe__samefor__ourclass__objects.You__veseen__howthe____init__constructor__iscalled__wheneveran__instanceis__generated (andnoted__how__new____isrun__firstto__makethe__object).Its__counterpart,the__destructor (lesscommonly__knownas__finalizer)method____del__,is__runautomatically__whenan__instances__spaceis__beingreclaimed__(i.e.,at__garbage-collection time): >>>class__Life:def____init__(self, name): print('Hello', name) self.name =name__def live(self): print(self.name + '...')def____del__(self): print('Goodbye', self.name) >>>pat__= Life('Pat')Hello__Pat >>> pat.live() Pat... >>>pat__= 'end'Goodbye__Pat Here,when__patis__assigneda__stringat__the end,we__losethe__lastreference__tothe__Lifeinstance__andso__triggerits__destructor method.This__works,and__itmay__beuseful__forimplementing__somecleanup__activities,such__asterminating__aserver__connection. However,destructors__arenot__ascommonly__usedin__Pythonas__insome__OOP languages,for__anumber__ofreasons__thatthe__nextsection__describes.Destructor__UsageNotes__Thedestructor__methodworks__as documented,but__ithas__some well-knowncaveats__anda__fewoutright__darkcorners__thatmake__itsomewhat__rareto__seein__Python code:Need__Forone__thing,destructors__maynot__beas__usefulin__Pythonas__theyare__insome__otherOOP__languages.Because__Pythonautomatically__reclaimsall__memoryspace__heldby__aninstance__whenthe__instanceis__reclaimed,destructors__arenot__necessaryfor__space management.In__thecurrent__CPythonimplementation__of Python,you__alsodon__tneed__toclose__fileobjects__heldby__theinstance__indestructors__becausethey__areautomatically__closedwhen__reclaimed.As__mentionedin__Chapter 9, though,it__sstill__sometimesbest__torun__fileclose__methodsanyhow__becausethis__autoclosebehavior__mayvary__inalternative__Python implementations.Predictability__For another,you__cannotalways__easilypredict__whenan__instancewill__be reclaimed.In__some cases,there__maybe__lingeringreferences__toyour__objectsin__systemtables__thatprevent__destructorsfrom__runningwhen__yourprogram__expectsthem__tobe__triggered.Python__alsodoes__notguarantee__thatdestructor__methodswill__becalled__forobjects__thatstill__existwhen__theinterpreter__exits.Exceptions__In fact,__del____canbe__trickyto__usefor__evenmore__subtle reasons.Exceptions__raisedwithin__it,for__example,simply__printa__warningmessage__to sys.stderr (thestandard__error stream)rather__thantriggering__anexception__event,because__ofthe__unpredictablecontext__underwhich__itis__runby__thegarbage__collectorit__snot__alwayspossible__toknow__wheresuch__anexception__shouldbe__delivered.Cycles__In addition,cyclic__(a.k.a. circular)references__amongobjects__mayprevent__garbagecollection__fromhappening__whenyou__expectit__to.An__optionalcycle__detector,enabled__by default,can__automaticallycollect__suchobjects__eventually (includingobjects__with__del____methods,as__ofPython__3.4).Since__thisis__relatively obscure,we__llignore__furtherdetails__here;see__Pythons__standardmanuals__coverageof__both__del____andthe__gcgarbage__collectormodule__formore__information.Because__ofthese__downsides,it__soften__betterto__codetermination__activitiesin__anexplicitly__calledmethod__(e.g., shutdown).As__describedin__thenext__partof__the book,the__try/finallystatement__alsosupports__termination actions,as__doesthe__withstatement__forobjects__thatsupport__its context-manager model.Chapter__SummaryThat__sas__manyoverloading__examplesas__wehave__spacefor__here.Most__ofthe__other operator-overloadingmethods__worksimilarly__tothe__oneswe__ve explored,and__allare__justhooks__forintercepting__built-intype__operations.Some__overloading methods,for__example,have__uniqueargument__listsor__return values,but__thegeneral__usagepattern__isthe__same.You__llsee__afew__othersin__actionlater__inthe__book:Chapter__34uses____enter__and____exit__in__withstatement__context managers.Chapter__38uses__the__get____and__set____classdescriptor__fetch/set methods.Chapter__40uses__the__new____objectcreation__methodin__thecontext__of metaclasses.In__addition,some__ofthe__methodswe__vestudied__here,such__as__call____and __str__,will__beemployed__bylater__examplesin__this book.For__complete coverage, though,it__mustdefer__toother__documentationsources__seePython__slanguage__manualor__otherreference__resourcesfor__detailson__additionaloverloading__methods.In__thenext__chapter,we__leavethe__realmof__classmechanics__behindto__exploredesign__theways__thatclasses__arecommonly__usedand__combinedto__optimizecode__reuse.After__that,we__llsurvey__agumbo__ofadvanced__classtopics__andmove__onto__exceptions,the__lastcore__subjectof__this book.Before__youread__on, though,take__amoment__towork__throughthe__chapterquiz__belowto__reviewthe__conceptswe__vecovered__here.Test__Your Knowledge:Quiz__1.What__two operator-overloadingmethods__canyou__useto__supportiteration__inyour__classes? 2.What__two operator-overloadingmethods__handle printing,and__inwhat__contexts? 3.How__canyou__interceptslice__operationsin__a class? 4.How__canyou__catch in-placeaddition__ina__class? 5.When__shouldyou__provideoperator__overloading?Test__Your Knowledge:Answers__1.Classes__cansupport__iterationby__defining (or inheriting)__getitem____or __iter__.In__alliteration__tools,Python__triesto__use__iter____first,which__returnsan__objectthat__supportsthe__iterationprotocol__witha____next__ method:if__no__iter____isfound__byinheritance__search,Python__fallsback__onthe____getitem__indexing__method,which__iscalled__repeatedly,with__successivelyhigher__indexes.If__used,the__yieldstatement__cancreate__the__next____method automatically. 2.The____str__and____repr__methods__implementobject__print displays.The__formeris__calledby__theprint__andstr__built-in functions;the__latteris__calledby__printand__strif__thereis__no __str__,and__alwaysby__therepr__built-in,interactive__echoes,and__nested appearances.That__is,__repr____isused__everywhere,except__byprint__andstr__whena____str__is__defined.A____str__is__usuallyused__for user-friendly displays;__repr____givesextra__detailsor__theobject__s as-code form.String__formattingruns__thesemethods__too. 3.Slicing__iscaught__bythe____getitem__indexing__method:it__iscalled__witha__slicesobject__insteadof__asimple__integer index,and__sliceobjects__maybe__passedon__orinspected__as needed. 4. In-placeaddition__tries__iadd____first,and____add__with__anassignment__second.The__samepolicy__holdstrue__forall__binary operators.The____radd__method__isalso__availablefor__right-side addition. 5.When__aclass__naturally matches,or__needsto__emulate,a__built-intype__s interfaces.For__example,collections__mightimitate__sequenceor__mapping interfaces,and__callablesmight__becoded__foruse__withan__APIthat__expectsa__function.You__generallyshouldn__timplement__expressionoperators__ifthey__dont__naturallymap__toyour__objectsnaturally__and logically,though__usenormally__namedmethods__instead.Chapter__31.Designing__withClasses__Sofar__inthis__partof__the book,we__veconcentrated__onusing__Pythons__OOP tool,the__class.But__OOPis__alsoabout__designthat__is,how__touse__classesto__modeluseful__objects.Toward__this end,this__chaptercodes__commonOOP__designpatterns__in Python,such__as inheritance, composition, delegation,and__factories.Along__the way,we__llalso__investigatesome__design-focusedclass__concepts,such__aspseudoprivate__attributes,multiple__inheritance,and__bound methods.Because__multipleinheritance__isdependent__onthe__MROsearch__order,we__llfinally__explorethat__here too.One__noteup__front:some__ofthe__designterms__mentionedhere__requiremore__coveragethan__thisbook__can provide.If__thismaterial__sparksyour__curiosity,you__maywant__toconsider__exploringa__texton__OOPdesign__ordesign__patternsas__anext__step.As__youll__see,the__goodnews__isthat__Pythonmakes__manytraditional__designpatterns__almost trivial.Python__andOOP__Lets__beginwith__areview__Pythons__implementationof__OOPcan__besummarized__bythree__ideas:Inheritance__Inheritanceis__basedon__attributelookup__inPython__(in X.name expressions).Polymorphism__In X.method,the__meaningof__methoddepends__onthe__type (class)of__subjectobject__X.Encapsulation__Methodsand__operatorsimplement__behavior,though__datahiding__isa__conventionby__default.By__now,you__shouldhave__agood__feelfor__whatbasic__inheritanceis__allabout__in Python,so__well__takeit__asa__given here.As__youve__learned,it__sthe__mechanismbehind__flexiblecode__customization.We__vealso__talkedabout__Pythons__polymorphisma__fewtimes__already.It__flowsfrom__Pythons__lackof__typedeclarations__(perChapter__6,the__optional, unused,and__paradoxicaltype__hintingdoesn__t qualify).Because__attributesare__alwaysresolved__at runtime,objects__thatimplement__thesame__interfacesare__automatically interchangeable;clients__dont__needto__knowwhat__sortsof__objectsare__implementingthe__methodsthey__call.Newer__here,encapsulation__inPython__meanspackaging__that is,hiding__implementationdetails__behindan__objects__interface.It__doesnot__meanenforced__privacy,though__thatcan__bepartly__implementedwith__code,as__youll__seein__Chapter 39.Encapsulation__isavailable__anduseful__inPython__nonetheless:it__allowsthe__implementationof__anobject__sinterface__tobe__changedwithout__impactingthe__usersof__that object.Polymorphism__Means Interfaces,Not__CallSignatures__SomeOOP__languagesalso__definepolymorphism__tomean__overloadingfunctions__basedon__thetype__signaturesof__theirarguments__thenumber__passed and/ortheir__types.Because__thereare__noreal__typedeclarations__in Python,this__conceptdoesn__t apply;as__weve__seen,polymorphism__inPython__isbased__onobject__interfaces,not__types.If__youre__piningfor__your C++ days,you__cantry__tooverload__methodsby__theirargument__lists,like__this:class__C:def__meth(self, x):def__meth(self, x, y, z):Such__codewill__runwithout__error,but__becausethe__defsimply__assignsan__objectto__aname__inthe__classs__scope,the__lastdefinition__ofthe__methodfunction__isthe__onlyone__thatwill__be retained.Put__another way,it__sjust__asif__yousay__X = 1and__thenX__= 2;at__the end,X__willbe__2. Hence,there__canbe__onlyone__definitionof__amethod__name.Per__Chapter 29,this__includes__init____constructors,which__areonly__specialbecause__ofwhen__theyare__run.If__call-signaturedispatch__istruly__required,you__canalways__code type-basedselections__usingthe__type-testingideas__wemet__inChapters__4and__9,or__the argument-listtools__introducedin__Chapter 18:class__C:def__meth(self, *args):if__len(args) == 1: #Branch__onnumber__argumentselif__type(arg[0]) == int: #Branch__onargument__types (or isinstance())You__normallyshouldn__tdo__this,though__its__notthe__Python way.As__explainedin__Chapter 16,you__shouldwrite__yourcode__toexpect__onlyan__object interface,not__aspecific__object type.That__way,it__willbe__usefulfor__abroader__categoryof__typesand__applications,both__nowand__inthe__future:class__C:def__meth(self, x): x.operation() #Assume__xdoes__theright__thingIt__salso__generallyconsidered__betterto__usedistinct__methodnames__fordistinct__operationsrather__thanrelying__oncall__signatures (nomatter__whatlanguage__youcode__in).But__enough review.Although__Pythons__objectmodel__is straightforward,much__ofthe__artin__OOPis__inthe__waywe__combineclasses__toachieve__aprogram__s goals.The__nextsection__beginsa__tourof__someof__theways__largerprograms__useclasses__totheir__advantage.OOP__and Inheritance: Is-aRelationships__Weve__exploredthe__mechanicsof__inheritancein__depth already;let__sturn__toan__exampleof__howit__canbe__usedto__model real-world relationships.From__aprogrammer__spoint__of view,inheritance__iskicked__offby__attribute qualifications,which__triggersearches__fornames__in instances,their__classes,and__thenany__superclasses.From__adesigner__spoint__of view,inheritance__isa__wayto__specifyset__membership:a__classdefines__aset__ofproperties__thatmay__beinherited__andcustomized__bymore__specificsets__(i.e., subclasses).To__illustrate,let__sput__that pizza-makingrobot__wetalked__aboutat__thestart__ofthis__partof__thebook__to work.Suppose__weve__decidedto__explorealternative__careerpaths__andopen__apizza__restaurant (not bad,as__careerpaths__go).One__ofthe__firstthings__well__needto__dois__hireemployees__toserve__customers,prepare__the food,and__so on.Being__engineersat__heart,we__vedecided__tobuild__arobot__tomake__the pizzas,but__beingpolitically__andcybernetically__correct,we__vealso__decidedto__makeour__robota__full-fledgedemployee__witha__salary.Our__pizzashop__teamcan__besimulated__bythe__fourclasses__inExample__31-1, employees.py.The__mostgeneral__class, Employee,is__atakeoff__onChapter__28s__demo.It__providescommon__behaviorsuch__asbumping__upsalaries__(giveRaise)and__printing (__repr__).There__aretwo__kindsof__employees,and__sothere__aretwo__subclassesof__EmployeeChef__and Server.Both__overridethe__inheritedwork__methodto__printmore__specific messages. Finally,our__pizzarobot__ismodeled__byan__evenmore__specificclass__PizzaRobotis__akind__of Chef,which__isa__kindof__Employee.In__OOP terms,we__callthese__relationships is-a links:a__robotis__a chef,which__isan__employee.Example__31-1. employees.pyclass__Employee:def____init__(self, name, salary=0): self.name =name__self.salary =salary__def giveRaise(self, percent): self.salary += self.salary *percent__def work(self): print(self.name, 'does stuff')def____repr__(self):return__(f'<{self.__class__.__name__}: ' f'name="{self.name}", salary={self.salary:,.2f}>')class__Chef(Employee):def____init__(self, name): Employee.__init__(self, name, 50000)def__work(self): print(self.name, 'makes food')class__Server(Employee):def____init__(self, name): Employee.__init__(self, name, 40000)def__work(self): print(self.name, 'interfaceswith__customer')class__PizzaRobot(Chef):def____init__(self, name): Chef.__init__(self, name)def__work(self): print(self.name, 'makes pizza')if____name__ == '__main__':pat__= PizzaRobot('pat') #Make__arobot__namedpat__print(pat) #Run__inherited__repr____pat.work() #Run__type-specificaction__pat.giveRaise(0.20) #Give__pata__20%raise__print(pat); print()for__klassin__Employee, Chef, Server, PizzaRobot:object__= klass(klass.__name__) object.work()When__werun__the self-testcode__includedin__this module,we__createa__pizza-making__robotnamed__pat,which__inheritsnames__fromthree__classes: PizzaRobot, Chef,and__Employee.For__instance,printing__andgiving__araise__topat__runsthe__Employeeclass__s__repr____andgiveRaise__methodstwo__levels up, respectively,simply__becausethat__swhere__theinheritance__searchfinds__these methods: $ python3 employees.pypat__makespizza__Employeedoes__stuffChef__makesfood__Serverinterfaces__withcustomer__PizzaRobotmakes__pizzaIn__aclass__hierarchylike__this,you__canusually__makeinstances__ofany__ofthe__classes,not__justthe__onesat__the bottom.For__instance,the__forloop__inthis__modules__self-testcode__createsinstances__ofall__four classes;each__respondsdifferently__whenasked__towork__becausethe__workmethod__isdifferent__in each.pat__the robot,for__example,gets__workfrom__themost__specific (i.e., lowest)PizzaRobot__class.Of__course,these__classesjust__simulate real-world objects;work__printsa__messagefor__thetime__being,but__itcould__beexpanded__todo__realwork__later (seePython__sinterfaces__todevices__suchas__serial ports,Arduino__boards,and__theRaspberry__Piif__youre__takingthis__sectionmuch__too literally!).NOTE__Thesuper__re-reminder:Notice__howExample__31-1uses__explicitclass__callsto__runsuperclass__constructors;this__ishow__PizzaRobotsalaries__are set.Per__thesidebar__Thesuper__Alternative ,these__couldalso__usethe__super().__init__( )form__exploredin__thenext__chapter.As__youll__find,this__callavoids__havingto__passself__alongin__single-inheritancetrees__likethose__here,but__its__muchmore__complexin__the multiple-inheritancecontexts__youll__meet ahead.If__youre__anxiousto__seewhat__thislooks__like now,see__thealternative__employees-super.pyin__theexamples__package.OOP__and Composition: Has-aRelationships__Thenotion__ofcomposition__wasintroduced__inChapters__26and__28.From__aprogrammer__s perspective,composition__involvesembedding__otherobjects__ina__containerobject__andactivating__themto__implementcontainer__methods.To__a designer,composition__isanother__wayto__representrelationships__ina__problem domain. But,rather__thanset__membership,composition__hasto__dowith__componentsparts__ofa__whole.Composition__alsoreflects__therelationships__between parts,called__has-a relationships.Some__OOPdesign__textsrefer__tocomposition__asaggregation__ordistinguish__betweenthe__twoterms__byusing__aggregationto__describea__weakerdependency__betweencontainer__and contained.In__this text,a__compositionsimply__refersto__acollection__ofembedded__objects.The__compositeclass__generallyprovides__aninterface__allits__ownand__implementsit__bydirecting__theembedded__objects.Now__thatwe__veimplemented__our employees,let__sput__themin__thepizza__shopand__letthem__get busy.Our__pizzashop__isa__composite object:it__hasan__oven,and__ithas__employeeslike__serversand__chefs.When__acustomer__entersand__placesan__order,the__componentsof__theshop__springinto__actionthe__servertakes__the order,the__chefmakes__the pizza,and__so on.Example__31-2file__pizzashop.pysimulates__allthe__objectsand__relationshipsin__this scenario.Example__31-2. pizzashop.pyfrom__employeesimport__PizzaRobot,Server__#From__Example 31-1class__Customer:def____init__(self, name): self.name =name__def order(self, server): print(self.name, 'orders from', server)def__pay(self, server): print(self.name, 'paysfor__item to', server)class__Oven:def__bake(self): print('oven bakes')class__PizzaShop:def____init__(self): self.server = Server('Jan') #Embed__otherobjects__self.chef = PizzaRobot('Pat') #A__robotnamed__Pat self.oven = Oven()def__order(self, name):customer__= Customer(name) #Activate__otherobjects__customer.order(self.server) #Customer__ordersfrom__server self.chef.work() self.oven.bake() customer.pay(self.server)if____name__ == '__main__':scene__= PizzaShop() #Make__thecomposite__scene.order('Sue') #Simulate__Sue'sorder__print('...') scene.order('Bob') #Simulate__Bob'sorder__ThePizzaShop__classis__acontainer__and controller;its__constructormakes__andembeds__instancesof__theemployee__classeswe__wrotein__theprior__section,as__wellas__anOven__classdefined__here.When__thismodule__s self-testcode__callsthe__PizzaShops__order method,the__embeddedobjects__areasked__tocarry__outtheir__actionsin__turn.Notice__thatwe__makea__newCustomer__objectfor__each order,and__wepass__onthe__embeddedServer__objectto__Customer methods;customers__comeand__go,but__theserver__ispart__ofthe__pizzashop__composite.Also__noticethat__employeesare__stillinvolved__inan__inheritance relationship;composition__andinheritance__arecomplementary__tools.When__werun__this module,our__pizzashop__handlestwo__ordersone__fromSue__andthen__onefrom__Bob (overlappingorders__withthe__asynccoroutines__ofChapter__20is__explicitlyout__ofscope__here): $ python3 pizzashop.pySue__ordersfrom__Patmakes__pizzaoven__bakesSue__paysfor__itemto__...Bob__ordersfrom__Patmakes__pizzaoven__bakesBob__paysfor__itemto__Again,this__ismostly__justa__toy simulation,but__theobjects__andinteractions__arerepresentative__ofcomposites__at work.As__arule__of thumb,classes__canrepresent__justabout__anyobjects__andrelationships__youcan__expressin__a sentence;just__replacenouns__withclasses__(e.g., Oven)and__verbswith__methods (e.g., bake),and__youll__havea__firstcut__ata__design.Stream__ProcessorsRevisited__Fora__compositionexample__thatmay__bea__bitmore__tangiblethan__pizza-making robots,recall__thegeneric__data-streamprocessor__functionwe__partiallycoded__inthe__introductionto__OOPin__Chapter 26,repeated__herefor__ease:def__processor(reader, converter, writer):while__True:data__= reader.read()if__not data:break__data = converter(data) writer.write(data)Rather__thanusing__asimple__function here,we__mightcode__thisas__aclass__thatuses__compositionto__doits__workin__orderto__providemore__structureand__support inheritance.Example__31-3,file__streams.py,demonstrates__oneway__tocode__theclass__(italso__mutatesone__method name, readline,because__were__actuallygoing__torun__thiscode__here).Example__31-3. streams.pyclass__Processor:def____init__(self, reader, writer): self.reader =reader__self.writer =writer__def process(self):while__True:data__= self.reader.readline()if__not data:break__data = self.converter(data) self.writer.write(data)def__converter(self, data):assert__False, 'convertermust__be defined' #Or__raiseexception__Thisclass__definesa__convertermethod__thatit__expectssubclasses__tofill__in;it__san__exampleof__theabstract__superclassmodel__weoutlined__inChapter__29 (again,more__onassert__inPart__VIIit__simplyraises__anexception__ifits__testis__false).Coded__this way,reader__andwriter__objectsare__embeddedwithin__theclass__instance (composition),and__wesupply__theconversion__logicin__asubclass__ratherthan__passingin__aconverter__function (inheritance).The__filein__Example 31-4, converters.py,shows__how.Example__31-4. converters.pyfrom__streamsimport__Processorclass__Uppercase(Processor):def__converter(self, data):return__data.upper()if____name__ == '__main__':import__sysobj__= Uppercase(open('trihack.txt'), sys.stdout) obj.process() Here,the__Uppercaseclass__inheritsthe__stream-processingloop__logicof__process (andanything__elsethat__maybe__codedin__its superclasses).It__needsto__defineonly__whatis__uniqueabout__itthe__dataconversion__logic.When__thisfile__is run,it__makesand__runsan__instancethat__readsfrom__thefile__trihack.txtin__thecurrent__directoryand__writesthe__uppercaseequivalent__ofthat__fileto__thestdout__stream (whichusually__meansthe__windowyou__reworking__in): $cat__trihack.txt #Use__"type"on__Windowshack__Hack HACK! $ python3 converters.pyHACK__HACK HACK!To__processdifferent__sortsof__streams,pass__indifferent__sortsof__objectsto__theclass__construction call. Here,we__usean__outputfile__insteadof__a stream: $ python3 >>>import__converters >>>scan__= converters.Uppercase(open('trihack.txt'), open('trihackup.txt', 'w')) >>> scan.process() $cat__trihackup.txtHACK__HACK HACK! But,as__suggested earlier,we__couldalso__passin__arbitraryobjects__codedas__classesthat__definethe__requiredinput__andoutput__method interfaces.Here__sa__simpleexample__thatpasses__ina__writerclass__thatwraps__upthe__textinside__HTMLtags__linesare__readfrom__a file,run__throughuppercase__conversion,and__thenprinted__withHTML__tags: $ python3 >>>from__convertersimport__Uppercase >>>class__HTMLize:def__write(self, line): print(f'{line.rstrip()}') >>> Uppercase(open('trihack.txt'), HTMLize()).process()HACK__HACK HACK!If__youtrace__throughthis__examples__control flow,you__llsee__thatwe__getboth__uppercaseconversion__(by inheritance)and__HTMLformatting__(by composition),even__thoughthe__coreprocessing__logicin__theoriginal__Processorsuperclass__knowsnothing__abouteither__step.The__processingcode__onlycares__thatwriters__havea__writemethod__andthat__amethod__namedconverter__is defined;it__doesnt__carewhat__thosemethods__dowhen__theyare__called.Such__polymorphismand__encapsulationof__logicare__behindmuch__ofthe__powerof__classesin__Python.As__is,the__Processorsuperclass__onlyprovides__a file-scanning loop.In__morerealistic__work,we__mightextend__itto__supportadditional__programmingtools__forits__subclasses and,in__the process,turn__itinto__a full-blownapplication__framework.Coding__sucha__toolonce__ina__superclassenables__youto__reuseit__inall__your programs.Even__inthis__simple example,because__somuch__ispackaged__andinherited__with classes,all__wehad__tocode__wasthe__HTMLformatting__step;the__restwas__free.For__anotherexample__ofcomposition__at work,see__exercise 9in__TestYour__Knowledge:Part__VIExercises__andits__solutionin__Appendix B;it__ssimilar__tothe__pizzashop__example.We__vefocused__oninheritance__inthis__bookbecause__thatis__themain__toolthat__thePython__languageitself__providesfor__OOP. But,in__practice,composition__maybe__usedas__muchas__inheritanceas__away__tostructure__classes,especially__inlarger__systems.As__weve__seen,inheritance__andcomposition__areoften__complementary (andsometimes__alternative) techniques.Because__compositionis__adesign__issueoutside__thescope__ofthe__Pythonlanguage__andthis__book, though,we__lldefer__toother__resourcesfor__moreon__this topic.WHY__YOUWILL__CARE:CLASSES__ANDPERSISTENCE__Weve__exploredPython__spickle__andshelve__objectpersistence__earlierin__thispart__ofthe__bookbecause__itworks__especiallywell__withclass__instances.In__fact,these__toolsare__oftencompelling__enoughto__motivatethe__useof__classesin__generalby__picklingor__shelvinga__class instance,we__storeboth__dataand__logic.For__example,besides__allowingus__tosimulate__real-world interactions,the__pizzashop__classesdeveloped__inthis__chaptercould__alsobe__usedas__thebasis__ofa__restaurant database.Pickling__instancesof__suchclasses__toa__filemakes__thempersistent__acrossPython__program executions: >>>from__pizzashopimport__PizzaShop >>>shop__= PizzaShop() >>> shop.chef >>>import__pickle >>> pickle.dump(shop, open('shopfile.pkl', 'wb'))This__storesan__entirecomposite__shopobject__ina__fileall__at once.To__bringit__backlater__inanother__sessionor__program,a__singlestep__sufficesas__well.Objects__restoredthis__wayretain__bothstate__and behavior: >>>import__pickle >>>shop__= pickle.load(open('shopfile.pkl', 'rb')) >>> shop.chef >>> shop.order('sue')sue__ordersfrom__Patmakes__pizzaoven__bakessue__paysfor__itemto__Thisis__justa__prototypeas__is,but__wemight__extendthe__shopto__keeptrack__of inventory, revenue,and__soon__savingit__toits__fileafter__changeswould__retainits__updated state.See__the standard-librarymanual__andrelated__coveragein__Chapters 9, 28,and__37for__moreon__picklesand__shelves.OOP__and Delegation: Like-aRelationships__Besidesinheritance__and composition, object-orientedprogrammers__oftenspeak__of delegation,which__usuallyimplies__controllerobjects__thatembed__otherobjects__towhich__theypass__offoperation__requests.The__controllerscan__takecare__ofadministrative__activities,such__aslogging__orvalidating__accesses,adding__extrasteps__tointerface__components,or__monitoringactive__instances.In__a sense,delegation__isa__specialform__of composition,with__asingle__embeddedobject__managedby__aproxy__(sometimescalled__a wrapper)class__thatretains__mostor__allof__theembedded__objects__interface.The__notionof__proxiessometimes__appliesto__other mechanisms, too,such__asfunction__calls;in__delegation,we__reconcerned__withproxies__forall__ofan__objects__behavior,including__methodcalls__andother__operations.This__conceptwas__introducedby__examplein__Chapter 28,and__inPython__isoften__implementedwith__the__getattr____methodhook__westudied__inChapter__30.Because__this operator-overloadingmethod__interceptsaccesses__tononexistent__attributes,a__wrapperclass__canuse____getattr__to__routearbitrary__accessesto__awrapped__object.Because__thismethod__allowsattribute__requeststo__berouted__generically,the__wrapperclass__retainsthe__interfaceof__thewrapped__objectand__mayadd__additionaloperations__ofits__own.By__wayof__review,consider__thefile__trace.pyin__Example 31-5.Example__31-5. trace.pyclass__Wrapper:def____init__(self, object): self.wrapped =object__#Save__objectdef____getattr__(self, attrname): print('Trace: ' + attrname) #Trace__fetchreturn__getattr(self.wrapped, attrname) #Delegate__fetchRecall__fromChapter__30that____getattr__gets__theattribute__nameas__a string.This__codemakes__useof__thegetattr__built-infunction__tofetch__anattribute__fromthe__wrappedobject__byname__string getattr(X,N)is__like X.N,except__thatN__isan__expressionthat__evaluatesto__astring__at runtime,not__a variable.In__fact, getattr(X,N)is__similarto__X.__dict__[N],but__theformer__alsoperforms__aninheritance__search,like__X.N,while__thelatter__doesnot__(seeChapters__23and__29for__moreon__the__dict____attribute).You__canuse__theapproach__ofthis__modules__wrapperclass__tomanage__accessto__anyobject__withattributes__lists, dictionaries,and__evenclasses__and instances. Here,the__Wrapperclass__simplyprints__atrace__messageon__eachattribute__accessand__delegatesthe__attributerequest__tothe__embeddedwrapped__object: >>>from__traceimport__Wrapper >>>x__= Wrapper([1, 2, 3]) #Wrap__alist__>>> x.append(4) #Delegate__tolist__method Trace:append__>>> x.wrapped #Print__mymember__[1, 2, 3, 4] >>>x__= Wrapper({'a': 1, 'b': 2}) #Wrap__adictionary__>>> list(x.keys()) #Delegate__todictionary__method Trace:keys__['a', 'b']The__neteffect__isto__augmentthe__entireinterface__ofthe__wrappedobject__withadditional__codein__theWrapper__class.We__canuse__thisto__logour__method calls,route__methodcalls__toextra__orcustom__logic,adapt__aclass__toa__new interface,and__so on.In__thenext__chapter,we__llrevive__thenotions__ofwrapped__objectsand__delegatedoperations__asone__wayto__extend built-in types.If__youare__interestedin__thedelegation__design pattern,also__watchfor__thediscussions__inChapters__32and__39of__function decorators,a__stronglyrelated__conceptdesigned__toaugment__aspecific__functionor__methodcall__ratherthan__theentire__interfaceof__an object,as__wellas__class decorators,which__serveas__away__toautomatically__addsuch__delegation-based__wrappersto__allinstances__ofa__class.NOTE__Delegation reminder:As__notedin__thesidebar__Delegating Built-insor__Not ,general__proxieslike__theWrapper__examplehere__cannotdirectly__interceptand__delegatecalls__to operator-overloading__methodsrun__by built-in operations.The__lists____add__,for__instance,is__notcaught__and fails: >>> [1, 2, 3] + [4, 5] [1, 2, 3, 4, 5] >>> [1, 2, 3].__add__([4, 5]) [1, 2, 3, 4, 5] >>> Wrapper([1, 2, 3]) + [4, 5] TypeError:unsupported__operand type(s)for__+: 'Wrapper'and__'list' Explicit-nameattribute__fetchesare__routedto____getattr__,but__built-inoperations__differin__waysthat__impactsome__delegation-based tools.We__llreturn__tothis__issueand__seeit__livein__Chapters 38and__39,in__thecontext__ofmanaged__attributesand__decorators.For__now,keep__inmind__thatdelegation__proxiesmay__needto__redefine operator-overloadingmethods__by code, tools,or__superclassesif__thosemethods__areused__byembedded__objectsand__shouldbe__routedto__them.Pseudoprivate__ClassAttributes__Besideslarger__structuring goals,class__designsoften__mustaddress__nameusage__too.In__Chapter 28s__case study,for__example,we__notedthat__methodsdefined__withina__generaltool__classmight__bemodified__bysubclasses__if exposed,and__notedthe__trade-offsof__thispolicy__whileit__supportsmethod__customizationand__direct calls,it__salso__opento__accidental replacements.In__Part V,we__learnedthat__everyname__assignedat__thetop__levelof__amodule__fileis__exported.By__default,the__sameholds__forclasses__datahiding__isa__convention,and__clientsmay__fetchor__changeattributes__inany__classor__instanceto__whichthey__havea__reference.All__attributesare__allpublic__and virtual,in__C++ terms:they__reaccessible__everywhereand__arelooked__updynamically__at runtime.In__fact,it__seven__possibleto__changeor__deletea__classs__methodat__runtime,though__thisis__rarelydone__inpractical__programs.As__ascripting__language,Python__isabout__enabling,not__restricting.All__thatbeing__said,Python__todaydoes__supportthe__notionof__namemangling__(i.e., expansion)to__associatesome__nameswith__their classes.Mangled__namesare__sometimesmisleadingly__calledprivate__attributes,but__reallythis__isjust__away__tolocalize__aname__tothe__classthat__createdit__namemangling__doesnot__preventaccess__bycode__outsidethe__class.This__featureis__mostlyintended__toavoid__namespacecollisions__in instances,not__torestrict__accessto__namesin__general;mangled__namesare__thereforebetter__calledpseudoprivate__than private.Pseudoprivate__namesare__anadvanced__andentirely__optional feature,and__youprobably__wont__findthem__veryuseful__untilyou__startwriting__generaltools__orlarger__classhierarchies__foruse__inmultiprogrammer__projects.In__fact,they__arenot__alwaysused__evenwhen__theyprobably__shouldbe__more commonly,Python__programmerscode__internalnames__witha__singleunderscore__(e.g., _X),which__isjust__aninformal__conventionto__letyou__knowthat__aname__shouldnt__generallybe__changed,but__thismeans__nothingto__Python itself.Because__youmay__seethis__featurein__otherpeople__s code, though,you__needto__besomewhat__awareof__it,even__ifyou__dont__useit__yourself.And__onceyou__learnits__advantagesand__contextsof__use,you__mayfind__thisfeature__tobe__moreuseful__inyour__owncode__thansome__programmers realize.Name__ManglingOverview__Heres__howname__mangling works:within__aclass__statement only,any__namesthat__startwith__twounderscores__butdo__notend__withtwo__underscoresare__automaticallyexpanded__toinclude__thename__ofthe__enclosingclass__attheir__front.For__instance,a__namelike____Xwithin__aclass__namedHack__ischanged__to_Hack__X__automatically:the__originalname__isprefixed__witha__singleunderscore__andthe__enclosingclass__s name.Because__themodified__namecontains__thename__ofthe__enclosing class,it__sgenerally__unique;it__wont__clashwith__similarnames__createdby__otherclasses__ina__hierarchy.Name__manglinghappens__onlyfor__namesthat__appearinside__aclass__statements__codeand__thenonly__fornames__thatbegin__withtwo__leading underscores.It__worksfor__everyname__precededwith__double underscores,though__bothclass__attributes (includingmethod__names)and__instanceattribute__namesassigned__to self.For__example,in__aclass__named Hack,a__methodnamed____methis__mangledto___Hack__meth,and__aninstance__attributereference__self.__Xis__transformedto__self._Hack__X.Despite__the mangling,as__longas__theclass__usesthe__double-underscoreversion__everywhereit__refersto__the name,all__itsreferences__willstill__work.Because__morethan__oneclass__mayadd__attributesto__an instance, though,this__manglinghelps__avoidclashes__butwe__needto__moveon__toan__exampleto__see how.Why__UsePseudoprivate__Attributes?One__ofthe__mainissues__thatthe__pseudoprivateattribute__featureis__meantto__alleviatehas__todo__withthe__wayinstance__attributesare__stored.In__Python,instance__attributesnormally__windup__inthe__singleinstance__objectat__thebottom__ofthe__classtree__andare__sharedby__class-levelmethod__functionsthe__instanceis__passed into.This__isdifferent__fromthe__C++ model,where__eachclass__getsits__ownspace__fordata__membersit__defines.Within__aclass__smethod__in Python,whenever__amethod__assignsto__aself__attribute (e.g., self.attr = value),it__changesor__createsan__attributein__theinstance__(recallthat__inheritancesearches__happenonly__on reference,not__on assignment).Because__thisis__trueeven__ifmultiple__classesin__ahierarchy__assignto__thesame__attribute,collisions__are possible.For__example,suppose__thatwhen__aprogrammer__codesa__class,it__isassumed__thatthe__classowns__theattribute__nameX__inthe__instance.In__thisclass__s methods,the__nameis__setand__later fetched:class__C1:def__meth1(self): self.X = 88 #I__assumeX__ismine__def meth2(self): print(self.X)Suppose__furtherthat__another programmer,working__in isolation,makes__thesame__assumptionin__another class:class__C2:def__metha(self): self.X = 99 #Me__toodef__methb(self): print(self.X)Both__ofthese__classeswork__by themselves.The__problemarises__ifthe__twoclasses__areever__mixedtogether__inthe__sameclass__tree,using__themultiple__inheritancewe__llexpand__on ahead:class__C3(C1, C2): ...I__= C3() #But__only 1X__in I! Now,the__valuethat__eachclass__getsback__whenit__says self.Xwill__dependon__whichclass__assignedit__last.Because__allassignments__to self.Xrefer__tothe__samesingle__instance,there__isonly__oneX__attribute I.Xno__matterhow__manyclasses__usethat__attribute name.This__isnt__aproblem__ifit__s expected,and__indeed,this__ishow__classesnormally__communicatethe__instanceis__shared memory.To__guaranteethat__anattribute__belongsto__theclass__thatuses__it, though,prefix__thename__withdouble__underscoreseverywhere__itis__usedin__the class,as__inExample__31-6, pseudoprivate.py.Example__31-6. pseudoprivate.pyclass__C1:def__meth1(self): self.__X = 88 #Now__Xis__minedef__meth2(self): print(self.__X) #Becomes___C1__Xin__Iclass__C2:def__metha(self): self.__X = 99 #Me__toodef__methb(self): print(self.__X) #Becomes___C2__Xin__Iclass__C3(C1, C2):pass__I = C3() #Two__Xnames__inI__I.meth1(); I.metha() #Set__names print(I.__dict__) #Actual__storage I.meth2(); I.methb() #Fetch__namesWhen__thus prefixed,the__Xattributes__willbe__expandedto__includethe__namesof__theirclasses__beforebeing__addedto__the instance.If__yourun__adir__callon__Ior__inspectits__namespacedictionary__afterthe__attributeshave__been assigned,you__llsee__theexpanded__names, _C1__Xand___C2__X,but__not X.Because__theexpansion__makesthe__namesmore__uniquewithin__the instance,the__classescoders__canbe__fairlysafe__inassuming__thatthey__trulyown__anynames__thatthey__prefixwith__two underscores: $ python3 pseudoprivate.py {'_C1__X': 88, '_C2__X': 99} 88 99This__trickcan__avoidpotential__namecollisions__inthe__instance,but__notethat__itdoes__notamount__totrue__privacy.If__youknow__thename__ofthe__enclosing class,you__canstill__accesseither__ofthese__attributesanywhere__youhave__areference__tothe__instanceby__usingthe__fullyexpanded__name (e.g., I._C1__X = 77). Moreover,names__couldstill__collideif__unknowingprogrammers__usethe__expandednaming__patternexplicitly__(unlikely,but__not impossible).On__theother__hand,this__featuremakes__itmuch__lesslikely__thatyou__willaccidentally__stepon__aclass__s names.Pseudoprivate__attributesare__alsouseful__inlarger__frameworksor__tools,both__toavoid__introducingnew__methodnames__thatmight__accidentallyhide__definitionselsewhere__inthe__classtree__andto__reducethe__chanceof__internalmethods__beingreplaced__bynames__definedlower__inthe__tree.If__amethod__isintended__foruse__onlywithin__aclass__thatmay__bemixed__intoother__classes,the__doubleunderscore__prefixvirtually__ensuresthat__themethod__wont__interferewith__othernames__inthe__tree,especially__in multiple-inheritance scenarios:class__Super:def__method(self): #A__realapplication__methodclass__Tool:def____method(self): #Becomes___Tool__methoddef__other(self): self.__method() #Use__myinternal__methodclass__Sub1(Tool, Super):def__actions(self): self.method() #Runs__Super.methodas__expectedclass__Sub2(Tool):def____init__(self): self.method = 99 # Doesn'tbreak__Tool.__methoddef__method(self): #Ditto__Wemet__multipleinheritance__brieflyin__Chapter 26and__willexplore__itin__moredetail__laterin__this chapter.Recall__thatsuperclasses__aresearched__accordingto__their left-to-rightorder__inclass__header lines. Here,this__means Sub1prefers__Toolattributes__tothose__in Super.Although__inthis__examplewe__couldforce__Pythonto__pickthe__applicationclass__smethods__firstby__switchingthe__orderof__thesuperclasses__listedin__the Sub1class__header,pseudoprivate__attributesresolve__theissue__altogether.Pseudoprivate__namesalso__preventsubclasses__fromaccidentally__redefiningthe__internalmethod__s names,as__in Sub2. Again,this__featuretends__tobe__ofuse__primarilyfor__largermultiprogrammer__projectsand__thenonly__forselected__names.Don__tbe__temptedto__clutteryour__code unnecessarily;only__usethis__featurefor__namesthat__trulyneed__tobe__controlledby__asingle__class.Although__usefulin__somegeneral__class-based tools,for__simpler programs,it__sprobably__overkill.For__moreexamples__thatmake__useof__the__X__naming feature,see__the lister.py mix-inclasses__introducedlater__inthis__chapters__multipleinheritance__section,as__wellas__thelater__classdecorators__mentionedin__thefollowing__note.NOTE__Private matters:If__youre__interestedin__morebinding__formsof__privacy,you__maywant__toreview__theemulation__ofprivate__instanceattributes__codedin__Attribute Access:__getattr____and__setattr____inChapter__30and__watchfor__thebroader__Privateclass__decoratorwe__llbuild__withdelegation__inChapter__39.Although__its__possibleto__add name-accesscontrols__inPython__classes,this__israrely__donein__practiceeven__forlarge__systemsthat__solve real-world problems.Go__figure?Method__Objects:Bound__orNot__Methodsin__general,and__boundmethods__in particular,simplify__theimplementation__ofmany__designgoals__in Python.We__metbound__methodsbriefly__whilestudying____call__in__Chapter 30.The__full story,which__well__fleshout__here,turns__outto__bemore__generaland__flexiblethan__youmight__expect.In__Chapter 19,we__learnedhow__functionscan__beprocessed__asnormal__objects.Methods__area__kindof__object too,and__canbe__usedgenerically__inmuch__thesame__wayas__otherobjects__theycan__beassigned__to names,passed__to functions,stored__indata__structures,and__soon__andlike__simple functions, modules,and__classes,qualify__as first-class objects.Because__aclass__smethods__canbe__accessedfrom__aninstance__ora__class, though,they__comein__two flavors:Bound__methods:when__amethod__isreferenced__throughan__instanceAccessing__afunction__attributeof__aclass__byqualifying__aninstance__returnsa__boundmethod__object.This__objectautomatically__packagesthe__instancewith__thefunction__asa__pair.When__abound__methodis__later called,the__instanceis__automaticallypassed__tothe__functions__self argument.Plain__functions:when__amethod__isreferenced__througha__classAccessing__afunction__attributeof__aclass__byqualifying__aclass__returnsa__plainfunction__object.To__callthis__function later,you__mustprovide__aninstance__objectexplicitly__tothe__selfargument__ifthe__functionexpects__one.Both__kindsof__methodsare__full-fledged objects;they__canbe__transferredaround__aprogram__at will,just__likestrings__and numbers.Bound__methodssimply__rememberan__instance,but__plainfunctions__do not.This__iswhy__weve__hadto__passin__aninstance__explicitlywhen__callingsuperclass__methodsfrom__subclassmethods__inprevious__examples (includingthis__chapters__employees.pyin__Example 31-1); technically,such__callsproduce__plainfunctions__alongthe__way.When__callinga__boundmethod__object, though,Python__providesthe__instanceargument__forus__theinstance__thatwas__usedto__createthe__boundmethod__object.This__meansthat__boundmethod__objectsare__usuallyinterchangeable__withsimple__functionobjects__andmakes__themespecially__usefulfor__interfacesoriginally__writtenfor__functions.NOTE__Blastfrom__the past:Python__oncerequired__allmethods__ina__classto__havean__instanceargument__andtermed__methodsfetched__directlyfrom__aclass__unboundmethods__implyingthat__theyrequired__aninstance__argumentwhen__later called. Today,method__functionsin__aclass__arereally__justplain__functions;their__onlyspecial__qualityis__thatthey__arebound__toan__instancewhen__fetchedthrough__the instance.Unbound__methods, however,are__dead;long__liveplain__functions!Bound__Methodsin__ActionTo__illustratein__simple terms,suppose__wedefine__thefollowing__classin__theREPL__ofour__choosing: >>>class__Hack:def__doit(self, message): print(message) Now,in__normal operation,we__makean__instanceand__callits__methodin__asingle__stepto__printthe__passed-in argument: >>>inst__= Hack() >>> inst.doit('hello') #Typical__methodcalls__hello Really, though,a__boundmethod__objectis__generatedalong__theway__justbefore__themethod__calls__parentheses.In__fact,we__canfetch__abound__methodwithout__actuallycalling__it.An__object.nameexpression__evaluatesto__anobject__asall__expressions do.In__the following,it__returnsa__boundmethod__objectthat__packagesthe__instance (inst)with__themethod__function (Hack.doit).The__neteffect__isthat__wecan__assignthis__boundmethod__pairto__anothername__andthen__callit__asthough__itwere__asimple__self-less function: >>>inst__= Hack() >>>meth__= inst.doit #Bound__method object: instance+function >>> meth('hola') #Same__effectas__inst.doit('...')hola__In fact,if__youknow__whereto__look,you__cansee__the instance/functionpair__thatthe__boundmethod__packages: >>>meth__> >>> meth.__self__ <__main__.Hackobject__at 0x108f2e8a0> >>> meth.__func__On__theother__hand,if__wequalify__theclass__toget__to doit,we__getback__aplain__functionobject__withno__associated instance.To__callthis__typeof__method,we__usuallymust__passin__aninstance__asthe__leftmostargument__thereisn__tone__inthe__expression otherwise,and__themethod__inthis__demoexpects__it: >>>inst__= Hack() >>>meth__= Hack.doit #Plain__function:requires__self >>> meth(inst, 'ciao') #Pass__ininstance__(ifthe__methodexpects__one)ciao__This time, though,the__methodis__substantiallymore__mundanebecause__its__aplain__function: >>>meth__By extension,the__samerules__applywithin__aclass__smethod__ifwe__referenceself__attributesthat__namefunctions__ina__class.A__self.methodexpression__isa__boundmethod__objectbecause__selfis__aninstance__object,though__a class.methodis__asimple__functionthat__mayrequire__aself__when run: >>>class__Hack2(Hack):def__doit2(self):meth__= self.doit #Bound__method object: instance+function meth('bonjour') #Looks__likea__simplefunction__meth = Hack.doit meth(self, 'privit') #Plain__function:requires__self >>> Hack2().doit2()bonjour__privitMost__ofthe__time,you__callmethods__immediatelyafter__fetchingthem__withattribute__qualification,so__youdon__tnotice__themethod__objectsgenerated__alongthe__way.But__ifyou__startwriting__codethat__callsobjects__generically,you__needto__becareful__totreat__nonboundmethods__speciallythey__normallyrequire__anexplicit__instanceobject__tobe__passed in.Implied__bythis__model,classes__canalso__codemethods__thatdo__notrequire__aself__instance,and__arecalled__normallywhen__fetchedfrom__their class;apart__from inheritance,this__issimilar__toa__functionin__amodule__file: >>>class__Hack3:def__doit3(message): #A__self-lessmethod__(function) print(message) >>> Hack3.doit3('guten tag') #No__"self"is__passedguten__tagThis__falls down, though,if__wetry__tocall__sucha__self-lessmethod__functionthrough__an instance:because__thebound__methodmade__alongthe__waypackages__andpasses__an instance,the__callsends__onetoo__many arguments: >>>x__= Hack3() >>> x.doit3('namaste') TypeError: Hack3.doit3()takes__1positional__argumentbut__2were__givenIn__other words,you__cancode__self-lessfunctions__ina__class,and__cancall__themnormally__througha__classwithout__an instance.To__callthem__thoughan__instance, too, though,you__llhave__tostay__tunedfor__thenext__chapters__coverageof__staticand__classmethods__methodsmarked__speciallyto__suppressan__automaticinstance__argumentin__all contexts.Also__inthe__next chapter,you__llsee__thatthe__super built-in__bindsan__instancewith__a method, too,but__issubstantially__moreconvoluted__thanthe__boundmethod__pairswe__vemet__here. Finally,to__demohow__flexiblebound__methodscan__be,the__followingstores__fourof__themin__alist__andcalls__them generically,with__normalcall__expressions: >>>class__Number:def____init__(self, base): self.base =base__def double(self):return__self.base * 2def__triple(self):return__self.base * 3 >>> x, y,z__= Number(2), Number(3), Number(4) #Class__instanceobjects__>>> x.double() #Normal__immediatecalls__4 >>>acts__= [x.double, y.double, z.double, z.triple] #List__ofbound__methods >>>for__actin__acts: #Calls__aredeferred__print(act(), end=' ') #Call__asthough__functions 4 6 8 12In__the end,calls__toact__hererun__methodsin__theclass__toprocess__instancesboth__savedpreviously__inbound__methods.WHY__YOUWILL__CARE:BOUND__METHODCALLBACKS__Becausebound__methodsautomatically__pairan__instancewith__aclass__smethod__function,you__canuse__themanywhere__asimple__functionis__expected.One__ofthe__mostcommon__placesyou__llsee__thisidea__putto__workis__incode__thatregisters__methodsto__handleevent__callbacksrun__byGUI__interfaces,like__Pythons__tkinter standard-library module.As__review,here__sthe__simple case:def__handler():use__globalsor__closurescopes__forstate__widget = Button(text='Tap', command=handler)With__tkinter,to__registera__handlerfor__buttonclick__events,we__usuallypass__acallable__objectthat__takesno__argumentsto__thecommand__keyword argument.Function__names (and lambdas)work__here,and__sodo__class-levelmethods__thoughthey__mustbe__boundmethods__ifthey__expectan__instancewhen__called:class__MyGui:def__handler(self):use__self.attrfor__statedef__makewidgets(self):b__= Button(text='Tap', command=self.handler) Here,the__eventhandler__is self.handlera__boundmethod__objectthat__remembersboth__selfand__MyGui.handler.Because__selfwill__referto__theoriginal__instancewhen__handleris__laterinvoked__on events,the__methodwill__haveaccess__toinstance__attributesthat__canretain__statebetween__events,as__wellas__class-level methods.With__simple functions,state__normallymust__beretained__inglobal__variablesor__enclosingfunction__scopes (a.k.a. closures) instead.See__alsothe__discussionof____call__operator__overloadingin__Chapter 30for__anotherway__tomake__classescompatible__with function-based APIs,as__wellas__lambdain__Chapter 19for__anothertool__oftenused__incallback__roles.As__notedin__theformer__of these,you__dont__needto__wrapa__boundmethod__ina__lambdaunless__extraarguments__mustbe__addedto__the call;because__thebound__methodin__thepreceding__examplealready__defersthe__call (thereare__noparentheses__totrigger__one!),adding__alambda__herewould__otherwisebe__pointless.Classes__Are Objects:Generic__ObjectFactories__Sometimes, class-baseddesigns__requireobjects__tobe__createdin__responseto__conditionsthat__cant__bepredicted__whena__programis__written.The__factorydesign__patternallows__sucha__deferred approach.Due__inlarge__partto__Pythons__flexibility,factories__cantake__multiple forms,some__ofwhich__dont__seemspecial__at all.Because__classesare__also first-classobjects__(inthe__Chapter 19 sense),it__seasy__topass__themaround__a program,store__themin__data structures,and__so on.You__canalso__passclasses__tofunctions__thatgenerate__arbitrarykinds__of objects;such__functionsare__sometimescalled__factoriesin__OOPdesign__circles.Factories__canbe__amajor__undertakingin__astatically__typedlanguage__suchas__C++but__arealmost__trivialto__implementin__Python.For__example,the__callsyntax__westudied__inChapter__18can__callany__classwith__anynumber__ofpositional__orkeyword__constructorarguments__inone__stepto__generateany__sortof__instance.Example__31-7demos__theunderlying__code.Example__31-7. factory.pydef__factory(aClass, *pargs, **kargs): #Varargs__tuple,dict__return aClass(*pargs, **kargs) #Call__aClassclass__Hack:def__doit(self, message): print(message)class__Person:def____init__(self, name, job=None): self.name =name__self.job =job__object1 = factory(Hack) #Make__aHack__object object2 = factory(Person, 'Sue', 'dev') #Make__aPerson__object object3 = factory(Person, name='Bob') # Ditto,with__keywordsand__defaultThis__codes__factoryis__passeda__class object,along__withzero__ormore__argumentsfor__theclass__s constructor.When__called,it__usesstar__syntaxto__collectand__unpackarguments__andcalls__theclass__toreturn__an instance. Really,factory__caninvoke__anycallable__object,including__functions, classes,and__methods,but__were__usingit__forclasses__here.The__restof__theexample__simplydefines__twoclasses__andgenerates__instancesof__bothby__passingthem__tothe__factory function.And__thats__theonly__factoryfunction__youmay__everneed__towrite__in Python;it__worksfor__anyclass__andany__constructor arguments.If__yourun__thisexample__live,your__objectswill__looklike__this: >>>from__factoryimport__* >>> object1.doit(99) 99 >>> object2.name, object2.job ('Sue', 'dev') >>> object3.name, object3.job ('Bob', None)By__now,you__shouldknow__thateverything__isa__first-classobject__inPython__including classes,which__areusually__justcompiler__inputin__languageslike__C++.It__snatural__topass__themaround__this way.As__mentionedat__thestart__ofthis__partof__the book, though,only__objectsderived__fromclasses__dofull__OOPin__Python.Why__Factories? So,what__goodis__thefactory__function (besidesproviding__anexcuse__toillustrate__first-classclass__objectsin__this book)? Unfortunately,it__sdifficult__toshow__applicationsof__thisdesign__patternwithout__listingmuch__morecode__thanwe__havespace__for here.In__general, though,such__afactory__mightallow__codeto__beinsulated__fromthe__detailsof__dynamicallyconfigured__object construction.For__instance,recall__theProcessor__classpresented__asa__compositiondemo__earlierin__Example 31-3.It__acceptsreader__andwriter__objectsfor__processingarbitrary__data streams.The__originalabstract__versionof__thisexample__inChapter__26manually__passedin__instancesof__specializedclasses__likeFileWriter__andSocketReader__tocustomize__thedata__streamsbeing__processed; later,we__passedin__hardcoded file, stream,and__formatter objects.In__amore__dynamic scenario,external__devicessuch__asconfiguration__filesor__GUIsmight__beused__toconfigure__the streams.In__sucha__dynamic world,we__mightnot__beable__tohardcode__thecreation__ofstream__interfaceobjects__inour__scriptsbut__mightinstead__createthem__atruntime__accordingto__thecontents__ofa__configuration file.Such__afile__mightsimply__givethe__stringname__ofa__streamclass__tobe__importedfrom__a module,plus__anoptional__constructorcall__argument. Factory-stylefunctions__orcode__mightcome__inhandy__herebecause__theywould__allowus__tofetch__andpass__inclasses__thatare__nothardcoded__inour__programahead__of time. Indeed,those__classesmight__noteven__haveexisted__atall__whenwe__wroteour__code. Hypothetically:classname__=parse__fromconfig__fileclassarg__=parse__fromconfig__fileimport__streamtypes #Customizable__codeaclass__= getattr(streamtypes, classname) #Fetch__frommodule__reader = factory(aclass, classarg) #Or__aclass(classarg) processor(reader, ) Here,the__getattr built-inis__againused__tofetch__amodule__attributegiven__astring__name (its__likesaying__obj.attr,but__attris__a string).This__codesnippet__doesnt__strictlyneed__factoryit__couldmake__aninstance__withjust__aclass(classarg).A__separate function, though,may__provemore__usefulwhen__extrawork__isrequired__atinstance__creation time,such__ascaching__objectsfor__reuse.However__theyare__coded,factories__arealmost__trivialwith__Pythons__dynamictyping__anduniversal__first-classobject__model.Multiple__Inheritanceand__theMRO__Ourlast__designpattern__isone__ofthe__mostuseful__andwill__serveas__asubject__formore__realisticexamples__towrap__upthis__chapter.As__a bonus,the__codewe__llwrite__heremay__beuseful__tools.Most__ofour__examplesso__farhave__usedsingle__inheritanceclass__treesin__whicheach__classhas__justone__superclass.This__sufficesfor__simplehierarchies__andenables__customization.In__ourpizza__shopdemo__ofExample__31-1,for__example,each__workerbelonged__tojust__onecategory__andinherited__namesfrom__onlyone__branchof__theclass__tree. Abstractly:class__B:class__A(B):I__= A() #Use__attributesfrom__I, A,and__B -in__thatorder__Many class-based designs, however,call__forcombining__disparatesets__of methods.As__weve__seen,in__aclass__statement,more__thanone__superclasscan__belisted__inparentheses__inthe__header line.When__youdo__this,you__leveragemultiple__inheritancethe__classand__itsinstances__inheritnames__fromall__thelisted__superclasses:class__C:class__B:class__A(B, C):I__= A() #Use__attributesfrom__I, A, B,and__Cin__thatorder__In general,multiple__inheritanceis__goodfor__modelingobjects__thatbelong__tomore__thanone__set.For__instance,a__personmay__bean__engineer,a__writer,a__musician,and__soon__andinherit__propertiesfrom__allsuch__sets.With__multiple inheritance,objects__obtainthe__unionof__thebehavior__inall__their superclasses.As__youll__see ahead,multiple__inheritancealso__allowsclasses__tofunction__asgeneral__packagesof__mixableattributes__knownas__mix-in classes.Although__its__auseful__tool,multiple__inheritanceadds__anotherdimension__toattribute__inheritance:Single__inheritancesearches__onlydepth__firstfrom__instance,to__class,and__toeach__superclassfrom__lowestto__highest.This__orderis__determinedby__theclass__fromwhich__aninstance__ismade__andthe__superclasslisted__inparentheses__ineach__classstatement__sheader__(whichis__mirroredby__classobjects____bases__ attributes).Multiple__inheritancealso__searchesleft__toright__accordingto__theorder__ofclasses__listedin__parenthesesin__class headers.This__isa__nested component,pursued__onlyafter__branchesfurther__tothe__lefthave__reachedthe__topof__thetree__andhave__beenexhausted__oftheir__own right-branch candidates.We__callthe__combinationof__thesetwo__DFLR,for__depth first,and__thenleft__to right.This__searchsuffices__whenan__attributename__showsup__injust__onebranch__ofa__class tree,which__isa__typical case.When__thesame__nameappears__inmultiple__branches, though,DFLR__aloneis__subpar:a__lower (andhence__more specialized)subclass__tothe__rightisn__table__toredefine__aname__inone__ofits__higher (andhence__more general)superclasses__reachedthrough__abranch__tothe__left.Because__of this,multiple__inheritancerequires__aslightly__differentsearch__orderknown__as MRO,for__methodresolution__order (thoughit__sused__forall__attributes,not__just methods).In__brief,MRO__orderworks__thesame__asDFLR__intypical__treesbut__proceedsacross__bytree__levelsbefore__movingup__ina__more breadth-firstfashion__whenmultiple__classesin__atree__sharea__common superclass,forming__whats__calleda__diamondpattern__afterthe__trees__square-on-its-corner shape.This__MROsearch__orderis__runfor__allclass__treesbut__differsfrom__DFLRwhen__multiple-inheritancediamonds__are present.It__sdesigned__tovisit__acommon__superclassjust__once,and__afterall__its subclasses.While__user-definedclasses__dont__oftenform__diamondsin__Python,the__built-inobject__classautomatically__addedabove__allroot__(topmost)classes__makesevery__multiple-inheritancetree__a diamond;without__MRO,object__sdefaults__mayhide__user-defined versions.To__illustratewhat__diamondsare__allabout__andhow__MROsearch__runsacross__beforeup__inthis__onesomewhat__atypical case,let__sturn__tosome__code.How__MultipleInheritance__WorksWe__llget__moreformal__aboutMROs__inthe__next section,but__its__easyto__demo live.Let__sstart__withthe__simpleand__typical case.In__the following,class__Ainherits__fromboth__Band__Cusing__multiple inheritance,and__Band__Care__root (topmost)classes__thatdefine__unique attributes.When__wemake__aninstance__Iof__Aand__askfor__its attributes,inheritance__searches I, A, B,and__Cand__inthat__order. Hence, attr1is__locatedin__B,and__attr2in__C (ifyou__reworking__alongin__a REPL,type__ablank__lineafter__each class,omitted__herefor__brevity): >>>class__C: attr2 = 'C2' >>>class__B: attr1 = 'B1' >>>class__A(B, C):pass__>>>I__= A() >>> I.attr1, I.attr2 ('B1', 'C2')As__youmight__already expect,B__winsif__ithas__thesame__nameas__Cdue__tothe__left- to-rightcomponent__ofthe__search,and__lowerclasses__likeA__stillbeat__theirsupers__as before: >>>class__C: attr2 = 'C2' >>>class__B: attr2 = 'B2'; attr1 = 'B1' >>>class__A(B, C): attr1 = 'A1' >>>I__= A() >>> I.attr1, I.attr2 ('A1', 'B2') Next,let__sadd__ahigher__superclassabove__B:in__the following,A__inheritsfrom__bothB__andC__as before,but__Balso__inheritsfrom__D,and__Cis__aroot__classwith__no supers.Per__theDFLR__order (depthfirst__andthen__leftto__right), attr2is__foundin__Dby__virtueof__searching I, A, B,and__Dand__beforeC__iseven__checked: >>>class__D: attr2 = 'D2' >>>class__C: attr2 = 'C2' >>>class__B(D): attr1 = 'B1' >>>class__A(B, C):pass__>>>I__= A() >>> I.attr1, I.attr2 ('B1', 'D2')Watch__what happens, though,if__Band__Cboth__inheritfrom__D,and__Chas__thesame__attributeas__Dper__the MRO,the__lowerC__classs__attributewins__andeffectively__replacesthat__attributein__D: >>>class__D: attr2 = 'D2' >>>class__C(D): attr2 = 'C2' >>>class__B(D): attr1 = 'B1' >>>class__A(B, C):pass__>>>I__= A() >>> I.attr1, I.attr2 ('B1', 'C2')This__lastcase__iswhat__ismeant__bya__diamondpattern__of inheritance:multiple__classes,B__and C,both__inheritfrom__thesame__superclass.When__this happens,the__lowerclass__sversion__ofan__attributeis__usedinstead__ofa__same-namedversion__ina__superclasseven__ifthat__superclasscould__bereached__firstby__depth alone. Importantly,this__differsonly__in diamonds:nondiamonds__stillchoose__highersuperclasses__overlower__classeswith__thesame__attributename__asin__thethird__examplein__this section.The__MROallows__aclass__tooverride__attributesin__ahigher__classfrom__whichit__inherits;in__thelast__example,C__canreplace__namesin__Deven__ifD__isfirst__per DFLR.To__summarize:in__nondiamonds,the__searchproceeds__allthe__wayto__the top,then__backsup__andstarts__searchingto__theright__(DFLR);in__diamonds,the__searchchecks__classesto__theright__beforeclimbing__upto__acommon__superclass (MRO).Strictly__speaking,all__fourexamples__inthis__sectionare__implicitdiamonds__becauseroot__classesinherit__fromthe__built-inobject__class automatically.We__veseen__thatthis__classprovides__defaultsfor__some methods,such__asprint__displays.Because__ofthe__MRO,the__object built-ins__defaultsnever__hidemethods__in user-definedclasses__belowit__ina__class tree.To__seehow__objectis__ruledout__this way,let__sget__abit__moreprecise__onthe__MROs__order.How__theMRO__WorksFormally__speaking,the__MROinheritance__searchorder__worksas__ifall__classesare__listedper__the DFLR,and__thenall__butthe__rightmostduplicate__ofeach__classis__removed.In__more detail,it__scomputed__as follows: 1.List__allthe__classesfrom__whichan__instanceinherits__usingthe__DFLRlookup__order,and__includea__classmultiple__timesif__its__visitedmore__than once. 2.Scan__theresulting__listfor__duplicate classes,removing__allbut__thelast__(rightmost)occurrence__ofduplicates__inthe__list.The__resultingMRO__sequencefor__agiven__classincludes__the class,its__superclasses,and__allhigher__superclassesup__toand__includingthe__implicitor__explicitobject__rootclass__abovethe__topsof__the tree.It__sordered__suchthat__eachclass__appearsbefore__its parents,and__multipleparents__retainthe__orderin__whichthey__appearin__theclass__header.Because__commonparents__indiamonds__appearonly__atthe__positionof__theirlast__visitationin__the MRO,lower__classesare__searchedfirst__whenthe__MROlist__isused__laterby__attributeinheritance__(makingit__more breadth-firstthan__depth-firstin__diamonds only),and__eachclass__isincluded__andthus__visitedjust__once,no__matterhow__manyclasses__leadto__it.Consider__thenondiamond__classtree__ofExample__31-8,whose__shapeis__sketchedas__ASCIIart__inits__comments.Example__31-8. mro_nondiamond.pyclass__E:attr__= 'E' #D__Eclass__D:attr__= 'D' # | |class__C(E):attr__= 'C' #B__Cclass__B(D):pass__# \ /class__A(B, C):pass__#A__# |X__= A() #X__print(X.attr) #D__Tocompute__theMRO__inheritancesearch__orderthrough__this tree,Python__firstenumerates__allclasses__accessibleper__DFLRand__thenremoves__duplicates (rememberthat__the built-inobject__isimplicitly__aboveall__root classes):DFLR__=> [X, A, B, D, object, C, E, object]MRO__=> [X, A, B, D, C, E, object]In__this tree,the__netresult__forboth__DFLRand__MROordering__isthe__same:the__outputis__Dby__takingattr__fromclass__Dat__thetop__left. Technically,the__MROdiffers__becausethe__built-inobject__appearsjust__onceat__theend__afterits__duplicatesare__removed;this__isirrelevant__toour__classesbecause__theydon__tredefine__anobject__default (likeprint__strings).When__a user-defineddiamond__iscoded__inExample__31-9, however,the__MROs__differenceis__more striking.Example__31-9. mro_diamond.pyclass__D:attr__= 'D' #D__class C(D):attr__= 'C' # / \class__B(D):pass__#B__Cclass__A(B, C):pass__# \ / #A__X = A() # | print(X.attr) #C__#X__Forthis__tree,the__common user-definedclass__Dis__reachedtwice__by DFLR.Because__theMRO__keepsonly__thelast__(rightmost) D,the__lowerC__sdefinition__ofattr__nowwins__overD__s. Hence,the__outputis__nowC__insteadof__D :DFLR__=> [X, A, B, D, object, C, D, object]MRO__=> [X, A, B, C, D, object]In__fact,you__canview__theMRO__ofany__classwith__its built-in__mro____attribute.This__tuplegives__theinheritance__searchorder__followedfor__instancesof__theclass__(afterthe__instance itself).It__sset__tothe__resultof__themro__classmethod__atclass__creationtime__(whichcan__technicallybe__customizedfor__rolestoo__obscureto__cover here).It__salso__alot__tolook__atunless__weselect__classnames__asin__the following,which__inspectsclasses__inthe__nondiamondtree__ofExample__31-8: >>>from__mro_nondiamondimport__*D__>>> [c.__name__for__cin__A.__mro__] ['A', 'B', 'D', 'C', 'E', 'object'] >>> [c.__name__for__cin__C.__mro__] ['C', 'E', 'object']And__heres__thecase__forthe__diamondclass__treein__Example 31-9: >>>from__mro_diamondimport__*C__>>> [c.__name__for__cin__A.__mro__] ['A', 'B', 'C', 'D', 'object'] >>> [c.__name__for__cin__C.__mro__] ['C', 'D', 'object']The__full__mro____isthe__classesused__byinheritance__ata__given class,and____bases__is__justsupers__there: >>> A.__mro__ (, , , , ) >>> X.__class__.__mro__ (, , , , ) >>> A.__bases__ (, ) >>> D.__bases__ (,)Experiment__with__mro____onyour__ownfor__more fidelity.Especially__ifyou__reunsure__howthe__MROhandles__agiven__class tree,this__attributecan__beconsulted__tosee__howinheritance__willtruly__search.Attribute__ConflictResolution__Thougha__useful pattern,multiple__inheritances__chiefdownside__isthat__itcan__posea__conflictwhen__thesame__method (orother__attribute)name__isdefined__inmore__thanone__branchof__theclass__tree.When__this occurs,the__conflictis__resolvedeither__automaticallyby__theinheritance__searchorder__ormanually__inyour__code:Default__By default,inheritance__choosesthe__firstoccurrence__ofan__attributeit__findswhen__anattribute__isreferenced__normally (e.g.,by__self.attr).In__this mode,Python__choosesthe__firstappearance__locatedwhile__scanningthe__MROof__aninstance__s class,from__leftto__right.Explicit__Insome__class models,you__mayneed__toselect__anattribute__explicitlyby__referencingit__throughits__classname__(e.g.,by__superclass.attr).Your__coderesolves__theconflict__thisway__andoverrides__thesearch__sdefault__toselect__anoption__otherthan__theinheritance__searchs__default.By__default,multiple__inheritanceassumes__thatnames__onthe__leftof__aclass__treeshould__overridethe__samenames__onthe__right,and__theMRO__furtherassumes__thatlower__classesshould__override same-namedattributes__incommon__superclassesof__diamonds.Of__course,the__problemwith__assumptionsis__thatthey__assume things.In__Example 31-9,what__ifyou__needsome__same-namedattributes__fromB__butalso__someothers__from C? Luckily,there__isan__inheritanceescape__hatch.If__thedefault__searchorder__doesnt__work,or__ifyou__simplywant__morecontrol__overthe__search process,you__canalways__forcethe__selectionof__anattribute__fromanywhere__inthe__treeby__assigningor__otherwisenaming__theone__youwant__atthe__placewhere__classesare__mixed together.In__Example 31-9,for__instance,any__ofthe__followingselections__are allowed,but__thelatter__twomake__thechoice__explicitrather__thanrelying__onthe__implicitand__subtlemagic__ofMRO__inheritance:class__A(B, C):pass__#Use__thedefault__MROchoice__(C)class__A(B, C):attr__= B.attr #Choose__attrfrom__theleft__branch (D)class__A(B, C):attr__= C.attr #Choose__attrfrom__theright__branch (C) Naturally,attributes__pickedthis__waycan__alsobe__methodswhich__are normal,assignable__attributesthat__happento__referencecallable__function objects. Moreover,the__choicecan__bemade__ina__call:class__A(B, C):def__: self.method( ) #Use__thedefault__MROchoice__class A(B, C):def__: B.method(self, ) #Choose__methodfrom__theleft__branchclass__A(B, C):def__: C.method(self, ) #Choose__methodfrom__theright__branchSuch__callscan__beused__tooverride__the MRO,but__alsoto__kickcalls__upthe__treewhen__theclass__sown__versionmust__be skipped.As__youll__seein__thenext__chapter,such__callsmight__alsouse__super().method(),which__selectsthe__classfollowing__thecall__shost__onself__s MRO;though__simplein__single inheritance,this__canbe__stunninglyimplicit__inmultiple__inheritanceand__doesnt__provideas__muchcontrol__asexplicit__class names.However__theyare__coded,such__manualoverrides__arerequired__onlywhen__thesame__nameappears__inmultiple__superclasses,and__youdo__notwish__touse__thefirst__one inherited.For__example,manual__overridesallow__youto__unambiguouslychoose__amonga__setof__samenames__inboth__leftand__right branches,while__inheritancewould__choosejust__nameson__the left.They__canalso__beused__tomake__choicesexplicit__in general, though,even__in nondiamonds.Because__thisisn__tas__commonan__issuein__typicalPython__codeas__itmay__sound,we__lldefer__detailson__thistopic__untilwe__studythe__super built-inin__thenext__chapterand__revisitthis__asa__gotchaat__theend__ofthat__chapter. First, though,the__nextsection__demonstratesa__practicaluse__casefor__the multiple-inheritancedesign__pattern.NOTE__Theinheritance__finale:Despite__theMRO__s complexity,there__arestill__afew__inheritancehurdles__leftto__clear.Its__completealgorithm__ismore__complexthan__themodel__sketched here,incorporating__specialcases__for metaclasses, descriptors,and__built-ins.In__Chapter 32,we__llexpand__inheritancefor__themetaclass__treeand__applyits__MROin__thesuper__built-in,and__inChapter__38,we__llstudy__itsspecial__casefor__built-in operations,but__wewon__tbe__ableto__formalizeinheritance__infull__untilChapter__40after__weve__studiedall__thesetools__inmore__depth.The__goodnews__isthat__theremaining__hurdlesalmost__nevertrip__upapplication__programs;for__most coders,the__finaleis__afully__optional read. Example: Mix-inAttribute__ListersPerhaps__themost__commonway__multipleinheritance__isused__isto__mixin__general-purposemethods__from superclasses.Such__superclassesare__usuallycalled__mix-inclasses__theyprovide__methodsyou__addto__applicationclasses__by inheritance.In__a sense, mix-inclasses__aresimilar__to modules:they__providepackages__ofmethods__foruse__intheir__client subclasses.Unlike__simplefunctions__in modules, though,methods__in mix-inclasses__alsocan__participatein__inheritancehierarchies__andhave__accessto__theself__instancefor__usingstate__informationand__othermethods__intheir__trees.For__example,we__veseen__thatPython__sdefault__wayto__printa__classinstance__objectisn__tincredibly__useful: >>>class__Hack:def____init__(self, what): #No____repr__or____str__ self.data1 =what__>>>X__= Hack('code') >>> print(X) # Default:class__name +address__(id) <__main__.Hackobject__at 0x10ba464e0>As__youlearned__inboth__Chapter 28s__casestudy__andChapter__30s__operator-overloading__coverage,classes__canprovide__a__str____or__repr____methodto__implementcustom__displays.But__ratherthan__codingone__ofthese__ineach__classyou__wishto__print,why__notcode__itonce__ina__general-purposetool__classand__inheritit__inall__yourother__classes?That__swhat__mix-insare__for.Defining__adisplay__methodin__a mix-insuperclass__onceenables__usto__reuseit__anywherewe__wantto__seea__customdisplay__formateven__inclasses__thatmay__alreadyhave__another superclass.We__vealready__exploredtools__thatdo__related work:Chapter__28s__AttrDisplay class,of__Example 28-13,formatted__instanceattributes__ina__generic__repr____method,but__itdid__notclimb__classtrees__andwas__utilizedin__single-inheritancemode__only.Chapter__29s__classtree.py module,of__Example 29-9,defined__functionsfor__climbingand__sketchingclass__trees,but__itdid__notdisplay__objectattributes__alongthe__wayand__wasnot__architectedas__aninheritable__class. Here,we__regoing__torevisit__theseexamples__techniquesand__expandupon__themto__codea__setof__three mix-inclasses__thatserve__asgeneric__displaytools__forlisting__instance attributes,inherited__attributes,and__attributeson__allobjects__ina__class tree, respectively.We__llalso__useour__toolsin__multiple-inheritancemode__anddeploy__codingtechniques__thatmake__classesbetter__suitedto__useas__generic tools.Unlike__Chapter 28,we__llcode__thiswith__a__str____insteadof__a __repr__.This__ispartially__astyle__issueand__limitstheir__roleto__printand__str,but__thedisplays__well__bedeveloping__aremeant__tobe__user-friendly,not__imitativeof__code.This__policyalso__leavesclient__classesthe__optionof__codingan__alternative lower-leveldisplay__forinteractive__echoesand__nestedappearances__witha____repr__and__has built-inimmunity__from__repr____loopingperils__covered ahead.Listing__instanceattributes__with__dict____Lets__getstarted__withthe__simplecase__listingattributes__attachedto__an instance.Example__31-10,coded__inthe__file listinstance.py,defines__a mix-incalled__ListInstancethat__overloadsthe____str__method__forall__classesthat__includeit__intheir__header lines.Because__thisis__codedas__a class,ListInstance__isa__generictool__whoseformatting__logiccan__beused__forinstances__ofany__subclass client.Example__31-10. listinstance.pyclass__ListInstance: """ Mix-inclass__thatprovides__aformatted__print()or__str()of__instancesvia__inheritanceof____str__coded__here.Displays__instanceattrs__only;self__isinstance__oflowest__class;__X__namingavoids__clashingwith__client's attrs.Works__forclasses__with slots:a____dict__is__ensuredby__lackof__slots here. """def____attrnames(self):result__= '\n'for__attrin__sorted(self.__dict__): #Slots__okayresult__+= f'\t{attr}={self.__dict__[attr]!r}\n' #Repr__forquotes__returnresult__def __str__(self):return__(f'') # name=valuelist__if__name____== '__main__':import__testmixin testmixin.tester(ListInstance) #Test__classin__thismodule__The__attrnames__methodhere__exhibitsa__classiccomprehension__pattern,and__youmight__savesome__programreal__estateby__implementingit__moreconcisely__witha__generatorexpression__triggeredby__a ''.join() call;we__llleave__thisas__asuggested__exercise.As__coded,ListInstance__usessome__previouslyexplored__techniquesto__extractthe__instances__classname__and attributes:It__usesa__self.__class__.__name__expression__tofetch__thename__ofan__instances__class.Recall__thateach__instancehas__a built-in__class____attributethat__referencesthe__classfrom__whichit__was created,and__eachclass__hasa____name__attribute__thatreferences__theclass__sname__givenin__itsheader__line.It__doesmost__ofits__workby__simplyscanning__theinstance__sattribute__dictionary (remember,it__savailable__in __dict__)to__buildup__astring__showingthe__namesand__valuesof__allinstance__attributes.The__dictionarys__keysare__sortedby__nameto__be human-friendly,instead__ofrelying__onthe__dictionarys__insertion order.In__these respects,ListInstance__issimilar__toChapter__28s__attribute display;in__fact,it__slargely__justa__variationon__a theme.Our__class here, though,uses__twoadditional__techniques:It__displaysthe__instances__memoryaddress__bycalling__theid__built-in function,which__returnsany__objects__address.By__definition,this__isa__uniqueobject__identifier,which__willbe__usefulin__latermutations__ofthis__code.It__usesthe__pseudoprivatenaming__patternfor__itsworker__method: __attrnames.As__wesaw__earlierin__this chapter,Python__automaticallylocalizes__anysuch__nameto__itsenclosing__classby__expandingthe__attributename__toinclude__theclass__name;in__this case,it__becomes _ListInstance__attrnames.This__holdstrue__forboth__classattributes__likemethods__andinstance__attributesattached__to self.As__firstnoted__inChapter__28,this__helpsin__ageneral__toollike__this,as__itensures__thatits__nameswon__tclash__withany__namesused__inits__client subclasses.Because__ListInstancedefines__a__str____operator-overloading method,instances__derivedfrom__thisclass__displaytheir__attributesautomatically__when printed,giving__abit__moreinformation__thana__simple address.Here__isthis__toolclass__inaction__in single-inheritance mode,mixed__into__theprevious__sections__class: >>>from__listinstanceimport__ListInstance >>>class__Hack(ListInstance): #Inherit__a__str____methoddef____init__(self, what): self.data1 =what__>>>X__= Hack('code') >>> print(X) # print()and__str()run____str__You__canalso__getthe__listingdisplay__asa__stringwith__strwithout__printingit__(useprint__laterto__apply escapes),and__interactiveechoes__andnesting__stilluse__thedefault__format (weve__left__repr____asan__optionfor__clients): >>> str(X) "" >>>X__<__main__.Hackobject__at 0x10c890b90>The__ListInstanceclass__isuseful__forany__classesyou__writeeven__classesthat__alreadyhave__oneor__more superclasses.This__iswhere__multipleinheritance__comesin__handy:by__addingListInstance__tothe__listof__superclassesin__aclass__header (i.e.,mixing__it in),you__getits____str__for__freewhile__stillinheriting__fromthe__existing superclass(es).The__file testmixin.pyin__Example 31-11codes__testclasses__thatprove__the point.Example__31-11. testmixin.py """Generic__lister-mixin tester:similar__totransitive__reloaderin__Chapter 25,but__passesa__classobject__totester__(not function),and__testByNamesadds__loadingof__bothmodule__andclass__byname__strings here,in__keepingwith__Chapter 31'sfactories__pattern. """import__importlibdef__tester(listerclass, sept=False): "Passany__listerclass__to listerclass"class__Super:def____init__(self): #Superclass____init__ self.data1 = 'code' #Create__instanceattrs__def method1(self):pass__class Sub(Super, listerclass): #Mix__in method1and__a__str____def __init__(self): #Listers__haveaccess__toself__Super.__init__(self) #Or__super().__init__() self.data2 = 'Python' #More__instanceattrs__self.data3 = 3.12def__method2(self): #Define__anothermethod__herepass__instance = Sub() #Build__instancewith__lister's__str____print(instance) #Run__mixed-in__str____(orvia__str(x))if__sept: print(f'\n{'-' * 80}\n') #Python__3.12+ f-stringdef__testByNames(modname, classname, sept=False):modobject__= importlib.import_module(modname) #Import__modby__namestringlisterclass__= getattr(modobject, classname) #Fetch__attrby__namestring tester(listerclass, sept)if____name__ == '__main__': testByNames('listinstance', 'ListInstance', True) #Test__allthree__here testByNames('listinherited', 'ListInherited', True) #See__others ahead... testByNames('listtree', 'ListTree', False)This__fileis__instrumentedto__allowus__totest__avariety__of listers.To__this end,it__ispassed__alister__class, listerclass,to__bemixed__inwith__testclasses__nestedin__a function. Again,classes__arepassable__first-class objects,and__weneed__tomake__thelister__classa__parameterto__allowit__tovary__per test.This__filealso__hastools__tofetch__classesby__name strings,which__well__setaside__forthe__moment.More__importanthere__isthe__self-testcode__inExample__31-10:it__importsthe__testerfunction__inExample__31-11and__passesin__ListInstanceto__betested__here. Hence,Sub__hereinherits__namesfrom__bothSuper__and ListInstance;it__sa__compositeof__itsown__namesand__namesin__bothits__superclasses.When__youmake__aSub__instanceand__print it,you__automaticallyget__thecustom__representationmixed__infrom__ListInstance: $ python3 listinstance.pyThe__ListInstanceclass__responsiblefor__thisdisplay__worksin__anyclass__its__mixedinto__becauseself__refersto__aninstance__ofthe__subclassthat__pullsthis__class in,whatever__thatmay__be. Again,in__a sense, mix-inclasses__arethe__classequivalent__ofmodules__packagesof__methodsuseful__ina__varietyof__clients.Besides__theutility__they provide, mix-insoptimize__code maintenance,as__allclasses__do.For__example,if__youlater__decideto__extendListInstance__s__str____toalso__printall__theclass__attributesthat__aninstance__inherits,you__re covered;because__its__aninherited__method,changing____str__automatically__updatesthe__displayof__eachsubclass__thatimports__theclass__andmixes__it in.And__sinceit__snow__officially later,let__smove__onto__thenext__sectionto__seewhat__suchan__extensionmight__look like.Listing__inheritedattributes__withdir__Asit__is,our__ListInstance mix-indisplays__instanceattributes__onlynames__attachedto__theinstance__object itself.It__snearly__trivial, though,to__extendthe__classto__displayall__theattributes__accessiblefrom__aninstance__bothits__ownand__thoseit__inheritsfrom__its classes.The__trickis__touse__thedir__built-infunction__insteadof__scanningthe__instances____dict__ dictionary;the__latterholds__instanceattributes__only,but__theformer__alsocollects__allinherited__attributes.The__mutationin__Example 31-12, listinherited.py,codes__this scheme.This__islocated__inits__ownmodule__tofacilitate__testing,but__ifexisting__clientswere__touse__thisversion__instead,they__wouldpick__upthe__newdisplay__automatically (andrecall__fromChapter__25that__afrom__imports__asclause__canrename__anew__versionto__aprior__namebeing__used).Example__31-12. listinherited.pyclass__ListInherited: """Use__dir()to__collectboth__instanceattrs__andnames__inheritedfrom__its classes.This__includesdefault__namesinherited__fromthe__implied 'object'superclass__abovetopmost__classes. getattr()can__fetchinherited__namesnot__in self.__dict__. Caution:use____str__,not____repr__,or__elsethis__loopswhen__printingbound__methodsthat__maybe__returnedfor__someattributes__by getattr().This__willnormally__failfor__class "slots"attributes__notyet__assigned. """def____attrnames(self, unders=False):result__= '\n'for__attrin__dir(self): #Instance__dir()if__attr[:2] == '__'and__attr[-2:] == '__': # Built-innames__result += f'\t{attr}\n'if__underselse__'' #Skip__built-ins? else:result__+= f'\t{attr}={getattr(self, attr)!r}\n'return__resultdef____str__(self):return__(f'') # name=valuelist__if__name____== '__main__':import__testmixin testmixin.tester(ListInherited) #Test__classin__thismodule__Noticethat__this code,by__default,skips__all__X____namesfor__brevity.There__are 27such__namesin__thetest__case,and__mostof__theseare__internalnames__thatwe__dont__generallycare__aboutin__ageneric__listinglike__this.Some__are user-defined operator-overloadingmethods__likeour____str__,though__mostreflect__defaultsin__theimplicit__objectroot__class,and__theres__noeasy__wayto__determinean__attributes__classof__originhere__(butstay__tuned).Because__dirresults__mayinclude__namesfrom__anywherein__aclass__tree,this__versionalso__mustuse__thegetattr__built-infunction__tofetch__attributesby__namestring__insteadof__indexingthe__instances____dict__attribute__dictionary.getattr__runsinheritance__search,and__someof__thenames__were__listinghere__arenot__storedon__theinstance__itself.To__testthe__new version,run__itsfile__directlyit__passesthe__ListInheritedclass__itdefines__tothe__testmixin.pyfile__stest__functionin__Example 31-11to__bemixed__inwith__asubclass__inthe__function.Here__sthe__outputof__thistest__andlister__class;notice__theextra__namesinherited__fromclasses__andthe__namemangling__atwork__inthe__listers__method name: $ python3 listinherited.py > data1='code' data2='Python' data3=3.12 method1=.Super.method1of__> method2=.Sub.method2of__> >The__displayof__boundmethods__inthis__wastruncated__tofit__this page;here__swhat__thefirst__twolook__likewith__anadded__linebreak__(as usual,run__onyour__ownfor__thefull__and up-to-date picture): _ListInherited__attrnames=.Subobject__at 0x101d76600>> method1=.Super.method1of__.Subobject__at 0x101d76600>>Display__formattingis__an open-endedtask__(e.g.,Python__sstandard__pprintpretty__printermodule__mayoffer__optionshere__too),so__well__leavefurther__polishingas__asuggested__exercise.The__treelister__ofthe__nextsection__maybe__moreuseful__inany__event,so__lets__move on.NOTE__Loopingin____repr__:Now__thatwe__redisplaying__inheritedmethods__too,we__mustuse____str__instead__of__repr____tooverload__printing.With____repr__,this__code (andcode__like it)will__fallinto__recursiveloops__itsgetattr__returnsa__bound method;whose__displayincludes__the instance;which__triggers__repr____againto__displaythe__instance;and__so on,quickly__triggeringa__stack-overflow exception. Subtle,but__true!Change____str__to____repr__to__seethis__live.One__wayto__avoidsuch____repr__loops__isto__skipgetattr__resultsfor__whichisinstance__comparisonsto__thestandard__librarys__types.MethodTypeare__true.Using____str__instead__is simpler.Listing__attributesper__objectin__classtrees__Lets__codeone__last extension.As__it is,our__latestlister__includesinherited__namesbut__doesnt__giveany__sortof__designationof__theclasses__fromwhich__thenames__are acquired.As__wesaw__inthe__classtree.pyexample__nearthe__endof__Chapter 29, though,it__sstraightforward__toclimb__classinheritance__treesin__code.The__mix-inclass__inExample__31-13,coded__infile__listtree.py,makes__useof__thissame__techniqueto__displayattributes__groupedby__theclasses__inwhich__theylive__itsketches__thefull__physicalclass__tree,displaying__attributesattached__toeach__objectalong__the way.The__readermust__stillinfer__attributeinheritance__(andwe__lladdress__thisin__thenext__sections__final demo),but__thisversion__givessubstantially__moredetail__thana__simpleflat__listof__attributes,inherited__or not.Example__31-13. listtree.pyclass__ListTree: """ Mix-inthat__returnsa____str__trace__ofthe__entireclass__treeand__allits__objects'attrs__atand__abovethe__self instance.The__displayis__runby__print() automatically;use__str()to__fetchas__a string. This: -Uses__X__pseudoprivateattr__namesto__avoidconflicts__withclients__-Recursesto__superclassesexplicitly__inDLFR__(thoughnot__MRO)order__-Uses__dict____insteadof__dir()because__attrsare__listedper__object -Supportsclasses__with slots:lack__ofslots__hereensures__a__dict____"""def____attrnames(self, obj, indent, unders=True):spaces__= ' ' * (indent + 1)result__= ''for__attrin__sorted(obj.__dict__):if__attr.startswith('__')and__attr.endswith('__'):if__unders:result__+= f'{spaces}{attr}\n' else:result__+= f'{spaces}{attr}={getattr(obj, attr)!r}\n'return__resultdef____listclass(self, aClass, indent):dots__= '.' *indent__preamble = (f'\n{dots}' f'\n' #Already__listedelif__aClassis__object: self.__visited[aClass] =True__returnpreamble__+ ': (see dir(object))>\n' #Skip__object's 24 else: self.__visited[aClass] =True__here = self.__attrnames(aClass, indent) #My__attrs +supers__above = ''for__Superin__aClass.__bases__:above__+= self.__listclass(Super,indent__+ 4)return__preamble + f':\n{here}{above}{dots}>\n'def____str__(self): self.__visited = {}here__= self.__attrnames(self, 0) #My__attrsabove__= self.__listclass(self.__class__, 4) #My__superstree__return (f'') #attrs__+supers__if__name____== '__main__':import__testmixin testmixin.tester(ListTree) #Test__classin__thismodule__Thisclass__achievesits__goalby__traversingthe__inheritancetree__froman__instances____class__to__its class,and__thenfrom__theclass__s__bases____toall__superclasses recursively,scanning__eachobject__sattribute____dict__along__theway__toenumerate__attributes. Ultimately,it__concatenateseach__treeportion__sstring__asthe__recursion unwinds.It__cantake__afew__momentsto__understandrecursive__programslike__this,but__giventhe__arbitraryshape__anddepth__ofclass__trees,we__reallyhave__nochoice__here (apartfrom__explicitstack__equivalentsof__thesorts__wemet__inChapters__19and__25,which__tendto__beno__simpler,and__whichwe__llomit__herefor__spaceand__time).This__classis__codedto__keepits__businessas__explicitas__possible, though,to__maximize clarity.To__test,run__thisclass__smodule__fileas__before;it__passesthe__ListTreeclass__to testmixin.pyof__Example 31-11 again,to__bemixed__inwith__asubclass__inthe__test function.The__files__tree-sketcheroutput__isas__follows: $ python3 listtree.py .Sub.method2at__0x10a482ac0> .........Super.method1at__0x10a4823e0> ............ ........> ........ _ListTree__listclass=__dict______doc____module______str____weakref____............ ........> ....> >Some__pointsto__noticeabout__this example:The____visitedtable__sname__ismangled__inthe__instances__attributedictionary__for pseudoprivacy;unless__were__very unlucky,this__wont__clashwith__otherdata__there.Some__ofthe__listerclass__smethods__aremangled__as well.To__minimize displays,__X____attributesare__listedby__name only,skipping__their values.The__built-inobject__classimplied__aboveall__topmostclasses__isalso__singledout__tosimply__referreaders__toits__dir result;object__comeswith__24attributes__today,which__wouldnt__beuseful__torepeat__inevery__display.The__attributesthat__werebound__methodsin__theprior__versionare__nowplain__functions.This__reflectsthe__factthat__thisversion__fetchesmethods__fromclasses__insteadof__theinstance__thegetattr__hereis__runon__thecurrent__treeobject__whose__dict____isbeing__scanned (getattrand____dict__indexing__areequivalent__inthis__context). Again,class__methodsare__just functions,which__arebound__onlywhen__fetchedfrom__an instance.To__avoidlisting__aclass__objectmore__than once,a__tablerecords__classesvisited__so far.A__dictionaryworks__inthis__rolebecause__classobjects__arehashable__andthus__maybe__dictionary keys;a__setwould__work similarly.On__thelast__point,cycles__arenot__generallypossible__inclass__inheritancetrees__aclass__mustalready__havebeen__definedto__benamed__asa__superclass,and__Pythonraises__anexception__asit__shouldif__youattempt__tocreate__acycle__laterby____bases__ changes.The__visitedmechanism__hereis__still needed, though,to__avoidrelisting__aclass__twice: >>>class__C:pass__>>>class__B(C):pass__>>> C.__bases__ = (B,) #Dark__magic TypeError:a____bases__item__causesan__inheritancecycle__Formore__fun,try__mixingthis__classinto__somethingmore__substantial,like__theButton__classof__Pythons__tkinter GUI-toolkit module.In__general,you__llwant__toname__ListTreefirst__(leftmost)in__aclass__header,so__its__str____ispicked__up;Button__has one, too,and__theleftmost__superclassis__searchedfirst__inmultiple__inheritances__default: >>>from__tkinterimport__Button >>>from__listtreeimport__ListTree >>>class__ButtonPlus(ListTree, Button):pass__# ListTree's str,not__Button's >>> print(ButtonPlus())our__class'sdisplay__>>>class__ButtonPlus(Button, ListTree):pass__# Mix-inorder__can matter! >>> print(ButtonPlus()) .!buttonplus2Order__mattersin__multiple inheritance,though__themanual__overrideswe__exploredearlier__canforce__the issue: >>>class__ButtonPlus(Button, ListTree):__str____= ListTree.__str__our__class'sdisplay__Youmight__alsotry__running testmixin.pyof__Example 31-11 directly;its__self-testcode__thatwe__shelvedearlier__runseach__ofour__threelister__classesin__turn,using__theirmodule__andclass__namestrings__atrivial__classfactory__in action: $ python3 testmixin.pyall__three listers'results__Whileour__treelister__worksas__planned,it__doesnt__reallyfollow__Pythons__MROordering__throughclass__treeswith__diamonds.In__fact,it__reallyjust__sketchesthe__DFLRorder__andleaves__itto__readersto__determinefrom__whichclass__agiven__attributeis__inherited.To__do better,let__smove__onto__afinal__exampleto__closeout__this chapter. Example:Mapping__Attributesto__InheritanceSources__Thissection__wrapsup__withan__examplethat__demosan__applicationfor__theMRO__inprogramming__tools.As__coded,the__precedingsection__stree__listergave__thephysical__locationsof__attributesin__aclass__tree. However,by__mappingthe__listof__inheritedattributes__ina__dirresult__tothe__linearMRO__sequence,such__toolscan__moredirectly__associateattributes__withthe__classesfrom__whichthey__areactually__inheritedalso__auseful__relationshipfor__programmers.We__wont__recodeour__treelister__infull__here,but__asa__firstmajor__step,Example__31- 14,file__mapattrs.py,implements__toolsthat__canbe__usedto__associateattributes__withtheir__inheritance source.As__anadded__bonus,its__mapattrsfunction__demonstrateshow__inheritanceactually__searchesfor__attributesin__classtree__objectsthough__theMRO__islargely__automatedfor__uswith__the built-in__mro____classattribute__wemet__earlier.Example__31-14. mapattrs.py """Main__tool: mapattrs()maps__allattributes__onor__inheritedby__aninstance__tothe__instanceor__classfrom__whichthey__are inherited.Also__here:assorted__dictionarytools__using comprehensions.Assumes__dir()gives__allattributes__ofan__instance.To__emulate inheritance,this__usesthe__class's__mro____tuple,which__givesthe__MROsearch__orderfor__classesin__Python 3.X.A__recursivetree__traversalfor__theDFLR__orderof__classesis__includedbut__unused. """import__pprintdef__trace(label, X, end='\n'): print(f'{label}\n{pprint.pformat(X)}{end}') #Print__nicelydef__filterdictvals(D, V): """dict__Dwith__entriesfor__valueV__removed. filterdictvals(dict(a=1, b=2, c=1), 1) => {'b': 2} """return__{K: V2for__(K, V2)in__D.items()if__V2 != V}def__invertdict(D): """dict__Dwith__valueschanged__tokeys__(groupedby__values).Values__mustall__behashable__towork__as dict/set keys. invertdict(dict(a=1, b=2, c=1)) => {1: ['a', 'c'], 2: ['b']} """def__keysof(V):return__sorted(Kfor__Kin__D.keys()if__D[K] == V)return__{V: keysof(V)for__Vin__set(D.values())}def__dflr(cls): """ Depth-first left-to-rightorder__ofclass__treeat__cls.Cycles__not possible:Python__disallowson____bases__ changes. """here__= [cls]for__supin__cls.__bases__:here__+= dflr(sup)return__heredef__inheritance(instance): """Inheritance__order sequence:MRO__or DFLR.DFLR__aloneis__nolonger__usedin__Python 3.X. """if__hasattr(instance.__class__, '__mro__'):return__(instance,) + instance.__class__.__mro__ else:return__[instance] + dflr(instance.__class__)def__mapattrs(instance, withobject=False, bysource=False): """dict__withkeys__givingall__inheritedattributes__of instance,with__valuesgiving__theobject__thateach__isinherited__from. withobject: False=removeobject__built-inclass__attributes. bysource: True=groupresult__byobjects__insteadof__attributes.Supports__classeswith__slotsthat__preclude__dict____in instances. """ attr2obj = {}inherits__= inheritance(instance)for__attrin__dir(instance):for__objin__inherits:if__hasattr(obj, '__dict__')and__attrin__obj.__dict__: #Slots__okay attr2obj[attr] =obj__breakif__not withobject: attr2obj = filterdictvals(attr2obj, object)return__attr2objif__notbysource__else invertdict(attr2obj)if____name__ == '__main__':class__D: attr2 = 'D'class__C(D): attr2 = 'C'class__B(D): attr1 = 'B'class__A(B, C):pass__I = A() I.attr0 = 'I' print(f'Py=>{I.attr0=}, {I.attr1=}, {I.attr2=}\n') # Python'ssearch__trace('INHERITANCE', inheritance(I)) # [Inheritance order] trace('ATTRIBUTES', mapattrs(I)) # {Attr => Source} trace('SOURCES', mapattrs(I, bysource=True)) # {Source => [Attrs]}This__modules__mainmapattrs__functionuses__dirto__collectall__theattributes__thatan__instance inherits.For__each,it__mapsthe__attributeto__itssource__byscanning__theMRO__orderavailable__inthe____mro__of__theinstance__s class,searching__eachobject__snamespace____dict__along__the way.The__neteffect__replicatesPython__strue__inheritancesearch__foreach__attributeaccessible__fromthe__instancepassed__in.This__files__self-testcode__appliesits__toolsto__adiamond__multiple-inheritancetree__similarto__thosewe__studied earlier.It__usesPython__spprint__standard-librarymodule__todisplay__listsand__dictionariesnicely__pprint.pprintis__itsbasic__call,and__itspformat__returnsa__print string. Notably, attr2,whose__valueis__givenon__thefirst__lineand__whosename__appearsin__laterfunction__results,is__inheritedfrom__classC__perthe__MROorder__weve__studied: $ python3 mapattrs.py Py=>I.attr0='I', I.attr1='B', I.attr2='C'INHERITANCE__(<__main__.Aobject__at 0x10cc33e00>, , , , , )ATTRIBUTES__{'__dict__': , '__doc__': , '__module__': , '__weakref__': , 'attr0': <__main__.Aobject__at 0x10cc33e00>, 'attr1': , 'attr2': }SOURCES__{<__main__.Aobject__at 0x10cc33e00>: ['attr0'], : ['__dict__', '__weakref__'], : ['attr2'], : ['attr1'], : ['__doc__', '__module__']}Although__thismodule__wasnot__designedto__bea__mix-inclass__itself,listers__mayindex__itsmapattrs__functions__dictionaryresults__toobtain__anattribute__ssource__ora__sources__attributes. Moreover,it__seasy__toadapt__thismodule__sresults__tobe__a mix-inby__wrappingthem__ina____str__.Here__itis__listingattributes__sourcesin__thetest__classesof__theprior__sections__Example 31-11: $ python3 >>>import__pprint >>>from__mapattrsimport__mapattrs >>>class__ListAttr2Source:def____str__(self):return__pprint.pformat(mapattrs(self)) >>>from__testmixinimport__tester >>> tester(ListAttr2Source) {'__dict__': .Super'>, '__doc__': .Sub'>, '__init__': .Sub'>, '__module__': .Sub'>, '__str__': , '__weakref__': .Super'>, 'data1': .Subobject__at 0x102a8fa40>, 'data2': .Subobject__at 0x102a8fa40>, 'data3': .Subobject__at 0x102a8fa40>, 'method1': .Super'>, 'method2': .Sub'>}Listing__sourcesattributes__isjust__aseasy__(seealso__Pythons__docsfor__pprintoptions__likecompact__and width): >>>class__ListSource2Attr:def____str__(self):return__pprint.pformat(mapattrs(self, bysource=True)) >>> tester(ListSource2Attr) {.Subobject__at 0x102ad12e0>: ['data1', 'data2', 'data3'], .Super'>: ['__dict__', '__weakref__', 'method1'], .Sub'>: ['__doc__', '__init__', '__module__', 'method2'], : ['__str__']}Study__thisexample__scode__formore__insight.As__callouts,notice__howit__useshasattr__tocheck__whetheran__objecthas__a__dict____attributedictionary__beforetrying__toindex__it.Though__rare,some__instancesmay__nothave__a__dict____ifthey__usethe__classextension__knownas__slotsnoted__earlier.The__priorsection__sslot__storyis__varied:as__mix-ins,ListTree__andListInstance__workas__isfor__classeswith__slotsbecause__theirlack__ofslots__ensuresan__instance __dict__,but__ListInheritedcan__failfor__slotsnot__yetassigned__findingsto__beclarified__inthe__next chapter. Additionally,both__slotsand__othervirtual__instanceattributes__likeproperties__anddescriptors__liveat__theclass__insteadof__theinstance__andhence__mayrequire__generichandling__dir enumeration,and__eithergetattr__fetches,tree__climbs,or__MRO scans.This__exampleand__theprior__sections__listersaccommodate__this,but__unevenly:some__suchnames__willbe__associatedwith__theclasses__inwhich__theirimplementations__live,not__theinstance__throughwhich__theyare__accessed. Moreover,no__listercan__showattribute__namesdynamically__computedin__fullby__methodslike____getattr__because__thesenames__haveno__physical basis.Classes__implementingsuch__dynamicnames__canalso__definea____dir__method__toprovide__anattribute__resultlist__fordir__calls,but__generaltools__likeour__listersand__mappercannot__dependon__thisoptional__andrelatively__uncommoninterface__being present. Finally,all__theattribute__listersand__mappersin__thischapter__workin__fullfor__normalinstances__butdon__tsupport__classes.For__the latter,prints__runa__defaultdisplay__insteadof__anyof__thethree__listers,and__mapattrsstrangely__attributesmost__namesto__amystery__classcalled__type.The__listerskips__stemfrom__thefact__that built-inslike__printskip__the instance,as__weve__noted before.The__mapattrsoddity__reflectsthe__factthat__classesacquire__namesfrom__boththeir__ownsuperclass__tree (and MRO),and__asecondary__tree (and MRO)formed__bymetaclasses__thatwe__haveyet__to meet.But__tounderstand__boththe__inheritancebifurcation__of metaclasses,as__wellas__etherealattributes__like slots, properties,and__descriptors,we__needto__moveon__tothe__next chapter.Other__Design-RelatedTopics__Inthis__chapter,we__vestudied__anassortment__ofdesign__patternsused__tocombine__classesin__Python programs,along__withthe__mechanismbehind__someof__them.We__vereally__onlyscratched__thesurface__herein__thedesign__patterns domain, though.Elsewhere__inthis__book,you__llfind__coverageof__other design-related topics,such__as:Abstract__superclasses (Chapter 29)Decorators__(Chapters 32and__39)Type__subclasses (Chapter 32)Static__andclass__methods (Chapter 32)Managed__attributes (Chapters 32and__38)Metaclasses__(Chapters 32and__40)For__evenmore__detailson__design patterns,this__bookmust__delegateto__otherresources__onOOP__at large.Although__patternsare__importantin__OOPwork__andare__oftenmore__naturalin__Pythonthan__other languages,they__arenot__specificto__Pythonitself__anda__subjectthat__soften__bestacquired__by experience.Chapter__SummaryIn__this chapter,we__sampledcommon__waysto__useand__combineclasses__tooptimize__theirreusability__andfactoring__benefitswhat__areusually__considereddesign__issues,which__areoften__independentof__anyparticular__programminglanguage__(thoughPython__canmake__themeasier__to implement).We__studiedinheritance__(acquiringbehavior__fromother__classes),composition__(controllingembedded__objects),and__delegation (wrappingobjects__inproxy__classes),as__wellas__therelated__topicsof__pseudoprivate attributes,bound__methods, factories,multiple__inheritance,and__the MRO.The__nextchapter__concludesour__lookat__classesand__OOPby__surveying class-related__topicsthat__aremore__esotericthan__mostof__whatwe__vealready__seen.Some__ofits__materialmay__beof__moreinterest__totool__writersthan__application programmers,but__itstill__meritsa__reviewby__mostpeople__whowill__doOOP__inPython__ifnot__foryour__code,then__forothers__codeyou__mayneed__tounderstand__and reuse. First, though,here__sanother__quickchapter__quizto__review.Test__Your Knowledge:Quiz__1.What__ismultiple__inheritance? 2.What__is composition? 3.What__is delegation? 4.What__arebound__methods? 5.What__arepseudoprivate__attributesused__for? 6.How__doesthe__MROinheritance__searchorder__differfrom__DFLR?Test__Your Knowledge:Answers__1.Multiple__inheritanceoccurs__whena__classinherits__frommore__thanone__superclass;it__suseful__formixing__togethermultiple__packagesof__class-based__code.The__left-to-rightorder__inclass__statementheaders__determinesthe__generalorder__ofattribute__searches,and__theMRO__specializessearch__fordiamonds__withcommon__superclasses. 2.Composition__isa__techniquewhereby__acontroller__classembeds__anddirects__anumber__ofobjects__andprovides__aninterface__allits__own;it__sa__wayto__buildup__largerstructures__with classes. 3.Delegation__involveswrapping__anobject__ina__proxy class,which__addsextra__behaviorand__passesother__operationsto__thewrapped__object.The__proxygenerally__retainsthe__interfaceof__thewrapped__object. 4.Bound__methodscombine__aninstance__anda__method function;you__cancall__themwithout__passingin__aninstance__objectexplicitly__becausethe__originalinstance__isstill__availablein__the instance+function pair. 5.Pseudoprivate__attributes,whose__namesbegin__butdo__notend__withtwo__leadingunderscores__(e.g., __X),are__usedto__localizenames__tothe__enclosing class.This__includesboth__class attributes,like__methodsdefined__insidethe__class statement,and__selfinstance__attributesassigned__insidethe__classs__methods.Such__namesare__expandedto__includethe__class name,which__makesthem__generallyunique__amongall__classesin__aninheritance__tree. 6.The__MROselects__same-namedattributes__ina__lowersubclass__overthose__ina__highercommon__superclassin__multiple-inheritancediamond__treeseffectively__searchingacross__beforeup__inthis__specific case.The__DFLRis__otherwisethe__same;in__fact,the__MROis__definedby__startingwith__theDFLR__orderand__thenremoving__allbut__thelast__(rightmost)appearances__ofclasses__thatare__visitedmore__than once.This__differsfrom__DFLRonly__whenthere__are duplicates,which__ariseonly__indiamonds__thathave__common superclasses.That__said,the__built-inobject__makesevery__multiple-inheritancetree__a diamond,so__thisis__a common,if__implicit, occurrence.Chapter__32.Class__Oddsand__EndsThis__chapterconcludes__ourlook__atOOP__inPython__bypresenting__acollage__ofmore__advancedclass__topics.We__willsurvey__customizing built-in types,the__relationshipof__classesand__types,attribute__toolslike__slotsand__properties,the__special-casestatic__andclass__methods,decorators__and metaclasses,and__thesuper__calls__complete story.Some__ofthese__areintroduced__herebut__resumedby__focusedchapters__inthis__books__Part VIII,Advanced__Topics .As__weve__seen,Python__sOOP__model is,at__its core,relatively__simple,and__someof__thetopics__presentedin__thischapter__areso__advancedand__optionalthat__youmay__notencounter__themvery__oftenin__yourPython__applications-programming career.In__theinterest__of completeness,though__andbecause__younever__knowwhen__anadvanced__topicmay__cropup__incode__youuse__well__roundout__ourdiscussion__ofclasses__witha__brieflook__atthese__advancedtools__forOOP__work.As__usual,because__thisis__thelast__chapterin__thispart__ofthe__book,it__endswith__asection__on class-relatedgotchas__anda__setof__labexercises__forthis__partto__helpcement__theideas__weve__studied here.Beyond__these exercises,studying__largerOOP__Pythonprojects__orstarting__someof__yourown__isheartily__recommendedas__asupplement__tothis__book.As__withmuch__inlife__and computing,the__benefitsof__OOPtend__tobecome__moreapparent__with practice.NOTE__Blastfrom__the past:Python__3.Xlaunched__witha__mandatory new-styleclass__modelthat__couldbe__enabledin__2.Xas__an option; 2.Xs__ownmodel__wasdubbed__classic.At__leastin__termsof__itsOOP__support, new-styleclasses__transformedPython__intoa__differentlanguage__altogetherone__thatborrows__muchmore__from,and__isoften__ascomplex__as,other__languagesin__this domain.The__lastchapter__sMRO__andmost__topicsin__thischapter__werepart__ofthis__package.Because__thisbook__isnow__focusedon__3.X only,the__termnew__styleis__mootand__unusedhere__allits__classes qualify.Extending__Built-inObject__TypesBesides__implementingnew__kindsof__objects,classes__aresometimes__usedto__extendthe__functionalityof__Pythons__built-inobject__typesto__supportmore__exoticdata__structures.For__instance,to__addqueue__insertand__deletemethods__to lists,you__cancode__classesthat__wrap (embed)a__listobject__andaugment__itwith__insertand__deletemethods__thatprocess__thelist__specially,using__thedelegation__techniquewe__studiedin__Chapter 31.You__canalso__usesimple__inheritanceto__customize built-intypes__forsuch__custom roles.The__nexttwo__sectionsshow__bothtechniques__in action.Extending__Typesby__EmbeddingDo__youremember__thoseset__functionswe__wrotein__Chapters 16and__18?Here__swhat__theylook__likebrought__backto__lifeas__aPython__class.Example__32-1 (file setwrapper.py)implements__anew__setobject__typeby__movingset__functionsto__methodsand__addingsome__basicoperator__overloading.For__themost__part,this__classjust__wrapsa__Pythonlist__withextra__set operations.But__becauseit__sa__class,it__alsosupports__multipleinstances__andcustomization__byinheritance__in subclasses.Unlike__ourearlier__functions,using__classeshere__allowsus__tomake__multiple self-contained__setobjects__withpreset__dataand__behaviorrather__thanpassing__listsinto__functions manually.Example__32-1. setwrapper.pyclass__Set:def____init__(self,value__= []): #Constructor__self.data = [] #Manages__alist__self.concat(value) #Removes__duplicatesdef__intersect(self, other): #other__isany__iterableres__= [] #self__isthe__subjectfor__xin__self.data:if__xin__other: #Pick__commonitems__res.append(x)return__Set(res) #Return__anew__Setdef__union(self, other): #other__isany__iterableres__= self.data[:] #Copy__ofmy__listfor__xin__other: #Add__itemsin__otherif__notx__in res: res.append(x)return__Set(res)def__concat(self, value): # value: list, Set...for__xin__value: #Removes__duplicatesif__notx__in self.data: self.data.append(x)def____len__(self):return__len(self.data) # len(self),if__selfdef____getitem__(self, key):return__self.data[key] # self[i], self[i:j]def____and__(self, other):return__self.intersect(other) #self__&other__def __or__(self, other):return__self.union(other) #self__|other__def __repr__(self):return__f'Set({self.data!r})' # print(self),...def____iter__(self):return__iter(self.data) #for__xin__self,...To__usethis__class,we__make instances,call__methods,and__rundefined__operatorsas__usual: $ python3 >>>from__setwrapperimport__Set >>>x__= Set([1, 3, 5, 7, 3]) >>> x.union(Set([1, 4, 7])) Set([1, 3, 5, 7, 4]) >>>x__| Set([1, 4, 6, 4]) Set([1, 3, 5, 7, 4, 6])Overloading__operationssuch__asindexing__anditeration__alsoenables__instancesof__ourSet__classto__oftenmasquerade__asreal__lists.Because__youwill__interactwith__andextend__thisclass__inan__exerciseat__theend__ofthis__chapter,we__llput__thiscode__onthe__backburner__untilits__solutionin__Appendix B.Extending__Typesby__SubclassingWhile__theprior__sections__embedding works,Python__s built-intypes__canalso__besubclassed__directly.In__fact, type-conversionfunctions__suchas__list, str, dict,and__tupleare__really built-intype__names;although__transparentto__your script,a__type-conversioncall__(e.g., list('text'))is__reallyan__invocationof__atype__s constructor.This__allowsyou__tocustomize__orextend__thebehavior__of built-intypes__with user-defined__class statements:simply__subclassthe__typenames__tocustomize__them.Instances__ofyour__typesubclasses__cangenerally__beused__anywherethat__theoriginal__built-intype__can appear.For__example,suppose__youhave__troublegetting__usedto__thefact__thatPython__listoffsets__beginat__0instead__of 1.Not__toworry__youcan__alwayscode__yourown__subclassthat__customizesthis__corebehavior__of lists,and__Example 32-2shows__how.Example__32-2. typesubclass.py """Subclass__built-inlist__type/class.Map__1..Nto__0..N-1,call__backto__built-in version. """class__MyList(list):def____getitem__(self, offset): print(f'')return__list.__getitem__(self,offset__- 1)if____name__ == '__main__': print(list('abc'))x__= MyList('abc') #__init____inheritedfrom__list print(x) # __str__/__repr__inherited__fromlist__print(x[1]) # MyList.__getitem__ print(x[3]) #Customizes__listsuperclass__method x.append('hack!'); print(x) #Attributes__fromlist__superclass x.reverse(); print(x)In__this file,the__MyListsubclass__extendsthe__built-inlist__s__getitem____indexingmethod__only,to__mapindexes__1to__Nback__tothe__required 0to__N 1. Really,all__itdoes__isdecrement__thesubmitted__indexand__callback__tothe__superclasss__versionof__indexing,but__its__enoughto__dothe__trick: $ python3 typesubclass.py ['a', 'b', 'c'] ['a', 'b', 'c']a__c ['a', 'b', 'c', 'hack!'] ['hack!', 'c', 'b', 'a']This__outputalso__includestracing__textthe__classprints__on indexing.Of__course,whether__changingindexing__thisway__isa__good idea,in__general,is__anotherissue__usersof__yourMyList__classmay__verywell__beconfused__bysuch__acore__departurefrom__Pythonsequence__behavior.The__abilityto__customize built-intypes__thisway__canbe__apowerful__asset, though.For__instance,this__codingpattern__givesrise__toan__alternativeway__tocode__aset__asa__subclassof__the built-inlist__typerather__thana__standaloneclass__thatmanages__anembedded__list object,as__shownin__theprior__section.As__discussedin__Chapter 5,Python__todaycomes__witha__powerful built-inset__object,along__withliteral__andcomprehension__syntaxfor__makingnew__sets.Coding__one yourself, though,is__stilla__greatway__tolearn__abouttype__subclassingin__general.The__codein__Example 32-3,file__setsubclass.py,customizes__liststo__addjust__methodsand__operatorsrelated__toset__processing.Because__allother__behavioris__inheritedfrom__the built-inlist__superclass,this__makesfor__ashorter__andsimpler__alternativeeverything__notdefined__hereis__routedto__list directly.Example__32-3. setsubclass.pyclass__Set(list):def____init__(self,value__= []): #Constructor__list.__init__(self) #Customizes__list self.concat(value) #Copies__mutabledefaults__def intersect(self, other): #other__isany__iterableres__= [] #self__isthe__subjectfor__xin__self:if__xin__other: #Pick__commonitems__res.append(x)return__Set(res) #Return__anew__Setdef__union(self, other): #other__isany__iterableres__= Set(self) #Copy__meand__mylist__res.concat(other)return__resdef__concat(self, value): # value: list, Set, etc.for__xin__value: #Removes__duplicatesif__notx__in self: self.append(x)def____and__(self, other):return__self.intersect(other)def____or__(self, other):return__self.union(other)def____repr__(self):return__f'Set({list.__repr__(self)})'if____name__ == '__main__':x__= Set([1, 3, 5, 7])y__= Set([2, 1, 4, 5, 6]) print(x, y, len(x)) print(x.intersect(y), y.union(x)) print(x & y,x__| y) x.reverse(); print(x)Here__isthe__outputof__the self-testcode__atthe__endof__this file.Because__subclassingcore__typesis__asomewhat__advancedfeature__witha__limited audience,we__llend__thistopic__here,but__youre__invitedto__tracethrough__theseresults__inthe__codeto__studyits__behavior: $ python3 setsubclass.py Set([1, 3, 5, 7]) Set([2, 1, 4, 5, 6]) 4 Set([1, 5]) Set([2, 1, 4, 5, 6, 3, 7]) Set([1, 5]) Set([1, 3, 5, 7, 2, 4, 6]) Set([7, 5, 3, 1]) Subtleties:some__inheritedlist__operationsmay__introduceduplicates__toour__Set,and__thereare__moreefficient__waysto__implementsets__withdictionaries__in Python,which__replacethe__nestedlinear__searchscans__inthe__setimplementations__shownhere__withmore__directdictionary__indexoperations__(hashing)and__sorun__much quicker.If__youre__interestedin__sets,also__takeanother__lookat__theset__objecttype__weexplored__inChapter__5;this__typeprovides__extensiveset__operationsas__built-in tools.Set__implementationsare__funto__experimentwith__butnot__strictlyrequired__inPython__today.More__importanthere__isthe__questionof__whywe__cansubclass__built-intypes__likelist__at all.The__nextsection__solvesthe__mysteryat__leastas__muchas__thischapter__can.The__PythonObject__ModelThe__reasonwe__couldsubclass__built-intypes__inthe__priorsection__isthat__typesand__classesare__largelyone__andthe__samea__unificationthat__camewith__the new-style__modelalluded__toat__thestart__ofthis__chapter.For__built-ins,some__instancescan__uniquelybe__codedwith__literalsyntax__like [], 'lp6e',and__3.12instead__ofclass__callslike__list(), str(),and__float(),but__theyare__instancesof__a class, nonetheless.In__fact, built-intypes__and user-definedclasses__areboth__classesand__areboth__themselvesinstances__ofthe__built-intype__class.The__typeobject__generatesclasses__asits__instances,classes__generateinstances__of themselves,and__classesare__reallyjust__user-defined types.And__ontop__ofall__this,the__built-inobject__classprovides__defaultsfor__every object.Classes__AreTypes__AreClasses__Whileyou__probablyshouldn__tponder__thepreceding__definitionsbefore__operatingheavy__machinery,it__seasy__tosee__allthis__in code.The__type built-inwith__oneargument__returnsany__objects__type,which__isnormally__thesame__asthe__objects____class__,and__isinstancechecks__whetheran__objectinherits__from another.Here__sthe__storyfor__user-definedclasses__(a.k.a. types): >>>class__Hack:pass__#A__humble user-definedclass__>>>I__= Hack() #Make__aninstance__bycalling__theclass__>>> type(I) #Type__isthe__user-definedclass__oforigin__>>> type(Hack) # User-definedclasses__areinstances__oftype__>>> I.__class__, Hack.__class__ (, ) >>> isinstance(I, object), isinstance(Hack, object) (True, True)This__worksthe__samefor__built-intypes__(a.k.a. classes),but__thereis__alsoliteral__syntaxfor__generating instances: >>>I__= 'hack' #Make__aninstance__byliteral__syntax,or__str() >>> type(I) # Built-inobjects__areinstances__ofclasses__>>> type(str) # Built-inclasses__areinstances__oftype__>>> I.__class__, str.__class__ (, ) >>> isinstance(I, object), isinstance(str, object) (True, True)In__fact,type__itselfreports__inas__a class,though__ithas__notype__butitself__circularlycapping__the chain: >>> type(type) #The__typeclass__endsthe__chain >>> type(type(type)) # Hmm...thetop__ofthe__chainThis__modelmay__seemacademic__(andto__someextent__is),but__itallows__usto__specialize built-intypes__withnormal__user-definedclasses__andbears__on type-testing__code:you__mustknow__whata__typeis__totest__it accurately.Some__InstancesAre__MoreEqual__ThanOthers__Its__temptingto__simplytake__awayfrom__theforegoing__thatclasses__andtypes__arethe__same,but__thisstory__isricher__thanthat__may imply:the__instanceswe__makefrom__theseobjects__divergein__bothfunctionality__and inheritance.To__trulyunderstand__how,we__haveto__brieflyfactor__inmetaclasses__classesthat__generateother__classes.The__type built-initself__isa__metaclassand__maybe__customizedwith__user-defined subclasses.These__subclassesare__codedwith__normalclass__statements,selected__withspecial__syntaxin__class headers,and__designedto__playmetaclass__roles,but__theywon__tbe__coveredin__fulluntil__Chapter 40.In__brief, though,the__completerelationship__between instances, classes,and__typesis__as follows:Instances__arecreated__fromclasses__both built-inand__user-defined.Classes__themselvesare__createdfrom__the built-intype__classor__oneof__its subclasses.The__object built-inclass__isa__superclassto__everyobject__instance, class,or__both.Although__everythingis__ultimatelyan__instancein__Python,there__aretwo__fundamentallydifferent__kindsof__instances,and__conflatingthese__onlyserves__tomask__thetrue__complexityof__the model.It__doesnt__helpto__distinguishthese__asinstances__of user-definedclasses__or not:metaclasses__maybe__user-definedclasses__too.Nor__isthis__aboutbeing__asubclass__ofa__type:the__realfork__inthis__modelis__thatclasses__arecreated__froma__typeclass__specially.As__youll__learnin__full later,classes__definetheir__typeswith__optionalmetaclass__syntaxthat__defaultsto__typeif__omitted,but__otherinstances__definetheir__typesby__theclass__callsor__literalsyntax__weve__usedso__far:class__C(metaclass=Meta): #Class__creation:metaclass__defaultsto__"type"I__= C( ) #Instance__creation: user-definedclasses__X = [1, 2] #Instance__creation: built-inclasses__Whileboth__produceinstances__insome__sense,these__differentsyntaxes__createvery__differentkinds__ofinstances__classand__nonclasswith__fundamentallydifferent__behaviors:Nonclass__instancesdo__notmake__instancesClasses__arecreated__fromtype__(oranother__metaclass),similar__tothe__wayinstances__arecreated__from classes.Once__created, though,the__analogy fails:classes__createinstances__oftheir__own,but__nonclassinstances__do not.Classes__havean__extrainheritance__searchThere__arereally__twoinheritance__treesand__searchesin__Python,which__aredistinct__butnot__entirely disjoint.The__secondarytree__isformed__bytype__andits__subclassesand__issearched__onlyfor__classes,not__nonclass instances.In__other words,nonclass__instancesseal__offthe__instantiation chain,and__inheritancediffers__fornonclass__instancesand__classesthemselves__eventhough__thelatter__arealso__instancesof__type.All__ofthis__boilsdown__todifferent__creationsyntax__thatmakes__differentkinds__of objects,which__areoften__confusinglylumped__togetheras__instances : >>>class__C:pass__#A__typeinstance__>>>I__= C() #A__nonclassinstance__>>> isinstance(I, type), isinstance(C, type) #Only__classesare__types (False, True)While__typesand__classesmay__be synonymous,the__instanceswe__createfrom__themvary__percreation__code.The__InheritanceBifurcation__Thoughwe__cant__getinto__fulldetails__here,the__inheritancesearch__usedfor__classes (a.k.a. types)differs__fromwhat__weve__seenso__farand__maybe__theirmost__profound distinction.In__short,inheritance__isalways__basedon__theMRO__(methodresolution__order)we__studiedin__MultipleInheritance__andthe__MRO ,but__variesas__follows:Nonclass__inheritanceAs__weve__seen,inheritance__runon__anonclass__instancesearches__the__dict____attributesof__instance, class,and__superclasses,per__theMRO__orderwe__studiedin__theprior__chapter.This__worksby__firstchecking__the instance,then__followingthe__instances____class__to__its class,and__finallyfollowing__eachclass__s__bases____to superclasses. Technically,__bases____areused__tomake__an__mro____at __class__,which__inheritance scans.Class__inheritanceInheritance__runon__aclass__directly, though,first__searchesthe____dict__of__theclass__andall__itssupers__availablefrom____bases__as__usual,but__thenalso__searchesthe__separateclass__treeformed__bythe__typeclass__andits__metaclass subclasses.The__secondpart__ofthis__worksby__followingthe__classs__own__class____toits__typeclass__treeand__using__bases____andMROs__there,too__butonly__asa__lastresort__andonly__forinheritance__runon__classes.In__fact,if__youknow__whereto__look,you__caninspect__theinheritance__sourcesthat__differfor__nonclassinstances__likeI__andclasses__likeC__inthe__priorexample__thoughthe__underscoresand__displaysaren__t pretty: >>> isinstance(I, C), type(I) (True, ) >>> I, I.__class__, I.__class__.__bases__ (<__main__.Cobject__at 0x101265d60>, , (,)) >>> C, C.__bases__, C.__class__, C.__class__.__bases__ (, (,), , (,))But__dueto__theway__MROsare__computedfrom____bases__and__scanned,it__smore__accurateto__thinkof__inheritances__differentsearch__ordersfor__nonclassinstances__andclasses__asfollows__whereeach____mro__is__aflattened__tree: >>> I, I.__class__.__mro__ (<__main__.Cobject__at 0x101265d60>, (, )) >>> C.__mro__, C.__class__.__mro__ ((, ), (, ))And__becauseeach__items____dict__is__checked,the__orderedset__ofcandidates__searchedby__inheritancefor__nonclassinstances__Iand__classesC__isultimately__andrespectively__asfollows__withtwo__MROscans__offlattened__treesfor__classes only,and__ignoringthe__factthat__somekinds__of descriptors,introduced__ahead,take__precedencein__bothtrees__asyou__lllearn__inChapter__40: [I.__dict__] + [x.__dict__for__xin__I.__class__.__mro__] [x.__dict__for__xin__C.__mro__] + [x.__dict__for__xin__C.__class__.__mro__]Wait__theres__asecond__treein__inheritance? Well, yes,though__itdoesn__tcome__intoplay__inthe__vastmajority__ofapplication__code.The__type/metaclasstree__isused__inadvanced__class-managementroles__and,even__then,is__oftenlimited__toclass__customizationat__classcreation__time. Still,this__secondary tree,along__withthe__descriptorsspecial__casesomitted__here,bifurcates__andconvolutes__theinheritance__story,especially__comparedto__itsprior__forms.It__alsoexplains__whysome__classattributes__like__bases____arenot__inheritedby__nonclassinstances__theyre__locatedin__thesecondary__tree (i.e., MRO)searched__onlyfor__classes: >>> '__bases__'in__I.__dict__ #Not__ininstance__False >>> '__bases__'in__C.__dict__ #Not__in instance'sclass__False >>> '__bases__'in__C.__class__.__dict__ #In__instance's class'sclass__TrueBecause__ofthe__two-treeinheritance__model,such__namesinherited__byclasses__arenot__inheritedby__their instances: >>> C.__bases__ #Instance__doesnot__inherit! (,) >>> I.__bases__ AttributeError: 'C'object__hasno__attribute '__bases__'.Did__you mean: '__class__'?The__Metaclass/ClassDichotomy__So,where__doesthis__oddtale__of type/classunification__leave us?Types__indeedbehave__as classes,and__thisallows__usto__extendthem__withnormal__classsyntax__inboth__theprimary__andmetaclass__trees.But__italso__comeswith__noticeable seams,including__special-casesyntax__forclass__instantiation,an__extra type-treesearch__forclasses__only,two__verydifferent__kindsof__instances,and__uniquesemantics__formetaclasses__thatcustomize__types (a.k.a. classes),which__well__uncover later.In__fact,a__reasonableargument__canbe__madethat__the type/classdichotomy__ofearlier__Pythonsmay__simplyhave__morphedinto__oneof__metaclass/classwhich__tradesa__straightforwarddistinction__forall__theseams__justenumerated__andmuddles__inheritanceand__thefundamental__meaningof__namesin__Pythoneverywhere__tosupport__whatin__theend__isa__veryrare__use case.As__usual,the__netmerit__ofthe__morphis__yoursto__weigh.To__be fair,some__ofthe__widespreadconfusion__thismodel__hasspawned__maystem__fromtype__itself:it__soverloaded__toeither__returna__soleargument__s type,or__generatea__newinstance__ofitself__formultiple__argumentsjust__likeother__constructorsand__equivalentto__whata__classstatement__doesto__makea__class object: type(object) #Fetch__objecttype__type(classname, superclasses, attributedict) #Make__a class/typeThe__firstof__theseroles__mighthave__beenbetter__named typeof,but__thesecond__willhave__toawait__themetaclass__previewlater__inthis__chapterand__theextended__coveragein__Chapter 40.And__Oneobject__toRule__ThemAll__Toround__outthis__topic,keep__inmind__thatbecause__topmostclasses__inheritfrom__the built-inclass__object,every__objectderives__(i.e., inherits)from__it,whether__directlyor__througha__superclassand__whetheryou__codeobject__or not: >>>class__C:pass__>>>class__D(object):pass__>>> dir(C) == dir(D)True__>>> C.__bases__, D.__bases__ ((,), (,))In__fact,the__typeclass__inheritsfrom__theobject__class,and__objectinherits__from type,even__thoughthe__twoare__differentobjects__acircular__relationshipthat__crownsthe__objectmodel__andmay__makeyour__craniumcatch__fire (toavoid__combustion,keep__inmind__thatisinstance__istrue__foreither__asubclass__relationshipor__creation source,though__thisis__basedon__inheritancethrough__thesecondary__type-classtree__for classes): >>>type__isobject__False >>> type(type), type(object) (, ) >>> isinstance(type, object), isinstance(object, type) (True, True) >>> type.__bases__, object.__bases__ ((,), ())Strange__thoughit__may seem,this__hasa__numberof__practical consequences.For__one thing,it__meansthat__wesometimes__mustbe__awareof__themethod__defaultsthat__comewith__theimplicit__(or explicit)object__root class.As__wenoted__inearlier__chapters,for__instance,the__objectclass__comeswith__a__repr____for display: >>>class__C:pass__#All__classesinherit__objectdefaults__>>>X__= C() >>> X.__repr__For__another,this__alsoallows__usto__writecode__thatcan__safelyassume__anduse__anobject__superclass.As__an example,we__canrely__onit__tobe__a call-chainanchor__insome__super built-inroles__describedahead__andcan__reroutemethod__callsto__itfrom__attribute-interceptormethods__toinvoke__higherdefault__behavior.Per__Chapter 30: object.__setattr__(self, attr, value)We__llcode__examplesof__suchrerouting__laterin__the book;for__now,let__smove__onto__somethinga__bitmore__tangibleand__ournext__topicin__thisOOP__jamboree.Advanced__AttributeTools__Alongwith__thenormal__classand__instanceattributes__weve__beenusing__so far,Python__sOOP__supportincludes__attributetools__ofnarrower__scope slots, properties, descriptors,and__more. Slots,for__example,are__anoptimization__option,and__propertiesand__descriptorsallow__classesto__augment access.None__ofthese__toolsare__required,but__asfor__mosttopics__inthis__chapter,all__arefair__gamein__Pythoncode__youmay__someday use.Most__ofthese__toolsget__extendedcoverage__inChapter__38,but__slotsget__fullcoverage__here,and__othersare__presentedin__abbreviated form. Slots:Attribute__DeclarationsFirst__off,we__venoted__theimplications__ofslots__severaltimes__inthis__partof__the book.In__short,by__assigningan__iterableof__attributename__stringsto__aspecial____slots__class__attribute,we__canenable__aclass__toboth__limitthe__setof__legalattributes__thatinstances__ofthe__classwill__haveand__optimizememory__usageand__possiblyprogram__speed.As__youll__find, though,slots__shouldbe__usedonly__inapplications__thatclearly__warrantthe__added complexity.They__willcomplicate__your code,may__complicateor__breakcode__youmay__use,and__rigidlyrequire__universaldeployment__tobe__effective.Slot__basicsTo__declare slots,assign__aniterable__(e.g., list)of__stringnames__tothe__special__slots____variableand__attributeat__thetop__levelof__aclass__statement:only__thosenames__in__slots____canbe__assignedas__instance attributes.This__doesnt__changethe__waythese__attributeswork__in general, though;like__allnames__in Python,instance__attributenames__mustalways__beassigned__beforethey__canbe__referenced,even__ifthey__relisted__in __slots__.Here__arethe__basics: >>>class__Limiter(object):__slots____= ['age', 'name', 'job'] #Slots__"declaration" >>>I__= Limiter() >>> I.age #Must__assignbefore__use AttributeError: 'Limiter'object__hasno__attribute 'age' >>> I.age = 40 #Looks__likeinstance__data >>> I.age 40 >>> I.ape = 1000 # Fails:not__in__slots____AttributeError: 'Limiter'object__hasno__attribute 'ape'This__featureis__advertisedas__botha__wayto__catchtypo__errorslike__this (assignmentsto__illegalattribute__namesnot__in__slots____aredetected__insteadof__silently assigned),as__wellas__anoptimization__mechanismthat__saves memory.Allocating__anamespace__dictionaryfor__everyinstance__objectcan__beexpensive__interms__ofmemory__ifmany__instancesare__createdand__onlya__fewattributes__are required.To__save space,instead__ofallocating__adictionary__foreach__instance,Python__reservesjust__enoughspace__ineach__instanceto__holda__valuefor__eachslot__attribute,along__withinherited__attributesin__thecommon__classto__manageslot__access.This__mightadditionally__speed execution,though__thisbenefit__mayvary__per program, platform,and__Pythonversion__(spoiler:the__speedupis__trivial today,as__well__prove ahead).You__shouldnt__normallyuse__slotsSlots__area__fairlymajor__breakwith__Pythons__coredynamic__nature,which__dictatesthat__anyname__maybe__createdby__assignment (and frankly,tend__toappeal__mostto__peoplewith__backgroundsin__draconian languages).In__fact,they__partlyimitate__C++for__efficiencyat__theexpense__offlexibility__andeven__havethe__potentialto__breaksome__programs.As__youll__see,slots__alsocome__witha__plethoraof__special-caseusage__rules.Per__Pythons__own manual,they__shouldnot__beused__exceptin__clearlywarranted__casesthey__aredifficult__todeploy__correctly,complicate__yourcode__badly,and__arebest__limitedto__veryrare__memory-criticalprograms__thatproduce__anextremely__largenumbers__of instances.In__other words,this__isyet__anotherfeature__thatshould__beused__onlyif__clearly justified. Unfortunately,slots__seemto__beshowing__upin__Pythoncode__muchmore__oftenthan__they should;their__obscurityseems__tobe__adraw__in itself.Slots__areactually__usedby__Python,unlike__type hinting,their__declarationcousin__ofChapter__6,but__theyare__similarlyparadoxical__and restrictive.As__usual,knowledge__isyour__bestally__insuch__things,so__lets__takea__deeperlook__here.Slots__andnamespace__dictionariesPotential__benefits aside,slots__cancomplicate__aclass__modeland__codethat__relieson__it substantially.In__fact,some__instanceswith__slotsmay__nothave__a__dict____attributenamespace__dictionaryat__all,and__otherswill__havedata__attributesthat__thisdictionary__doesnot__include.To__be clear,this__isa__majorincompatibility__withthe__traditionalclass__modelone__thatcan__impactany__codethat__accessesattributes__genericallyand__mayeven__causesome__tofail__altogether.For__instance,programs__thatlist__oraccess__instanceattributes__byname__stringmay__needto__usemore__storage-neutralinterfaces__than__dict____ifslots__maybe__used.Because__aninstance__sdata__mayinclude__class-levelnames__suchas__slotseither__inaddition__toor__insteadof__namespacedictionary__storageboth__attributesources__mayneed__tobe__queriedfor__completeness,and__someroles__maybe__rendered impossible.Let__ssee__whatthis__meansin__termsof__codeand__exploremore__aboutslots__alongthe__way.First__off,when__slotsare__used,instances__donot__normallyhave__anattribute__dictionary instead,Python__usesthe__classdescriptors__featureintroduced__aheadto__allocateand__managespace__reservedfor__slotattributes__inthe__instance: >>>class__C:__slots____= ['a', 'b'] #__slots____meansno____dict__by__default >>>I__= C() >>> I.a = 1 >>> I.a 1 >>> I.__dict__ AttributeError: 'C'object__hasno__attribute '__dict__'.Did__you mean: '__dir__'? However,we__canstill__fetchand__set slot-basedattributes__byname__stringusing__storage-neutraltools__suchas__getattrand__setattr (whichlook__beyondthe__instance__dict____andthus__include class-levelnames__like slots)and__listthem__withdir__(whichcollects__allinherited__namesof__anykind__throughouta__class tree): >>> getattr(I, 'a') 1 >>> setattr(I, 'b', 2) #But__getattr()and__setattr()still__work >>> I.b 2 >>> 'a'in__dir(I) #And__dir()finds__slotattributes__tooTrue__>>> 'b'in__dir(I) #Though____dict__access__willfail__True >>> I.__dict__ AttributeError: 'C'object__hasno__attribute '__dict__'.Did__you mean: '__dir__'?Also__keepin__mindthat__withoutan__attributenamespace__dictionary,it__snot__possibleto__assignnew__namesto__instancesthat__arenot__namesin__theslots__list: >>>class__D:__slots____= ['a', 'b']def____init__(self): self.d = 4 #Cannot__addnew__namesif__no__dict____>>>I__= D() AttributeError: 'D'object__hasno__attribute 'd'We__canstill__accommodateextra__attributes, though,by__including__dict____explicitlyin____slots__in__orderto__createan__attributenamespace__dictionaryin__additionto__slots: >>>class__D:__slots____= ['a', 'b', '__dict__'] #Name____dict__to__includeone__tooc__= 3 #Class__attrswork__normallydef____init__(self): self.d = 4 #d__storedin____dict__,a__isa__slot >>>I__= D() >>> I.d 4 >>> I.c 3 >>> I.a #All__instanceattrs__undefineduntil__assigned AttributeError: 'D'object__hasno__attribute 'a' >>> I.a = 1 >>> I.b = 2In__this case,both__storagemechanisms__are used.This__renders__dict____toolimited__forcode__thatwishes__totreat__slotsas__instance data,but__generictools__suchas__getattrstill__allowus__toprocess__bothstorage__formsas__asingle__setof__attributes: >>> I.__dict__ #Some__objectshave__both__dict____andslot__names {'d': 4} # getattr()can__fetcheither__typeof__attr >>> I.__slots__ ['a', 'b', '__dict__'] >>> getattr(I, 'a'), getattr(I, 'c'), getattr(I, 'd') #Fetches__all 3forms__(1, 3, 4)Because__diralso__returnsall__inherited attributes, though,it__mightbe__toobroad__insome__contexts;it__alsoincludes__class-levelmethods__andeven__allobject__defaults.Code__thatwishes__tolist__justinstance__attributes may,in__principle,still__needto__allowfor__bothstorage__forms explicitly.We__mightat__firstnaively__codethis__as follows: >>>for__attrin__list(I.__dict__) + I.__slots__: # Wrong... print(attr, '=>', getattr(I, attr))Since__eithercan__be omitted,we__maymore__correctlycode__thisas__follows,using__getattrto__allowfor__defaultsa__noblebut__nonethelessinaccurate__approach,as__thenext__sectionwill__explain: >>>for__attrin__list(getattr(I, '__dict__', [])) + getattr(I, '__slots__', []): print(attr, '=>', getattr(I, attr))d__=> 4a__=> 1 #Less__wrong...b__=> 2__dict____=> {'d': 4}Multiple____slot__lists__insuperclasses__Thepreceding__codeworks__inthis__specific case,but__in general,it__snot__entirely accurate. Specifically,this__codeaddresses__onlyslot__namesin__thelowest____slots__attribute__inheritedby__an instance,but__slotlists__mayappear__morethan__oncein__aclass__tree.That__is,a__names__absencein__thelowest____slots__list__doesnot__precludeits__existencein__ahigher____slots__.Because__slotnames__become class-level attributes,instances__acquirethe__unionof__allslot__namesanywhere__inthe__treeby__thenormal__inheritance rule: >>>class__E:__slots____= ['c', 'd'] #Superclass__hasslots__>>>class__D(E):__slots____= ['a', '__dict__'] #But__sodoes__itssubclass__>>>I__= D() #The__instancegets__theunion__ofeach__>>> dir(I) [names__omitted , 'a', 'c', 'd'] >>> I.a = 1; I.b = 2; I.c = 3 # slots: a, c, __dict__:b__>>> I.a, I.c (1, 3)But__inspectingjust__theinherited__slotslist__wont__pickup__slotsdefined__higherin__aclass__tree: >>> E.__slots__ #But____slots__not__concatenated ['c', 'd'] >>> D.__slots__ ['a', '__dict__'] >>> I.__slots__ #Instance__inherits *lowest*__slots____['a', '__dict__'] >>> I.__dict__ #And__hasits__ownattr__dict {'b': 2} >>>for__attrin__list(getattr(I, '__dict__', [])) + getattr(I, '__slots__', []): print(attr, '=>', getattr(I, attr))b__=> 2 #Other__superclassslots__missed!a__=> 1__dict____=> {'b': 2} >>> dir(I) #But__dir()includes__allslot__names [names__omitted , 'a', 'b', 'c', 'd']In__other words,in__termsof__listinginstance__attributes generically,one____slots__isn__talways__enoughthey__arepotentially__subjectto__thefull__inheritancesearch__procedure.If__multipleclasses__ina__classtree__mayhave__theirown____slots__ attributes,tools__mustdevelop__otherpolicies__forlisting__attributesas__thenext__section explains.Handling__slotsand__othervirtual__attributesgenerically__Theprior__chapterconcluded__witha__briefsummary__ofthe__slotspolicies__ofits__attributelister__toolsa__primeexample__ofwhy__genericprograms__mayneed__tocare__about slots.Such__toolsthat__attemptto__listinstance__dataattributes__genericallymust__accountfor__slotsand__perhapsother__suchvirtual__instanceattributes__likeproperties__anddescriptors__introducedahead__namesthat__similarlyreside__inclasses__butmay__provideattribute__valuesfor__instanceson__request.Slots__arethe__most data-centricof__thesebut__arerepresentative__ofa__larger category.Such__attributesrequire__inclusive approaches,special__handling,or__generalavoidance__thelatter__ofwhich__becomesunsatisfactory__assoon__asany__programmeruses__slotsin__subject code. Really, class-levelinstance__attributeslike__slotsprobably__necessitatea__redefinitionof__theterm__instancedata__aslocally__stored attributes,the__unionof__allinherited__attributes,or__somesubset__thereof.For__example,some__programsmight__classifyslot__namesas__attributesof__classesinstead__of instances;these__attributesdo__notexist__ininstance__namespace dictionaries,after__all. Alternatively,as__shown earlier,programs__canbe__moreinclusive__byrelying__ondir__tofetch__allinherited__attributenames__andgetattr__tofetch__theircorresponding__valueswithout__regardto__theirphysical__locationor__implementation.If__youmust__supportslots__asinstance__data,this__maybe__themost__robustway__to proceed: >>>class__Slotful:__slots____= ['a', 'b', '__dict__']def____init__(self, data): self.c =data__>>>I__= Slotful(3) >>> I.a, I.b = 1, 2 >>> I.a, I.b, I.c #Normal__attributefetch__(1, 2, 3) >>> I.__dict__ #Both____dict__and__slotsstorage__{'c': 3} >>> [xfor__xin__dir(I)if__not x.startswith('__')] ['a', 'b', 'c'] >>> I.__dict__['c'] #__dict____isonly__oneattr__source 3 >>> getattr(I, 'c'), getattr(I, 'a') # dir+getattris__broaderthan____dict__ (3, 1) #applies__to slots, properties,descrip__>>>for__ain__(xfor__xin__dir(I)if__not x.startswith('__')): print(a, '=>', getattr(I, a))a__1b__2c__3Under__this dir/getattr model,you__canstill__mapattributes__totheir__inheritancesources__andfilter__themmore__selectivelyby__sourceor__type,if__needed,by__scanningthe__MROas__wedid__inthe__priorchapter__s mapattrs.py (Example 31- 14).As__a bonus,such__toolsand__policiesfor__handlingslots__willpotentially__applyautomatically__toproperties__anddescriptors__too,though__theseattributes__aremore__explicitlycomputed__values,and__lessobviously__instance-relateddata__than slots.Also__keepin__mindthat__thisis__notjust__atools__issue. Class-basedinstance__attributeslike__slotsalso__impactthe__traditionalcoding__ofthe____setattr__ operator-overloadingmethod__wemet__inChapter__30.Because__slotsand__someother__attributesare__notstored__inthe__instance __dict__,and__mayeven__implyits__absence,classes__mustinstead__generallyrun__attributeassignments__byrerouting__themto__theobject__superclass.Slot__usagerules__Slotdeclarations__canappear__inmultiple__classesin__aclass__tree,but__whenthey__do,they__aresubject__toa__numberof__constraintsthat__aresomewhat__difficultto__rationalizeunless__youunderstand__theimplementation__ofslots__as class-leveldescriptors__foreach__slotname__thatare__inheritedby__theinstances__inwhich__themanaged__spaceis__reserved (again,you__llmeet__descriptorsbriefly__ahead).Here__arethe__mainconstraints__thatslots__impose:Slots__insubs__arepointless__whenabsent__in supers.If__asubclass__inheritsfrom__asuperclass__withouta____slots__,the__instance__dict____attributecreated__forthe__superclasswill__alwaysbe__accessible,making__a__slots____inthe__subclasslargely__pointless.The__subclassstill__managesits__slotsbut__doesnt__computetheir__valuesin__anyway__anddoesn__tavoid__adictionary__themain__reasonto__use slots.Slots__insupers__arepointless__whenabsent__in subs. Similarly,because__themeaning__ofa____slots__declaration__islimited__tothe__classin__whichit__appears,subclasses__willproduce__aninstance____dict__if__theydo__notdefine__a __slots__,rendering__a__slots____ina__superclasslargely__pointless.Redefinition__renderssuper__slots pointless.If__aclass__definesthe__sameslot__nameas__a superclass,its__redefinitionhides__theslot__inthe__superclassper__normal inheritance.You__canaccess__theversion__ofthe__namedefined__bythe__superclassslot__onlyby__fetchingits__descriptordirectly__fromthe__superclass.Slots__prevent class-level defaults.Because__slotsare__implementedas__class-leveldescriptors__(alongwith__per-instance space),you__cannotuse__classattributes__ofthe__samename__toprovide__defaultsas__youcan__fornormal__instance attributes:assigning__thesame__namein__theclass__overwritesthe__slot descriptor.Slots__cannotbe__combinedin__multiple inheritance.Multiple__inheritancecannot__beused__ifmore__thanone__ofthe__classesmixed__togetherhave__nonemptyslots__listseven__iftheir__slotsdefine__thesame__names.You__llget__anerror__whenrunning__theclass__thatdoes__the mixing.Empty__slotslists__allowthe__mixerto__defineslots__or not,as__desired.Slots__canimpact____dict__.As__shown earlier,__slots____precludeboth__aninstance____dict__and__assigningnames__not listed,unless____dict__is__listedexplicitly__too.Slots__similarlypreclude__a__weakref____attributeused__tosupport__instanceweak__referencescovered__brieflyin__Chapter 6,but__theseare__rareenough__to soft-pedal here.We__vealready__seenthe__lastof__thesein__action.It__seasy__todemonstrate__howthe__newrules__heretranslate__toactual__codemost__crucially,a__namespacedictionary__iscreated__whenany__classin__atree__omits slots,thereby__negatingthe__memoryoptimization__benefitbut__alsosupporting__classesthat__requirea____dict__when__mixedin__with others: >>>class__C:pass__#Bullet__1:slots__insub__butnot__super >>>class__D(C):__slots____= ['a'] #Makes__instancedict__fornonslots__>>>I__= D() #But__slotname__stillmanaged__inclass__>>> I.a = 1; I.b = 2 >>> I.__dict__ {'b': 2} >>> D.__dict__.keys() dict_keys([ '__slots__', 'a', ]) >>>class__C:__slots____= ['a'] #Bullet__2:slots__insuper__butnot__sub >>>class__D(C):pass__#Makes__instancedict__fornonslots__>>>I__= D() #But__slotname__stillmanaged__inclass__>>> I.a = 1; I.b = 2 >>> I.__dict__ {'b': 2} >>> C.__dict__.keys() dict_keys([ '__slots__', 'a', ]) >>>class__C:__slots____= ['a'] #Bullet__3:only__lowestslot__accessible >>>class__D(C):__slots____= ['a'] #Superclass__slot 'a'is__pointless >>>class__C:__slots____= ['a'];a__= 99 #Bullet__4:no__class-leveldefaults__ValueError: 'a'in____slots__conflicts__withclass__variable >>>class__C:__slots____= ['a'] #Bullet__5:only__onenonempty__inmixins__>>>class__D:__slots____= ['a'] #Use__emptyslots__oromit__inall__butone__>>>class__E(C, D):pass__TypeError:multiple__baseshave__instance lay-outconflict__Inother__words,besides__their program-breaking potential,slots__essentiallyrequire__bothuniversal__andcareful__deploymentto__beeffective__becauseslots__donot__computevalues__dynamicallylike__properties (comingup__inthe__next section),they__arelargely__pointlessunless__eachclass__ina__treeuses__themand__iscautious__todefine__onlynew__slotnames__notdefined__byother__classes.It__san__all-or-nothingfeature__anunfortunate__propertyshared__bythe__supercall__discussed ahead: >>>class__C:__slots____= ['a'] #Assumes__universal use,differing__names >>>class__D(C):__slots____= ['b'] >>>I__= D() #And__maybreak__codeand__toolsyou__use >>> I.a = 1; I.b = 2 >>> I.__dict__ AttributeError: 'D'object__hasno__attribute '__dict__'.Did__you mean: '__dir__'? >>> C.__dict__.keys(), D.__dict__.keys() (dict_keys([ '__slots__', 'a', ]), dict_keys([ '__slots__', 'b', ]))Such__rulesand__othersomitted__herefor__spaceare__partof__thereason__slotsare__notwidely__usedand__arenot__generallyrecommended__exceptin__pathologicalcases__wheretheir__spacereduction__is significant.Even__then,their__potentialto__complicateor__breakcode__shouldbe__amplecause__tocarefully__considerthe__trade- offs.Not__onlymust__theybe__spreadalmost__neuroticallythroughout__a framework,but__theymay__alsobreak__toolsyou__rely on.Example__impactsof__slots:ListTree__andmapattrs__Asa__morerealistic__exampleof__slots effects,due__tothe__firstbullet__inthe__prior section,Chapter__31s__ListTreeclass__(Example 31-13)does__notfail__whenmixed__intoa__classthat__defines __slots__,even__thoughit__scansinstance__namespacedictionaries__withoutverifying__their presence.This__listerclass__sown__lackof__slotsis__enoughto__ensurethat__theinstance__willstill__havea____dict__and__hencenot__triggeran__exceptionwhen__fetchedor__indexed.For__example,both__ofthe__following single-inheritancetrees__displaywithout__errorthe__secondalso__allowsnames__notin__theslots__listto__beassigned__asinstances__attributes,including__anyrequired__bythe__superclass:class__C(ListTree):pass__I = C() # OK:no____slots__used__print(I)class__C(ListTree):__slots____= ['a', 'b'] # OK:superclass__produces__dict____I = C() I.c = 3 print(I) #Displays__cat__I,a__andb__atC__Thefollowing__multiple-inheritanceclasses__displaycorrectly__aswell__anynonslot__classlike__ListTreegenerates__aninstance____dict__and__canthus__safelyassume__its presence.Although__itrenders__subclassslots__pointless,this__isa__positiveside__effectfor__toolclasses__likeListTree__andits__Chapter 28 predecessor:class__A:__slots____= ['a'] #Both__OKby__bullet 1above__class B(A, ListTree):pass__print(B())class__A:__slots____= ['a']class__B(A, ListTree):__slots____= ['b'] #Displays__bat__B,a__atA__print(B())In__general, though,tools__mayneed__tocatch__exceptionswhen____dict__is__absentor__usea__hasattror__getattrto__testor__providedefaults__ifslot__usagemay__precludean__instancenamespace__dictionary.For__instance,Chapter__31s__mapattrs.pymodule__(Example 31-14)must__checkfor____dict__presence__explicitlybecause__itis__nota__classmixed__into others,and__socannot__assumethis__attribute.Like__ListTree,this__examplealso__associatesslots__withtheir__classes.Run__theseexamples__onyour__ownfor__more info.Slots__impactsmay__be onerous,but__knowledgeis__yourbest__defense.What__aboutslots__speed? Finally,while__slotsprimarily__optimizememory__use,their__speedimpact__isless__clear-cut.Example__32-4codes__asimple__testscript__usingthe__timeittechniques__westudied__inChapter__21.For__boththe__slotsand__nonslots (instance dictionary)storage__models,it__makes 1,000 instances,assigns__andfetches__4attributes__on each,and__repeats 1,000times__forboth__modelstaking__thebest__of 5runs__thateach__exercisea__totalof__8Mattribute__operations.Example__32-4. slots-test.pyimport__timeitbase__= """Is__= []for__iin__range(1000):I__= C() I.a = 1; I.b = 2; I.c = 3; I.d = 4t__= I.a + I.b + I.c + I.d Is.append(I) """stmt__= """class__C:__slots____= ['a', 'b', 'c', 'd'] """ +base__print('Slots =>', end=' ') print(min(timeit.repeat(stmt, number=1000, repeat=5)))stmt__= """class__C:pass__""" +base__print('Nonslots=>', end=' ') print(min(timeit.repeat(stmt, number=1000, repeat=5)))At__leastfor__this code,on__themacOS__test host,and__usingCPython__3.12,the__besttimes__implythat__slotsare__onlyslightly__quicker,though__thissays__littleabout__memoryspace__andis__proneto__changearbitrarily__inthe__future (PyPy 7.3struggled__onthis__testwith__times 10xslower__than CPython,presumably__dueto__dynamicclass__creation,but__relatively similar): $ python3 slots-test.pySlots__=> 0.17895982996560633 Nonslots=> 0.18887511501088738For__moreon__slotsin__general,see__thePython__standardmanual__set. Also,watch__forthe__Privatedecorator__casestudy__ofChapter__39an__examplethat__naturallyallows__forattributes__basedon__both__slots____and__dict____storage,by__usingdelegation__and storage-neutralaccessor__toolslike__getattr. Properties:Attribute__AccessorsOur__next attribute-relatedtopic__isproperties__amechanism__thatprovides__anotherway__forclasses__todefine__methodscalled__automaticallyfor__accessor__assignmentto__instance attributes.This__featureis__similarto__gettersand__settersin__languageslike__Javaand__C#,but__inPython__isgenerally__bestused__sparinglyas__away__toadd__accessorsto__attributesafter__thefact__asneeds__evolveand__warrant.Where__needed, though,properties__allowattribute__valuesto__becomputed__dynamicallywithout__requiringmethod__callsat__thepoint__of access.Though__propertiescannot__supportgeneric__attributerouting__goals,at__leastfor__specific attributes,they__arean__alternativeto__sometraditional__usesof__the__getattr____and__setattr____overloadingmethods__wefirst__studiedin__Chapter 30.Properties__canhave__asimilar__effectto__thesetwo__methods but,by__contrast,incur__anextra__methodcall__onlyfor__accessesto__namesthat__requiredynamic__computationother__nonpropertynames__areaccessed__normallywith__noextra__calls.Although____getattr__is__invokedonly__forundefined__names,the____setattr__method__isinstead__calledfor__assignmentto__every attribute.Properties__andslots__are related, too,but__servedifferent__goals.Both__implementinstance__attributesthat__arenot__physicallystored__ininstance__namespacedictionaries__asort__ofvirtual__attributeand__bothare__basedon__thenotion__of class-levelattribute__descriptors.In__contrast,slots__manageinstance__storage,while__propertiesintercept__accessand__computevalues__arbitrarily.Because__theirunderlying__descriptorimplementation__toolis__tooadvanced__forus__tocover__here,properties__anddescriptors__bothget__fulltreatment__inChapter__38.Property__basicsAs__abrief__introduction, though,a__propertyis__atype__ofobject__assignedto__aclass__attribute name.You__cangenerate__aproperty__bycalling__theproperty__built-in function,passing__inup__tothree__accessormethods__handlersfor__get, set,and__deleteoperations__aswell__asan__optionaldocstring__forthe__property.If__anyargument__ispassed__asNone__or omitted,that__operationis__not supported.The__resultingproperty__objectis__typicallyassigned__toa__nameat__thetop__levelof__aclass__statementas__aclass__attribute (e.g., name=property( )),and__aspecial__@decorator__syntaxyou__llmeet__lateris__availableto__automatethis__step.When__thus assigned,later__accessesto__theclass__propertyname__itselfas__anobject__attribute (e.g., obj.name)are__automaticallyrouted__toone__ofthe__accessormethods__passedinto__theproperty__call.For__example,we__veseen__howthe____getattr__ operator-overloadingmethod__allowsclasses__tointercept__undefinedattribute__references: >>>class__WithOperators:def____getattr__(self, name): #On__undefinedattr__ifname__== 'age':return__40 else:raise__AttributeError(name) >>>x__= WithOperators() >>> x.age #Runs____getattr__ 40 >>> x.name #Runs____getattr__ AttributeError:name__Hereis__thesame__example,coded__withproperties__instead: >>>class__WithProperties:def__getage(self):return__40age__= property(getage) # (get?, set?, del?, docs?),or__@ >>>x__= WithProperties() >>> x.age #Runs__getage 40 >>> x.name #Normal__fetch AttributeError: 'WithProperties'object__hasno__attribute 'name'For__somecoding__tasks,properties__canbe__lesscomplex__andquicker__torun__thanthe__traditional techniques.For__example,when__weadd__attributeassignment__support,properties__becomemore__attractivethere__sless__codeto__type,and__noextra__methodcalls__areincurred__forassignments__toattributes__wedon__twish__tomanage__orcompute__dynamically: >>>class__WithProperties:def__getage(self): print('get age')return__40def__setage(self, value): print('set age:', value) self._age =value__age = property(getage, setage) >>>x__= WithProperties() >>> x.age #Runs__getageget__age 40 >>> x.age = 42 #Runs__setageset__age: 42 >>> x._age #Normal__fetch:no__getagecall__42 >>> x.job = 'hacker' #Normal__assign:no__setagecall__>>> x.job #Normal__fetch:no__getagecall__'hacker'The__equivalentclass__basedon__operatoroverloading__incursextra__methodcalls__forassignments__toattributes__notbeing__managedand__needsto__routeattribute__assignmentsthrough__theattribute__dictionaryto__avoidloops__(orto__theobject__superclasss____setattr__to__bettersupport__virtualattributes__suchas__slotsand__propertiescoded__inother__classes): >>>class__WithOperators:def____getattr__(self, name): #On__undefinedattr__ifname__== 'age': print('get age')return__40 else:raise__AttributeError(name)def____setattr__(self, name, value): #On__allassignments__print('set:', name, value)if__name == 'age': self.__dict__['_age'] =value__#Or__object.__setattr__(self, ...) else: self.__dict__[name] =value__>>>x__= WithOperators() >>> x.age #Runs____getattr__get__age 40 >>> x.age = 41 #Runs____setattr__ set:age__41 >>> x._age # Defined:no____getattr__call__41 >>> x.job = 'coder' #Runs____setattr__again__set:job__coder >>> x.job # Defined:no____getattr__call__'coder'Properties__seemlike__awin__forthis__simple example. However,some__applicationsof____getattr__and____setattr__still__requiremore__dynamicor__genericinterfaces__thanproperties__directly provide.For__example,the__setof__attributesto__bemanaged__mightbe__unknownwhen__aclass__iscoded__andmay__noteven__existin__atangible__form (e.g.,when__delegatingarbitrary__attributereferences__toa__wrappedand__embeddedobject__generically).In__such contexts,a__genericattribute__handlerlike____getattr__with__a passed-inattribute__namemay__be preferable.Because__suchgeneric__handlerscan__alsosupport__simpler cases,properties__maybe__aredundant__extensionalbeit__onethat__mayavoid__extracalls__onassignments__andone__thatsome__programmersmay__preferwhen__applicable.For__moredetails__onboth__options,tune__into__Chapter 38.As__youll__see there,it__salso__possibleto__codeproperties__usingthe__@symbol__functiondecorator__syntaxa__topicintroduced__inbrief__laterin__thischapter__andan__equivalentand__automaticalternative__tomanual__assignmentin__theclass__scope:class__WithProperties: @property #Coding__propertieswith__decorators:ahead__def age(self): #On__instance.age @age.setterdef__age(self, value): #On__instance.age =value__Tomake__senseof__thisdecorator__syntax, though,we__mustmove__ahead.__getattribute____and Descriptors:Attribute__ImplementationsTo__completeour__attribute-tools collection,the____getattribute__ operator-overloading__methodintercepts__allattribute__references,not__justundefined__references.This__makesit__morepotent__thanits____getattr__cousin__weused__inthe__prior section,but__alsotrickier__touse__its__proneto__loopsmuch__like __setattr__,but__indifferent__ways.For__morespecialized__attributeinterception__goals,in__additionto__propertiesand__operator-overloading methods,Python__providesattribute__descriptorsclasses__with__get____and__set____methods,assigned__toclass__attributesand__inheritedby__instances,that__interceptread__andwrite__accessesto__specific attributes.As__a preview,here__sone__ofthe__simplestdescriptors__youre__likelyto__encounter: >>>class__AgeDesc:def____get__(self, instance, owner):return__40def____set__(self, instance, value): instance._age =value__>>>class__WithDescriptors:age__= AgeDesc() #Assign__descriptorinstance__>>>x__= WithDescriptors() >>> x.age #Runs__AgeDesc.__get__ 40 >>> x.age = 42 #Runs__AgeDesc.__set__ >>> x._age #Normal__fetch:no__AgeDesccall__42Descriptors__haveaccess__to state-informationattributes__ininstances__ofthemselves__aswell__astheir__clientclass__and are,in__a sense,a__moregeneral__formof__properties.In__fact,properties__area__simplifiedway__todefine__aspecific__typeof__descriptorone__thatruns__functionson__access.Descriptors__arealso__usedto__implementthe__slotsfeature__wemet__earlier,among__otherPython__tools,and__areafforded__specialcases__inattribute__inheritancealluded__toearlier__inthis__chapter.Because____getattribute__and__descriptorsare__toosubstantial__topresent__here,we__lldefer__therest__oftheir__coverage,as__wellas__muchmore__on properties,to__Chapter 38.We__llalso__employthem__inexamples__inChapter__39and__studyhow__theyfactor__intoinheritance__inChapter__40. Here,the__topicstour__ismoving__on.Static__andClass__MethodsBeyond__theusual__methodswe__vebeen__usingso__far,classes__candefine__twokinds__ofmethods__calledwithout__an instance:static__methodswork__roughlylike__simple instance-lessfunctions__insidea__classno__matterhow__theyre__called,and__classmethods__arepassed__aclass__insteadof__an instance.Both__aresimilar__totools__inother__languages (e.g., C++static__methods).The__priorchapter__sbound__methodcoverage__notedthese__briefly,but__well__finishthe__story here.To__enablethese__specialmethod__modes,you__call built-infunctions__namedstaticmethod__andclassmethod__withinthe__classor__invokethem__withthe__special @namedecoration__syntaxyou__llmeet__laterin__this chapter.The__classmethodcall__isrequired__toenable__its mode;staticmethod__isnot__requiredfor__instance-lessmethods__calledonly__througha__classname__butis__requiredif__suchmethods__arecalled__through instances.Why__theSpecial__Methods?As__weve__seen,a__classs__methodis__normallypassed__aninstance__objectin__itsfirst__argumentto__serveas__theimplied__subjectof__themethod__callthat__sthe__objectin__object-oriented programming.Though__muchless__common,there__aretwo__formalways__totemper__this model.Before__weget__tothe__syntax,let__sclarify__whythis__mightmatter__to you. Sometimes,programs__needto__processdata__associatedwith__classesinstead__of instances.Consider__keepingtrack__ofthe__numberof__instancescreated__froma__classor__maintaininga__listof__allof__aclass__sinstances__thatare__currentlyin__use.This__typeof__informationand__itsprocessing__areassociated__withthe__classrather__thanits__instances.That__is,the__informationis__usuallystored__onthe__classitself__andprocessed__apartfrom__any instance.For__such tasks,simple__functionscoded__outsidea__classmight__sufficebecause__theycan__accessclass__attributesthrough__theclass__name,they__haveaccess__toclass__data,and__neverrequire__accessto__an instance. However,to__betterassociate__suchcode__witha__classand__toallow__suchprocessing__tobe__customizedwith__inheritanceas__usual,it__wouldbe__betterto__codethese__typesof__functionsinside__theclass__itself.To__makethis__work,we__needmethods__ina__classthat__arenot__passed,and__donot__expect,a__selfinstance__argument.Per__theprior__chapter,methods__accessedthrough__theclass__areplain__functionsthat__meetsome__ofthis__needbut__failif__accessedthrough__an instance:the__resultingbound__methodpasses__aninstance__in calls,even__ifthe__plainfunction__doesnt__expect one.To__address,Python__providesstatic__methodsplain__functionsthat__arenested__ina__classand__neverexpect__norreceive__anautomatic__self argument,regardless__ofhow__theyare__called.They__reoptional__formethods__onlyever__accessedthrough__classesbut__neededfor__accessthrough__instances.Although__lesscommonly__used,Python__alsosupports__classmethods__methodsof__aclass__thatare__passeda__classobject__intheir__firstargument__insteadof__an instance,regardless__ofwhether__theyare__calledthrough__aninstance__ora__class.Such__methodscan__accessclass__datathrough__theirclass__argumentwhat__weve__calledself__thusfar__evenif__calledthrough__an instance.Normal__methods,sometimes__calledinstance__methods,still__receivea__subjectinstance__when called;static__andclass__methodsdo__not. Plain-FunctionMethods__Todemo__thepreceding__ideas,let__ssuppose__thatwe__wantto__useclass__attributesto__counthow__manyinstances__aregenerated__froma__class.Example__32-5, hack1.py,makes__afirst__attemptits__classhas__acounter__storedas__aclass__attribute,a__constructorthat__bumpsup__thecounter__byone__eachtime__anew__instanceis__created,and__amethod__thatdisplays__thecounter__s value. Remember,class__attributesare__storedjust__onceon__aclass__andshared__byall__instances;storing__thecounter__thisway__ensuresthat__iteffectively__spansall__instances.Example__32-5. hack1.pyclass__Hack:numInstances__= 0def____init__(self): Hack.numInstances += 1def__printNumInstances(): print('Numberof__instances created:', Hack.numInstances)The__printNumInstancesmethod__isdesigned__toprocess__class data,not__instancedata__its__aboutall__the instances,not__anyone__in particular.Because__of that,we__wantto__beable__tocall__itwithout__havingto__passan__instance. Indeed,we__dont__wantto__makean__instanceto__fetchthe__numberof__instancesbecause__thiswould__changethe__numberof__instanceswe__retrying__to fetch!In__other words,we__wanta__self-lessstatic__method.Whether__thiscode__sprintNumInstances__worksor__not, though,depends__onwhich__wayyou__callthe__methodthrough__theclass__orthrough__an instance.Calls__to self-lessmethods__madethrough__classeswork__becausethey__produceplain__functions,but__callsfrom__instancesproduce__boundmethods__and fail: $ python3 >>>from__hack1import__Hack >>> a, b,c__= Hack(), Hack(), Hack() #Make__threeinstances__>>> Hack.printNumInstances() #Okay__tocall__frominstance__only!Number__ofinstances__created: 3 >>> a.printNumInstances() TypeError: Hack.printNumInstances()takes__0positional__argumentsbut__1was__givenCalls__to instance-lessmethods__likeprintNumInstances__madethrough__theclass__work,but__callsmade__throughan__instancefail__becausean__instanceis__automaticallypassed__toa__methodthat__doesnot__havean__argumentto__receive it.If__youre__ableto__stickwith__calling self-lessmethods__throughclasses__only,you__alreadyhave__astatic__method. However,to__allow self-lessmethods__tobe__calledthrough__instances,you__needto__eitheradopt__otherdesigns__ormark__suchmethods__as special.Let__slook__atboth__optionsin__turn.Static__MethodAlternatives__Shortof__markinga__self-lessmethod__as special,you__cansometimes__achievesimilar__resultswith__differentcoding__structures.For__example,if__youjust__wantto__callfunctions__thataccess__classmembers__withoutan__instance,perhaps__thesimplest__ideais__touse__normalfunctions__outsidethe__class,not__class methods.This__way,an__instanceisn__texpected__inthe__call.The__mutationin__Example 32-6 illustrates.Example__32-6. hack2.pydef__printNumInstances(): print('Numberof__instances created:', Hack.numInstances)class__Hack:numInstances__= 0def____init__(self): Hack.numInstances += 1Because__theclass__nameis__accessibleto__thesimple__functionas__aglobal__variable,this__works fine. Also,note__thatthe__nameof__thefunction__becomes global,but__onlyto__thissingle__module;it__willnot__clashwith__namesin__other files: >>>import__hack2as__hack >>>a__= hack.Hack() >>>b__= hack.Hack() >>>c__= hack.Hack() >>> hack.printNumInstances() #But__functionmay__betoo__farremoved__Numberof__instances created: 3 #And__cannotbe__changedvia__inheritance >>> hack.Hack.numInstances 3Prior__tostatic__methodsin__Python,this__structurewas__thegeneral__prescription.Because__Pythonalready__providesmodules__asa__namespace-partitioning tool,one__couldargue__thatthere__snot__typicallyany__needto__packagefunctions__inclasses__unlessthey__implementobject__behavior.Simple__functionswithin__moduleslike__theone__heredo__muchof__what instance-lessclass__methodscould__andare__alreadyassociated__withthe__classbecause__theylive__inthe__same module.This__approach, though,may__be subpar.For__one thing,it__addsto__thisfile__sscope__anextra__namethat__isused__onlyfor__processinga__single class.For__another,the__functionis__notdirectly__associatedwith__theclass__by structure;in__fact,its__defcould__behundreds__oflines__away. Worse,simple__functionslike__thiscannot__becustomized__byinheritance__sincethey__liveoutside__aclass__s namespace:subclasses__cannotdirectly__replaceor__extendsuch__afunction__byredefining__it.We__mightalso__tryto__makethis__examplework__bysimply__usinga__normalmethod__andalways__callingit__throughan__instance,as__usual. Unfortunately,such__anapproach__iscompletely__unworkableif__wedon__thave__aninstance__available,and__makingan__instancechanges__theclass__data,as__noted earlier.A__bettersolution__wouldbe__tosomehow__marka__methodinside__aclass__asnever__requiringan__instance.The__nextsection__shows how.Using__Staticand__ClassMethods__Todesignate__a self-lessmethod__thatmay__becalled__througheither__theclass__orits__instances,classes__cansimply__callthe__built-infunctions__staticmethodand__classmethod.Both__marka__functionobject__asspecial__requiringno__instancefor__theformer__andrequiring__aclass__argumentfor__the latter.Example__32-7shows__how.Example__32-7. allmethods.pyclass__Methods:def__imeth(self, x): #Instance__method:passed__aself__print([self, x]) #Always__expectsa__selfinstance__def smeth(x): #Static__method:no__instancepassed__print([x]) #Also__aplain__functionfrom__theclass__def cmeth(cls, x): #Class__method:gets__class,not__instance print([cls, x]) #Always__expectsa__class,not__instancesmeth__= staticmethod(smeth) #Make__smetha__staticmethod__(oruse__@: ahead)cmeth__= classmethod(cmeth) #Make__cmetha__classmethod__(oruse__@: ahead)Notice__howthe__lasttwo__assignmentsin__thiscode__simplyreassign__(a.k.a. rebind)the__methodnames__smethand__cmeth.Attributes__arecreated__andchanged__byany__assignmentin__aclass__statement,so__thesefinal__assignmentssimply__overwritethe__assignmentsmade__earlierby__the defs.As__youll__seein__afew__moments,the__special @decorator__syntaxworks__hereas__analternative__tothis__justas__itdoes__forproperties__butmakes__littlesense__unlessyou__firstunderstand__theassignment__formhere__thatit__automates. Technically,Python__supportsthree__kindsof__class-relatedmethods__withdiffering__argument protocols:Instance__methods,passed__aself__instanceobject__(the default)Static__methods,passed__noextra__instanceobject__(via staticmethod)Class__methods,passed__aclass__object (via classmethod,and__inherentin__metaclasses) Moreover,simple__functionsin__aclass__alsoserve__therole__ofstatic__methodswithout__requiringany__extraprotocol__whencalled__througha__classobject__only.The__allmethods.pymodule__illustratesall__threemethod__types,so__lets__expandon__thesein__turn.Instance__methodsare__thenormal__anddefault__casethat__weve__usedin__thisbook__so far.An__instancemethod__mustalways__becalled__withan__instance object.When__youcall__itthrough__an instance,Python__passesthe__instanceto__thefirst__(leftmost)argument__automatically;when__youcall__itthrough__a class,you__mustpass__alongthe__instance manually: >>>from__allmethodsimport__Methods #Normal__instancemethods__>>>obj__= Methods() #Callable__throughinstance__orclass__>>> obj.imeth(1) #Becomes__imeth(obj, 1) [, 1] >>> Methods.imeth(obj, 2) [, 2]Static__methods,by__contrast,are__calledwithout__aninstance__argument.Unlike__simplefunctions__outsidea__class,their__namesare__localto__thescopes__ofthe__classesin__whichthey__are defined,and__theymay__belooked__upby__inheritance. Instance-less__functionscan__becalled__througha__class normally,but__usingthe__staticmethod built-inallows__suchmethods__toalso__becalled__throughan__instance.That__is,the__firstof__thefollowing__workswithout__thestaticmethod__inthe__classbut__thesecond__does not: >>> Methods.smeth(3) #Static__method:call__throughclass__[3] #No__instancepassed__orexpected__>>> obj.smeth(4) #Static__method:call__throughinstance__[4] #Instance__notpassed__requiresstaticmethod__Classmethods__are similar,but__Pythonautomatically__passesthe__class (notan__instance)to__aclass__methods__first (leftmost) argument,whether__itis__calledthrough__aclass__oran__instance: >>> Methods.cmeth(5) #Class__method:call__throughclass__[, 5] #Becomes__cmeth(Methods, 5) >>> obj.cmeth(6) #Class__method:call__throughinstance__[, 6] #Becomes__cmeth(Methods, 6)In__Chapter 40,you__llalso__findthat__metaclassmethods__anadvanced__andtechnically__distinctmethod__typeused__inthe__secondaryclass__treesof__typesbehave__similarlyto__theexplicitly__declaredclass__methodswe__reexploring__here.Counting__Instanceswith__StaticMethods__Now,given__these built-ins,Example__32-8codes__thestatic__methodequivalent__ofthis__sections__instance-countingexample__itmarks__themethod__as special,so__itwill__neverbe__passedan__instance automatically.Example__32-8. hack_static.pyclass__Hack:numInstances__= 0 #Use__staticmethod__forclass__datadef____init__(self): Hack.numInstances += 1def__printNumInstances(): print('Numberof__instances:', Hack.numInstances)printNumInstances__= staticmethod(printNumInstances)Using__thestatic__method built-in,our__codenow__allowsthe__self-lessmethod__tobe__calledthrough__theclass__orany__instanceof__it: >>>from__hack_staticimport__Hack >>> a, b,c__= Hack(), Hack(), Hack() >>> Hack.printNumInstances() #Call__assimple__functionNumber__of instances: 3 >>> a.printNumInstances() #Instance__argumentnot__passedNumber__of instances: 3Compared__tosimply__movingprintNumInstances__outsidethe__class,as__prescribed earlier,this__versionrequires__anextra__staticmethodcall__(oran__@line__youll__meet ahead). However,it__alsolocalizes__thefunction__namein__theclass__scope (soit__wont__clashwith__othernames__inthe__module);moves__thefunction__codecloser__towhere__itis__used (insidethe__class statement);and__allowssubclasses__tocustomize__thestatic__methodwith__inheritancea__moreconvenient__andpowerful__approachthan__importingfunctions__fromthe__filesin__whichsuperclasses__are coded.The__followingsubclass__illustrates (thiscontinues__theprior__session,so__thecount__isalready__3at__the start): >>>class__Sub(Hack):def__printNumInstances(): #Override__astatic__method print('Extra stuff...') #But__callback__tooriginal__Hack.printNumInstances()printNumInstances__= staticmethod(printNumInstances) >>> a,b__= Sub(), Sub() >>> a.printNumInstances() #Call__fromsubclass__instanceExtra__stuff...Number__of instances: 5 >>> Sub.printNumInstances() #Call__fromsubclass__itselfExtra__stuff...Number__of instances: 5 >>> Hack.printNumInstances() #Call__originalversion__Numberof__instances: 5 Moreover,classes__caninherit__thestatic__methodwithout__redefiningit__itis__runwithout__an instance,regardless__ofwhere__itis__definedin__aclass__tree: >>>class__Other(Hack):pass__#Inherit__staticmethod__verbatim >>>c__= Other() >>> c.printNumInstances()Number__of instances: 6Notice__howthis__alsobumps__upthe__superclasss__instancecounter__becauseits__constructoris__inheritedand__runa__behaviorthat__beginsto__encroachon__thenext__sections__subject.Counting__Instanceswith__ClassMethods__Interestingly,a__classmethod__cando__similarwork__hereExample__32-9has__thesame__behavioras__thestatic__methodversion__listed earlier,but__ituses__aclass__methodthat__receivesthe__instances__classin__itsfirst__argument.Rather__thanhardcoding__theclass__name,the__classmethod__usesthe__automaticallypassed__classobject__generically.Example__32-9. hack_class.pyclass__Hack:numInstances__= 0 #Use__classmethod__insteadof__staticdef____init__(self): Hack.numInstances += 1def__printNumInstances(cls): print('Numberof__instances:', cls.numInstances)printNumInstances__= classmethod(printNumInstances)This__classis__usedin__thesame__wayas__theprior__versions,but__itsprintNumInstances__methodreceives__theHack__class,not__the instance,when__calledfrom__eitherthe__classor__an instance: >>>from__hack_classimport__Hack >>> a,b__= Hack(), Hack() >>> a.printNumInstances() #Passes__classto__firstargument__Numberof__instances: 2 >>> Hack.printNumInstances() #Also__passesclass__tofirst__argumentNumber__of instances: 2When__usingclass__methods, though,keep__inmind__thatthey__receivethe__mostspecific__(i.e., lowest)class__ofthe__calls__subject.This__hassome__subtleimplications__whentrying__toupdate__classdata__throughthe__passed-in class.To__demo,Example__32-10subclasses__tocustomize__thesame__waywe__didfor__staticmethods__inthe__prior section,and__augments Hack.printNumInstancesto__alsotrace__itscls__argument.Example__32-10. hack_class2.pyclass__Hack:numInstances__= 0 #Trace__classpassed__indef____init__(self): Hack.numInstances += 1def__printNumInstances(cls): print('Numberof__instances:', cls.numInstances, cls)printNumInstances__= classmethod(printNumInstances)class__Sub(Hack):def__printNumInstances(cls): #Override__aclass__method print('Extra stuff...', cls) #But__callback__tooriginal__Hack.printNumInstances()printNumInstances__= classmethod(printNumInstances)class__Other(Hack):pass__#Inherit__classmethod__verbatimRunning__thisin__aREPL__revealsthat__thelowest__classis__passedin__whenevera__classmethod__isrun__evenfor__subclassesthat__haveno__classmethods__oftheir__own: >>>from__hack_class2import__Hack, Sub,Other__>>>x__= Sub() >>>y__= Hack() >>> x.printNumInstances() #Call__fromsubclass__instanceExtra__stuff...Number__of instances: 2 >>> Sub.printNumInstances() #Call__fromsubclass__itselfExtra__stuff...Number__of instances: 2 >>> y.printNumInstances() #Call__fromsuperclass__instanceNumber__of instances: 2In__thefirst__call here,a__classmethod__callis__madethrough__aninstance__ofthe__Sub subclass,and__Pythonpasses__thelowest__class, Sub,to__theclass__method.All__iswell__inthis__casesince__Subs__redefinitionof__themethod__callsthe__Hacksuperclass__sversion__explicitly,the__superclassmethod__inHack__receivesits__ownclass__inits__first argument.But__watchwhat__happensfor__anobject__thatinherits__theclass__method verbatim: >>>z__= Other() #Call__fromlower__sub'sinstance__>>> z.printNumInstances()Number__of instances: 3This__lastcall__herepasses__Otherto__Hacks__class method.This__worksin__thisexample__becausefetching__thecounter__findsit__inHack__byclass__inheritance.If__thismethod__triedto__assignto__thepassed__classs__data, though,it__wouldupdate__Other,not__Hack!In__thisspecific__case,Hack__isprobably__betteroff__hardcodingits__ownclass__nameto__updateits__dataif__itmeans__tocount__instancesof__allits__subclasses, too,rather__thanrelying__onthe__passed-inclass__argument.Counting__instancesper__classwith__classmethods__In fact,because__classmethods__alwaysreceive__thelowest__classin__aninstance__s tree:Static__methodsand__explicitclass__namesmay__bea__bettersolution__forprocessing__datalocal__toa__class.Class__methodsmay__bebetter__suitedto__processingdata__thatmay__differfor__eachclass__ina__hierarchy.Code__thatneeds__tomanage__per-classinstance__counters,for__example,might__bebest__offleveraging__class methods.To__illustrate,the__top-levelsuperclass__inExample__32-11uses__aclass__methodto__managestate__informationthat__variesfor__andis__storedon__eachclass__inthe__treesimilar__inspirit__tothe__wayinstance__methodsmanage__stateinformation__thatvaries__perclass__instance.Example__32-11. hack_class3.pyclass__Hack:numInstances__= 0def__count(cls): # Per-classinstance__counters cls.numInstances += 1 #cls__islowest__classabove__instancedef____init__(self): self.count() #Passes__self.__class__to__countcount__= classmethod(count)class__Sub(Hack):numInstances__= 0def____init__(self): #Redefines____init__ (to demo) Hack.__init__(self)class__Other(Hack): #Inherits____init__numInstances__= 0When__run,the__Hackclass__keepstrack__ofeach__ofits__subclasses instances,using__acounter__oneach__subclass: >>>from__hack_class3import__Hack, Sub,Other__>>>x__= Hack() >>> y1, y2 = Sub(), Sub() >>> z1, z2, z3 = Other(), Other(), Other() >>> x.numInstances, y1.numInstances, z1.numInstances # Per-class data! (1, 2, 3) >>> Hack.numInstances, Sub.numInstances, Other.numInstances (1, 2, 3)Static__andclass__methodshave__additionaladvanced__roles,which__wewill__skip here;see__otherresources__formore__use cases.In__laterPython__versions, though,the__staticand__classmethod__designationsbecame__evensimpler__withthe__adventof__functiondecoration__syntaxa__wayto__applyone__functionto__anotherthat__hasroles__wellbeyond__thestatic__methoduse__casethat__wasone__ofits__initial motivations.This__syntaxalso__allowsus__toaugment__classesto__initializedata__likethe__numInstancescounter__inthe__last example,for__instance.The__nextsection__explains how.NOTE__Themethods__finale:For__apostscript__onPython__smethod__types,be__sureto__watchfor__coverageof__metaclassmethods__inChapter__40because__theseare__designedto__processa__classthat__isan__instanceof__a metaclass,they__turnout__tobe__verysimilar__tothe__classmethods__definedhere__butrequire__noclassmethod__declaration,and__applyonly__tothe__shadowymetaclass__realmpreviewed__next.Decorators__andMetaclasses__Becausethe__staticmethodand__classmethodcall__techniquedescribed__inthe__priorsection__initiallyseemed__obscureto__some observers,a__devicewas__eventuallyadded__tomake__theoperation__simpler.Python__decoratorssimilar__tothe__notionand__syntaxof__annotationsin__Javaboth__addressthis__specificneed__andprovide__ageneral__toolfor__addinglogic__thatmanages__functionsand__classesor__latercalls__to them.This__iscalled__a decoration,but__inmore__concreteterms__isreally__justa__wayto__runextra__processingsteps__atfunction__andclass__definitiontime__withexplicit__syntax.It__comesin__two flavors:Function__decorators:The__initial entry,augment__functiondefinitions__atdef__statements.They__specifyoperation__modesfor__bothsimple__functionsand__classesmethods__bywrapping__themin__anextra__layerof__logicimplemented__asanother__function.That__functionis__oftencalled__a metafunction,though__thisis__just terminology.Class__decorators:A__later extension,augment__classdefinitions__atclass__statements.They__wrapclasses__ina__similar way,adding__supportfor__managementof__wholeobjects__andtheir__interfacesinstead__ofa__single function.We__metdecorators__verybriefly__inChapter__19in__relationto__simple functions,but__theyare__moregeneral__thanearlier__implied:they__canalso__beused__forclass__methodsand__classesand__canadd__nearlyarbitrary__logicto__functionsand__classesthat__gowell__beyondthat__the static-and__class-methodroles__usedas__asegue__here.For__instance,function__decoratorsmay__beused__toaugment__functionswith__codethat__logscalls__madeto__them,checks__argumenttypes__during debugging,times__calls,and__so on,and__canbe__usedto__manageeither__functionsthemselves__orlater__callsto__them.In__thelatter__mode,function__decoratorsare__similarto__thedelegation__designpattern__weexplored__inChapter__31,but__theyare__designedto__augmenta__specificfunction__ormethod__call,not__anentire__object interface.Python__providesa__few built-infunction__decoratorsfor__operations,such__asmarking__staticand__classmethods__anddefining__properties (assketched__earlier,the__property built-inworks__asa__decorator automatically),but__programmerscan__alsocode__arbitrarydecorators__oftheir__own.Although__theyare__notstrictly__tiedto__classes, user-definedfunction__decoratorsare__oftencoded__asclasses__tosave__theoriginal__functionsfor__later dispatch,along__withother__dataas__state information.This__provedsuch__auseful__hookthat__itwas__eventuallyextended__classdecorators__bringaugmentation__to classes, too,and__aremore__directlytied__tothe__class model.Like__theirfunction__cohorts,class__decoratorsmay__manageclasses__themselvesor__later instance-creationcalls__andoften__employdelegation__ofentire__interfacesin__thelatter__mode.As__youll__find,their__rolesalso__oftenoverlap__withmetaclasses__butare__amore__lightweightway__toachieve__some goals.Function__DecoratorBasics__Syntactically,a__functiondecorator__isa__sortof__runtimedeclaration__aboutthe__functionthat__follows it.A__functiondecorator__iscoded__ona__lineby__itselfjust__beforethe__defstatement__thatdefines__afunction__or method.It__consistsof__the @ symbol,followed__bya__metafunctiona__plainfunction__(orother__callable object)of__one argument,which__ispassed__andmanages__another function.The__codefollowing__the @is__usuallythe__nameof__ametafunction__withan__optionalarguments__list,but__asof__Python 3.9,it__canbe__anyexpression__returninga__one-argument function.Listing__multipledecorators__onconsecutive__linesallows__themto__nest,as__youll__seelater__inthis__book.For__example,the__priorsection__smethods__maybe__codedwith__decoratorsyntax__like this:class__C: @staticmethod #Function__decorationsyntax__def meth(): Internally,this__syntaxhas__thesame__effectas__thefollowing__passingthe__functionthrough__thedecorator__andassigning__theresult__backto__theoriginal__name:class__C:def__meth():meth__= staticmethod(meth) #Name__rebindingequivalent__Decorationrebinds__themethod__nameto__thedecorator__s result.The__neteffect__isthat__callingthe__methodfunction__sname__lateractually__triggersthe__resultof__itsstaticmethod__decorator first.Because__adecorator__canreturn__anysort__of object,this__allowsthe__decoratorto__inserta__layerof__logicto__berun__onevery__later call.The__decoratorfunction__isfree__toreturn__eitherthe__originalfunction__itselfor__anew__proxyobject__thatsaves__theoriginal__functionpassed__tothe__decoratorto__beinvoked__indirectlyafter__theextra__logiclayer__runs.With__this addition,Example__32-12is__abetter__wayto__codeour__staticmethod__codeof__Example 32-8.Example__32-12. hack_static_deco.pyclass__Hack:numInstances__= 0def____init__(self): Hack.numInstances += 1 @staticmethoddef__printNumInstances(): print('Numberof__instances:', Hack.numInstances)Here__isthis__examplein__actionas__before: >>>from__hack_static_decoimport__Hack >>> a, b,c__= Hack(), Hack(), Hack() >>> Hack.printNumInstances() #Calls__fromclasses__andinstances__workNumber__of instances: 3 >>> a.printNumInstances()Number__of instances: 3Because__theyalso__acceptand__return functions,the__classmethodand__property built-infunctions__maybe__usedas__decoratorsin__thesame__wayas__inExample__32-13,which__demosall__three built-indecorators__previewed earlier.Example__32-13. alldecorators.pyclass__Methods:def__imeth(self, x): #Normal__instance method:passed__aself__print([self, x]) @staticmethoddef__smeth(x): # Static:no__instancepassed__print([x]) @classmethoddef__cmeth(cls, x): # Class:gets__class,not__instance print([cls, x]) @property # Property:computed__onfetch__def name(self):return__'Pat ' + self.__class__.__name__Running__thislive__ina__REPLproves__the point: >>>from__alldecoratorsimport__Methods >>>obj__= Methods() >>> obj.imeth(1) [, 1] >>> obj.smeth(2) [2] >>> obj.cmeth(3) [, 3] >>> obj.name 'Pat Methods'Bear__inmind__thatstaticmethod__andits__kinhere__arestill__built-in functions;they__maybe__usedin__decorationsyntax__justbecause__theytake__afunction__asan__argumentand__returna__callableto__whichthe__originalfunction__namecan__be rebound.In__fact,any__suchfunction__canbe__usedin__thisway__even user-definedfunctions__wecode__ourselves,as__thenext__section explains.A__FirstLook__at User-DefinedFunction__DecoratorsAlthough__Pythonprovides__ahandful__of built-infunctions__thatcan__beused__as decorators,we__canalso__writecustom__decoratorsof__our own.Because__oftheir__wide utility,we__regoing__todevote__anentire__chapterto__codingdecorators__inthe__finalpart__ofthis__book.As__aquick__example, though,let__slook__ata__simple user-defined__decoratorat__work.Recall__fromChapter__30that__the__call____operator-overloadingmethod__implementsa__function-callinterface__forclass__instances.Example__32-14uses__thisto__codea__callproxy__classthat__savesthe__decoratedfunction__inthe__instanceand__catchescalls__tothe__original name.Because__thisis__a class,it__alsohas__stateinformation__acounter__ofcalls__made.Example__32-14. tracer1.pyclass__tracer:def____init__(self, func): #Remember__original,init__counter self.calls = 0 self.func =func__def __call__(self, *args): #On__later calls:add__logic,run__original self.calls += 1 print(f'call {self.calls}to__{self.func.__name__}')return__self.func(*args) @tracer #Same__ashack__= tracer(hack)def__hack(a, b, c): #Wrap__hackin__adecorator__objectreturn__a +b__+c__if__name____== '__main__': print(hack(1, 2, 3)) #Really__callsthe__tracerwrapper__object print(hack('a', 'b', 'c')) #Invokes____call__in__classBecause__thehack__functionis__runthrough__thetracer__decorator,when__theoriginal__hackname__is called,it__actuallytriggers__the__call____methodin__the class.This__methodcounts__andlogs__thecall__andthen__dispatchesit__tothe__originalwrapped__function.Note__howthe__*nameargument__syntaxis__usedto__packand__unpackthe__passed-in arguments;because__of this,this__decoratorcan__beused__towrap__anyfunction__withany__numberof__positional arguments.The__net effect, again,is__toadd__alayer__oflogic__tothe__originalhack__function.When__run,the__firstoutput__linecomes__fromthe__tracer class,and__thesecond__givesthe__returnvalue__ofthe__hackfunction__itself: $ python3 tracer1.pycall__1to__hack 6call__2to__hackabc__Tracethrough__thisexample__scode__formore__insight.As__it is,this__decoratorworks__forany__functionthat__takespositional__arguments,but__itdoes__nothandle__keywordarguments__andcannot__decorate class-levelmethod__functions (in short,for__methods,its____call__would__bepassed__atracer__instance only).As__youll__learnin__Part VIII,there__area__varietyof__waysto__codefunction__decorators,including__nesteddef__statements,and__someof__thealternatives__arebetter__suitedto__methodsthan__theversion__shown here.For__example,by__usingnested__functionswith__enclosingscopes__forstate__insteadof__callableclass__instanceswith__attributes,function__decoratorsoften__becomemore__broadlyapplicable__to class-levelmethods__too.We__llpostpone__thefull__detailson__this,but__Example 32-15provides__abrief__lookat__this closure-basedcoding__model;it__usesfunction__attributesfor__counterstate__forportability__butcould__alsoleverage__variablesand__nonlocal instead.Example__32-15. tracer2.pydef__tracer(func): #Remember__originaldef__oncall(*args): #On__latercalls__oncall.calls += 1 print(f'call {oncall.calls}to__{func.__name__}')return__func(*args) oncall.calls = 0return__oncallclass__C: @tracerdef__hack(self, a, b, c):return__a +b__+c__if__name____== '__main__':x__= C() print(x.hack(1, 2, 3)) print(x.hack('a', 'b', 'c'))The__examples__outputis__thesame__asits__predecessorbut__reflectsa__decoratedclass__method;more__onthis__later.A__FirstLook__atClass__Decoratorsand__MetaclassesPython__latergeneralized__decorators,allowing__themto__beapplied__toclasses__aswell__as functions.In__short,class__decoratorsare__similarto__function decorators,but__theyare__runat__theend__ofa__classstatement__torebind__aclass__nameto__a callable.As__such,they__canbe__usedto__eithermanage__classesjust__afterthey__arecreated__orinsert__alayer__ofwrapper__logicto__manageinstances__whenthey__arelater__created. Symbolically,the__code structure:def__decorator(aClass): @decorator #Class__decorationsyntax__class C:is__mappedto__thefollowing__equivalent:def__decorator(aClass):class__C: #Name__rebindingequivalent__C = decorator(C)The__classdecorator__isfree__toaugment__theclass__itselfor__returna__proxyobject__thatintercepts__laterinstance__construction calls.For__example,in__thecode__ofCounting__instancesper__classwith__classmethods__,we__coulduse__thishook__toautomatically__augmentthe__classeswith__instancecounters__andany__otherdata__required:def__count(aClass): aClass.numInstances = 0return__aClass #Return__classitself__insteadof__awrapper__@countclass__Hack: #Same__asHack__= count(Hack) @countclass__Sub(Hack): #numInstances__= 0not__neededhere__In fact,as__coded,this__decoratorcan__beapplied__toclasses__orfunctions__ithappily__returnsthe__objectbeing__definedin__eithercontext__afterinitializing__theobject__s attribute: @countdef__hack():pass__#Like__hack = count(hack) @countclass__Hack:pass__#Like__Hack = count(Hack) hack.numInstances #Both__areset__tozero__Hack.numInstancesThough__thisdecorator__managesa__functionor__class itself,as__detailedlater__inthis__book,class__decoratorscan__alsomanage__anobject__sentire__interfaceby__interceptingconstruction__callsand__wrappingthe__newinstance__objectin__aproxy__thatdeploys__attributeaccessor__toolsto__interceptlater__requestsa__multilevelcoding__techniquewe__lluse__toimplement__classattribute__privacyin__Chapter 39.Here__sa__previewof__the model:def__decorator(cls): #On__@decoration__class Proxy:def____init__(self, *args): #On__instance creation:make__acls__self.wrapped = cls(*args)def____getattr__(self, name): #On__attribute fetch:extra__opshere__return getattr(self.wrapped, name)return__Proxy @decoratorclass__C: #Like__C = decorator(C)X__= C() #Makes__aProxy__thatwraps__a C,and__catcheslater__X.attr Finally, metaclasses,mentioned__brieflyearlier__inthis__chapter,are__asimilarly__advanced class-basedtool__whoseroles__oftenintersect__withthose__ofclass__decorators.They__providean__alternate model,which__routesthe__creationof__aclass__objectto__asubclass__ofthe__top-leveltype__class (normally),at__theconclusion__ofa__class statement:class__Meta(type):def____new__(meta, classname, supers, classdict):extra__logic +class__creationvia__typecall__class C(metaclass=Meta):my__creationrouted__toMeta__#Like__C = Meta('C', (), { })Python__callsa__classs__metaclassto__createthe__newclass__object,passing__inthe__datadefined__duringthe__classstatement__s run;if__omitted,the__metaclasssimply__defaultsto__thetype__classwe__explored earlier.Abstractly__speaking,here__swhat__happensat__theend__ofclass__statementshaving__explicitmetaclasses__likethe__preceding:classname__= Meta(classname, superclasses, attributedict)To__managethe__creationor__initializationof__anew__class object,a__metaclassgenerally__redefinesthe____new__or____init__method__ofthe__typeclass__thatintercepts__thiscall__by default.The__net effect,as__withclass__decorators,is__todefine__codeto__berun__automaticallyat__classcreation__time. Here,this__bindsthe__classname__tothe__resultof__acall__toa__user-defined metaclass.In__fact,a__metaclassneed__notbe__aclass__atall__apossibility__well__explorelater__thatblurs__someof__thedistinction__betweenthis__tooland__decoratorsand__evenqualifies__thetwo__asfunctionally__equivalentin__some roles.Both__schemes,class__decoratorsand__metaclasses,are__freeto__augmenta__classor__returnan__arbitraryobject__toreplace__ita__hookwith__almostlimitless__class-basedcustomization__possibilities.As__youll__learn later,metaclasses__mayalso__definemethods__thatprocess__theirinstance__classesrather__thannormal__instancesof__thema__techniquethat__ssimilar__(ifnot__redundant)to__classmethods__andmight__beemulated__bymethods__anddata__inclass__decorator proxies,or__evena__classdecorator__thatreturns__ametaclass__instance.Such__mind-bending concepts, however,require__Chapter 40s__conceptualgroundwork__(andquite__possibly sedation).For__MoreDetails__Naturally,there__smore__tothe__decoratorand__metaclassstories__thanshown__here.Although__theyare__ageneral__mechanismwhose__usagemay__berequired__bysome__packages,coding__new user-defineddecorators__andmetaclasses__isan__advancedtopic__ofinterest__primarilyto__tool writers,not__application programmers.Because__of this,this__bookdefers__additionalcoverage__untilits__finaland__optional part:Chapter__38shows__howto__codeproperties__usingfunction__decoratorsyntax__inmore__depth.Chapter__39focuses__on decorators,and__includesmore__comprehensive examples.Chapter__40covers__metaclasses,and__moreon__theclass__andinstance__management story.Although__thesechapters__coveradvanced__topics,they__llalso__provideus__witha__chanceto__seePython__atwork__insubstantial__examples.For__now,let__smove__onto__ourfinal__class-related topic.The__superFunction__Toclose__outthis__chapter,we__turnto__super:a__built-infunction__thatcan__beused__toboth__referencesuperclass__attributesimplicitly__withoutnaming__asuperclass__explicitlyand__routemethod__callscoherently__in multiple-inheritance trees.So__far,super__hasbeen__calledout__inthe__sidebarThe__superAlternative__,as__wellas__multiplenotes__alongthe__way,but__hasnot__appearedin__code.This__wasby__design:super__comeswith__substantialcomplexities__anddownsides__thatmake__itdifficult__torecommend__to learners.In__short,it__san__all-or-nothingtool__withseveral__arduouscoding__requirementsand__relieson__special-caseand__wildlyimplicit__semanticsthat__runcounter__toPython__norms.The__supercall__alsotends__tobe__abusedfor__Java-ficationof__Python code.Newcomers__withbackgrounds__inJava__oftenrush__touse__Pythons__supersimply__becauseof__itssimilarity__toa__Javatool__butare__unawareof__itsmuch__moresubtle__implicationsin__Pythons__multipleinheritance__untiladding__superclassesbreaks__their programs. Nevertheless,this__callhas__grownpervasive__inPython__codeand__meritsfurther__elaboration,especially__forthose__optingto__useit__naively. Hence,this__sectionboth__coverssuper__usageand__notesits__pitfallsalong__the way. Ultimately, though,the__meritof__this call,like__everythingelse__presentedin__thischapter__and book,is__ultimatelyyours__to decide.The__superBasics__First off,let__sreview__theexplicit__alternativethat__smore__closelyin__stepwith__Pythons__own idioms.As__weve__seenin__thisbook__so far,it__salways__possibleto__referencea__superclasss__attributeswhether__methodor__databy__namingtheir__desiredsource__class explicitly: >>>class__C:def__act(self): print('hack') >>>class__D(C):def__act(self): C.act(self) #Name__superclass explicitly,pass__self print('code') >>>I__= D() >>> I.act()hack__codeIn__single-inheritancetrees__likethis__one,the__superalternative__seemsrelatively__straightforwardat__first glance:its__mostcommon__formin__thefollowing__automaticallyselects__thecalling__classs__superclassgenerically__andimplicitly__whenan__attributeis__later fetched.An__explicitcall__like class.method(self),for__example,becomes__animplicit__super().method(),as__inour__example: >>>class__C:def__act(self): print('hack') >>>class__D(C):def__act(self): super().act() #Reference__superclass implicitly,omit__self print('code') >>>I__= D() >>> I.act()hack__codeThis__worksas__advertisedand__mayminimize__workyou__dont__needto__listself__inthe__call,don__tneed__toupdate__thecall__ifD__ssuperclass__changesin__the future,and__dont__needto__codelong__superclassnames__or package-import paths.The__superDetails__Ifyou__studythe__precedingcode__closely, though,you__llrealize__thatthere__ssomething__oddgoing__on here.The__supercall__somehowknows__aboutthe__class,its__superclass,and__theself__instance,even__thoughnone__arepresent__inits__call.The__backstoryinvolves__MROs,a__proxy,and__analgorithm__thatare__requiredreading__forsuper__aspirantsof__all kinds.A__magicproxy__Tounderstand__howsuper__works,you__firstneed__tobe__fluentin__theMRO__algorithmcovered__inMultiple__Inheritanceand__theMRO__andyou__shouldreview__thatnow__ifyou__gaveit__a pass.The__MROis__botha__firmprerequisite__andnested__componentof__super.Given__thecomplexity__andartificial__natureof__the MRO,some__mayrule__thisa__firststrike__against super.Once__youve__masteredthe__MRO,the__simplestdescription__ofsuper__is this:when__usedin__aclass__method,super__returnsa__proxyobject__thatwill__locatean__attributein__aclass__followingthat__ofthe__containingclass__inthe__MROof__theself__instances__class.The__neteffect__findsan__attributein__asuperclass__orother__relativeof__theclass__containingthe__call.This__worksas__expectedin__single-inheritancetrees__becausethe__superclassnaturally__followsthe__containingclass__onself__s MRO. Really, though,this__relieson__deep magic.Apart__fromthe__MRO itself,super__worksby__inspecting:The__runtimecall__stackinfo__forthe__callingmethod__sarguments__The__class____variableinternally__addedto__the__closure____ofmethods__thatcall__superThe__comboautomatically__locatesboth__theself__argumentand__theclass__containingthe__supercall__andthen__pairsthe__twoin__aspecial__proxyobject__thatroutes__laterattribute__fetchesto__asuperclass__sversion__ofa__name.In__fact,the__common no-argumentsuper__formis__equivalentto__manuallypassing__inthe__classcontaining__thesuper__call,along__withthe__self instance.That__is,within__aclass__smethod__function,the__followingforms__workthe__same,though__thesecond__canbe__usedoutside__a method, too,and__itsfirst__argumentcan__be__class____insidea__method: super() super(class-containing-the-super-call, method-self-argument)Both__formscan__beused__inyour__code,and__manualarguments__maybe__handyin__some roles.Because__thesecond__maybe__harderto__codeand__maintainthan__explicit class-name references, though,Python__rootsout__theclass__andinstance__foryou__behindthe__scenes.Here__sthe__equivalentmanual__versionin__our example:class__D(C):def__act(self): super(D, self).act() #Works__thesame__as super().act() print('code') #And__Dis__availableas____class__If__thatall__soundscomplicated__and strange,it__sbecause__it is.Due__toits__unusual semantics,the__no-argumentsuper__callform__doesnt__workat__alloutside__thecontext__ofa__classs__method: >>>super__#A__"magic"proxy__objectthat__routeslater__calls >>> super() #This__formhas__nomeaning__outsidea__method RuntimeError: super():no__argumentsAnd__whereit__does work,its__implicitpairing__ofclass__andinstance__isnowhere__tobe__foundin__your code: >>>class__E(C):def__method(self):proxy__= super() #self__isimplicit__insuper__- only!return__proxy >>>prx__= E().method() #The__normallyhidden__proxyobject__>>>prx__, > >>> prx.act() #Find__acton__MROpast__hidden E,bind__withhidden__self,call__(!)Hack__Tobe__sure,this__calls__semanticsresemble__nothingelse__inPython__its__neithera__boundnor__nonboundmethod__andfills__ina__classand__selfeven__thoughyou__omitboth__inthe__call.This__deviatesfrom__Pythons__explicitself__policy,which__holdstrue__everywhere else.As__weve__seen,class__methodslist__anduse__selfexplicitly__tomake__instancereferences__apparent.Operator__overloading,including__constructors,implies__a self,but__thisis__trivialby__comparison.By__hidingthe__instance,super__violatesthis__fundamentalPython__idiomfor__asingle__role.While__thatmay__becomfortable__tothose__accustomedto__otherOOP__languages,it__mayalso__qualifyas__astrike__twoto__others. Attribute-fetchalgorithm__Ina__single-inheritancetree__likethe__preceding example,super__isstraightforward__becausethere__sjust__oneobvious__followeron__theMRO__thesuperclass__ofthe__classcontaining__thesuper__call.In__fact,in__thissimple__case,the__immediatesuperclass__canbe__hadfrom__aninstance__at __class__.__bases__without__applyingMROs__at all: >>> E.__mro__ (, , ) >>> E().__class__.__bases__[0]In__themore__complexclass__treesof__multiple inheritance, though,you__mustunderstand__supers__fullalgorithm__toknow__whatit__willchoose__ina__given tree.Here__show__this works.The__proxyobject__thatsuper__returnscreated__magicallyfrom__runtimeinfo__asdescribed__inthe__priorsection__usesits__savedinstance__andclass__containingthe__callto__resolveattribute__referencesas__follows: 1.Fetch__theMRO__ofthe__savedself__instances__class,available__at self.__class__.__mro__. 2.Scan__thisMRO__fromleft__toright__tofind__thesaved__containing class,and__skip it. 3.Search__thenamespace__dictionariesof__eachremaining__classin__theMRO__fromleft__toright__untilthe__requestedattribute__is found. 4.If__theattribute__wasfound__andis__a method,bind__itwith__thesaved__self instance.This__procedureis__runfor__eachattribute__fetchand__iswholly__basedon__MRO ordering.It__muststart__withself__sMRO__becausethe__containingclass__sown__MROwon__tapply__ifit__hasbeen__mixedwith__other classes; class-treeshape__andhence__MROmay__bearbitrary__forinstances__madefrom__lowerclasses__(andmay__evenchange__dynamicallyin__rare cases).You__cant__ignorethese__underlyingmechanics__exceptin__verysimple__class trees.Unlike__in Java,the__utilityof__mix-inclasses__inPython__makesmultiple__inheritancefrom__disjointand__independentsuperclasses__acommon__occurrencein__realistic code.And__onceyou__addmultiple__superclasses,you__vekicked__superup__toa__wholenew__level.Universal__deploymentLet__sillustrate__with code.Suppose__youve__writtenthe__followingclasses__thathappily__deploysuper__insimple__single-inheritancemode__toimplicitly__invokea__methodone__levelup__from C: >>>class__A:def__act(self): print('A') >>>class__B:def__act(self): print('B') >>>class__C(B):def__act(self): super().act() #super__appliedto__a single-inheritancetree__>>> C().act() #Make__aninstance__andcall__itsmethod__BIf__suchclasses__latergrow__touse__morethan__one superclass, though,super__seffects__mightbe__surprisingit__doesnot__raisean__exceptionwhen__thesame__nameappears__inmore__thanone__superclassof__amultiple__inheritancetree__butwill__naivelypick__justthe__leftmostsuperclass__havingthe__methodbeing__run (really,the__firstper__theclass__trees__flattened MRO).This__mayor__maynot__bethe__classthat__you want,and__iscompletely__wrongif__youwant__both: >>>class__C(B, A): #Add__anA__mix-inclass__withthe__samemethod__def act(self): super().act() # Doesn'tfail__onconflicts__-picks__justone__>>> C().act()B__>>>class__C(A, B):def__act(self): super().act() #If__Ais__listed first, B.act()is__nolonger__run >>> C().act()A__Thissilently__masksa__sourceof__OOPerrors__socommon__thatit__showsup__againin__thispart__sGotchas__ahead.Explicit__callsare__oneway__tosolve__this dilemma.With__explicitclass__names,you__canchoose__eitherthe__left class,the__right class,or__both,and__withsubstantially__less drama.If__youmight__needto__beexplicit__later,why__notuse__thisform__earlier too? >>>class__C(A, B): #Explicit__formdef__act(self): #You__probablywant__tobe__moreexplicit__here A.act(self) #This__handlesboth__singleand__multipleinheritance__B.act(self) #So__whyuse__thesuper__specialcase__at all? >>> C().act()A__BTechnically__speaking,this__examples__explicitclass__inheritancealso__searchesthe__metaclasstype__treefor__namesnot__definedin__superclasses,per__TheInheritance__Bifurcation .This__secondary-treesearch__differsfrom__super,which__alwayssearches__justa__tailportion__ofthe__instances__MRO (andhence__justthe__superclass tree),but__iscompletely__mootfor__definednames__andunlikely__tomatter__forundefined__names.The__realunderlying__issuewith__super here, though,is__thatit__requiresitself__tobe__calledin__everyclass__smethod__inorder__topropagate__thecall__chain.Without__thisuniversal__deployment,the__calldies__inthe__firstclass__thatdoesn__tcall__superas__inour__Aand__B.While__wecan__addsuper__tothese__classes, too,this__isthe__firstof__thathandful__ofarduous__supercoding__requirementsand__quicklyleads__toanother__issue,as__thenext__section explains. Call-chainanchors__Sinceboth__Aand__Bof__theprior__sections__exampleare__somewhereon__Cs__MRO,we__mightbe__temptedto__makeboth__classesmethods__runby__propagatingthe__callwith__addedsuper__callsin__both.This__schemeis__calledcooperative__method dispatch:each__classin__atree__runssuper__tohand__thecall__offto__thenext__classon__theMRO__thatcares__about it.This__automaticallyroutes__callsthrough__eachcalling__classjust__onceand__avoidsrunning__amethod__ina__diamonds__commonsuperclass__morethan__once (itappears__justonce__inan__MRO).It__assumesthat__theMRO__sorder__makessense__foryour__method calls,but__explicit class-namecalls__area__fallbackif__not.Armed__withthat__info,here__sthe__modin__our example: >>>class__A:def__act(self): print('A') super().act() #Add__asuper__heretoo__>>>class__B:def__act(self): print('B') super().act() #Add__asuper__heretoo__>>>class__C(B, A):def__act(self): super().act() #Hope__thiswinds__uprunning__allmethods__>>> C().act()B__A AttributeError: 'super'object__hasno__attribute 'act' Immediately, though,we__rein__trouble here,and__thereason__requiresinspecting__theMRO__ofan__instances__class: >>>I__= C() >>> I.__class__.__mro__ (, , , )Here__sthe__subtle problem.The__superin__Cwill__selectact__in B,the__nexton__this MRO;the__superin__Bwill__thenselect__actin__A,its__followeron__selfs__MRO;but__thenthere__areno__moreact__definitionsto__be had:the__superin__Alooks__foract__inobject__and beyond,and__ofcourse__fails.We__saythat__thereis__no call-chainanchor__noend__pointfor__thecall__propagation. Hence,the__lastsuper__callin__Adies__withan__exception.In__fact,you__vejust__meta__possiblestrike__threefor__this call.While__thiscode__worksif__youomit__thesuper__in A,this__policywon__thelp__in general:classes__likeA__andB__areprobably__designedto__bemixed__intoother__classes, too,and__itwouldn__tmake__senseto__specializetheir__codejust__forthe__Cclass__suse__case.To__propagatesuper__method calls,all__classesmust__define super, too,and__theremust__bean__anchorto__catchand__endthe__chain somewhere.Although__wecan__addan__anchorin__apointless__superclassthat__definesthe__methodbut__doesnot__callsuper__again,this__isanother__ofthose__arduouscoding__requirementsand__substantiallymore__effortthan__simplyrunning__theexplicit__class-namecalls__alternativeshown__earlier: >>>class__X: #Code__abogus__class,just__toappease__superdef__act(self): print('anchor') >>>class__A:same__>>>class__B:same__>>>class__C(B, A, X): #Add__afinal__anchor,just__toappease__superdef__act(self): super().act() >>> C().act()B__Aanchor__>>> [c.__name__for__cin__C().__class__.__mro__] ['C', 'B', 'A', 'X', 'object']This__worksbecause__Xprecedes__objecton__theMRO__as shown,and__hencestops__theact__call chain.Adding__theanchor__classX__asa__commonsuperclass__toboth__Aand__Bin__adiamond__would work, too,because__theresulting__MROis__thesame__(remember,the__MROremoves__allbut__thelast__[rightmost]appearance__ofa__classfrom__theDFLR__order): >>>class__X:same__>>>class__A(X):same__>>>class__B(X):same__>>>class__C(B, A):same__>>> C().act()B__Aanchor__>>> [c.__name__for__cin__C().__class__.__mro__] ['C', 'B', 'A', 'X', 'object'] Again, though,if__youhave__tocode__aspecial__classjust__toappease__super,why__notjust__useexplicit__class names?Similarity__toother__languagesisn__ta__verygood__reason,especially__incontexts__thatother__languagesdon__t support. Also,keep__inmind__thatthe__classselected__bysuper__foran__attributereference__maynot__bea__superclassat__alland__mayvary__pertree__thata__classis__mixed into.For__instance,the__superin__Bin__ourexample__dispatchesto__Athe__nexton__the MRO,but__a sibling,not__a superclass.This__maybe__mootin__most programs,but__ifyou__mustbe__surethat__animmediate__superclasss__methodis__run,you__againmust__useexplicit__classnames__insteadof__super.Same__argumentlists__Whilesuper__alwaysdemands__a call-chain anchor,you__mayoccasionally__getone__for free.As__aspecial__case,object__definesa__constructorthat__canbe__reliedon__toanchor__somechains__(recallthat__the__init____constructormethod__isa__classattribute__likeany__other,despite__itsodd__nameand__automatic invocation): >>>class__A:def____init__(self): print('A') super().__init__() #Propagate__constructorcalls__>>>class__B:def____init__(self): print('B') super().__init__() #Propagate__constructorcalls__>>>class__C(B, A):def____init__(self): super().__init__() #Assume__objectanchors__constructorchain__>>>I__= C()B__AThis__propagatesthe__constructorcall__through C, B, A,and__objectper__theI__instances__MROvia__cooperativemethod__dispatchas__before.This__also fails, however,for__constructorsthat__takeany__argumentsbecause__thatof__objecttakes__noneexcept__self: >>>class__A:def____init__(self, name): #Add__anargument__tothe__method print('A') super().__init__(name) >>>class__B:def____init__(self, name): print('B') super().__init__(name) >>>class__C(B, A):def____init__(self, name): super().__init__(name) #But__object'sarguments__listdiffers__>>>I__= C('Pat')B__A TypeError: object.__init__()takes__exactlyone__argument (theinstance__to initialize)And__nowyou__verun__intoanother__oneof__thoseother__arduouscoding__requirements:super__generallyassumes__thatall__themethods__ina__callchain__usethe__samearguments__listbecause__theMRO__sordering__ofmethod__callscan__varywith__class-tree shape:an__arbitrarychange__ininheritance__maychange__callorder__arbitrarily.This__limitsflexibility__inherently.While__youmay__beable__toensure__samearguments__forclasses__usedonly__ina__singleprogram__andcan__sometimesfudge__itwith__starred-argumentcollectors__for generality,neither__policywill__applyto__codemeant__tobe__reusedin__multiplecontexts__whichis__reallyone__ofthe__mainpoints__behindPython__programming.Noncalls__andoperator__overloadingTo__close,here__aretwo__moresuper__oddities. First,keep__inmind__that super,like__the MRO,is__notjust__about methods,despite__theirprevalence__inits__jargon.It__canalso__fetchthe__classdata__attributeswe__metin__Chapter 29and__thebound__methodswe__metin__Chapter 31: >>>class__C: attr1 = 'hack' #super__alsofetches__dataattributes__def attr2(self): #And__returnsbound__methodssans__callsreturn__'code' >>>class__D(C):def__act(self):return__super().attr1, super().attr2 >>>I__= D() >>> I.act() ('hack', >) >>> I.act()[1]() 'code'When__youaccess__amethod__like attr2from__asuper__proxy,the__proxybinds__itwith__thesaved__instanceto__producea__bound method.Fetching__amethod__asa__plain function, however,may__requirean__explicitclass__name,like__C.attr2.This__leadsdown__arabbit__holetoo__deepto__plumb here,but__its__anotherway__thatsuper__clasheswith__normal semantics. Second,super__alsodoesn__tfully__workin__thepresence__of__X____operator-overloading__methods.If__youstudy__thefollowing__code,you__llsee__thatexplicit__namedcalls__tooverloading__methodsin__thesuperclass__work normally,but__usingthe__superresult__inan__expressionfails__todispatch__tothe__superclasss__method: >>>class__C:def____getitem__(self, ix): #Indexing__overloadmethod__print('C index') >>>class__D(C):def____getitem__(self, ix): #Redefine__toextend__here print('D index') C.__getitem__(self, ix) #Explicit__callform__works super().__getitem__(ix) #Direct__namecalls__worktoo__super()[ix] #But__operatorsdo__not! (__getattribute__) >>>I__= C() >>> I[99]C__index >>>I__= D() >>> I[99]D__indexC__indexC__index TypeError: 'super'object__isnot__subscriptableThis__behavioris__dueto__thesame__limitationdescribed__inthe__sidebarDelegating__Built-insor__Notbecause__theproxy__objectreturned__bysuper__usesthe____getattribute__method__wemet__earlierto__catchand__dispatchlater__attribute requests,it__failsto__interceptthe__automatic__X____methodinvocations__runby__built-inoperations__including expressions,as__thesebegin__theirsearch__inthe__classinstead__ofthe__instance.This__mayseem__lesssevere__thanthe__otherlimitations__weve__met,but__operatorsshould__generallywork__thesame__asthe__equivalentmethod__call,especially__fora__built-inlike__this.Not__supportingthis__addsanother__exceptionfor__superusers__toconfront__and remember.Other__languagesmileage__may vary,but__in Python,self__is explicit, multiple-inheritance mix-insand__operatoroverloading__are common,and__superclassname__changesare__rareenough__topass__asa__red herring.The__super Wrap-UpSo__thereyou__have it:a__brieftutorial__onthe__super built-in,for__whichyou__canfind__copioussupplements__inall__thestandard__places,some__ofwhich__seemas__focusedon__defendingsuper__ason__documenting it. Hopefully,the__coveragehere__hasgiven__youa__balancedview__ofthis__tools__trade-offswhile__introducingits__fundamentals.As__weve__just seen,in__single-inheritanceclass__trees,the__supercall__maybe__usedto__referto__parentsuperclasses__genericallywithout__namingthem__explicitly.In__multiple-inheritance trees,this__callcan__alsobe__usedto__implementcooperative__methoddispatch__thatpropagates__callsthrough__a tree.The__latterrole__maybe__especiallyuseful__in diamonds,as__aconforming__methodcall__chainvisits__eachsuperclass__just once.While__theseare__clearupsides__insome__contexts,it__simportant__toknow__thatsuper__canalso__yieldhighly__implicit behavior,which__forsome__programsmay__notinvoke__superclassesas__expectedor__required.To__summarize,the__super method-dispatchtechnique__generallyimposes__threemain__coding requirements: Anchors:the__methodcalled__bysuper__mustexist__whichrequires__extracode__andcalls__ifno__call-chainanchor__is present,and__mix-inclasses__cant__bespecialized__fora__singletree__s context. Arguments:the__methodcalled__bysuper__musthave__thesame__argumentsignature__acrossthe__entireclass__treewhich__canimpair__flexibility,especially__for implementation-levelmethods__like constructors. Deployment:every__appearanceof__themethod__calledby__superbut__thelast__mustuse__superitself__whichcan__makeit__difficultto__useexisting__code,change__call ordering,override__methods,and__code self-contained classes.In__addition,super__buildsupon__thealready__complex MRO,can__maskproblems__when single-inheritancetrees__become multiple-inheritance trees,may__selecta__classother__thana__superclassin__multiple-inheritance trees,and__constitutesyet__anotherspecial__casefor__attribute inheritance,which__well__revisitin__Chapter 40.In__the end,super__iseasy__touse__andrelatively__harmlessin__single-inheritance roles,but__itsunusual__semantics,rigid__requirements,and__questionablenet__rewardmake__ita__mixed bag.Python__programmers,especially__thoselearning__Python anew,might__bebetter__servedby__themore__generaland__transparentcoding__paradigmof__explicit class-name references.But__youshould__judgeall__thisfor__yourselfin__anOOP__Pythonprogram__near you.Class__GotchasWe__vereached__theend__ofthe__primaryOOP__coveragein__this book.After__exceptionsup__next,we__llexplore__additional class-relatedexamples__andtopics__inthe__lastpart__ofthe__book,but__thatpart__mostlyjust__givesexpanded__coverageto__conceptsintroduced__here.As__usual,let__swrap__upthis__partwith__thestandard__warningsabout__pitfallsto__avoid.Most__classissues__canbe__boileddown__tonamespace__issueswhich__makes sense,given__thatclasses__arelargely__justnamespaces__witha__handfulof__extra tricks.Some__ofthe__itemsin__thissection__aremore__likeclass__usagepointers__than problems,but__evenexperienced__classcoders__havebeen__knownto__stumbleon__a few.Changing__ClassAttributes__CanHave__SideEffects__Theoretically speaking,classes__(andclass__instances)are__mutable objects.As__with built-inlists__and dictionaries,you__canchange__themin__placeby__assigningto__theirattributes__andas__withlists__and dictionaries,this__meansthat__changinga__classor__instanceobject__mayimpact__multiplereferences__to it.That__susually__whatwe__wantand__ishow__objectschange__theirstate__in general,but__awarenessof__thisissue__becomesespecially__criticalwhen__changingclass__attributes.Because__allinstances__generatedfrom__aclass__sharethe__classs__namespace,any__changesat__theclass__levelare__reflectedin__allinstances__unlessthey__havetheir__ownversions__ofthe__changedclass__attributes.In__Python,we__cannormally__changeany__attributein__anyobject__towhich__wehave__a reference.Consider__thefollowing__class.Inside__theclass__body,the__assignmentto__thename__agenerates__anattribute__X.a,which__livesin__theclass__objectat__runtimeand__willbe__inheritedby__allof__Xs__instances: >>>class__X:a__= 1 #Class__attribute >>>I__= X() >>> I.a #Inherited__byinstance__1 >>> X.a #Accessible__throughclass__1So__far,so__goodthis__isthe__normal case.But__noticewhat__happenswhen__wechange__theclass__attributedynamically__outsidethe__class statement:it__alsochanges__theattribute__inevery__objectthat__inheritsfrom__the class. Moreover,new__instancescreated__fromthe__classduring__thissession__orprogram__runalso__getthe__dynamicallyset__value,regardless__ofwhat__theclass__ssource__code says: >>> X.a = 2 #May__changemore__thanX__>>> I.a #I__changestoo__2 >>>J__= X() #J__inheritsfrom__X'sruntime__values >>> J.a # (butassigning__to J.achanges__ain__J,not__Xor__I) 2Is__thisa__usefulfeature__ora__dangerous trap?You__bethe__judge.As__discussedin__Chapter 27,you__canactually__getwork__doneby__changingclass__attributeswithout__evermaking__asingle__instancea__techniquethat__cansimulate__theuse__ofrecords__orstructs__inother__languages.As__a refresher,consider__thefollowing__unusualbut__legalPython__program:class__X:pass__#Make__afew__attributenamespaces__class Y:pass__X.a = 1 #Use__classattributes__asvariables__X.b = 2 #No__instancesanywhere__tobe__found X.c = 3 Y.a = X.a + X.b + X.cfor__X.iin__range(Y.a): print(X.i) #Prints__0..5 Here,the__classesX__andY__worklike__filelessmodules__namespacesfor__storingvariables__wedon__twant__to clash.This__isa__perfectlylegal__Pythonprogramming__trick,but__its__lessappropriate__whenapplied__toclasses__writtenby__others;you__cant__alwaysbe__surethat__classattributes__youchange__arent__criticalto__theclass__sinternal__behavior.If__youre__outto__simulatea__C struct,you__maybe__betteroff__changinginstances__than classes,as__that way,only__oneobject__is affected:class__Record:pass__X = Record() X.name = 'pat' X.job = 'Pizza maker'Changing__MutableClass__AttributesCan__HaveSide__Effects,Too__Thisgotcha__isreally__anextension__ofthe__prior.Because__classattributes__areshared__byall__instances,if__aclass__attributereferences__amutable__object,changing__thatobject__inplace__fromany__instanceimpacts__allinstances__at once: >>>class__C:shared__= [] #Class__attributedef____init__(self): self.perobj = [] #Instance__attribute >>> x,y__= C(), C() #Two__instances >>> y.shared, y.perobj #Implicitly__shareclass__attrs ([], []) >>> x.shared.append('hack') #Impacts__y'sview__too! >>> x.perobj.append('code') #Impacts__x'sdata__only >>> x.shared, x.perobj (['hack'], ['code']) >>> y.shared, y.perobj #y__seeschange__madethrough__x (['hack'], []) >>> C.shared #Stored__onclass__andshared__['hack']This__effectis__nodifferent__thanmany__weve__seenin__thisbook__already:mutable__objectsare__sharedby__simple variables,globals__areshared__by functions, module-level__objectsare__sharedby__multiple importers,and__mutablefunction__argumentsare__sharedby__thecaller__andthe__callee.All__ofthese__arecases__ofgeneral__behaviormultiple__referencesto__amutable__objectand__allare__impactedif__theshared__objectis__changedin__placefrom__any reference. Here,this__occursin__classattributes__sharedby__allinstances__via inheritance,but__its__thesame__phenomenonat__work.It__maybe__mademore__subtleby__thedifferent__behaviorof__assignmentsto__instanceattributes__themselves: x.shared.append('hack') #Changes__sharedobject__attachedto__class -in__place x.shared = 'hack' #Changed__orcreates__instanceattribute__attachedto__xBut__again,this__isnot__a problem,it__sjust__somethingto__beaware__of;shared__mutableclass__attributescan__havemany__validuses__inPython__programs.Multiple__Inheritance:Order__MattersThis__maybe__obviousby__now,but__its__worthunderscoring__onelast__time:if__youuse__multiple inheritance,the__orderin__whichsuperclasses__arelisted__inthe__classstatement__headercan__be critical.Python__alwayssearches__superclassesfrom__leftto__right,according__totheir__orderin__theheader__line.For__instance,in__themultiple__inheritanceexample__westudied__inChapter__31,imagine__thatthe__Superclass__implementeda____str__ method, too:class__ListTree:def____str__(self):class__Super:def____str__(self):class__Sub(ListTree, Super): #Get__ListTree's__str____bylisting__itfirst__x = Sub() #Inheritance__searchesListTree__beforeSuper__Whichclass__wouldwe__inheritit__fromListTree__or Super?As__inheritancesearches__generallyproceed__fromleft__to right,we__wouldget__themethod__fromwhichever__classis__listedfirst__(leftmost)in__Subs__class header. Presumably,we__wouldlist__ListTreefirst__becauseits__wholepurpose__isits__custom __str__. Indeed,we__hadto__dothis__inChapter__31when__mixingthis__classwith__a tkinter.Buttonthat__hada____str__of__its own.But__now,suppose__Superand__ListTreehave__theirown__versionsof__other same-named__attributes, too.If__wewant__onename__fromSuper__andanother__from ListTree,the__orderin__whichwe__listthem__inthe__classheader__wont__helpwe__willhave__tooverride__inheritanceby__manuallyassigning__tothe__attributename__inthe__Sub class:class__ListTree:def____str__(self):def__other(self):class__Super:def____str__(self):def__other(self):class__Sub(ListTree, Super): #Get__ListTree's__str____bylisting__itfirst__other = Super.other #But__explicitlypick__Super'sversion__ofother__def __init__(self):x__= Sub() #Inheritance__searchesSub__before ListTree/Super Here,the__assignmentto__otherwithin__theSub__classcreates__Sub.othera__referenceback__tothe__Super.other object.Because__itis__lowerin__the tree, Sub.othereffectively__hides ListTree.other,the__attributethat__theinheritance__searchwould__normally find. Similarly,if__welisted__Superfirst__inthe__classheader__topick__upits__other,we__wouldneed__toselect__ListTrees__method explicitly:class__Sub(Super, ListTree): #Get__Super'sother__byorder____str__ = ListTree.__str__ #Explicitly__pick ListTree.__str__For__anotherexample__ofthe__techniqueshown__herein__action,see__thediscussion__ofexplicit__conflictresolution__inAttribute__ConflictResolution__. Ultimately,multiple__inheritanceis__anadvanced__tool.Even__ifyou__understoodthe__last paragraph,it__sstill__agood__ideato__useit__sparinglyand__carefully. Otherwise,the__meaningof__aname__maycome__todepend__onthe__orderin__whichclasses__aremixed__inan__arbitrarily far-removed subclass.As__arule__of thumb,multiple__inheritanceworks__bestwhen__your mix-inclasses__areas__self-containedas__possiblebecause__theymay__beused__ina__varietyof__contexts,they__shouldnot__makeassumptions__aboutnames__relatedto__otherclasses__ina__tree.The__pseudoprivate__X__attributesfeature__westudied__inChapter__31can__helpby__localizingnames__thata__classrelies__onowning__andlimiting__thenames__that mix-inclasses__addto__the mix.In__this example,for__instance,if__ListTreeonly__meansto__exportits__custom __str__,it__canname__itsother__method__other__toavoid__clashingwith__like-namedclasses__inthe__tree.Scopes__inMethods__andClasses__Whenworking__outthe__meaningof__namesin__class-based code,it__helpsto__rememberthat__classesintroduce__local scopes,just__asfunctions__do,and__methodsare__simplyfurther__nested functions.In__thefollowing__example,the__generatefunction__returnsan__instanceof__thenested__Hack class.Within__its code,the__classname__Hackis__assignedin__thegenerate__functions__localscope__andhence__isvisible__toany__furthernested__functions,including__codeinside__method;it__sin__theE__enclosing-functionlayer__ofthe__LEGBscope__lookup rule:def__generate():class__Hack: #Hack__isa__namein__generate'slocal__scopecount__= 1def__method(self): print(Hack.count) #Visible__in generate's scope,per__LEGBrule__(E)return__Hack() generate().method()This__exampleworks__becausethe__localscopes__ofall__enclosingfunction__defsare__automaticallyvisible__tonested__defsincluding__nestedmethod__defs,as__inthis__example.Even__so,keep__inmind__thatmethod__defscannot__seethe__localscope__ofthe__enclosing class;they__cansee__onlythe__localscopes__ofenclosing__defs.That__swhy__methodsmust__gothrough__theself__instanceor__theclass__nameto__referencemethods__andother__attributesdefined__inthe__enclosingclass__statement.For__example,code__inthe__methodmust__use self.countor__Hack.count,not__just count.To__avoid nesting,we__couldrestructure__thiscode__suchthat__theclass__Hackis__definedat__thetop__levelof__the module:the__nestedmethod__functionand__the top-level__generatewill__thenboth__findHack__intheir__global scopes;it__snot__localizedto__afunction__s scope,but__isstill__localto__asingle__module:def__generate():return__Hack()class__Hack: #Define__attop__levelof__modulecount__= 1def__method(self): print(Hack.count) #Found__inglobal__scope (enclosing module) generate().method()Code__tendsto__besimpler__ingeneral__ifyou__avoidnesting__classesand__functions.On__theother__hand,class__nestingis__usefulin__closure contexts,where__theenclosing__functions__scoperetains__stateused__bythe__classor__its methods.In__the following,the__nestedmethod__hasaccess__toits__own scope,the__enclosingfunction__sscope__(for label),the__enclosingmodule__sglobal__scope,anything__savedin__theself__instanceby__the class,and__theclass__itselfvia__itsnonlocal__name: >>>def__generate(label): #Returns__aclass__insteadof__aninstance__class Hack:count__= 1def__method(self): print(f'{label}={Hack.count}')return__Hack >>>aclass__= generate('Gotchas') >>>I__= aclass() >>> I.method() Gotchas=1Miscellaneous__ClassGotchas__Heres__ahandful__ofadditional__class-related warnings,mostly__as review:Choose__per-instanceor__classstorage__wisely.On__asimilar__note,be__carefulwhen__youdecide__whetheran__attributeshould__bestored__ona__classor__its instances:the__formeris__sharedby__all instances,and__thelatter__willdiffer__per instance.In__aGUI__program,for__instance,if__youwant__informationto__beshared__byall__ofthe__windowclass__objectsyour__applicationwill__create (e.g.,the__lastdirectory__usedfor__aSave__operationor__analready__entered password),it__mightbe__beststored__as class-level data;if__storedin__theinstance__asself__attributes,it__willvary__perwindow__orbe__missingentirely__whenlooked__upby__inheritance.You__usuallywant__tocall__superclass constructors.Remember__thatPython__runsonly__one__init____constructormethod__whenan__instanceis__madethe__firstit__findsby__inheritance.It__doesnot__automaticallyrun__theconstructors__ofall__superclasseshigher__up.Because__constructorsnormally__performrequired__startup work,you__llusually__needto__runa__superclassconstructor__froma__subclassconstructor__usingeither__anexplicit__callthrough__thesuperclass__sname__or super,passing__alongwhatever__argumentsare__requiredunless__youmean__toreplace__thesuper__sconstructor__altogether,or__thesuperclass__doesnt__haveor__inherita__constructorat__all.Stay__tunedfor__afix__for__getattr____and built-ins.Another__reminder:as__notedin__Chapter 28and__elsewhere,classes__thatuse__the__getattr____operator-overloadingmethod__todelegate__attributefetches__towrapped__objectsmay__failunless__operator-overloadingmethods__areredefined__inthe__wrapper class.The__namesof__operator-overloadingmethods__implicitlyfetched__by built-inoperations__arenot__routedthrough__generic attribute-interception methods.To__workaround__this,you__mustredefine__suchmethods__inwrapper__classes,either__manually,with__tools,or__bydefinition__in superclasses;you__lllearn__howin__Chapter 39. Overwrapping-itis Finally,when__used well,the__codereuse__featuresof__OOPmake__itexcel__atcutting__development time. Sometimes, though,OOP__sabstraction__potentialcan__beabused__tothe__pointof__makingcode__difficultto__understand.If__classesare__layeredtoo__deeply,code__canbecome__obscure;you__mayhave__tosearch__throughmany__classesto__discoverwhat__anoperation__does. Imagine,for__example,a__frameworkwith__hundredsof__classesand__adozen__levelsof__inheritance (thisis__atrue__story,but__detailshave__beenomitted__toprotect__the innocent).Deciphering__methodcalls__insuch__acomplex__systemmay__bea__monumental task:multiple__classesmight__haveto__beconsulted__foreven__themost__basicof__operations.In__fact,the__logicof__sucha__systemcan__beso__deeplywrapped__thatunderstanding__apiece__ofcode__insome__casesmay__requiredays__ofwading__throughrelated__files.This__obviouslyisn__tideal__forprogrammer__productivity.The__mostgeneral__ruleof__thumbof__Pythonprogramming__applies here, too:don__tmake__thingscomplicated__unlessthey__trulymust__be.Wrapping__yourcode__inmultiple__layersof__classesto__thepoint__ofincomprehensibility__isalways__abad__idea.Abstraction__isthe__basisof__polymorphismand__encapsulation,and__itcan__bea__veryeffective__toolwhen__used well. However,you__llsimplify__debuggingand__aidmaintainability__ifyou__makeyour__classinterfaces__intuitive,avoid__makingyour__codeoverly__abstract,and__keepyour__classhierarchies__shortand__smallunless__thereis__agood__reasonto__do otherwise. Remember:code__youwrite__isgenerally__codethat__othersmust__read.Chapter__SummaryThis__chapterpresented__anassortment__of class-related topics,including__subclassing built-in types,the__relationshipof__typesand__classes, slots, properties,static__methods, decorators,and__super.Most__areoptional__extensionsto__theOOP__toolboxin__Pythonbut__maybecome__moreuseful__asyou__startwriting__larger object-oriented programs,and__allare__fairgame__ifthey__appearin__codeyou__must understand.As__noted earlier,some__ofthese__topicsare__continuedin__thefinal__partof__this book;be__sureto__lookahead__formore__infoon__properties, descriptors, decorators,and__metaclasses.This__isthe__endof__theclass__partof__this book,so__youll__findthe__usuallab__exercisesat__theend__ofthe__chapter:be__sureto__workthrough__themto__getsome__practicecoding__real classes.In__thenext__chapter,we__llbegin__ourlook__atour__lastcore__language topic,exceptions__Pythons__mechanismfor__communicatingerrors__andother__conditionsto__your code.This__isa__relativelylightweight__topicbut__itwas__savedfor__lastbecause__newexceptions__mustbe__codedas__classes.Before__wetackle__thatfinal__core subject, though,take__alook__atthis__chapters__quizand__thelab__exercises.Test__Your Knowledge:Quiz__1.Name__twoways__toextend__a built-inobject__type. 2.What__arefunction__andclass__decoratorsused__for? 3.How__arenormal__andstatic__methods different? 4.Are__toolslike____slots__and__supervalid__touse__inyour__code?Test__Your Knowledge:Answers__1.You__canembed__a built-inobject__ina__wrapper class,or__subclassthe__built-in__type directly.The__latterapproach__tendsto__be simpler,as__mostoriginal__behavioris__automatically inherited.This__worksbecause__typesare__classes,though__theway__youcreate__aninstance__froma__type/classdetermines__its functionality. 2.Function__decoratorsare__generallyused__tomanage__afunction__ormethod__oradd__toit__alayer__oflogic__thatis__runeach__timethe__functionor__methodis__called.They__canbe__usedto__logor__countcalls__toa__function,check__itsargument__types,and__so on.They__arealso__usedto__declarestatic__methods (simplefunctions__ina__classthat__arenot__passedan__instance,however__theyare__called),as__wellas__classmethods__and properties.Class__decoratorsare__similarbut__managewhole__objectsand__theirinterfaces__insteadof__afunction__call. 3.Normal__(instance)methods__receivea__selfargument__(theimplied__instance),but__staticmethods__do not.Static__methodsare__simplefunctions__nestedin__class objects.To__makea__method static,it__musteither__berun__througha__special built-infunction__orbe__decoratedwith__decorator syntax.Python__alsoallows__simplefunctions__ina__classto__becalled__throughthe__classwithout__this step,but__callsthrough__instancesstill__require static-method declaration. 4.Of__course,but__youshouldn__tuse__advancedtools__automaticallywithout__carefullyconsidering__their implications. Slots,for__example,can__break code;super__canmask__laterproblems__whenused__forsingle__inheritance,and__inmultiple__inheritancebrings__withit__substantialcomplexity__foran__isolateduse__case;and__bothrequire__universaldeployment__tobe__most useful.Evaluating__newor__advancedtools__isa__primarytask__ofany__engineer,and__thisis__whywe__explored trade-offsin__this chapter.This__books__goalis__notto__tellyou__whichtools__touse__butto__underscorethe__importanceof__objectivelyanalyzing__thema__taskoften__giventoo__lowa__priorityin__thesoftware__field.In__engineering,as__inlife__in general,we__shouldnt__letother__peoplemake__choicesfor__us.Test__Your Knowledge:Part__VIExercises__Theseexercises__askyou__towrite__afew__classesand__experimentwith__someexisting__code.Of__course,the__problemwith__existingcode__isthat__itmust__be existing.To__workwith__theset__classin__exercise 5,either__copy/pasteExample__32- 1from__emedia,find__itin__thisbook__sexamples__package (seethe__Prefacefor__pointers),or__typeit__upby__hand (mildlytedious__buta__greatway__tomake__syntaxmore__concrete).These__programsare__growing sophisticated,so__besure__tocheck__thesolutions__atthe__endof__thebook__for pointers.You__llfind__themin__Appendix B,under__Part VI,Classes__andOOP__. 1. Inheritance:Write__aclass__calledAdder__thatexports__amethod__add(self, x, y),which__printsa__NotImplemented__message. Then,define__twosubclasses__ofAdder__thatimplement__theadd__method:ListAdder__Withan__addmethod__thatreturns__theconcatenation__ofits__twolist__argumentsDictAdder__Withan__addmethod__thatreturns__anew__dictionarycontaining__theitems__inboth__itstwo__dictionaryarguments__(anydefinition__ofdictionary__additionwill__do;see__dictionaryunion__inChapter__8for__tips)Experiment__bymaking__instancesof__allthree__ofyour__classesinteractively__andcalling__theiradd__methods. Now,extend__yourAdder__superclassto__savean__objectin__theinstance__witha__constructor (e.g.,assign__self.dataa__listor__a dictionary),and__overloadthe__+operator__withan____add__method__toautomatically__dispatchto__youradd__methods (e.g.,X__+Y__triggers X.add(X.data,Y)).Where__isthe__bestplace__toput__theconstructors__and operator-overloadingmethods__(i.e.,in__which classes)?What__sortsof__objectscan__youadd__toyour__class instances?In__practice,you__mightfind__iteasier__tocode__youradd__methodsto__acceptjust__onereal__argument (e.g., add(self,y))and__addthat__oneargument__tothe__instances__currentdata__(e.g., self.data + y).Does__thismake__moresense__thanpassing__twoarguments__to add?Would__yousay__thismakes__yourclasses__more object-oriented ? 2.Operator__overloading:Write__aclass__calledMyList__thatshadows__(wraps__)a__Python list:it__shouldoverload__mostlist__operatorsand__operations,including__+, indexing, iteration, slicing,and__listmethods__suchas__appendand__sort.See__thePython__referencemanual__orother__documentationfor__alist__ofall__possiblemethods__to support. Also,provide__aconstructor__foryour__classthat__takesan__existinglist__(ora__MyList instance)and__copiesits__componentsinto__aninstance__attribute.Experiment__withyour__class interactively.Things__to explore:Why__iscopying__theinitial__valueimportant__here?Can__youuse__anempty__slice (e.g., start[:])to__copythe__initialvalue__ifit__sa__MyList instance?Is__therea__generalway__toroute__listmethod__callsto__thewrapped__list?Can__youadd__aMyList__anda__regular list?How__abouta__listand__aMyList__instance?What__typeof__objectshould__operationslike__+and__slicing return?What__aboutindexing__operations?You__mayimplement__thissort__ofwrapper__classby__embeddinga__reallist__ina__standaloneclass__orby__extendingthe__built-inlist__typewith__a subclass.Which__is easier,and__why? 3. Subclassing:Make__asubclass__ofMyList__fromexercise__2called__MyListSub,which__extendsMyList__toprint__amessage__tostdout__beforeeach__callto__the +overloaded__operationand__countsthe__numberof__such calls.MyListSub__shouldinherit__basicmethod__behaviorfrom__MyList.Adding__asequence__toa__MyListSubshould__printa__message,increment__thecounter__for + calls,and__performthe__superclasss__method. Also,introduce__anew__methodthat__printsthe__operationcounters__tostdout__(i.e.,your__console window)and__experimentwith__yourclass__interactively.Do__yourcounters__countcalls__perinstance__orper__class (forall__instancesof__the class)?How__wouldyou__programthe__other option? (Hint:it__dependson__whichobject__thecount__membersare__assigned to:class__membersare__sharedby__instances,but__selfmembers__are per-instance__data.) 4.Attribute__methods:Write__aclass__calledAttrs__withmethods__thatintercept__everyattribute__qualification (bothfetches__and assignments),and__printmessages__listingtheir__argumentsto__stdout.Create__anAttrs__instanceand__experimentwith__qualifyingit__interactively.What__happenswhen__youtry__touse__theinstance__in expressions?Try__adding, indexing,and__slicingthe__instanceof__your class. (Note:a__fullygeneric__approachbased__upon__getattr____requiresChapter__39s__workaroundsfor__reasonsnoted__inChapter__28and__laterand__summarizedin__thesolution__tothis__exercise.) 5.Set__objects:Experiment__withthe__setclass__ofExample__32-1and__describedin__ExtendingTypes__byEmbedding__.Run__commandsto__dothe__followingsorts__of operations:Create__twosets__of integers,and__computetheir__intersectionand__unionby__using &and__|operator__expressions.Create__aset__froma__string,and__experimentwith__indexingyour__set.Which__methodsin__theclass__are called?Try__iteratingthrough__theitems__inyour__stringset__usinga__for loop.Which__methodsrun__this time?Try__computingthe__intersectionand__unionof__yourstring__setand__asimple__Python string.Does__it work? Now,extend__yourset__bysubclassing__tohandle__arbitrarilymany__operandsusing__the *argsargument__form. (Hint:see__thefunction__versionsof__thesealgorithms__inChapter__18.)Compute__intersectionsand__unionsof__multipleoperands__withyour__set subclass.How__canyou__intersectthree__ormore__sets,given__that &has__onlytwo__sides?How__wouldyou__goabout__emulatingother__listoperations__inthe__set class? (Hint:__add____cancatch__concatenation,and____getattr__can__passmost__namedlist__methodcalls__likeappend__tothe__wrapped list.) 6.Class__tree links:In__Namespaces:The__Conclusionand__inMultiple__Inheritanceand__theMRO__,we__learnedthat__classeshave__a__bases____attributethat__returnsa__tupleof__theirsuperclass__objects (theones__listedin__parenthesesin__theclass__header).Use____bases__to__extendany__orall__threeof__thelisting__mix-inclasses__wewrote__inChapter__31so__thatthey__printthe__namesof__theimmediate__superclassesof__theinstance__s class.Modding__Example 31-10first__maybe__easiest.When__youre__done,the__firstline__ofthe__stringrepresentation__shouldlook__likethis__(yourhex__addresseswill__almostcertainly__vary): >>from__zooimport__Cat,Hacker__>>>spot__= Cat() >>> spot.reply() # Animal.reply:calls__Cat.speakmeow__>>>data__= Hacker() # Animal.reply:calls__Primate.speak >>> data.reply()Hello__world!WHY__YOUWILL__CARE:OOP__BYTHE__MASTERSAlmost__invariably,when__teachinglive__Python classes,about__halfwaythrough__theOOP__section,people__whohave__usedOOP__inthe__pastare__followingalong__intensely,while__peoplewho__havenot__arebeginning__toglaze__over (ornod__off completely).The__pointbehind__thetechnology__justisn__t apparent.A__booklike__thishas__theluxury__ofslowly__presentingmaterial__likethe__overviewin__Chapter 26,and__thegradual__tutorialof__Chapter 28in__fact,you__shouldprobably__reviewthose__sectionsagain__ifyou__restarting__tofeel__likeOOP__isjust__somecomputer__science mumbo-jumbo.Though__OOPadds__morestructure__thanthe__generatorswe__met earlier,it__similarlyrelies__onsome__magic (inheritancesearch__anda__specialfirst__argument)that__beginnerscan__understandablyfind__difficultto__rationalize.In__real classes, however,to__helpget__thenewcomers__onboard__(andkeep__them awake),it__oftenhelps__tostop__andask__theexperts__inthe__audiencewhy__theyuse__OOP.The__answersthey__vegiven__mighthelp__shedsome__lighton__thepurpose__ofOOP__ifyou__renew__tothe__subject. Here, then,with__onlya__few embellishments,are__themost__commonreasons__touse__OOP,as__citedby__studentsover__the years:Code__reuseThis__ones__easyand__isthe__mainreason__forusing__OOP.By__supporting inheritance,classes__makeit__naturalto__programby__customizationinstead__ofstarting__eachproject__from scratch.Encapsulation__Wrappingup__implementationdetails__behindobject__interfacesinsulates__usersof__aclass__fromcode__changes.Structure__Classesprovide__newlocal__scopes,which__minimizesname__clashes.They__alsoprovide__anatural__placeto__writeand__lookfor__implementationcode__andto__manageobject__state.Maintenance__Classesnaturally__promotecode__factoring,which__allowsus__tominimize__redundancy.Thanks__toboth__thestructure__andcode__reusesupport__of classes,usually__onlyone__copyof__thecode__needsto__be changed.Consistency__Classesand__inheritanceallow__youto__implementcommon__interfacesand__hencecreate__acommon__lookand__feelin__your code;this__eases debugging, comprehension,and__maintenance.Polymorphism__Thisis__morea__propertyof__OOPthan__areason__forusing__it,but__bysupporting__code generality,polymorphism__makescode__moreflexible__andwidely__applicableand__hencemore__reusable.Other__And,of__course,the__numberone__reasonstudents__gavefor__using OOP:it__looksgood__ona__rsum__! (OK,this__onewas__addedas__a joke,but__itis__importantto__befamiliar__withOOP__ifyou__planto__workin__thesoftware__field today.) Finally,keep__inmind__theguidance__givenmultiple__timesin__thispart__ofthis__book:you__wont__fullyappreciate__OOPuntil__youve__usedit__fora__while.Pick__a project,study__larger examples,work__throughthe__exercises.Do__whateverit__takesto__getyour__feetwet__withOOP__code.It__soptional__stuffand__mayeven__beoverkill__insome__contexts,but__its__generallyworth__the effort.Part__VII.Exceptions__Chapter 33.Exception__BasicsThis__partof__thebook__dealswith__exceptionsevents__thatsignal__conditionsand__modifythe__flowof__controlthrough__a program.In__Python,exceptions__aretriggered__automaticallyon__errors,and__theycan__beboth__triggeredand__interceptedby__your code.They__areprocessed__byfour__statementswe__llstudy__here,the__firstof__whichcomes__inmultiple__flavorsthat__qualifyas__differentstatement__formsby__some measures: try/except/else/finallyCatch__andrecover__fromexceptions__raisedby__Python,or__byyou__raiseTrigger__anexception__manuallyin__yourcode__assertConditionally__triggeran__exceptionin__yourcode__withUse__contextmanagers__thatautomate__exceptionhandling__Weve__metsome__ofthese__briefly before,but__fullcoverage__ofthis__topicwas__saveduntil__theend__ofthe__mainpart__ofthis__bookbecause__youneed__toknow__aboutclasses__tocode__exceptionsof__your own. Still,with__afew__exceptions (pun intended),you__llfind__thatexception__handlingis__simplein__Pythonbecause__its__integratedinto__thelanguage__itselfas__another high-level tool.Before__wedig__intothe__how, though,let__sget__clearon__the why.Why__Use Exceptions?In__a nutshell,exceptions__letus__jumpout__ofarbitrarily__largechunks__ofa__program.Consider__thehypothetical__pizza-makingrobot__wediscussed__earlierin__the book.Suppose__wetook__theidea__seriouslyand__actuallybuilt__sucha__machine.To__makea__pizza,our__culinaryautomaton__wouldneed__toexecute__a plan,which__wewould__implementas__aPython__program:it__wouldtake__an order,prepare__the dough,add__toppings,bake__the pie,and__so on. Now,suppose__thatsomething__goesvery__wrongduring__thebake__thepie__step.Perhaps__theoven__is broken,or__perhapsour__robotmiscalculates__itsreach__andspontaneously__combusts. Clearly,we__wantto__beable__tojump__tocode__thathandles__suchunusual__states quickly.As__wehave__nohope__offinishing__thepizza__taskin__suchunusual__cases,we__mightas__wellabandon__theentire__plan.That__sexactly__whatexceptions__letyour__programs do:they__canjump__toan__exceptionhandler__ina__single step,abandoning__allactivity__begunsince__theexception__handlerwas__entered.Code__inthe__exceptionhandler__canthen__respondto__theraised__exceptionas__appropriate (bycalling__thefire__department,for__instance!).One__wayto__thinkof__anexception__isas__asort__ofstructured__go-to.An__exceptionhandler__(try statement)leaves__amarker__andexecutes__some code.Somewhere__furtherahead__inthe__program,an__exceptionis__raisedthat__makesPython__jumpback__tothat__marker,abandoning__anycode__thatwas__startedand__functionsthat__werecalled__afterthe__markerwas__left.The__neteffect__unwindsthe__programs__controlflow__backto__themarker__andresumes__there.This__protocolprovides__acoherent__wayto__respondto__unusual events. Moreover,because__Pythonjumps__tothe__handlerstatement__immediately,your__codeis__simplerthere__isusually__noneed__tocheck__statuscodes__afterevery__operationand__functioncall__thatcould__possibly fail. Instead,we__catcherrors__onlywhere__weneed__torecover__from them.Exception__RolesIn__lesshypothetical__programs,exceptions__servea__varietyof__purposes.Here__aresome__oftheir__mostcommon__roles:Error__handlingPython__raisesexceptions__wheneverit__detectserrors__inprograms__at runtime.You__cancatch__andrespond__tothe__errorsin__your code,or__ignorethe__exceptionsthat__are raised.If__anerror__is ignored,Python__sdefault__exception-handling__behaviorkicks__in:it__stopsthe__programand__printsan__error message.If__youdon__twant__thisdefault__behavior,code__atry__statementto__catchand__recoverfrom__theexception__Pythonwill__jumpto__yourtry__handlerwhen__theerror__isdetected__inthe__statements__code,and__yourprogram__willresume__executionafter__the try.Event__notificationExceptions__canalso__beused__tosignal__validconditions__withoutyou__havingto__passresult__flagsaround__aprogram__ortest__them explicitly.For__instance,a__searchroutine__mightraise__anexception__on failure,rather__thanreturning__aninteger__resultcode__andhoping__thatthe__codewill__neverbe__avalid__result. Special-casehandling__Sometimesa__conditionmay__occurso__rarelythat__its__hardto__justifyconvoluting__yourcode__tohandle__itin__multiple places.You__canoften__eliminate special-casecode__byhandling__unusualcases__inexception__handlersin__higherlevels__ofyour__program.An__assertcan__similarlybe__usedto__checkthat__conditionsare__asexpected__during development.Termination__actionsAs__youll__see,the__finallyoption__ina__trystatement__allowsyou__toguarantee__thatrequired__closing-timeoperations__willbe__performed,regardless__ofthe__presenceor__absenceof__exceptionsin__your programs.The__withstatement__offersan__alternativein__thisdepartment__forobjects__thatsupport__itsexpected__method-call protocol.Unusual__controlflows__Finally,because__exceptionsare__asort__of high-leveland__structured go-to,you__canuse__themas__thebasis__forimplementing__exoticcontrol__flows.For__instance,although__thelanguage__doesnot__explicitlysupport__backtracking,you__canimplement__itin__Pythonby__usingexceptions__andlogic__tounwind__assignments.1There__isno__goto__statementin__Python (thankfully)and__no built-inbacktracking__(today),but__exceptionscan__sometimesserve__similar roles;a__raise,for__instance,can__beused__tojump__outof__multipleloops__inways__thatbreak__cannot.We__sawsome__ofthese__rolesbriefly__earlierand__willstudy__typicalexception__usecases__inaction__laterin__thispart__ofthe__book.For__now,let__sget__startedwith__alook__atPython__s exception-processing tools. Exceptions:The__ShortStory__Comparedto__someother__corelanguage__topicswe__veexplored__inthis__book,exceptions__area__fairlylightweight__toolin__Python.Because__theyare__so simple,let__sjump__rightinto__some code.Default__ExceptionHandler__Supposewe__writethe__followingfunction__inthe__interactiveREPL__ofour__choice: >>>def__fetcher(obj, index):return__obj[index]There__snot__muchto__thisfunction__itsimply__indexesan__objecton__a passed-in index.In__normal operation,it__returnsthe__resultof__alegal__index: >>>food__= 'pizza' >>> fetcher(food, 4) #Like__x[4],last__item 'a' However,if__weask__thisfunction__toindex__offthe__endof__the string,an__exceptionwill__betriggered__whenthe__functiontries__torun__obj[index].Python__detects out- of-boundsindexing__forsequences__andreports__itby__raising (triggering)the__built-in__IndexError exception: >>> fetcher(food, 5) #Default__handlerconsole__interfaceTraceback__(mostrecent__call last):File__"",line__1,in__File "",line__2,in__fetcher IndexError:string__indexout__ofrange__Becauseour__codedoes__notexplicitly__catchthis__exception,it__filtersback__upto__thetop__levelof__theprogram__andinvokes__thedefault__exception handler,which__simplyprints__thestandard__errormessage__shown here.By__thispoint__inthe__book,you__veprobably__seenyour__shareof__standarderror__messages.They__includethe__exceptionthat__was raised,along__witha__stacktrace__alist__ofall__thelines__andfunctions__thatwere__activewhen__theexception__occurred,which__hasbeen__largelyomitted__inthis__bookfor__spaceand__brevity.The__errormessage__texthere__wasprinted__byPython__3.12in__a console.It__canvary__slightlyper__release,and__evenper__interactive REPL,so__youshouldn__trely__uponits__exactform__ineither__thisbook__oryour__code.When__youre__codinginteractively__ina__console interface,the__filenamemay__bejust__,meaning__thestandard__input stream.When__workingin__theIDLE__GUIs__interactiveshell__today, though,the__filenameis__,and__sourcelines__are displayed, too.Either__way,file__linenumbers__arenot__verymeaningful__whenthere__isno__file (youll__seemore__interestingerror__messageslater__inthis__partof__the book): >>> fetcher(food, 5) #Default__handlerIDLE__GUIinterface__Traceback (mostrecent__call last):File__"",line__1,in__fetcher(food, 5)File__"",line__2,in__fetcherreturn__obj[index] IndexError:string__indexout__ofrange__Ina__morerealistic__programlaunched__outsidethe__interactive REPL,after__printingan__errormessage__thedefault__handlerat__thetop__alsoterminates__theprogram__immediately.That__courseof__actionmakes__sensefor__simple scripts;errors__oftenshould__be fatal,and__thebest__youcan__dowhen__theyoccur__isinspect__thestandard__error message.Catching__Exceptions Sometimes, though,program__terminationon__exceptionsisn__twhat__you want.Server__programs,for__instance,typically__needto__remainactive__evenafter__internal errors.If__youdon__twant__thedefault__exception behavior,wrap__thecall__ina__trystatement__tocatch__exceptionsyourself__(copy/pasters:omit__the ...here__perthe__note ahead): >>> try: ... fetcher(food, 5) ...except__IndexError: #Catch__andrecover__... print('got exception') ...got__exception >>> Now,Python__automaticallyjumps__toyour__handlerthe__blockunder__theexcept__clausethat__namesthe__exceptionraised__whenan__exceptionis__triggeredwhile__thetry__blockis__running.The__neteffect__isto__wrapa__nestedblock__ofcode__inan__errorhandler__thatintercepts__theblock__s exceptions.When__workinginteractively__like this,after__theexcept__clause runs,we__windup__backat__thePython__prompt.In__amore__realistic program,try__statementsnot__onlycatch__exceptionsbut__alsorecover__from them: >>>def__catcher(): try: fetcher(food, 5)except__IndexError: print('got exception') #Catch__andrecover__more print('continuing') >>> catcher()got__exceptioncontinuing__>>>This__time,after__theexception__iscaught__and handled,the__programresumes__executionafter__theentire__trystatement__thatcaught__itwhich__iswhy__weget__thecontinuing__message here.We__dont__seethe__standarderror__message,and__theprogram__continueson__itsway__normally. Notice, though,that__theres__noway__inPython__togo__backto__thecode__thattriggered__theexception__(shortof__rerunningthe__codethat__reachedthat__pointall__over again,of__course).Once__youve__caughtthe__exception,control__continuesafter__theentire__trythat__caughtthe__exception,not__afterthe__statementthat__kickedoff__the exception.In__fact,Python__clearsthe__memoryof__anyfunctions__thatwere__exitedas__aresult__ofthe__exception,like__fetcherin__our example;their__variablesare__discarded,and__theyre__not resumable.The__tryboth__catchesexceptions__andis__wherethe__program resumes.Python__does not, however,undo__anywork__doneby__thetry__blockup__tothe__pointwhere__theexception__occurredany__changesmade__toreferenced__mutableobjects__andaccessible__globalnames__live on.This__isnt__aproblem__ifit__s known: >>> L,S__= [], 'text' >>>def__modder(): L.append('added') #Change__amutable__global S;S__= 'changed' #Change__aglobal__fetcher(food, 5) #Trigger__anexception__>>> try: ... modder() ...except__IndexError: ... print('got exception') ...got__exception >>> L,S__#Changes__retained (['added'], 'changed')As__youll__seelater__inthis__partof__the book,the__trycan__alsouse__except*clauses__toprocess__multiple exceptions,but__thisis__aconvoluted__extensionwith__narrowscope__thatdoesn__tplay__wellwith__others,and__youcan__safelydefer__studyinguntil__youve__masteredthe__fundamentals.NOTE__Presentation note:The__interactiveREPL__s ...continuation__promptreappears__inthis__partfor__some top-leveltry__statements,because__theircode__wont__workif__copiedand__pastedunless__nestedin__afunction__orclass__(theexcept__andother__linesmust__alignwith__the try,and__nothave__extrapreceding__spacesthat__areneeded__toillustrate__theirindentation__structure here).To__run,simply__typeor__pastestatements__with ...prompts__oneline__ata__time,and__withouttheir__leading ... prompts.Raising__ExceptionsSo__far,we__vebeen__lettingPython__raiseexceptions__forus__bymaking__mistakes (onpurpose__this time!),but__ourscripts__canraise__exceptionstoo__that is,exceptions__canbe__raisedby__Pythonor__byyour__program,and__canbe__caughtor__not.To__triggeran__exception manually,simply__runa__raise statement. User-triggeredexceptions__arecaught__thesame__wayas__thosePython__raises.The__followingmay__notbe__themost__usefulPython__codeever__penned,but__itmakes__thepoint__raisingthe__built-in__IndexError exception: >>> try: ...raise__IndexError #Trigger__exceptionmanually__...except__IndexError: ... print('got exception') ...got__exceptionAs__usual,if__theyre__not caught, user-triggeredexceptions__arepropagated__upto__the top-leveldefault__exceptionhandler__andterminate__theprogram__witha__standarderror__message: >>>raise__IndexErrorTraceback__(mostrecent__call last):File__"",line__1,in__IndexErrorAs__youll__seein__thenext__chapter,the__assertstatement__canbe__usedto__trigger exceptions,too__its__aconditional__raisepredicated__ona__test,used__mostlyfor__debuggingpurposes__andsanity__checksduring__development: >>>assert__1 < 0, 'Notin__this universe!'Traceback__(mostrecent__call last):File__"",line__1,in__AssertionError:Not__inthis__universe!Also__inthe__next chapter,you__lllearn__thatraise__canuse__afrom__clauseto__chain exceptions;generally__speaking,this__isnot__common,but__canbe__usedto__givemore__contextwhere__its__useful. User-DefinedExceptions__Theraise__statementdemos__inthe__priorsection__raised IndexError,a__built-inexception__definedin__Pythons__built-in scope.As__youll__learnlater__inthis__partof__the book,you__canalso__definenew__exceptionsof__yourown__thatare__specificto__your programs. User-definedexceptions__arecoded__with classes,which__inheritfrom__a built-inexception__class usually,the__classnamed__Exception: >>>class__Combust(Exception):pass__# User-definedexception__>>>def__makePizza():raise__Combust() #Raise__aninstance__>>> try: ... makePizza() ...except__Combust: #Catch__classname__... print('got exception') ...got__exception >>>As__youll__seein__upcoming chapters,exception__classesallow__scriptsto__buildexception__categories,which__caninherit__behaviorand__haveattached__stateinformation__and methods,and__anas__clauseon__anexcept__cangain__accessto__theexception__object itself.Exception__classescan__alsocustomize__theirmessage__textdisplayed__ifthey__renot__caught: >>>class__Combust(Exception):def____str__(self):return__'Callthe__fire department!...' >>>raise__Combust()Traceback__(mostrecent__call last):File__"",line__1,in__Combust:Call__thefire__department!... >>>Termination__Actions Finally,try__statementscan__sayfinally__that is,they__mayinclude__finally blocks.These__looklike__excepthandlers__for exceptions,but__the try/finallycombination__specifiestermination__actionsthat__alwaysexecute__onthe__way out,regardless__ofwhether__anexception__occursin__thetry__blockor__not.Continuing__ourREPL__session: >>> try: ... fetcher(food, 4) ... finally: #Termination__actions ... print('after fetch') ... 'a'after__fetch >>> Here,if__thetry__blockfinishes__withoutan__exception,the__finallyblock__will run,and__theprogram__willresume__afterthe__entire try.In__this case,this__statementseems__abit__sillywe__mightas__wellhave__simplytyped__theprint__rightafter__acall__tothe__function,and__skippedthe__try altogether: fetcher(food, 4) print('after fetch')There__isa__problemwith__codingthis__way, though:if__thefunction__callraises__an exception,the__printwill__neverbe__reached.The__try/finallycombination__avoidsthis__pitfallwhen__anexception__doesoccur__ina__try block,finally__blocksare__executedwhile__theprogram__isbeing__unwound: >>>def__after(): try: fetcher(food, 5) finally: print('after fetch') #Always__run print('after try?') #Run__onlyif__noexception__>>> after()after__fetchTraceback__(mostrecent__call last):File__"",line__1,in__File "",line__3,in__afterFile__"",line__2,in__fetcher IndexError:string__indexout__ofrange__>>> Here,we__dont__getthe__after try?message__becausecontrol__doesnot__resumeafter__thetry__statementwhen__anexception__occurs. Instead,Python__jumpsback__torun__thefinally__actionand__thenpropagates__theexception__upto__aprior__handler (inthis__case,to__thedefault__handlerat__the top).If__wechange__thecall__insidethis__functionso__asnot__totrigger__an exception,the__finallycode__still runs,but__theprogram__continuesafter__the try: >>>def__after(): try: fetcher(food, 4) finally: print('after fetch') #Both__runif__noexception__print('after try?') >>> after()after__fetchafter__try? >>>In__practice,except__clausesin__atry__areuseful__forcatching__andrecovering__from exceptions,and__finallyclauses__comein__handyto__guaranteethat__terminationactions__willfire__regardlessof__anyexceptions__thatmay__occurin__thetry__blocks__code.For__instance,you__mightuse__try/exceptcombinations__tocatch__errorsraised__bycode__thatyou__importfrom__a third-party library,and__try/finallycombos__toensure__thatcalls__toclose__filesor__terminateserver__connectionsare__always run.We__llcode__somesuch__practicalexamples__laterin__thispart__ofthe__book.Although__theyserve__conceptuallydistinct__purposes,you__canalso__mixexcept__andfinally__clausesin__thesame__trystatement__thefinally__isrun__onthe__wayout__regardlessof__whetheran__exceptionwas__raised,and__regardlessof__whetherthe__exceptionwas__caughtby__anexcept__clause.Such__comboshave__rulesyou__llmeet__inthe__next chapter.As__youll__alsolearn__inthe__next chapter,Python__providesan__alternativeto__the try/finallymix__whenusing__sometypes__of built-inand__user-defined objects.The__withstatement__runsa__contextmanager__objects__methodsto__guaranteethat__terminationactions__occur,irrespective__ofany__exceptionsin__itsnested__block: >>>with__open('pizzarobot.txt', 'w')as__file: #Always__closefile__onexit__file.write('Catch fire!\n')Although__thisoption__requiresfewer__linesof__code,it__sapplicable__onlywhen__processingcertain__object types,so__try/finallyis__amore__generaltermination__structure,and__isoften__simplerthan__codinga__classin__caseswhere__withis__notalready__supported.On__theother__hand,with__mayalso__runstartup__actions too,and__supports user-definedcontext__managementcode__withaccess__toPython__sfull__OOP toolset.To__see how,let__smove__onto__thenext__chapter.Chapter__SummaryAnd__thatis__themajority__ofthe__exception story;exceptions__reallyare__asimple__tool.To__summarize,Python__exceptionsare__a control-flow device.They__maybe__raisedby__Python,or__byyour__own programs.In__both cases,they__maybe__ignored (totrigger__thedefault__error handler),or__caughtby__trystatements__(tobe__processedby__your code).The__trystatement__comesin__logicallydistinct__formsthat__canbe__combinedone__thathandles__exceptions,and__onethat__runsfinalization__coderegardless__ofwhether__exceptionsoccur__or not.Python__sraise__andassert__statementstrigger__exceptionson__demandboth__built-insand__newexceptions__wedefine__withclasses__andthe__withstatement__isan__alternativeway__toensure__thattermination__actionsare__carriedout__forobjects__thatsupport__it.In__therest__ofthis__partof__the book,we__llfill__insome__ofthe__detailsabout__thestatements__involved,examine__theother__sortsof__clausesthat__canappear__undera__try (spoiler:it__alsoallows__anelse__forthe__no-exception case),and__discuss class-based__exception objects.The__nextchapter__beginsour__tourby__takinga__closerlook__atthe__statementswe__introduced here.Before__youturn__the page, though,here__area__fewquiz__questionsto__review.Test__Your Knowledge:Quiz__1.Name__threethings__thatexception__processingis__good for. 2.What__happensto__anexception__ifyou__dont__doanything__specialto__handle it? 3.How__canyour__scriptrecover__froman__exception? 4.Name__twoways__totrigger__exceptionsin__your script. 5.Name__twoways__tospecify__actionsto__berun__attermination__time,whether__anexception__occursor__not.Test__Your Knowledge:Answers__1.Exception__processingis__usefulfor__error handling,termination__actions,and__event notification.It__canalso__simplifythe__handlingof__specialcases__andcan__beused__toimplement__alternativecontrol__flowsas__akind__ofstructured__go-to operation.In__general,exception__processingalso__cutsdown__onthe__amountof__error-checkingcode__yourprogram__mayrequire__becauseall__errorsfilter__upto__handlers,you__maynot__needto__testthe__outcomeof__everyoperation__(seethis__chapters__sidebarWhy__YouWill__Care:Error__Checksfor__an illustration). 2.Any__uncaughtexception__eventuallyfilters__upto__thedefault__exceptionhandler__Pythonprovides__atthe__topof__your program.This__handlerprints__thefamiliar__errormessage__andshuts__downyour__program. 3.If__youdon__twant__thedefault__messageand__shutdown,you__cancode__trystatements__withexcept__clausesto__catchand__recoverfrom__exceptionsthat__areraised__withinits__nestedcode__block.Once__anexception__is caught,the__exceptionis__terminatedand__yourprogram__continuesafter__the try. 4.The__raiseand__assertstatements__canbe__usedto__triggeran__exception,exactly__asif__ithad__beenraised__byPython__itself.In__principle,you__canalso__raisean__exceptionby__makinga__programming mistake,but__thats__notusually__anexplicit__goal! 5.The__trystatement__witha__finallyclause__canbe__usedto__ensureactions__arerun__aftera__blockof__code exits,regardless__ofwhether__theblock__raisesan__exceptionor__not.The__withstatement__canalso__beused__toensure__terminationactions__are run,but__onlywhen__processingobject__typesthat__support it.WHY__YOUWILL__CARE:ERROR__CHECKSOne__wayto__seehow__exceptionsare__usefulis__tocompare__codingstyles__inPython__andlanguages__without exceptions.For__instance,if__youwant__towrite__robustprograms__inthe__C language,you__generallyhave__totest__returnvalues__orstatus__codesafter__everyoperation__thatcould__possiblygo__astray,and__propagatethe__resultsof__thetests__asyour__programs run: doStuff() { #C__programif__(doFirstThing() == ERROR) #Detect__errorseverywhere__return ERROR; #even__ifnot__handledhere__if (doNextThing() == ERROR)return__ERROR; ...return__doLastThing(); } main() {if__(doStuff() == ERROR) badEnding();else__goodEnding(); }In__fact,realistic__Cprograms__oftenhave__asmuch__codedevoted__toerror__detectionas__todoing__actual work.But__in Python,you__dont__haveto__beso__methodical (and neurotic!).You__caninstead__wraparbitrarily__vastpieces__ofa__programin__exceptionhandlers__andsimply__writethe__partsthat__dothe__actual work,assuming__allis__normally well:def__doStuff(): #Python__code doFirstThing() #We__don'tcare__aboutexceptions__here, doNextThing() #so__we don'tneed__todetect__them ... doLastThing()if____name__ == '__main__': try: doStuff() #This__iswhere__wecare__about results, except: #so__it'sthe__onlyplace__wemust__check badEnding() else: #See__thenext__chapterfor__else goodEnding()Because__controljumps__immediatelyto__ahandler__whenan__exception occurs,there__sno__needto__instrumentall__yourcode__toguard__for errors,and__theres__noextra__performanceoverhead__torun__allthe__tests. Moreover,because__Pythondetects__errors automatically,your__codeoften__doesnt__needto__checkfor__errorsin__thefirst__place.The__upshotis__thatexceptions__letyou__largelyignore__theunusual__casesand__avoid error-checkingcode__thatcan__distractfrom__yourprogram__s purpose. 1For__anycomputer__scientistsin__the audience,true__backtrackingis__notpart__ofthe__Python language.Backtracking__undoescomputations__beforeit__jumps back,but__Pythonexceptions__do not:local__variablesin__openfunction__callsrun__bythe__tryare__simply discarded,but__changesmade__toglobals__andobjects__areretained__(seethe__demo ahead).Even__thegenerator__functionsand__expressionswe__metin__Chapter 20don__tdo__fullbacktracking__theysimply__respondto__next(G)requests__byrestoring__savedstate__and resuming.For__moreon__backtracking,try__bookson__AIor__theProlog__orIcon__programming languages.Chapter__34.Exception__CodingDetails__Theprior__chapterprovided__aquick__lookat__exception-relatedstatements__in action. Here,we__regoing__todig__abit__deeperthis__chapterprovides__fullercoverage__of exception-processingsyntax__in Python. Specifically,we__llexplore__thedetails__behindthe__try, raise, assert,and__with statements.Although__thesestatements__aremostly__straightforward,you__llfind__thatthey__offerpowerful__toolsfor__dealingwith__exceptionalconditions__inPython__code.The__tryStatement__First up,the__trystatement__ishow__yourcode__catches exceptions.In__short,if__anexception__occurswhile__runningthis__statements__main block,the__programjumps__backto__runone__ofthe__statements__handlersand__continuesfrom__there.Its__handlersmay__bespecified__by except, else, finally,and__except*clauses__nestedin__the try,and__separaterules__applyto__theseclauses__syntax,and__theirvalid__combinations.This__isa__simplemodel__onthe__surface,but__thetry__statements__handlerclauses__havedisjoint__purposes,and__itsrules__forvalid__combinationsmean__thatit__comesin__distinct flavors.Because__of this,we__llapproach__thissubject__byexploring__thetry__scommon__rolesin__isolationfirst__andputting__theirpieces__togetherlater__asa__combined statement.This__parallelsthe__factthat__tryreally__wasseparate__statementsin__Pythons__dim past,but__ourfocus__hereis__onits__unified present.Although__technicallypart__ofthe__try,we__llalso__deferthe__except*clause__untilthe__next chapter,partly__becauseit__encroacheson__thatchapter__s exception-object topic,but__mostlybecause__thisis__atool__thatcomplicates__thetry__storysubstantially__foran__extensionthat__srarely__usefulin__practice.Our__priorityhere__islearning__the fundamentals.try__StatementClauses__Whenyou__writea__try statement,a__varietyof__clausescan__appearafter__andbelow__thetry__header.Table__34-1summarizes__allthe__possibleforms__asboth__referenceand__preview.We__vealready__seenthat__exceptclauses__catchexceptions__andfinally__clausesrun__onthe__way out.New__here,else__clausesrun__ifno__exceptionsare__encountered,and__except*clauses__processexception__groupsand__supportall__exceptforms__exceptthe__empty. Formally,a__trymust__useat__leastone__ofthe__clausesin__Table 34-1.There__maybe__anynumber__ofexcept__clauses,but__youcan__codeelse__onlyif__thereis__atleast__one except,and__therecan__beonly__oneelse__andone__finally.A__finallycan__appearin__thesame__statementas__exceptand__else,with__orderingrules__givenlater__inthis__chapter.Table__34-1.try__statementclauses__andforms__Clauseform__Interpretation except:Catch__all (orall__other)exception__typesexcept__name:Catch__aspecific__exceptiononly__exceptname__as var:Catch__thelisted__exceptionand__assignits__instanceexcept__(name1, name2):Catch__anyof__theexceptions__listedin__atuple__except (name1, name2)as__var:Catch__anylisted__exceptionand__assignits__instance else:Run__ifno__exceptionsare__raisedin__thetry__block finally:Always__performthis__blockon__exit,exception__ornot__except*nonempty__exceptforms__:Catch__multipleexceptions__ina__group (Chapter 35)We__llexplore__theas__varpart__availablein__someof__Table 34-1s__clausesin__moredetail__whenwe__meetthe__raisestatement__laterin__thischapter__becauseit__providesaccess__tothe__objectraised__asan__exceptionvia__var.Before__all that,let__sget__startedby__examiningthe__morecommon__clausesof__Table 34-1more__closely.The__exceptand__elseClauses__Syntactically,the__tryis__a compound,multipart__statement.It__startswith__atry__header line,followed__bya__blockof__(usually)indented__statements,which__isfollowed__byclauses__thateach__identifya__conditionto__behandled__andgive__ablock__ofstatements__tohandle__it.In__itsmost__common form,try__iscoded__withone__ormore__exceptclauses__andan__optionalelse__clauseat__the end.You__associatethe__words try, except,and__elseby__indentingthem__tothe__samelevel__(i.e.,lining__themup__vertically),like__this: try:statements__#Run__thismain__actionfirst__except name1:statements__#Run__if name1is__raisedduring__thetry__blockexcept__(name2, name3):statements__#Run__if name2or__name3occur__inthe__tryexcept__name4as__var:statements__#Run__if name4is__raised,and__assignit__tovar__except:statements__#Run__forall__otherexceptions__raised else:statements__#Run__ifno__exceptionwas__raisedin__thetry__block Semantically,the__blockunder__thetry__headerin__thisstatement__representsthe__mainaction__ofthe__statementthe__codeyou__retrying__to run,and__wrappingin__exception handlers.The__restof__thestatement__definesthe__handlers themselves:except__clausesgive__handlersfor__exceptionsraised__duringthe__try block,and__theoptional__elseclause__givesa__handlerrun__ifno__exceptionsoccur__inthe__try block.Within__a try,each__exceptnames__exceptionsto__catch:a__singleexception__catchesjust__that exception,a__tuplecatches__anyexception__inthe__tuple,and__anexcept__thatomits__theexception__altogethermatches__all (orall__other) exceptions.Each__nonemptyexcept__canalso__givea__variablename__afteras__tobe__assignedthe__exceptionobject__raisedby__Pythonor__raise statements; again,we__llexplore__thisoption__ahead.How__trystatements__work Operationally,here__show__trystatements__are run.When__atry__statementis__entered,Python__recordsthe__currentprogram__contextso__itcan__returnto__itif__anexception__occurs.The__statementsnested__underthe__tryheader__arerun__first.What__happensnext__dependson__whetheran__exceptionis__raisedwhile__thetry__blocks__statementsare__running,and__whethera__raisedexception__matchesany__ofthose__thatthe__tryis__watching for:Exception__andmatch__Ifan__exceptionoccurs__whilethe__tryblock__sstatements__are running,and__theexception__matchesone__thatthe__statement names,Python__jumpsback__tothe__tryand__runsthe__statementsunder__itstopmost__exceptclause__thatmatches__theraised__exception,after__assigningthe__raisedexception__objectto__thevariable__namedby__asin__theclause__(if present).After__theexcept__block runs,control__resumesbelow__theentire__try statement.If__theexcept__blockitself__raisesanother__exception,the__propagationprocess__isstarted__anewfrom__thispoint__inthe__code.Exception__andno__matchIf__anexception__occurswhile__thetry__blocks__statementsare__running,but__theexception__doesnot__matchone__thatthe__statement names,the__exceptionis__propagatedup__tothe__nextmost__recentlyentered__trystatement__thatmatches__the exception;if__nosuch__matchingtry__statementcan__befound__andthe__searchreaches__thetop__levelof__the program,Python__printsa__defaulterror__messageand__terminatesthe__program (unlessit__sthe__REPL).No__exceptionIf__anexception__doesnot__occurwhile__thetry__blocks__statementsare__running,Python__runsthe__statementsunder__theelse__clause (if present),and__controlthen__resumesbelow__theentire__try statement.If__theelse__blockitself__raisesanother__exception,it__kicksoff__thepropagation__process again.In__sum,except__clausescatch__anymatching__exceptionsthat__happenwhile__thetry__blockis__running,and__theelse__clauseruns__onlyif__noexceptions__happenwhile__thetry__block runs.Exceptions__raisedare__matchedto__exceptionsnamed__inexcept__clausesby__classrelationships__well__exploreboth__aheadand__inthe__nextchapter__(brief:a__subclassmatches__its superclass),and__theempty__exceptclause__withno__exceptionname__matchesany__exception.In__effect,except__clausesare__focusedexception__handlersthey__catchexceptions__thatoccur__onlywithin__thestatements__inthe__associatedtry__block. However,as__thetry__blocks__statementscan__callfunctions__codedelsewhere__ina__program,the__sourceof__anexception__mayvery__wellbe__outsidethe__codeof__thetry__statement itself.In__fact,a__tryblock__mightinvoke__arbitrarilylarge__amountsof__programcode__includingcode__thatmay__havetry__statementsof__its own,which__willbe__searchedfirst__whenexceptions__occur.In__other words,because__trystatements__cannest__at runtime,where__anexception__goesdepends__onthe__coderun__before it,a__phenomenonwe__llexplore__inChapter__36.If__afinally__clauseis__addedto__a try,its__codeblock__isrun__forall__threeof__thecases__listed previously,as__youll__see ahead. First, though,let__stake__alook__atsome__commonvariations__of exception-catching clauses.Catching__manyexceptions__witha__tuplePer__thefourth__andfifth__entriesin__Table 34-1,except__clausesthat__listmany__exceptionsin__aparenthesized__tuplecatch__anyof__thelisted__exceptions.Because__Pythonlooks__fora__matchwithin__agiven__tryby__inspectingthe__exceptclauses__fromtop__to bottom,the__tupleversion__hasthe__sameeffect__aslisting__eachexception__inits__ownexcept__clause,but__youhave__tocode__thecommon__statementbody__associatedwith__eachonly__once.Here__sa__partialexample__ofmultiple__exceptclauses__at work,which__demosjust__howspecific__yourhandlers__can be: try:except__NameError:except__IndexError:except__(AttributeError, TypeError, SyntaxError):If__anexception__israised__whilethis__tryblock__is running,Python__returnsto__thetry__andsearches__forthe__firstexcept__thatnames__theexception__raised.It__inspectsclauses__fromtop__tobottom__andleft__toright__alongthe__wayand__runsthe__statementsunder__thefirst__clausethat__matches.If__none match,the__exceptionis__propagatedpast__this try.Note__thatparentheses__arerequired__aroundthe__tuplein__theany__form,and__usingan__asin__thisform__letsyou__checkwhich__exceptionoccurred__whenyou__listed many: try:except__(AttributeError, TypeError, SyntaxError)as__What:and__checkWhat__Tolearn__moreabout__both as,as__wellas__whathappens__whenno__except matches,we__mustmove__on.Catching__allexceptions__withempties__andException__Perthe__firstentry__inTable__34-1,except__clausesthat__listno__exceptionname__catchall__exceptionsnot__previouslylisted__inthe__try statement.That__is,if__youwant__tocode__ageneral__catchallhandler__tobe__runwhen__noother__exceptclause__matchesthe__exception raised,an__emptyexcept__doesthe__trick: try:except__NameError: #Handle__NameErrorexcept__IndexError: #Handle__IndexError except: #Handle__allother__exceptions else: #Handle__the no-exceptioncase__(preview)The__emptyexcept__clauseis__asort__ofwildcard__featurebecause__itcatches__everything,adding__itto__themix__allowsyour__handlersto__beas__generalor__specificas__you like.In__some scenarios,this__formmay__bemore__convenientthan__listingall__possibleexceptions__ina__tryespecially__whenworking__interactivelyin__a REPL,or__writingcode__thatmust__recoverno__matterwhat__occurs.For__example,the__followingcatches__everythingby__notlisting__anything: try: except: #Catch__allpossible__exceptionsThat__being shown,the__emptyexcept__canalso__cause problems.It__maycatch__unexpected exceptions,and__interceptevents__unrelatedto__yourcode__andrequired__byanother__handler.For__example,even__systemexit__callsand__Ctrl+C key-combination__interruptsin__Pythonwork__bytriggering__exceptions,and__youusually__wantthese__to pass.Perhaps__worse,the__emptyexcept__mayalso__catchgenuine__programmingmistakes__forwhich__youprobably__wantto__seean__error message. Otherwise,you__maynot__evenknow__thata__bugexists__untilit__stoo__lateto__avoida__users__report.We__llrevisit__thisas__agotcha__atthe__endof__thispart__ofthe__book.For__now,the__standarduse__withcare__applies.Python__providesan__alternativethat__solvesat__leastone__ofthese__problemscatching__the built-inException__hasalmost__thesame__effectas__anempty__except,but__wont__catchexceptions__relatedto__systemexits__and Ctrl+C: try:except__Exception: #Catch__allpossible__exceptions -except__exitsWe__llexplore__howthis__formdoes__itsmagic__formallyin__thenext__chapterwhen__westudy__exception classes.In__short,it__worksbecause__exceptionsmatch__ifthey__area__subclassof__onenamed__inan__except clause,and__Exceptionis__asuperclass__ofall__theexceptions__youshould__generallycatch__this way.This__formhas__mostof__thesame__convenienceof__theempty__exceptwithout__therisk__ofcatching__exitevents__andalso__allowsyou__tocheck__theexception__raisedvia__as.While__better, though,it__alsohas__someof__thesame__risksit__maystill__maskand__silentlyignore__programming errors.The__openingsnippet__ofthis__sectiondeliberately__listedan__else clause,to__callout__thatit__isnot__acatchall__likethe__emptyexcept__anunderstandable__sourceof__confusionfor__try newcomers.The__nextsection__dissectsthe__difference.Catching__the no-exceptioncase__withelse__All told,else__canbe__usedin__threeplaces__in Python:in__if selections,for__andwhile__loops,and__tryexception__handlers.In__the latter,else__isrun__whenno__exceptionoccurs__notfor__unmatchedexceptions__(thats__whatthe__priorsection__sempty__exceptis__for).This__elserole__mayseem__differentthan__inif__and loops,but__thiscontext__differs.The__needfor__anelse__clausein__tryis__notalways__obviousto__Python beginners.Without__it, though,there__isno__directway__totell__whetherthe__flowof__controlhas__proceededpast__atry__statementbecause__noexception__was raised,or__becausean__exceptionoccurred__andwas__handled.Either__way,we__windup__afterthe__try: try:run__codeexcept__IndexError:handle__exception #Did__weget__herebecause__thetry__failedor__not?Of__course,we__could initialize, set,and__checka__Booleanflag__toknow__what happened,which__addslines__ofadmin__code.Much__likethe__wayelse__clausesin__loopsmake__theexit__causemore__apparent (forexits__sans break),the__elseclause__providessyntax__intry__thatmakes__theoutcome__unambiguouswith__minimalextra__code: try:run__codeexcept__IndexError:handle__exception else:no__exceptionoccurred__Youcan__almostemulate__anelse__clauseby__movingits__codeinto__thetry__block: try:run__codeno__exceptionoccurred__except IndexError:handle__exceptionThis__canlead__toincorrect__exception classifications, though.If__theno__exceptionoccurred__actionitself__causesan__IndexError,it__willregister__asa__failureof__thetry__blockand__erroneouslytrigger__theexception__handlerbelow__thetry__(unlikely perhaps,but__true).By__usingan__explicitelse__clause instead,you__makethe__logicmore__obviousand__guaranteethat__excepthandlers__willrun__onlyfor__realfailures__inthe__codeyou__rewrapping__ina__try,not__forfailures__inthe__else no-exceptioncase__s action. Example:Default__behaviorBecause__thecontrol__flowthrough__aprogram__maybe__easierto__capturein__Pythonthan__in English,let__srun__somesimple__examplesthat__furtherillustrate__exceptionbasics__withreal__codein__files.As__noted,exceptions__notcaught__bytry__statementspercolate__upto__thetop__levelof__thePython__processand__runPython__sdefault__exception-handlinglogic__(i.e.,Python__terminatesthe__runningprogram__andprints__astandard__error message).To__illustrate,module__file crashware.pycoded__inExample__34-1generates__a divide- by-zeroexception__by design.Example__34-1. crashware.pydef__gobad(x, y):return__x /y__def gosouth(x): print(gobad(x, 0))if____name__ == '__main__': gosouth(1)Because__theprogram__ignoresthe__exceptionit__triggers,Python__killsthe__programand__printsa__message (editedhere__tocondense__pathsand__dropsome__interfaces code-pointerlines__for space): $ python3 crashware.pyTraceback__(mostrecent__call last):File__"/ /LP6E/Chapter34/crashware.py",line__7,in__if__name____== '__main__': gosouth(1)File__"/ /LP6E/Chapter34/crashware.py",line__5,in__gosouth print(gobad(x, 0))File__"/ /LP6E/Chapter34/crashware.py",line__2,in__gobadreturn__x /y__ZeroDivisionError:division__byzero__Thismessage__consistsof__astack__trace (Traceback__)and__thename__ofand__detailsabout__theexception__thatwas__raised.The__stacktrace__listsall__linesactive__whenthe__exception occurred,from__oldestto__newest.Note__thatbecause__thiscode__waswritten__ina__fileinstead__ofa__REPL,the__fileand__line-numberinformation__ismore__useful here.For__example,we__cansee__thatthe__baddivide__happensat__thelast__entryin__thetrace__line 2of__thefile__crashware.py,a__return statement.Because__Pythondetects__andreports__allerrors__atruntime__byraising__exceptionslike__this,exceptions__areintimately__boundup__withthe__ideasof__errorhandling__anddebugging__in general.If__youve__workedthrough__thisbook__s examples,you__veundoubtedly__seenan__exceptionor__twoalong__theway__eventypos__usuallygenerate__aSyntaxError__orother__exceptionwhen__afile__isimported__orexecuted__(thats__whenthe__codecompiler__is run).By__default,programming__errorsgenerate__auseful__errordisplay__likethe__onejust__shown,which__helpsyou__trackdown__the problem.In__some interfaces,this__messagetoday__evencomes__withpointers__tooffending__expressions,as__wellas__speculativebut__mandatoryDid__you?tips__(whosemerit__youmay__wishto__reweighlater__inyour__Python career): $ python3 >>>import__crashware >>> crashware.gobad(1, 0)Traceback__(mostrecent__call last):File__"",line__1,in__File "/ /LP6E/Chapter34/crashware.py",line__2,in__gobadreturn__x /y__~~^~~ ZeroDivisionError:division__byzero__Often,this__standarderror__messageis__allyou__needto__resolveproblems__inyour__code.For__more heavy-dutydebugging__jobs,you__cancatch__exceptionswith__try statements,or__usedebugging__toolsintroduced__inChapter__3,such__asthe__pdb standard-library module.See__DebuggingPython__Codefor__morerelated__tips. Example:Catching__built-inexceptions__Pythons__errorchecking__anddefault__exceptionhandling__isoften__exactlywhat__you want:especially__forcode__ina__top-levelscript__file,an__erroroften__shouldterminate__yourprogram__immediately.For__many programs,there__isno__needto__bemore__specificabout__errorsin__your code. Sometimes, though,you__llwant__tocatch__errorsand__recoverfrom__them instead.If__youdon__twant__yourprogram__terminatedwhen__Pythonraises__an exception,simply__catchit__bywrapping__theprogram__logicin__a try.This__isan__importantcapability__forprograms__suchas__network servers,which__mustkeep__running persistently.For__example,the__codein__Example 34-2,file__kaboom.py,catches__andrecovers__fromthe__TypeErrorPython__raisesimmediately__whenyou__tryto__concatenatea__listand__astring__(remember,the__+operator__expectsthe__samesequence__typeon__both sides).Example__34-2. kaboom.pydef__kaboom(x, y): print(x + y) #Trigger__TypeErrordef__serve(n=2): #Simulate__long-runningtask__fori__in range(n): try: kaboom([1, 2], 'hack')except__TypeError: #Catch__andrecover__here print('Hello world!') print('Resuming here...') #Continue__hereif__exceptionor__notif____name__ == '__main__': serve()When__theexception__occursin__thefunction__kaboom,control__jumpsto__thetry__statements__except clause,which__printsa__message.Since__anexception__isdead__afterit__sbeen__caughtlike__this,the__programcontinues__executingbelow__thetry__ratherthan__beingterminated__by Python.In__effect,the__codeprocesses__andclears__the error,and__yourscript__recovers: $ python3 kaboom.pyHello__world!Resuming__here...Hello__world!Resuming__here...Keep__inmind__thatonce__youve__caughtan__error,control__resumesat__theplace__whereyou__caughtit__(i.e.,after__the try);there__isno__directway__togo__backto__theplace__wherethe__exceptionoccurred__(here,in__thefunction__kaboom).This__makesexceptions__morelike__simplejumps__thanfunction__callsthere__isno__wayto__returnto__thescene__ofthe__crime.The__finallyClause__Theother__mainflavor__ofthe__trystatement__isfor__codingfinalization__(a.k.a. termination)actions__andis__reallyrelated__toexceptions__only incidentally.If__afinally__clauseis__includedin__a try,Python__willalways__runits__blockof__statementson__theway__outof__thetry__statementwhether__anexception__occurredwhile__thetry__blockwas__runningor__not.That__is,this__clausedoesn__tcatch__exceptions,it__worksaround__them.When__usedin__isolation,this__flavors__generalform__is this: try:statements__#Run__thisaction__first finally:statements__#Always__runthis__codeon__theway__outWhen__afinally__appearsin__try,Python__beginsby__runningthe__statementblock__associatedwith__thetry__headerline__as usual.What__happensnext__dependson__whetheran__exceptionoccurs__duringthe__try block,and__whatother__clausesare__present:Exception__andmatch__Ifan__exceptionoccurs__duringthe__tryblock__srun__andis__matchedby__anexcept__clause,Python__firstruns__thematching__exceptblock__andthen__runsthe__finally block.After__both finish,the__programthen__resumesbelow__theentire__try statement.The__finallyis__alsorun__ifthe__exceptraises__anew__exception.Exception__andno__matchIf__anexception__occursduring__thetry__blocks__runbut__isnot__caughtby__an except,Python__stillcomes__backand__runsthe__finally block,but__itthen__propagatesthe__exceptionup__toa__previouslyentered__tryor__the top-leveldefault__handler.That__is,finally__isrun__evenif__anexception__israised__and uncaught,but__unlikean__except,the__finallydoes__notterminate__theexception__itcontinues__beingraised__afterthe__finallyblock__runs.No__exceptionIf__anexception__doesnot__occurwhile__thetry__blockis__running,Python__firstruns__theelse__block (if present)and__thenruns__thefinally__block.After__both finish,the__programthen__resumesbelow__theentire__try statement.The__finallyis__alsorun__ifthe__elseraises__anew__exception.The__try/finallyform__isuseful__whenyou__wantto__becompletely__surethat__anaction__willhappen__aftersome__code runs,regardless__ofthe__exceptionbehavior__ofthe__code.In__practice,it__allowsyou__tospecify__cleanupactions__thatalways__must occur,such__asfile__closesand__serverdisconnects__where required.Technically__speaking,finally__canappear__inthe__samestatement__asexcept__and else,so__thereis__reallya__singletry__statementwith__manyoptional__clauses.Because__ofits__distinct role, though,as__wellas__itsordering__ruleswe__willmeet__ina__moment,the__finallyclause__maybe__bestthought__ofas__adistinct__tool.Whether__mixedor__not,finally__servesthe__samepurpose__tospecify__cleanupactions__thatmust__alwaysbe__run,regardless__ofany__exceptions.As__youll__alsosee__laterin__this chapter,the__withstatement__andits__contextmanagers__providean__object-basedway__todo__similarwork__forexit__actions.Unlike__finally,this__statementalso__supportsentry__actions,but__itis__limitedin__scopeto__objectsthat__implementthe__context-managerprotocol__it employs. Example:Coding__terminationactions__with try/finallyWe__codedsome__simple try/finallyexamples__inthe__prior chapter.Example__34- 3lists__amore__tangibleexample__thatillustrates__atypical__rolefor__this statement.Example__34-3. closer.pyclass__MyError(Exception):pass__def stuff(file): file.write('Hello?') #May__bedelayed__infile__bufferraise__MyError() # <=Enable__ordisable__mewith__a #if____name__ == '__main__':file__= open('temp.txt', 'w') #Open__anoutput__file (thiscan__fail too) try: stuff(file) #Raises__exception finally: file.close() #Always__closefile__toflush__outputbuffers__print('AmI__reached?') #Continue__hereonly__ifno__exceptionWhen__thefunction__inthis__coderaises__its exception,the__controlflow__jumpsback__andruns__thefinally__blockto__closethe__file.The__exceptionis__thenpropagated__onto__eitheranother__tryor__thedefault__top-level handler,which__printsthe__standarderror__messageand__shutsdown__the program. Hence,the__statementafter__thistry__isnever__reached: $ python3 closer.pyTraceback__(mostrecent__call last):File__"/ /LP6E/Chapter34/closer.py",line__10,in__stuff(file) #Raises__exceptionFile__"/ /LP6E/Chapter34/closer.py",line__5,in__stuffraise__MyError() # <=Enable__ordisable__mewith__a #MyError__Ifthe__functionhere__didnot__raisean__exception (e.g.,by__disablingits__raiseline__withan__added #),the__programwould__stillexecute__thefinally__blockto__closethe__file,but__itwould__thencontinue__belowthe__entiretry__statement: $ python3 closer.pyAm__I reached?In__thisspecific__case,we__vewrapped__acall__toa__file-processingfunction__ina__trywith__afinally__clauseto__makesure__thatthe__fileis__always closed,and__thus finalized,whether__thefunction__triggersan__exceptionor__not.This__way,later__codecan__besure__thatthe__files__outputbuffer__scontent__hasbeen__flushedfrom__memoryto__disk.A__similarcode__structurecan__guaranteethat__serverconnections__are closed,GUI__windowsare__closed,and__so on.As__welearned__inChapter__9,file__objectsare__automaticallyclosed__ongarbage__collectionin__standardPython__(CPython);this__isespecially__usefulfor__temporaryfiles__thatwe__dont__assignto__variables. However,it__snot__alwayseasy__topredict__whengarbage__collectionwill__occur,especially__inlarger__programsor__alternativePython__implementationswith__differinggarbage__collection policies.The__trystatement__makesfile__closesmore__explicitand__predictable:it__ensuresthat__thefile__willbe__closedon__block exit,regardless__ofwhether__anexception__occursor__not.This__particularexample__sfunction__isnt__allthat__useful (italways__raisesan__exception!),but__wrappingcalls__in try/finallystatements__isa__goodway__toensure__thatyour__closing-timetermination__activitiesalways__run.All__betsare__offif__Pythonitself__crashes completely,of__course,but__thisis__exceedingly rare;because__itdetects__errorsas__aprogram__runs,hard__crashesare__usuallycaused__by linked-inC__extension code,outside__ofPython__s scope.As__a preview,notice__howthe__user-definedexception__inExample__34-3is__definedwith__a class;as__youll__learnmore__formallyin__thenext__chapter,exceptions__mustall__beclass__instances,for__reasonablygood__causes.Combined__tryClauses__Forthe__first 15years__ofPython__stenure__(moreor__less),the__trystatement__camein__twoflavors__andwas__twoseparate__statementswe__couldeither__usea__finallyto__ensurethat__cleanupcode__wasalways__run,or__writeexcept__blocksto__catchand__recoverfrom__specificexceptions__andoptionally__specifyan__elseclause__forwhen__exceptions occurred.That__is,the__finallyclause__couldnot__bemixed__withexcept__and else.This__waspartly__becauseof__implementation issues,and__partlybecause__themeaning__ofmixing__thetwo__seemedobscure__catchingand__recoveringfrom__exceptionsseemed__adisjoint__conceptfrom__performingcleanup__actions.For__betteror__worse,the__twostatements__eventually merged. Today,we__canmix__finally, except,and__elseclauses__inthe__samestatement__inpart__becauseof__similarutility__inthe__Javalanguage__(alas,many__a programming-languagemod__owesto__imitation).That__is,the__trystatement__inits__mostcomplete__formlooks__like this: try: #Combined__trystatement__main-actionexcept__Exception1: #Catch__specificexceptions__handler1except__Exception2: handler2 except: #Catch__all (other)exceptions__handler3 else: # No-exceptionhandler__handler4 finally: #The__finallyencloses__all finally-blockThe__codein__thisstatement__s main-actionblock__isexecuted__first,as__usual.If__thatcode__raisesan__exception,all__theexcept__blocksare__tested,one__after another,for__amatch__tothe__exception raised: handler1is__runfor__Exception1, handler2for__Exception2,and__handler3for__all others.If__noexception__is raised, handler4is__run.No__matterwhat__shappened__previously,the__finally-blockis__executed once,after__themain__actionblock__isexited__andany__handlerblock__hasbeen__run.In__fact,the__codein__the finally-blockwill__berun__evenif__anerror__orraise__inan__exceptor__elseblock__causesa__newexception__tobe__raised.As__outlined earlier,even__inmixed__usagelike__this,the__finallyclause__doesnot__endthe__exceptionif__anexception__isactive__whenthe__finally-blockis__executed,it__continuesto__bepropagated__afterthe__finally-block runs,and__controljumps__somewhereelse__inthe__program (toan__earlier try,or__tothe__default top-level handler).If__noexception__isactive__whenthe__finallyis__run,control__resumesafter__theentire__try statement.The__neteffect__isthat__thefinally__isalways__run,regardless__of whether:An__exceptionoccurred__inthe__mainaction__andwas__handled.An__exceptionoccurred__inthe__mainaction__andwas__not handled.No__exceptionsoccurred__inthe__main action.A__newexception__wastriggered__inone__ofthe__handlers. Again,the__finallyserves__tospecify__cleanupactions__thatmust__alwaysoccur__onthe__wayout__ofthe__try,regardless__ofwhat__exceptionshave__beenraised__or handled. Combined-clausesyntax__rulesWhen__combinedlike__this,the__trystatement__musthave__eitheran__exceptor__a finally,and__theorder__ofits__partsmust__belike__this (where ->means__isfollowed__by ):try__->except__->else__->finally__In this,the__elseand__finallyare__optional,and__theremay__bezero__ormore__excepts,but__theremust__beat__leastone__exceptif__anelse__appears. Really,the__trystatement__consistsof__two parts:excepts__withan__optional else, and/orthe__finally.In__fact,it__smore__accurateto__describethe__combinedtry__statements__syntacticby__thefollowing__twoalternative__formats (wheresquare__bracketsmean__optionaland__starmeans__anynumber__ofwhat__precedes it): try: #Format__1statements__except [type [as value]]:statements__[except [type [as value]]: statements]* [else: statements] [finally: statements] try: #Format__2statements__finally:statements__Becauseof__these rules,the__elsecan__appearonly__ifthere__isat__leastone__except,and__its__alwayspossible__tomix__exceptand__finally,regardless__ofwhether__anelse__appearsor__not.It__salso__possibleto__mixfinally__and else,but__onlyif__anexcept__appearstoo__(thoughthe__exceptcan__omitan__exceptionname__tocatch__everythingand__runa__raise statement,described__later,to__reraisethe__current exception).If__youviolate__anyof__these (arguably intricate!)ordering__rules,Python__willraise__asyntax__errorexception__beforeyour__code runs.Combining__finallyand__exceptby__nestingIt__mayhelp__torealize__thatit__salso__possibleto__combinefinally__andexcept__clausesin__atry__bysyntactically__nestinga__try/exceptin__thetry__blockof__a try/finally statement.We__llexplore__thistechnique__morefully__inChapter__36,but__thefollowing__hasthe__sameeffect__asthe__combinedform__shownat__thestart__ofthis__section: try: #Nested__equivalentto__combinedform__try: main-actionexcept__Exception1: handler1except__Exception2: handler2 except: handler3 else: handler4 finally: finally-block Again,the__finallyblock__isalways__runon__theway__out,regardless__ofwhat__happenedin__themain__actionand__regardlessof__anyexception__handlersrun__inthe__nestedtry__(tracethrough__thefour__caseslisted__previouslyto__seehow__thisworks__the same).Since__anelse__alwaysrequires__an except,this__nestedform__evensports__thesame__mixingconstraints__ofthe__combinedform__outlinedin__thepreceding__section. However,this__nestedequivalent__seemsmore__obscureto__somepeople__andrequires__morecode__thanthe__newmerged__formthough__justone__four-characterline__plusextra__indentation.Mixing__finallyinto__thesame__statementmight__makeyour__codeeasier__towrite__and read,though__thisalso__mightdepend__onwho__you ask. Combined-clausesexample__Todemo__theeffect__ofmixing__finallywith__othertry__clauses,the__scriptlisted__inExample__34-4, trycombos.py,codes__fourcommon__scenarios,with__printstatements__thatdescribe__themeaning__of each.Example__34-4. trycombos.pysep__= '-' * 45 + '\n' print(sep + 'EXCEPTIONRAISED__AND CAUGHT') try:x__= 'hack'[99]except__IndexError: print('except run') finally: print('finally run') print('after run') print(sep + 'EXCEPTIONNOT__RAISED') try:x__= 'hack'[3]except__IndexError: print('except run') finally: print('finally run') print('after run') print(sep + 'EXCEPTIONNOT__RAISED,WITH__ELSE') try:x__= 'hack'[3]except__IndexError: print('except run') else: print('else run') finally: print('finally run') print('after run') print(sep + 'EXCEPTIONRAISED__BUTNOT__CAUGHT') try:x__= 1 / 0except__IndexError: print('except run') finally: print('finally run') print('after run')When__thiscode__is run,the__followingoutput__is produced.Trace__throughthe__codeto__seehow__exceptionhandling__producesthe__outputof__eachof__thefour__tests here: $ python3 trycombos.py ---------------------------------------------EXCEPTION__RAISEDAND__CAUGHTexcept__runfinally__runafter__run ---------------------------------------------EXCEPTION__NOTRAISED__finallyrun__afterrun__---------------------------------------------EXCEPTION__NOT RAISED,WITH__ELSEelse__runfinally__runafter__run ---------------------------------------------EXCEPTION__RAISEDBUT__NOTCAUGHT__finallyrun__Traceback (mostrecent__call last):File__"/ /LP6E/Chapter34/trycombos.py",line__38,in__x = 1 / 0 ZeroDivisionError:division__byzero__Thisexample__uses built-inoperations__inthe__mainaction__totrigger__exceptions (or not),and__itrelies__onthe__factthat__Pythonalways__checksfor__errorsas__codeis__running.The__nextsection__showshow__toraise__exceptionsmanually__instead.The__raiseStatement__Totrigger__exceptions explicitly,code__raise statements.Their__generalform__issimple__araise__statementconsists__ofthe__word raise,optionally__followedby__theclass__tobe__raised,or__aninstance__of it:raise__instance #Raise__aninstance__ofa__classraise__class #Make__andraise__aninstance__ofa__classraise__#Reraise__themost__recentexception__Asmentioned__earlier,exceptions__arealways__instancesof__classes today. Hence,the__firstraise__formhere__isthe__mostcommon__weprovide__aninstance__directly,either__createdbefore__theraise__orwithin__theraise__statement itself.If__wepass__aclass__instead,Python__callsthe__classwith__noconstructor__arguments,to__createan__instanceto__be raised;this__formis__equivalentto__addingparentheses__afterthe__class reference.The__lastform__reraisesthe__mostrecently__raised exception;it__scommonly__usedin__exceptionhandlers__topropagate__exceptionsthat__havebeen__caught.NOTE__Blastfrom__the past:Long__agoand__faraway__(well,before__Python 2.6),exceptions__couldbe__identifiedas__simplestring__objects,with__anoptional__associateddata__itemin__raise.This__wasreplaced__withclasses__tosupport__addedfunctionality__and categories,as__youll__seein__thenext__chapter. Still,strings__werea__simplermodel__forsimpler__roles,didn__trequire__newcomersto__learnclasses__andOOP__before exceptions,and__didnt__forcesome__Pythonbooks__toput__exceptionson__holduntil__Part VII!Raising__ExceptionsTo__makeraise__more concrete,let__sturn__tosome__examples.With__built-in exceptions,the__followingtwo__formsare__equivalentboth__raisean__instanceof__theexception__class named,but__thefirst__createsthe__instance implicitly:raise__IndexError #Class__(instance created)raise__IndexError() #Instance__(createdin__statement)We__canalso__createthe__instanceahead__oftime__becausethe__raisestatement__acceptsany__kindof__object reference,the__followingtwo__examplesraise__IndexErrorjust__likethe__prior two:exc__= IndexError() #Create__instanceahead__oftime__raiseexc__excs = [IndexError, TypeError]raise__excs[0]In__fact,the__instanceprovided__toraise__canbe__hadin__thetry__thatcatches__it too,per__thenext__section.The__exceptas__hookWhen__anexception__is raised,Python__sendsthe__raisedinstance__alongwith__the exception.If__atry__includesan__exceptwith__anas__clauseper__Table 34-1,the__variableit__giveswill__beassigned__theinstance__raisedby__raiseor__Python: try:except__IndexErroras__X: #X__assignedthe__raisedinstance__objectThe__asis__optionalin__atry__handler (ifit__s omitted,the__instanceis__simplynot__assignedto__a name),but__includingit__allowsthe__handlerto__accessboth__datain__theinstance__andmethods__inthe__exception class.This__modelworks__thesame__for user-definedexceptions__wecode__withclasses__the following,for__example,passes__tothe__exceptionclass__constructorarguments__thatbecome__availablein__thehandler__throughthe__assigned instance:class__MyExc(Exception):pass__try:raise__MyExc('oops') #Exception__classwith__constructorargs__exceptMyExc__as X: #Instance__attributesavailable__inhandler__print(X.args) #Prints__('oops',)Because__thisencroaches__onthe__nextchapter__s topic, though,we__lldefer__furtherdetails__until then.Regardless__oftheir__source,exceptions__arealways__identifiedby__classinstance__objects,and__atmost__oneis__activeat__anygiven__time (sansthe__except*groups__ofChapter__35).Once__caughtby__anexcept__clauseanywhere__inthe__program,an__exceptionends__andwon__tpropagate__toanother__try,unless__its__reraisedby__anotherraise__statementor__error.Scopes__andexcept__asWe__llstudy__exceptionobjects__inmore__detailin__thenext__chapter.Now__thatwe__veseen__theas__variablein__action, though,we__canfinally__clarifythe__relatedscope__issuesummarized__backin__Chapter 17.As__mentionedin__that chapter,the__variableused__toaccess__anexception__inthe__asclause__ofan__exceptis__localizedto__theexcept__blockthe__variableis__notavailable__afterthe__block exits,much__likea__temporaryloop__variablein__comprehension expressions: $ python3 >>> try: ... 1 / 0 ...except__Exceptionas__X: #The__"as"localizes__namesto__exceptblock__... print(X) ...division__byzero__>>>X__NameError:name__'X'is__notdefined__Unlikecomprehension__loop variables, though,this__variableis__removedafter__theexcept__block exits.This__isdone__becausethe__variablewould__otherwiseretain__areference__tothe__runtimecall__stack,which__woulddefer__garbagecollection__andthus__retainexcess__memory space.This__removal occurs, though,even__ifyou__reusing__thename__forother__purposesin__thesurrounding__scope,and__isa__muchmore__extremepolicy__thanthat__usedfor__comprehensions: >>>X__= 99 >>> {Xfor__Xin__'hack'} #Comprehensions__localizebut__don'tremove__{'a', 'c', 'k', 'h'} >>>X__99 >>>X__= 99 >>> try: ... 1 / 0 ...except__Exceptionas__X: #But__"as"localizes___and_removes__on exit! ... print(X) ...division__byzero__>>>X__#Where__didmy__X go?an__oddboundary__case NameError:name__'X'is__notdefined__Becauseof__this,you__shouldgenerally__useunique__variablenames__inyour__trystatement__sexcept__clauses,even__ifthey__arelocalized__by scope.If__youdo__needto__referencethe__exceptioninstance__afterthe__try statement,simply__assignit__toanother__namethat__wont__beautomatically__removed: >>> try: ... 1 / 0 ...except__Exceptionas__X: #Python__removesthis__reference ... print(X) ...saveit__=X__#Assign__excto__retainexc__ifneeded__...division__byzero__>>>X__NameError:name__'X'is__notdefined__>>>saveit__ZeroDivisionError('divisionby__zero',)Propagating__Exceptionswith__raiseThe__raisestatement__isa__bitmore__feature-richthan__weve__seenthus__far.For__example,a__raisethat__doesnot__listan__exceptionto__raisesimply__reraisesthe__currentlyactive__exception.This__formis__typicallyused__ifyou__needto__catchand__handlean__exceptionbut__dont__wantthe__exceptionto__diein__your handler: >>> try: ...raise__IndexError('code') #Exceptions__rememberarguments__...except__IndexError: ... print('propagating') ...raise__#Reraise__mostrecent__exception ...propagating__Traceback (mostrecent__call last):File__"",line__2,in__IndexError:code__Runninga__raisethis__wayreraises__theexception__andpropagates__itto__ahigher__handler (orthe__defaulthandler__atthe__top,which__stopsthe__programwith__astandard__error message).Notice__howthe__argumentwe__passedto__theexception__classshows__upin__theerror__messages;you__lllearn__whythis__happensin__thenext__chapter.Exception__Chaining:raise__fromExceptions__cansometimes__betriggered__inresponse__toother__exceptionsboth__deliberatelyand__bynew__program errors.To__supportfull__disclosurein__such cases,Python__alsoallows__raisestatements__tohave__anoptional__from clause:raise__newexceptionfrom__otherexceptionWhen__thefrom__isused__inan__explicitraise__request,the__expressionfollowing__fromspecifies__anotherexception__classor__instanceto__attachto__the__cause____attributeof__thenew__exceptionbeing__raised.If__theraised__exceptionis__not caught,Python__printsboth__exceptionsas__partof__thestandard__error message: >>> try: ... 1 / 0 ...except__Exceptionas__E: ...raise__TypeError('Bad')from__E #Explicitly__chainedexceptions__...Traceback__(mostrecent__call last):File__"",line__2,in__ZeroDivisionError:division__byzero__Theabove__exceptionwas__thedirect__causeof__thefollowing__exception:Traceback__(mostrecent__call last):File__"",line__4,in__TypeError:Bad__Whenan__exceptionis__raisedimplicitly__bya__programerror__insidean__exception handler,a__similarprocedure__isfollowed__automatically:the__previousexception__isattached__tothe__newexception__s__context____attributeand__isagain__displayedin__thestandard__errormessage__ifthe__exceptiongoes__uncaught: >>> try: ... 1 / 0 ... except: ...badname__#Implicitly__chainedexceptions__...Traceback__(mostrecent__call last):File__"",line__2,in__ZeroDivisionError:division__byzero__Duringhandling__ofthe__above exception,another__exception occurred:Traceback__(mostrecent__call last):File__"",line__4,in__NameError:name__'badname'is__notdefined__Inboth__cases,because__theoriginal__exceptionobjects__thusattached__tonew__exceptionobjects__maythemselves__haveattached__causes,the__causalitychain__canbe__arbitrarily long,and__isdisplayed__infull__inerror__messages.That__is,error__messagesmight__givemore__thantwo__exceptions.The__neteffect__inboth__explicitand__implicitchaining__contextsis__toallow__programmersto__knowall__exceptionsinvolved__whenone__exceptiontriggers__another: >>> try: ... try: ...raise__IndexError() ...except__Exceptionas__E: ...raise__TypeError()from__E ...except__Exceptionas__E: ...raise__SyntaxError()from__E ...Traceback__(mostrecent__call last):File__"",line__3,in__IndexErrorThe__aboveexception__wasthe__directcause__ofthe__following exception:Traceback__(mostrecent__call last):File__"",line__5,in__TypeErrorThe__aboveexception__wasthe__directcause__ofthe__following exception:Traceback__(mostrecent__call last):File__"",line__7,in__SyntaxError:None__Codelike__thefollowing__similarlydisplays__three exceptions,though__implicitlytriggered__byhandler__errors (itsseparator__linesare__Duringhandling__ofthe__aboveexception__insteadof__Theabove__exceptionwas__thedirect__cause ): try: try: 1 / 0 except:badname__except: open('nonesuch')Exception__chainsimpact__error displays,but__donot__affectthe__waythat__exceptionsare__namedand__caughtin__try statements:chains__aresimply__recordedin__exception-objectattributes__whichmay__beinspected__asusual__where useful.Like__thecombined__try,chained__exceptionsare__similarto__utilityin__otherlanguages__(includingJava__and C#)though__its__notclear__whichlanguages__were borrowers.In__Python,it__snot__unusualto__seeexception__chainsin__error messages,but__itis__uncommonto__createthem__explicitlywith__raise,so__well__deferto__Pythons__manualsfor__more details.As__afootnote__onthis__topic, though,Python__alsoprovides__away__tostop__exceptionsfrom__chaining:a__raisefrom__Noneallows__thedisplay__ofthe__chainedexception__contextto__bedisabled__when needed.This__makesfor__lesscluttered__errormessages__inapplications__thatconvert__betweenexception__typeswhile__processingexception__chains.The__assertStatement__Asa__somewhatspecial__casefor__debugging purposes,Python__alsoincludes__theassert__statementin__itsexceptions__toolset.It__ismostly__justsyntactic__shorthandfor__acommon__raiseusage__pattern,and__anassert__canbe__thoughtof__asa__conditionalraise__statement.A__statementof__the form:assert__test,data__#The__datapart__isoptional__workslike__thefollowing__code:if____debug__:if__not test:raise__AssertionError(data)In__other words,if__thetest__evaluatesto__false,Python__raisesan__exception:the__dataitem__(ifit__s provided)is__usedas__theexception__sconstructor__argument.Like__all exceptions,the__built-inAssertionError__exceptionwill__killyour__programif__its__notcaught__witha__try,and__thedata__itemshows__upas__partof__thestandard__error message: >>>language__= 'Java' >>>assert__language.startswith('Py'), "You'reusing__thewrong__language!" AssertionError: You'reusing__thewrong__language!As__anadded__feature,assert__statementsare__removedfrom__acompiled__programs__bytecodeand__hencenot__runif__the -OPython__command-lineflag__isused__tooptimize__the program.The____debug__flag__isa__built-inand__unchangeablename__thatis__automaticallyset__toTrue__unlessthe__-Oflag__is used.When____debug__is__Falsefor__-O,any__codepredicated__onit__beingTrue__is removed,including__asserts. Hence,to__disable (and omit) asserts,run__codewith__acommand__linelike__pythonO__file.py,or__generateoptimized__bytecodebefore__programruns__withsimilar__optionsin__thecompileall__standard-librarymodule__orcompile__built-in function.See__Pythons__manualsfor__detailson__themodule__and function. Example:Trapping__Constraints (butNot__Errors!)Here__sa__lesspolitically__chargedexample__ofassert__in action.Assertions__aretypically__usedto__verifyprogram__conditionsduring__development.When__displayed,their__errormessage__textautomatically__includessource__codeline__informationand__thevalue__listedin__theassert__statement.Consider__thefile__asserter.pyin__Example 34-5.Example__34-5. asserter.pydef__f(x):assert__x < 0, 'xmust__be negative'return__x ** 2Running__thisnormally__triggersthe__assertionerror__forpositive__numbers,but__runningwith__-Odoes__not: $ python3 >>>import__asserter >>> asserter.f(-3) 9 >>> asserter.f(3)Traceback__(mostrecent__call last):File__"",line__1,in__File "/ /LP6E/Chapter34/asserter.py",line__2,in__fassert__x < 0, 'xmust__be negative' AssertionError:x__mustbe__negative $ python3 -O >>>import__asserter >>> asserter.f(3) 9It__simportant__tokeep__inmind__thatassert__ismostly__intendedfor__trapping user-defined__constraints,not__forcatching__genuineprogramming__errors.Because__Pythontraps__programmingerrors__itself,there__isusually__noneed__tocode__assertto__catchthings__like out-of-bounds indexes,type__mismatches,and__zero divides:def__reciprocal(x):assert__x != 0 #A__generallyuseless__assert!return__1 /x__#Python__checksfor__zeroautomatically__Suchassert__usecases__areusually__superfluousbecause__Pythonraises__exceptionson__errors automatically,you__mightas__welllet__itdo__thejob__for you.As__a rule,you__normallydon__tneed__todo__errorchecking__explicitlyin__yourown__code.Of__course,there__areexceptions__tomost__rules.As__suggestedearlier__inthe__book,if__afunction__hasto__perform long-runningor__unrecoverableactions__beforeit__reachesthe__placewhere__anexception__willbe__triggered,you__stillmight__wantto__testfor__errors.Even__inthis__case, though,be__carefulnot__tomake__yourtests__overlyspecific__or restrictive,or__youwill__limityour__codes__utility.For__anotherexample__ofcommon__assert usage,see__theabstract__superclassexample__inChapter__29; there,we__usedassert__tomake__callsto__undefinedmethods__failwith__a message.It__sa__rarebut__useful tool.The__withStatement__andContext__ManagersIn__additionto__thetools__weve__seenso__far,Python__includesanother__thatdelegates__exception-relatedtasks__to objects.The__withstatement__isdesigned__towork__withcontext__managerobjects__thatsupport__a method-based protocol.The__combinationis__similarin__spiritto__theway__thatiteration__toolslike__forwork__withmethods__ofthe__iteration protocol.The__withstatement__isalso__similarto__ausing__statementin__the C# language.Although__asomewhat__optionaland__advanced tools-orientedtopic__(andonce__acandidate__forthe__nextpart__ofthis__book),context__managersare__lightweightand__usefulenough__togroup__withthe__restof__theexception__toolset here.In__short,the__withstatement__isdesigned__tobe__analternative__toa__common try/finallyusage__idiom:like__that statement,with__isin__largepart__intendedfor__specifying termination-timeor__cleanupactivities__thatmust__runregardless__ofwhether__anexception__occursduring__theexecution__ofa__blockof__code.Unlike__try/finally,the__withstatement__isbased__upona__method-callprotocol__forspecifying__actionsto__berun__arounda__blockof__code.This__makeswith__less general,qualifies__itas__redundantin__termination roles,and__requirescoding__classesfor__objectsthat__donot__supportits__protocol.On__theother__hand,with__alsohandles__entry actions,can__reducecode__sizewhere__supported,and__allowscode__contextsto__bemanaged__withfull__OOP.Python__enhancessome__built-intools__withcontext__managers,such__asfiles__thatautomatically__close themselves,thread__locksthat__automaticallylock__and unlock,and__async-functiontools__thatautomatically__awaitresults__perChapter__20,but__programmerscan__codecontext__managersof__theirown__with classes, too.Let__stake__abrief__lookat__thestatement__andits__implicit protocol.Basic__withUsage__Thebasic__formatof__thewith__statementlooks__like this,with__anoptional__partin__squarebrackets__here:with__expression [as variable]: with-blockThe__statementsof__thenested__with-blockare__themain__actionto__berun__here.The__expressionis__assumedto__returnan__objectthat__supportsthe__context-management__protocol (moreon__thisprotocol__ina__moment).This__objectmay__alsoreturn__avalue__thatwill__beassigned__tothe__namevariable__ifthe__optionalas__clauseis__present.Note__thatthe__variableis__notnecessarily__assignedthe__resultof__the expression;the__resultof__theexpression__isthe__objectthat__supportsthe__context protocol,and__thevariable__maybe__assignedsomething__elseintended__tobe__usedinside__the with-block.The__objectreturned__bythe__expressionmay__thenrun__startupcode__beforethe__blockis__started,as__wellas__terminationcode__afterthe__blockis__donewhether__theblock__raisedan__exceptionor__not.As__noted,some__built-inPython__objectshave__beenaugmented__tosupport__the context-management protocol,and__socan__beused__withthe__with statement.For__example,file__objects (coveredin__Chapter 9)have__acontext__managerthat__automaticallycloses__thefile__afterthe__withblock__regardlessof__whetheran__exceptionis__raised,and__regardlessof__ifor__whenthe__versionof__Pythonrunning__thecode__mayclose__automatically.In__abstract code:with__open('somefile.txt')as__myfile:for__linein__myfile: print(line) Here,the__callto__openreturns__asimple__fileobject__thatis__assignedto__thename__myfile.We__canuse__myfilewith__theusual__filetools__inthis__case,the__fileiterator__readsline__byline__inthe__for loop. However,the__openresult__alsosupports__the context-managementprotocol__usedby__thewith__statement.After__thiswith__statementhas__run,the__contextmanagement__machineryguarantees__thatthe__fileobject__referencedby__myfileis__automatically closed,even__ifthe__forloop__raisedan__exceptionwhile__processingthe__file.Although__fileobjects__maybe__automaticallyclosed__ongarbage__collection,it__snot__alwaysstraightforward__toknow__whenthat__will occur,especially__whenusing__alternativePython__implementations.The__withstatement__inthis__roleis__analternative__thatallows__usto__besure__thatthe__closewill__occurautomatically__afterexecution__ofa__specificblock__of code.As__covered earlier,we__canachieve__asimilar__effectwith__themore__generaland__explicit try/finally idiom,but__itrequires__threemore__linesof__administrativecode__inthis__case (fourinstead__ofjust__one):myfile__= open('somefile.txt') try:for__linein__myfile: print(line) finally: myfile.close()Of__course,we__couldskip__both statements,but__ourfile__maynot__beclosed__ifan__exceptionis__raisedduring__thefor__loop,and__thiscan__matterin__long-runningprograms__(well__revisitsuch__trade-offsin__Chapter 36).As__another example,we__wont__coverPython__smultithreading__modulesin__this book,but__thelock__andcondition__synchronizationobjects__theydefine__mayalso__beused__withthe__withstatement__becausethey__supportthe__context-managementprotocol__inthis__caseadding__bothentry__andexit__actionsaround__a block.After__importing threading:lock__= threading.Lock()with__lock:access__sharedresources__Here,the__contextmanagement__machineryguarantees__thatthe__lockis__automaticallyacquired__beforethe__blockis__executedand__releasedonce__theblock__is complete,regardless__ofexception__outcomes. Finally,the__decimalmodule__introducedin__Chapter 5also__usescontext__managersto__simplifysaving__andrestoring__thecurrent__decimal context,which__specifiesthe__precisionand__roundingcharacteristics__for calculations:with__decimal.localcontext()as__ctx: ctx.prec = 2x__= decimal.Decimal('1.00') / decimal.Decimal('3.00')After__thisstatement__runs,the__currentthread__scontext__managerstate__isautomatically__restoredto__whatit__wasbefore__thestatement__began.To__dothe__samewith__a try/finally,we__wouldneed__tosave__thecontext__beforeand__restoreit__manuallyafter__thenested__block.The__Context-ManagementProtocol__Althoughsome__built-intypes__comewith__context managers,we__canalso__writenew__onesof__our own.To__implementcontext__managers,classes__usespecial__methodsthat__fallinto__the operator-overloadingcategory__totap__intothe__with statement.The__interfaceexpected__ofobjects__usedin__withstatements__issomewhat__complex,and__mostprogrammers__onlyneed__toknow__howto__useexisting__context managers.For__toolbuilders__whomight__wantto__writenew__application-specificcontext__managers, though,let__stake__aquick__lookat__whats__involved.Here__show__thewith__statementactually__works: 1.The__expressionis__evaluated,resulting__inan__objectknown__asa__contextmanager__thatmust__have__enter____and__exit____methods. 2.The__contextmanager__s__enter____methodis__called.The__valueit__returnsis__assignedto__thevariable__inthe__asclause__if present,or__simplydiscarded__otherwise. 3.The__codein__thenested__withblock__is executed. 4.If__thewith__blockraises__an exception,the__contextmanager__s __exit__(type, value, traceback)method__iscalled__withthe__exception details.These__arethe__samethree__valuesreturned__by sys.exc_info,described__inthe__Pythonmanuals__andlater__inthis__partof__the book.If__thismethod__returnsa__false value,the__exceptionis__reraised; otherwise,the__exceptionis__terminated.The__exceptionshould__normallybe__reraisedso__thatit__ispropagated__outsidethe__withstatement__after__exit____returns. 5.If__thewith__blockdoes__notraise__an exception,the____exit__method__isstill__called,but__its type, value,and__tracebackarguments__areall__passedin__as None,and__itsreturn__valueis__ignored.Let__slook__ata__quickdemo__ofthe__protocolin__action.The__file withas.pyin__Example 34-6defines__a context-managerobject__thatsimply__tracesthe__entryand__exitof__thewith__blockin__anywith__statementit__isused__for.Example__34-6. withas.py "Acontext__managerthat__tracesentry__andexit__ofany__with statement's block"class__TraceBlock:def__message(self, arg): print('running ' + arg)def____enter__(self): print('[startingwith__block]')return__selfdef____exit__(self, exc_type, exc_value, exc_tb):if__exc_typeis__None: print('[exited normally]\n') else: print(f'[propagating exception: {exc_type}]')return__Falseif____name__ == '__main__':with__TraceBlock()as__action: action.message('test 1') print('reached')with__TraceBlock()as__action: action.message('test 2')raise__TypeError print('not reached')Notice__thatthis__classs____exit__method__returnsFalse__topropagate__the exception;deleting__thereturn__statementwould__havethe__same effect,as__thedefault__Nonereturn__valueof__functionsis__falseby__definition,but__explicitis__generallybetter__in coding.Also__noticethat__the__enter____methodreturns__selfas__theobject__toassign__tothe__as variable;in__otheruse__cases,this__mightreturn__acompletely__differentobject__instead.When__run,this__modules__self-testcode__usesits__contextmanager__totrace__theentry__andexit__oftwo__withstatement__blocks.The__neteffect__automaticallyinvokes__themanager__s__enter____and__exit____methods: $ python3 withas.py [startingwith__block]running__test 1reached__[exited normally] [startingwith__block]running__test 2 [propagating exception: ]Traceback__(mostrecent__call last):File__"/ /LP6E/Chapter34/withas.py",line__25,in__raiseTypeError__TypeErrorContext__managerscan__alsoutilize__OOPstate__informationand__inheritance,but__aresomewhat__advanceddevices__meantfor__tool builders,so__well__skipadditional__details here.See__Pythons__standardmanuals__forthe__fullstory__includingits__coverageof__thecontextlib__standardmodule__thatprovides__additionaltools__forcoding__context managers.Also__rememberthat__the try/finallycombination__providessupport__for termination-timeactivities__too,and__isgenerally__sufficientin__rolesthat__dont__warrantcoding__classesto__supportthe__withstatement__s protocol.Multiple__ContextManagers__Thewith__statementhas__onelast__cardto__turn over:it__mayalso__specifymultiple__(sometimescalled__nested )context__managerswith__comma syntax.For__example,in__thefollowing__codesnippet__thatselects__linesby__substring,both__filesexit__actionsare__automaticallyrun__toclose__thefiles__whenthe__statementblock__exits,regardless__ofexception__outcomes:with__open('lines.txt')as__input, open('matches.txt', 'w')as__output:for__linein__input:if__'somekey'in__line: output.write(line)Any__numberof__contextmanager__itemsmay__be listed,and__multipleitems__workthe__sameas__nestedwith__statements.That__is,the__followinghypothetical__code:with__A()as__a, B()as__b:statements__isequivalent__to (andpossibly__simpler than)the__following:with__A()as__a:with__B()as__b:statements__Thenet__effectis__thateach__contextmanager__sentry__andexit__methodis__runin__turnon__blockentry__and exit,and__exceptionsin__theblock__arecaught__automaticallyand__possiblyreraised__onwith__exitat__thediscretion__ofthe__outermostmanager__sexit__method.Multiple__filecontext__managers,for__instance,will__allbe__runto__openfiles__on entry,and__closethem__onexit__exceptionor__not.The__Termination-Handlers Shoot-OutYou__canfind__moreinfo__oncontext__managersin__Pythons__docs.Rather__thangetting__moredetailed__here,let__sclose__outthis__chapterwith__aquick__lookat__thisextension__inaction__anda__vettingof__its roles.Using__newerand__redundanttools__likewith__doesnt__inand__ofitself__prove intelligence,and__its__importantto__understandthe__trade-offssuch__options imply.First__up,the__followingcodes__aparallel__linesscan__offiles__locatedin__thisbook__sexamples__package.It__useswith__toopen__twofiles__atonce__andthen__readsand__zipstogether__their next-linepairs__oneach__iterationof__afor__loop.Thanks__tothe__fileobject__scontext__manager,there__sno__needto__manuallycatch__exceptionsor__closefiles__when finished: >>>with__open('lines1.txt')as__file1, open('lines2.txt')as__file2:for__pairin__zip(file1, file2): print(pair) ('hack\n', 'HACK\n') ('code\n', 'GOOD\n') ('well\n', 'CODE\n')You__mightalso__usethis__codingstructure__todo__alines__comparisonof__twotext__files.The__followingsimply__replacesthe__formers__printwith__anif__fora__comparison operation,and__addsan__enumeratefor__automaticline__numbers: >>>with__open('lines1.txt')as__file1, open('lines2.txt')as__file2:for__(linenum, (line1, line2))in__enumerate(zip(file1, file2)):if__line1.lower() != line2.lower(): print(f'{linenum} => {line1!r} != {line2!r}') 1 => 'code\n' != 'GOOD\n' 2 => 'well\n' != 'CODE\n'That__said,with__isnt__allthat__usefulin__thepreceding__exampleswhen__using CPython,because__inputfile__objectsdon__trequire__abuffer__flush,and__fileobjects__areclosed__automaticallywhen__garbagecollected__ifstill__open. Moreover,exceptions__inthe__withblock__arestill__propagatedoutside__thestatement__ifnot__explicitly caught. Hence,the__temporaryfiles__wouldbe__auto-closedimmediately__andexception__behaviorwould__bethe__samefor__simplercode__like this:for__pairin__zip(open('lines1.txt'), open('lines2.txt')): #Same__ifauto__close print(pair) #Ditto__for !=test__Onthe__other hand,some__ofthe__alternativePythons__ofChapter__2may__usedifferent__garbagecollectors__thatrequire__direct closes,to__avoidtaxing__system resources.In__addition,output__filesmay__requirecloses__toensure__thatany__bufferedcontent__istransferred__todisk__soit__savailable__foropens__inlater__code.The__followinglines__filtercode__addressesboth__concerns,by__automaticallyclosing__fileson__statement exit,exception__ornot__(italso__usesparentheses__andline__splitsafter__with,available__asof__Python 3.10,and__omitswrite__countsfor__brevity): >>>with__(open('lines1.txt')as__input, open('uppers.txt', 'w')as__output):for__linein__input: output.write(line.upper()) >>> print(open('uppers.txt').read()) #File__contentis__availablehere__HACKCODE__WELL Still,in__simple scripts,we__canoften__justopen__filesin__separatestatements__andclose__afterprocessing__if needed.There__sno__pointin__catchingan__exceptionif__itmeans__yourprogram__isout__ofbusiness__anyhow,and__closesare__requiredto__flushoutput__buffersonly__iffiles__willbe__reopenedby__latercode__whichmay__neverbe__reachedafter__exceptions anyhow:input__= open('lines1.txt')output__= open('uppers.txt', 'w')for__linein__input: #Same__effectif__filesauto__close, output.write(line.upper()) #and__fileis__notreopened__ahead Nevertheless,in__programsthat__mustboth__continueafter__exceptionsand__closeoutput__filesfor__lateruse__inthe__sameprogram__(or REPL) run,the__withavoids__anequivalent__try/finallycombination__thatmay__bemore__obviousto__some readers,but__alsorequires__noticeablymore__codeeight__linesinstead__of four,quantitatively__speaking:input__= open('lines1.txt')output__= open('uppers.txt', 'w') try: #Same__butexplicit__closeon__errorsfor__linein__input: output.write(line.upper()) finally: input.close() #Ensure__outputfile__iscomplete__output.close() #Whether__exceptionoccurs__ornot__Even so,the__try/finallyis__asingle__toolthat__appliesto__allfinalization__casesand__makescode__explicit.The__withcan__bemore__concisefor__context-manager users,but__appliesonly__toobjects__thatimplement__itscomplex__protocol,relies__onimplicit__magicthat__obscures meaning,and__addsredundancy__thatdoubles__therequired__knowledgebase__of programmers.As__usual,you__llhave__toweigh__thesetools__trade-offsfor__yourself.Chapter__SummaryIn__this chapter,we__tooka__moredetailed__lookat__exceptionprocessing__byexploring__thestatements__relatedto__exceptionsin__Python:try__tocatch__them,raise__totrigger__them,assert__toraise__them conditionally,and__withto__wrapcode__blocksin__contextmanagers__thatautomate__entryand__exit actions.Up__tothis__point,exceptions__mayseem__likea__fairlylightweight__tool (apartfrom__thewith__protocol,that__is).The__mostcomplex__thingabout__themmay__behow__theyare__identifieda__topicthe__nextchapter__willaddress__byshowing__howexception__objectsare__made.As__youll__see there,classes__allowyou__tocode__newexceptions__specificto__your programs.Before__wemove__ahead, though,let__swork__throughthe__followingshort__quizon__thebasics__covered here.Test__Your Knowledge:Quiz__1.What__isthe__trystatement__for? 2.What__arethe__twocommon__variationsof__thetry__statement? 3.What__isthe__raisestatement__for? 4.What__isthe__assertstatement__designedto__do,and__whatother__statementis__it like? 5.What__isthe__withstatement__designedto__do,and__whatother__statementis__it like?Test__Your Knowledge:Answers__1.The__trystatement__catchesand__recoversfrom__exceptionsit__specifiesa__blockof__codeto__runand__oneor__morehandlers__forexceptions__thatmay__beraised__duringthe__blocks__execution. 2.The__twocommon__variationson__thetry__statementare__try/except/else (forcatching__exceptions)and__try/finally (forspecifying__cleanupactions__thatmust__occurwhether__anexception__israised__or not).Despite__theselogically__distinct roles,the__exceptand__finallyblocks__maybe__mixedin__thesame__statement,so__thetwo__formsare__reallypart__ofthe__singletry__statement.Even__whenmixed__with except, though,the__finallyis__stillrun__onthe__wayout__ofthe__try,regardless__ofwhat__exceptionsmay__havebeen__raisedor__handled.In__fact,the__combinedform__isequivalent__tonesting__a try/except/elsein__a try/finally. 3.The__raisestatement__raises (triggers)an__exception.Python__raises built-in__exceptionson__errors internally,but__yourscripts__cantrigger__built-inor__user-definedexceptions__toowith__raise. 4.The__assertstatement__raisesan__AssertionErrorexception__ifa__conditionis__false.It__ssimilar__toa__conditionalraise__statementwrapped__upin__anif__statement,and__canbe__disabledwith__aO__command switch. 5.The__withstatement__isdesigned__toautomate__startupand__terminationactivities__thatmust__occuraround__ablock__of code.It__isroughly__likea__try/finallycombination__inthat__itsexit__actionsrun__whetheran__exceptionoccurred__or not,but__itemploys__an object-basedprotocol__forspecifying__entryand__exitactions__andmay__reducecode__sizefor__context-manger__users. Still,it__snot__quiteas__general,as__itapplies__onlyto__objectsthat__supportits__protocol;try__withfinally__clausescan__handlemore__use cases.Chapter__35.Exception__ObjectsSo__far,this__bookhas__beensomewhat__vagueabout__whatan__exceptionactually__is.This__chapterclears__upthe__mysteryby__disclosingthe__factsbehind__exceptionobjects__both built-inand__user-defined.As__suggestedin__thepreceding__chapters,exceptions__areidentified__byclass__instance objects.This__iswhat__israised__andpropagated__alongby__exception processing,and__thesource__ofthe__classmatched__againstexcept__clausesin__try statements.Although__thismeans__youmust__use object-orientedprogramming__todefine__newexceptions__inyour__programsand__introducesa__knowledgedependency__lamentedin__theprior__chapters__notebasing__exceptionson__classesand__OOPoffers__anumber__of benefits.Among__them, class-basedexceptions__support:Flexible__exceptioncategories__Exceptionclasses__allowcode__tochoose__specificityand__easefuture__changes.Adding__newexception__subclasses,for__example,need__notrequire__changesin__try statements.State__informationand__behaviorException__classesprovide__anatural__placeto__storecontext__foruse__inthe__try handler.Both__attributesand__methods,for__example,are__availableon__theraised__instance.Reuse__byinheritance__Exceptionsclasses__canparticipate__ininheritance__hierarchiesto__obtainand__customizecommon__behavior.Inherited__error displays,for__example,can__providea__commonlook__and feel.Because__ofthese__advantages, class-basedexceptions__supportprogram__evolutionand__largersystems__well.As__youll__learn here,all__built-inexceptions__areidentified__byclasses__andare__organizedinto__aninheritance__treefor__thereasons__just listed.You__cando__thesame__with user-definedexceptions__ofyour__own.In__fact,the__built-inexceptions__well__studyhere__turnout__tobe__integralto__newexceptions__you define.Because__Pythonlargely__requires user-definedexceptions__toinherit__from built-inexception__classesthat__provideuseful__defaultsfor__printingand__state,the__taskof__coding user-definedexceptions__alsoinvolves__understandingthe__rolesof__these built-ins.Exception__ClassesWhether__built-inor__user-defined,exceptions__workmuch__oftheir__magicby__superclass relationships:a__raisedexception__matchesan__exceptclause__ifthat__clausenames__theexception__sclass__orany__superclassof__it.Put__another way,a__trystatement__sexcept__matchesboth__theclass__it lists,as__wellas__allof__thatclass__ssubclasses__lowerin__theclass__tree.The__neteffect__isthat__classexceptions__naturallysupport__theconstruction__ofexception__hierarchies:superclasses__becomecategory__names,and__subclassesbecome__specifickinds__ofexceptions__withina__category.By__naminga__generalexception__superclass,an__exceptclause__cancatch__anentire__categoryof__exceptionsany__morespecific__subclasswill__match.In__additionto__thiscategory__idea, class-basedexceptions__supportexception__stateinformation__andallow__exceptionsto__inheritcommon__behaviors,as__noted.To__seehow__allthese__assetscome__togetherin__code,let__sturn__toan__example.Coding__ExceptionsClasses__Inthe__filelisted__inExample__35-1, categoric.py,we__definea__superclasscalled__Generaland__twosubclasses__called Specific1and__Specific2.This__exampleillustrates__thenotion__ofexception__categoriesGeneral__isa__category name,and__itstwo__subclassesare__specifictypes__ofexceptions__withinthe__category.Handlers__thatcatch__Generalwill__alsocatch__anysubclasses__of it,including__Specific1and__Specific2.Example__35-1. categoric.pyclass__General(Exception):pass__class Specific1(General):pass__class Specific2(General):pass__def raiser0():X__= General() #Raise__superclassinstance__raiseX__def raiser1():X__= Specific1() #Raise__subclassinstance__raiseX__def raiser2():X__= Specific2() #Raise__differentsubclass__instanceraise__Xfor__funcin__(raiser0, raiser1, raiser2): try: func()except__General: #Match__Generalor__anysubclass__ofit__importsys__print('caught:', sys.exc_info()[0])When__thisexample__runs,its__trystatement__catchesand__reportsinstances__ofall__threeof__itsclasses__becausethe__exceptclause__namestheir__common superclass: $ python3 categoric.py caught: caught: caught:This__codeis__mostly straightforward,but__hereare__afew__pointsto__notice:Exception__superclassClasses__usedto__buildexception__categorytrees__havevery__fewrequirements__in fact,in__this example,they__aremostly__empty,with__bodiesthat__donothing__but pass. Notice, though,how__the top-levelclass__hereinherits__fromthe__built-in__Exception class.This__is required:classes__thatdon__tinherit__froma__built-inexception__classwon__twork__inmost__exception contexts.The__built-insuperclass__isnormally__Exception,the__rootfor__nonexit exceptions,but__mayalso__be BaseException,the__rootfor__all exceptions,or__other.Although__wedon__temploy__it here,Exception__providesbehavior__youll__meetlater__thatmakes__inheritingfrom__it useful,required__or not.Raising__instancesIn__this code,we__callclasses__tomake__instancesfor__theraise__statements (noticethe__parentheses).In__theclass__exception model,we__alwaysraise__andcatch__aclass__instance object.If__welist__aclass__namewithout__parenthesesin__a raise,Python__makesan__instancefor__usby__callingthe__classwith__noconstructor__arguments.Exception__instancescan__becreated__beforethe__raise,as__done here,or__withinthe__raisestatement__itself.Catching__categoriesThis__codeincludes__functionsthat__raiseinstances__ofall__threeof__ourclasses__as exceptions,as__wellas__a top-leveltry__thatcalls__thefunctions__andcatches__General exceptions.The__sametry__alsocatches__thetwo__specificexceptions__becausethey__aresubclasses__ofGeneral__that is,members__ofits__category.Exception__detailsThe__exceptionhandler__hereuses__the sys.exc_info call,which__isone__wayto__fetchthe__exceptionbeing__handledin__ageneric__fashion.As__youll__seein__moredetail__inthe__next chapter,the__firstitem__inthis__calls__resulttuple__isthe__classof__theexception__raised,and__thesecond__isthe__actualinstance__raised.In__ageneral__exceptclause__likethe__onehere__thatcatches__allclasses__ina__category, sys.exc_infocan__beused__todetermine__exactlywhat__has occurred.The__lastpoint__merits elaboration.When__anexception__is caught,we__canbe__surethat__theinstance__raisedis__aninstance__ofthe__classlisted__inthe__exceptor__oneof__its subclasses.Because__of that,the__specifickind__ofexception__raisedcan__alsobe__hadvia__thetype__resultor____class__attribute__ofthe__instance,regardless__ofhow__theinstance__is obtained.To__demo,the__variantin__Example 35-2works__thesame__asthe__priorexample__butuses__theas__extensionin__itsexcept__clauseto__directlyassign__avariable__tothe__instance raised,from__whichtype__yieldsthe__exceptions__kind.Example__35-2. categoric2.pyclass__General(Exception):pass__class Specific1(General):pass__class Specific2(General):pass__def raiser0():raise__General()def__raiser1():raise__Specific1()def__raiser2():raise__Specific2()for__funcin__(raiser0, raiser1, raiser2): try: func()except__Generalas__X: #X__isthe__raisedinstance__print('caught:', type(X)) #Same__as sys.exc_info()[0], X.__class__Because__theexcept__sas__canbe__usedto__accessthe__exceptiondirectly__this way, sys.exc_infois__moreuseful__forempty__exceptclauses__thatdo__nototherwise__havea__wayto__accessthe__instanceor__its class.More__importantly, well-designedprograms__usuallyshould__nothave__tocare__aboutwhich__specificexception__wasraised__atall__callingmethods__ofthe__exceptioninstance__shouldautomatically__dispatchto__behaviortailored__forthe__exception raised.There__smore__onthis__and sys.exc_infoand__itsilk__inthe__next chapter. Also,see__Chapter 29and__PartVI__atlarge__ifyou__veforgotten__what__class____meansin__an instance,and__theprior__chapterfor__areview__ofthe__asused__here.Why__Exception Hierarchies?Because__thereare__onlythree__possibleexceptions__inthe__priorsection__s examples,it__doesnt__reallydo__justiceto__theutility__ofclass__exceptions.In__principle,we__couldachieve__thesame__effectsby__codinga__listof__exceptionnames__ina__parenthesizedtuple__withinthe__except clause: try: func()except__(General, Specific1, Specific2): #Catch__anyof__theseThis__approachmay__workfor__smaller, self-contained code.For__largeor__highexception__hierarchies, however,it__willprobably__beeasier__tocatch__categoriesusing__class-basedcategories__thanto__listevery__memberof__acategory__ina__singleexcept__clause.Perhaps__more importantly,you__canextend__exceptionhierarchies__assoftware__needsevolve__byadding__newsubclasses__withoutbreaking__existinghandler__code. Suppose,for__example,you__codea__numericprogramming__libraryin__Pythonto__beused__bya__largenumber__of people.While__youare__writingyour__library,you__identifytwo__thingsthat__cango__wrongwith__numbersin__yourcode__divisionby__zeroand__numeric overflow.You__documentthese__asthe__twostandalone__exceptionsthat__yourlibrary__may raise: # mathlib.pyclass__Divzero(Exception):pass__class Oflow(Exception):pass__def func():raise__Divzero()and__soon__Now,when__peopleuse__your library,they__typicallywrap__callsto__yourfunctions__orclasses__intry__statementsthat__catchyour__two exceptions;after__all,if__theydo__notcatch__your exceptions,exceptions__fromyour__librarywill__killtheir__code: # client.pyimport__mathlib try: mathlib.func()except__(mathlib.Divzero, mathlib.Oflow):handle__andrecover__Thisworks__fine,and__lotsof__peoplestart__usingyour__library.Six__monthsdown__the road, though,you__reviseit__(asprogrammers__areprone__to do).Along__the way,you__identifya__newthing__thatcan__gowrong__underflow,perhaps__andadd__thatas__anew__exception: # mathlib.pyclass__Divzero(Exception):pass__class Oflow(Exception):pass__class Uflow(Exception):pass__Unfortunately,when__you re-releaseyour__code,you__createa__maintenanceproblem__foryour__users.If__theyve__listedyour__exceptions explicitly,they__nowhave__togo__backand__changeevery__placethey__callyour__libraryto__includethe__newlyadded__exception name: # client.py try: mathlib.func()except__(mathlib.Divzero, mathlib.Oflow, mathlib.Uflow):handle__andrecover__Thismay__notbe__theend__ofthe__world.If__yourlibrary__isused__only in-house,you__canmake__thechanges__yourself.You__mightalso__shipa__Pythonscript__thattries__tofix__suchcode__automatically (itwould__probablybe__onlya__fewdozen__lines,and__itwould__guessright__atleast__someof__the time).If__manypeople__haveto__changeall__theirtry__statementseach__timeyou__alteryour__exception set, though,this__isnot__exactlythe__politestof__upgrade policies.Your__usersmight__tryto__avoidthis__pitfallby__codingempty__exceptclauses__tocatch__allpossible__exceptions: # client.py try: mathlib.func() except: #Catch__everythinghere__(orcatch__Exception)handle__andrecover__Butas__notedin__theprior__chapter,this__workaroundmight__catchmore__thanthey__bargainedfor__thingslike__runningout__of memory,keyboard__interrupts (Ctrl+C),system__exits,and__eventypos__intheir__owntry__blocks__codewill__alltrigger__exceptions,and__suchthings__should pass,not__becaught__anderroneously__classifiedas__library errors.Catching__theException__superclassimproves__onthis__butstill__interceptsand__thusmay__maskprogram__errors.And__really,in__this scenario,users__wantto__catchand__recoverfrom__onlythe__specificexceptions__thelibrary__isdefined__anddocumented__to raise.If__anyother__exceptionoccurs__duringa__library call,it__slikely__agenuine__bugin__thelibrary__(andit__sprobably__timeto__contactthe__vendor).As__arule__of thumb,it__susually__betterto__bespecific__thangeneral__inexception__handlersan__ideawe__llrevisit__asa__gotchain__thenext__chapter.So__whatto__do, then?In__principle again,the__librarymodule__couldprovide__atuple__objectthat__containsall__theexceptions__itcan__possibly raise.The__clientcould__thenimport__thetuple__andname__itin__anexcept__clauseto__catchall__thelibrary__sexceptions__(recallthat__usinga__tuplecatches__anyof__its exceptions).This__wouldwork__andsupport__mods,but__youd__needto__keepthe__tuple up-to-datewith__library exceptions,and__thats__both error-proneand__tedious.Class__exceptionhierarchies__solvethis__dilemma better.Rather__thandefining__yourlibrary__sexceptions__asa__setof__autonomous classes,arrange__theminto__aclass__treewith__acommon__superclassto__encompassthe__entire category: # mathlib.pyclass__NumErr(Exception):pass__class Divzero(NumErr):pass__class Oflow(NumErr):pass__def func():raise__DivZero()and__soon__This way,users__ofyour__librarysimply__needto__listthe__commonsuperclass__(i.e., category)to__catchall__ofyour__librarys__exceptionsboth__nowand__inthe__future: # client.pyimport__mathlib try: mathlib.func()except__mathlib.NumErr:handle__andrecover__Whenyou__goback__andhack__(update)your__codeagain__now,you__canadd__newexceptions__asnew__subclassesof__thecommon__superclass: # mathlib.pyclass__Uflow(NumErr):pass__Theend__resultis__thatuser__codethat__catchesyour__librarys__exceptionswill__keep working, unchanged.In__fact,you__arefree__to add, delete,and__changeexceptions__arbitrarilyin__thefuture__aslong__asclients__namethe__superclass,and__thatsuperclass__remains intact,they__areinsulated__fromchanges__inyour__exceptions set.In__other words,class__exceptionsprovide__abetter__answerto__maintenanceissues__thanother__solutions can. Class-basedexception__hierarchiesalso__supportstate__retentionand__inheritancein__waysthat__makethem__idealin__larger programs.To__understandthese__roles, though,we__firstneed__tosee__how user-definedexception__classesrelate__tothe__built-inexceptions__fromwhich__they inherit. Built-inException__ClassesThe__priorsection__sexample__wasnt__reallypulled__outof__thin air.All__built-inexceptions__thatPython__itselfmay__raiseare__predefinedclass__objects. Moreover,they__areorganized__intoa__shallowhierarchy__withgeneral__superclasscategories__andspecific__subclass types,much__likethe__priorsection__sfinal__exceptionsclass__tree.All__thefamiliar__exceptionsyou__veseen__(e.g., SyntaxError)are__reallyjust__predefined classes,available__as built-innames__inthe__modulenamed__builtins.In__addition,Python__organizesthe__built-inexceptions__intoa__hierarchyto__supporta__varietyof__catching modes.For__example: BaseException:topmost__root,with__printingand__constructordefaults__The top-levelroot__superclassof__exceptions.This__classis__notsupposed__tobe__directlyinherited__by user-definedclasses__(useException__instead).It__providesdefault__printingand__stateretention__behaviorinherited__by subclasses.If__thestr__built-inis__calledon__aninstance__ofthis__class (e.g.,by__print),the__classreturns__thedisplay__stringsof__theconstructor__argumentspassed__whenthe__instancewas__created (oran__emptystring__ifthere__wereno__arguments).In__addition,unless__subclassesreplace__thisclass__s constructor,all__ofthe__argumentspassed__tothis__classat__instanceconstruction__timeare__storedin__itsargs__attributeas__a tuple. Exception:root__of user-definedexceptions__The top-levelroot__superclassof__application-related exceptions.This__isan__immediatesubclass__ofBaseException__andis__asuperclass__toevery__other built-in exception,except__thesystem__exitevent__classes (SystemExit, KeyboardInterrupt,and__GeneratorExit)and__an exception-groupclass__well__ignore here.Nearly__all user-definedclasses__shouldinherit__fromthis__class,not__BaseException.When__thisconvention__is followed,naming__Exceptionin__atry__statements__handlerensures__thatyour__programwill__catcheverything__butsystem__exit events,which__shouldnormally__beallowed__to pass.In__effect,Exception__becomesa__catchallin__trystatements__butis__moreaccurate__thanan__empty except. ArithmeticError:root__ofnumeric__errorsA__subclassof__Exception,and__thesuperclass__ofall__numeric errors.Its__subclassesidentify__specificnumeric__errors: OverflowError, ZeroDivisionError,and__FloatingPointError. LookupError:root__ofindexing__errorsA__subclassof__Exception,and__thesuperclass__categoryfor__indexingerrors__forboth__sequencesand__mappings:IndexError__and KeyError. OSError:root__ofIO__andother__system-function errors,with__detailsA__subclassof__Exception,with__attributesfor__errordetails__(e.g., errno, strerror,and__filename),and__subclassesfor__specific errors: FileNotFoundError, PermissionError, TimeoutError,and__more.And__soon__becausethe__built-inexception__setis__proneto__frequent changes,this__bookdoesn__tdocument__it exhaustively.You__canread__furtherabout__itscontents__andstructure__inthe__Pythonlibrary__manual. Built-inException__CategoriesThe__built-inclass__treeallows__youto__choosehow__specificor__generalyour__handlerswill__be.For__example,because__the built-inexception__ArithmeticErroris__asuperclass__formore__specificexceptions__suchas__OverflowErrorand__ZeroDivisionError:By__listingArithmeticError__ina__try,you__willcatch__anykind__ofnumeric__error raised.By__listing ZeroDivisionError,you__willintercept__justthat__specifictype__oferror__andno__others. Similarly,because__Exceptionis__thesuperclass__ofall__application-level exceptions,you__cangenerally__useit__asa__catchallas__outlinedin__theprior__chapter,the__effectis__muchlike__anempty__except,but__itallows__systemexit__exceptionsto__passand__propagateas__theyusually__should: try:except__Exception: #Exits__notcaught__herehandle__allapplication__exceptions else:handle__no-exceptioncase__Thistechnique__isreliable__becausePython__requiresall__classesto__derivefrom__built-in exceptions. Still,this__schemesuffers__mostof__thesame__potentialpitfalls__asthe__empty except,as__describedin__theprior__chapterit__mightintercept__exceptionsintended__for elsewhere,and__itmight__maskgenuine__programming errors.Since__thisis__sucha__common issue,we__llrevisit__itone__moretime__asa__gotchain__thenext__chapter.Whether__ornot__youwill__leveragethe__categoriesin__the built-inclass__tree,it__servesas__agood__example.By__usingsimilar__techniquesfor__classexceptions__inyour__own code,you__canprovide__exceptionsets__thatare__flexibleand__easily modified.Default__Printingand__State Built-inexceptions__alsoprovide__defaultprint__displaysand__state retention,which__isoften__asmuch__logicas__user-definedclasses__require.Unless__youredefine__theconstructors__yourclasses__inheritfrom__built-ins,any__constructorarguments__youpass__tothese__classesare__automaticallysaved__inthe__instances__argstuple__attributeand__areautomatically__displayedwhen__theinstance__is printed.An__emptytuple__anddisplay__stringare__usedif__noconstructor__argumentsare__passed,and__asingle__argumentdisplays__asitself__(notas__a tuple)and__servesas__message details.This__explainswhy__argumentspassed__to built-inexception__classesshow__upin__errormessages__anyconstructor__argumentsare__attachedto__theinstance__anddisplayed__whenthe__instanceis__printed: >>>raise__IndexError #Same__as IndexError():no__argumentsTraceback__(mostrecent__call last):File__"",line__1,in__IndexError >>>raise__IndexError('bad') #Constructor__argument attached,printed__Traceback (mostrecent__call last):File__"",line__1,in__IndexError:bad__>>>i__= IndexError('bad', 'stuff') #Available__inobject__attribute "args" >>> i.args ('bad', 'stuff') >>> print(i) #Displays__argswhen__printedmanually__('bad', 'stuff') >>>i__#Uses__reprfor__echo,str__forprint__IndexError('bad', 'stuff')The__sameholds__truefor__user-definedexceptions__becausethey__inheritthe__constructorand__displaymethods__presentin__their built-in superclasses: >>>class__E(Exception):pass__>>>raise__ETraceback__(mostrecent__call last):File__"",line__1,in__E >>>raise__E('bad')Traceback__(mostrecent__call last):File__"",line__1,in__E:bad__>>>i__= E('bad', 'stuff') >>> i.args ('bad', 'stuff') >>> print(i) ('bad', 'stuff') >>>i__E('bad', 'stuff')When__interceptedin__atry__statement,the__exceptioninstance__objectgives__accessto__boththe__originalconstructor__argumentsand__thedisplay__method: >>> try: ...raise__E('bad') #Displays__+saves__constructorargs__...except__Eas__X: ... print(f'{X} - {X.args} - {X!r}') ...bad__- ('bad',) - E('bad') >>> try: ...raise__E('bad', 'stuff') #Multiple__args save/displaya__tuple ...except__Eas__X: ... print(f'{X} - {X.args} - {X!r}') ... ('bad', 'stuff') - ('bad', 'stuff') - E('bad', 'stuff')Note__thatexception__instanceobjects__arenot__strings themselves,but__usethe____str__and____repr__ operator-overloadingmethods__westudied__inChapter__30to__providedisplay__stringsfor__printand__other contexts.To__concatenatewith__real strings,perform__manual conversions: str(X), '%s' % X, f'{X}',and__the like.Although__thisautomatic__stateand__displaysupport__isuseful__by itself,for__morespecific__displayand__stateretention__needs,you__canalways__redefineinherited__methodssuch__as__str____and__init____inException__subclassesas__thenext__section shows.Custom__PrintDisplays__Aswe__sawin__thepreceding__section,by__default,instances__of class-basedexceptions__displaywhatever__youpassed__tothe__classconstructor__whenthey__arecaught__and printed: >>>class__MyBad(Exception):pass__>>> try: ...raise__MyBad('Sorry--my mistake!') ...except__MyBadas__X: ... print(X) ... Sorry--my mistake!This__inheriteddefault__displaymodel__isalso__usedif__theexception__isdisplayed__aspart__ofan__errormessage__whenthe__exceptionis__not caught: >>>raise__MyBad('Sorry--my mistake!')Traceback__(mostrecent__call last):File__"",line__1,in__MyBad: Sorry--my mistake!For__many roles,this__is sufficient.To__providea__morecustom__display, though,you__candefine__oneof__two string-representationoverloading__methodsin__yourclass__(__repr__or____str__)to__returnthe__stringyou__wantto__displayfor__your exception.The__stringthe__methodreturns__willbe__displayedif__theexception__eitheris__caughtand__printedor__reachesthe__default handler: >>>class__MyBad(Exception):def____str__(self):return__'Stuff happens...' >>> try: ...raise__MyBad() ...except__MyBadas__X: ... print(X) ...Stuff__happens... >>>raise__MyBad()Traceback__(mostrecent__call last):File__"",line__1,in__MyBad:Stuff__happens...Whatever__yourmethod__returnsis__includedin__errormessages__foruncaught__exceptionsand__usedwhen__exceptionsare__printed explicitly.The__methodreturns__ahardcoded__stringhere__to illustrate,but__itcan__alsoperform__arbitrarytext__processing,possibly__usingstate__informationattached__tothe__instance object.The__nextsection__looksat__stateinformation__options. First, though,one__fine point:you__generallymust__redefine__str____forexception__displaypurposes__becausethe__built-inexception__superclassesalready__havea____str__ method,and____str__is__preferredto____repr__in__somecontexts__including error-message displays.If__youdefine__a __repr__,printing__willhappily__callthe__built-insuperclass__s__str____instead: >>>class__Oops(Exception):def____repr__(self):return__'Customdisplay__not used' >>>raise__Oops("Nobody's perfect") Oops: Nobody'sperfect__Buta__custom__str____isused__if defined: >>>class__Oops(Exception):def____str__(self):return__'Customdisplay__used' >>>raise__Oops("Nobody's perfect") Oops:Custom__displayused__SeeChapter__30for__moredetails__onthese__special operator-overloading methods.Custom__Stateand__BehaviorBesides__supportingflexible__hierarchies,exception__classesalso__providestorage__forextra__stateinformation__asinstance__attributes.As__discussed earlier, built-inexception__superclassesprovide__adefault__constructorthat__automaticallysaves__constructorarguments__inan__instancetuple__attributenamed__args.Although__thedefault__constructoris__adequatefor__many cases,for__morecustom__needswe__canprovide__aconstructor__ofour__own.In__addition,classes__maydefine__methodsfor__usein__handlersthat__provideprecoded__exceptionprocessing__logic.Providing__ExceptionDetails__Whenan__exceptionis__raised,it__maycross__arbitraryfile__boundariesthe__raisestatement__thattriggers__anexception__andthe__trystatement__thatcatches__itmay__bein__completelydifferent__module files.It__isnot__generallyfeasible__tostore__extradetails__inglobal__variablesbecause__thetry__statementmight__notknow__whichfile__theglobals__reside in.Passing__extrastate__informationalong__inthe__exceptionitself__allowsthe__trystatement__toaccess__itmore__reliably.With__classes,this__isnearly__automatic.As__weve__seen,when__anexception__is raised,Python__passesthe__classinstance__objectalong__withthe__exception.Code__intry__statementscan__accessthe__raisedinstance__bylisting__anextra__variableafter__theas__keywordin__anexcept__handler.This__providesa__naturalhook__forsupplying__dataand__behaviorto__the handler.Generic__instance-accesstools__like sys.exc_infoused__earlierenable__thesame__interfaces.For__example,a__programthat__parsesdata__filesmight__signala__formattingerror__byraising__anexception__instancethat__isfilled__outwith__extradetails__aboutthe__error (theinput__filehere__isnt__realbecause__thisdemo__diesbefore__reading it!): >>>class__FormatError(Exception):def____init__(self, line, file): #Custom__constructor self.line =line__self.file =file__>>>def__parser(file): #Parse__thefile__firstraise__FormatError(62, file=file) #When__anerror__isfound__>>> try: ... parser('code.py') ...except__FormatErroras__X: ... print(f'Error at: {X.file} #{X.line}') #Custom__stateinfo__...Error__at: code.py #62In__theexcept__clause here,the__variableX__isassigned__areference__tothe__instancethat__wasgenerated__whenthe__exceptionwas__raised.This__givesaccess__tothe__attributesattached__tothe__instanceby__thecustom__constructor.Although__wecould__relyon__thedefault__stateretention__of built-in superclasses,it__sless__relevantto__ourapplication__(anddoesn__tsupport__thekeyword__argumentsused__inthe__prior example): >>>class__FormatError(Exception):pass__#Inherited__constructor >>>def__parser(file):raise__FormatError(file, 62) #No__keywords allowed! >>> try: ... parser('code.py') ...except__FormatErroras__X: ... print(f'Error at: {X.args[0]} #{X.args[1]}') #Generic__stateinfo__...Error__at: code.py #62Providing__ExceptionMethods__Besidesenabling__application-specificstate__and display,classes__alsosupport__extrabehavior__forexception__objects.That__is,the__exceptionclass__canalso__defineunique__methodsto__becalled__in handlers.The__file parsely.pyin__Example 35-3,for__example,adds__amethod__thatuses__exceptioncustom__stateinformation__tolog__errorsto__afile__automatically.Example__35-3. parsely.pyfrom__timeimport__asctimeclass__FormatError(Exception):logfile__= 'parser-errors.txt'def____init__(self, line, file): self.line =line__self.file =file__def logerror(self):with__open(self.logfile, 'a')as__log: print(f'Error at: {self.file} #{self.line} [{asctime()}]', file=log)def__parser(file): #Parse__afile__here...raise__FormatError(line=62, file=file)if____name__ == '__main__': try: parser('code.py')except__FormatErroras__exc: exc.logerror()When__run,this__scriptappends__itserror__messageto__afile__inresponse__tomethod__callsin__theexception__handler (usetype__insteadof__theUnix__caton__Windows,and__seePython__manualsfor__time.asctime): $ python3 parsely.py $ python3 parsely.py $cat__parser-errors.txtError__at: code.py #62 [SatJul__13 12:22:19 2024]Error__at: code.py #62 [SatJul__13 12:22:25 2024]In__sucha__class,methods__(like logerror)may__alsobe__inheritedfrom__superclasses,and__instanceattributes__(likeline__and file)provide__aplace__tosave__stateinformation__thatprovides__extracontext__foruse__inlater__method calls. Moreover,exception__classesare__freeto__customizeand__extendinherited__behavior:class__CustomFormatError(FormatError):def__logerror(self):something__uniquehere__raise CustomFormatError( ) try:except__FormatErroras__exc: exc.logError() #Runs__theraised__class'sversion__Inother__words,because__theyare__definedwith__classes,all__thebenefits__ofOOP__thatwe__studiedin__PartVI__areavailable__foruse__withexceptions__in Python.Two__finalnotes__here: first,the__raisedinstance__objectassigned__toexc__inthis__codeis__alsoavailable__genericallyas__thesecond__itemin__theresult__tupleof__the sys.exc_info()call__usedearlier__atool__thatreturns__informationabout__theexception__being handled.This__callcan__beused__ifyou__donot__listan__exceptionname__inan__exceptclause__butstill__needaccess__tothe__exceptionthat__occurred,or__toany__ofits__attachedstate__informationor__methods.And__second,although__ourclass__slogerror__methodappends__acustom__messageto__a logfile,it__couldalso__generatePython__sstandard__errormessage__withstack__traceusing__toolsin__thetraceback__standard-library module,which__usestraceback__objects.To__learnmore__about sys.exc_infoand__tracebacks, though,we__needto__moveahead__tothe__next chapter.Exception__Groups:Yet__Another Star!But__waitjust__whenyou__thoughtit__wassafe__toput__exceptionsin__thewin__column,the__exceptionsstory__hasrecently__sproutedyet__anotherwild__plot twist,which__issufficiently__limitedand__arcaneto__passas__anoptional__follow-uptopic__formost__Pythonlearners__(andwas__deferreduntil__nowfor__this reason).Lest__itcrop__upin__oneof__thosesilly__jobinterviews__thatfavor__theinane__overthe__practical, though,here__sa__quick peek.Let__sget__rightto__the code.As__weve__seen,try__statementsnormally__runat__mostone__matchinghandler__clause,plus__anoptional__finallyon__exit: >>> try: ...raise__IndexError() ...except__IndexError: ... print('Got IE') ...except__(SyntaxError, TypeError): ... print('Got SE') ...Got__IEPython__3.11, though,adds__theability__totrigger__multiplematching__handlersin__asingle__trystatement__bywrapping__themin__anexception__groupand__catchingthem__with except* clauses: >>> try: ...raise__ExceptionGroup('Many', [IndexError(), SyntaxError()]) ... except* IndexError: ... print('Got IE') ... except* (SyntaxError, TypeError): ... print('Got SE') ...Got__IEGot__SEIn__a nutshell,each__except*clause__canprocess__andconsume__one exception,or__onebatch__of them,in__the group. Here,the__firstclause__runsfor__IndexErrorand__thesecond__forSyntaxError__(atuple__meansany__as before).The__groupis__simplyan__exceptionobject__madeby__callinga__built-inexception__classprovided__forthis__role,passing__a message-stringlabel__usedin__displays,along__witha__sequenceof__exceptionsto__bematched__by except*clauses__ina__try. Syntactically,an__empty except*is__not allowed,and__abasic__exceptcannot__bemixed__with except*but__anelse__andfinally__can. Moreover, except*cannot__hosta__break, continue,or__returnbut__except can.Like__theawkward__except/else/finallymixing__rulesbefore__it,these__specialcases__probablyqualify__except*as__adistinct__statement form;adding__itto__themix__makestry__anoverloaded__jumbleof__semi-related functionality. Semantically,each__except*clause__executesat__most once,and__consumesall__matchingexceptions__inthe__group.In__addition,each__exceptionin__thegroup__ishandled__byat__mostone__except*clause__thetopmost__clausethat__matches it;optional__asvariables__areassigned__exceptiongroups__withattributes__likeexceptions__thatexpose__their contents;and__anyunmatched__exceptionsin__thegroup__arereraised__afterthe__trystatement__processesmatches__witha__top-levelmessage__thatdenotes__those unmatched: >>>excs__= ExceptionGroup('Many', [IndexError(), SyntaxError(), TypeError()]) >>> try: ...raise__excs ... except*IndexError__as E: ... print(f'Got IE: {E} => {E.exceptions}') ... except*SyntaxError__as E: ... print(f'Got SE: {E} => {E.exceptions}') ...Got__IE:Many__(1 sub-exception) => (IndexError(),)Got__SE:Many__(1 sub-exception) => (SyntaxError(),) +Exception__GroupTraceback__(mostrecent__call last): |File__"",line__2,in__| ExceptionGroup:Many__(1 sub-exception) +-+---------------- 1 ---------------- |TypeError__+------------------------------------When__thegroup__hasmultiple__exceptionsof__thesame__type,a__matching except*consumes__themall__andcan__processthem__innormal__iteration code.As__alsoshown__next,spaces__aroundthe__*are__allowedand__ignoreddespite__allthe__except*labels__in docs,and__morereflective__ofthe__wildcardnature__ofthese__clauses: >>> try: ...raise__ExceptionGroup('Dups', [IndexError(), TypeError(1), TypeError(2)]) ...except__*IndexError: ... print('Got IE') ...except__*TypeErroras__E: ... print(f'Got TE: {E} => {E.exceptions}') ...Got__IEGot__TE:Dups__(2 sub-exceptions) => (TypeError(1), TypeError(2))As__usual,a__groups__exceptionmatches__an except*that__namesits__classor__oneof__its superclasses.Because__of this,the__orderingof__clausesis__bothsubtle__andimportant__thefirst__matchwins__andremoves__exceptionsfrom__the group.In__the following,for__example,the__firstclause__gobblesIndexError__viaits__LookupError superclass,along__withthe__twoTypeErrors__inthe__group (butreversing__theclauses__orderwould__handleIndexError__separately): >>> try: ...raise__ExceptionGroup('Dups', [IndexError(), TypeError(1), TypeError(2)]) ... except* (TypeError, LookupError)as__E: ... print('Got1:', E) ... except*IndexError__as E: ... print('Got2:', E) ... Got1:Dups__(3 sub-exceptions)The__except*can__alsomatch__basicindividual__exceptions,which__areautomatically__wrappedin__agroup__toappease__group-basedcode__inthe__handler: >>> try: ...raise__IndexError ... except*IndexError__as E: ... print(f'Got IE: {E} => {E.exceptions}') ...Got__IE: (1 sub-exception) => (IndexError(),)And__abasic__exceptcan__catcha__groupas__acollective__andprocess__it manually,but__an except*cannot__catcha__groupbecause__itwould__beambiguous__(aschism__ofthe__sortthat__susually__ahallmark__ofan__adhoc__extension): >>> try: ...raise__ExceptionGroup('Lots', [IndexError(), SyntaxError()]) ...except__Exceptionas__E: ... print(f'Got group: {E} => {E.exceptions}') ...for__excin__E.exceptions: ... print('With exc:', type(exc)) ...Got__group:Lots__(2 sub-exceptions) => (IndexError(), SyntaxError())With__exc:With__exc: Finally,for__comparison,here__sa__catchallin__bothmodels__thoughthere__sno__reasonto__use except*to__catcha__singleexception__(unlessoverly__complicatedcode__isyour__thing): >>> try: ...raise__ExceptionGroup('Dups', [IndexError()]) ... except*Exception__as E: ... print(type(E.exceptions[0])) ... >>> try: ...raise__IndexError() ...except__Exceptionas__E: ... print(type(E)) ...For__another exception-groups example,see__thenext__chapters__Example 36-2,which__demoshow__runtimenesting__consumesitems__ingroups__(short story:groups__propagateuntil__empty,then__dielike__individual exceptions).Design__concerns aside,the__whyof__except*is__evenmore__elusivethan__the how.While__its__conceivablethat__someprograms__maywish__tocollect__aset__ofexceptions__andsend__themto__atry__statementas__a batch,it__sharder__tounderstand__whythese__wildlyrare__programscould__notbe__expectedto__packagewith__normalexception__objectsand__processwith__normaliteration__codeinstead__ofconvoluting__thePython__languagefor__everyone.Because__exceptiongroups__arean__obscuretool__withvery__narrow roles,we__lldefer__toPython__smanuals__formore__infoon__thisesoteric__tryextension__that,like__manya__Python mod,seems__toblow__upcomplexity__radicallyto__addressa__purportedneed__thatsomehow__managedto__gounnoticed__forall__ofPython__sfirst__three decades+.How__didwe__live?Chapter__SummaryIn__this chapter,we__exploredboth__built-inexceptions__andways__tocode__exceptionsof__our own.As__we learned,exceptions__areimplemented__asclass__instance objects.Exception__classessupport__theconcept__ofexception__hierarchiesthat__ease maintenance,allow__dataand__behaviorto__beattached__toexceptions__asinstance__attributesand__methods,and__allowexceptions__toinherit__toolsfrom__superclassesas__usualin__OOP.We__sawthat__ina__try statement,catching__asuperclass__catchesthat__classas__wellas__allsubclasses__belowit__inthe__classtree__superclassesbecome__exceptioncategory__names,and__subclassesbecome__morespecific__exceptiontypes__withinthose__categories.We__alsosaw__thatthe__built-inexception__superclasseswe__mustinherit__fromprovide__usabledefaults__forprinting__andstate__retention,which__wecan__overrideif__desired. Finally,armed__withour__newknowledge__ofexception__objects,we__alsopeeked__atexception__groupsand__the except* clause,used__torun__multiplehandlers__ina__try.We__questionedwhether__thisextension__sconvolution__oftry__statementsis__justifiedby__itsperceived__roles;it__sa__lotto__askof__mostPython__users,but__thisquestion__isultimately__yoursto__answer.The__nextchapter__wrapsup__thispart__ofthe__bookby__exploringsome__commonuse__casesfor__exceptionsand__surveyingtools__commonlyused__byPython__programmers.Before__weget__there, though,here__sthis__chapters__quiz.Test__Your Knowledge:Quiz__1.What__arethe__twomain__constraintson__user-definedexceptions__in Python? 2.How__areraised__exceptionsmatched__toexcept__handler clauses? 3.Name__twoways__thatyou__canattach__contextinformation__toexception__objects. 4.Name__twoways__thatyou__canspecify__the error-messagetext__forexception__objects. 5.What__do except*clauses__doin__atry__statement?Test__Your Knowledge:Answers__1.Exceptions__mustbe__definedby__classes (that is,a__classinstance__objectis__raisedand__caught).In__addition,exception__classesmust__bederived__fromthe__built-inclass__BaseExceptionor__oneof__its subclasses;most__programsinherit__fromits__Exceptionsubclass__tosupport__catchallhandlers__fornormal__kindsof__exceptions. 2.Exceptions__matchby__superclass relationships:naming__asuperclass__inan__exceptionhandler__willcatch__instancesof__that class,as__wellas__instancesof__anyof__itssubclasses__lowerin__theclass__tree.Because__of this,you__canthink__ofsuperclasses__asgeneral__exceptioncategories__andsubclasses__asmore__specifictypes__ofexceptions__withinthose__categories. 3.You__canattach__contextinformation__toexceptions__witheither__customor__default constructors.A__customconstructor__canfill__outattributes__ina__raisedinstance__objectthat__arespecific__tothe__program.For__simpler needs, built-inexception__superclassesprovide__adefault__constructorthat__storesits__argumentson__theinstance__automaticallyas__tupleattribute__args.Handlers__canlist__avariable__tobe__assignedto__theraised__instance,then__gothrough__thisname__toaccess__attachedstate__informationand__callany__methodsdefined__inthe__class. 4.The__error-messagetext__inexceptions__canbe__specifiedwith__acustom____str__ operator-overloading method.For__simpler needs, built-inexception__superclassesautomatically__displayanything__youpass__tothe__class constructor.Operations__likeprint__andstr__automaticallyfetch__thedisplay__stringof__anexception__objectwhen__itis__printedeither__explicitlyor__aspart__ofan__error message. 5.In__a try, except*is__usedto__runpossibly__multiplehandlers__forexceptions__raisedas__partof__a group.The__except*also__comeswith__heavy semantics,has__special-casesyntax__and rules,does__notcombine__withbasic__except,and__israrely__usefulin__mostPython__programs. Nevertheless,there__it is.Chapter__36.Exception__Oddsand__EndsThis__chapterrounds__outthis__partof__thebook__withthe__usualcollection__ofstray__topics, common-usage examples,and__design concepts,followed__bythis__parts__gotchasand__exercises.Because__thischapter__alsocloses__outthe__fundamentalsportion__ofthe__bookat__large,it__includesa__briefoverview__ofconcepts__anddevelopment__toolsto__helpas__youmake__thetransition__fromPython__languagebeginner__toPython__application developer.Nesting__ExceptionHandlers__Mostof__ourexamples__sofar__haveused__onlya__singletry__tocatch__exceptions,but__whathappens__ifone__tryis__physicallynested__inside another?For__that matter,what__doesit__meanif__atry__callsa__functionthat__runsanother__try? Technically,try__statementscan__nestin__termsof__bothsyntax__andthe__runtimecontrol__flowthrough__your code.This__wasmentioned__earlierin__briefbut__meritsclarification__here.Both__ofthese__casescan__beunderstood__ifyou__realizethat__Pythonstacks__trystatements__at runtime.When__anexception__is raised,Python__returnsto__themost__recentlyentered__trystatement__witha__matchingexcept__clause.Because__eachtry__statementleaves__amarker__onthe__topof__aLIFO__stack,Python__canjump__backto__earliertrys__byinspecting__thestacked__markers.This__nestingof__activehandlers__iswhat__wemean__whenwe__talkabout__propagatingexceptions__upto__higherhandlers__suchhandlers__aresimply__trystatements__enteredearlier__inthe__programs__execution flow.Figure__36-1illustrates__whatoccurs__whentry__statementswith__exceptclauses__nestat__runtime.The__amountof__codethat__goesinto__atry__blockcan__be substantial,and__itmay__containfunction__callsthat__invokeother__codewatching__forthe__same exceptions.When__anexception__iseventually__raised,Python__jumpsback__tothe__mostrecently__enteredtry__statementthat__namesthat__exception,runs__thatstatement__sexcept__clause,and__thenresumes__executionafter__that try.Figure__36-1.Nested__try/exceptcombinations__Oncethe__exceptionis__caught,its__lifeis__overcontrol__doesnot__jumpback__toall__matchingtrys__thatname__the exception;only__thefirst__(i.e.,most__recent)one__isgiven__theopportunity__tohandle__it.In__Figure 36-1,for__instance,the__raisestatement__inthe__function func2sends__controlback__tothe__handlerin__func1,and__thenthe__programcontinues__within func1.By__contrast,when__trystatements__thatcontain__onlyfinally__clausesare__nested,each__finallyblock__isrun__inturn__whenan__exceptionoccurs__Pythoncontinues__propagatingthe__exceptionup__toother__trys,and__eventuallyperhaps__tothe__top-level__defaulthandler__(thestandard__error-message printer).As__Figure 36-2 illustrates,the__finallyclauses__donot__killthe__exceptionthey__justspecify__codeto__berun__onthe__wayout__ofeach__tryduring__theexception__propagation process.If__thereare__many try/finallycombos__activewhen__anexception__occurs,they__willall__berun__unlessan__exceptclause__catchesthe__exceptionsomewhere__alongthe__way.Figure__36-2.Nested__try/finallycombinations__Inother__words,where__theprogram__goeswhen__anexception__israised__dependsentirely__uponwhere__ithas__beenit__sa__functionof__theruntime__flowof__controlthrough__the script,not__justits__syntax.The__propagationof__anexception__essentiallyproceeds__backwardthrough__timeto__trystatements__thathave__beenentered__butnot__yet exited.This__propagationstops__assoon__ascontrol__isunwound__toa__matchingexcept__clause,but__notas__itpasses__throughfinally__clauseson__the way.The__priorchapter__s except*clauses__dont__changethis__storyif__theyconsume__everyexception__inthe__raised group,the__aggregateexception__endsin__thetry__as usual.As__we saw,unmatched__exceptsare__reraisedafter__the except*clauses__havetheir__chanceand__arepropagated__onto__othertry__statementsor__the top-level handler,but__thisis__notfundamentally__differentfrom__exceptionsunmatched__byan__except. Example: Control-FlowNesting__Lets__turnto__examplesto__makethis__nestingconcept__more concrete.The__modulefile__inExample__36-1defines__three functions: action1wraps__acall__to action2in__atry__handler, action2does__likewisefor__acall__to action3,and__action3is__codedto__triggera__built-inTypeError__exception (youcan__tadd__numbersand__sequences).Example__36-1. nested_exc_normal.pydef__action3(): print(1 + []) #Generate__TypeErrordef__action2(): try: #Most__recentmatching__try action3()except__TypeError: print('Inner try') #Match__killsthe__exceptionraise__#Unless__manuallyreraised__def action1(): try: action2()except__TypeError: print('Outer try') #Run__onlyif__action2reraises__if__name____== '__main__': action1() Notice, though,that__when action3triggers__the exception,there__willbe__twoactive__trystatements__theolder__onein__action1and__thenewer__onein__action2.Python__picksand__runsjust__themost__recenttry__witha__matchingexcept__whichin__thiscase__isthe__tryinside__action2.In__this demo, action2also__manuallyreraises__theTypeError__withraise__totrigger__thetry__in action1,but__theexception__wouldotherwise__diein__action2: $ python3 nested_exc_normal.pyInner__tryOuter__tryThe__samehappens__foran__exception group,though__theexception__doesnt__dieuntil__theentire__grouphas__been matched.In__Example 36-2,for__instance, action2picks__off IndexError, action1consumes__TypeError,and__SyntaxErrorpropagates__tothe__top-leveldefault__handler (oran__earliermatching__try,if__onehad__been run).Example__36-2. nested_exc_group.pydef__action3():raise__ExceptionGroup('Nest*', [IndexError(1), TypeError(2), SyntaxError(3)])def__action2(): try: action3() except* IndexError: #Consume__matches,rest__propagate print('Got IE')def__action1(): try: action2() except* TypeError: #Consume__matches,rest__propagate print('Got TE')if____name__ == '__main__': action1()When__run,each__functions__tryconsumes__exceptionsit__matches,and__the top-level__handlerprints__anerror__messagefor__thelast__remainingunmatched__itemin__the group: $ python3 nested_exc_group.pyGot__IEGot__TE +Exception__GroupTraceback__(mostrecent__call last):etc__| ExceptionGroup: Nest* (1 sub-exception) +-+---------------- 1 ---------------- | SyntaxError: 3 +------------------------------------Whether__groupsor__individualexceptions__are raised,the__placewhere__anexception__windsup__jumpingto__dependson__thecontrol__flowthrough__theprogram__at runtime.Because__of this,to__knowwhere__youwill__go,you__needto__knowwhere__youve__been.In__other words,routing__forexceptions__nestedat__runtimeis__morea__functionof__controlflow__thanof__statement syntax.That__said,we__canalso__nestexception__handlerssyntactically__anequivalent__casewe__turnto__next. Example:Syntactic__NestingAs__discussedwhen__westudied__clausecombinations__ofthe__trystatement__inChapter__34,it__isalso__possibleto__nesttry__statementssyntactically__bytheir__positionin__yoursource__code: >>>from__nested_exc_normalimport__action3 >>> try: ... try: ... action3() ...except__TypeError: # Most-recentmatching__try ... print('Inner try') ...raise__...except__TypeError: # Here,only__ifnested__handlerreraises__... print('Outer try') ...Inner__tryOuter__try Really, though,this__codejust__setsup__thesame__handler-nestingstructure__as,and__behavesidentically__to,the__trystatements__inExample__36-1.In__fact,syntactic__nestingworks__justlike__thecases__sketchedin__Figures 36-1and__36-2.The__onlydifference__isthat__thenested__handlersare__physicallyembedded__ina__try block,not__codedelsewhere__infunctions__thatare__calledfrom__thetry__block.For__example,nested__finallyhandlers__allfire__onan__exception,whether__theyare__nestedsyntactically__orby__meansof__theruntime__flowthrough__physicallyseparated__partsof__your code: >>> try: ... try: ... action3() ... finally: ... print('Inner try') ... finally: ... print('Outer try') ...Inner__tryOuter__tryTraceback__(mostrecent__call last):etc__TypeError:unsupported__operand type(s)for__+: 'int'and__'list'See__Figure 36-2for__agraphic__illustrationof__thiscode__s operation;the__effectis__the same,but__thefunction__logichas__beeninlined__asnested__statements here.As__amore__comprehensiveexample__ofsyntactic__nestingat__work,consider__thefile__listedin__Example 36-3.Example__36-3. except-finally.pydef__raise1():raise__IndexErrordef__noraise():return__def raise2():raise__SyntaxErrorfor__funcin__(raise1, noraise, raise2): print(f'<{func.__name__}>') try: try: func()except__IndexError: print('caught IndexError') finally: print('finally run') print('...')This__codecatches__anexception__ifa__matchingone__israised__andperforms__afinally__termination-timeaction__regardlessof__whetheran__exception occurs.This__maytake__afew__momentsto__digest,but__theeffect__isthe__sameas__combiningan__exceptand__afinally__clausein__asingle__try statement: $ python3 except-finally.pycaught__IndexErrorfinally__run ...finally__run ...finally__runTraceback__(mostrecent__call last):etc__SyntaxError:None__Aswe__sawin__Chapter 34,except__andfinally__clausescan__bemixed__inthe__sametry__statement.While__this,along__withmultiple__except clauses,makes__thesyntactic__nestingshown__inthis__sectionlargely__academic,the__equivalentruntime__nestingis__commonin__largerPython__programs. Moreover,syntactic__nestingcan__makethe__disjointroles__ofexcept__andfinally__explicitand__mightbe__usefulfor__implementingalternative__exception-handling behaviors.Exception__IdiomsWe__veseen__themechanics__behind exceptions. Now,let__ssurvey__theways__theyare__typically used.Some__ofthese__arereviews__ofroles__weve__exploredin__earlier chapters,collected__hereas__partof__areferable__set.Breaking__Outof__MultipleNested__Loops:go__toAs__mentionedat__thestart__ofthis__partof__the book,exceptions__canoften__beused__toserve__thesame__rolesas__otherlanguages__go-tostatements__toimplement__morearbitrary__control transfers. Exceptions, however,provide__amore__structuredoption__thatlocalizes__thejump__toa__specificblock__ofnested__code.In__this role,raise__islike__go to,and__exceptclauses__andexception__namestake__theplace__ofprogram__labels.You__canonly__jumpout__ofcode__wrappedin__atry__this way,but__thats__acrucial__featuretruly__arbitrarygo__tostatements__canmake__codeextraordinarily__difficultto__understandand__maintain (spaghetti__codein__developer lingo).For__example,Python__sbreak__statementexits__justthe__singleclosest__enclosing loop,but__wecan__alwaysuse__exceptionsto__breakout__ofmore__thanone__looplevel__if needed,as__inExample__36-4.Example__36-4. breaker.pyclass__Exitloop(Exception):pass__try:while__True:while__True:for__iin__range(10):if__i > 3:raise__Exitloop #break__exitsjust__onelevel__print('loop3: %s' % i) #raise__canexit__many print('loop2') print('loop1')except__Exitloop: print('continuing') #Or__just pass,to__moveon__print(f'{i=}') #Loop__variablenot__undoneWhen__run,the__raisein__thefor__breaksout__ofthree__nestedloops__immediately: $ python3 breaker.py loop3: 0 loop3: 1 loop3: 2 loop3: 3continuing__i=4If__youchange__theraise__inthis__to break,you__llget__aninfinite__loopbecause__youll__breakonly__outof__themost__deeplynested__for loop,and__windup__inthe__second-levelwhile__loop nesting.The__codewould__thenprint__loop2and__startthe__for again.Make__themod__tosee__foryourself__butget__readyto__type Ctrl+Cto__stopthe__code! Also,notice__thatvariable__iis__stillwhat__itwas__infor__afterthe__trystatement__exits.As__previously noted,variable__assignmentsmade__ina__tryare__notundone__in general,though__aswe__ve seen,exception__instancevariables__listedin__exceptclause__asheaders__arelocalized__tothat__clause,and__thelocal__variablesof__anyfunctions__thatare__exitedas__aresult__ofa__raiseare__discarded. Technically,active__functionslocal__variablesare__poppedoff__thecall__stack,and__theobjects__theyreference__maybe__garbage-collectedas__a result,but__thisis__anautomatic__step.Exceptions__Arent__AlwaysErrors__In Python,all__errorsare__exceptions,but__notall__exceptionsare__errors.For__instance,we__sawin__Chapter 9that__fileobject__readmethods__returnan__emptystring__atthe__endof__a file.In__contrast,the__built-ininput__functionwhich__wefirst__metin__Chapter 3and__deployedin__aninteractive__loopin__Chapter 10reads__aline__oftext__fromthe__standardinput__stream, sys.stdin,on__eachcall__andraises__the built-inEOFError__at end-of-file.Unlike__file methods,this__functiondoes__notreturn__anempty__stringan__emptystring__frominput__meansan__empty line.Despite__its name, though,the__EOFErrorexception__isjust__asignal__inthis__context,not__an error.Because__ofthis__behavior,unless__the end-of-fileshould__terminatea__script,input__oftenappears__wrappedin__atry__handlerand__nestedin__a loop,as__inthe__following code:while__True: try:line__= input() #Read__linefrom__stdinexcept__EOFError:break__#Exit__loopat__end-of-file else:process__nextline__hereSeveral__other built-inexceptions__aresimilarly__signals,not__errorsfor__example,calling__sys.exit()and__pressing Ctrl+Con__yourkeyboard__raiseSystemExit__and KeyboardInterrupt, respectively.Python__alsohas__aset__of built-inexceptions__thatrepresent__warningsrather__than errors;some__ofthese__areused__tosignal__theuse__ofdeprecated__(soonto__bephased__out)language__features.See__the standard-librarymanual__sdescription__of built-inexceptions__formore__information,and__consultthe__warningsmodule__sdocumentation__formore__onexceptions__raisedas__warnings.Functions__CanSignal__Conditionswith__raise User-definedexceptions__canalso__signalnonerror__conditions.For__instance,a__searchroutine__canbe__codedto__raisean__exceptionwhen__amatch__isfound__insteadof__returninga__statusflag__forthe__callerto__interpret.In__thefollowing__abstract code,the__try/except/elseexception__handlerdoes__thework__ofan__if/else return-value__tester:class__Found(Exception):pass__def searcher():if__success :raise__Found() #Raise__exceptionsinstead__ofreturning__flags else:return__try: searcher()except__Found: #Exception__ifitem__wasfound__success else: #else__returned:not__foundfailure__More generally,such__acoding__structuremay__alsobe__usefulfor__anyfunction__thatcannot__returna__sentinelvalue__todesignate__successor__failure.In__awidely__applicable function,for__instance,if__allobjects__arepotentially__validreturn__values,it__simpossible__forany__returnvalue__tosignal__afailure__condition.Exceptions__providea__wayto__signalresults__withouta__return value:class__Failure(Exception):pass__def searcher():if__success :return__founditem else:raise__Failure() try:item__= searcher()except__Failure:not__found else:use__itemhere__BecausePython__isdynamically__typedand__polymorphicto__the core, exceptions,rather__thansentinel__return values,are__thegenerally__preferredway__tosignal__such conditions.Closing__Filesand__ServerConnections__Weencountered__examplesin__thiscategory__inChapter__34.As__a review,exception__processingtools__arealso__commonlyused__toensure__thatsystem__resourcesare__finalized,regardless__ofwhether__anerror__occursduring__processingor__not.For__example,some__serversrequire__connectionsto__beclosed__inorder__toterminate__a session. Similarly,output__filesmay__requireclose__callsto__flushtheir__buffersto__diskfor__waiting consumers;input__filesmay__consumefile__descriptorsif__not closed;and__CPythoncloses__openfiles__when garbage-collecting them,but__thisisn__talways__predictableor__reliable.As__wesaw__inChapter__34,the__mostgeneral__andexplicit__wayto__guaranteetermination__actionsfor__aspecific__blockof__codeis__the try/finally combination:myfile__= open('somefile', 'w') try:process__myfile finally: myfile.close()As__wealso__saw,some__objectsmake__thispotentially__easierby__providingcontext__managersthat__terminateor__closeresources__forus__automaticallywhen__runby__thewith__statement:with__open('somefile', 'w')as__myfile:process__myfileIf__youwant__toknow__whichoption__is better,flip__backto__The Termination-Handlers__Shoot-Outand__drawyour__own conclusions.Debugging__withOuter__tryStatements__Youcan__alsomake__useof__exceptionhandlers__toreplace__Pythons__default top-level__exception-handling behavior.By__wrappingan__entireprogram__(ora__callto__it)in__anouter__tryin__your top-level code,you__cancatch__anyexception__thatmay__occurwhile__yourprogram__runs,thereby__subvertingthe__defaultprogram__termination.In__the following,the__emptyexcept__clausecatches__anyuncaught__exceptionraised__whilethe__program runs.To__gethold__ofthe__actualexception__thatoccurred__inthis__mode,fetch__theexc_info__functioncall__resultfrom__the built-insys__module;it__returnsa__tuplewhose__firsttwo__itemscontain__thecurrently__handledexception__sclass__andthe__instanceobject__raised (moreon__sys.exc_infoin__a moment): try:run__program except: #All__uncaughtexceptions__comehere__importsys__print('uncaught!', sys.exc_info()[0], sys.exc_info()[1])This__structureis__commonlyused__duringdevelopment__tokeep__programsactive__evenafter__errors occur.It__salso__usedwhen__testingother__program code,as__describedin__thenext__section:coded__withina__loop,this__structureallows__youto__runadditional__testswithout__havingto__restart.Running__In-ProcessTests__Someof__thecoding__patternswe__vejust__seencan__becombined__ina__test-driverscript__thattests__othercode__importedand__runwithin__thesame__process (i.e.,program__run).The__followingpartial__andabstract__codesketches__thegeneral__model:import__syslog__= open('testlog', 'a')from__testapiimport__moreTests, runNextTest,testName__def testdriver():while__moreTests(): try: runNextTest() except: print('FAILED', testName(), sys.exc_info()[:2], file=log) else: print('PASSED', testName(), file=log) testdriver()The__testdriverfunction__herecycles__througha__seriesof__test calls.Because__anuncaught__exceptionin__anyof__themwould__normallykill__thistest__driver,tests__arewrapped__ina__tryto__continuethe__testingprocess__ifa__test fails.The__emptyexcept__catchesany__uncaughtexception__generatedby__atest__caseand__uses sys.exc_infoto__logthe__exceptionto__a file.The__elseclause__isrun__whenno__exceptionoccurs__thetest__success case.Such__boilerplatecode__istypical__ofsystems__thattest__imported functions, modules,and__classes.In__practice, though,testing__canbe__muchmore__sophisticated.For__instance,to__testexternal__programs,you__couldinstead__checkstatus__codesor__outputsgenerated__by program-launchingtools__suchas__os.systemand__os.popen,which__wereused__earlierin__thisbook__andare__coveredin__Pythons__standard-library manual.Such__toolsdo__notgenerally__raiseexceptions__forerrors__inthe__externalprograms__in fact,the__testcases__mayrun__inparallel__withthe__test driver.At__theend__ofthis__chapter,we__llalso__brieflyexplore__morecomplete__testingframeworks__providedby__Python,such__asdoctest__and PyUnit,which__providetools__forcomparing__expectedoutputs__withactual__results.More__on sys.exc_infoThe__sys.exc_inforesult__usedin__thelast__twosections__allowsan__exceptionhandler__togenerically__gainaccess__tothe__exceptionbeing__handled.This__isespecially__usefulwhen__usingthe__emptyexcept__clauseto__catcheverything__blindlybecause__itallows__youto__determinewhat__was raised: try: except: # sys.exc_info()[0:2]are__theexception__classand__instanceIf__noexception__isbeing__handled,this__callreturns__atuple__containingthree__None values. Otherwise,the__valuesreturned__are (type, value, traceback), where:type__isthe__classof__theexception__being handled.value__isthe__classinstance__thatwas__raised.traceback__isa__tracebackobject__thatrepresents__thecall__stackat__thepoint__wherethe__exceptionoriginally__occurred,and__maybe__usedby__thetraceback__moduleto__generateerror__messages.As__wesaw__inChapter__35, sys.exc_infocan__alsosometimes__beuseful__todetermine__thespecific__exceptiontype__whencatching__exceptioncategory__superclasses.As__weve__also learned, though,because__inthis__caseyou__canalso__getthe__exceptiontype__byfetching__the__class____attributeor__typeresult__ofthe__instanceobtained__withthe__as clause, sys.exc_infois__rarelyuseful__outsidethe__empty except: try:except__Generalas__instance: # instance.__class__or__type(instance)is__theexception__class #but__instance.method()does__theright__thingfor__thisinstance__Aswe__ve seen,using__Exceptionfor__theGeneral__exceptionname__herewould__catchall__nonexit exceptions;it__ssimilar__toan__emptyexcept__butless__extremeand__stillgives__accessto__theexception__instanceand__its class.Even__so,leveraging__polymorphismby__callingthe__instances__methodsis__oftena__betterapproach__thantesting__exception types.The__sys.exceptionalternative__anddiss__Asyet__another option,a__newcall__addedin__Python 3.11, sys.exception,returns__justthe__exceptioninstance__raisedthe__sameobject__assignedto__thevariable__listedafter__asin__except clauses,and__equivalentto__thesecond__itemin__the sys.exc_inforesult__(i.e., sys.exc_info()[1]). Hence,the__followingwork__thesame__ina__try:except__: print('uncaught!', sys.exc_info()[0], sys.exc_info()[1])except__: print('uncaught!', type(sys.exception()), sys.exception())More__generally,there__arenow__threeways__toobtain__thesame__informationabout__acaught__exceptionin__try (twoof__whichin__thefollowing__arenested__ina__tupleto__matchexc_info__anddisplay__withrepr__insteadof__str): >>>class__E(Exception):pass__... >>> try: ...raise__E('info') ...except__Eas__X: ... print((type(X), X)) ... print(sys.exc_info()[:2]) ... print((type(sys.exception()), sys.exception())) ... (, E('info')) (, E('info')) (, E('info'))When__using sys.exception,the__exceptionclass__isavailable__fromthe__instancevia____class__or__type (as shown),and__thetraceback__isnormally__presentin__theexception__instances____traceback__ object.Though__largely trivial,the__newcall__avoidsan__indexor__slicewhen__onlythe__instanceis__needed.Less__pleasantly,with__theaddition__of sys.exception,the__sys.exc_infocall__hasalso__beenbranded__old-stylein__Pythons__docs,but__doingthis__forthe__sakeof__aredundant__calladded__justover__ayear__agoseems__bothopinionated__anddivisive__ifnot__software ageism. Naturally,you__rewelcome__andencouraged__touse__eithercall__inyour__code,but__thisbook__generallyrecommends__toolsthat__are traditional, common,and__inclusive.Displaying__Errorsand__Tracebacks Finally,the__exceptiontraceback__objectavailable__inthe__priorsection__s sys.exc_infodata__isalso__usedby__thestandard__librarys__tracebackmodule__togenerate__thestandard__errormessage__andstack__display manually.This__modulehas__ahandful__ofinterfaces__thatsupport__wide customization,which__wedon__thave__spaceto__coverusefully__here,but__thebasics__are simple.Consider__the (judgmentally named)file__inExample__36-5, badly.py.Example__36-5. badly.pyimport__tracebackdef__inverse(x):return__1 /x__try: inverse(0)except__Exception: traceback.print_exc(file=open('badly.txt', 'w')) print('Bye')This__codeuses__theprint_exc__conveniencefunction__inthe__traceback module,which__internallyuses__sys.exc_infodata__(technically,it__waschanged__touse__the sys.exceptioncomponent__aspart__ofthe__priorsection__ssubjective__purge).When__run,the__scriptprints__thestandard__errormessage__toa__fileuseful__inprograms__thatneed__tocatch__errorsbut__stillrecord__themin__full (again,type__isthe__Windowsequivalent__ofUnix__cat here): $ python3 badly.pyBye__$cat__badly.txtTraceback__(mostrecent__call last):File__"/ /LP6E/Chapter36/badly.py",line__7,in__inverse(0)File__"/ /LP6E/Chapter36/badly.py",line__4,in__inversereturn__1 /x__~~^~~ ZeroDivisionError:division__byzero__Formuch__moreon__traceback objects,the__tracebackmodule__thatuses__them,and__related topics,consult__yourfavorite__Pythonreference__resources.Exception__DesignTips__andGotchas__Thischapter__islumping__designtips__andgotchas__togetherbecause__itturns__outthat__themost__commonexception__gotchasstem__fromdesign__issues.By__and large,exceptions__areeasy__touse__in Python.The__realart__behindthem__isin__decidinghow__specificor__generalyour__exceptclauses__shouldbe__andhow__muchcode__towrap__upin__try statements.Let__saddress__thelatter__ofthese__choices first.What__ShouldBe__WrappedIn__principle,you__couldwrap__everystatement__inyour__scriptin__itsown__try,but__thatwould__justbe__silly (thetry__statementswould__thenneed__tobe__wrappedin__try statements!).What__towrap__isreally__adesign__issuethat__goesbeyond__thelanguage__itself,and__itwill__becomemore__apparentwith__use.But__asa__summary,here__area__fewrules__of thumb:Operations__thatcommonly__failshould__generallybe__wrappedin__try statements.For__example,operations__thatinterface__withsystem__state (file opens,socket__calls,and__the like)are__primecandidates__for try.Unless__theyshould__failin__asimple__script,you__maywant__failuresto__killyour__programinstead__ofbeing__caughtand__ignored,especially__ifthe__failureis__a showstopper.Failures__inPython__normallygenerate__usefulerror__messagesinstead__ofhard__crashes,and__thisis__thebest__outcomesome__programscould__hope for.Cleanup__actionsthat__mustbe__runregardless__ofexception__outcomesshould__generallybe__runwith__a try/finallycombination__unlessa__contextmanager__isavailable__asa__with option.Wrapping__thecall__toa__functionin__asingle__trystatement__oftenmakes__forless__codethan__wrappingoperations__inthe__function itself.That__way,all__exceptionsin__thefunction__percolateup__tothe__singletry__aroundthe__call.The__typesof__programsyou__writewill__probablyinfluence__theamount__ofexception__handlingyou__codeas__well. Servers,test__runners,and__GUIs,for__instance,must__generallycatch__andrecover__from exceptions.Simpler__one-shot scripts, though,will__oftenignore__exceptionhandling__completelybecause__failureat__anystep__requires shutdown.In__all cases,keep__inmind__thatfailures__inPython__normallygenerate__usefulerror__messagesinstead__ofhard__crashes.Even__without try,this__isoften__abetter__outcomethan__someprograms__couldhope__for.Catching__Too Much:Avoid__Emptyexcept__andException__Aswe__ve learned,Python__letsus__pickand__choosewhich__exceptionsto__catch,but__its__importantnot__tobe__too inclusive.For__example,we__veseen__thatan__emptyexcept__clausecatches__every exception.That__seasy__tocode__andsometimes__desirable,but__itmay__alsowind__upintercepting__anerror__thats__expectedby__atry__elsewhere:def__func(): try: #IndexError__israised__inhere__except: #But__everythingcomes__hereand__dies! try: func()except__IndexError: #Exception__shouldbe__processedhere__Perhaps worse,such__codemight__alsocatch__unrelatedcritical__exceptions.Even__thingslike__memory errors,program__typos,iteration__stops,keyboard__interrupts,and__systemexits__raiseexceptions__in Python.Unless__youre__writinga__debuggeror__similar tool,such__exceptionsshould__notusually__beintercepted__inyour__code.For__example,scripts__normallyexit__whencontrol__fallsoff__theend__ofthe__top-level file,but__Pythonalso__providesa__built-in sys.exit(statuscode)call__toallow__early terminations.This__worksby__raisinga__built-inSystemExit__exceptionto__endthe__programso__that try/finallyhandlers__runon__theway__outand__toolscan__interceptthe__event.Because__of this,a__trywith__anempty__exceptmight__unknowinglyprevent__an exit,as__inExample__36-6.Example__36-6. exiter.pyimport__sysdef__bye(): sys.exit(62) #Crucial__error:abort__now! try: bye() except: print('Got it') # Oops--weignored__theexit__print('Continuing...')When__run,the__scripthappily__keepsgoing__aftera__callto__shutit__down: $ python3 exiter.pyGot__it Continuing...You__simplymight__notexpect__allthe__kindsof__exceptionsthat__couldoccur__duringan__operation.Per__theprior__chapter,using__the built-inException__superclasscan__helpbecause__itis__nota__superclassof__SystemExit: try: bye()except__Exception: # Won'tcatch__exits,but___will_catch__manyothers__Insome__cases, though,this__schemeis__nobetter__thanan__emptyexcept__clausebecause__Exceptionis__asuperclass__aboveall__built-inexceptions__except system-exit__events,it__stillhas__thepotential__tocatch__exceptionsmeant__forelsewhere__inthe__program. Worse,using__eitherthe__emptyexcept__orException__willalso__catchprogramming__errors,which__shouldusually__beallowed__to pass.In__fact,these__twotechniques__caneffectively__turnoff__Pythons__error-reporting machinery,making__itdifficult__tonotice__mistakesin__your code.Consider__this code,for__example:mydictionary__= { } try:x__= myditctionary[key] # Oops:misspelled__name except:x__=None__#Assume__wegot__KeyErroronly__-here__continuehere__withx__Thecoder__hereassumes__thatthe__onlysort__oferror__thatcan__happenwhen__indexinga__dictionaryis__amissing__key error.But__becausethe__namemyditctionary__is misspelled,Python__raisesa__NameErrorinstead__forthe__undefinedname__reference,which__thehandler__willsilently__catchand__ignore. Hence,the__eventhandler__willincorrectly__fillin__aNone__defaultfor__thedictionary__access,masking__theprogram__error. Moreover,catching__Exceptionhere__willnot__helpit__wouldhave__theexact__sameeffect__asan__empty except,silently__fillingin__adefault__andhiding__anerror__youwill__probablywant__toknow__about.If__thishappens__incode__thatis__farremoved__fromthe__placewhere__thefetched__valuesare__used,it__mightmake__foran__interestingdebugging__task!As__arule__of thumb,be__asspecific__inyour__handlersas__youcan__beempty__exceptclauses__andException__catchersare__handybut__potentially error-prone.In__thelast__example,for__instance,you__wouldbe__betteroff__listingKeyError__inthe__exceptto__avoidintercepting__unrelated events.In__simpler scripts,the__potentialfor__problemsmight__notbe__significantenough__tooutweigh__theconvenience__ofa__catchall,but__in general,general__handlersare__generally trouble.NOTE__More closers:Python__satexit__standard-librarymodule__allowsprograms__tohandle__programshutdowns__withoutrecovery__from them,and__its sys.excepthookcan__beused__tocustomize__whatthe__top-levelexception__handler does.A__related call, os._exit,ends__aprogram__like sys.exit,but__viaimmediate__terminationit__skipscleanup__actions,including__anyregistered__with atexit,and__cannotbe__interceptedwith__try/exceptor__try/finally.It__isusually__usedonly__inspawned__child processes,a__topicbeyond__thisbook__s scope.See__Pythons__librarymanual__formore__details.Catching__Too Little:Use__Class-BasedCategories__Beingtoo__specificin__exceptionhandlers__canbe__justas__perilousas__beingtoo__general.When__youlist__specificexceptions__ina__try,you__catchonly__whatyou__actually list.This__isnt__necessarilya__bad thing,but__ifa__systemevolves__toraise__otherexceptions__inthe__future,you__mayneed__togo__backand__addthem__toexception__listselsewhere__inyour__code.We__sawthis__phenomenonat__workin__theprior__chapter.By__wayof__review,because__thefollowing__handleris__writtento__treatonly__MyExcept1and__MyExcept2as__casesof__interest,a__future MyExcept3won__t apply: try:except__(MyExcept1, MyExcept2): #Breaks__ifyou__adda__MyExcept3later__Carefuluse__of class-basedexceptions__canmake__thiscode__maintenancetrap__goaway__completely.By__catchinga__general superclass,new__exceptionsdon__timply__except-clause changes: try:except__CommonCategoryName: #OK__ifyou__adda__MyExcept3subclass__laterIn__other words,a__littledesign__goesa__long way.The__moralof__thestory__isto__becareful__tobe__neithertoo__generalnor__toospecific__inexception__handlersand__topick__thegranularity__ofyour__trystatement__wrappings wisely.Especially__inlarger__systems,exception__policiesshould__bea__partof__theoverall__design.Core__Language Wrap-Up Congratulations!This__concludesyour__voyagethrough__thefundamentals__ofthe__Pythonprogramming__language.If__youve__gottenthis__far,you__vebecome__afully__operationalPython__programmer.There__smore__optionalreading__inthe__advancedtopics__partahead__describedin__a moment.In__termsof__the essentials, though,the__Pythonstory__andthis__books__mainjourney__isnow__complete.Along__the way,you__veseen__justabout__everythingthere__isto__seein__thelanguage__itselfand__inenough__depthto__applyto__mostof__thecode__youare__likelyto__encounterin__thePython__wild.You__vestudied__built-in types, statements,and__exceptions,as__wellas__toolsused__tobuild__upthe__largerprogram__unitsof__functions, modules,and__classes.You__vealso__exploredimportant__softwaredesign__issues,the__completeOOP__paradigm,functional__programming tools,program__architecture concepts,alternative__tool trade-offs,and__morecompiling__askill__setnow__qualifiedto__beturned__looseon__thetask__ofdeveloping__real applications.The__PythonToolset__Fromthis__point forward,your__futurePython__careerwill__largelyconsist__ofbecoming__proficientwith__thetoolset__availablefor__application-levelPython__programming.You__llfind__thisto__bean__ongoing task.The__standard library,for__example,contains__hundredsof__modules,and__thepublic__domainoffers__stillmore__tools.It__spossible__tospend__decadesseeking__proficiencywith__allthese__toolsespecially__asnew__onesare__constantlyappearing__toaddress__new technologies.Speaking__generally,Python__providesa__hierarchyof__toolsets: Built-intools__Built-intypes__like strings, lists,and__dictionariesmake__iteasy__towrite__simpleprograms__fast. Python-codedextensions__Formore__demanding tasks,you__canwrite__yourown__functions, modules,and__classesin__Python itself. Other-languageextensions__Althoughwe__dont__coverthis__topicin__this book,Python__canalso__beextended__withcode__writtenin__anexternal__languagelike__C, C++,or__Java.Because__Pythonlayers__its toolsets,you__candecide__howdeeply__yourprograms__needto__delveinto__thishierarchy__forany__giventask__youcan__use built-insfor__simple scripts,add__Python-codedextensions__forlarger__systems,and__codeother__extensionsfor__advanced work.We__veonly__coveredthe__firsttwo__ofthese__categoriesin__this book,and__thats__plentyto__getyou__starteddoing__substantialprogramming__in Python.Beyond__this,there__are tools, resources,and__precedentsfor__usingPython__innearly__anycomputer__domainyou__can imagine.For__pointerson__whereto__go next,see__Chapter 1s__overviewof__Pythonapplications__and users.You__lllikely__findthat__witha__powerfulopen__sourcelanguage__like Python,common__tasksare__oftenmuch__easier,and__even enjoyable,than__youmight__expect.Development__Toolsfor__LargerProjects__Mostof__theexamples__inthis__bookhave__beenfairly__smalland__self-contained.They__werewritten__thatway__onpurpose__tohelp__youmaster__the basics.But__nowthat__youknow__allabout__thecore__language,it__stime__tostart__learninghow__touse__Pythons__built-inand__third-partyinterfaces__todo__real work.In__practice,Python__programscan__becomesubstantially__largerthan__theexamples__youve__experimentedwith__sofar__inthis__book.Even__in Python,thousands__oflines__ofcode__arenot__uncommonfor__nontrivialand__usefulprograms__onceyou__addup__allthe__individualmodules__inthe__system.Though__Pythons__basicprogram__structuring tools,such__asmodules__and classes,help__muchto__managethis__complexity,other__toolscan__sometimesoffer__additional support.For__developinglarger__systems,you__llfind__suchsupport__availablein__bothPython__andthe__public domain.You__veseen__someof__thesein__action,and__othershave__beennoted__in passing.This__categorymorphs__constantly,so__wecan__tget__toodetailed__here,but__tohelp__youwith__yournext__steps,here__isa__quicktour__andsummary__oftools__inthis__domain:Documentation__toolsPyDoc__shelp__functionand__HTMLinterfaces__wereintroduced__inChapter__15.PyDoc__providesa__documentationsystem__foryour__modulesand__objects,integrates__withPython__sdocstrings__syntax,and__isa__standardpart__ofthe__Python system.See__Chapters 15and__4for__moredocumentation__source hints. Error-checkingtools__BecausePython__issuch__adynamic__language,some__programmingerrors__arenot__reporteduntil__yourprogram__runs (evensyntax__errorsare__notcaught__untila__fileis__runor__imported).This__isnt__abig__drawbackas__withmost__languages,it__justmeans__thatyou__haveto__testyour__Pythoncode__beforeshipping__it.With__Python,you__essentiallytrade__acompile__phasefor__aninitial__testing phase. Furthermore,Python__sdynamic__nature,automatic__errorchecking__andreporting__messages,and__exceptionmodel__makeit__easierand__quickerto__findand__fixerrors__thanit__isin__someother__languages.Unlike__C,for__example,Python__doesnot__crashcompletely__on errors. Still,tools__canhelp__here too.As__representative examples,the__PyChecker, Pylint,and__Pyflakes third-partysystems__providesupport__forcatching__commonerrors__beforeyour__script runs.They__servesimilar__rolesto__thelint__programin__C development.Some__Pythondevelopers__runtheir__codethrough__suchtools__priorto__testingor__deliveryto__catchany__lurkingpotential__problems.In__fact,it__snot__abad__ideato__trythis__whenyou__refirst__startingout__someof__thesetools__warningsmay__helpyou__learnto__spotand__avoidcommon__Python mistakes.Testing__toolsIn__Chapter 25,we__learnedhow__toadd__self-testcode__toa__Pythonfile__byusing__the__name____== '__main__'trick__atthe__bottomof__thefile__asimple__unit-testing__protocol.For__moreadvanced__testing purposes,Python__comeswith__twotesting__tools.The__first,PyUnit__(calledunittest__inthe__standard-library manual),provides__an object-orientedclass__frameworkfor__specifyingand__customizingtest__casesand__expected results.It__mimicsthe__JUnitframework__forJava__andis__asophisticated__class-basedunit__testing system.The__doctest standard-librarymodule__providesa__secondand__simplerapproach__toregression__testingbased__uponPython__sdocstrings__feature. Roughly,to__use doctest,you__cutand__pastea__logof__aninteractive__testingsession__intothe__docstringsof__yoursource__files.doctest__thenextracts__your docstrings,parses__outthe__testcases__and results,and__rerunsthe__teststo__verifythe__expected results.See__thelibrary__manualfor__moreon__bothtesting__tools.IDEs__Wediscussed__IDEsfor__Pythonbriefly__inChapter__3.IDEs__suchas__PyCharmand__Pythons__ownIDLE__providea__graphicalenvironment__for editing, running, debugging,and__browsingyour__Python programs.Some__advancedIDEs__listedin__Chapter 3may__supportadditional__development tasks,including__sourcecontrol__integration,code__refactoring,project__management tools,and__more.Though__aimedat__rolesother__thangeneral__software development,Jupyter__notebooksmay__qualifyas__akind__ofIDE__too.See__Chapter 3,the__texteditors__pageat__python.org,and__yourfavorite__websearch__enginefor__moreon__availableIDEs__for Python.Profilers__Aswe__ve seen,because__Pythonis__bothdynamic__and fluid,intuitions__aboutperformance__gleanedfrom__experiencewith__otherlanguages__usuallydon__tapply__toPython__code.To__trulyisolate__performancebottlenecks__inyour__codeand__comparecoding__alternatives speed,you__needto__addtiming__logicwith__clocktools__inthe__timeor__timeitmodules__orrun__yourcode__underthe__profile module.We__sawexamples__ofthe__timingmodules__atwork__whencomparing__thespeed__ofiteration__toolsand__Pythonsin__Chapter 21.Profiling__isoften__yourfirst__optimizationstep__codefor__clarity,then__profileto__isolate bottlenecks,and__thentime__alternativecodings__ofthe__slowparts__ofyour__program.For__thesecond__ofthese__steps,profile__andits__optimizedcProfile__relativeare__standard-librarymodules__thatimplement__sourcecode__profilingfor__Python.After__runningcode__you provide,they__printa__reportthat__givesperformance__statisticstoo__detailedfor__usto__cover here.See__Pythons__librarymanual__formore__on profilers,as__wellas__thepstats__moduleused__toanalyze__results.Debuggers__Wediscussed__debuggingoptions__bothin__thispart__andin__Chapter 3 (seethe__latters__sidebarDebugging__PythonCode__).As__a review,most__developmentIDEs__forPython__support GUI-based debugging,and__thePython__standardlibrary__alsoincludes__asource__codedebugger__modulecalled__pdb.This__moduleprovides__a command-lineinterface__andworks__muchlike__commonC__languagedebuggers__(e.g., dbx, gdb),and__isdetailed__inPython__slibrary__manual.Because__IDEssuch__asIDLE__alsoinclude__point-and-clickdebugging__interfaces,pdb__ismore__usefulwhen__aGUI__isnt__availableor__whenmore__controlis__desired.See__Chapter 3for__tipson__usingIDLE__sdebugging__GUI interfaces.As__alsonoted__inChapter__3, though,neither__pdbnor__IDEsseem__tobe__usedmuch__in practice:most__programmerssimply__eitherread__Pythons__errormessages__orinsert__printstatements__toadd__beacondisplays__andrerun__notthe__most high-techof__solutions, perhaps,but__thepractical__tendsto__winthe__dayin__thePython__world.Shipping__optionsIn__StandaloneExecutables__,we__surveyedcommon__toolsfor__packagingPython__programs.A__varietyof__systemspackage__programbytecode__andthe__PythonVirtual__Machineinto__standalone executables,which__dont__requirethat__Pythonbe__installedon__thehost__machine.In__addition,we__velearned__thatPython__programsmay__beshipped__intheir__source (.py)or__bytecode (.pyc) forms,and__.zipfiles__mayact__likepackage__folders.When__yourcode__isready__togo__liveas__anopen__source tool,also__seethe__webfor__resourceson__Pythons__pipinstaller__system.Optimization__optionsWhen__speed counts,there__arenumerous__waysto__optimizeyour__Python programs,as__enumeratedin__Chapter 2.For__instance,the__PyPysystem__demoedin__Chapter 21provides__anautomatic__speedboost__today,and__otherslike__ShedSkin__andCython__offerdifferent__routesto__faster programs.Although__Pythons__-O command-lineflag__notedin__Chapter 34 (andto__bedeployed__inChapter__39)optimizes__bytecode,it__yieldsa__verymodest__performance boost,and__isnot__commonlyused__exceptto__removedebugging__codeand__asserts.Though__alast__resort,you__canalso__moveparts__ofyour__programto__acompiled__languagesuch__asC__toboost__performance;see__Pythons__manualsfor__moreon__C extensions.In__addition,Python__sspeed__tendsto__improveover__time,so__upgradingto__laterreleases__mayboost__speedtoo__onceyou__verifythat__theyare__fasterfor__your code,that__is (thoughlong__since fixed,Python__3.Xs__earlyreleases__wereradically__slowerthan__2.Xin__some roles).Installation__managementIf__youneed__toinstall__andsegregate__multiplesets__ofPython__extensionson__your machine,you__mayalso__wishto__usevirtual__environmentsnoted__brieflyin__Chapter 22and__implementedby__Pythons__standard-librarymodule__venv.This__moduleallows__youto__createmultiple__virtual environments,each__ofwhich__hasits__ownindependent__setof__Python packages,is__containedin__a directory,and__isactivated__anddeactivated__byconsole__commands.When__avirtual__environmentis__activated,tools__suchas__pipinstall__Pythonpackages__intothat__environment,and__searchpaths__aretailored__forthat__environments__installs.See__Pythons__librarymanual__formore__info.Other__hintsfor__largerprojects__Weve__alsostudied__avariety__of core-languagetopics__inthis__textthat__maygrow__moreuseful__onceyou__startcoding__larger projects.These__includemodule__packages (Chapter 24),exceptions__classes (Chapter 34),pseudoprivate__classattributes__(Chapter 31),documentation__strings (Chapter 15),module__datahiding__(Chapter 25),and__allthe__designand__usageguidelines__weve__exploredalong__theway__for objects, statements, functions, modules, classes,and__exceptions.If__youve__readthis__far,you__realready__well-equipped__tolevel__up.To__learnabout__theseand__manyother__larger-scalePython__development tools,browse__thePyPI__website, python.org,and__theweb__at large.Applying__Pythonmay__bea__largertopic__thanlearning__Python,but__itis__alsoone__well__haveto__delegateto__follow-upresources__here.Chapter__SummaryThis__chapterwrapped__upthe__exceptionspart__ofthis__bookwith__asurvey__ofdesign__concepts,a__lookat__commonexception__use cases,and__abrief__summaryof__commonlyused__development tools.This__chapteralso__wrappedup__thecore__materialof__this book.At__this point,you__vebeen__exposedto__thefull__subsetof__Pythonthat__mostprogrammers__useand__probablymuch__more.In__fact,by__virtueof__reachingthese__words,you__shouldfeel__freeto__consideryourself__anofficial__Python programmer.Be__sureto__pickup__a t-shirtor__laptopsticker__thenext__timeyou__reonline__(anddon__tforget__toadd__Pythonto__yourr__sumthe__nexttime__youdig__it out).The__nextand__finalpart__ofthis__bookis__acollection__ofchapters__dealingwith__topicsthat__areadvanced__butstill__inthe__core-language category.These__chaptersare__alloptional__reading,or__atleast__deferrable reading,because__notevery__Pythonprogrammer__mustdelve__intotheir__subjects,and__otherscan__postponethese__chapterstopics__untilthey__are needed. Indeed,many__ofyou__canstop__hereand__beginexploring__Pythons__rolesin__yourapplication__domains. Frankly,application__librariestend__tobe__moreimportant__inpractice__thanadvanced__and,to__some,esoteric__language features.On__theother__hand,if__youdo__needto__careabout__thingslike__Unicodeor__binarydata__(andyou__probably do!);have__todeal__with API-buildingtools__suchas__descriptors, decorators,and__metaclasses;or__justwant__todig__abit__furtherin__general,the__nextpart__ofthe__bookwill__helpyou__get started.The__largerexamples__inthe__finalpart__willalso__giveyou__achance__tosee__theconcepts__youve__alreadylearned__beingapplied__inmore__realistic ways.As__thisis__theend__ofthe__corematerial__ofthis__book, though,you__geta__breakon__thechapter__quizjust__onequestion__this time.As__always,be__sureto__workthrough__thispart__sclosing__exercisesto__cementwhat__youve__learnedin__thepast__few chapters;because__thenext__partis__optional reading,this__isthe__final end-of-part__exercises session.If__youwant__tosee__someexamples__ofhow__whatyou__velearned__comestogether__inreal__scriptsdrawn__fromcommon__applications,be__sureto__checkout__thesolution__tothis__parts__exercise 4in__Appendix B.And__ifthis__iswhere__youll__bedisembarking__fromthis__books__voyage,be__sureto__alsosee__Encore:Print__YourOwn__Completion Certificate!at__theend__ofChapter__41,the__verylast__chapterin__thisbook__(forthe__sakeof__readerscontinuing__onto__theAdvanced__Topics part,this__chapterwon__tspill__thebeans__here).Test__Your Knowledge:Quiz__1.What__sup__withthe__mouseon__thecover__ofthis__book?Test__Your Knowledge:Answers__1. OK,this__wasnever__mentionedand__ishardly__afair__question,but__forthe__record:the__mouse really,a__wood rat,Neotoma__muridaewas__chosenfor__thisbook__sfirst__editionby__itspublishing__companyin__the 1990s,based__onthe__factthat__thisanimal__iscommon__foodfor__a python.The__ideawas__thatthe__woodrat__mustlearn__aboutthe__pythonto__avoidbeing__eatenby__it. Clever,to__be sure,but__thisalso__camewith__asubtler__tie-inabout__Neotomabeing__packrats__attractedto__shinyobjects__thatcompulsively__collectwhatever__theycome__across,which__seemsan__aptmetaphor__forPython__shistory__of language-feature accumulation.So__enjoythe__shiny objects,but__dont__geteaten__bythe__constrictingreptiles__alongthe__way.Test__Your Knowledge:Part__VIIExercises__Aswe__vereached__theend__ofthis__partof__the book,it__stime__fora__fewexception__exercisesto__giveyou__achance__topractice__the basics.Exceptions__reallyare__simple tools;if__youre__ableto__workthrough__these exercises,you__veprobably__masteredthe__exceptions domain.See__Part VII,Exceptions__inAppendix__Bfor__the solutions. 1. try/except:Write__afunction__calledoops__thatexplicitly__raisesan__IndexErrorexception__when called. Then,write__anotherfunction__thatcalls__oopsinside__a try/exceptstatement__tocatch__the error.What__happensif__youchange__oopsto__raisea__KeyErrorinstead__ofan__IndexError?Where__dothe__namesKeyError__andIndexError__come from? (Hint:recall__thatall__unqualifiednames__generallycome__fromone__offour__scopes.) 2.Exception__objectsand__lists:Change__theoops__functionyou__justwrote__toraise__anexception__youdefine__yourself,called__MyError.Identify__yourexception__witha__classof__your own. Then,extend__thetry__statementin__thecatcher__functionto__catchthis__exceptionand__itsinstance__inaddition__to IndexError,and__printthe__instanceyou__catch. 3.Error__handling:Write__afunction__called safe(func, *pargs, **kargs)that__runsany__functionwith__anynumber__ofpositional__and/orkeyword__argumentsby__usingthe__*arbitrary__argumentsheader__andcall__syntax,catches__anyexception__raisedwhile__thefunction__runs,and__printsthe__exceptionusing__theexc_info__callin__thesys__module.Then__useyour__safefunction__torun__youroops__functionfrom__exercise 1or__2.Put__safein__amodule__filecalled__exctools.py,and__passit__theoops__function interactively.What__kindof__errormessages__doyou__get? Finally,expand__safeto__alsoprint__aPython__stacktrace__whenan__erroroccurs__bycalling__the built-inprint_exc__functionin__the standard-librarytraceback__module;see__earlierin__this chapter,and__consultthe__Pythonlibrary__referencemanual__forusage__details.We__couldprobably__codesafe__asa__functiondecorator__perthe__Chapter 19and__32 introductions,but__well__haveto__moveon__tothe__nextpart__ofthe__bookto__learnfully__how (seethe__solutionsfor__a preview). 4. Self-study examples:At__theend__ofAppendix__Bin__Part VII,Exceptions__,this__booklists__ahandful__ofexample__scriptsdeveloped__asgroup__exercisesin__livePython__classesfor__youto__studyon__yourown__inconjunction__withPython__sstandard__manual set.These__arenot__described,and__theyuse__toolsin__thePython__standardlibrary__thatyou__llhave__toresearch__yourself. Still,for__many readers,it__helpsto__seehow__theconcepts__weve__discussedin__thisbook__cometogether__inreal__programs.If__thesepique__yourinterest__for more,you__canfind__awealth__oflarger__andmore__realistic application-levelPython__programexamples__in follow-upbooks__andon__the web:pick__your domain,and__start exploring!Part__VIII.Advanced__TopicsChapter__37.Unicode__andByte__StringsIn__Chapter 7,the__Pythonstring__storywas__watereddown__onpurpose__tohelp__youget__startedwith__the fundamentals.Now__thatyou__velearned__the basics,this__chaptermoves__onto__extendthem__toinclude__thefull__Unicode-textand__binary-data__stringtales__in Python.This__extensionwas__moreoptional__inearlier__editionsof__thisbook__becauseUnicode__wasan__afterthoughtin__Python 2.X.Python__3.Xelevates__itto__requiredreading__becauseits__normalstrings__simplyare__Unicode. Still,how__muchyou__needto__careabout__thistopic__dependsin__largepart__uponwhich__ofthe__followingcategories__youfall__into:If__youdeal__with non-ASCIIUnicode__textfor__instance,in__thecontext__ofinternet__content,internationalized__applications,XML__parsers,and__someGUIs__youwill__finddirect__andseamless__supportfor__textencodings__inboth__Pythons__all-Unicodestr__object,as__wellas__its Unicode-awaretext__files.If__youdeal__withbinary__datafor__example,in__theform__ofimage__oraudio__files,network__transfers,or__packeddata__sharedwith__lower-leveltools__youwill__needto__understandPython__sbytes__objectand__itssharp__distinctionbetween__textand__binarydata__and files.If__youfall__intoneither__ofthe__priortwo__categories,you__maybe__ableto__deferthis__topicand__usestrings__asyou__didin__Chapter 7:with__thegeneral__str object,text__files,and__allthe__familiarstring__operations.Your__stringswill__beencoded__anddecoded__usingyour__platforms__defaultUnicode__encoding,but__youwon__tnotice__until,as__youll__see,you__encountercontent__orplatforms__thatuse__adifferent__default!To__be sure,if__textis__alwaysASCII__inyour__cornerof__thesoftware__world,you__mightbe__ableto__getby__withsimple__stringobjects__andtext__filesand__canavoid__muchof__thestory__that follows.As__youll__learnin__a moment,ASCII__isa__simplekind__ofUnicode__anda__subsetof__othercommon__encodings,so__stringoperations__andfiles__justwork__ifyour__programsprocess__ASCIItext__onlyand__willnever__deviatefrom__this limitation.Even__ifthis__chapters__topicsseems__remoteto__you today, though,a__basicunderstanding__ofPython__sstring__modelcan__bothdemystify__someof__theunderlying__detailsnow__andprepare__youfor__Unicodeor__binary-dataissues__thatmay__impactyou__inthe__future.Given__theprominence__ofthe__webin__mostsoftware__careers today,that__impactmay__bemore__amatter__ofwhen__than if.Unicode__FoundationsBefore__jumpinginto__code,let__sbegin__witha__generaloverview__ofthe__Unicodemodel__andPython__ssupport__for it.To__fullyunderstand__both,we__haveto__startwith__abrief__lookat__howcharacters__areactually__representedin__computers.Character__RepresentationsMost__programmersthink__ofstrings__asa__seriesof__characters (really,their__integer codes)used__torepresent__textual data.That__sstill__truein__thebrave__newworld__of Unicode,but__theway__charactersare__storedin__acomputer__smemory__andfiles__can vary,depending__onboth__whatsort__ofcharacters__arerecorded__andhow__programmerschoose__torecord__them.For__manyprogrammers__inthe__US,ASCII__formedtheir__originalnotion__oftext__strings.ASCII__isa__standardthat__definescharacter__codes 0 127 (whichalways__meansan__inclusiverange__inthis__chapter)and__thusallows__eachcharacter__tobe__storedin__one 8-bitbyte__(using 7 bits).For__example,the__ASCIIstandard__mapscharacter__ato__theinteger__value 97 (0x61in__hex),which__canbe__storedin__asingle__byteboth__incomputer__memoryand__on files.To__witnessthis__for yourself,Python__s built-inord__functionshows__theinteger__codeof__agiven__character;chr__revealsthe__characterof__agiven__integer code;and__hexgives__thecode__sbyte__valueas__twohex__digits,each__ofwhich__fitsa__4-bit nibble.The__firstof__these, ord,is__thevalue__ofa__characters__representationcode__andbyte__in ASCII: $ python3 #Or__py -3on__Windows >>> ord('a') #Character__=>code__97 >>> chr(97) #Code__=>character__'a' >>> hex(97) #Byte__value:fits__8bits__'0x61' >>> 0b0111_1111 #Limit__of ASCII's 7-bitrange__127ASCII__makestext__processing simple,because__charactersdirectly__correlateto__bytes. Sometimes, though,this__isnt__enough.Accented__charactersand__special symbols,for__example,do__notfit__intothe__rangeof__charactercodes__definedby__ASCII.To__allowfor__somesuch__extra characters,other__standardsallow__allpossible__valuesin__an 8-bit byte, 0 255,to__beused__as codes,and__assignvalues__128 255to__additional characters.One__suchstandard__isknown__as Latin-1and__iswidely__usedin__Western Europe.In__Latin-1,character__codesabove__127are__assignedto__accentedand__otherwisespecial__characters.For__instance,the__characterthat__Latin-1assigns__tocode__196 (a.k.a.byte__value 0xc4)is__aspecially__markedand__non-ASCII character, .In__Python: >>> chr(196) #Too__bigfor__ASCII ' ' >>> ord(' ') #Okay__for Latin-1 196 >>> hex(ord(' ')) #Byte__valuein__Latin-1 '0xc4' >>> bin(ord(' ')) # Latin-1uses__all 8bits__'0b11000100' Still,some__alphabetsdefine__somany__charactersthat__itis__impossibleto__representthem__asone__byte-sizedcode__per character.The__integercodes__ofthe__symbolsand__charactersin__the following,for__example,require__morespace__thana__byteas__dothose__ofall__theemojis__thatmay__notwork__insome__toolsbut__manageto__cropup__inyour__emailsand__texts anyhow: >>> ord(' ') 9758 >>> hex(ord(' ')) #Too__bigfor__onebyte__'0x261e' >>> [hex(ord(c))for__cin__' '] # Ditto:Unicode__required ['0x771f', '0x41b', '0x21e8'] >>> [hex(ord(c))for__cin__' '] # Emojis: >two__bytes (16 bits) ['0x1f642', '0x1f64a', '0x1f44d']Unicode__providesthe__generalitywe__needto__dealwith__textcontaining__non-ASCIIcharacters__andsymbols__like these.In__fact,it__definesand__assignsenough__charactercodes__torepresent__almostevery__naturallanguage__in use,plus__alarge__setof__symbolsand__emojis.In__Unicode speak,these__codesthat__standfor__characterstake__theform__ofnumbers__(integers),and__areusually__calledcode__points.The__codepoints__thatUnicode__assignsto__characters a, ,and__,for__instance,are__97, 196,and__128578 (0x61, 0xc4,and__0x1f642in__hex), respectively: >>> [f'{c}is__{ord(c)}and__{hex(ord(c))}'for__cin__'a '] ['ais__97and__0x61', 'is__196and__0xc4', 'is__128578and__0x1f642']Unicode__issometimes__referredto__as wide-characterstrings__becauseits__rangeof__charactersis__sobroad__thatmultiple__bytesmay__beneeded__torepresent__individualcharacter__codes.Such__textis__readilystored__incomputer__memorybecause__eachcharacter__codecan__simplyspan__asmany__bytesas__its code-pointnumber__requires (theexact__waythis__isdone__canvary__byprogramming__languageand__isnt__consequentialto__yourPython__code).Once__textleaves__your computer, though,its__storageis__more constrained:bytes__area__badthing__towaste__onyour__drivesand__networks,and__textused__acrossplatforms__mustfollow__thesame__formatting rules.To__allowfor__this,Unicode__alsodefines__standardways__tomap__charactercodes__toand__frombytes__forstorage__andtransmission__thatare__both platform-and__language-neutralthe__encodingswe__llexplore__inthe__next section.The__takeawayhere__isthat__Unicodes__combinationof__all-encompassingcharacter__codesand__theirpredefined__encodingsmake__ita__portableand__flexible model,and__thestandard__waythat__programsdeal__with non-Englishand__othertext__thatmay__havemore__charactersthan__8-bitbytes__can handle.As__anadded__bonus,earlier__schemeslike__ASCIIalso__fallunder__theUnicode__umbrella unchanged,but__wehave__tomove__onto__thenext__sectionto__see how.Character__EncodingsOne__ofthe__keysto__understandinghow__Unicodeworks__liesin__theway__itsinteger__charactercodes__(a.k.a.code__points)that__representcharacters__aremapped__totheir__encodedforms__forefficient__storageor__transfer.Code__pointsin__memoryare__justintegers__ofarbitrary__size,but__storageand__transfer,by__nature,impose__constraintson__time, space,and__interoperabilitythat__warrantextra__formatting steps.In__theUnicode__world,we__saythat__charactersare__translatedto__andfrom__rawbytes__usingan__encodingthe__rulesfor__translatinga__Unicode-textstring__intoa__sequenceof__bytesand__extractingthe__samestring__fromits__sequenceof__bytes.More__procedurally,this__translationback__andforth__betweenbytes__andstrings__isdefined__bytwo__terms (thefirst__ofwhich__doublesas__anoun__and verb, confusingly!):Encoding__isthe__processof__translatinga__stringof__charactersinto__its raw-bytes__form,per__anydesired__encodingthat__sbroad__enoughto__storethe__strings__characters.Decoding__isthe__processof__translatinga__stringof__rawbytes__intoits__character-string form,per__theencoding__originallyused__tocreate__thebytes__string.As__weve__seen,Unicode__definesboth__charactercodes__anda__setof__standard encodings.For__someof__theencodings__it defines,the__translationprocess__istrivial__ASCIIand__Latin-1,for__instance,map__eachcharacter__toa__single byte,so__littleor__nowork__isrequired__toencode__anddecode__ifcharacters__arethe__samebytes__inmemory__too.You__canview__thisfor__yourselfwith__theencode__methodavailable__onall__Pythontext__strings,which__simplyreturns__thebytes__usedto__encodethe__string.The__followingmeans__thatthe__ASCIIcharacter__aoccupies__justone__bytewhen__encodedper__theASCII__encoding: >>> len('a'.encode('ASCII')) #ASCII__'a'encodes__in 1byte__perASCII__1For__other encodings,the__mappingcan__bemore__complexand__yieldmultiple__bytesper__character.The__widelyused__UTF-8 encoding,for__example,allows__morecharacters__tobe__representedby__employinga__variable-number-of-bytesscheme__thats__bothgeneral__and economical.In__fact,because__UTF-8can__handleany__Unicodecode__point,it__sbecome__ade__factostandard__ofsorts__for text.In__UTF-8,character__codesless__than 128are__representedas__asingle__byte;codes__between 128and__0x7ff (2047)are__turnedinto__two bytes,where__eachbyte__hasa__valuebetween__128and__255;and__codesabove__0x7ffare__turnedinto__three-or__four-bytesequences__havingvalues__between 128and__255.This__keepssimple__ASCIIstrings__compact,sidesteps__byteordering__issues,and__avoidsnull__(zero)bytes__thatcan__causeproblems__forC__librariesand__networking.In__Python: >>> len('a'.encode('UTF-8')) # ASCII:encodes__in 1byte__1 >>> len(' '.encode('UTF-8')) # Non-ASCII:encodes__in 2bytes__2 >>> len(' '.encode('UTF-8')) # Emoji:encodes__in 4bytes__4Despite__such details,it__simportant__tonote__thatASCII__isa__subsetof__both Latin-1and__UTF-8.This__istrue__becausethese__encodingsencode__ASCIIcharacters__tobytes__thesame__wayas__ASCII. That,in__turn,makes__theseencodings__backwardcompatible__withexisting__ASCII data:every__characterstring__encodedper__ASCIIis__alsovalid__accordingto__the Latin-1and__UTF-8 encodings,and__everyASCII__fileis__avalid__Latin-1and__UTF-8 file. Technically,the__ASCIIencoding__isa__7-bitsubset__ofthe__other two:it__sbinary__compatiblewith__allcharacter__codesless__than 128. Latin-1and__UTF-8simply__allowfor__additional characters: Latin-1for__charactersmapped__tovalues__128 255within__a byte,and__UTF-8for__charactersthat__maybe__representedwith__multiple bytes.The__converseis__not true, however: UTF-8and__Latin-1text__isnot__compatiblewith__theASCII__encodingunless__itstext__s code-pointvalues__areall__lessthan__128; otherwise,encoding__ordecoding__perASCII__fails.In__Python again,the__mappingis__easyto__observe.Per__the following,an__ASCIIcharacter__encodesto__thesame__singlebyte__in ASCII, UTF-8,and__Latin-1 encodings,but__non-ASCIIcharacters__do not,and__requiremore__generalencodings__thanASCII__toencode__atall__(the b' 'here__isthe__Pythonbytes__object,which__willsoon__playa__leadingrole__inthis__chapter): >>> 'a'.encode('ASCII') #ASCII__encodesto__thesame__byte b'a' >>> 'a'.encode('UTF-8') b'a' >>> 'a'.encode('Latin-1') b'a' >>> ' '.encode('UTF-8') #But__non-ASCIIrequires__morebytes__b'\xc3\x84' >>> ' '.encode('UTF-8') #And__moreinclusive__encodings b'\xf0\x9f\x99\x82' >>> ' '.encode('ASCII') UnicodeEncodeError: 'ascii'codec__can'tencode__character '\U0001f642' >>> ' '.encode('Latin-1') UnicodeEncodeError: 'latin-1'codec__can'tencode__character '\U0001f642'Other__encodingssupport__richercharacter__setsin__other ways.For__instance, UTF- 16and__UTF-32use__afixed__andlarger__2and__4bytes__per character, respectively,the__formerwith__aspecial__surrogate-pairprotocol__forcodes__toolarge__for 2 bytes.Both__of these,along__with UTF-8,may__alsoallow__orrequire__aBOM__(ByteOrder__Marker)preamble__atthe__startof__encoded text,which__candesignate__byteorder__andencoding__type,may__bepresent__inencoded__textstored__infiles__or memory,and__isautomatically__handledfor__text-mode files.We__llskip__furtherdetails__herefor__space (watchfor__theBOM__todrop__atthe__endof__this chapter,along__withthe__thornytopic__ofUnicode__normalization),but__keepin__mindthat__allof__these ASCII, Latin-1, UTF-8,and__othersare__simplyalternative__Unicodeencodings__thatyield__thesame__Unicode code-pointtext__when decoded.The__neteffect__ensuresthat__textis__portableacross__allthe__toolsthat__useit__inexchange__forminor__translation costs:When__decoded,character__codepoints__mayor__maynot__occupymultiple__bytesin__memory,depending__on programming-language implementation.Some__recent Pythons,for__example,use__a variable-lengthscheme__tostore__decodedtext__with 1, 2,or__4bytes__per character,depending__onstring__content.Earlier__Pythonsinstead__storeeach__characterin__afixed__2or__4 bytes,depending__oncompilation__settings.When__encoded,the__formatof__charactercode__pointsis__whollydetermined__bythe__standardUnicode__encoding applied.This__formatis__thesame__regardlessof__whichprogramming__languagecreates__orprocesses__the text,making__itideal__forstorage__andtransfer__especiallyin__thediverse__realmof__the internet.This__formatis__oftenless__idealfor__programsto__use, though,which__iswhy__its__normallydecoded__when loaded.To__Python programmers,an__encodingis__specifiedas__astring__containingthe__encodings__name.Python__comeswith__roughly 100different__encodingsout__ofthe__box;see__thecodecs__modulein__thePython__LibraryReference__fora__list.Importing__moduleencodings__andasking__for help(encodings)shows__youmany__as well.Some__encodingsare__implementedin__Python,and__somein__C,and__manyhave__multiple names;for__example, latin-1, iso_8859_1,and__8859are__allsynonyms__forthe__same encoding, Latin-1.We__llrevisit__encodingslater__inthis__chapterwhen__westudy__Unicodecoding__techniques.For__anothertake__onthe__Unicode backstory,see__thePython__standardmanual__at python.org.It__includesa__UnicodeHOWTO__section,which__providesadditional__minutiaethat__wewill__skiphere__tofocus__onthe__fundamentals.Introducing__PythonString__ToolsAt__amore__concrete level,the__Pythonlanguage__providesmultiple__stringdata__typesto__representcontent__inyour__script:both__textualdata__integer code-pointvalues__ofdecoded__Unicodecharacters__inmemory__aswell__asbinary__dataraw__byte values,including__textthat__isin__encoded form.All__told,Python__comeswith__threestring__object types:str__forrepresenting__Unicodetext__(decodedcode__points)bytes__forrepresenting__binarydata__(includingencoded__text)bytearray__amutable__flavorof__thebytes__typeAll__threetypes__supportsimilar__operationsets__buthave__verydifferent__rolesand__cannotgenerally__bemixed__becauseof__this. Moreover,files__andother__contenttools__reflectthe__text/binary dichotomy, too,and__usespecific__stringtypes__indifferent__nodes.The__nextsections__introducethe__salientpoints__ofthis__model.The__strObject__First up,the__basicstr__type (e.g., 'text')is__fordecoded__Unicode text.It__sformally__definedas__animmutable__sequenceof__characterswhich__meanscode__pointsthat__arenot__necessarily bytes.Its__contentmay__containboth__simple text,such__as ASCII,whose__encodedand__decodedforms__mightyield__onebyte__per character,as__wellas__richerUnicode__text,whose__encodedand__decodedforms__mayboth__requiremultiple__bytesper__character.In__memory,a__stris__justan__orderedcollection__ofUnicode__code-point integers,which__printas__glyphsvisual__representationsthat__mayvary__fromhost__tohost__ofthe__charactersthat__thecode__points represent.When__transferredto__andfrom__files,a__stris__automaticallyencoded__toand__decodedfrom__asequence__ofbytes__usingeither__thehost__platforms__defaultor__aprovided__encodingname__totranslate__withan__explicit scheme.str__objects themselves, however,have__nonotion__ofan__encoding;they__arejust__charactercode__points.The__bytesObject__Whilestr__isgreat__forUnicode__text,many__programsneed__toprocess__rawbinary__contentthat__isnot__encodedper__anyUnicode__formatas__wellas__thebytes__usedto__storetext__whenit__is encoded.Image__filesand__packeddata__youmight__processwith__Pythons__structmodule__fallinto__this category.To__accommodate this,the__bytestype__supportsprocessing__oftruly__binary data.bytes__isjust__raw bytes,not__Unicode-text characters,though__itscontent__mayinclude__thebytes__of still-encoded__text,which__alwayshas__animplied__encoding.The__bytestype__isformally__definedas__animmutable__sequenceof__8-bit integers.Its__contentrepresents__byte values,and__itsupports__almostall__thesame__operationsthat__thestr__type does;this__includesstring__methods,sequence__operations,and__evenre__modulepattern__matching (formattingworks__onbytes__today, too,but__wasadded__laterin__3.Xs__evolution).A__bytesobject__reallyis__asequence__ofsmall__integers,each__ofwhich__isin__therange__0 255:indexing__abytes__returnsan__int,slicing__onereturns__another bytes,and__runninglist__onone__returnsa__listof__integers,not__characters. However,when__processedwith__operationsthat__assumecharacters__(e.g.,the__isalpha method),the__contentsof__bytesobjects__areassumed__tobe__ASCII-encoded__bytes. Further,bytes__itemswhose__valuesfall__inthe__rangeof__ASCIIcharacter__codesare__printedas__ASCII-characterglyphs__insteadof__integersor__theirhex__escapes;this__isdone__for convenience,though__itmay__alsoconfuse__thedistinction__betweentext__andbinary__data.The__bytearrayObject__Thoughless__commonly used,Python__alsocomes__with bytearray,a__variantof__bytesthat__ismutable__andso__supports in-place changes.The__bytearraytype__providesthe__usualstring__operationsthat__strand__bytesdo__butalso__hasmany__ofthe__same in-placechange__operationsas__lists (e.g.,append__andextend__methodsand__assignmentto__indexes).Assuming__yourstrings__canbe__treatedas__raw bytes,bytearray__addsdirect__in-placemutability__forstring__datasomething__longprohibited__bystr__and bytes.Text__andBinary__FilesBecause__file I/Ois__oneof__themain__benefactorsof__encodings,it__salso__acore__Unicode tool.As__weve__seen,text__isreally__justdecoded__integercharacter__codeswhen__itis__in memory;it__swhen__textis__transferredto__andfrom__externalinterfaces__likefiles__thatUnicode__encodingscome__into play.By__contrast,truly__binarydata__mayhave__nothingat__allto__dowith__encodingsor__textat__all.Because__of this,Python__makesa__sharp platform-independentdistinction__betweentext__andbinary__filesaccessed__withthe__built-inopen__function:When__afile__isopened__intext__mode,reading__itsdata__automaticallydecodes__itscontent__andreturns__itas__a str,and__writingtakes__astr__andautomatically__encodesit__beforetransferring__itto__the file.In__both cases,the__encodingto__useis__eithera__platformdefault__ora__providedencoding__argumentto__open.Text__modefiles__alsosupport__universalnewline__(a.k.a. end-of-line) translation, BOMs,and__otherencoding__arguments.When__afile__isopened__inbinary__modeby__addinga__bto__themode__stringargument__inthe__open call,reading__itsdata__doesnot__decodeit__inany__wayand__simplyreturns__itscontent__rawand__unchangedas__abytes__object.Writing__similarlytakes__abytes__objectand__transfersit__tothe__file unchanged,and__binary-modefiles__alsoaccept__abytearray__objectfor__thecontent__tobe__writtento__the file.Because__strand__bytesare__sharplydifferentiated__bythe__languagethis__way,you__mustdecide__whetheryour__datais__textor__binaryin__natureand__usestr__orbytes__objectsto__representits__contentin__your script, respectively. Ultimately,the__modein__whichyou__opena__filewill__dictatewhich__typeof__objectyour__scriptwill__useto__representits__content:If__youare__processingimage__oraudio__files,packed__datacreated__byother__programswhose__contentyou__must extract,and__somedevice__data streams,chances__aregood__thatyou__willwant__todeal__withit__usingbytes__and binary-mode files.You__mightalso__optfor__bytearrayto__updatethe__datawithout__makingcopies__ofit__in memory.If__insteadyou__areprocessing__somethingthat__istextual__in nature,such__asprogram__output,HTML__orJSON__content,and__CVSor__XML files,you__probablywant__touse__strand__text-mode files. Subtly,the__mode-stringargument__toopen__(itsmode__keywordand__secondpositional__argument)becomes__fairlycrucial__itscontent__notonly__specifiesa__fileprocessing__modebut__alsoimplies__aPython__object type.By__addinga__b (lowercase only)to__themode__string,you__specifya__binarymode__fileand__will receive,or__usually provide,a__bytesobject__torepresent__thefile__scontent__whenreading__or writing.Without__the b,your__fileis__processedin__text mode,and__youll__usestr__objectsto__representits__content.For__example,modes__rb, wb,and__rb+imply__bytes,but__r, w+,and__rt (the default:read__text)imply__str.If__youre__anxiousto__seefiles__in action,watch__forthe__examples ahead,especially__thoseof__Unicodetext__files.To__understandfile__usagein__full, though,we__firstneed__toexplore__stringoperations__asthey__extendto__Unicodeand__bytes.Using__TextStrings__Lets__stepthrough__afew__examplesthat__demothe__priorsection__sstring__types live. Here,our__primaryfocus__ison__usingthese__typesfor__text (well__explorebinary__roles later).Along__the way,you__llsee__how literals, conversions,and__non-ASCIItext__arecoded__in Python.Literals__andBasic__PropertiesMost__Pythonstring__objectsare__bornwhen__youcall__a built-infunction__suchas__stror__bytes,process__afile__createdby__calling open,or__codeliteral__syntaxin__your script.For__the latter,the__usual ' 'makes__a str;a__uniqueliteral__form b' 'is__usedto__createa__bytes;and__bytearrayobjects__maybe__madeby__callingthe__same-namedfunction__witha__varietyof__possible arguments.More__formally,all__theusual__stringliteral__formswe__metin__Chapter 7 ' ', " ",and__triple-quotedblocks__generatea__str;adding__ab__orB__justbefore__themcreates__abytes__instead.This__b' ' (and equivalently, B' ')bytes__literalis__similarin__spiritto__the r' 'raw__stringwe__vealso__met,which__suppressesbackslash__escapes;in__fact,the__twoprefixes__canbe__combinedto__usebacklashes__verbatimin__a bytes.Consider__the following: >>>B__= b'code' #Make__abytes__object: 8-bitbytes__>>>S__= 'hack' #Make__astr__object:Unicode__characters >>> type(B), type(S) (, ) >>>B__#Sequence__of ints,prints__asASCII__characters b'code' >>>S__#Sequence__ofcode__points,prints__astext__glyphs 'hack' >>> B2 = B""" #bytes__prefixworks__on single, double,triple__xxxxyyyy__""" >>> B2 b'\nxxxx\nyyyy\n' >>> b'A\nB\rC', br'A\nB\rC', rb'A\nB\rC' # Raw-stringcombos__worktoo__(b'A\nB\rC', b'A\\nB\\rC', b'A\\nB\\rC')Once__youhave__a string,all__theusual__operationswe__metearlier__work,but__theirresults__aretype__specific (bytesis__integersand__stris__characters),and__immutabilitystill__applies: >>> B,S__(b'code', 'hack') >>> B[0], S[0] #Indexing__returnsan__intfor__bytes,str__forstr__(99, 'h') >>> B[1:], S[1:] #Slicing__makesanother__bytesor__str (b'ode', 'ack') >>> list(B), list(S) ([99, 111, 100, 101], ['h', 'a', 'c', 'k']) #bytes__isreally__ints >>> B[0] = 'x' #Both__areimmutable__TypeError: 'bytes'object__doesnot__supportitem__assignment >>> S[0] = 'x' TypeError: 'str'object__doesnot__supportitem__assignmentBecause__theyapply__tomore__thantext__andhave__someunique__behaviors,we__lldefer__bytearrayand__moreabout__bytesto__adedicated__sectionlater__inthis__chapter.NOTE__Blastfrom__the past:Python__3.Xalso__recognizesPython__2.Xs__Unicodestring__literalsto__easemigration__of 2.X code:a__2.X u' 'literal__inPython__3.Xis__justa__synonymfor__a 3.X ' 'str__literal.This__makes sense,given__that 3.Xs__stris__all Unicode,and__allowssome__3.Xcode__torun__on 2.Xand__vice versa.In__todays__3.X world, though,there__sno__compellingreason__touse__the u' 'literal__anymore (unlessyou__rea__fanof__superfluous prefixes),but__itmay__cropup__inPython__codeyou__llencounter__inthe__wild. 2.Xhad__avery__longshelf__life,after__all.String__TypeConversions__Syntax aside,the__firstthing__youmight__noticeabout__Pythonstrings__iswhat__theycannot__dostr__andbytes__nevermix__automaticallyin__expressionsand__generallyare__notconverted__toone__anotherautomatically__whenpassed__to functions.A__functionthat__expectsan__argumentto__bea__strmay__notaccept__abytes__(andvice__versa),and__operatorsare__fully rigid: >>> 'hack' + b'code' TypeError:can__onlyconcatenate__str (not "bytes")to__strThis__iseasier__tounderstand__ifyou__rememberthat__atext__stringmay__beradically__differentin__itsencoded__anddecoded__forms,and__Pythonhas__noidea__whatthe__contentof__abytes__is:if__thebytes__isencoded__text,its__encodingis__unknown,but__itmay__alsobe__binarydata__(e.g.,a__loadedaudio__file)that__hasnothing__todo__withtext__at all.Because__ofthis__ambiguity,Python__basicallyrequires__thatyou__eithercommit__toone__typeor__theother__orperform__manual,explicit__conversionswith__thefollowing__tools (where ?means__optional): S.encode(encoding?)and__bytes(S, encoding)Encode__astr__objectS__toa__newbytes__perencoding__B.decode(encoding?)and__str(B, encoding)Decode__abytes__objectB__toa__newstr__perencoding__Boththe__preceding S.encode()and__B.decode()methods__andthe__fileopen__callwe__llexplore__aheaduse__eitheran__explicitly passed-inencoding__nameor__a default.The__methodsdefault__isalways__UTF-8 (by contrast,open__usesa__valuein__thelocale__moduleyou__llmeet__shortlythat__mayvary__per platform, settings,and__runand__shouldusually__be avoided): >>>S__= 'hack' >>> S.encode() #str__to bytes:encode__textinto__rawbytes__b'hack' >>> bytes(S, encoding='ascii') #str__to bytes,alternative__b'hack' >>>B__= b'code' >>> B.decode() #bytes__to str:decode__rawbytes__intotext__'code' >>> str(B, encoding='ascii') #bytes__to str,alternative__'code'Putting__thistogether__solvesour__originaltype__errorand__allowsus__tomix__stringsand__bytesas__eitherencoded__ordecoded__text: >>> S,B__('hack', b'code') >>> S.encode('ascii') +B__#bytes__+bytes__(encoded) b'hackcode' >>>S__+ B.decode('ascii') #str__+str__(code points) 'hackcode'A__fewcautions__ondefaults__here.First__of all,the__encodingargument__tobytes__isnot__optional,even__thoughit__isin__S.encode() (and B.decode()).More__subtly,although__strdoes__notrequire__theencoding__argumentlike__bytes does,leaving__itoff__instr__callsdoes__notmean__itdefaults__instead,due__toPython__history,a__strwithout__anencoding__returnsthe__bytesobject__sprint__string,not__itsdecoded__andconverted__strform__(thisis__usuallynot__whatyou__ll want!).Assuming__againthat__Band__Sare__stillas__inthe__prior listing: >>> bytes(S) TypeError:string__argumentwithout__anencoding__>>> str(B) # str()works__withoutencoding__"b'code'" #But__print string,not__conversion! >>> len(str(B)) 7 >>> len(str(B, encoding='ascii')) #Pass__encodingto__convertto__str 4Also__inthe__defaults department,your__platforms__variousdefault__encodingsare__availablein__thesys__andlocale__modulesbut__arent__astrustworthy__asyou__might think: $py__-3 >>>import__sys,locale__>>> sys.platform #Underlying__platform:Windows__'win32' >>> sys.getdefaultencoding() #Methods__default (butnot__for str()!) 'utf-8' >>> locale.getpreferredencoding(False) # open() default:a__Latin-1superset__'cp1252'As__shown,the__openfunction__sdefault__fileencoding__livesin__thelocale__module.On__thePC__usedfor__Windowsexamples__inthis__chapter,it__s cp1252a__supersetof__Latin-1that__addscharacters__likeslanted__quotes.Defaults__may differ, however,on__otherplatforms__andtechnically__caneven__dependon__environment-variable settings, command-line arguments,and__settingson__individualhost__machines.For__example,here__sthe__differingcase__onthis__chapters__macOShost__likemost__Unix platforms,its__opendefaults__to UTF-8: $ python3 >>>import__sys,locale__>>> sys.platform #Underlying__platform:macOS__'darwin' >>> sys.getdefaultencoding() #The__defaultfor__methodsis__same 'utf-8' >>> locale.getpreferredencoding(False) #But__thisdiffers__on Unix:be__explicit! 'utf-8'Besides__such program-host differences,keep__inmind__thattext__contentyou__receivefrom__disparatesources__mightalso__useany__Unicodeencoding__at all,making__yourhost__sdefault__amoot__point. Hence,your__programsshouldn__tgenerally__relyon__opendefaults__ifthey__mayneed__tocare__aboutportability__nowor__inthe__futurealways__passan__explicitencoding__toopen__wheninteroperability__counts.We__llrevisit__encodingdefaults__andlearn__howto__providean__explicitencoding__toopen__whenwe__exploreUnicode__fileslater__inthis__chapter.Having__saidall__that,it__simportant__toalso__notethat__encodingand__decodingare__substantiallymore__thansimple__programming-languagetype__conversions; really,they__producevery__differentkinds__of data.Encoding__returnsthe__bytesthat__resultfrom__transforminga__textstring__pera__Unicode scheme,and__decodingreturns__thetext__stringthat__isproduced__byundoing__that transformation.While__thisis__aconversion__of sorts,and__themapping__mayseem__trivialfor__simpletext__like ASCII,Unicode__tendsto__makemuch__moresense__ifyou__avoidblurring__thedistinction__especiallyfor__richertypes__oftext__likethat__inthe__next section.Coding__UnicodeStrings__inPython__Encodingand__decodinggrow__moremeaningful__whenyou__startdealing__with non-ASCII__Unicode text.To__codeUnicode__charactersthat__maybe__difficultto__typeon__your keyboard,Python__stringliterals__support both: \xNNhex__escapes,where__twohex__digits (NN)specify__acharacter__codeas__a 1-byte (8-bit)numeric__value \uNNNNand__\UNNNNNNNNUnicode__escapes,where__thefirst__lowercaseform__gives 4hex__digitsto__denotea__2-byte (16-bit)character__code,and__thesecond__uppercaseform__gives 8hex__digitsfor__a 4-byte (32-bit)code__Importantly,in__str objects,all__threeof__theseescapes__areused__togive__aUnicode__characters__code-pointvalue__notits__encoded bytes.By__contrast,bytes__objectsallow__onlyhex__escapesfor__byte values;for__text,this__givesits__encodedform__notits__decodedcode__points.Let__ssee__howthis__alltranslates__to code.Simple__7-bitASCII__textis__formattedwith__onecharacter__perbyte__undermost__ofthe__encodingschemes__describednear__thestart__ofthis__chapter (again,this__iswhy__ASCIIpasses__asa__binary-compatiblesubset__ofmany__other schemes): >>> ord('X') #Character__'X'has__code-pointvalue__88 88 >>> chr(88) # Code-point 88stands__forcharacter__'X' 'X' >>>S__= 'XYZ' # str:code__pointsdisplay__astheir__characterglyphs__>>>S__'XYZ' >>> len(S) # 3characters__(notnecessarily__bytes)long__3 >>> S.encode('ascii') #Values__0 127in__1byte__each (ASCIIshown__as chars) b'XYZ' >>> S.encode('latin-1') #Values__0 255in__1byte__each b'XYZ' >>> S.encode('utf-8') #Values__0 127in__1 byte, 128 2047in__2,others__3~4 b'XYZ'By__contrast,the__lesscommon__UTF-16and__UTF-32use__2and__4bytes__forevery__character, respectively,even__forsimple__textlike__ASCII.This__makesthese__encodingsdata__fastto__processbut__mayconsume__extraspace__and bandwidth,which__rendersthem__subparin__some applications.In__the following,ASCII__bytesprint__as characters, non-ASCIIsprint__as \xNN escapes,padding__bytesfollow__text,and__eachresult__hasa__2-or__4-byteBOM__headerat__thefront__whosedetails__were__largelyignoring__here (again,stay__tunedfor__moreon__BOMsnear__theend__ofthis__chapter): >>>S__'XYZ' >>> S.encode('utf-16') #Always__2or__4bytes__per character,with__BOMheader__b'\xff\xfeX\x00Y\x00Z\x00' >>> S.encode('utf-32') b'\xff\xfe\x00\x00X\x00\x00\x00Y\x00\x00\x00Z\x00\x00\x00'To__code non-ASCII characters,you__canuse__hexand__Unicodeescapes__inyour__strings.The__numericvalues__codedas__hexadecimalliterals__0xC4and__0xE8,for__instance,are__theUnicode__codepoints__usedto__representtwo__specialcharacters__outsidethe__7-bitrange__of ASCII;we__canembed__themin__strobjects__anyhowbecause__strsupports__Unicodein__full: >>> chr(0xc4) # 0xC4and__0xE8are__accentedcharacters__outsideASCII__' ' >>> chr(0xe8) ' ' >>>S__= '\xc4\xe8' #Hex__escapes: code-point values,not__encodedbytes__>>>S__' ' >>>S__= '\u00c4\u00e8' #Unicode__escapes: 16-bits (2-bytes) >>>S__' ' >>> len(S) # 2characters__long (notnumber__of bytes!) 2 Now,if__wetry__toencode__a non-ASCIIstring__likethis__toraw__bytesas__ASCII,we__llget__an error.Encoding__as Latin-1 works, though,and__allocates 1byte__per character;encoding__as UTF-8allocates__2bytes__percharacter__instead.If__youwrite__thisstring__toa__text-mode file,the__rawbytes__shownare__whatis__actuallystored__onthe__filefor__theencoding__types given: >>>S__= '\u00c4\u00e8' >>> S.encode('ascii') UnicodeEncodeError: 'ascii'codec__can'tencode__charactersin__position 0-1:ordinal__notin__range(128) >>> S.encode('latin-1') # 1byte__percharacter__b'\xc4\xe8' >>> S.encode('utf-8') # 2bytes__percharacter__b'\xc3\x84\xc3\xa8' >>> len(S.encode('latin-1')) # 2bytes__in latin-1, 4in__utf-8 2 >>> len(S.encode('utf-8')) 4You__canalso__gothe__otherway__fromraw__bytesback__toa__Unicode string.You__couldread__rawbytes__froma__fileand__decodemanually__this way,but__theencoding__modeyou__giveto__theopen__callcauses__thisdecoding__tobe__donefor__youautomatically__(andavoids__issuesthat__mayarise__fromreading__partialcharacter__sequenceswhen__readingby__blocksof__bytes): >>>B__= b'\xc4\xe8' >>>B__b'\xc4\xe8' >>> len(B) # 2raw__bytes, 2characters__2 >>> B.decode('latin-1') #Decode__to latin-1text__' ' >>>B__= b'\xc3\x84\xc3\xa8' >>> len(B) # 4raw__bytes 4 >>> B.decode('utf-8') ' ' >>> len(B.decode('utf-8')) # 2Unicode__characters 2When__needed,you__canalso__specifyboth__16-and__32-bitUnicode__code-pointvalues__forcharacters__inyour__str strings:use__\uwith__4hex__digitsfor__theformer__and \Uwith__8hex__digitsfor__the latter.As__thelast__examplein__thefollowing__shows,you__canalso__buildsuch__stringsup__piecemealusing__chr,but__itmight__becometedious__forlarge__strings: >>>S__= 'A\u00c4B\U000000e8C' >>>S__# A, B, C,and__2 non-ASCIIcharacters__'ABC' >>> len(S) # 5characters__long 5 >>> S.encode('latin-1') b'A\xc4B\xe8C' >>> len(S.encode('latin-1')) # 5bytes__in latin-1 5 >>> S.encode('utf-8') b'A\xc3\x84B\xc3\xa8C' >>> len(S.encode('utf-8')) # 7bytes__in utf-8 7 >>> S.encode('cp500') #Two__otherWestern__Europeanencodings__b'\xc1c\xc2T\xc3' >>> S.encode('cp850') # 5bytes__each b'A\x8eB\x8aC' >>>S__= 'code' #ASCII__textis__thesame__inmost__>>> S.encode('latin-1') b'code' >>> S.encode('utf-8') b'code' >>> S.encode('cp500') #But__notin__cp500:IBM__ebcdic b'\x83\x96\x84\x85' >>> S.encode('cp850') b'code' >>>S__= 'A' + chr(0xC4) + 'B' + chr(0xE8) + 'C' #str__thehard__way >>>S__'ABC'Another__distinctionto__keepin__mind:Python__allowsspecial__characterscode__pointsto__becoded__withboth__hexand__Unicodeescapes__instr__stringliterals__butallows__onlyhex__escapesin__bytesliterals__andprints__awarning__inits__recentversions__ifyou__violatethis__rule.In__fact,Unicode__escapesequences__aretaken__verbatimin__bytesand__notas__escapes.This__makessense__ifyou__rememberthat__bytesobjects__holdbinary__data,both__textualand__not.When__theycontain__text,they__holdcharacters__encodedbytes__nottheir__decodedcode__points. Thus,Unicode__code-pointescapes__simplydon__tapply__to bytes,and__hexescapes__intheir__literalsyield__rawbyte__values,not__characters.This__istrue__eventhough__code-pointand__encoded-bytevalues__happento__bethe__samefor__somecharacters__insome__encodings (confusingly!).Because__bytesare__notcode__points,they__alsomust__bedecoded__tostr__toprint__their non-ASCIIcharacters__properly: >>>S__= 'A\xC4B\xE8C' #str__recognizeshex__andUnicode__escapes >>>S__'ABC' >>>S__= 'A\u00C4B\U000000E8C' # 4-and__8-digitUnicode__escapes (str only) >>>S__'ABC' >>>B__= b'A\xC4B\xE8C' #bytes__recognizeshex__escapes,but__notUnicode__>>>B__b'A\xc4B\xe8C' >>>B__= b'A\u00C4B\U000000E8C' #Unicode__escapesequences__taken literally! :1: SyntaxWarning:invalid__escapesequence__'\u' >>>B__#bytes__isencoded__bytes,not__codepoints__b'A\\u00C4B\\U000000E8C' >>>B__= b'A\xC4B\xE8C' #Use__hexescapes__for latin-1bytes__>>>B__#Prints__non-ASCIIbytes__ashex__b'A\xc4B\xe8C' >>> print(B) #For__bothinteractive__and print() b'A\xc4B\xe8C' >>> B.decode('latin-1') #Decode__tostr__tointerpret__astext__'ABC' Finally,notice__thatbytes__literalsassume__thattextual__charactersembedded__withinthem__areASCII__andrequire__escapesfor__bytevalues__> 127.By__contrast,str__literalsin__codelike__thatin__thefollowing__allowembedding__anycharacter__supportedby__thesource__codeencoding__ofthe__hostingfile__orGUI__(asyou__lllearn__ina__moment,the__encodingused__forcode__defaultsto__UTF-8,sans__declarationsin__thecode__s file): >>>S__= 'ABC' #Chars__from UTF-8if__noencoding__declaration >>>S__#Decoded__tostr__whencode__isread__byPy__'ABC' >>>B__= b'ABC' SyntaxError:bytes__canonly__containASCII__literal characters. >>>B__= b'A\xC4B\xE8C' #Chars__mustbe__ASCII,or__hexescapes__>>>B__# Non-ASCIIsare__latin-1encoded__bytes b'A\xc4B\xe8C' >>> B.decode('latin-1') 'ABC' >>> S.encode() #Source__codeencoded__per UTF-8by__default b'A\xc3\x84B\xc3\xa8C' #Methods__use UTF-8to__encode,unless__passed >>> S.encode('utf-8') b'A\xc3\x84B\xc3\xa8C' >>> B.decode() #Raw__bytesdo__notcorrespond__to utf-8 UnicodeDecodeError: 'utf-8'codec__can'tdecode__byte 0xc4in__position 1: >>>S__= 'ABC' >>> S.encode() # Method'sdefault__utf-8encoding__b'A\xc3\x84B\xc3\xa8C' >>> >>>T__= S.encode('cp500') # "Convert"to__EBCDICbytes__>>>T__b'\xc1c\xc2T\xc3' >>> >>>U__= T.decode('cp500') #Back__toUnicode__codepoints__>>>U__'ABC' >>> >>> U.encode() #Back__to UTF-8 bytes,by__default b'A\xc3\x84B\xc3\xa8C'Notice__howthe__lastpart__ofthe__precedingcode__seemsto__convertencodings__from UTF-8to__cp500and__back again. Really,this__justcreates__differentencoded__representationsof__thesame__Unicodecode__points,but__thispattern__canbe__usedto__translateencoded__textwhen__needed.Text__ina__file,for__instance,can__be re-encoded__witha__decode (to str)plus__anencode__(to bytes)combination__thatchanges__itsstored__encoding;as__youll__see ahead,the__openfunction__doesmost__ofthis__workfor__you. Also,note__howthe__precedingcode__isable__touse__astr__literal 'ABC'with__rawUnicode__charactersfor__its non-ASCII characters.This__isnoticeably__simplerthan__codingescapes__andworks__aslong__asyour__codefile__(and GUI)support__it,as__thenext__sectionwill__explain. Source-FileEncoding__DeclarationsUnicode__escapessuffice__forthe__occasionalUnicode__characterin__string literals,but__theycan__becometedious__ifyou__needto__code non-ASCIItext__inyour__strings frequently.For__stringliterals__andother__textthat__youembed__inyour__scriptfiles__(orpaste__intoyour__coding GUI),Python__usesthe__UTF-8encoding__bydefault__toread__yourcode__stext__butallows__youto__changethis__perfile__touse__anarbitrary__encoding.With__this support,your__codecan__directlyembed__anyunescaped__charactersthat__thechosen__encoding supports.To__makethis__work,simply__usePython__sdefault__UTF-8encoding__tosave__yoursource__codefile__inyour__text editor,or__includea__commentthat__namesthe__Unicodeencoding__thatyou__usedfor__thesave__ifit__differs.This__special encoding-declaration__commentmust__appearas__eitherthe__firstor__secondline__inyour__script (e.g.,a__#!line__worksbefore__it:see__Appendix A)and__isusually__ofthe__followingform__(seePython__smanuals__forother__formsit__accepts): # -*- coding: latin-1 -*-When__present,Python__willrecognize__textin__yourcode__representednatively__(unescaped)in__thegiven__encoding.That__way,you__canedit__yourscript__filein__atext__editorthat__accepts, displays,and__savesaccented__andother__non-ASCII characters,and__Pythonwill__correctlydecode__themwhen__readingyour__stringliterals__andother__program-file text.For__example,notice__thecoding__commentat__thetop__ofExample__37-1:when__thisfile__issaved__inthe__nondefault Latin-1 encoding,it__allowsPython__torecognize__Latin-1characters__embeddedin__thestring__literalto__beassigned__to myStr1in__thetext__ofthe__source file.This__filealso__neatlysummarizes__thevarious__waysto__code non-ASCIItext__in Python.Example__37-1. source-encoding-latin1.py # -*- coding: Latin-1 -*- #---------------------------------------------------------------------------- #Demo__allthe__waysto__code non-ASCIItext__in Python,plus__source encodings. # #If__thisfile__issaved__as Latin-1 text,it__worksas__is.But__changingthe__#coding__lineabove__toeither__ASCIIor__UTF-8will__thenfail__becausethe__# Latin-1 0xc4and__0xe8saved__in myStr1'svalue__arenot__validin__either. # #A__UTF-8line__worksif__thisfile__isalso__savedas__UTF-8to__makeits__mystr1 #text__match.Because__UTF-8is__thedefault__for source,the__lineabove__is #optional__ifthe__fileis__savedas__UTF-8or__itstext__isall__UTF-8compatible__# (e.g., ASCII,which__isa__subsetof__boththe__Latin-1and__UTF-8 encodings). #---------------------------------------------------------------------------- myStr1 = 'ABC' # Raw,per__sourceencoding__myStr2 = 'A\xc4B\xe8C' #Hex__code-pointescapes__myStr3 = 'A\u00c4B\U000000e8C' #Unicode__short/longescapes__myStr4 = 'A' + chr(0xC4) + 'B' + chr(0xE8) + 'C' #Concatenated__codepoints__import sys,locale__print('Syshosting__platform: ', sys.platform) print('Sysdefault__encoding: ', sys.getdefaultencoding()) print('Opendefault__encoding:', locale.getpreferredencoding(False))for__aStrin__(myStr1, myStr2, myStr3, myStr4): print(f'{aStr}, strlen={len(aStr)}', end=', ') #Decoded__text+length bytes1 = aStr.encode() #Default__UTF-8: 2bytes__foraccents__bytes2 = aStr.encode('latin-1') #Explicit__Latin-1: 1byte__perchar__#bytes3 = aStr.encode('ascii') #ASCII__fails:outside__0...127range__print(f'byteslen1={len(bytes1)}, byteslen2={len(bytes2)}') #Encoded__lengthAfter__savingthis__filein__atext__editorwith__encoding Latin-1 (orits__default cp1252superset__onsome__Windows),running__itas__ascript__printsits__four strings,their__character code-point lengths,and__theirbyte__lengthsin__twoencodings__thatwork__theencode__methods__default UTF-8,and__anexplicit__Latin-1 (ASCIIis__toonarrow__to use).The__Pythondefault__encodingsit__alsoprints__mayvary__acrosshost__platforms,but__therest__ofthe__outputwill__not: $ python3 source-encoding-latin1.pySys__hosting platform:darwin__Sysdefault__encoding: utf-8Open__default encoding: UTF-8 ABC, strlen=5, byteslen1=7, byteslen2=5 ABC, strlen=5, byteslen1=7, byteslen2=5 ABC, strlen=5, byteslen1=7, byteslen2=5 ABC, strlen=5, byteslen1=7, byteslen2=5To__changethis__fileto__use UTF-8 instead,first__saveit__withthe__UTF-8encoding__inyour__texteditor__orby__runningPython__codelike__thefollowing__tomake__itsembedded__literalmatch__(youll__learnhow__andwhy__thiscode__workswhen__weexplore__Unicodetext__files ahead): >>>text__= open('source-encoding-latin1.py', encoding='latin1').read() >>> open('source-encoding-utf8.py', 'w', encoding='utf8').write(text) Then,either__modits__firstline__toname__UTF-8,or__deletethe__firstline__altogether (UTF-8is__Pythons__defaultfor__source code).After__youre__done,the__onlydifference__inthe__twoversions__ofthe__sourcefile__willbe__theway__theembedded__Unicodeliteral__isrendered__onyour__platform;here__sthe__verdicton__the UTF-8-centric__macOSusing__itsdiff__tocompare__(usefc__insteadon__Windows): $diff__source-encoding-latin1.py source-encoding-utf8.py 1c1 < # -*- coding: Latin-1 -*- --- > # -*- coding: UTF-8 -*- 13c13 < myStr1 = 'A?B?C' --- > myStr1 = 'ABC' $ python3 source-encoding-utf8.py #Same__outputas__Latin-1version__aboveSince__mostprogrammers__arelikely__tofall__backon__thedefault__andgeneral__(really, universal) UTF-8encoding__in Python,we__lldefer__toPython__sstandard__manualset__formore__detailson__this option,as__wellas__itsmore__advancedand__obscureUnicode__supportsuch__asproperties__and character-nameescapes__instrings__thatwe__llskip__here.NOTE__Unicodein__variable names: Source-fileencoding__declarationsapply__toa__files__contentin__generaland__supportarbitrary__kindsof__text.The__rulesfor__variablenames__withina__files__code, however,are__more stringent.As__notedbriefly__inChapter__11,Python__allows some,but__not all, non-ASCIIUnicode__charactersto__beused__forvariables__inyour__code. Roughly, number-and__letter-likecharacters__work,but__symbolsand__emojisare__not allowed.For__instance,h__ckis__avalid__variable,but__hck__is not.You__cancheck__whethera__specificstring__passesas__avariable__withthe__isidentifiermethod__of str,but__therules__behindthis__arecomplex__andbest__hadin__Pythons__language manual. Also,keep__inmind__that,even__when valid, non-ASCIIsin__variablesmay__makeyour__codedifficult__touse__onsome__keyboardsand__devicesoutside__agiven__languages__locale.In__fact,all__codein__thePython__standardlibrary__mustuse__ASCII-onlyidentifiers__forthis__reason.As__usual,use__with care.Using__ByteStrings__Well__beable__tosee__stringsin__actionagain__whenwe__studyfiles__ahead. First, though,let__stake__abrief__sidetrip__todig__abit__deeperinto__theoperation__setsprovided__byobjects__gearedfor__binarydata__thebytes__typeand__itsbytearray__mutable kin.While__thesetypes__canbe__usedto__holdencoded__texttoo__(asin__prior sections),their__scopeis__much broader:anything__thatcan__bestored__asbytes__works,and__thats__everything digital.As__mentioned earlier,Python__sbytes__typesupports__sequenceoperations__andmost__ofthe__samemethods__availableon__str.Even__so,because__youcannot__mixand__matchbytes__andstr__withoutexplicit__conversions,you__llgenerally__usestr__objectsand__textfiles__fortext__dataand__bytesobjects__andbinary__filesfor__binary data.This__makesbytes__acrucial__toolin__manyroles__andworthy__ofa__quickdemo__here.Methods__Ifyou__reallywant__tosee__whatattributes__strhas__thatbytes__doesn t,you__canalways__checktheir__dirresults__(review: set(X) set(Y)is__itemsin__Xbut__notin__Y).This__canalso__tellyou__somethingabout__theexpression__operatorsthey__support (e.g.,__mod____and__rmod____implementthe__% operator,and__theyre__presentin__both today): $ python3Python__3.12.2 (v3.12.2:6abddd9f6a,Feb__6 2024, #Attributes__uniqueto__str >>> sorted(set(dir('abc')) - set(dir(b'abc'))) ['casefold', 'encode', 'format', 'format_map', 'isdecimal', 'isidentifier', 'isnumeric', 'isprintable'] #Attributes__uniqueto__bytes >>> sorted(set(dir(b'abc')) - set(dir('abc'))) ['__buffer__', '__bytes__', 'decode', 'fromhex', 'hex']As__youcan__see,str__andbytes__havealmost__identical functionality;their__uniqueattributes__aregenerally__methodsthat__dont__applyto__theother__(formatis__anoutlier__youll__meet shortly).For__instance,decode__translatesa__rawbytes__intoits__str representation,and__encodetranslates__astr__intoits__rawbytes__representation.Most__othermethods__areshared__betweenthe__two types. Moreover,bytes__areimmutable__justlike__str: >>>B__= b'code' # b' 'bytes__literal >>> B.find(b'od') #Search__forsubstr__offset 1 >>> B.replace(b'od', b'XY') #New__byteswith__replacement b'cXYe' >>>B__b'code' >>> B[0] = 'x' TypeError: 'bytes'object__doesnot__supportitem__assignmentFor__morebytes__methods,see__theearlier__coverageof__stringfundamentals__inChapter__7;bytes__domost__ofthe__same work,though__theirmethods__generallyreturn__anew__bytesinstead__ofa__str.Sequence__OperationsBesides__method calls,all__theusual__genericsequence__operationsyou__knowfrom__other sequences,like__lists,work__asexpected__onboth__strand__bytes.This__includes indexing, slicing, concatenation,and__so on.As__weve__learned,str__isa__sequenceof__charactercode__points,and__bytesis__asequence__of byte-size integers,but__theirsequence__operationssemantics__arethe__same.Notice__inthe__following, though,that__indexingbytes__returnsan__integergiving__thebyte__sbinary__value;bytes__reallyis__asequence__of 8-bitintegers__inthe__0 255 range,but__when displayed,its__componentsprint__aseither__ASCIIcharacters__iftheir__valuesfall__intoASCII__s 0 127 code-point range,or__ashex__escapes otherwise: >>>B__= b'code' #bytes__andstr__areboth__sequences >>>B__#Bytes__inthe__0 127range__displayas__ASCII b'code' >>> B[0], B[-1] # Indexing:returns__a byte'sinteger__value (99, 101) >>> 'code'[0] #But__indexinga__strreturns__a 1-itemstr__'c' >>> chr(B[0]) #Unicode__character (code point)for__byte'svalue__'c' >>> list(B) #But__it'sreally__integerbytes__[99, 111, 100, 101] >>> b'A\x42C\xFF\x63' #That__happento__displayas__ASCIIif__in 0 127 b'ABC\xffc' >>> chr(0x63), hex(B[0]) #And__accepthex__escapesfor__bytevalues__('c', '0x63') >>> B[1:], B[:-1] # Slicing:bytes__(thatdisplay__0 127as__ASCII) (b'ode', b'cod') >>> len(B) # Length:number__bytes (notnecessarily__characters) 4 >>>B__+ b'lmn' # Concatenation:bytes__b'codelmn' >>>B__* 4 # Repetition:bytes__b'codecodecodecode'Formatting__Onenotable__exceptionto__the same-operationsrule__for strings:string__formatting %expressions__workon__bytestoo__(asof__Python 3.5),but__neitherthe__formatmethod__nor f' ' f-stringformatting__isavailable__forbytes__anodd__bifurcationthat__seemsto__forgetthat__formattingcomes__inmultiple__flavors today: >>> b'a %s string' % b'fine' #Py__3.5+formatting__forbytes__b'afine__string' >>> b'a %s string' % bytes([0xFF, 0xFE]) # Non-ASCIIbytes__worktoo__b'a \xff\xfe string' >>> 'a {} string'.format('fine') #But__formatmethod__onlyfor__str 'afine__string' >>> b'a {} string'.format(b'fine') AttributeError: 'bytes'object__hasno__attribute 'format' >>>kind__= 'fine' >>> f'a {kind} string' #But__f-stringsonly__forstr__'afine__string' >>> bf'a {kind} string' SyntaxError:invalid__syntaxThere__arearguably__soundreasons__thatformatting__shouldnt__workon__bytesit__sjust__raw bytes,after__all,which__happensto__acceptand__printASCII__charactersas__theirASCII__code-point values,and__mayuse__anyencoding__ifit__s text,or__noneat__allif__its__not.Plugging__ASCIItext__intoan__encoded UTF-16string__orloaded__image,for__instance,makes__no sense.But__thesesound__reasonsare__inconsistentlyviolated__forthe__sakeof__the %expression__alone. Moreover, post-operationconversion__byencoding__isnt__thesame__asbytes__operations,and__willfail__ifthe__defaultor__explicitencoding__isnt__inclusiveenough__tohandle__the text: >>>kind__= 'fine' >>> f'a {kind} string'.encode() #Encoding__!=bytes__operations b'afine__string' >>>kind__= 'ABC' #And__narrowencodings__mayfail__>>> f'a {kind} string'.encode('ascii') UnicodeEncodeError: 'ascii'codec__can'tencode__character '\xc4'in__position 3:This__inconsistencyis__proneto__changeover__time,but__today,the__embarrassmentof__richesin__theformatting__departmenthas__alsogiven__birthto__anembarrassment__ofspecial__cases.Other__Waysto__MakeBytes__Sofar__inthis__section,we__vebeen__makingbytes__objectswith__the b' 'literal__syntax,but__theycan__alsobe__createdby__callingthe__bytesconstructor__witha__strand__anencoding__name,by__callingbytes__withan__iterableof__integersrepresenting__byte values,or__byencoding__astr__objectper__thedefault__(or passed-in) encoding.We__metsome__ofthese__earlierin__theguise__of conversions,but__theyre__moregeneral__thanpreviously__told.For__example,encoding__takesa__strand__returnsthe__rawbinary__bytesvalue__ofthe__stringaccording__toits__encoding specification;decoding__takesa__rawbytes__sequenceand__encodesit__toits__stringrepresentation__aseries__ofUnicode__characters: >>>B__= b'abc' >>>B__b'abc' >>>B__= bytes('abc', 'ascii') >>>B__b'abc' >>> ord('a') 97 >>>B__= bytes([97, 98, 99]) >>>B__b'abc' >>>B__= 'code'.encode() #Or__bytes() >>>B__b'code' >>>S__= B.decode() #Or__str() >>>S__'code'As__wesaw__earlier,the__lasttwo__ofthese__operationscan__alsobe__thoughtof__astools__forconverting__betweenstr__and bytes,as__expandedupon__inthe__next section.Mixing__StringTypes__Whenwe__usedthe__replaceearlier__whensampling__bytes methods,you__mayhave__noticedthat__wehad__topass__intwo__bytesobjects__forfrom__andto__strtypes__wont__work there.More__generally,Python__requiresspecific__stringtypes__insome__contextsand__expectsmanual__conversionsif__needed.Here__sthe__storyfor__functionand__method calls: >>>B__= b'code' >>> B.replace('od', 'XY') TypeError:a__bytes-likeobject__is required,not__'str' >>> B.replace(b'od', b'XY') b'cXYe' >>> B.replace(bytes('od'), bytes('XY')) TypeError:string__argumentwithout__anencoding__>>> B.replace(bytes('od', 'ascii'), bytes('XY', 'utf-8')) b'cXYe'The__sameholds__for mixed-type expressions:you__shouldtry__tokeep__yourtext__andbinary__data separate,but__ifyou__must mix,you__generallyalso__must convert: >>> b'ab' + 'cd' TypeError: can'tconcat__strto__bytes >>> b'ab'.decode() + 'cd' #bytes__tostr__'abcd' >>> b'ab' + 'cd'.encode() #str__tobytes__b'abcd' >>> b'ab' + bytes('cd', 'ascii') #str__tobytes__b'abcd'Two__notes here. First,remember__thatencoding__anddecoding__aremore__thana__simpletype__conversion;as__welearned__inthe__coverage earlier,they__createdifferent__typesof__data altogether. Second,although__youcan__createbytes__objectsyourself__torepresent__packedbinary__data,they__canalso__bemade__automaticallyby__readingfiles__openedin__binary mode,as__wewill__laterin__this chapter. First, though,let__sbriefly__explorebytes__elusiveand__changeable colleague.The__bytearrayObject__Sofar__inthis__chapter,we__vefocused__onstr__andbytes__becausethey__willbe__your go-tostring__tools. Python, however,has__athird__stringtype__bytearray,which__isessentially__amutable__variantof__bytes,and__thusa__mutablesequence__ofintegers__inthe__range 0 255.As__such,it__supportsthe__samestring__methodsand__sequenceoperations__as bytes,as__wellas__themutable__in-place-changeoperations__foundon__lists.We__vealready__seenmost__operationsthat__applyto__bytearray,so__well__justtake__aquick__tourhere__tosample__their flavor.First__off,you__cancall__bytearrayas__afunction__passinga__bytes (nota__str)to__makea__newmutable__sequenceof__small (0 255) integers: >>>B__= b'code' #A__str 'code'does__not work:not__bytes >>>C__= bytearray(B) >>>C__bytearray(b'code') >>> C[0], chr(C[0]) #ASCII__code-pointinteger__for 'c' (99, 'c')Once__youve__gota__bytearray,you__canchange__itin__placeusing__thesame__sortsof__operationsavailable__tomodify__a list,but__keepin__mindthat__youmust__assignjust__integersto__its cells,not__strtext__strings,and__notarbitrary__objects: >>> C[0] = 'x' TypeError: 'str'object__cannotbe__interpretedas__aninteger__>>> C[0] = b'x' TypeError: 'bytes'object__cannotbe__interpretedas__aninteger__>>> C[0] = ord('x') >>>C__bytearray(b'xode') >>> C[1] = b'Y'[0] >>>C__bytearray(b'xYde')The__bytearrays__methodsset__overlapsbroadly__withboth__strand__bytesbecause__its__akind__ofstring__sequence,but__italso__hasthe__listobject__s in-placechange__methodsbecause__its__mutabletoo__(thesecond__ofthe__followingmeans__attributesunique__to bytearray): >>> sorted(set(dir(b'abc')) - set(dir(bytearray(b'abc')))) {'__bytes__', '__getnewargs__'} >>> sorted(set(dir(bytearray(b'abc'))) - set(dir(b'abc'))) ['__alloc__', '__delitem__', '__iadd__', '__imul__', '__release_buffer__', '__setitem__', 'append', 'clear', 'copy', 'extend', 'insert', 'pop', 'remove', 'reverse'] Hence,it__ssomething__ofa__comboplatter__youget__methodsfor__in-place changes: >>>C__bytearray(b'xYde') >>> C.append(b'LMN') TypeError: 'bytes'object__cannotbe__interpretedas__aninteger__>>> C.append(b'LMN'[0]) >>>C__bytearray(b'xYdeL') >>> C.append(ord('M')) >>>C__bytearray(b'xYdeLM') >>> C.extend(b'NO') >>>C__bytearray(b'xYdeLMNO')Plus__allthe__usualsequence__operationsand__string methods: >>>C__+ b'!#' bytearray(b'xYdeLMNO!#') >>> C[0], chr(C[0]) (120, 'x') >>> C[1:] bytearray(b'YdeLMNO') >>> len(C) 8 >>>C__bytearray(b'xYdeLMNO') >>> C.replace('xY', 'co') TypeError:a__bytes-likeobject__is required,not__'str' >>> C.replace(b'xY', b'co') bytearray(b'codeLMNO') >>>C__bytearray(b'xYamLMNO') >>>C__* 4 bytearray(b'xYdeLMNOxYdeLMNOxYdeLMNOxYdeLMNO')For__completeness,this__sectionwould__beremiss__ifit__didnt__callout__thatyou__canalso__makea__bytesor__bytearrayby__passingin__anysort__ofinteger__sequenceor__generator,not__justtext__strings.This__alsoprovides__asort__ofconversion__froman__integercharacter__codeto__a bytes,but__onlyif__theinteger__isin__therange__0 255,and__onlyif__its__embeddedin__asequence__(elseyou__geta__byteswith__thatmany__zeroes surprisingly!).See__Pythons__manualsfor__moreesoteric__bitsthat__wedon__thave__spaceto__cover here: >>> bytes([1, 2, 3, 4]), bytearray([1, 2, 3, 4]) (b'\x01\x02\x03\x04', bytearray(b'\x01\x02\x03\x04')) >>> bytes([115]) #int__=>bytes__b's' >>> bytes([115])[0] #bytes__=>int__115 >>> bytes([999]) #Too__bigfor__abyte__ValueError:bytes__mustbe__in range(0, 256) >>> bytes(115) #Lots__of zeroes! b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00 >>> bytes(range(97, 104)), bytes(c + 97for__cin__range(7)) #Generators__too (b'abcdefg', b'abcdefg') Finally,by__wayof__summary,the__followingexamples__demonstratehow__bytesand__bytearrayare__sequencesof__integers,and__stris__asequence__ofcharacters__(i.e.,decoded__Unicodecode__points);although__allthree__cancontain__textualcontent__andsupport__manyof__thesame__operations,you__shoulduse__strfor__decoded text,bytes__forbinary__dataincluding__encoded text,and__bytearrayfor__binarydata__youwish__tochange__inplace__toavoid__thetime__andspace__overheadsof__generatingcopies__foreach__changeyou__make: >>>B__= b'code' #Bytes__>>> list(B) [99, 111, 100, 101] >>>C__= bytearray(b'code') #Changeable__bytes >>> list(C) [99, 111, 100, 101] >>>S__= 'code' #Unicode__text >>> list(S) ['c', 'o', 'd', 'e']Using__Textand__BinaryFiles__Nowthat__weve__learnedall__aboutPython__sstring__types,let__sreturn__totheir__rolesin__filesthe__maincontext__inwhich__mostprogrammers__willlikely__encounterUnicode__and bytes.As__mentioned earlier,the__modein__whichyou__opena__fileis__crucialin__Python:it__determinesboth__howthe__files__contentis__interpretedas__wellas__theobject__typeyou__willuse__toprocess__thatcontent__inyour__script.By__wayof__review,text__modeimplies__strobjects__andbinary__modeimplies__bytes,as__follows: Text-modefiles__Interpretfile__contentsaccording__toan__encodingeither__thedefault__foryour__platformor__onewhose__nameyou__passin__to open.By__passingin__anencoding__name,you__canforce__conversionsfor__varioustypes__ofUnicode__files. Text-mode__filesmay__alsohandle__BOMheaders__forsome__encodings (deferredtill__theend__ofthis__chapter)and__mayperform__universalnewline__translationsfor__youor__not;by__default,all__newlineforms__mapto__the \ncharacter__inyour__script,regardless__ofwhich__platformyou__are on. Binary-modefiles__Insteadreturn__filecontent__toyou__rawas__asequence__ofintegers__representingbyte__values,with__noencoding__or decoding,no__BOM handling,and__nonewline__translations.In__termsof__code,the__secondpositional__argumentto__open (a.k.a.mode__whenpassed__by keyword)determines__whetheryou__wanttext__orbinary__processingand__typesadding__ab__tothe__modestring__impliesbinary__mode.The__defaultmode__is rt,which__isthe__sameas__r,and__meanstext__input.In__addition,the__modeargument__toopen__alsoimplies__anobject__typefor__filecontent__representationregardless__ofthe__underlyingplatform__textfiles__returna__strfor__readsand__expectone__for writes,but__binaryfiles__returna__bytesfor__readsand__expectbytes__(or bytearray)for__writes. Text-FileBasics__To demonstrate,let__sreview__basicfile__I/O.As__longas__youre__processingsimple__textfiles__thatadhere__toyour__platforms__default encoding,files__lookand__feelmuch__asthey__doin__thisbook__searlier__coverage (forthat__matter,so__dostrings__in general).The__next example,for__instance,writes__oneline__oftext__toa__fileand__readsit__back: >>>file__= open('temp.txt', 'w') #Use__defaultencoding__on host,mode__w=write >>>size__= file.write('abc\n') #Returns__numbercharacters__written >>> file.close() #Manual__closeto__flushoutput__buffer >>>file__= open('temp.txt') #Default__modeis__"r" == "rt":text__input >>>text__= file.read() >>>text__'abc\n'As__a refresher,the__firstargument__toopen__isthe__files__pathnamethe__addressof__afile__inthe__hosts__folderhierarchy__thats__eitherabsolute__orrelative__tothe__current directory.The__secondargument__toopen__ismode__wherew__meanswrite__text,and__thedefault__meansread__it,and__writemethods__returnthe__numberof__writtenitems__eithercharacters__fortext__modeor__bytesfor__binary mode. Also,the__closecall__hereis__optionalin__somecontexts__(e.g.,the__widelyused__CPython auto-closesfiles__whentheir__objectsare__garbage collected)but__isgenerally__advisedto__flushchanges__andavoid__memory growth.1 Technically,the__precedingexample__writesand__readsUnicode__text,but__its__hardly noticeable:the__ASCIItext__stringis__encodedand__decodedper__thehosting__platforms__encoding default.We__realso__relyingon__platform-agnosticnewline__handlingfor__\n,but__wemust__moveahead__formore__onencodings__and newlines.Text__andBinary__Modes Next,let__swrite__atext__fileand__readit__backin__bothtext__andbinary__modes.Notice__inthe__followinghow__textmode__requiresus__toprovide__astr__for writing,rb__distinguishes binary-mode input,and__readinggives__usa__stror__bytesdepending__onthe__mode (opensand__transferoperations__arestrung__togetherhere__into one-liners__justfor__brevity; again,remember__toclose__explicitlyin__production code,and__possiblyin__someIDEs__andoutside__CPython): $py__-3 #Run__onWindows__(no \ron__Unix) >>> open('temp.txt', 'w').write('abc\n') # Text-mode output,provide__astr__4 >>> open('temp.txt', 'r').read() # Text-mode input,returns__astr__'abc\n' >>> open('temp.txt', 'rb').read() # Binary-mode input,returns__abytes__b'abc\r\n'Observe__howthe__newlinecharacter__isalways__\nwhen__writingand__readingin__textmode__withstr__but \r\nwhen__readingin__binarymode__with bytes.This__reflectsthe__factthat__thiswas__runon__Windows.Though__ithas__nothingto__dowith__Unicode, text-modefiles__automaticallymap__all \nin__strto__andfrom__thehost__platforms__newline separator: \r\non__Windowsand__just \non__Unix.When__readingin__binary mode, though,we__getwhat__sactually__inthe__filewith__neithernewline__mappingnor__Unicode decoding. Now,let__sdo__the same,but__witha__binary file.We__providea__bytesto__writeand__stillget__backa__stror__bytesdepending__onthe__input mode,though__the \nisn__texpanded__to \r\non__Windowsthis__time: >>> open('temp.bin', 'wb').write(b'abc\n') # Binary-mode output,send__abytes__4 >>> open('temp.bin', 'r').read() # Text-mode input,receive__astr__'abc\n' >>> open('temp.bin', 'rb').read() # Binary-mode input,bytes__sansmapping__b'abc\n'This__holdstrue__evenif__thedata__were__writingto__thebinary__fileis__trulybinary__in nature.In__the following,the__\x00is__abinary__zerobyte__andnot__aprintable__character,though__itworks__inthe__middleof__abytes__andqualifies__asa__textcode__pointin__thedefault__encoding (strictly speaking,zero__isa__charactercalled__nullor__NULin__ASCIIand__itssupersets__like UTF-8): >>> open('temp.bin', 'wb').write(b'a\x00c') #Binary__dataincluded__3 >>> open('temp.bin', 'r').read() # Text-mode:str__withNUL__'a\x00c' >>> open('temp.bin', 'rb').read() #Binary__mode:bytes__b'a\x00c'Binary__modefiles__alwaysreturn__contentsas__abytes__objectbut__accepteither__abytes__orbytearray__objectfor__writing.This__naturally follows,given__thatbytearray__ismostly__justa__mutablevariant__of bytes.In__fact,most__APIsin__Pythonthat__accepta__bytesalso__allowa__bytearray (thebytes__hereare__alsoASCII__characterstoo__obscurefor__this note): >>>BA__= bytearray(b'\x01\x02\x03') >>> open('temp.bin', 'wb').write(BA) 3 >>> open('temp.bin', 'r').read() '\x01\x02\x03' >>> open('temp.bin', 'rb').read() b'\x01\x02\x03' Finally,notice__thatyou__cant__getaway__withviolating__Pythons__str/bytes (i.e., text/binary)distinction__whenit__comesto__files;in__the following,we__geterrors__ifwe__tryto__writea__bytesto__atext__fileor__astr__toa__binary file. Remember,although__itis__oftenpossible__toconvert__betweenthese__twotypes__(asdescribed__earlierin__this chapter),you__willusually__wantto__stickto__strfor__textdata__andbytes__forbinary__data: >>> open('temp.txt', 'w').write('abc\n') #Auto__encodesstr__tobytes__4 >>> open('temp.txt', 'w').write(b'abc\n') #But__bytes !=decoded__text TypeError: write()argument__mustbe__str,not__bytes >>> open('temp.bin', 'wb').write(b'abc\n') #Writes__rawbytes__4 >>> open('temp.bin', 'wb').write('abc\n') #But__str !=raw__bytes TypeError:a__bytes-likeobject__is required,not__'str'This__mayseem__strict,but__Pythoncannot__guesshow__youwish__tointerpret__thecontents__ofa__bytesor__strwhen__usedin__theopposite__contextand__wiselyrefuses__toconvert__implicitly (abytes__mightbe__an image,after__all). Moreover,because__strand__bytesoperation__setslargely__intersect,the__choiceof__typeswon__tbe__muchof__adilemma__formost__programs.Watch__forthe__structmodule__coverageahead__foranother__binary-file example. Unicode-TextFiles__Andnow__forthe__featuredattraction__ofour__files tour:text__fileswith__non-ASCII text.Beyond__their text/binary distinction,Python__filescome__withadditional__requirementsand__toolsfor__dealingwith__Unicode text.In__short,text__filesallow__aspecific__Unicode encoding-schemename__tobe__passedin__withan__encodingargument__toopen__anduse__itto__automaticallydecode__andencode__texton__inputand__output, respectively.As__abstract examples,for__afile__identifiedby__apathname__string: open(pathname, 'r', encoding='utf8')Returns__afile__objectthat__decodestext__from UTF-8on__reads open(pathname, 'w', encoding='latin1')Returns__afile__objectthat__encodestext__to Latin-1on__writesThe__fileobject__returnedby__thefirst__ofthe__precedingassumes__thefile__scontent__isencoded__per UTF-8and__automaticallydecodes__itto__strUnicode__codepoints__whenread__bythe__program. Similarly,the__resultof__thesecond__lineof__codeencodes__strcode__pointsto__their Latin-1format__asthey__areoutput__tothe__file.Here__sthe__text-filestory__withthe__universal UTF-8encoding__andthree__non-ASCII__charactersin__the content: >>>file__= open('uni.txt', 'w', encoding='utf8') #Auto__encodesto__bytes >>> file.write(' 2h__ck ') 10 >>> file.close() >>>text__= open('uni.txt', 'r', encoding='utf8').read() #Auto__decodesto__str >>>text__' 2h__ck ' >>> [ord(c)for__cin__text] #Character__codepoints__[128155, 32, 50, 32, 104, 196, 99, 107, 32, 128013] >>>raw__= open('uni.txt', 'rb').read() #No__decodingapplied__>>>raw__b'\xf0\x9f\x92\x9b 2 h\xc3\x84ck \xf0\x9f\x90\x8d'File__transfersraise__exceptionswhenever__arequested__encodingdoesn__t work,so__theencoding__youpass__mustmatch__the data.For__example,ASCII__isnot__inclusiveenough__tohandle__theaugmented__andemoji__charactersin__thetext__were__writinghere__andfails__onboth__readsand__writes: >>> open('uni.txt', 'r', encoding='ascii').read() UnicodeDecodeError: 'ascii'codec__can'tdecode__byte 0xf0in__position 0: >>> open('ascii.txt', 'w', encoding='ascii').write(' 2h__ck ') UnicodeEncodeError: 'ascii'codec__can'tencode__character '\U0001f49b' >>> hex(ord(' ')) #ASCII__willalways__breakyour__heart? '0x1f49b'By__contrast,using__thebroader__andmore__general UTF-16on__bothends__handlesthis__textin__full,though__itsencoded__bytesstored__inthe__filenaturally__differfrom__thoseof__UTF-8: >>>file__= open('uni2.txt', 'w', encoding='utf16') # UTF-16works__too >>> file.write(' 2h__ck ') 10 >>> file.close() >>>text__= open('uni2.txt', 'r', encoding='utf16').read() #Files__encode+decode >>>text__' 2h__ck ' >>> [ord(c)for__cin__text] #Same__codepoints__[128155, 32, 50, 32, 104, 196, 99, 107, 32, 128013] >>> open('uni2.txt', 'rb').read() #Different__encoding b'\xff\xfe=\xd8\x9b\xdc \x002\x00 \x00h\x00\xc4\x00c\x00k\x00 \x00=\xd8\r\xdc'Even__forbroader__encodingslike__UTF-8and__UTF-16, though,you__cannotmix__and match:using__anincompatible__encodingstill__wont__workbecause__encodedbytes__inthe__file differ.Although__youcan__sometimeshandle__unknownencodings__with binary-mode files,open__error handlers,and__other techniques,your__encodingmust__generallymatch__yourfile__s data: >>> open('uni.txt', 'r', encoding='utf16').read() UnicodeDecodeError: 'utf-16-le'codec__can'tdecode__byte 0x8din__position 16: >>> open('uni2.txt', 'r', encoding='utf8').read() UnicodeDecodeError: 'utf-8'codec__can'tdecode__byte 0xffin__position 0:In__theabsence__ofan__encoding argument,text__filesstill__encodeand__decodeper__a host-and__platform-specificdefault__inlocale__discussed earlier.But__asa__reminder:although__youmay__notnotice__thesetranslations__ifyour__defaultand__files agree,you__generallyshould__notrely__onthe__default;it__makesyour__programsdependent__onthe__contextin__whichtheir__fileswere__createdand__canlead__toportability__issues (and nightmares;see__theupcoming__sidebarUnicode__Defaultsand__UTF-8Mode__).For__instance,a__programrun__ona__UTF-8default__platform (themacOS__andAndroid__norm)may__havetrouble__usinga__filemade__undera__cp1252default__(the ASCII-supersetdefault__onsome__Windows hosts)and__vice versa,and__contentfetched__fromother__devicesmay__beencoded__arbitrarily.Use__explicitopen__encodingsas__a rule.This__mayalso__helpif__environmentsettings__arenot__reliable (e.g.,when__runningas__ageneric__userfor__securityin__server-sideweb__scripts).All__thatbeing__said,you__llprobably__findfiles__tobe__easierin__practicethan__thefull__detailsmay__suggest.Accessing__webpages__and images,for__example,soon__becomessecond__natureand__simple.For__variety,the__followingfirst__omitsmode__(again,its__defaultis__thesame__as r)and__thenpasses__modeby__explicitkeyword__(insteadof__position),and__thisexample__isabstract__(substitutepathnames__ofreal__andaccessible__fileson__yourdevice__torun__live): >>>text__= open('Websites/about-lp5e.html', encoding='utf8').read() >>> text[:79] '>>image__= open('Websites/lp5e-large.jpg', mode='rb').read() >>> image[:20] b'\xff\xd8\xff\xe0\x00\x10JFIF\x00\x01\x01\x00\x00\x01\x00\x01\x00\x00'Once__youve__loadedcontent__this way,all__thestr__andbytes__operationswe__veseen__inthis__chapterare__atyour__disposalfor__wranglingtext__andbinary__data,and__savingthe__resultfollows__thesame__patternsimply__usean__encodingfor__textand__binarymode__for bytes: >>>text__= text.replace('2013', '2024') >>> open('Websites/about-lp6e.html', mode='w', encoding='utf8').write(text) >>>image__= some_sort_of_modding(image) >>> open('Websites/lp6e-large.jpg', mode='wb').write(image)You__mightmod__images,for__example,with__themany__toolsprovided__bythe__third-party__Pillow (f.k.a. PIL)imaging__libraryfor__Pythonor__similar.With__Pythons__filesand__strings,content__possibilitiesare__largely endless.In__theinterest__offull__disclosure,Python__sopen__acceptsadditional__argumentsthat__modifyits__behavior.Among__them,newline__changesnewline__mapping;errors__specifieshandling__ofencoding__anddecoding__errors (e.g., 'surrogateescape'replaces__failingbytes__withsequences__thatcan__beused__torestore__themon__output);and__buffering alters, well, buffering.Because__theirdefaults__aregenerally__whatyou__ll use,we__lldefer__tothe__Python standard-librarymanual__forthe__fineprint__onthese__andother__advancedfile__options.NOTE__Blastfrom__the past:Python__scodecs__modulealso__hasan__openthat__returnsan__auto- decode/encodefile__objectjust__likethe__built-inopen__function.This__wasused__forPython__2.Xbackward__compatibilityin__timesgone__by,but__theres__noobvious__reasonto__relyon__itin__new code. Still,you__mightsee__itin__legacycode__(andcode__thatrelies__onany__ofits__unique behaviors) anyhow: >>>import__codecs >>>f__= codecs.open('uni.txt', 'r', encoding='utf8') >>> f.read() ' 2h__ck ' Unicode, Bytes,and__OtherString__ToolsBesides__built-instrings__and files,many__ofthe__popular string-processingtools__inPython__sstandard__libraryinstalled__withPython__itselfalso__adhereto__the str/bytes dichotomy.We__wont__coverany__ofthese__application-focusedtopics__indetail__inthis__core-language book,but__asa__sample,here__sa__verybrief__lookat__howsome__ofthese__toolshandle__the split.See__Pythons__LibraryReference__formore__onthe__toolsused__hereif__anypique__your interest.The__re Pattern-MatchingModule__Pythons__re pattern-matchingmodule__hasbeen__generalizedto__workon__objectsof__anystring__type str, bytes,and__bytearray (a (.*)means__any run,saved__asa__group): >>>import__re >>>S__= 'is__thefastest__wayto__!' >>>B__= b'Pythonis__thefastest__wayto__pizza!' >>> re.match('(.*)the__(.*)way__(.*)', S).groups() #str__+str__=>str__(' is', 'fastest', 'to !') >>> re.match(b'(.*)the__(.*)way__(.*)', B).groups() #bytes__+bytes__=>bytes__(b'Python is', b'fastest', b'to pizza!') >>> re.match(b'(.*)the__(.*)way__(.*)', bytearray(B)).groups() (b'Python is', b'fastest', b'to pizza!')Like__many tools, though,its__resulttypes__dependon__thetype__ofstrings__youpass__in,and__youcan__tmix__strand__bytestypes__inits__callsarguments__(sansexplicit__conversions,of__course);bytearray__isalso__unusablehere__asa__patternbecause__its__mutable (andchangeable__meansunhashable__): >>> re.match('(.*)the__(.*)way__(.*)', B).groups() TypeError:cannot__usea__stringpattern__ona__bytes-likeobject__>>> re.match(b'(.*)the__(.*)way__(.*)', S).groups() TypeError:cannot__usea__bytespattern__ona__string-likeobject__>>> re.match('(.*)the__(.*)way__(.*)', bytearray(B)).groups() TypeError:cannot__usea__stringpattern__ona__bytes-likeobject__>>> re.match(bytearray(b'(.*)the__(.*)way__(.*)'), bytearray(B)).groups() TypeError:unhashable__type: 'bytearray'The__struct Binary-DataModule__ThePython__struct module,used__tocreate__andextract__packedbinary__datafrom__strings,operates__onbytes__andbytearray__only,not__strwhich__makes sense,given__thatit__sintended__forprocessing__binary data,not__decoded text.This__moduleuses__aformat__stringto__specifythe__typesand__sizesof__objectsto__packto__andfrom__abytes__string,along__withan__endianness (i.e.,significant__sideof__bitstrings)specifier__like >for__big-endian: >>>import__struct >>>B__= struct.pack('>i4sh', 7, b'code', 8) #int__, bytes(4s), int(h) =>bytes__>>>B__b'\x00\x00\x00\x07code\x00\x08' >>>vals__= struct.unpack('>i4sh', B) #Packed__datais__bytes,not__str >>>vals__(7, b'code', 8) >>>vals__= struct.unpack('>i4sh', B.decode()) TypeError:a__bytes-likeobject__is required,not__'str'You__lloften__usethis__inconjunction__with binary-modefiles__tomake__thepacked__bytespersistent__acrossprogram__runs (e.g.,for__savingand__restoringapp__user settings): >>>F__= open('data.bin', 'wb') #Open__binaryoutput__file >>>data__= struct.pack('>i4sh', 7, b'code', 8) #Create__packedbinary__data >>>data__# bytes,not__str b'\x00\x00\x00\x07code\x00\x08' >>> F.write(data) #Write__tothe__file 10 >>> F.close() #Flush__changes >>>F__= open('data.bin', 'rb') #Open__binaryinput__file >>>data__= F.read() #Read__bytes >>>data__b'\x00\x00\x00\x07code\x00\x08' >>>values__= struct.unpack('>i4sh', data) #Extract__packedbinary__data >>>values__#Back__toPython__objects (7, b'code', 8)The__pickleand__jsonSerialization__ModulesPython__spickle__moduleprovides__anotherway__tosave__datain__filesbut__allowssaved__datato__benearly__arbitraryPython__objectsinstead__ofvalues__coercedto__bytesas__in struct.We__metthis__modulebriefly__inChapters__9, 28,and__31.For__completeness here,keep__inmind__thatthe__picklemodule__alwayscreates__abytes__object,regardless__ofthe__defaultor__passed-inprotocol__(dataformat__level).You__cansee__thisby__usingthe__modules__dumpscall__toreturn__anobject__spickle__string: >>>import__pickle # dumps()returns__picklestring__>>> pickle.dumps(['code', 4, ' ']) #Default__protocol=binary b'\x80\x04\x95\x15\x00\x00\x00\x00etc__\x04\x8c\x04\xf0\x9f\x90\x8d\x94e.' >>> pickle.dumps(['code', 4, ' '], protocol=0) #ASCII__protocol 0,still__bytes! b'(lp0\nVcode\np1\naI4\naV\\U0001f40d\np2\na.'This__impliesthat__filesused__tostore__pickledobjects__mustalways__beopened__inbinary__modebecause__textfiles__usestr__stringsto__represent data,not__bytes,and__thedump__callsimply__attemptsto__writethe__pickledbyte__stringto__anopen__output file: >>> pickle.dump(['code', 4, ' '], open('temp.pkl', 'w')) # bytes+textmode__fail TypeError: write()argument__mustbe__str,not__bytes >>> pickle.dump(['code', 4, ' '], open('temp.pkl', 'w'), protocol=0) TypeError: write()argument__mustbe__str,not__bytes >>> pickle.dump(['code', 4, ' '], open('temp.pkl', 'wb')) #Always__binarymode__>>> open('temp.pkl', 'r').read() UnicodeDecodeError: 'utf-8'codec__can'tdecode__byte 0x80in__position 0:Notice__thelast__resultfails__herein__textmode__on macOS;if__itdoesn__tfail__for you,it__sonly__becausethe__storedbinary__datais__compatiblewith__yourplatform__sdefault__decoding (i.e.,just__by luck!).A__Windows host,for__example,prints__gibberishfor__thelast__resultinstead__ofan__error message.Because__pickledata__isnot__generallydecodable__Unicode text,the__samerule__holdson__inputas__outputcorrect__usagealways__requiresboth__writingand__readingpickle__datawith__binary-mode__files,whether__unpicklingor__not: >>> pickle.dump(['code', 4, ' '], open('temp.pkl', 'wb')) #Save__tofile__>>> pickle.load(open('temp.pkl', 'rb')) #Load__fromfile__['code', 4, ' '] >>> open('temp.pkl', 'rb').read() b'\x80\x04\x95\x15\x00\x00\x00\x00etc__\x04\x8c\x04\xf0\x9f\x90\x8d\x94e.'The__Pythonjson__module,introduced__inChapter__9,is__arelated__tool:it__convertsa__nested-objecttree__toa__textstring__thatcan__besaved__ona__fileto__makeit__persistent.Unlike__pickle,json__doesnt__supportarbitrary__objects (justbasic__typesand__built-in__containers)but__usesa__language-neutralscheme__thatcan__makeit__moreinteroperable__withother__programs.Also__unlike pickle,the__jsonmodule__alwaysproduces__a str,so__filesfor__savesand__loadsshould__generallyuse__textmode__(JSONfiles__arecommonly__encodedper__UTF-8for__portability,but__anyencoding__worksas__longas__its__consistentand__expected): >>>import__json >>>vals__= ['code', {'app': (' ', None, 1.23, 99)}] >>> json.dumps(vals) '["code", {"app": ["\\ud83d\\ude42", null, 1.23, 99]}]' >>>text__= json.dumps(vals) #Save__to/loadfrom__str >>>anew__= json.loads(text) >>>anew__['code', {'app': [' ', None, 1.23, 99]}] >>>file__= open('data.txt', 'w', encoding='utf8') # Save/load text-modefile__>>> json.dump(vals, file) >>> file.close() >>>file__= open('data.txt', 'r', encoding='utf8') >>> json.load(file) ['code', {'app': [' ', None, 1.23, 99]}]Filenames__inopen__andOther__FilenameTools__Sofar__inthis__chapter,we__vefocused__onthe__contentof__files,but__theirnames__havea__Unicodestory__too.Its__shortversion__isthat__stris__thenorm__forfile__pathnamesin__Pythonand__isrecommended__for portability.If__your code,like__allthe__examplesso__far,uses__strfor__filenamesand__pathnames,they__simply work:Python__sfile__toolsautomatically__translatethem__toand__fromthe__encodingused__bythe__hostplatform__and device.It__turns out, though,that__Pythons__filetools__alsoallow__youto__specifyfile__pathnamesas__bytesto__skipautomatic__filesystemencoding__insome__contexts.This__bytesmode__maycome__inhandy__ifyou__needmore__controlover__filenameencodings__in cross-platform code,but__itis__rarelyneeded__intypical__programs.Per__Pythons__manuals,in__fact,this__modeneed__beused__onlyon__someUnix__systemswhere__undecodablefilenames__maybe__present. Nevertheless,bytes__filenamesdo__workin__these tools,as__shownin__thefollowing__demo,which__runsthe__sameon__macOS, Windows, Linux,and__Androiddevices__tested.As__shown,the__openfunction__happilyaccepts__textor__bytesfor__afile__s non-ASCII__pathname (thissection__sexamples__wererun__insubfolder___filenamesin__thebook__sexamples__package): >>>import__sys, os,glob__>>> sys.getfilesystemencoding() #Filesystem__default:macOS__and Win11 'utf-8' >>> name1 = 'hck__1' #str__filenames >>> name2 = 'hck__2' >>> name2.encode('utf8') #bytes__equivalentfor__name2str__b'h\xc3\x84ck\xf0\x9f\x99\x822' >>> os.listdir() #Make__fileswith__strand__bytesnames__[] >>> open(name1, mode='w', encoding='utf8').write('text1') 5 >>> open(b'h\xc3\x84ck\xf0\x9f\x99\x822', 'w', encoding='utf8').write('text2') 5 >>> os.listdir() #Both__showup__onthe__filesystem ['hck__1', 'hck__2'] >>> open('hck__2').read() #And__canbe__accessedeither__way 'text2' >>> open('hck__2'.encode('utf8')).read() 'text2'For__bytes filenames,Python__uses UTF-8encoding__onmacOS__andon__Windowssince__3.6 (withextra__translationfor__theWindows__APIs__UTF-16). Linux,and__byextension__Android,accepts__anysort__ofbytes__for filenames,but__Pythontries__touse__UTF-8when__convertingto__andfrom__str (withsurrogate__escapesfor__encoding errors:see__Pythons__manuals).Whether__bytesfilenames__area__usefultool__orneat__parlortrick__dependson__youruse__cases,but__keepin__mindthat__bytesfilenames__willonly__workin__openif__theirencoding__matchesthe__expectationsof__Pythonor__theunderlying__filesystem.To__demo,the__followingpasses__Latin-1bytes__b'h\xc4ck'to__open:this__failson__bothmacOS__andWindows__asshown__(thoughwith__aUnicodeDecodeError__onthe__latterbecause__its__trappedby__Python): >>> 'h ck'.encode('latin-1'), 'h ck'.encode('utf-8') (b'h\xc4ck', b'h\xc3\x84ck') >>> b'h\xc4ck'.decode('utf8') UnicodeDecodeError: 'utf-8'codec__can'tdecode__byte 0xc4in__position 1: >>> open(b'h\xc4ck', 'w') OSError: [Errno 92]Illegal__byte sequence: b'h\xc4ck' # open(b'h\xc4ck'.decode('latin1'), 'w') # Works:convert__tostr__# open(b'h\xc3\x84ck', 'w') # Works:use__UTF-8encoding__By contrast,the__precedingcode__sopen__workson__Linuxand__Androidwhich__laterdecode__the Latin-1name__b'h\xc4ck'to__strby__UTF-8,as__surrogate-escaped__'h\udcc4ck'. Still,this__worksonly__ondrives__usinga__Linux-native filesystem.For__bothits__bytesand__escapedstr__forms,the__Latin-1name__failsin__openon__Linuxand__Androidwhen__thetarget__isa__removabledrive__formattedas__exFAT. Hence,the__effectof__usingarbitrary__bytesin__openvaries__byboth__platformand__filesystem (that is,don__tdo__that!).The__os standard-librarymodule__s directory-listinglistdir__similarlyaccepts__stror__bytesand__returnsa__folders__namesin__thesame__form,ready__tobe__usedin__otherfile__tools (perthe__earlier listing,it__alsodefaults__tothe__currentdirectory__ifno__folderis__passed): >>> os.listdir('.') #str__gives strs,bytes__givesbytes__['hck__1', 'hck__2'] >>> os.listdir(b'.') [b'h\xc3\x84ck\xf0\x9f\x99\x821', b'h\xc3\x84ck\xf0\x9f\x99\x822'] >>>for__namein__os.listdir('.'): print(name, '=>', open(name).read())h__ck 1 => text1h__ck 2 => text2 >>>for__namein__os.listdir(b'.'): print(name, '=>', open(name).read()) b'h\xc3\x84ck\xf0\x9f\x99\x821' => text1 b'h\xc3\x84ck\xf0\x9f\x99\x822' => text2The__globmodule__doesfilename__expansionboth__ways,too__(asstr__or bytes),and__os.fsdecodedecodes__filenamesper__thehost__sdefault__automatically: >>> glob.glob('h*ck*') #str__gives str,bytes__givesbyte__['hck__1', 'hck__2'] >>> glob.glob(b'h*ck*') [b'h\xc3\x84ck\xf0\x9f\x99\x821', b'h\xc3\x84ck\xf0\x9f\x99\x822'] >>>for__namein__glob.glob(b'h*ck*'): print(name.decode(sys.getfilesystemencoding()), os.fsdecode(name))h__ck 1h__ck 1h__ck 2h__ck 2In__addition,tools__thatcreate__andwalk__foldersare__similarlyflexible__fornames__andpaths__(demoedon__Windowsyour__pathseparators__andorder__may vary): >>> os.mkdir('sub ') #Make__dirswith__stror__bytes >>> os.mkdir('sub bytes'.encode('utf8')) #and__walkthem__withboth__>>> os.mkdir('sub bytes/subsub ') >>> os.listdir() ['hck__1', 'hck__2', 'sub ', 'sub bytes'] >>> os.listdir('sub bytes') ['subsub '] >>>for__(dirhere, subshere, fileshere)in__os.walk('.'): print(dirhere, '=>', subshere, fileshere) . => ['sub ', 'sub bytes'] ['hck__1', 'hck__2'] .\sub => [] [] .\subbytes__=> ['subsub '] [] .\sub bytes\subsub => [] [] >>> >>>for__(dirhere, subshere, fileshere)in__os.walk(b'.'): print(dirhere, '=>', subshere, fileshere) b'.' => [b'sub\xf0\x9f\x99\x8a', b'sub\xf0\x9f\x99\x8abytes'] [b' ', b' '] b'.\\sub\xf0\x9f\x99\x8a' => [] [] b'.\\sub\xf0\x9f\x99\x8abytes' => [b'subsub\xf0\x9f\x91\x8d'] [] b'.\\sub\xf0\x9f\x99\x8abytes\\subsub\xf0\x9f\x91\x8d' => [] []While__bytespathnames__workas__shownand__mayhave__somevalid__roles,it__simportant__tostress__thatyou__realmost__alwaysbetter__offusing__strstrings__toname__files instead.Doing__soleverages__toolsthat__alreadygo__togreat__lengthsto__makepathnames__dothe__rightthing__andmight__justavoid__atleast__someportability__issuesthat__canarise__inapps__whosescope__mustspan__platformsand__devices.And__thats__allthe__timeand__spacewe__havefor__thistools__survey. Really,Python__sstandard__libraryand__third-partydomain__arelarge__andevolving__toolsetsthat__willlikely__occupymuch__ofyour__attentionafter__youve__finishedthis__bookand__moveon__toreal__programming tasks. Again,be__sureto__consultthe__PythonLibrary__Referencesoon__andoften__formore__info.UNICODE__DEFAULTSAND__UTF-8MODE__Sowhat__sthe__default encoding, then?This__turnsout__tobe__aweirdly__convoluted story,which__weve__touchedon__lightlya__few times.Now__thatwe__veseen__allthe__playersin__action,we__canfinally__summarizeand__finalizethis__thread.In__short,Python__sdefault__Unicodeencoding__forboth__sourcecode__andstring__encoding/decodingmethods__isalways__UTF-8 everywhere;for__filenamescan__behad__with sys.getfilesystemencod ing();and__forfile__contentaccessed__viaopen__isfetched__with locale.getpreferredencod ing(False).The__methodsdefault__is sys.getdefaultencoding(),but__itcan__nolonger__bechanged__asof__Python 3.2 (andprobably__shouldnt__havebeen__changed earlier).The__filenamesdefault__isusually__UTF-8,including__onWindows__asof__Python 3.6,but__ismoot__ifyour__namesare__alwaysstr__(aswe__learnedin__thepreceding__section).The__opendefault__forfile__contentis__bifurcatedmost__and badly.Contrary__toPython__scurrent__docs,it__snot__simplythe__resultof__locale.getencoding()on__all platforms. Rather,it__seither__UTF-8if__the UTF-8mode__introducedin__Python 3.7is__enabledor__else getencoding().This__matterson__Windows today,where__getencoding()may__bea__code-pageencoding__like cp1252;because__Unixis__usually UTF-8,an__opensans__encodingisn__tportable__for non-ASCII content. UTF-8mode__addresses this,but__itmust__beenabled__todayby__settingthe__environmentvariable__PYTHONUTF8to__1or__using command-lineswitch__-X utf8.The__resultof__getencoding(),added__inPython__3.11,is__notinfluenced__by UTF-8mode__theway__thatopen__andthe__oldergetpreferred__encod ing(False)in__locale are. Hence,open__sconditional__default.Both__ofthe__localeencoding__resultsmay__alsobe__influencedby__platform,environment__variables,and__command-lineswitches__excepton__Android,which__isjust__plain UTF-8,and__onWindows__inthe__future,when__Python 3.15will__turn UTF-8mode__onby__defaultto__matchother__platformsfor__codethat__lacksexplicit__encodingsa__good idea,though__toolate__tothe__partyto__avoidmaking__a scene. Separately,environment__variablePYTHONIOENCODING__canbe__usedto__givethe__encodingof__stdiostreams__(e.g., sys.stdout)when__theyare__redirectedto__fileson__Windowsand__others (e.g., > output.txt)except__whenyou__ora__Pythonof__thefuture__enable 3.7s__UTF-8 mode,which__appliesto__redirectedstreams__toounless__variablePYTHONIOENCODING__isalso__set.Beyond__all this,the__encodingfate__ofunredirected__consolestreams__onWindows__canbe__sealedwith__PYTHONLEGACYWINDOWSSTDIO;filename__encodingson__Windowsmay__alsobackslide__totheir__code-pageroots__forthe__brazenlygrandiose__PYTHONLEGACYWINDOWSFSENCODING;Unix__encodingscan__beforced__toskip__UTF-8similarly__with PYTHONCOERCECLOCALE;and__UTF-8mode__modulatesadditional__textualtools__omittedhere__forspace__(and humanity). Right.If__youdon__tcare__toremember__allthat__andprefer__tosleep__wellat__nightenable__UTF-8mode__onWindows__todaybefore__Python 3.15 does;use__strfor__filenamesand__passexplicit__encodingsto__openinstead__ofrelying__ontangled__andmorphing__defaults;and__seePython__smanuals__forthe__full,if__frightening, story.The__UnicodeTwilight__ZoneTo__wrap up,this__chapteris__goingto__brieflypresent__twocurated__topicsfrom__theUnicode__realmBOMs__andnormalization__thatare__tooconvoluted__forfull__coveragein__thisbook__andprobably__tooarcane__tomatter__tomost__Python newcomers.If__andwhen__thesebecome__importantto__your projects,you__llfind__ampleresources__inboth__Pythons__docsand__theweb__atlarge__tofill__inthe__bitsglossed__overhere__for space.For__now,let__sjump__rightinto__thefirst__ofthese__arguablyexplosive__topics.Dropping__theBOM__inPython__Asnoted__brieflyearlier__inthis__chapter,some__encodingschemes__storea__specialbyte__ordermarker__(BOM)sequence__atthe__startof__filesto__specifydata__endianness (whichend__ofa__stringof__bitsis__mostsignificant__toits__value)or__declarethe__encodingtype__in general.Python__s text-modefiles__bothskip__thismarker__oninput__andwrite__iton__outputif__theencoding__implies presence,but__wesometimes__mustuse__aspecific__encodingname__toforce__BOMprocessing__explicitlyand__mayneed__toaccommodate__itwhen__encoding manually.For__example,in__the UTF-16and__UTF-32 encodings,the__BOMboth__identifiesthe__encodingand__specifies big-or__little-endian format.A__UTF-8text__filemay__alsoinclude__a BOM,but__thisisn__tguaranteed__andserves__onlyto__declarethat__itis__UTF-8in__general.When__readingand__writingdata__usingthese__encoding schemes,Python__automaticallyskips__orwrites__theBOM__ifit__iseither__impliedby__ageneral__encodingname__orif__youprovide__amore__specificencoding__nameto__forcethe__issue.More__concretely:In__UTF-16,the__BOMis__alwaysprocessed__forencoding__name utf-16,and__themore__specificencoding__name utf-16-ledenotes__little-endian format.In__UTF-8,the__morespecific__encodingname__utf-8-sigforces__Pythonto__bothskip__andwrite__aBOM__oninput__and output, respectively,but__thegeneral__utf-8does__not.Making__BOMsin__TextEditors__Lets__makesome__fileswith__BOMsto__seehow__thisworks__in practice.We__regoing__todo__thisin__Pythonin__a moment, too,but__lets__startby__creatinga__filein__atext__editorto__underscorethat__yourprograms__willalso__haveto__processcontent__fromother__sources.If__youwish__towork__along,you__canuse__anytext__editorthat__sUnicode__awarefor__saves,and__mosteditors__on PCs, tablets,and__phonesare__today.This__demouses__WindowsNotepad__justbecause__its__widespread (anddocumenting__multipleeditors__usagehere__isright__out).When__yousave__atext__filein__Windows Notepad,you__canspecify__itsencoding__typein__a drop-downlist__simple text, little-or__big-endian UTF-16,or__UTF-8with__orwithout__a BOM.For__instance,if__youuse__Notepadto__savethe__twolines__codeand__CODEin__atext__filenamed__code.txtwith__encodingtype__ANSI,the__fileis__writtenas__simpleASCII__textwithout__a BOM. Technically,the__saveuses__the cp1252default__encodingon__theWindows__host used,but__cp1252is__anASCII__superset,and__thecontent__isall__ASCII.In__Pythonafter__the save,when__thisfile__isread__inbinary__mode,we__cansee__theactual__bytesstored__inthe__file,including__\rin__newlines.When__its__readas__text,Python__performsnewline__translationby__default,and__wecan__alsodecode__itexplicitly__as UTF-8text__sinceASCII__isa__subsetof__boththis__encodingand__Windowsdefault__cp1252: $py__-3 #On__Windows,post__ANSIsave__inNotepad__>>>import__locale >>> locale.getpreferredencoding(False) #open__default: ASCII&Latin-1superset__'cp1252' >>> open('code.txt', 'rb').read() #ASCII__(and cp1252and__UTF-8)bytes__b'code\r\nCODE\r\n' >>> open('code.txt', 'r').read() #Text__modealso__translatesnewlines__'code\nCODE\n' >>> open('code.txt', 'r', encoding='utf-8').read() 'code\nCODE\n' Now,if__thisfile__isinstead__savedas__UTF-8with__BOMin__Notepad (UTFin__itsprior__versions),its__textis__prependedwith__a three-byte UTF-8BOM__sequence (whichprints__as non-ASCII \xNNhex__escapesin__bytesin__Python),and__weneed__togive__themore__specificencoding__name utf-8-sigto__forcePython__toskip__themarker__automaticallyon__input (elseit__printsas__a \uNNNNUnicode__code-pointescapes__in str): >>> open('code.txt', 'rb').read() #After__resaved: UTF-8with__3-byteBOM__b'\xef\xbb\xbfcode\r\nCODE\r\n' >>> open('code.txt', 'r').read() # Default+utf8keep__BOM, utf-8-sigdrops__' code\nCODE\n' >>> open('code.txt', 'r', encoding='utf-8').read() '\ufeffcode\nCODE\n' >>> open('code.txt', 'r', encoding='utf-8-sig').read() 'code\nCODE\n'And__ifthe__fileis__storedas__UTF-16BE__inNotepad__(Unicodebig__endian formerly),we__get UTF-16 big-endianformat__datain__the file,with__twobytes__(16 bits)prepended__torecord__a two-byteBOM__sequence.The__encodingname__utf- 16in__Pythonskips__theBOM__becauseit__isimplied__(sinceall__UTF-16files__havea__BOM),and__utf-16-behandles__the big-endianformat__butdoes__notskip__theBOM__inthe__input result: >>> open('code.txt', 'rb').read() b'\xfe\xff\x00c\x00o\x00d\x00e\x00\r\x00\n\x00C\x00O\x00D\x00E\x00\r\x00\n' >>> open('code.txt', 'r', encoding='utf-16').read() 'code\nCODE\n' >>> open('code.txt', 'r', encoding='utf-16-be').read() '\ufeffcode\nCODE\n'Experiment__withother__save/opencombinations__formore__insights.The__defaultencoding__inthe__last example,for__example,would__printgarbage__charactersbecause__its__notvalid__forthe__text,and__UTF-16 little-endianswaps__byteorder__forthe__BOMand__each 2-byte character.NOTE__Notepad flux:Notepad__recentlychanged__itsencoding__optionsfor__saves. Today,it__offersANSI__(thehost__s default), UTF-16in__little-and__big-endian flavors,and__UTF-8with__andwithout__a BOM,and__defaultsto__UTF-8.When__thisbook__sprior__editionwas__penned,Notepad__had UTF-8with__animplied__BOM,and__itsUnicode__meant UTF-16 which,of__course,is__justone__ofthe__verymany__kindsof__Unicode encoding.The__narrativehere__hasbeen__updatedto__reflectthe__new choices,but__thisnaturally__isjust__thestory__today.Because__thisbook__staunchlyrefuses__tobecome__aNotepad__doc,translate__saveoptions__asneeded__tothe__Notepadon__aPC__near you.Making__BOMsin__PythonThe__precedingsection__usedPython__toread__filesmade__inan__editor,but__thesame__patternsapply__whenPython__alsomakes__the files:Python__willautomatically__adda__BOMwhen__wewrite__aUnicode__filein__code,but__weneed__touse__amore__explicitencoding__nameto__forcethe__BOMin__UTF-8mode__utf-8does__notwrite__theBOM__onoutput__but utf-8-sig does,and__thesame__goesfor__skipping UTF-8BOMs__on input.When__runon__Windows (Unixis__the same,but__doesnt__add \rto__newlines,and__usuallydefaults__to UTF-8): >>> open('temp.txt', 'w', encoding='utf-8').write('code\nCODE\n') 10 >>> open('temp.txt', 'rb').read() # utf-8:no__BOM b'code\r\nCODE\r\n' >>> open('temp.txt', 'w', encoding='utf-8-sig').write('code\nCODE\n') 10 >>> open('temp.txt', 'rb').read() # utf-8-sig:adds__BOM b'\xef\xbb\xbfcode\r\nCODE\r\n' >>> open('temp.txt', 'r').read() # Default:bad__BOM ' code\nCODE\n' >>> open('temp.txt', 'r', encoding='utf-8').read() # utf-8:keeps__BOM '\ufeffcode\nCODE\n' >>> open('temp.txt', 'r', encoding='utf-8-sig').read() # utf-8-sig:drops__BOM 'code\nCODE\n'Per__this code,although__utf-8does__notdrop__theBOM__whenone__is present,data__withouta__BOMcan__beread__withboth__utf-8and__utf-8-sigwhich__meansyou__canuse__thelatter__forinput__ifyou__renot__surewhether__aBOM__ispresent__ina__fileor__not (anddon__tread__thisparagraph__outloud__inan__airportsecurity__line!): >>> open('temp.txt', 'w').write('code\nCODE\n') # Default: UTF-8subset__10 >>> open('temp.txt', 'rb').read() #No__BOM b'code\r\nCODE\r\n' >>> open('temp.txt', 'r').read() #Default__'code\nCODE\n' >>> open('temp.txt', 'r', encoding='utf-8').read() #Either__utf-8works__'code\nCODE\n' >>> open('temp.txt', 'r', encoding='utf-8-sig').read() 'code\nCODE\n'For__theencoding__name utf-16,the__BOMis__handled automatically:on__output,data__iswritten__inthe__platforms__native endianness,and__theBOM__isalways__written;on__input,data__isdecoded__perthe__BOM,and__theBOM__isalways__stripped.This__reflectsthe__factthat__BOMsare__standardand__requiredin__the UTF-16encoding__scheme: >>>import__sys >>> sys.byteorder #Windows__host'sdefault__endianness 'little' >>> open('temp.txt', 'w', encoding='utf-16').write('code\nCODE\n') 10 >>> open('temp.txt', 'rb').read() b'\xff\xfec\x00o\x00d\x00e\x00\r\x00\n\x00C\x00O\x00D\x00E\x00\r\x00\n\x00' >>> open('temp.txt', 'r', encoding='utf-16').read() 'code\nCODE\n'More__specific UTF-16encoding__namescan__specifydifferent__endianness,though__youmay__haveto__manuallywrite__andskip__theBOM__yourselfin__somescenarios__ifit__isrequired__orpresent__studythe__followingexamples__formore__BOM-makinginstructions__(sorry): >>> open('temp.txt', 'r', encoding='utf-16-le').read() '\ufeffcode\nCODE\n' >>> open('temp.txt', 'w', encoding='utf-16-be').write('\ufeffcode\nCODE\n') 11 >>> open('temp.txt', 'rb').read() b'\xfe\xff\x00c\x00o\x00d\x00e\x00\r\x00\n\x00C\x00O\x00D\x00E\x00\r\x00\n' >>> open('temp.txt', 'r', encoding='utf-16').read() 'code\nCODE\n' >>> open('temp.txt', 'r', encoding='utf-16-be').read() '\ufeffcode\nCODE\n'The__morespecific__UTF-16encoding__namesby__themselvescreate__andwork__finewith__BOM-less files,though__utf-16requires__oneon__inputin__orderto__determinebyte__order: >>> open('temp.txt', 'w', encoding='utf-16-le').write('CODE') 4 >>> open('temp.txt', 'rb').read() #Okay__ifBOM__notpresent__orexpected__b'C\x00O\x00D\x00E\x00' >>> open('temp.txt', 'r', encoding='utf-16-le').read() 'CODE' >>> open('temp.txt', 'r', encoding='utf-16').read() UnicodeError: UTF-16stream__doesnot__startwith__BOMExperiment__withthese__encodings yourself,or__seePython__slibrary__manualsfor__moredetails__onthe__BOM.And__ifyou__reallywant__todrop__thebomb__inPython__(andstretch__thissection__ssilly__bitto__itsbreaking__point),Unicode__emojicharacters__dothe__job: >>> open('boms.txt', 'w', encoding='utf-8-sig').write(' ' * 10) 10 >>> open('boms.txt', encoding='utf-8-sig').read() ' 'Unicode__Normalization:Whither__Standard?Last__butnot__least,after__devotingdozens__ofpages__to Unicode,we__llclose__byexplaining__oneway__inwhich__it,at__least arguably,falls__short.In__brief,this__standardfailed__tostandardize__codepoints__fora__handfulof__characters:it__allowsthe__samecharacter__tobe__representedin__morethan__one way,which__breaksequality__testingand__canwreak__interoperabilityhavoc__with text-processing programs.While__theremay__havebeen__validrationales__forthis__policy,it__addsa__specialcase__forprogrammers__andundoubtedly__breaksmany__atool__and app.For__example,the__character (ann__augmentedwith__a tilde,commonly__usedin__Spanish)can__berepresented__withtwo__different code-pointsequences__inthe__Unicode standard:As__asingle__characterwith__codepoint__\u00F1an__augmentedn__Asa__two-codepointsequence__\u006Eand__\u0303a__nakedn__followedby__acombining__tildeThe__firstof__theseis__calledthe__composed form,known__as NFC,because__itcombines__letterand__accent.The__secondis__calledthe__decomposed form,known__as NFD,because__itsparts__are split.Despite__theirglaring__difference,the__Unicodestandard__mandatesthat__thesetwo__formsrepresent__thesame__characterand__mustbe__treatedas__suchby__programs.It__seasy__toobserve__thesealter__egosin__Python:the__followinguses__\uUnicode__code-pointescapes__tospecify__thecode__pointsfor__inboth__forms (Windows users:don__tbe__alarmedif__some characters,especially__NFDs,render__differentlyin__command-lineinterfaces__dueto__settingsthat__arewell__beyondthis__books__scope): >>>L__= '\u00F1' #NFC__form ('\xF1'works__too) >>>M__= '\u006E\u0303' #NFD__form >>> L,M__#The__samecharacter__(' ', 'n ')Nor__isthis__characteralone__inits__split personality.Other__characterssuch__as , , ,and__haveboth__NFCand__NFDrepresentations__as well: >>> '\u00C5', '\u0041\u030A' #NFD__(1code__point),NFC__(2code__points) (' ', 'A ') >>> '\u00E8', '\u0065\u0300' #But__it'sthe__samecharacter__forboth__(' ', 'e ') >>> '\u00E9', '\u0065\u0301' (' ', 'e ') >>> '\u03D4', '\u03D2\u0308' (' ', ' ') Importantly,this__isnot__aboutthe__encodedrepresentation__ofthis__characterin__bytes,which__naturallyvaries__acrossdifferent__encodings.The__twoalternative__representationsfor__eachpreceding__characterdiffer__fortheir__decoded, in-memoryrepresentation__asinteger__code points.Encoded__forms (e.g.,stored__in files) differ, too,but__decodeto__thesame__differingcode__points: >>> '\u00F1'.encode('utf8'), '\u006E\u0303'.encode('utf8') (b'\xc3\xb1', b'n\xcc\x83') >>> b'\xc3\xb1'.decode('utf8'), b'n\xcc\x83'.decode('utf8') (' ', 'n ')The__unfortunateconsequence__ofthis__pluralityis__thatit__breaksequality__testing:because__thesame__charactercan__berepresented__inmultiple__ways,it__simpossible__tocompare__withthe__usual tools.In__Python specifically,the__== equal-by-value operator,which__comparescharacters__(really,code__points),won__tsuffice__inthe__presenceof__Unicodedoppelg__ngers: >>>L__= '\u00F1' >>>M__= '\u006E\u0303' >>> L,M__#The__samecharacter__(' ', 'n ') >>>L__==M__#But__equalitysays__no!False__>>> len(L), len(M) #Because__theircode__pointsdiffer__(1, 2)All__ofwhich__mightnot__bea__problemin__anideal__computingworld__thatsettled__onone__formas__ade__factostandard__forportability__s sake. Unfortunately,that__snot__theworld__we occupy.Computer__vendors,being__computer vendors,have__optedto__favordifferent__forms:broadly__speaking,macOS__prefers NFD,Windows__andothers__prefer NFC,this__canalso__varyby__filesystem,and__toleranceof__nonnativeforms__isless__than complete.The__neteffect__isthat__theUnicode__standardcreated__aninteroperability__problemwhile__tryingto__fix another!So__whatto__dowith__aworld__thatjust__wont__standardize?The__trickis__that,for__everytool__thatprocesses__filecontents__ornames__acrossdivergent__platforms,text__mustbe__convertedto__acommon__formbefore__comparisons.And__luckily,Python__makesthis__remarkably easy: >>>from__unicodedataimport__normalize #Python__stdlibtool__>>>L__= '\u00F1' >>>M__= '\u006E\u0303' >>> L,M__#Same__char,diff__codepoints__(' ', 'n ') >>>L__==M__#Equality__failsFalse__>>> normalize('NFC', L) == normalize('NFC', M) # Common-formequality__worksTrue__>>> normalize('NFD', L) == normalize('NFD', M) #Either__suffices,if__thesame__TruePrograms__thatcompare__filenamessent__between platforms,for__example,should__becareful__tonormalize__this way. Otherwise,files__whosenames__lookthe__sameto__users (andreally__arethe__sameper__Unicode)will__failto__matchby__simpleequality__andderail__searchesand__syncs.The__samegoes__fortext__filesobtained__fromarbitrary__sourceslike__mostinternet__content.There__smore__tothis__story (e.g.,the__canonicalequivalence__ofNFC__andNFD__normalizedforms__isstill__notthe__sameas__compatibility,though__mostprograms__dont__needto__care).Because__weve__runtight__on space, though,we__llstop__short.If__youd__liketo__dig deeper,you__llfind__ample follow-upcoverage__bothon__theweb__andin__Pythons__manualset__(seethe__latters__UnicodeHOWTO__andits__coverageof__therelated__stringcasefold__method).At__the least, though,you__nowshouldn__tbe__whollysurprised__whenyour__text-processing__codeis__bittenby__thiscurious__choiceof__theUnicode__standard.Chapter__SummaryThis__chapterexplored__theadvanced__stringsupport__availablein__Pythonfor__processingUnicode__textand__binary data.While__someprogrammers__useASCII__textand__mayget__bywith__thebasic__stringtype__andits__operations,Python__sstring__modelfully__supportsboth__richerUnicode__textvia__thenormal__strstring__typeand__byte-orientedbinary__datawith__bytesand__bytearray.In__addition,we__learnedhow__Pythons__fileobject__automaticallyencodes__anddecodes__Unicode text,and__dealswith__bytestrings__for binary-mode files. Finally,we__brieflymet__sometext__andbinary__toolsin__Pythons__libraryand__sampledtheir__behaviorwith__strings,and__tooka__lookat__thedarker__Unicodecorners__ofBOMs__and normalization.In__thenext__chapter,we__llshift__ourfocus__to tool-builder topics,with__asurvey__ofways__tomanage__accessto__objectattributes__byinserting__automaticallyrun__code.Before__wemove__on, though,here__sa__setof__questionsto__reviewwhat__weve__learned.This__hasbeen__asubstantial__chapter,so__besure__toread__thequiz__answerseventually__fora__more in-depth summary.Test__Your Knowledge:Quiz__1.What__arethe__namesand__rolesof__stringobject__typesin__Python? 2.How__doPython__sstring__typesdiffer__interms__of operations? 3.How__canyou__code non-ASCIIUnicode__charactersin__astring__in Python? 4.What__arethe__maindifferences__between text-and__binary-modefiles__in Python? 5.How__wouldyou__reada__Unicodetext__filethat__containstext__ina__differentencoding__thanthe__defaultfor__your platform? 6.How__canyou__createa__Unicodetext__filein__aspecific__encoding format? 7.Why__isASCII__textconsidered__tobe__akind__ofUnicode__text? 8.What__doBOM__andnormalization__meanin__Unicode? 9.How__largean__impactdoes__Pythons__text/binarystring__dichotomyhave__onyour__code?Test__Your Knowledge:Answers__1.Python__hasthree__string types:str__(forUnicode__text,including__ASCII),bytes__(forbinary__datawith__absolutebyte__values),and__bytearray (amutable__flavorof__bytes).The__strtype__usuallyrepresents__contentstored__intext__files,and__theother__twotypes__generallyrepresent__contentstored__inbinary__files (includingencoded__text). 2.Python__sstring__typesshare__almostall__thesame__operations:method__calls,sequence__operations,and__evenlarger__toolslike__patternmatching__workthe__same way.On__theother__hand,only__strsupports__stringformatting__sformat__methodand__f' ' f-strings,and__bytearrayhas__anadditional__setof__operationsthat__perform in-place changes.The__strand__bytestypes__alsohave__methodsfor__encodingand__decoding text, respectively. 3. Non-ASCIIUnicode__characterscan__becoded__ina__strstring__withboth__hex (\xNN)and__Unicode (\uNNNN, \UNNNNNNNN)escapes__forcode__points,both__ofwhich__denotecharacter__code points.They__canalso__becoded__intheir__encodedform__asbytes__usinghex__escapesand__decodedto__text.On__most devices, non-ASCIIcharacters__accentedcharacters__and emojis,for__examplecan__alsobe__typedor__pasteddirectly__intocode__andare__interpretedper__the UTF-8default__oran__encoding-directivecomment__atthe__topof__asource__code file. 4. Text-modefiles__assumetheir__contentis__Unicodetext__(evenif__its__all ASCII)and__automaticallydecode__whenreading__andencode__when writing.With__binary-mode files,bytes__aretransferred__toand__fromthe__file unchanged.The__contentsof__text-modefiles__areusually__representedas__strobjects__inyour__script,and__thecontents__ofbinary__filesare__representedas__bytes (or bytearray) objects. Text-modefiles__alsohandle__BOMsfor__certainencoding__typesand__automaticallytranslate__newlinesequences__toand__fromthe__single \ncharacter__oninput__andoutput__unlessthis__isexplicitly__disabled; binary-modefiles__donot__performeither__ofthese__steps. 5.To__readfiles__encodedin__adifferent__encodingthan__thedefault__foryour__platform,simply__passthe__nameof__thefile__sencoding__tothe__open built-in__function;data__willbe__decodedper__thespecified__encodingwhen__itis__readfrom__the file,and__youll__getback__adecoded__Unicode-textstr__stringthat__hasno__encoding.You__canalso__readin__binarymode__andmanually__decodethe__bytesto__astring__bygiving__anencoding__name,but__thisinvolves__extrawork__andis__somewhat error-pronefor__multibytecharacters__(youmay__accidentallyread__apartial__charactersequence__whenloading__contentby__bytesor__chunks). 6.To__createa__Unicodetext__filein__aspecific__encoding format,pass__thedesired__encodingname__to open;strings__willbe__encodedper__thedesired__encodingwhen__theyare__writtento__the file.You__canalso__manuallyencode__astring__tobytes__andwrite__itin__binary mode,but__thisis__usuallyextra__work. 7.ASCII__textis__consideredto__bea__kindof__Unicodetext__becauseits__7-bit (0..127)range__ofvalues__isa__subsetof__manyUnicode__encodings.For__example,valid__ASCIItext__isalso__valid Latin-1text__(Latin-1simply__assignsthe__remainingpossible__valuesin__an 8-bitbyte__toadditional__characters)and__valid UTF-8text__(UTF-8uses__a variable-bytescheme__forrepresenting__more characters,but__ASCIIcharacters__arestill__representedwith__thesame__valuesin__asingle__byte).This__makesUnicode__backwardcompatible__with ASCII,as__longas__theencodings__usedrepresent__ASCIIthe__same way. 8.The__UnicodeBOM__isa__sequenceof__bytesadded__tothe__frontof__atext__stringor__filein__someencodings__toboth__identifythe__encodingand__givethe__strings__endianness.Unicode__normalizationconverts__charactersto__acommon__formatto__neutralizedifferences__thatarise__forcharacters__thathave__multiple code-pointvalues__inthe__Unicodestandard__andwould__failto__matchby__simple code-point (character) equality. 9.The__impactof__Pythons__stringsmodel__dependsupon__thetypes__ofstrings__you use.For__scriptsthat__usesimple__ASCIItext__onplatforms__with ASCII-compatibledefault__encodings,the__impactis__probably minor:the__strstring__sansencodings__sufficesin__this case. Moreover,although__string-relatedtools__inthe__standard library,such__as re, struct, pickle,and__os,may__technicallyuse__differenttypes__indifferent__contexts,the__effectis__largelyirrelevant__tomost__programsbecause__Pythons__strand__bytessupport__almostidentical__interfaces.On__theother__hand,if__youprocess__non-ASCIIUnicode__text,you__llneed__touse__strand__passencodings__to open;if__youdeal__withbinary__data files,you__llneed__todeal__withcontent__asbytes__objects;and__ifyour__codemust__workacross__manyplatforms__orprocess__contentfrom__arbitrary sources,you__llwant__touse__explicitencodings__fortext__files.In__general,Unicode__isthe__waythe__textworld__workstoday__andwill__bea__must-knowtool__formost__Python users. 1File__fine points:most__ofthis__chapters__fileexamples__usefilenames__relative to,and__hencestored__in,the__current directory,so__besure__torun__themin__adirectory__(a.k.a. folder)where__youhave__permissionto__create files;cd__toone__inyour__shellor__IDEif__needed.This__maymatter__onplatforms__withmajor__storageconstraints__like Android,but__youll__probablyalready__bein__asafe__folderin__most apps. Also,file__extensions (e.g., .txt)don__tmean__anythingto__Pythonand__aretechnically__optional;some__IDEsthat__hangon__toobjects__fordebugging__mayrequire__manualclose__callsto__flushchanges__too;and__puriststake__notethat__fileis__nolonger__a built-inname__inPython__andOK__touse__asa__variable here!Chapter__38.Managed__AttributesThis__chapterexpands__onthe__attributeinterception__techniquesintroduced__earlier,introduces__another,and__employsthem__ina__handfulof__larger examples.Like__everythingin__thispart__ofthe__book,this__chapteris__classifiedas__anadvanced__topicand__optional reading,because__mostapplications__programmersdon__tneed__tocare__aboutthe__materialdiscussed__herethey__canfetch__andset__attributeson__objectswithout__concernfor__attribute implementations.Especially__fortools__builders, though,managing__attributeaccess__canbe__animportant__partof__flexible APIs. Moreover,an__understandingof__thedescriptor__modelcovered__herecan__makerelated__toolssuch__asslots__andproperties__moretangible__andmay__evenbe__requiredreading__ifit__appearsin__codeyou__must use.Why__Manage Attributes?Object__attributesare__centralto__mostPython__programsthey__arewhere__weoften__storeinformation__aboutthe__entitiesour__scripts process. Normally,attributes__aresimply__namesfor__objects;a__persons__name attribute,for__example,might__bea__simple string,fetched__andset__withbasic__attribute syntax: person.name #Fetch__attributevalue__person.name =value__#Change__attributevalue__Inmost__cases,the__attributelives__inthe__objectitself__oris__inheritedfrom__aclass__fromwhich__it derives.That__basicmodel__sufficesfor__mostprograms__youwill__writein__yourPython__career. Sometimes, though,more__flexibilityis__required.Suppose__youve__writtena__programto__usea__nameattribute__directly,but__thenyour__requirementschange__for example,you__decidethat__namesmust__bevalidated__ormutated__withprogram__logicwhen__accessed.It__sstraightforward__tocode__methodsto__manageaccess__tothe__attributes__value (validand__transformare__abstractand__hypothetical here):class__Person:def__getName(self):if__not valid():raise__TypeError('cannotfetch__name') else:return__self.name.transform()def__setName(self, value):if__not valid(value):raise__TypeError('cannotchange__name') else: self.name = transform(value)person__= Person() person.getName() person.setName('value')The__problemwith__thisis__thatit__alsorequires__changingall__theplaces__wherenames__areused__inthe__entireprogram__apossibly__nontrivial task. Moreover,this__approachrequires__theprogram__tobe__awareof__howvalues__are exported:as__simplenames__orcalled__methods.If__youbegin__witha__method-basedinterface__to data,clients__areimmune__to changes;if__youdo__not,changes__canbecome__problematic.This__issuecan__cropup__moreoften__thanyou__might expect.The__valueof__acell__ina__spreadsheet-like program,for__instance,might__beginits__lifeas__asimple__discretevalue__butlater__mutateinto__anarbitrary__calculation.Since__anobject__sinterface__shouldbe__flexibleenough__tosupport__suchfuture__changeswithout__breakingexisting__code,switching__tomethods__lateris__lessthan__ideal.Inserting__Codeto__Runon__AttributeAccess__Abetter__solutionwould__allowyou__torun__codeautomatically__onattribute__accessif__needed.That__sone__ofthe__mainroles__ofmanaged__attributesthey__provideways__toadd__attributeaccessor__logicafter__the fact.More__generally,they__supportarbitrary__attributeusage__modesthat__gobeyond__simpledata__storage.At__variouspoints__inthis__book,we__vemet__Pythontools__thatallow__ourscripts__todynamically__computeattribute__valueswhen__fetchingthem__andvalidate__orchange__attributevalues__whenstoring__them.In__this chapter,we__regoing__tofocus__moredeeply__onthe__toolsalready__introduced,explore__othertools__inthis__category,and__studysome__larger use-caseexamples__inthis__domain. Specifically,this__chapterpresents__fouraccessor__techniques: 1.The__property built-in,for__specifyingmethods__tohandle__accessto__aspecific__attribute 2.The____get__and____set__descriptor__methods,for__handlingaccess__toa__specificattribute__andthe__basisfor__othertools__suchas__propertiesand__slots 3.The____getattr__and____setattr__ methods,for__handlingundefined__attributefetches__andall__attributeassignments__4.The____getattribute__ method,for__handlingall__attributefetches__Wemet__thesetools__inChapters__30and__32 briefly,and__insome__cases,hardly__at all.As__youll__see here,all__fourtechniques__sharegoals__tosome__degree,and__its__usuallypossible__tocode__agiven__problemusing__anyone__of them.That__said,they__alsodiffer__insome__important ways.For__example,the__lasttwo__techniqueslisted__hereapply__tospecific__attributes,whereas__thefirst__twoare__genericenough__tobe__usedby__delegation-basedproxy__classesthat__mustroute__arbitraryattributes__towrapped__objects.As__youll__find,all__fourschemes__alsodiffer__inboth__complexityand__aestheticsin__waysyou__mustsee__inaction__tojudge__for yourself.Besides__studyingthe__specificsbehind__thesefour__attributeinterception__techniques,this__chapteralso__presentsan__opportunityto__exploreprograms__largerthan__mostwe__veseen__elsewherein__this book.The__CardHoldercase__studyat__the end,for__example,should__serveas__a self-studyexample__oflarger__classesin__action.We__llalso__beusing__someof__thetechniques__outlinedhere__inthe__nextchapter__tocode__decorators,so__besure__youhave__atleast__ageneral__understandingof__thesetopics__beforeyou__move on.Properties__Up first,the__propertyprotocol__allowsus__toroute__aspecific__attributes__get, set,and__deleteoperations__tofunctions__ormethods__we provide,enabling__usto__insertcode__tobe__runautomatically__onattribute__accesses,intercept__attribute deletions,and__providedocumentation__forattributes__if desired.As__introducedin__Chapter 32,properties__arecreated__withthe__property built-inand__areassigned__toclass__attributes,just__likemethod__functions. Accordingly,they__areinherited__bysubclasses__and instances,like__anyother__class attributes.Their__access-interceptionfunctions__areprovided__withthe__selfinstance__argument,which__grantsaccess__tostate__informationand__classattributes__availableon__thesubject__instance.A__propertymanages__a single,specific__attribute;although__itcan__tcatch__allattribute__accesses generically,it__allowsus__tocontrol__bothfetch__andassignment__accessesand__enablesus__tochange__anattribute__fromsimple__datato__acomputation__freelywithout__breakingexisting__code.As__youll__see,properties__arestrongly__relatedto__descriptors;in__fact,they__areessentially__arestricted__formof__them.The__BasicsA__propertyis__createdby__assigningthe__resultof__a built-infunction__toa__class attribute:attribute__= property(fget, fset, fdel, doc)None__ofthis__built-ins__argumentsare__required,and__alldefault__toNone__ifnot__passed.For__thefirst__three,this__Nonemeans__thatthe__correspondingoperation__isnot__supported,and__attemptingit__willraise__anAttributeError__exception automatically.When__thesearguments__are used,we__passfget__afunction__forintercepting__attribute fetches,fset__afunction__for assignments,and__fdela__functionfor__attribute deletions. Technically,all__threeof__thesearguments__acceptany__callable,including__aclass__s method,having__afirst__argumentto__receivethe__instancebeing__qualified.When__later invoked,the__fgetfunction__returnsthe__computedattribute__value,fset__andfdel__returnnothing__(really, None),and__allthree__mayraise__exceptionsto__rejectaccess__requests.The__docargument__receivesa__documentationstring__forthe__attributeif__desired.If__omitted,the__propertycopies__thedocstring__ofthe__fget function, which,as__usual,defaults__to None.This__built-inproperty__callreturns__aproperty__object,which__weassign__tothe__nameof__theattribute__tobe__managedin__theclass__scope,where__itwill__beinherited__byevery__instance.As__youll__learn ahead,this__assignmentcan__beautomated__by @decorator__syntax,though__itsdistributed__usagemay__seemawkward__forset__anddelete__methods.However__assigned,later__accessesto__theattribute__automaticallyinvoke__theproperty__s handlers.A__FirstExample__Todemonstrate__howthis__translatesto__working code,the__classin__Example 38-1uses__aproperty__totrace__accessto__anattribute__named name;the__actualstored__datais__named_name__soit__doesnot__clashwith__the property.Example__38-1. prop-person.pyclass__Person:def____init__(self, name): self._name =name__def getName(self): print('fetch...')return__self._namedef__setName(self, value): print('change...') self._name =value__def delName(self): print('remove...')del__self._namename__= property(getName, setName, delName, 'nameproperty__docs')sue__= Person('Sue Jones') #sue__hasa__managedattribute__print(sue.name) #Runs__getName sue.name = 'Susan Jones' #Runs__setName print(sue.name)del__sue.name #Runs__delName print('-'*20)bob__= Person('Bob Smith') #bob__inheritsproperty__too print(bob.name) print(Person.name.__doc__) #Or__help(Person.name)This__particularproperty__doesnt__domuch__itsimply__interceptsand__tracesan__attributebut__itserves__todemonstrate__the protocol.When__thiscode__is run,two__instancesinherit__the property,just__asthey__wouldany__otherattribute__attachedto__their class. However,accesses__totheir__nameattribute__arecaught__andmanaged__bythe__codewe__provide: $ python3 prop-person.py fetch...Sue__Jones change... fetch...Susan__Jones remove... -------------------- fetch...Bob__Smithname__propertydocs__Likeall__class attributes,properties__areinherited__byboth__instancesand__lower subclasses.If__wechange__ourexample__as follows,for__instance:class__Super:the__originalPerson__classcode__name = property(getName, setName, delName, 'nameproperty__docs')class__Person(Super):pass__#Properties__areinherited__(class attrs)sue__= Person('Sue Jones')rest__unchangedthe__outputis__thesame__thePerson__subclassinherits__thename__propertyfrom__Super,and__thesue__instancegets__itfrom__Person.In__termsof__inheritance,properties__workthe__sameas__normal methods;because__theyhave__accessto__theself__instance argument,they__canaccess__instancestate__informationand__methodsirrespective__ofsubclass__depth,as__thenext__sectionfurther__demonstrates.Computed__AttributesThe__examplein__theprior__sectionsimply__tracesattribute__accesses. Usually, though,properties__domuch__morecomputing__thevalue__ofan__attributedynamically__when fetched,for__instance,as__Example 38-2 illustrates.Example__38-2. prop-computed.pyclass__PropSquare:def____init__(self, start): self.value =start__def getX(self): #On__attrfetch__return self.value ** 2def__setX(self, value): #On__attrassign__self.value =value__X = property(getX, setX) #No__deleteor__docsP__= PropSquare(3) #Two__instancesof__classwith__propertyQ__= PropSquare(32) #Each__hasdifferent__stateinformation__print(P.X) # 3 ** 2 P.X = 4 print(P.X) # 4 ** 2 print(Q.X) # 32 ** 2 (1024)This__classdefines__anattribute__Xthat__isaccessed__asthough__itwere__simple data,but__reallyruns__codeto__computeits__valuewhen__fetched.The__neteffect__triggersan__implicitmethod__call.When__thecode__is run,the__valueis__storedin__theinstance__asstate__information,but__eachtime__wefetch__itvia__themanaged__attribute,its__valueis__automatically squared: $ python3 prop-computed.py 9 16 1024Notice__thatwe__vemade__twodifferent__instancesbecause__propertymethods__automaticallyreceive__aself__argument,they__haveaccess__tothe__stateinformation__storedin__instances.In__our case,this__meansthe__fetchcomputes__thesquare__ofthe__subjectinstance__sown__data.Coding__Propertieswith__DecoratorsAlthough__were__savingadditional__detailsuntil__thenext__chapter,we__introducedfunction__decoratorbasics__earlier,in__Chapter 32.Recall__thatthe__functiondecorator__syntax: @decoratordef__func(args):is__automaticallytranslated__tothis__equivalentby__Pythonto__rebindthe__functionname__tothe__resultof__thedecorator__callable:def__func(args):func__= decorator(func)Because__ofthis__mapping,the__property built-incan__automaticallyserve__asa__decoratorto__definea__functionthat__willrun__automaticallywhen__anattribute__is fetched:class__Person: @propertydef__name(self): ... # Rebinds:name__= property(name)When__run,the__decoratedmethod__isautomatically__passedto__thefirst__argumentof__theproperty__built-in.This__isreally__justalternative__syntaxfor__creatinga__propertyand__rebindingthe__attributename__manually,but__maybe__seenas__moreexplicit__inthis__role:class__Person:def__name(self):name__= property(name) #Manual__equivalentto__@propertySetter__anddeleter__decoratorsThe__precedingworks__naturallyfor__propertyget__functions,but__whatabout__other accesses?In__full detail,property__objectsalso__have getter, setter,and__deletermethods__thatassign__thecorresponding__propertyaccessor__methodsand__returna__copyof__theproperty__itself.We__canuse__theseto__specifycomponents__ofproperties__bydecorating__normal methods, too,though__thegetter__component (alongwith__attributes docs)is__usuallyfilled__inautomatically__bythe__actof__creatingthe__property itself.Example__38-3demos__the basics.Example__38-3. prop-person-deco.pyclass__Person:def____init__(self, name): self._name =name__@propertydef__name(self): #name__= property(name) 'nameproperty__docs' print('fetch...')return__self._name @name.setterdef__name(self, value): #name__= name.setter(name) print('change...') self._name =value__@name.deleterdef__name(self): #name__= name.deleter(name) print('remove...')del__self._namesue__= Person('Sue Jones') #sue__hasa__managedattribute__print(sue.name) #Runs__namegetter__(defname__1) sue.name = 'Susan Jones' #Runs__namesetter__(defname__2) print(sue.name)del__sue.name #Runs__namedeleter__(defname__3) print('-'*20)bob__= Person('Bob Smith') #bob__inheritsproperty__too print(bob.name) print(Person.name.__doc__) #Or__help(Person.name)In__fact,this__codeis__equivalentto__thefirst__examplein__thissection__decorationis__justan__alternativeway__tocode__propertiesin__this case.When__its__run,the__resultsare__the same: $ python3 prop-person-deco.py fetch...Sue__Jones change... fetch...Susan__Jones remove... -------------------- fetch...Bob__Smithname__propertydocs__Comparedto__manualassignment__ofproperty__results,using__decoratorsto__propertiesin__thisexample__requiresjust__threeextra__linesof__codea__seeminglynegligible__difference.As__isso__oftenthe__casewith__alternative tools, though,the__choicebetween__thetwo__techniquesis__largely subjective.Descriptors__Verybriefly__previewedin__Chapter 32,descriptors__providean__alternativeway__tointercept__attribute access;they__arestrongly__relatedto__theproperties__discussedin__theprior__section. Really,a__propertyis__akind__ofdescriptor__technically speaking,the__property built-inis__justa__simplifiedway__tocreate__aspecific__typeof__descriptorthat__runsmethod__functionson__attribute accesses.In__fact,descriptors__arethe__underlyingimplementation__mechanismfor__avariety__ofclass__tools,including__bothproperties__and slots,and__playother__internalroles__inPython__thatwe__cansafely__skip here.Functionally__speaking,the__descriptorprotocol__allowsus__toroute__aspecific__attributes__get, set,and__deleteoperations__tomethods__ofa__separateclass__sinstance__objectthat__we provide.This__allowsus__toinsert__codeto__berun__automaticallyon__attributefetches__and assignments,intercept__attribute deletions,and__providedocumentation__forthe__attributesif__desired.Descriptors__arecreated__asindependent__classes,and__theyare__assignedto__classattributes__justlike__method functions.Like__anyother__class attribute,they__areinherited__bysubclasses__and instances.Their__access-interceptionmethods__areprovided__withboth__aself__forthe__descriptorinstance__itselfas__wellas__theinstance__ofthe__clientclass__whoseattribute__referencesthe__descriptor object.Because__of this,they__canretain__anduse__stateinformation__oftheir__own,as__wellas__stateinformation__ofthe__subject instance.For__example,a__descriptormay__callmethods__availablein__theclient__class,as__wellas__descriptor-specificmethods__it defines.Like__a property,a__descriptormanages__a single,specific__attribute;although__itcan__tcatch__allattribute__accesses generically,it__providescontrol__overboth__fetchand__assignmentaccesses__andallows__usto__changean__attributename__freelyfrom__simpledata__toa__computationwithout__breakingexisting__code.If__thissounds__like properties,it__sbecause__it is:as__youshall__see,properties__canbe__codedas__descriptors directly.Unlike__properties, though,descriptors__providea__moregeneral__tool.For__instance,because__theyare__codedas__normal classes,descriptors__havetheir__own state,may__participatein__descriptorinheritance__hierarchies,can__usecomposition__toaggregate__objects,and__providea__naturalstructure__forcoding__internalmethods__andattribute__documentation strings.The__BasicsAs__mentioned,descriptors__arecoded__asseparate__classesand__providespecially__namedaccessor__methodsfor__theattribute__accessoperations__theywish__tointercept__get, set,and__deletionmethods__inthe__descriptorclass__areautomatically__runwhen__theattribute__assignedto__thedescriptor__classinstance__isaccessed__inthe__corresponding way:class__Descriptor: "docstringgoes__here"def____get__(self, instance, owner): #Return__attrvalue__def __set__(self, instance, value): #Return__nothing (None)def____delete__(self, instance): #Return__nothing (None)Classes__withany__ofthese__methodsare__considered descriptors,and__theirmethods__arespecial__whenone__oftheir__instancesis__assignedto__anotherclass__sattribute__whenthe__attributeis__accessed,these__methodsare__automatically invoked.If__anyof__thesemethods__are absent,it__generallymeans__thatthe__correspondingtype__ofaccess__isnot__supported.Unlike__properties, however,omitting__a__set____allowsthe__descriptorattribute__sname__tobe__assignedand__thusredefined__inan__instance,thereby__hidingthe__descriptorto__makean__attribute read-only,you__mustdefine____set__to__catchassignments__andraise__an exception.Descriptors__with__set____methodsalso__havesome__special-caseimplications__forinheritance__thatwe__lllargely__deferuntil__Chapter 40s__coverageof__metaclassesand__thecomplete__inheritance specification.In__short,a__descriptorwith__a__set____isknown__formallyas__adata__descriptorand__isgiven__precedenceover__othernames__locatedby__normalinheritance__rules.The__inheriteddescriptor__forattribute____class__,for__example,overrides__thesame__namein__aninstance__snamespace__dictionary.This__alsoworks__toensure__thatdata__descriptorsyou__codein__yourown__classestake__precedenceover__others.Descriptor__methodarguments__Beforewe__codeanything__realistic,let__stake__abrief__lookat__some fundamentals.All__threedescriptor__methodsoutlined__inthe__priorsection__arepassed__boththe__descriptorclass__instance (self)and__theinstance__ofthe__clientclass__towhich__thedescriptor__instanceis__attached (instance).The____get__access__methodadditionally__receivesan__owner argument,specifying__theclass__towhich__thedescriptor__instanceis__attached.Its__instanceargument__iseither__theinstance__throughwhich__theattribute__wasaccessed__(for instance.attr),or__Nonewhen__theattribute__isaccessed__throughthe__ownerclass__directly (for class.attr).The__formerof__thesegenerally__computesa__valuefor__instance access,and__thelatter__usuallyreturns__selfif__descriptorobject__accessis__supported.For__example,in__thefollowing__REPL session,when__X.attris__fetched,Python__automaticallyruns__the__get____methodof__theDescriptor__classinstance__towhich__the Subject.attrclass__attributeis__assigned: >>>class__Descriptor:def____get__(self, instance, owner): print(self, instance, owner, sep='\n') >>>class__Subject:attr__= Descriptor() #Descriptor__instanceis__classattr__>>>X__= Subject() >>> X.attr <__main__.Descriptorobject__at 0x104bc9b20> <__main__.Subjectobject__at 0x104b8a570> >>> Subject.attr <__main__.Descriptorobject__at 0x104bc9b20>None__Noticethe__argumentsautomatically__passedin__tothe____get__method__inthe__firstattribute__fetchwhen__X.attris__fetched,it__sas__thoughthe__followingtranslation__occurs (thoughthe__Subject.attrhere__doesnt__invoke__get____againas__itnormally__would): X.attr => Descriptor.__get__(Subject.attr, X, Subject)The__descriptorknows__itis__beingaccessed__directlywhen__itsinstance__argumentis__None. Read-onlydescriptors__Asmentioned__earlier,unlike__properties,simply__omittingthe____set__method__ina__descriptorisn__tenough__tomake__anattribute__read-onlybecause__thedescriptor__namecan__beassigned__inan__instance.In__the following,the__attributeassignment__to X.astores__ain__theinstance__object X,thereby__hidingthe__descriptorstored__inclass__C: >>>class__D:def____get__(*args): print('get') >>>class__C:a__= D() #Attribute__"a"is__adescriptor__instance >>>X__= C() >>> X.a #Runs__inheriteddescriptor____get__get__>>> C.aget__>>> X.a = 99 #Stored__on X,hiding__C.a! >>> X.a 99 >>> list(X.__dict__.keys()) ['a'] >>>Y__= C() >>> Y.a #Y__stillinherits__descriptorget__>>> C.aget__Thisis__theway__allinstance__attributeassignments__workin__Python,and__itallows__classesto__selectivelyoverride__class-leveldefaults__intheir__instances.To__makea__descriptor-basedattribute__read-only,catch__theassignment__inthe__descriptorclass__andraise__anexception__toprevent__attributeassignment__whenassigning__anattribute__thatis__a descriptor,Python__effectivelybypasses__thenormal__instance-level__assignmentbehavior__androutes__theoperation__tothe__descriptor object: >>>class__D:def____get__(*args): print('get')def____set__(*args):raise__AttributeError('cannot set') >>>class__C:a__= D() >>>X__= C() >>> X.a #Routed__to C.a.__get__get__>>> X.a = 99 #Routed__to C.a.__set__ AttributeError:cannot__setNOTE__Thedeletion__trio:Be__carefulnot__toconfuse__thedescriptor____delete__method__withthe__general__del____method.The__formeris__calledon__attemptsto__deletethe__managedattribute__nameon__aninstance__ofthe__owner class;the__latteris__thegeneral__instancedestructor__method,run__whenan__instanceof__anykind__ofclass__isabout__tobe__garbage-collected.Descriptor____delete__is__moreclosely__relatedto__the__delattr____genericattribute__deletionmethod__well__studylater__inthis__chapter.See__Chapter 30for__moreon__operator-overloadingmethods__like __del__.A__FirstExample__Tosee__howthis__allcomes__togetherin__morerealistic__code,let__sget__startedwith__thesame__firstexample__wewrote__for properties.Example__38-4defines__adescriptor__thatintercepts__accessto__anattribute__namedname__inits__clients.Its__methodsuse__theirinstance__argumentto__accessstate__informationin__thesubject__instance,where__thename__stringis__actually stored.Example__38-4. desc-person.pyclass__Name: 'namedescriptor__docs'def____get__(self, instance, owner): print('fetch...')return__instance._namedef____set__(self, instance, value): print('change...') instance._name =value__def __delete__(self, instance): print('remove...')del__instance._nameclass__Person:def____init__(self, name): self._name =name__name = Name() #Assign__descriptorto__attrsue__= Person('Sue Jones') #sue__hasa__managedattribute__print(sue.name) #Runs__Name.__get__ sue.name = 'Susan Jones' #Runs__Name.__set__ print(sue.name)del__sue.name #Runs__Name.__delete__ print('-'*20)bob__= Person('Bob Smith') #bob__inheritsdescriptor__too print(bob.name) print(Name.__doc__) #Or__help(Name)Notice__inthis__codehow__weassign__aninstance__ofour__descriptorclass__toa__classattribute__inthe__client class;because__of this,it__isinherited__byall__instancesof__the class,just__likea__classs__methods. Really,we__mustassign__thedescriptor__toa__classattribute__likethis__itwon__twork__ifassigned__toa__selfinstance__attribute instead.When__thedescriptor__s__get____methodis__run,it__ispassed__threeobjects__todefine__its context:self__isthe__Nameclass__instance.instance__isthe__Personclass__instance.owner__isthe__Person class.When__thiscode__is run,the__descriptors__methodsintercept__accessesto__the attribute,much__likethe__property version.In__fact,the__outputis__thesame__again: $ python3 desc-person.py fetch...Sue__Jones change... fetch...Susan__Jones remove... -------------------- fetch...Bob__Smithname__descriptordocs__Alsolike__inthe__property example,our__descriptorclass__instanceis__aclass__attributeand__thusis__inheritedby__allinstances__ofthe__clientclass__andany__subclasses.If__wechange__thePerson__classin__ourexample__tothe__following,for__instance,the__outputof__ourscript__isthe__same:class__Super:def____init__(self, name): self._name =name__name = Name()class__Person(Super): #Descriptors__areinherited__(class attrs)pass__Also,note__thatwhen__adescriptor__classis__notuseful__outsidethe__client class,it__sperfectly__reasonableto__embedthe__descriptors__definitioninside__itsclient__syntactically.Here__swhat__ourexample__lookslike__ifwe__usea__nested class:class__Person:def____init__(self, name): self._name =name__class Name: #Using__anested__class 'namedescriptor__docs'def____get__(self, instance, owner):same__def __set__(self, instance, value):same__def __delete__(self, instance):same__name = Name()When__codedthis__way,Name__becomesa__localvariable__inthe__scopeof__thePerson__class statement,such__thatit__wont__clashwith__anynames__outsidethe__class.This__versionworks__thesame__asthe__originalwe__vesimply__movedthe__descriptorclass__definitioninto__theclient__classs__scopebut__thelast__lineof__thetesting__codemust__changeto__fetchthe__docstringfrom__itsnew__location (perunlisted__file desc- person-nested.pyin__theexample__s package): print(Person.Name.__doc__) # Differs:not__Name.__doc__outside__classComputed__AttributesAs__wasthe__casewhen__using properties,our__firstdescriptor__exampleof__theprior__sectiondidn__tdo__muchit__simplyprinted__tracemessages__forattribute__accessesas__a demo.In__practice,descriptors__canalso__beused__tocompute__attributevalues__eachtime__theyare__fetched.Example__38-5illustrates__its__arehash__ofthe__sameexample__wecoded__forproperties__butuses__adescriptor__toautomatically__squarean__attributes__valueeach__timeit__is fetched.Example__38-5. desc-computed.pyclass__DescSquare:def____init__(self, start): #Each__deschas__ownstate__self.value =start__def __get__(self, instance, owner): #On__attrfetch__return self.value ** 2def____set__(self, instance, value): #On__attrassign__self.value =value__#No__deleteor__docsclass__Client1:X__= DescSquare(3) #Assign__descriptorinstance__toclass__attrclass__Client2:X__= DescSquare(32) #Another__instancein__anotherclient__class #Could__alsocode__twoinstances__insame__class c1 = Client1() c2 = Client2() print(c1.X) # 3 ** 2 c1.X = 4 print(c1.X) # 4 ** 2 print(c2.X) # 32 ** 2 (1024)When__run,the__outputof__thisexample__isthe__sameas__thatof__theoriginal__property-based__version,but__herea__descriptorclass__objectis__interceptingthe__attributeaccesses__insteadof__a property: $ python3 desc-computed.py 9 16 1024Using__StateInformation__inDescriptors__Ifyou__closelystudy__thetwo__descriptorexamples__weve__writtenso__far,you__mightnotice__thatthey__gettheir__informationfrom__differentplaces__thefirst__(thename__attribute example)uses__datastored__onthe__client instance,and__thesecond__(theattribute__squaring example)uses__dataattached__tothe__descriptorobject__itself (a.k.a. self).In__fact,descriptors__canuse__bothinstance__stateand__descriptor state,or__anycombination__thereof:Descriptor__stateis__usedto__manageeither__datainternal__tothe__workingsof__thedescriptor__ordata__thatspans__all instances.It__canvary__perattribute__appearance (oftenper__client class).Instance__staterecords__informationrelated__toand__possiblycreated__bythe__client class.It__canvary__per client-classinstance__(that is,per__application object).In__other words,descriptor__stateis__per-descriptor data,and__instancestate__is per- client-instance data.As__usualin__OOP,you__mustchoose__state carefully.For__example,you__wouldnot__normallyuse__descriptorstate__torecord__employeenames__sinceeach__clientinstance__requiresits__ownvalue__ifstored__inthe__descriptor,each__clientclass__instancewill__effectivelyshare__thesame__single copy.On__theother__hand,you__wouldnot__usuallyuse__instancestate__torecord__datapertaining__todescriptor__implementationinternals__ifstored__ineach__instance,there__wouldbe__multiplevarying__copies.Descriptor__methodsmay__useeither__state form,but__descriptorstate__sometimesmakes__itunnecessary__touse__specialnaming__conventionsto__avoidname__collisionsin__theinstance__fordata__thatis__notinstance__specific.For__example,the__descriptorin__Example 38-6attaches__informationto__itsown__instance,so__itdoesn__tclash__withthat__onthe__clientclass__sinstance__butalso__sharesthat__informationbetween__twoclient__instances.Example__38-6. desc-state-desc.pyclass__DescState: #Use__descriptorstate__def __init__(self, value): self.value =value__def __get__(self, instance, owner): #On__attrfetch__print('DescState get')return__self.value * 10def____set__(self, instance, value): #On__attrassign__print('DescState set') self.value =value__#Client__classclass__CalcAttrs:X__= DescState(2) #Descriptor__classattr__Y = 3 #Class__attrdef____init__(self): self.Z = 4 #Instance__attrobj__= CalcAttrs() print(obj.X, obj.Y, obj.Z) #X__is computed,others__arenot__obj.X = 5 #X__assignmentis__intercepted CalcAttrs.Y = 6 #Y__reassignedin__class obj.Z = 7 #Z__assignedin__instance print(obj.X, obj.Y, obj.Z) obj2 = CalcAttrs() #But__Xuses__shared data,like__Y! print(obj2.X, obj2.Y, obj2.Z)This__codes__internalvalue__informationlives__onlyin__the descriptor,so__therewon__tbe__acollision__ifthe__samename__isused__inthe__clients__instance.Notice__thatonly__thedescriptor__attributeis__managedhere__getand__setaccesses__toX__are intercepted,but__accessesto__Yand__Zare__not (Yis__attachedto__theclient__classand__Zto__the instance).When__thiscode__is run,X__iscomputed__when fetched,but__itsvalue__isalso__thesame__forall__clientinstances__becauseit__uses descriptor-level state: $ python3 desc-state-desc.pyDescState__get 20 3 4DescState__setDescState__get 50 6 7DescState__get 50 6 4It__salso__feasiblefor__adescriptor__tostore__oruse__anattribute__attachedto__theclient__classs__instanceinstead__of itself. Crucially,unlike__datastored__inthe__descriptor itself,this__allowsfor__datathat__canvary__perclient__class instance.The__descriptorin__Example 38-7assumes__theinstance__hasan__attribute_X__attachedby__theclient__classand__usesit__tocompute__thevalue__ofthe__attributeit__represents.Example__38-7. desc-state-inst.pyclass__InstState: #Using__instancestate__def __get__(self, instance, owner): print('InstState get') #Assume__setby__clientclass__return instance._X * 10def____set__(self, instance, value): print('InstState set') instance._X =value__#Client__classclass__CalcAttrs:X__= InstState() #Descriptor__classattr__Y = 3 #Class__attrdef____init__(self): self._X = 2 #Instance__attr self.Z = 4 #Instance__attrobj__= CalcAttrs() print(obj.X, obj.Y, obj.Z) #X__is computed,others__arenot__obj.X = 5 #X__assignmentis__intercepted CalcAttrs.Y = 6 #Y__reassignedin__class obj.Z = 7 #Z__assignedin__instance print(obj.X, obj.Y, obj.Z) obj2 = CalcAttrs() #But__Xdiffers__now,like__Z! print(obj2.X, obj2.Y, obj2.Z) Here,X__isassigned__toa__descriptoras__beforethat__manages accesses.The__newdescriptor__here, though,has__noinformation__itself,but__ituses__anattribute__assumedto__existin__theinstance__thatattribute__isnamed___X,to__avoidcollisions__withthe__nameof__thedescriptor__itself.When__thisversion__is run,the__resultsare__similar,but__thevalue__ofthe__descriptorattribute__canvary__perclient__instancedue__tothe__differingstate__policy: $ python3 desc-state-inst.pyInstState__get 20 3 4InstState__setInstState__get 50 6 7InstState__get 20 6 4Both__descriptorand__instancestate__have roles.In__fact,this__isa__generaladvantage__thatdescriptors__haveover__propertiesbecause__theyhave__stateof__their own,they__caneasily__retaindata__internallywithout__addingit__tothe__namespaceof__theclient__instance object.As__a summary,the__followinguses__bothstate__sourcesits__self.dataretains__per-attribute information,while__its instance.datacan__varyper__client instance: >>>class__DescBoth:def____init__(self, data): self.data =data__def __get__(self, instance, owner):return__f'{self.data}, {instance.data}'def____set__(self, instance, value): instance.data =value__>>>class__Client:def____init__(self, data): self.data =data__managed = DescBoth('hack') >>>I__= Client('code') >>> I.managed #Show__bothdata__sources 'hack, code' >>> I.managed = 'HACK' #Change__instancedata__>>> I.managed 'hack, HACK'We__llrevisit__theimplications__ofthis__choicein__acase__studylater__inthis__chapter.Before__wemove__on,recall__fromChapter__32s__coverageof__slotsthat__wecan__accessvirtual__attributeslike__propertiesand__descriptorswith__toolslike__dirand__getattr,even__thoughthey__dont__existin__theinstance__snamespace__dictionary.Whether__youshould__accessthese__thisway__probablyvaries__perprogram__propertiesand__descriptorsmay__runarbitrary__computationand__maybe__lessobviously__instancedata__than slots: >>> I.__dict__ {'data': 'HACK'} >>> [xfor__xin__dir(I)if__not x.startswith('__')] ['data', 'managed'] >>> getattr(I, 'data') 'HACK' >>> getattr(I, 'managed') 'hack, HACK' >>>for__attrin__(xfor__xin__dir(I)if__not x.startswith('__')): print(f'{attr} => {getattr(I, attr)}')data__=>HACK__managed => hack,HACK__Themore__generic__getattr____and__getattribute____toolswe__llexplore__soonare__notdesigned__tosupport__this functionality:because__theyhave__no class-level__attributes,their__virtualattribute__namesdo__notappear__indir__results (perChapter__31,a____dir__can__providea__dir result,but__its__optionaland__uncommon).In__exchange,they__arealso__notlimited__tospecific__attributenames__codedas__propertiesor__descriptorstools__thatshare__evenmore__thanthis__behavior,as__thenext__section explains.How__Propertiesand__DescriptorsRelate__Asmentioned__earlier,properties__anddescriptors__arestrongly__relatedthe__property built-inis__justa__convenientway__tocreate__a descriptor.Now__thatyou__knowhow__both work,you__shouldalso__beable__tosee__thatit__spossible__tosimulate__theproperty__built-inwith__adescriptor__class,as__demoedby__Example 38-8.Example__38-8. prop-desc-equiv.pyclass__Property:def____init__(self, fget=None, fset=None, fdel=None, doc=None): self.fget =fget__self.fset =fset__self.fdel =fdel__#Save__unboundmethods__self.__doc__ =doc__#or__othercallables__def __get__(self, instance, instancetype=None):if__instanceis__None:return__selfif__self.fgetis__None:raise__AttributeError("can'tget__attribute")return__self.fget(instance) #Pass__instanceto__self #in__propertyaccessors__def __set__(self, instance, value):if__self.fsetis__None:raise__AttributeError("can'tset__attribute") self.fset(instance, value)def____delete__(self, instance):if__self.fdelis__None:raise__AttributeError("can'tdelete__attribute") self.fdel(instance)class__Person:def__getName(self): print('getName...')def__setName(self, value): print('setName...')name__= Property(getName, setName) #Use__like property()x__= Person() x.name x.name = 'Pat'del__x.nameThis__Propertyclass__catchesattribute__accesseswith__thedescriptor__protocoland__routesrequests__tofunctions__ormethods__passedin__andsaved__indescriptor__statewhen__theclass__sinstance__is created.Attribute__fetches,for__example,are__routedfrom__thePerson__class,to__theProperty__classs____get__ method,and__backto__thePerson__classs__getName.With__descriptors,this__justworks__: $ python3 prop-desc-equiv.py getName... setName... AttributeError: can'tdelete__attributeNote__thatthis__descriptorclass__equivalentonly__handlesbasic__property usage, though;to__use @decorator__syntaxto__alsospecify__setand__delete operations,we__dhave__toextend__ourProperty__classwith__setterand__deleter methods,which__wouldsave__thedecorated__accessorfunction__andreturn__theproperty__object (selfshould__suffice).Since__theproperty__built-inalready__does this,we__llomit__aformal__codingof__thisextension__here.Descriptors__andslots__andmore__Youcan__alsoprobably__now,at__leastin__part,imagine__howdescriptors__areused__toimplement__Pythons__slots extension:instance__attributedictionaries__areavoided__bycreating__class-leveldescriptors__thatintercept__slotname__accessand__mapthose__namesto__sequentialstorage__spacein__the instance.Unlike__theexplicit__property call, though,much__ofthe__magicbehind__slotsis__orchestratedat__classcreation__timeboth__automaticallyand__implicitlywhen__a__slots____attributeis__presentin__a class.See__Chapter 32for__moreon__slotsand__whythey__renot__recommendedexcept__inpathological__use cases.Descriptors__arealso__usedfor__otherclass__tools,but__well__omitfurther__internalsdetails__here;see__Pythons__manualsand__itsopen__sourcecode__formore__details.NOTE__Descriptor cliff-hangers:In__Chapter 39,we__llalso__makeuse__ofdescriptors__toimplement__functiondecorators__thatapply__toboth__functionsand__methods.As__youll__see there,because__descriptorsreceive__bothdescriptor__andsubject__classinstances__theywork__wellin__this role,though__nestedfunctions__areoften__aconceptually__simpler solution.In__addition,Chapter__39deploys__descriptorsas__oneway__tointercept__built-inoperation__method fetches,and__Chapter 40formalizes__datadescriptors__precedencein__thefull__inheritancemodel__noted earlier:with__a __set__,descriptors__overrideother__namesand__arethus__fairlybinding__theycannot__behidden__bynames__ininstance__dictionaries.__getattr____and__getattribute____So far,we__vestudied__propertiesand__descriptorstools__formanaging__specific attributes.The____getattr__and____getattribute__ operator-overloadingmethods__providestill__otherways__tointercept__attributefetches__forclass__instances.Like__propertiesand__descriptors,they__allowus__toinsert__codeto__berun__automaticallywhen__attributesare__accessed.As__shown here, though,these__twomethods__canalso__beused__inmore__general ways.Because__theyintercept__arbitrary names,they__canapply__inbroader__roles,but__mayalso__incurextra__callsin__some contexts,and__aretoo__dynamicto__registerin__dirresults__without help.This__formof__attribute-fetchinterception__comesin__two flavors,coded__withtwo__different methods:__getattr____isrun__forundefined__attributesbecause__itis__runonly__forattributes__notstored__onan__instanceor__inheritedfrom__oneof__its classes,its__useis__straightforward.__getattribute____isrun__forevery__attributebecause__itis__all- inclusive,you__mustbe__cautiouswhen__usingthis__methodto__avoidrecursive__loopsby__passingattribute__accessesto__a superclass.We__metthe__firstof__thesein__Chapter 30.These__twomethods__arerepresentatives__ofa__setof__attributeinterception__methodsthat__alsoincludes____setattr__and____delattr__.Because__thesemethods__havesimilar__roles, though,we__willgenerally__treatthem__allas__asingle__topic here.Unlike__propertiesand__descriptors,these__methodsare__usuallyconsidered__partof__Pythons__operator-overloadingprotocol__speciallynamed__methodsof__a class,inherited__by subclasses,and__runautomatically__wheninstances__areused__inthe__associated built-inoperation__(here,attribute__fetch).Like__allnormal__methodsof__a class,they__eachreceive__afirst__selfargument__when called,giving__accessto__bothinstance__stateinformation__andother__methodsof__theirhosting__class.The____getattr__and____getattribute__methods__arealso__moregeneric__thanproperties__anddescriptors__theycan__beused__tointercept__accessto__any (oreven__all)instance__attribute fetches,not__justa__singlespecific__name.Because__of this,these__twomethods__arewell__suitedto__generaldelegation__codingpatterns__theycan__implementwrapper__(a.k.a. proxy)objects__thatmanage__allattribute__accessesfor__anembedded__object.By__contrast,we__mustdefine__oneproperty__ordescriptor__forevery__attributewe__wishto__intercept.As__covered ahead,this__delegationrole__islimited__somewhatfor__built-inoperations__butstill__appliesto__allnamed__methodsin__awrapped__objects__interface. Finally,these__twomethods__aremore__narrowlyfocused__thanthe__alternativeswe__considered earlier:they__interceptattribute__fetches only,not__assignments.To__alsocatch__attributechanges__by assignment,we__mustcode__a__setattr____methodan__operator-overloadingmethod__runfor__everyattribute__assignment,which__musttake__careto__avoidrecursive__loopsby__routingattribute__assignmentsthrough__theinstance__namespacedictionary__ora__superclass method.Although__less common,we__canalso__codea____delattr__overloading__method (whichmust__avoidlooping__inthe__same way)to__interceptattribute__deletions.By__contrast,properties__anddescriptors__catch get, set,and__deleteoperations__by design.__getattr____and__setattr____wereintroduced__inChapters__30and__32,and____getattribute__was__mentionedbriefly__inChapter__32. Here,we__llexpand__ontheir__usageand__studytheir__rolesin__larger contexts.The__BasicsIn__short,if__aclass__definesor__inheritsthe__following methods,they__willbe__runautomatically__whenan__instanceis__usedin__theoperation__describedby__thecomments__tothe__right:def____getattr__(self, name): #On__undefinedattribute__fetch [obj.name]def____getattribute__(self, name): #On__allattribute__fetch [obj.name]def____setattr__(self, name, value): #On__allattribute__assignment [obj.name=value]def____delattr__(self, name): #On__allattribute__deletion [del obj.name]In__these,self__isthe__subjectinstance__objectas__usual,name__isthe__stringname__ofthe__attributebeing__accessed,and__valueis__theobject__beingassigned__tothe__attribute.The__twoget__methodsnormally__returnan__attributes__value,and__theother__tworeturn__nothing (None).All__canraise__exceptionsto__signalprohibited__access.For__example,to__catchevery__attribute fetch,we__canuse__eitherof__thefirst__twoprevious__methods,and__tocatch__everyattribute__assignmentwe__canuse__the third.The__followinguses____getattr__for__fetches:class__Catcher:def____getattr__(self, name): print('Get:', name)def____setattr__(self, name, value): print('Set:', name, value)X__= Catcher() X.job #Prints__"Get: job" X.pay #Prints__"Get: pay" X.pay = 'bread' #Prints__"Set:pay__bread"Using____getattribute__works__exactlythe__samein__thisspecific__casebut__hassubtle__loopingpotential__whichwe__lltake__upin__thenext__section:class__Catcher: #On__allattribute__fetchesdef____getattribute__(self, name): #Works__sameas__getattrhere__print('Get:', name) #But__proneto__loopsin__generalrest__unchangedSuch__acoding__structurecan__beused__toimplement__thedelegation__designpattern__wemet__earlierin__Chapter 31.Because__allattributes__arerouted__tointerception__methods generically,we__canvalidate__andpass__themalong__to embedded,managed__objects.As__a refresher,the__following class,borrowed__fromChapter__31,traces__everyattribute__fetchmade__toanother__objectpassed__tothe__wrapper (proxy) class:class__Wrapper:def____init__(self, object): self.wrapped =object__#Save__objectdef____getattr__(self, attrname): print('Trace:', attrname) #Trace__fetchreturn__getattr(self.wrapped, attrname) #Delegate__fetchX__= Wrapper([1, 2, 3]) X.append(4) #Prints__"Trace: append" print(X.wrapped) #Prints__"[1, 2, 3, 4]"There__isno__suchanalog__forproperties__and descriptors,short__ofcoding__accessorsfor__everyattribute__presentin__everywrapped__object.On__theother__hand,when__suchgenerality__isnot__required,generic__accessormethods__mayincur__additionalcalls__forassignments__insome__contextsa__trade-offdescribed__inChapter__30and__mentionedin__thecontext__ofthe__casestudy__examplewe__llexplore__atthe__endof__this chapter.Avoiding__loopsin__attributeinterception__methodsThese__methodsare__generallystraightforward__to use.Their__mostcomplex__aspectis__thepotential__forlooping__(a.k.a. recursing).Because____getattr__is__calledfor__undefinedattributes__only,it__canfreely__fetchother__attributeswithin__itsown__code. However,because____getattribute__and____setattr__are__runfor__all attributes,their__codemust__becareful__whenaccessing__otherattributes__toavoid__callingthemselves__againand__triggeringa__recursive loop.For__example,another__attributefetch__runinside__a__getattribute____methods__codelike__thefollowing__willtrigger____getattribute__again__andthe__codewill__usuallyloop__untilmemory__is exhausted:def____getattribute__(self, name):x__= self.other # LOOPS! Technically,this__methodis__evenmore__loop-pronethan__thismay__implya__selfattribute__referencerun__anywherein__aclass__thatdefines__thismethod__willtrigger____getattribute__and__alsohas__thepotential__to loop,depending__onthe__classs__logic.This__isnormally__desiredbehavior__interceptingevery__attributefetch__isthis__methods__purpose,after__allbut__youshould__beaware__thatthis__methodcatches__allattribute__fetcheswherever__theyare__coded.When__codedwithin____getattribute__ itself,this__almostalways__causesa__loop.To__avoidthis__loop,route__thefetch__througha__highersuperclass__insteadto__skipthis__levels__versionbecause__theobject__classis__alwaysa__superclassto__every class,it__serveswell__inthis__role:def____getattribute__(self, name):x__= object.__getattribute__(self, 'other') #Force__higherto__avoidme__For __setattr__,the__situationis__similar,as__summarizedin__Chapter 30assigning__anyattribute__insidethis__methodtriggers____setattr__again__andmay__createa__similar loop:def____setattr__(self, name, value): self.other =value__#Recurs__(andmight__LOOP!)Here__too,self__attributeassignments__anywherein__aclass__definingthis__methodtrigger____setattr__as__well,though__thepotential__forlooping__ismuch__strongerwhen__theyshow__upin____setattr__ itself.To__workaround__this problem,you__canassign__theattribute__asa__keyin__theinstance__s__dict____namespacedictionary__instead.This__avoidsdirect__attribute assignment:def____setattr__(self, name, value): self.__dict__['other'] =value__#Use__attrdict__toavoid__me Alternatively,__setattr____canalso__passits__ownattribute__assignmentsto__ahigher__superclassto__avoid looping,just__like __getattribute__.In__fact,this__schemeis__sometimespreferred__whenwrapped__classesuse__slots, properties,or__othervirtual__attributesthat__liveon__classesinstead__ofinstances__andin__thecase__of slots,may__preclude __dict__:def____setattr__(self, name, value): object.__setattr__(self, 'other', value) #Force__higherto__avoidme__Thisbook__s__setattr____examplesoften__use__dict____forsmaller__demos anyhow,just__becausetheir__parametersare__known.By__contrast, though,we__cannotuse__the__dict____trickto__avoidloops__in __getattribute__:def____getattribute__(self, name):x__= self.__dict__['other'] # Loops!If__thisis__coded,fetching__the__dict____attributeitself__triggers__getattribute____againcausing__arecursive__loopand__animmediate__fail.Strange__but true!The____delattr__method__isless__commonlyused__in practice,but__whenit__is,it__iscalled__forevery__attribute deletion,just__as__setattr____iscalled__forevery__attribute assignment.When__usingthis__method,you__mustavoid__loopswhen__deletingattributes__bythe__same techniques:namespace__dictionariesoperations__orsuperclass__method calls.A__FirstExample__Genericattribute__managementis__notnearly__ascomplicated__asthe__priorsection__mayhave__implied.To__seehow__toput__theseideas__to work,Example__38-9is__thesame__firstexample__weused__forproperties__anddescriptors__inaction__again,this__timeimplemented__withattribute__operator-overloading methods.Because__thesemethods__areso__generic,we__testattribute__nameshere__toknow__whena__managedattribute__isbeing__accessed;others__areallowed__topass__normally.Example__38-9. getattr-person.pyclass__Person:def____init__(self, name): #On__[Person()] self._name =name__#Triggers____setattr__!def____getattr__(self, attr): #On__[obj.undefined] print('get: ' + attr)if__attr == 'name': #Intercept__name:not__storedreturn__self._name #Does__not loop:real__attr else: #Others__areerrors__raise AttributeError(attr)def____setattr__(self, attr, value): #On__[obj.any = value] print('set: ' + attr)if__attr == 'name':attr__= '_name' #Set__internalname__self.__dict__[attr] =value__#Avoid__loopinghere__def __delattr__(self, attr): #On__[del obj.any] print('del: ' + attr)if__attr == 'name':attr__= '_name' #Avoid__loopinghere__toodel__self.__dict__[attr] #but__muchless__commonsue__= Person('Sue Jones') #sue__hasa__managedattribute__print(sue.name) #Runs____getattr__ sue.name = 'Susan Jones' #Runs____setattr__ print(sue.name)del__sue.name #Runs____delattr__ print('-'*20)bob__= Person('Bob Smith') # bob'sattrs__worklike__sue's print(bob.name) #print(Person.name.__doc__) #No__directequivalent__here!When__thiscode__is run,the__samesort__ofoutput__is produced,but__thistime__itreflects__ourgeneric__attribute-interceptionmethods__respondingto__Pythons__normal operator-overloading mechanism: $ python3 getattr-person.py set:_name__get:name__SueJones__set:name__get:name__SusanJones__del:name__-------------------- set:_name__get:name__BobSmith__Noticehow__theattribute__assignmentin__the__init____constructortriggers____setattr__too__thismethod__catchesevery__instance-attribute assignment,even__thoseanywhere__withinthe__class itself,and__thoseto__underlyingattributes__like _name.Also__note that,unlike__withproperties__and descriptors,there__sno__directnotion__ofspecifying__documentationfor__ourattribute__here;managed__attributesexist__withinthe__codeof__ourinterception__methods,not__asdistinct__objects.Using____getattribute__To__achieveexactly__thesame__resultswith____getattribute__,replace____getattr__in__Example 38-9with__thediffering__codein__Example 38-10.Because__itcatches__allattribute__fetches,this__versionmust__becareful__toavoid__loopingby__passingnew__fetchesto__a superclass,and__itcan__tgenerally__assumeunknown__namesare__errors.Example__38-10. getattribute-person.py (differing part) #Replace__just__getattr____withthis__def __getattribute__(self, attr): #On__[obj.any] print('get: ' + attr)if__attr == 'name': #Intercept__allnames__attr = '_name' #Map__tointernal__namereturn__object.__getattribute__(self, attr) #Avoid__loopinghere__Whenrun__withthis__change,the__outputis__similar,but__weget__anextra____getattribute__call__forthe__fetchof____dict__in____setattr__ (thefirst__timeoriginating__in __init__): $ python3 getattribute-person.py set:_name__get:__dict____get:name__SueJones__set:name__get:__dict____get:name__SusanJones__del:name__get:__dict____-------------------- set:_name__get:__dict____get:name__BobSmith__Thisexample__isequivalent__tothat__codedfor__propertiesand__descriptors,but__its__abit__artificial,and__itdoesn__treally__highlightthese__tools assets.Because__theyare__generic,__getattr____and__getattribute____areprobably__morecommonly__usedin__delegation-basecode__(assketched__earlier),where__attributeaccess__isvalidated__androuted__toan__embedded object.Where__justa__singleattribute__mustbe__managed,properties__anddescriptors__mightdo__aswell__or better,and__avoidextra__callsfor__unmanaged attributes.Computed__AttributesAs__before,our__priorexample__doesnt__reallydo__anythingbut__traceattribute__fetches;it__snot__muchmore__workto__computean__attributes__valuewhen__fetched.As__forproperties__and descriptors,Example__38-11creates__avirtual__attributeX__thatruns__acalculation__when fetched.Example__38-11. getattr-computed.pyclass__AttrSquare:def____init__(self, start): self.value =start__#Triggers____setattr__!def____getattr__(self, attr): #On__undefinedattr__fetchif__attr == 'X':return__self.value ** 2 #value__isnot__undefined else:raise__AttributeError(attr)def____setattr__(self, attr, value): #On__allattr__assignmentsif__attr == 'X':attr__= 'value' self.__dict__[attr] =value__A = AttrSquare(3) # 2instances__ofclass__withoverloading__B = AttrSquare(32) #Each__hasdifferent__stateinformation__print(A.X) # 3 ** 2 A.X = 4 print(A.X) # 4 ** 2 print(B.X) # 32 ** 2 (1024)Running__thiscode__resultsin__thesame__outputthat__wegot__earlierwhen__usingproperties__and descriptors,but__thisscript__smechanics__arebased__ongeneric__attributeinterception__methods: $ python3 getattr-computed.py 9 16 1024Using____getattribute__As__before,we__canachieve__thesame__effectwith____getattribute__instead__of __getattr__.Example__38-12replaces__thefetch__methodwith__a__getattribute____andchanges__the__setattr____assignmentmethod__toavoid__loopingby__usingdirect__objectsuperclass__methodcalls__insteadof____dict__ keys.Example__38-12. getattribute-computed.pyclass__AttrSquare:def____init__(self, start): self.value =start__#Triggers____setattr__!def____getattribute__(self, attr): #On__allattr__fetchesif__attr == 'X':return__self.value ** 2 #Triggers____getattribute__ again! else:return__object.__getattribute__(self, attr)def____setattr__(self, attr, value): #On__allattr__assignmentsif__attr == 'X':attr__= 'value' object.__setattr__(self, attr, value) self-testcode__sameas__Example 38-11When__thisversion__is run,the__resultsare__thesame__againso__wewon__trelist__them here. Notice, though,the__implicitand__subtlerouting__goingon__insidethis__classs__methods: self.value=startinside__theconstructor__triggers __setattr__. self.valueinside____getattribute__triggers____getattribute__ again.In__fact,__getattribute____isrun__twiceeach__timewe__fetchattribute__X.This__doesnt__happenin__the__getattr____versionbecause__thevalue__attributeis__notundefined__(andhence__skipsthe__method).If__youcare__aboutspeed__andwant__toavoid__this,change____getattribute__to__usethe__superclassto__fetchvalue__as well:def____getattribute__(self, attr):if__attr == 'X':return__object.__getattribute__(self, 'value') ** 2Of__course,this__stillincurs__acall__tothe__superclassmethod__butnot__anadditional__recursivecall__beforewe__get there.If__thats__confusing,add__printcalls__tothese__methodsto__tracehow__andwhen__they run.__getattr____and__getattribute____ComparedTo__summarizethe__codingdifferences__between__getattr____and __getattribute__,Example__38-13uses__bothto__implementthree__attributes attr1is__aclass__attribute, attr2is__aninstance__attribute,and__attr3is__avirtual__managedattribute__computedwhen__fetched.Example__38-13. getattr-v-getattribute.pyclass__GetAttr: attr1 = 1def____init__(self): self.attr2 = 2def____getattr__(self, attr): #On__undefinedattrs__only print('get:', attr) #Not__on attr1:inherited__fromclass__ifattr__== 'attr3': #Not__on attr2:stored__oninstance__return 3 else:raise__AttributeError(attr)X__= GetAttr() print(X.attr1) print(X.attr2) print(X.attr3) print('-'*20)class__GetAttribute: attr1 = 1def____init__(self): self.attr2 = 2def____getattribute__(self, attr): #On__allattr__fetches print('get:', attr) #Use__superclassto__avoidlooping__hereif__attr == 'attr3':return__3 else:return__object.__getattribute__(self, attr)X__= GetAttribute() print(X.attr1) print(X.attr2) print(X.attr3)When__run,the____getattr__version__interceptsonly__attr3accesses__becauseit__is undefined.The____getattribute__ version,on__theother__hand,intercepts__allattribute__fetchesand__mustroute__thoseit__doesnot__manageto__thesuperclass__fetcherto__avoid loops: $ python3 getattr-v-getattribute.py 1 2 get: attr3 3 -------------------- get: attr1 1 get: attr2 2 get: attr3 3Although____getattribute__can__catchmore__attributefetches__than __getattr__,in__practicethey__areoften__justvariations__ona__themeif__attributesare__notphysically__stored,the__twohave__thesame__effect.Management__TechniquesCompared__Tosummarize__thecoding__differencesin__allfour__attribute-managementschemes__weve__just explored,let__squickly__stepthrough__asomewhat__morecomprehensive__computed-attributeexample__usingeach__technique.The__first version,Example__38-14,uses__propertiesto__interceptand__calculateattributes__namedsquare__and cube.Notice__howtheir__basevalues__arestored__innames__thatbegin__withan__underscoreso__theydon__tclash__withthe__namesof__theproperties__themselves.Example__38-14. all_four_props.py "Twodynamically__computedattributes__with properties"class__Powers:def____init__(self, square, cube): self._square =square__#_square__isthe__basevalue__self._cube =cube__#square__isthe__propertyname__def getSquare(self):return__self._square ** 2def__setSquare(self, value): self._square =value__square = property(getSquare, setSquare) #Or__@propertydecorator__def getCube(self):return__self._cube ** 3cube__= property(getCube) #Likewise__Todo__thesame__with descriptors,Example__38-15defines__theattributes__withcomplete__classes.Note__thatthese__descriptorsstore__basevalues__asinstance__state,so__theymust__useleading__underscoresagain__soas__notto__clashwith__thenames__of descriptors;as__calledout__bythe__finalexample__ofthis__chapter,we__couldavoid__thisrenaming__requirementby__storingbase__valuesas__descriptorstate__instead,but__thatdoesn__tas__directlyaddress__datathat__mustvary__per client-class instance.Example__38-15. all_four_desc.py "Same,but__withdescriptors__(per-instance state)"class__DescSquare:def____get__(self, instance, owner):return__instance._square ** 2def____set__(self, instance, value): instance._square =value__class DescCube:def____get__(self, instance, owner):return__instance._cube ** 3class__Powers:square__= DescSquare()cube__= DescCube()def____init__(self, square, cube): self._square =square__# "self.square = square"works__too, self._cube =cube__#because__ittriggers__desc __set__!To__achievethe__sameresult__with__getattr____fetch interception,Example__38-16again__storesbase__valueswith__underscore-prefixednames__sothat__accessesto__managednames__areundefined__andthus__invokeits__method;it__alsoneeds__tocode__a__setattr____tointercept__assignmentsand__takecare__toavoid__itspotential__for looping.Example__38-16. all_four_getattr.py "Same,but__withgeneric____getattr__ undefined-attribute interception"class__Powers:def____init__(self, square, cube): self._square =square__self._cube =cube__def __getattr__(self, name):if__name == 'square':return__self._square ** 2elif__name == 'cube':return__self._cube ** 3 else:raise__TypeError('unknown attr:' + name)def____setattr__(self, name, value):if__name == 'square': self.__dict__['_square'] =value__#Or__useobject__else: self.__dict__[name] =value__Thefinal__optionin__Example 38-17,coding__with __getattribute__,is__similarto__theprior__version.Because__itcatches__everyattribute__now, though,it__mustalso__routebase__valuefetches__toa__superclassto__avoidlooping__orextra__callsfetching__self._squaredirectly__works too,but__runsa__second__getattribute____call.Example__38-17. all_four_getattribute.py "Same,but__withgeneric____getattribute__ all-attribute interception"class__Powers:def____init__(self, square, cube): self._square =square__self._cube =cube__def __getattribute__(self, name):if__name == 'square':return__object.__getattribute__(self, '_square') ** 2elif__name == 'cube':return__object.__getattribute__(self, '_cube') ** 3 else:return__object.__getattribute__(self, name)def____setattr__(self, name, value):if__name == 'square': object.__setattr__(self, '_square', value) #Or__use__dict____else: object.__setattr__(self,name__, value)To__test,the__followingREPL__sessionloops__througha__listof__allfour__modulesname__stringsand__importsand__fetchesclasses__alongthe__way.Each__techniquetakes__adifferent__formin__code,but__allfour__producethe__sameresult__when run: >>>from__importlibimport__import_module >>>mods__= [f'all_four_{M}'for__Min__('props', 'desc', 'getattr', 'getattribute')] >>>for__modnamein__mods:module__= import_module(modname) #Import__byname__stringX__= module.Powers(3, 4) #This__module'sclass__(printto__see) print(X.square) # 3 ** 2 = 9 print(X.cube) # 4 ** 3 = 64 X.square = 5 print(X.square) # 5 ** 2 = 25 9 64 25repeated__fourtimes__Formore__onhow__thesealternatives__compare,and__othercoding__options,stay__tunedfor__amore__realisticapplication__ofthem__inthe__attribute-validationexample__ahead. First, though,we__needto__takea__shortside__tripto__studya__pitfallassociated__withtwo__ofthese__toolsthe__genericattribute__interceptors.Intercepting__Built-inOperation__AttributesIf__youve__beenreading__thisbook__linearly,some__ofthis__sectionis__elaborationon__earlier notes,especially__thesidebar__Delegating Built-insor__Not .When____getattr__and____getattribute__were__introduced here,it__wasstated__thatthey__intercept undefined-and__all-attribute fetches, respectively,which__makesthem__idealfor__delegation-basedcoding__patterns.While__thisis__truefor__bothnormally__namedand__explicitlyfetched__attributes,their__behaviorneeds__someadditional__clarification. Specifically,the__implicit method-name__fetchesof__built-inoperations__willnever__automaticallybe__routedto__eitherof__thesetwo__attribute-interceptor methods.This__meansthat__operator-overloadingmethod__callscannot__bedelegated__towrapped__objectsunless__wrapperclasses__somehowredefine__thesemethods__themselves.For__example,attribute__fetchesfor__the __str__, __add__,and____getitem__methods__runimplicitly__by printing, + expressions,and__indexing, respectively,are__notrouted__toeither____getattr__or____getattribute__. Instead,such__methodsare__lookedup__in classes,and__skipthe__instanceand__itsattribute__interceptors. Hence,there__isno__directway__togenerically__catchand__delegate built-inoperations__like these.This__wasa__Python 3.X bifurcation,whose__purportedrationale__involvedmetaclasses__andoptimization__of built-in operations.Whatever__its basis,all__attributesboth____X__and__otherare__stilldispatched__throughthe__instances__interceptormethods__whenaccessed__explicitlyby__name,so__thisqualifies__asa__glaring inconsistency: X.__add__runs____getattr__,but__X+Y,which__uses X.__add__,does__not.The__neteffect__complicates delegation-based code.The__goodnews__isthat__wrapperclasses__canwork__aroundthis__constraintby__redefining operator-overloadingmethods__inthe__wrapper itself,in__orderto__catchand__delegate calls.These__extramethods__canbe__addedeither__manually,with__tools,or__bydefinition__in,and__inheritance from,common__superclasses.It__smore__workfor__delegationclasses__when operator-overloadingmethods__arepart__ofa__wrappedobject__s interface,but__its__nota__showstopper.As__ademo__ofthe__issue,consider__thecode__inExample__38-18,which__testsvarious__attributetypes__and built-inoperations__oninstances__ofclasses__containing__getattr____and__getattribute____methods.Example__38-18. getattr-builtins.pyclass__GetAttr:cattr__= 88 #Attrs__storedon__classand__instancedef____init__(self): #These__skip getattr,but__notgetattribute__self.iattr = 77def____len__(self): #Redefine__for len(): doesn'trun__getattr print('__len__: 66')return__66def____getattr__(self, attr): #Provide____str__if__asked,else__dummyfunc__print('getattr:', attr) #Never__runfor____str__:inherited__fromobject__ifattr__== '__str__':return__lambda *args: '[Getattr str]' else:return__lambda *args:None__class GetAttribute:cattr__= 88 # Similar,but__catchall__attributesdef____init__(self): #Except__implicitfetches__for built-inops__self.iattr = 77def____len__(self): #Redefine__for len(): doesn'trun__getattribute print('__len__: 66') #But__explicitfetches__ofinherited____str__do__return 66def____getattribute__(self, attr): print('getattribute:', attr)if__attr == '__str__':return__lambda *args: '[GetAttribute str]' else:return__lambda *args:None__forClass__in GetAttr, GetAttribute: print('\n' + Class.__name__.ljust(50, '='))X__= Class() #Defined__attributestrigger__getattributebut__notgetattr__X.cattr #Class__attr (definedskips__getattr) X.iattr #Instance__attr (definedskips__getattr) X.other #Missing__attr len(X) #__len____defined explicitly:moot__# Built-inops__donot__invokeeither__getattror__getattribute #No__defaultsare__inheritedfor__thesefrom__objectsuperclass__try: X[0] #Tries__toinvoke____getitem__ except: print('fail []') try:X__+ 99 # Ditto,__add____except: print('fail +') try: X() # Ditto,__call____except: print('fail ()') #But__explicitcalls__invokeboth__catchers X.__getitem__(0) X.__add__(99) X.__call__() #The__impliedobject__superclassdefines__a__str____thatprecludes__getattr #But__theabsolute__getattributeis__notcalled__forimplicit__fetcheseither__print(X.__str__()) # __str__:explicit__call =>only____getattr__skipped__print(X) # __str__:implicit__via built-in =>both__skippedThis__fileruns__thesame__setof__testson__eachof__itsclasses__in turn.Match__itsfollowing__outputwith__itstests__andcomments__tosee__howit__works.In__short,neither____getattr__nor____getattribute__are__runfor__anyof__the operator-overloading__namesinvoked__by built-inoperations__becausesuch__namesare__lookedup__inclasses__only: $ python3 getattr-builtins.py GetAttr=========================================== getattr:other____len__: 66fail__[]fail__+fail__() getattr:__getitem____getattr:__add____getattr:__call____<__main__.GetAttrobject__at 0x10f76f020> <__main__.GetAttrobject__at 0x10f76f020> GetAttribute====================================== getattribute:cattr__getattribute:iattr__getattribute:other____len__: 66fail__[]fail__+fail__() getattribute:__getitem____getattribute:__add____getattribute:__call____getattribute:__str____[GetAttribute str] <__main__.GetAttributeobject__at 0x10f74c440>More__generally,all__explicit method-nameattribute__fetchesare__alwaysrouted__toboth__attribute-interception methods,but__noneof__theimplicit__operator-overloading__methodstrigger__either attribute-interceptionmethod__whentheir__attributesare__fetchedby__built-in operations.Salient__pointsin__thisdemo__worthcalling__out:__str____accessfails__tobe__caughttwice__by __getattr__:once__forthe__built-in print,and__oncefor__explicitfetches__becausea__defaultis__inheritedfrom__the built-inobject__impliedabove__everytopmost__class.__str____failsto__becaught__onlyonce__bythe____getattribute__catchall__duringthe__built-inprint__operation.Explicit__fetchesbypass__theinherited____str__and__run __getattribute__.__call____failsto__becaught__inboth__schemesfor__built-incall__expressions,but__itis__interceptedby__bothwhen__fetched explicitly;unlike____str__,there__isno__inherited__call____defaultin__objectto__defeat__getattr____inexplicit__fetches.The__samegoes__forthe____add__of__+ operations.__len____ishandled__byboth__classesbecause__itis__anexplicitly__definedmethod__inthe__classesthemselves__thoughits__nameis__notrouted__toeither____getattr__or____getattribute__if__wedelete__theclasses____len__methods__becausethe__len built-inskips__themas__usual. Again,the__neteffect__isthat__operator-overloadingmethods__implicitlyrun__by built-in__operationsare__neverrouted__througheither__attributeinterception__method.Python__beginsthe__searchfor__suchattributes__inclasses__andskips__instancelookup__mechanisms entirely. Normally,named__attributesand__explicitfetches__startwith__theinstance__instead.For__amore__realisticexample__ofthis__phenomenons__impacton__delegation classes,stay__tunedfor__Chapter 39s__Privatedecorator__alongwith__itscoverage__ofmultiple__reusable workarounds.Revisiting__Chapter 28s__delegationexample__Asa__coda,you__shouldalso__nowbe__ableto__workout__whythe__Managerclass__codedin__Example 28-11of__Chapter 28had__tocode__a__repr____toroute__printingrequests__toits__wrapped object.Just__like__str____inour__demo,object__providesa__default __repr__,which__wouldprevent__printoperations__frominvoking__a __getattr__.Technically__speaking,object__definesboth____str__and____repr__,but__its__str____simplycalls____repr__.That__said,object__sdefaults__arelargely__amoot__point:like__all built-in operations,print__bypassesboth____getattr__and____getattribute__,as__itdid__for__getattribute____inour__demo. Hence,a____repr__is__requiredby__boththe__objectdefault__andthe__built-ins__behavior. Again,fixes__fordelegating__built-insare__inChapter__39 (unlesswe__runout__ofunderscores__before that!). Example:Attribute__ValidationsTo__closeout__this chapter,let__sturn__toa__morerealistic__example,coded__inall__fourof__ourattribute__management schemes.The__examplewe__willuse__definesa__CardHolderobject__withfour__attributes,three__ofwhich__are managed.The__managedattributes__validateor__transformvalues__whenfetched__or stored.All__fourversions__producethe__sameresults__forthe__sametest__code,but__theyimplement__theirattributes__invery__different ways.The__examplesare__largelyfor__self-study;although__wewon__tgo__throughtheir__codein__detail,they__alluse__conceptswe__vealready__exploredin__this chapter.Using__Propertiesto__ValidateOur__firstcoding__inExample__38-19uses__propertiesto__managethree__attributes.As__usual,we__coulduse__simplemethods__insteadof__managed attributes,but__propertieshelp__ifwe__havealready__beenusing__attributesin__existing code.Properties__runcode__automaticallyon__attributeaccess__butare__focusedon__aspecific__setof__attributes;they__cannotbe__usedto__interceptall__attributes generically.To__understandthis__code,it__scrucial__tonotice__thatthe__attributeassignments__insidethe____init__constructor__methodtrigger__propertysetter__methods too.When__thismethod__assignsto__self.name,for__example,it__automaticallyinvokes__thesetName__method,which__transformsthe__valueand__assignsit__toan__instanceattribute__called__name__soit__wont__clashwith__theproperty__s name.This__renaming,sometimes__calledname__mangling,is__importantbecause__propertiesuse__commoninstance__stateand__havenone__oftheir__own.Data__isstored__inan__attributecalled____name,and__theattribute__calledname__isalways__a property,not__data.As__wesaw__inChapter__31,names__like__name__areknown__aspseudoprivate__attributesand__arechanged__byPython__toinclude__theenclosing__classs__namewhen__storedin__theinstance__s namespace; here,this__helpskeep__the implementation-specificattributes__distinctfrom__others,including__thatof__theproperty__thatmanages__them.In__the end,this__classmanages__attributescalled__name, age,and__acct;allows__theattribute__addrto__beaccessed__directly;and__providesa__read-onlyattribute__calledremain__thatis__entirelyvirtual__andcomputed__on demand.For__comparison purposes,this__property-basedcoding__weighsin__at 39lines__ofcode__(includingblank__lines).Example__38-19. validate_properties.pyclass__CardHolder:acctlen__= 8 #Class__dataretireage__= 62.5def____init__(self, acct, name, age, addr): self.acct =acct__#Instance__data self.name =name__#These__triggerprop__setters too! self.age =age__#__X__mangledto__haveclass__name self.addr =addr__#addr__isnot__managed #remain__hasno__datadef__getName(self):return__self.__namedef__setName(self, value):value__= value.lower().replace(' ', '_') self.__name =value__name = property(getName, setName) #Or__@decorators__forboth__def getAge(self):return__self.__agedef__setAge(self, value):if__value < 0or__value > 150:raise__ValueError('invalid age') else: self.__age =value__age = property(getAge, setAge)def__getAcct(self):return__self.__acct[:-3] + '***'def__setAcct(self, value):value__= value.replace('-', '')if__len(value) != self.acctlen:raise__TypeError('invalidacct__number') else: self.__acct =value__acct = property(getAcct, setAcct)def__remainGet(self): #Could__bea__method,not__attrreturn__self.retireage - self.age #Unless__alreadyusing__asattr__remain = property(remainGet)Testing__codeTo__testour__class,run__thescript__inExample__38-20in__aconsole__withthe__nameof__theclass__smodule__(sans .py )as__asingle__command-lineargument__(youcould__alsoimport__theclass__ina__REPL,but__were__tryingto__avoidrepeating__code here).We__lluse__thissame__testscript__forall__fourversions__ofthis__exampleso__theiroutput__willbe__the same.When__it runs,it__makestwo__instancesof__our managed-attributeclass__andfetches__andchanges__theirvarious__attributes.Operations__expectedto__failare__wrappedin__try statements.Example__38-20. validate_tester.pydef__loadclass():import__sys,importlib__modulename = sys.argv[1] #Module__namein__commandline__module = importlib.import_module(modulename) #Import__moduleby__namestring__print(f'[Using: {module.CardHolder}]') #No__needfor__getattr()here__return module.CardHolderdef__printholder(who): print(who.acct, who.name, who.age, who.remain, who.addr, sep=' / ')if____name__ == '__main__':CardHolder__= loadclass()bob__= CardHolder('1234-5678', 'Bob Smith', 40, '123main__st') printholder(bob) bob.name = 'Bob Q. Smith' bob.age = 50 bob.acct = '23-45-67-89' printholder(bob)sue__= CardHolder('5678-12-34', 'Sue Jones', 35, '124main__st') printholder(sue) try: sue.age = 200 except: print('Badage__for Sue') try: sue.remain = 5 except: print("Can'tset__sue.remain") try: sue.acct = '1234567' except: print('Badacct__for Sue')Following__isthe__outputof__ourtest__scripts__code; again,this__isthe__samefor__theother__versionsof__thisexample__ahead,except__forthe__testedclass__s name.Trace__throughthis__codeto__seehow__theclass__smethods__are invoked.Accounts__aredisplayed__withsome__digits hidden,names__areconverted__toa__standard format,and__timeremaining__untilretirement__(hypothetically speaking)is__computedwhen__fetchedusing__a class-attribute cutoff: $ python3 validate_tester.pyvalidate_properties__[Using: ] 12345*** /bob_smith__/ 40 / 22.5 / 123main__st 23456*** / bob_q._smith / 50 / 12.5 / 123main__st 56781*** /sue_jones__/ 35 / 27.5 / 124main__stBad__agefor__Sue Can'tset__sue.remainBad__acctfor__SueUsing__Descriptorsto__Validate Now,let__srecode__ourexample__usingdescriptors__insteadof__properties.As__weve__seen,descriptors__arevery__similarto__propertiesin__termsof__functionalityand__roles;in__fact,properties__arebasically__afocused__formof__descriptor.Like__properties,descriptors__aredesigned__tohandle__specific attributes,not__genericattribute__access.Unlike__properties,descriptors__canalso__havetheir__own state,and__soare__perhapsa__moregeneral__scheme.Option__1:Validating__withshared__descriptor-instancestate__(badly!)To__understandthe__codein__Example 38-21,it__sagain__importantto__noticethat__theattribute__assignmentsinside__the__init____constructormethod__triggerdescriptor____set__ methods.When__theconstructor__methodassigns__to self.name,for__example,it__automaticallyinvokes__the Name.__set__() method,which__transformsthe__valueand__assignsit__toa__descriptorattribute__called name.In__the end,this__classimplements__thesame__attributesas__theprior__version:it__managesattributes__called name, age,and__acct;allows__theattribute__addrto__beaccessed__directly;and__providesa__read-onlyattribute__calledremain__thatis__entirelyvirtual__andcomputed__on demand.Notice__howwe__mustcatch__assignmentsto__theremain__namein__itsdescriptor__andraise__an exception;as__welearned__earlier,if__wedid__notdo__this,assigning__tothis__attributeof__aninstance__wouldsilently__createan__instanceattribute__thathides__the class-attribute descriptor.For__comparison purposes,this__descriptor-basedcoding__takes 45lines__of code.Example__38-21. validate_descriptors1.pyclass__CardHolder: #Using__shareddescriptor__stateacctlen__= 8 #Class__dataretireage__= 62.5def____init__(self, acct, name, age, addr): self.acct =acct__#Instance__data self.name =name__#These__trigger__set____calls too! self.age =age__#__X__not needed:in__descriptor self.addr =addr__#addr__isnot__managed #remain__hasno__dataclass__Name:def____get__(self, instance, owner): #Class__names:CardHolder__localsreturn__self.namedef____set__(self, instance, value):value__= value.lower().replace(' ', '_') self.name =value__name = Name()class__Age:def____get__(self, instance, owner):return__self.age #Use__descriptordata__def __set__(self, instance, value):if__value < 0or__value > 150:raise__ValueError('invalid age') else: self.age =value__age = Age()class__Acct:def____get__(self, instance, owner):return__self.acct[:-3] + '***'def____set__(self, instance, value):value__= value.replace('-', '')if__len(value) != instance.acctlen: #Use__instanceclass__dataraise__TypeError('invalidacct__number') else: self.acct =value__acct = Acct()class__Remain:def____get__(self, instance, owner):return__instance.retireage - instance.age #Triggers__Age.__get__def____set__(self, instance, value):raise__TypeError('cannotset__remain') #Else__setallowed__hereremain__= Remain()When__runwith__theprior__testing script,all__examplesin__thissection__producethe__sameoutput__asshown__forproperties__earlier,except__thatthe__nameof__theclass__inthe__firstline__varies: $ python3 validate_tester.py validate_descriptors1 [Using: ]rest__issame__outputas__propertiesOption__2:Validating__with per-client-instancestate__(correctly)Unlike__inthe__prior property-based variant, though,in__Example 38-21,the__actualname__valueis__attachedto__thedescriptor__object,not__theclient__class instance.Although__wecould__storethis__valuein__eitherinstance__ordescriptor__state,the__latteravoids__theneed__tomangle__nameswith__underscoresto__avoid collisions.In__theCardHolder__client class,the__attributecalled__nameis__alwaysa__descriptor object,not__data. Importantly,the__downsideof__thisscheme__isthat__statestored__insidea__descriptoritself__is class-leveldata__thatis__effectivelyshared__byall__client-classinstances__andso__cannotvary__between them.That__is,storing__statein__thedescriptor__instanceinstead__ofthe__owner (client)class__instancemeans__thatthe__statewill__bethe__samein__all owner-class instances.Descriptor__statecan__varyonly__perattribute__appearance.To__seethis__at work,try__printingattributes__ofthe__bobinstance__aftercreating__thesecond__instance, sue,with__thenew__testscript__inExample__38-22.The__valuesof__sues__managedattributes__(name, age,and__acct)overwrite__thoseof__theearlier__object bob,because__bothshare__the same,single__descriptorinstance__attachedto__their class.Example__38-22. validate_tester_plus.pyfrom__validate_testerimport__loadclassCardHolder__= loadclass()bob__= CardHolder('1234-5678', 'Bob Smith', 40, '123main__st') print('bob:', bob.name, bob.acct, bob.age, bob.addr)sue__= CardHolder('5678-12-34', 'Sue Jones', 35, '124main__st') print('sue:', sue.name, sue.acct, sue.age, sue.addr) #addr__differs:client__data print('bob:', bob.name, bob.acct, bob.age, bob.addr) # name,acct,age overwritten?When__thisscript__isrun__withthe__descriptor-stateCardHolder__ofExample__38-21,the__resultsconfirm__thesuspicion__interms__ofmanaged__attributes,bob__hasmorphed__into sue! $ python3 validate_tester_plus.py validate_descriptors1 [Using: ] bob:bob_smith__12345*** 40 123main__st sue:sue_jones__56781*** 35 124main__st bob:sue_jones__56781*** 35 123main__stThis__isnt__anissue__forproperties__becausethey__haveno__stateof__their own,and__thereare__validuses__fordescriptor__state.Such__statemight__be used,for__example,to__managedescriptor__implementationand__datathat__spansall__instances,and__thisexample__wascoded__thisway__onpurpose__toillustrate__the technique. Moreover,the__statescope__implicationsof__classversus__instanceattributes__shouldbe__moreor__lessa__givenat__thispoint__inthe__book. However,in__thisparticular__use case,attributes__ofCardHolder__objectsare__probablybetter__storedas__per-instancedata__insteadof__descriptor-instance data,perhaps__usingthe__same__X__namingconvention__asthe__property-basedequivalent__toavoid__nameclashes__inthe__instancea__moreimportant__factorthis__time,as__theclient__isa__differentclass__withits__ownstate__attributes.Example__38-23has__therequired__changes;it__doesnt__changeline__counts (were__stillat__45).Example__38-23. validate_descriptors2.pyclass__CardHolder: #Using__per-client-instancestate__acctlen = 8 #Class__dataretireage__= 62.5def____init__(self, acct, name, age, addr): self.acct =acct__#Client__instancedata__self.name =name__#These__trigger__set____calls too! self.age =age__#__X__needed:in__clientinstance__self.addr =addr__#addr__isnot__managed #remain__managedbut__hasno__dataclass__Name:def____get__(self, instance, owner): #Class__names:CardHolder__localsreturn__instance.__namedef____set__(self, instance, value):value__= value.lower().replace(' ', '_') instance.__name =value__name = Name() # class.namevs__mangledattr__class Age:def____get__(self, instance, owner):return__instance.__age #Use__*instance*data__def __set__(self, instance, value):if__value < 0or__value > 150:raise__ValueError('invalid age') else: instance.__age =value__age = Age() # class.agevs__mangledattr__class Acct:def____get__(self, instance, owner):return__instance.__acct[:-3] + '***'def____set__(self, instance, value):value__= value.replace('-', '')if__len(value) != instance.acctlen: #Use__instanceclass__dataraise__TypeError('invalidacct__number') else: instance.__acct =value__acct = Acct() # class.acctvs__mangledname__class Remain:def____get__(self, instance, owner):return__instance.retireage - instance.age #Triggers__Age.__get__def____set__(self, instance, value):raise__TypeError('cannotset__remain') #Else__setallowed__hereremain__= Remain()This__supports per-instancedata__forthe__name, age,and__acctmanaged__fieldsas__expected (bobremains__bob),and__othertests__workas__before: $ python3 validate_tester_plus.py validate_descriptors2 [Using: ] bob:bob_smith__12345*** 40 123main__st sue:sue_jones__56781*** 35 124main__st bob:bob_smith__12345*** 40 123main__st $ python3 validate_tester.py validate_descriptors2same__outputas__properties,except__classname__Onesmall__caveat here:as__coded,this__versiondoesn__tsupport__through-classdescriptor__accessbecause__suchaccess__passesa__Noneto__theinstance__argument (alsonotice__theattribute____Xname__manglingto___Name__namein__theerror__messagewhen__thefetch__attemptis__made): >>>from__validate_descriptors1import__CardHolder >>>pat__= CardHolder('1234-5678', 'Pat Smith', 40, '123main__st') >>> pat.name 'pat_smith' >>> CardHolder.name 'pat_smith' >>>from__validate_descriptors2import__CardHolder >>>pat__= CardHolder('1234-5678', 'Pat Smith', 40, '123main__st') >>> pat.name 'pat_smith' >>> CardHolder.name AttributeError: 'NoneType'object__hasno__attribute '_Name__name'We__coulddetect__thiswith__aminor__amountof__additionalcode__totrigger__theerror__more explicitly,but__theres__probablyno__pointbecause__thisversion__storesdata__inthe__client instance,there__sno__meaningto__itsdescriptors__unlessthey__reaccompanied__bya__clientinstance__(muchlike__anormal__nonboundinstance__method).In__fact,that__sreally__theentire__pointof__thisversion__s change!Because__theyare__classes,descriptors__area__usefuland__powerful tool,but__theypresent__choicesthat__candeeply__impacta__programs__behavior.As__alwaysin__OOP,choose__yourstate__retentionpolicies__carefully.Using____getattr__to__ValidateAs__weve__seen,the____getattr__method__interceptsall__undefined attributes,so__itcan__bemore__genericthan__usingproperties__or descriptors.For__our example,we__simplytest__theattribute__nameto__knowwhen__amanaged__attributeis__being fetched;others__arestored__physicallyon__theinstance__andso__neverreach____getattr__.Although__thisapproach__ismore__generalthan__usingproperties__or descriptors,extra__workmay__berequired__toimitate__thespecific__attributefocus__ofother__tools.We__needto__checknames__atruntime__a multiple-choicethat__sa__primerole__forthe__matchstatement__andwe__mustcode__a__setattr____inorder__tointercept__andvalidate__attribute assignments.Example__38-24hosts__the__getattr____versionof__ourvalidations__code.In__the end,this__class,like__theprior__two,manages__attributescalled__name, age,and__acct;allows__theattribute__addrto__beaccessed__directly;and__providesa__read-onlyattribute__calledremain__thatis__entirelyvirtual__andis__computedon__demand.As__forthe__propertyand__descriptorversions__ofthis__example,it__scritical__tonotice__thatthe__attributeassignments__insidethe____init__constructor__methodtrigger__theclass__s__setattr____method too.When__thismethod__assignsto__self.name,for__example,it__automaticallyinvokes__the__setattr____method,which__transformsthe__valueand__assignsit__toan__instanceattribute__called name.By__storingname__onthe__instance,it__ensuresthat__futureaccesses__willnot__trigger __getattr__.In__contrast,acct__isstored__as_acct__sothat__lateraccesses__toacct__doinvoke____getattr__.For__comparison purposes,this__alternativecomes__inat__34lines__ofcode__5fewer__thanthe__property-basedversion__and 11fewer__thanthe__versionusing__descriptors (thoughreplacing__ifwith__matchhere__addedtwo__lines,along__withextra__indentation).Clarity__mattersmore__thancode__size,of__course,but__extracode__canimply__extradevelopment__andmaintenance__work.Probably__moreimportant__hereare__roles:generic__toolslike____getattr__are__bettersuited__togeneric__delegation,while__propertiesand__descriptorsare__designedto__managespecific__attributes.Also__noteagain__thatthe__codehere__incursextra__callswhen__settingunmanaged__attributes (e.g., addr),although__noextra__callsare__incurredfor__fetchingunmanaged__attributessince__theyare__defined.Though__thiswill__likelyresult__innegligible__overheadfor__most programs,the__morenarrowly__focusedproperties__anddescriptors__incuran__extracall__onlywhen__managedattributes__are accessed,and__alsoappear__indir__resultsautomatically__whenneeded__bygeneric__tools.Example__38-24. validate_getattr.pyclass__CardHolder:acctlen__= 8 #Class__dataretireage__= 62.5def____init__(self, acct, name, age, addr): self.acct =acct__#Instance__data self.name =name__#These__trigger__setattr____too self.age =age__#_acct__not mangled:name__tested self.addr =addr__#addr__isnot__managed #remain__hasno__datadef____getattr__(self, name):match__name:case__'acct': #On__undefinedattr__fetchesreturn__self._acct[:-3] + '***' # name, age,addr__aredefined__case 'remain':return__self.retireage - self.age # Doesn'ttrigger____getattr__case___:raise__AttributeError(name)def____setattr__(self, name, value):match__name:case__'name': #On__allattr__assignmentsvalue__= value.lower().replace(' ', '_') #addr__storeddirectly__case 'age': #acct__mangledto___acctif__value < 0or__value > 150:raise__ValueError('invalid age')case__'acct':name__= '_acct'value__= value.replace('-', '')if__len(value) != self.acctlen:raise__TypeError('invalidacct__number')case__'remain':raise__TypeError('cannotset__remain') self.__dict__[name] =value__#Avoid__looping (or object)When__thiscode__isrun__witheither__test script,it__producesthe__sameoutput__(witha__differentclass__name): $ python3 validate_tester.pyvalidate_getattr__sameoutput__as properties,except__classname__$ python3 validate_tester_plus.pyvalidate_getattr__sameoutput__as instance-state descriptors,except__classname__Using__getattribute____toValidate__Ourfinal__variantuses__the__getattribute____catchallto__interceptattribute__fetchesand__managethem__as needed.Every__attributefetch__iscaught__here,so__wetest__theattribute__namesto__detectmanaged__attributesand__routeall__othersto__thesuperclass__fornormal__fetch processing.This__versionuses__thesame____setattr__to__catchassignments__asthe__priorversion__(thereis__nocorresponding____setattribute__in__Pythonso__far?).Example__38-25codes__thislast__mod.It__worksvery__muchlike__the__getattr____version,so__wewon__trepeat__thefull__description here. Note, though,that__becauseevery__attributefetch__isrouted__to __getattribute__,we__dont__needto__manglenames__tointercept__themhere__(acctis__storedas__acct).On__theother__hand,this__codemust__takecare__toroute__nonmanagedattribute__fetchesto__asuperclass__toavoid__loopingor__extra calls. Also,notice__thatthis__versionincurs__extracalls__forboth__settingand__fetchingunmanaged__attributes (e.g., addr);if__speedis__paramount,this__alternativemay__bethe__slowestof__the bunch.For__comparison purposes,this__versionamounts__to 34lines__of code,just__likethe__priorversion__(andagain__including 2lines__addedby__match).Example__38-25. validate_getattribute.pyclass__CardHolder:acctlen__= 8 #Class__dataretireage__= 62.5def____init__(self, acct, name, age, addr): self.acct =acct__#Instance__data self.name =name__#These__trigger__setattr____too self.age =age__#acct__not mangled:name__tested self.addr =addr__#addr__isnot__managed #remain__hasno__datadef____getattribute__(self, name):superget__= object.__getattribute__ # Don't loop:level__upmatch__name:case__'acct': #On__allattr__fetchesreturn__superget(self, 'acct')[:-3] + '***'case__'remain':return__superget(self, 'retireage') - superget(self, 'age')case___:return__superget(self, name) # name, age, addr:stored__def __setattr__(self, name, value):match__name:case__'name': #On__allattr__assignmentsvalue__= value.lower().replace(' ', '_') #addr__storeddirectly__case 'age':if__value < 0or__value > 150:raise__ValueError('invalid age')case__'acct':value__= value.replace('-', '')if__len(value) != self.acctlen:raise__TypeError('invalidacct__number')case__'remain':raise__TypeError('cannotset__remain') self.__dict__[name] =value__#Avoid__loop,orig__namesBoth__the__getattr____and__getattribute____scriptswork__thesame__asthe__propertyand__per-client-instancedescriptor__versionswhen__runby__bothtester__scriptsfour__waysto__achievethe__samegoal__in Python,though__theyvary__instructure__andare__perhapsless__redundantin__someother__roles: $ python3 validate_tester.pyvalidate_getattribute__sameoutput__as properties,except__classname__$ python3 validate_tester_plus.pyvalidate_getattribute__sameoutput__as instance-state descriptors,except__classname__Besure__tostudy__andrun__thissection__scode__onyour__ownfor__morepointers__on managed-attributecoding__techniques.Chapter__SummaryThis__chaptercovered__thevarious__techniquesfor__managingaccess__toattributes__in Python,including__the__getattr____and__getattribute____operator-overloading__methods,and__classproperties__and descriptors.Along__the way,it__comparedand__contrastedthese__toolsand__presenteda__handfulof__usecases__todemonstrate__their behavior.Chapter__39continues__our tool-buildingfocus__witha__surveyof__decoratorscode__runautomatically__atfunction__andclass__creationtime__ratherthan__onattribute__access.Before__we continue, though,let__swork__througha__setof__questionsto__reviewwhat__weve__covered here.Test__Your Knowledge:Quiz__1.How__do__getattr____and__getattribute____differ? 2.How__doproperties__anddescriptors__differ? 3.How__areproperties__anddecorators__related? 4.What__arethe__mainfunctional__differencesbetween____getattr__and____getattribute__and__propertiesand__descriptors?Test__Your Knowledge:Answers__1.The____getattr__method__isrun__forexplicit__fetchesof__undefinedattributes__only (i.e.,those__notpresent__onan__instanceand__notinherited__fromany__ofits__classes).By__contrast,the____getattribute__method__iscalled__forevery__explicitattribute__fetch,whether__theattribute__isdefined__or not.Because__of this,code__insidea____getattr__can__freelyfetch__otherattributes__ifthey__are defined,whereas____getattribute__must__usespecial__codefor__allsuch__attributefetches__toavoid__loopingor__extracalls__(itmust__routefetches__toa__superclassto__skip itself).Neither__methodis__runfor__implicitfetches__of built-inoperations__(sansthe__nextchapter__s heroics). 2.Properties__servea__specific role,whereas__descriptorsare__more general.Properties__define get, set,and__deletefunctions__fora__specific attribute;descriptors__providea__classwith__methodsfor__these actions, too,but__theyprovide__extraflexibility__tosupport__morearbitrary__actions.In__fact,properties__arereally__asimple__wayto__createa__specifickind__ofdescriptor__onethat__runsfunctions__onattribute__accesses.Coding__differs too:a__propertyis__createdwith__a built-in function,and__adescriptor__iscoded__witha__class; thus,descriptors__canleverage__allthe__usualOOP__featuresof__classes,such__as inheritance. Moreover,in__additionto__theinstance__sstate__information,descriptors__havelocal__stateof__their own,which__cansometimes__avoidname__collisionsin__the instance. 3.Properties__canbe__codedwith__decorator syntax.Because__theproperty__built-inaccepts__asingle__functionargument__andreturns__a function,it__canbe__useddirectly__asa__functiondecorator__todefine__a fetch-access property.Due__tothe__namerebinding__behaviorof__decorators,the__nameof__thedecorated__functionis__assignedto__aproperty__whoseget__accessoris__setto__theoriginal__functiondecorated__(name=property(name)).Property__setterand__deleterattributes__allowus__tofurther__addset__anddelete__accessorswith__decorationsyntax__theyset__theaccessor__tothe__decoratedfunction__andreturn__theaugmented__property.Some__mayfind__thisa__bit clumsy,but__thisis__subjective. 4.The____getattr__and____getattribute__methods__aremore__generic:they__canbe__usedto__catcharbitrarily__many attributes.In__contrast,each__propertyor__descriptorprovides__accessinterception__foronly__onespecific__attributewe__cant__catchevery__attributefetch__witha__singleproperty__or descriptor.On__theother__hand,properties__anddescriptors__handleboth__attributefetch__andassignment__by design:__getattr____and__getattribute____handlefetches__only;to__interceptassignments__as well,__setattr____mustalso__be coded.The__implementationis__also different:__getattr____and__getattribute____are operator-overloading__methods,whereas__propertiesand__descriptorsare__objectsmanually__assignedto__class attributes.Unlike__the others,properties__anddescriptors__canalso__sometimesavoid__extracalls__onassignment__tounmanaged__namesand__showup__indir__results automatically,but__arealso__narrowerin__scopethey__cant__addressgeneric__delegation goals.In__Python evolution,new__featurestend__tooffer__alternativesbut__oftendo__notfully__subsumewhat__came before.Chapter__39.Decorators__InChapter__32s__surveyof__classodds__and ends,we__metproperties__andstatic__andclass__methods,took__aquick__lookat__the @decorator__syntaxPython__offersfor__declaring them,and__previeweddecorator__coding techniques.We__alsomet__functiondecorators__brieflywhile__exploringthe__property built-inin__Chapter 38,in__thecontext__ofabstract__superclassesin__Chapter 29,and__incapsule__formin__Chapter 19.This__chapterpicks__upwhere__allthis__previousdecorator__coverageleft__off. Here,we__lldig__deeperinto__themechanics__ofdecorators__andstudy__moreways__tocode__newdecorators__ourselveswith__toolslike__argumentsand__nesting.As__well__find,other__conceptswe__studiedearlier__especiallystate__retentionshow__upregularly__in decorators.This__isa__somewhatadvanced__topic,and__decoratorconstruction__tendsto__beof__moreinterest__totool__buildersthan__toapplication__programmers. Still,given__thatdecorators__arebecoming__increasinglycommon__inpopular__Python frameworks,a__basicunderstanding__canhelp__demystifytheir__role,even__ifyou__rejust__adecorator__user.Besides__coveringdecorator__construction details,this__chapterserves__asa__morerealistic__casestudy__ofPython__in action.Because__itsexamples__growlarger__thanmany__ofthe__otherswe__veseen__inthis__book,they__betterillustrate__howcode__comestogether__intomore__completesystems__and tools.As__anextra__perk,some__ofthe__codewe__llwrite__heremay__beused__as general-purposetools__inyour__day-to-day__programs.What__sa__Decorator?Simply__put,decoration__isa__wayto__specifymanagement__oraugmentation__codefor__functionsand__classes.Decorators__themselvestake__theform__ofcallable__objects (e.g., functions)that__processother__callable objects.As__suggestedearlier__inthis__book,Python__decoratorscome__intwo__related flavors:Function__decorators,added__first,do__namerebinding__atfunction__definition time,providing__alayer__oflogic__thatcan__managefunctions__andmethods__orlater__callsto__them.Class__decorators,added__later,do__namerebinding__atclass__definition time,providing__alayer__oflogic__thatcan__manageclasses__orthe__instancescreated__bylater__callsto__them.In__short,decorators__providea__wayto__insertautomatically__runcode__atthe__closeof__functionand__classdefinition__statementsat__theend__ofa__deffor__functiondecorators__andat__theend__ofa__classfor__class decorators.Such__codecan__playa__varietyof__roles,as__describedin__thefollowing__sections.Managing__Callsand__InstancesIn__typical use,this__automaticallyrun__codemay__beused__toaugment__callsto__functionsand__classes.It__arrangesthis__byinstalling__wrapper (a.k.a. proxy)objects__tobe__invoked later:Call__proxiesFunction__decoratorsinstall__wrapperobjects__tointercept__laterfunction__callsand__processthem__as needed,usually__passingthe__callon__tothe__originalfunction__torun__themanaged__action.Interface__proxiesClass__decoratorsinstall__wrapperobjects__tointercept__later instance-creationcalls__andprocess__themas__required,usually__passingthe__callon__tothe__originalclass__tocreate__amanaged__instance.Decorators__achievethese__effectsby__automaticallyrebinding__functionand__classnames__toother__callablesat__theend__ofdef__andclass__statements.When__later invoked,these__callablescan__performtasks__suchas__tracingand__timingfunction__calls,managing__accessto__classinstance__attributes,and__so on.Managing__Functionsand__ClassesAlthough__mostexamples__inthis__chapterdeal__withusing__wrappersto__interceptlater__callsto__functionsand__classes,this__isnot__theonly__waydecorators__canbe__used:Function__managersFunction__decoratorscan__alsobe__usedto__managefunction__objectsinstead__ofor__inaddition__tolater__callsto__themto__registera__functionto__an API,for__instance.Our__primaryfocus__here, though,will__beon__theirmore__commonlyused__call-wrapper application.Class__managersClass__decoratorscan__alsobe__usedto__manageclass__objects directly,instead__ofor__inaddition__to instance-creationcalls__toaugment__aclass__withnew__methodsor__data,for__example.Because__thisrole__intersectsstrongly__withthat__of metaclasses,we__llexplore__additionaldecorator__usecases__inthe__next chapter.As__detailed there,both__toolsrun__atthe__endof__theclass__creation process,but__classdecorators__oftenoffer__a lighter-weight solution.In__other words,function__decoratorscan__beused__tomanage__bothfunction__callsand__function objects,and__classdecorators__canbe__usedto__manageboth__classinstances__andclasses__themselves.By__returningthe__decoratedobject__itselfinstead__ofa__wrapper,decorators__becomea__simple post-creationstep__forfunctions__and classes.Regardless__ofthe__rolethey__play,decorators__providea__convenientand__explicitway__tocode__toolsuseful__bothduring__programdevelopment__andin__liveproduction__systems.Using__andDefining__DecoratorsDepending__onyour__job description,you__mightencounter__decoratorsas__auser__ora__provider.As__weve__seen,Python__itselfcomes__with built-indecorators__thathave__specializedroles__staticand__classmethod__declaration,property__creation,and__more.In__addition,many__popularPython__toolkitsinclude__decoratorsto__performtasks__suchas__managingdatabase__or user-interface logic.In__such cases,we__canget__bywithout__knowinghow__thedecorators__are coded.For__moregeneral__tasks,programmers__cancode__arbitrarydecorators__oftheir__own.For__example,function__decoratorsmay__beused__toaugment__functionswith__codethat__addscall__tracingor__logging,caches__call results,performs__argumentvalidity__testingduring__debugging,times__callsmade__tofunctions__for optimization,and__so on.Any__behavioryou__canimagine__addingto__really,wrapping__arounda__functioncall__isa__candidatefor__customfunction__decorators.On__theother__hand,function__decoratorsare__designedto__augmentonly__aspecific__functionor__method call,not__anentire__object interface.Class__decoratorsfill__thelatter__rolebetter__becausethey__canintercept__instance-creation calls,they__canbe__usedto__implementarbitrary__objectinterface__augmentationor__management tasks.For__example,custom__classdecorators__can trace, validate,or__otherwiseaugment__everyattribute__referencemade__foran__object.They__canalso__beused__toimplement__proxy objects,singleton__classes,and__othercommon__coding patterns.In__fact,you__llfind__thatmany__classdecorators__area__primeapplication__ofthe__delegationcoding__patternwe__metin__Chapter 31.Why__Decorators?Like__manyadvanced__Python tools,decorators__arenever__requiredfrom__apurely__technical perspective:we__canoften__implementtheir__functionalityinstead__usingsimple__helperfunction__callsor__other techniques.And__ata__base level,we__canalways__manuallycode__thename__rebindingthat__decoratorsperform__automatically.That__said,decorators__providean__explicitsyntax__forsuch__tasks,which__makesintent__clearer,can__minimizeaugmentation__code redundancy,and__mayhelp__ensurecorrect__API usage:Decorators__havea__veryexplicit__syntax,which__makesthem__easierto__spotthan__helperfunction__callsthat__maybe__arbitrarilyfar__removedfrom__thesubject__functionsor__classes.Decorators__areapplied__oncewhen__thesubject__functionor__classis__defined;it__snot__necessaryto__addextra__codeat__everycall__tothe__classor__function,which__mayhave__tobe__changedin__the future.Because__ofboth__ofthe__prior points,decorators__makeit__lesslikely__thata__userof__anAPI__willforget__toaugment__afunction__orclass__accordingto__API requirements.In__other words,beyond__theirtechnical__model,decorators__offersome__advantagesin__termsof__bothcode__maintenanceand__consistency. Moreover,as__structuring tools,decorators__naturallyfoster__encapsulationof__code,which__reducesredundancy__andmakes__futurechanges__easier.Like__most tools,decorators__havesome__potential drawbacks,too__whenthey__insertwrapper__logic,they__canalter__thetypes__ofthe__decorated objects,and__theymay__incurextra__callswhen__usedas__callor__interface proxies.On__theother__hand,the__sameconsiderations__applyto__anytechnique__thatadds__wrappinglogic__to objects.We__llexplore__these trade-offsin__thecontext__ofreal__codelater__inthis__chapter.Although__thechoice__touse__decoratorsis__ultimately subjective,their__advantagesare__compellingenough__tohave__escalatedthem__tocommon__practicein__thePython__world.To__helpyou__decidefor__yourself,let__sturn__tothe__details.DECORATORS__VERSUSMACROS__Pythons__decoratorsbear__similaritiesto__whatsome__call aspect-orientedprogramming__inother__languagescode__insertedto__runautomatically__beforeor__aftera__functioncall__runs.Their__syntaxalso__veryclosely__resembles (andis__likelyborrowed__from)Java__s annotations,though__Pythons__modelmay__beconsidered__moreflexible__and general.Some__likendecorators__tomacros__too,but__thisisn__tentirely__aptand__canbe__misleading. Macros,like__Cs__#definepreprocessor__directive,are__associatedwith__textualreplacement__andexpansion__anddesigned__forgenerating__code.By__contrast,Python__sdecorators__area__runtimeoperation__basedupon__name rebinding,callable__objects,and__often, proxies.While__thetwo__mayhave__usecases__thatsometimes__overlap,decorators__andmacros__arefundamentally__differentin__scope, implementation,and__coding patterns.Comparing__thetwo__seemsakin__tocomparing__Pythons__importwith__aC__#include,which__similarlyconfuses__aruntime__object-basedoperation__withtext__insertion.Of__course,the__termmacro__hasalso__beendiluted__overtime__to some,it__nowcan__alsorefer__toany__cannedseries__ofsteps__orprocedure__andusers__ofother__languagesmight__findthe__analogyto__decoratorsuseful__anyhow.But__theyshould__alsokeep__inmind__thatdecorators__areabout__callableobjects__managingcallable__objects,not__text expansion.Python__tendsto__bebest__understoodand__usedin__termsof__Python idioms.The__BasicsLet__sget__startedwith__a first-passlook__atdecoration__behaviorfrom__anabstract__perspective.We__llwrite__realand__moresubstantial__code soon,but__sincemost__ofthe__magicof__decoratorsboils__downto__anautomatic__rebinding operation,it__simportant__tounderstand__thismapping__firstfor__bothfunctions__and classes.Function__DecoratorBasics__Aspreviewed__earlierin__this book,function__decoratorsare__largelyjust__syntacticsugar__thatruns__onefunction__throughanother__atthe__endof__adef__statementand__rebindsthe__originalfunction__nameto__the result.Usage__Afunction__decoratoris__asort__ofruntime__declarationabout__thefunction__whosedefinition__follows.The__decoratoris__codedon__aline__justbefore__thedef__statementthat__definesa__functionor__method,and__itconsists__ofthe__@symbol__followedby__areference__toa__metafunctiona__function (orother__callable object)that__managesanother__function.As__ofPython__3.9,the__codeafter__the @can__beany__expressionreturning__a metafunction,but__its__usuallya__simple name.In__termsof__code,function__decoratorsautomatically__mapthe__following syntax: @decorator #Decorate__functiondef__F(arg): F(99) #Call__functioninto__thisequivalent__form,where__decoratoris__a one-argumentcallable__objectthat__returnsa__callableobject__withthe__samenumber__ofarguments__as F,if__notF__itself:def__F(arg):F__= decorator(F) #Rebind__functionname__todecorator__result F(99) #Essentially__calls decorator(F)(99)This__automaticname__rebindingworks__onany__def statement,whether__its__fora__simplefunction__ora__methodwithin__a class.When__thefunction__Fis__later called,it__sactually__callingthe__objectreturned__bythe__decorator,which__maybe__eitheranother__objectthat__implementsrequired__wrappinglogic__orthe__originalfunction__itself.In__other words,decoration__essentiallymaps__thefirst__ofthe__followinginto__thesecond__thoughthe__decoratoris__reallyrun__only once,at__decoration time: func(6, 7) decorator(func)(6, 7)This__automaticname__rebindingaccounts__forthe__static-methodand__propertydecoration__syntaxwe__metearlier__inthe__book:class__C: @staticmethoddef__meth( ): #meth__= staticmethod(meth)class__C: @propertydef__name(self): #name__= property(name)In__both cases,the__methodname__isrebound__tothe__resultof__a built-infunction__decoratorat__theend__ofthe__def statement.Calling__theoriginal__namelater__invokeswhatever__objectthe__decorator returns.In__thesespecific__cases,the__originalnames__arerebound__toa__static-methodrouter__andproperty__descriptor,but__theprocess__ismuch__moregeneral__thanthis__asthe__nextsection__explains.Implementation__Adecorator__itselfis__acallable__thatreturns__a callable.That__is,it__returnsthe__objectto__becalled__laterwhen__thedecorated__functionis__invokedthrough__itsoriginal__nameeither__awrapper__objectto__interceptlater__callsor__theoriginal__functionaugmented__insome__way.In__fact,decorators__canbe__anytype__ofcallable__andreturn__anytype__of callable:any__combinationof__functionsand__classesmay__be used,though__someare__bettersuited__tocertain__contexts.For__example,to__tapinto__thedecoration__protocolin__orderto__managea__functionjust__afterit__is created,we__mightcode__adecorator__ofthis__form:def__decorator(F): #Process__functionF__herereturn__F @decoratordef__func(): #func__= decorator(func)Because__theoriginal__decoratedfunction__isassigned__backto__its name,this__simplyadds__a post-creationstep__tofunction__definition.Such__astructure__mightbe__usedto__registera__functionto__an API,initialize__function attributes,and__so on.In__moretypical__use,to__insertlogic__thatintercepts__latercalls__toa__function,we__mightcode__adecorator__toreturn__adifferent__objectthan__theoriginal__functiona__proxyfor__later calls:def__decorator(F): #Save__oruse__functionF__#Return__adifferent__callable:nested__def,class__instancewith____call__, etc. @decoratordef__func(): #func__= decorator(func)This__decoratoris__invokedat__decoration time,and__thecallable__itreturns__isinvoked__whenthe__originalfunction__nameis__later called.The__decoratoritself__receivesthe__decorated function;the__callablereturned__receiveswhatever__argumentsare__laterpassed__tothe__decoratedfunction__s name.When__coded properly,this__worksthe__samefor__class-level methods:the__impliedinstance__objectsimply__showsup__inthe__firstargument__ofthe__returned callable.In__skeleton terms,here__sone__commoncoding__patternthat__capturesthis__ideathe__decoratorreturns__awrapper__thatretains__theoriginal__functionin__anenclosing__scope:def__decorator(F): #On__@decoration__def wrapper(*args): #On__wrappedfunction__call #Use__Fand__args # F(*args)calls__originalfunction__returnwrapper__@decorator #func__= decorator(func)def__func(x, y): #func__ispassed__to decorator'sF__func(6, 7) # 6, 7are__passedto__wrapper's *argsWhen__thename__funcis__later called,it__reallyinvokes__thewrapper__functionreturned__by decorator;the__wrapperfunction__canthen__runthe__originalfunc__becauseit__isstill__availablein__anenclosing__scope.When__codedthis__way,each__decoratedfunction__producesa__newscope__toretain__state.To__dothe__samewith__classes,we__canoverload__thecall__operationand__useinstance__attributesinstead__ofenclosing__scopes:class__decorator:def____init__(self, func): #On__@decoration__self.func =func__def __call__(self, *args): #On__wrappedfunction__call #Use__self.funcand__args # self.func(*args)calls__originalfunction__@decoratordef__func(x, y): #func__= decorator(func) #func__ispassed__to__init____func(6, 7) # 6, 7are__passedto____call__'s *argsWhen__thename__funcis__latercalled__now,it__reallyinvokes__the__call____operator-overloadingmethod__ofthe__instancecreated__by decorator;the____call__method__canthen__runthe__originalfunc__becauseit__isstill__availablein__aninstance__attribute.When__codedthis__way,each__decoratedfunction__producesa__newinstance__toretain__state.Supporting__methoddecoration__Onesubtle__pointabout__theprior__class-basedcoding__isthat__whileit__worksto__interceptsimple__function calls,it__doesnot__quitework__whenapplied__to class-levelmethod__functions:class__decorator:def____init__(self, func): #func__ismethod__withoutinstance__self.func =func__def __call__(self, *args): #self__isdecorator__instance # self.func(*args) fails! #C__instancenot__in args!class__C: @decoratordef__method(self, x, y): #method__= decorator(method) #Rebound__todecorator__instanceWhen__codedthis__way,the__decoratedmethod__isrebound__toan__instanceof__thedecorator__classinstead__ofa__simple function.The__problemwith__thisis__thatthe__selfin__thedecorator__s__call____receivesthe__decoratorclass__instancewhen__themethod__islater__run,and__theinstance__ofclass__Cis__neverincluded__in *args.This__makesit__impossibleto__dispatchthe__callto__theoriginal__methodthe__decoratorobject__retainsthe__originalmethod__function,but__ithas__noinstance__topass__to it.To__supportboth__functionsand__methods,the__nestedfunction__alternativeworks__better:def__decorator(F): #F__isfunc__ormethod__withoutinstance__def wrapper(*args): #class__instancein__args[0]for__method # F(*args)runs__funcor__methodreturn__wrapper @decoratordef__func(x, y): #func__= decorator(func) func(6, 7) #Really__calls wrapper(6, 7)class__C: @decoratordef__method(self, x, y): #method__= decorator(method) #Rebound__tosimple__functionX__= C() X.method(6, 7) #Really__calls wrapper(X, 6, 7)When__codedthis__way,wrapper__receivesthe__Cclass__instancein__itsfirst__argument,so__itcan__dispatchto__theoriginal__methodand__accessstate__information. Technically,this__nested-functionversion__worksbecause__Pythoncreates__abound__methodobject__andthus__passesthe__subjectclass__instanceto__theself__argumentonly__whena__methodattribute__referencesa__simple function;when__itreferences__aninstance__ofa__callableclass__instead,the__callableclass__sinstance__ispassed__toself__togive__thecallable__classaccess__toits__ownstate__information.You__llsee__howthis__subtledifference__canmatter__inmore__realisticexamples__laterin__this chapter.Also__notethat__nestedfunctions__areperhaps__themost__straightforwardway__tosupport__decorationof__bothfunctions__and methods,but__notnecessarily__theonly__way.The__priorchapter__s descriptors,for__example,receive__boththe__descriptor-class__and subject-classinstance__when called.Though__more complex,later__inthis__chapteryou__llsee__howthis__toolcan__beleveraged__inthis__contextas__well.Class__DecoratorBasics__Functiondecorators__provedso__usefulthat__themodel__wasextended__toallow__class decoration.They__wereinitially__resistedbecause__ofrole__overlapwith__thenext__chapters__metaclasses;in__the end, though,they__wereadopted__becausethey__providea__simplerway__toachieve__manyof__thesame__goals.Class__decoratorsare__stronglyrelated__tofunction__decorators;in__fact,they__usethe__samesyntax__andvery__similarcoding__patterns.Rather__thanwrapping__individualfunctions__or methods, though,class__decoratorsare__away__tomanage__classesor__wrapup__instance-creationcalls__withextra__logicthat__managesor__augmentsinstances__createdfrom__a class.In__thelatter__role,they__maymanage__fullobject__interfacesinstead__ofa__singlecallable__object.Usage__Syntactically,class__decoratorsappear__justbefore__class statements,in__thesame__waythat__functiondecorators__appearjust__beforedef__statements.In__symbolic terms,for__adecorator__thatmust__bea__one-argumentcallable__thatreturns__a callable,the__classdecorator__syntax: @decorator #Decorate__classclass__C:x__= C(99) #Make__aninstance__isequivalent__tothe__followingthe__classis__automaticallypassed__tothe__decorator function,and__thedecorator__sresult__isassigned__backto__theclass__name:class__C:C__= decorator(C) #Rebind__classname__todecorator__resultx__= C(99) #Essentially__calls decorator(C)(99)The__neteffect__isthat__callingthe__classname__laterto__createan__instancewinds__uptriggering__thecallable__returnedby__the decorator,which__mayor__maynot__callthe__originalclass__itself.Implementation__Newclass__decoratorsare__codedwith__manyof__thesame__techniquesused__forfunction__decorators,though__somemay__involvetwo__levelsof__augmentationto__manageboth__instance-constructioncalls__aswell__as instance-interface access.Because__aclass__decoratoris__alsoa__callablethat__returnsa__callable,most__combinationsof__functionsand__classes suffice.However__its__coded,the__decorators__resultis__whatruns__whenan__instanceis__later created.For__example,to__simplymanage__aclass__justafter__itis__created,return__theoriginal__class itself:def__decorator(C): #Process__classC__herereturn__C @decoratorclass__C: #C__= decorator(C)To__insteadinsert__awrapper__layerthat__interceptslater__instance-creation calls,return__adifferent__callable object:def__decorator(C): #Save__oruse__classC__#Return__adifferent__callable:nested__def,class__instancewith____call__, etc. @decoratorclass__C: #C__= decorator(C)The__callablereturned__bysuch__aclass__decoratortypically__createsand__returnsa__newinstance__ofthe__original class,augmented__insome__wayto__manageits__interface.For__example,the__followinginserts__anobject__thatintercepts__undefinedattributes__ofa__class instance:def__decorator(cls): #On__@decoration__class Wrapper:def____init__(self, *args): #On__instancecreation__self.wrapped = cls(*args)def____getattr__(self, name): #On__attributefetch__return getattr(self.wrapped, name)return__Wrapper @decoratorclass__C: #C__= decorator(C)def____init__(self, x, y): #Run__by Wrapper.__init__ self.attr = 'hack'x__= C(6, 7) #Really__calls Wrapper(6, 7) print(x.attr) #Runs__Wrapper.__getattr__,prints__"hack"In__this example,the__decoratorrebinds__theclass__nameto__another class,which__retainsthe__originalclass__inan__enclosingscope__andcreates__andembeds__aninstance__ofthe__originalclass__whenit__s called.When__anattribute__islater__fetchedfrom__the instance,it__isintercepted__bythe__wrappers____getattr__and__delegatedto__theembedded__instanceof__theoriginal__class. Moreover,each__decoratedclass__createsa__new scope,which__remembersthe__original class.We__llflesh__outthis__exampleinto__somemore__usefulcode__laterin__this chapter.Like__function decorators,class__decoratorsare__commonlycoded__aseither__closure (a.k.a.factory__)functions__thatcreate__andreturn__callables,classes__thatuse____init__or____call__methods__tointercept__call operations,or__somecombination__thereof.Closure__functionstypically__retainstate__in enclosing-scope references,and__classesretain__statein__attributes.Supporting__multipleinstances__Asfor__function decorators,some__callable-typecombinations__workbetter__forclass__decoratorsthan__others.Consider__thefollowing__invalidalternative__tothe__classdecorator__ofthe__prior example:class__Decorator:def____init__(self, C): #On__@decoration__self.C =C__def __call__(self, *args): #On__instancecreation__self.wrapped = self.C(*args)return__selfdef____getattr__(self, attrname): #On__attributefetch__return getattr(self.wrapped, attrname) @Decoratorclass__C: #C__= Decorator(C)x__= C()y__= C() #Overwrites__x!This__codehandles__multipledecorated__classes (eachmakes__anew__Decorator instance)and__willintercept__instance-creationcalls__(eachruns____call__).Unlike__theprior__version, however,this__versionfails__tohandle__multipleinstances__ofa__givenclass__each instance-creationcall__overwritesthe__priorsaved__instance.The__priorversion__doessupport__multipleinstances__becauseeach__instance-creationcall__makesa__newindependent__wrapper object.More__generally,either__ofthe__followingpatterns__supportsmultiple__wrapped instances:def__decorator(C): #On__@decoration__class Wrapper:def____init__(self, *args): #On__instance creation:new__Wrapper self.wrapped = C(*args) #Embed__instancein__instancereturn__Wrapperclass__Wrapper:def__decorator(C): #On__@decoration__def onCall(*args): #On__instance creation:new__Wrapperreturn__Wrapper(C(*args)) #Embed__instancein__instancereturn__onCallWe__llstudy__thisphenomenon__ina__morerealistic__contextlater__inthe__chapter too;in__practice, though,we__mustbe__carefulto__combinecallable__typesproperly__tosupport__ourintent__andchoose__statepolicies__wisely.Decorator__Nesting Sometimes,one__decoratorisn__t enough.For__instance,suppose__youve__codedtwo__functiondecorators__tobe__usedduring__developmentone__totest__argumenttypes__beforefunction__callsand__anotherto__testreturn__valuetypes__afterfunction__calls.You__canuse__either independently,but__whatto__doif__youwant__toemploy__bothon__asingle__function?What__youreally__needis__away__tonest__the two,such__thatthe__resultof__onedecorator__isthe__functiondecorated__bythe__other.It__sirrelevant__whichis__nested,as__longas__bothsteps__runon__later calls.To__supportmultiple__nestedsteps__ofaugmentation__this way,decorator__syntaxallows__youto__addmultiple__layersof__wrapperlogic__toa__decoratedfunction__or method.When__thisfeature__is used,each__decoratormust__appearon__aline__ofits__own.Decorator__syntaxof__this form: @A @B @Cdef__f( ):runs__thesame__asthe__following:def__f( ):f__= A(B(C(f))) Here,the__originalfunction__ispassed__throughthree__different decorators,and__theresulting__callableobject__isassigned__backto__theoriginal__name.Each__decoratorprocesses__theresult__ofthe__prior,which__maybe__theoriginal__functionor__aninserted__wrapper.If__allthe__decoratorsinsert__wrappers,the__neteffect__stacks them:when__theoriginal__functionname__is called,three__differentlayers__ofwrapping__objectlogic__willbe__invokedto__augmentthe__originalfunction__inthree__different ways.The__lastdecorator__listedis__thefirst__applied and, thus,the__mostdeeply__nestedwhen__theoriginal__functionname__islater__called.Just__asfor__functions,multiple__classdecorators__resultin__multiplenested__functioncalls__andpossibly__multiplelevels__andsteps__ofwrapper__logicaround__instance-creation__calls.For__example,the__following code: @hack @codeclass__C:X__= C()is__equivalentto__the following:class__C:C__= hack(code(C))X__= C() Again,each__decoratoris__freeto__returneither__theoriginal__classor__aninserted__wrapper object.With__wrappers,when__aninstance__ofthe__originalC__classis__finally requested,the__callis__redirectedto__thewrapping__layerobjects__providedby__boththe__hackand__code decorators,which__mayhave__arbitrarilydifferent__rolesthey__mighttrace__andvalidate__attributeaccess__for example,and__bothsteps__wouldbe__runin__turnon__later requests.For__instance,the__following do-nothingdecorators__simplyreturn__thedecorated__function:def__d1(F):return__Fdef__d2(F):return__Fdef__d3(F):return__F @d1 @d2 @d3def__func(): #func__= d1(d2(d3(func))) print('hack') func() #Prints__"hack"The__samesyntax__workson__classes,as__dothese__same do-nothing decorators.When__decoratorsinsert__wrapperfunction__objects, though,they__mayaugment__theoriginal__functionwhen__calledthe__followingconcatenates__toits__resultin__thedecorator__layers,as__itruns__thelayers__frominner__to outer:def__d1(F):return__lambda: 'X' + F()def__d2(F):return__lambda: 'Y' + F()def__d3(F):return__lambda: 'Z' + F() @d1 @d2 @d3def__func(): #func__= d1(d2(d3(func)))return__'hack' print(func()) #Prints__"XYZhack"We__uselambda__functionsto__implementwrapper__layershere__(eachretains__thewrapped__functionF__inan__enclosing scope);in__practice,wrappers__cantake__theform__of functions,callable__classes,and__more.When__designed well,decorator__nestingallows__usto__combineaugmentation__stepsin__awide__varietyof__ways.Decorator__ArgumentsBoth__functionand__classdecorators__canalso__seemto__take arguments. Really, though,the__roleof__thesearguments__issimpler__thanit__may seem:decorator__argumentsare__passedto__acallable__thatreturns__thedecorator__whichin__turnreturns__a callable.By__nature,this__usuallysets__upmultiple__levelsof__state retention.The__following,for__instance: @decorator(A, B)def__F(arg): F(99)is__automaticallymapped__intothis__equivalent form,where__decoratoris__acallable__thatreturns__theactual__decorator.The__returneddecorator__inturn__returnsthe__callablerun__laterfor__callsto__theoriginal__function name:def__F(arg):F__= decorator(A, B)(F) #Rebind__Fto__resultof__decorator'sreturn__value F(99) #Essentially__calls decorator(A, B)(F)(99)Decorator__argumentsare__resolvedbefore__decorationever__occurs,and__theyare__usuallyused__toretain__stateinformation__foruse__inlater__calls.The__decoratorfunction__inthis__example,for__instance,might__takea__formlike__the following:def__decorator(A, B): #Save__oruse__A,B__def actualDecorator(F): #Save__oruse__functionF__#Return__a callable:nested__def,class__instancewith____call__, etc.return__callablereturn__actualDecoratorThe__outerfunction__inthis__structuregenerally__savesthe__decoratorarguments__awayas__stateinformation__foruse__inthe__actual decorator,the__callableit__returns,or__both.This__codesnippet__retainsthe__stateinformation__argumentin__enclosingfunction__scope references,but__classattributes__wouldwork__as well.In__other words,decorator__argumentsoften__implythree__levelsof__callables:a__callableto__acceptdecorator__arguments,which__returnsa__callableto__serveas__decorator,which__returnsa__callableto__handlecalls__tothe__originalfunction__or class.Each__ofthe__threelevels__maybe__afunction__orclass__andmay__retainstate__inthe__formof__scopesor__class attributes.Decorator__argumentscan__beused__toprovide__attributeinitialization__values, call-trace__message labels,attribute__namesto__be validated,and__muchmore__anysort__ofconfiguration__parameterfor__objectsor__theirproxies__isa__candidate.We__llcode__concreteexamples__ofdecorator__argumentslater__inthis__chapter.Decorators__ManageFunctions__and Classes,Too__Towrap__up,although__muchof__therest__ofthis__chapterfocuses__onwrapping__latercalls__tofunctions__and classes,it__simportant__toremember__thatthe__decoratormechanism__ismore__generalthan__thisit__issimply__aprotocol__forpassing__functionsand__classesthrough__anycallable__immediatelyafter__theyare__created.As__such,it__canalso__beused__toinvoke__arbitrary post-creation processing:def__decorator(O): #Augment__functionor__classO__returnO__@decoratordef__F(): #F__= decorator(F) @decoratorclass__C: #C__= decorator(C)If__wereturn__theoriginal__decoratedobject__thisway__insteadof__a proxy,we__canmanage__functionsand__classesthemselves__ratherthan__latercalls__to them.Such__decoratorsmight__beused__toregister__callableobjects__toan__API,initialize__attributesin__functionsor__classeswhen__theyare__created,and__so on.Decorator__rolesare__limitedonly__byyour__imagination.Coding__FunctionDecorators__Onto__the code.In__therest__ofthis__chapter,we__aregoing__tostudy__workingexamples__thatdemonstrate__thedecorator__conceptswe__just surveyed.This__sectionpresents__ahandful__offunction__decoratorsin__complete form,and__thenext__showstangible__classdecorators__in action.Following__that,we__llclose__outwith__twolarger__casestudies__thatshowcase__typicaldecorator__rolesand__code full-scaleimplementations__ofclass__privacyand__argumentrange__tests.Tracing__FunctionCalls__Toget__started,let__srevive__thecall__tracerexample__wemet__inChapter__32.Example__39-1defines__andapplies__afunction__decoratorthat__countsthe__numberof__callsmade__tothe__decoratedfunction__andprints__atrace__messagefor__each call.Example__39-1. decorator1.pyclass__tracer:def____init__(self, func): #On__@ decoration:save__originalfunc__self.calls = 0 self.func =func__def __call__(self, *args): #On__later calls:run__originalfunc__self.calls += 1 print(f'call {self.calls}to__{self.func.__name__}') self.func(*args) @tracerdef__hack(a, b, c): #hack__= tracer(hack) print(a +b__+ c) #Wraps__hackin__adecorator__objectNotice__howeach__functiondecorated__withthis__classwill__createa__newinstance__withits__ownsaved__functionobject__andcalls__counter. Also,observe__howthe__*argsargument__syntaxis__usedto__packand__unpackarbitrarily__many passed-in arguments.This__generalityenables__thisdecorator__tobe__usedto__wrapany__functionwith__anynumber__ofpositional__arguments;this__versiondoesn__tyet__workon__keywordarguments__or class-levelmethods__anddoesn__treturn__results,but__well__fixthese__shortcomingslater__inthis__section. Now,if__weimport__thismodule__sfunction__andtest__itinteractively__ina__REPL,we__getthe__followingsort__ofbehavior__eachcall__generatesa__tracemessage__initiallybecause__thedecorator__classintercepts__it: $ python3 >>>from__decorator1import__hack >>> hack(1, 2, 3) #Really__callsthe__tracerwrapper__objectcall__1to__hack 6 >>> hack('a', 'b', 'c') #Invokes____call__in__classcall__2to__hackabc__>>> hack.calls #Number__callsin__wrapperstate__information 2 >>>hack__When run,the__tracerclass__savesaway__thedecorated__functionand__interceptslater__callsto__itin__orderto__adda__layerof__logicthat__countsand__printseach__call.Notice__howthe__totalnumber__ofcalls__showsup__asan__attributeof__thedecorated__functionhack__isreally__aninstance__ofthe__tracerclass__when decorated,a__findingthat__mayhave__ramificationsfor__programsthat__dotype__checking,but__isgenerally__benign.For__function calls,the__@decoration__syntaxcan__bemore__convenientthan__modifyingeach__callto__accountfor__theextra__logic level,and__itavoids__accidentallycalling__theoriginal__function directly.Consider__anondecorator__equivalentsuch__asthe__following: >>>calls__= 0 >>>def__tracer(func, *args):global__callscalls__+= 1 print(f'call {calls}to__{func.__name__}') func(*args) >>>def__hack(a, b, c): #Nondecorated__function print(a, b, c) >>> hack(1, 2, 3) #Normal__nontraced call: accidental? 1 2 3 >>> >>> tracer(hack, 1, 2, 3) #Special__tracedcall__withoutdecorators__call 1to__hack 1 2 3This__alternativecan__beused__onany__functionwithout__thespecial__@ syntax,but__unlikethe__decorator version,it__requiresextra__syntaxat__everyplace__wherethe__functionis__calledin__your code. Furthermore,its__intentmay__notbe__as obvious,and__itdoes__notensure__thatthe__extralayer__willbe__invokedfor__normal calls.Although__decoratorsare__neverrequired__(wecan__alwaysrebind__names manually),they__areoften__themost__convenientand__uniformaugmentation__option.Decorator__StateRetention__OptionsThe__precedingexample__raisesan__important point.Decorators__havea__varietyof__optionsfor__retainingstate__informationprovided__atdecoration__timeto__beused__duringlater__callsto__decorated objects.They__generallyneed__tosupport__multipledecorated__objectsand__multiplelater__calls,but__thereare__severalways__toimplement__these goals:instance__attributes,global__variables,nonlocal__closure variables,and__functionattributes__canall__beused__forretaining__state.This__topicparallels__theinitial__statecoverage__inChapter__17but__canbe__fleshedout__herewith__class details,and__itis__soendemic__todecorators__thatit__qualifiesas__a prerequisite.This__topicalso__appliesto__bothfunction__andclass__decorators,but__lets__exploreit__inthe__narrower function-decorator realm.State__with class-instanceattributes__Asan__openingact__inthe__state-retention show,Example__39-2codes__anaugmented__versionof__theprior__example,which__addssupport__forkeyword__argumentswith__**syntax__andreturns__thewrapped__functions__resultto__supportmore__usecases__(fornonlinear__readers,we__firststudied__keywordarguments__inChapter__18).Example__39-2. decorator_state_classes.pyclass__tracer: #State__viainstance__attributesdef____init__(self, func): #On__@decorator__self.calls = 0 #Save__funcfor__latercall__self.func =func__def __call__(self, *args, **kwargs): #On__callto__originalfunction__self.calls += 1 print(f'call {self.calls}to__{self.func.__name__}')return__self.func(*args, **kwargs) @tracerdef__hack(a, b, c): #Same__as:hack__= tracer(hack) print(a +b__+ c) #Triggers__tracer.__init__ @tracerdef__code(x, y): #Same__as:code__= tracer(code) print(x ** y) #Wraps__codein__atracer__objectif____name__ == '__main__': hack(1, 2, 3) #Really__callstracer__instance:runs__tracer.__call__ hack(a=4, b=5, c=6) #hack__isan__instanceattribute__code(4, 2) #Really__callstracer__instance: self.funcis__code code(2, y=16) # self.callsis__per-decorationhere__Likethe__original,this__usesclass__instanceattributes__tosave__state explicitly.Both__thewrapped__functionand__thecalls__counterare__per-instanceinformation__eachdecoration__getsits__own copy.When__runas__a script,the__outputof__thisversion__isas__follows;notice__howthe__hackand__codefunctions__eachhave__theirown__callscounter__becauseeach__decorationcreates__anew__class instance: $ python3 decorator_state_classes.pycall__1to__hack 6call__2to__hack 15call__1to__code 16call__2to__code 65536While__usefulfor__decorating functions,this__codingscheme__stillhas__issueswhen__appliedto__methodsa__shortcomingwe__lladdress__ina__later revision.State__withglobal__variablesFor__simplertasks__thatdon__trequire__per-function data,moving__statevariables__outto__theglobal__scope,as__illustratedby__Example 39-3,might__suffice.This__codestill__usesan__enclosing-scopereference__forthe__originaldecorated__functionbut__pushesthe__callcounter__outto__theenclosing__module.Example__39-3. decorator_state_globals.pycalls__= 0def__tracer(func): #State__viaenclosing__scopeand__globaldef__wrapper(*args, **kwargs): #Instead__ofclass__attributesglobal__calls #calls__is global,not__per-functioncalls__+= 1 print(f'call {calls}to__{func.__name__}')return__func(*args, **kwargs)return__wrapper @tracerdef__hack(a, b, c): #Same__as:hack__= tracer(hack) print(a +b__+ c) @tracerdef__code(x, y): #Same__as:code__= tracer(code) print(x ** y)if____name__ == '__main__': hack(1, 2, 3) #Really__calls wrapper,assigned__tohack__hack(a=4, b=5, c=6) #wrapper__callshack__code(4, 2) #Really__calls wrapper,assigned__tocode__code(2, y=16) #Global__callsis__not per-decoration here! Unfortunately,moving__thecounter__outto__thecommon__globalscope__toallow__itto__bechanged__likethis__alsomeans__thatit__willbe__sharedby__everywrapped__function.Unlike__classinstance__attributes,global__countersare__cross-program,not__per-function__thecounter__isincremented__forany__tracedfunction__call.You__cantell__thedifference__ifyou__comparethis__versions__outputwith__theprior__versions__the single,shared__globalcall__counteris__incorrectlyupdated__bycalls__toevery__decorated function: $ python3 decorator_state_globals.pycall__1to__hack 6call__2to__hack 15call__3to__code 16call__4to__code 65536State__with enclosing-scopenonlocals__Sharedglobal__statemay__bewhat__wewant__insome__cases.If__wereally__wanta__per-function__counter, though,we__caneither__useclasses__asbefore__ormake__useof__closurefunctions__andthe__nonlocalstatement__describedin__Chapter 17.Because__thisstatement__allowsenclosing__functionscope__variablesto__be changed,they__canserve__as per-decoration,changeable__data.Example__39-4demos__thebasics__ofthis__scheme.Example__39-4. decorator_state_nonlocals.pydef__tracer(func): #State__viaenclosing__scopeand__nonlocalcalls__= 0 #Instead__ofclass__attrsor__globaldef__wrapper(*args, **kwargs): #calls__is per-function,not__globalnonlocal__callscalls__+= 1 print(f'call {calls}to__{func.__name__}')return__func(*args, **kwargs)return__wrapper @tracerdef__hack(a, b, c): #Same__as:hack__= tracer(hack) print(a +b__+ c) @tracerdef__code(x, y): #Same__as:code__= tracer(code) print(x ** y)if____name__ == '__main__': hack(1, 2, 3) #Really__calls wrapper,bound__tohack__hack(a=4, b=5, c=6) #wrapper__callshack__code(4, 2) #Really__calls wrapper,bound__tocode__code(2, y=16) #Nonlocal__calls_is___per-decorationhere__Now,because__enclosing-scopevariables__arenot__cross-program globals,each__wrappedfunction__getsits__owncounter__again,just__asfor__classesand__attributes.Here__sthe__new output: $ python3 decorator_state_nonlocals.pycall__1to__hack 6call__2to__hack 15call__1to__code 16call__2to__code 65536State__withfunction__attributes Finally,you__canalso__avoidglobals__andclasses__bymaking__useof__functionattributes__forsome__changeablestate__insteadof__nonlocal.As__wesaw__inChapters__17and__19,we__canattach__arbitraryattributes__tofunctions__by assignment,with__func.attr=value.Because__afactory__functionmakes__anew__functionon__each call,its__attributesbecome__per-call state. Moreover,you__needto__usethis__techniqueonly__forstate__variablesthat__must change; enclosing-scopereferences__arestill__retainedand__work normally.To__demo,Example__39-5simply__uses wrapper.callsfor__state.It__worksthe__sameas__thepreceding__nonlocalversion__becausethe__counteris__again per-decorated- function.Example__39-5. decorator_state_attributes.pydef__tracer(func): #State__viaenclosing__scopeand__funcattr__def wrapper(*args, **kwargs): #calls__is per-function,not__global wrapper.calls += 1 print(f'call {wrapper.calls}to__{func.__name__}')return__func(*args, **kwargs) wrapper.calls = 0return__wrapper @tracerdef__hack(a, b, c): #Same__as:hack__= tracer(hack) print(a +b__+ c) @tracerdef__code(x, y): #Same__as:code__= tracer(code) print(x ** y)if____name__ == '__main__': hack(1, 2, 3) #Really__calls wrapper,assigned__tohack__hack(a=4, b=5, c=6) #wrapper__callshack__code(4, 2) #Really__calls wrapper,assigned__tocode__code(2, y=16) # wrapper.calls_is___per-decorationhere__Aswe__learnedin__Chapter 17,this__worksonly__becausethe__namewrapper__isretained__inthe__enclosingtracer__functions__scope.When__welater__increment wrapper.calls,we__arenot__changingthe__namewrapper__itself,so__nononlocal__declarationis__required: $ python3 decorator_state_attributes.pysame__outputas__priorversion__Thisscheme__wasalmost__relegatedto__afootnote__becauseit__maybe__moreobscure__thannonlocal__andmight__bebetter__savedfor__caseswhere__otherschemes__dont__help. However,function__attributesalso__havea__substantial advantage:like__class instances,they__allowaccess__tothe__savedstate__fromoutside__thedecorator__s code;nonlocals__canonly__beseen__insidethe__nestedfunction__itself,but__functionattributes__havewider__visibility.We__willemploy__functionattributes__againin__ananswer__toone__ofthe__end-of-chapter__questions,where__theirvisibility__outsidecallables__becomesan__asset.As__changeablestate__associatedwith__acontext__of use, though,they__areequivalent__to enclosing-scope nonlocals.As__usual,choosing__frommultiple__toolsis__aninherent__partof__theprogramming__task.Because__decoratorsoften__implymultiple__levelsof__callables,you__cancombine__functionswith__enclosing scopes,classes__with attributes,and__functionattributes__toachieve__avariety__ofcoding__structures.As__youll__see later, though,this__sometimesmay__besubtler__thanyou__expecteach__decoratedfunction__shouldhave__itsown__state,and__eachdecorated__classmay__requirestate__bothfor__itselfand__foreach__generated instance.In__fact,as__thenext__sectionwill__explainin__more detail,if__wewant__toapply__functiondecorators__to class-level methods, too,we__alsohave__tobe__carefulabout__thedistinction__Pythonmakes__betweendecorators__basedon__callableclass__instanceobjects__anddecorators__basedon__nested functions.Class__Pitfall:Decorating__MethodsWhen__thepreceding__sections__class-basedtracer__function decorator,Example__39-2,was__initially coded,it__wasassumed__thatit__couldalso__beapplied__toany__methoddecorated__methodsshould__workthe__same,but__theautomatic__selfinstance__argumentwould__simplybe__includedat__thefront__of *args.The__onlyreal__downsideto__thisassumption__isthat__itis__completely wrong,though__thereasons__forthe__failureare__farfrom__obvious.In__short,when__appliedto__aclass__s method,this__versionof__thetracer__failsbecause__selfis__theinstance__ofthe__decoratorclass__andthe__instanceof__thedecorated__subjectclass__isnot__includedin__*argsat__all.Here__sa__relistingof__theclass__inquestion__toavoid__page flipping:class__tracer: #State__viainstance__attributesdef____init__(self, func): #On__@decorator__self.calls = 0 #Save__funcfor__latercall__self.func =func__def __call__(self, *args, **kwargs): #On__callto__originalfunction__self.calls += 1 print(f'call {self.calls}to__{self.func.__name__}')return__self.func(*args, **kwargs)This__phenomenonwas__introducedabstractly__earlierin__this chapter,but__nowwe__cansee__itin__thecontext__ofworking__code.Example__39-2s__class-baseddecorator__worksas__advertisedearlier__forplain__functions (copy/pasters:don__tcopy__theinitial__...REPL__promptsincluded__inthis__chapterto__preserveindentation__afterdecorator__lines): >>>from__decorator_state_classesimport__tracer >>> @tracer ...def__hack(a, b, c): #hack__= tracer(hack) print(a +b__+ c) #Triggers__tracer.__init__ >>> hack(1, 2, 3) #Runs__tracer.__call__call__1to__hack 6 >>> hack(a=4, b=5, c=6) #hack__savedin__aninstance__attributecall__2to__hack 15 However,decoration__of class-levelmethods__fails (morelucid__sequentialreaders__mightrecognize__thisas__anadaptation__ofour__Personclass__resurrectedfrom__the object-orientedtutorial__inChapter__28): >>>class__Person:def____init__(self, name, pay): self.name =name__self.pay =pay__@tracerdef__giveRaise(self, percent): #giveRaise__= tracer(giveRaise) self.pay *= (1.0 + percent) >>>pat__= Person('Pat Jones', 50_000) #tracer__remembersmethod__funcs >>> pat.giveRaise(.10) #Runs__tracer.__call__(???, .10)call__1to__giveRaise TypeError: Person.giveRaise()missing__1required__positional argument: 'percent'The__rootof__theproblem__hereis__inthe__selfargument__ofthe__tracerclass__s__call____methodis__ita__tracerinstance__ora__Person instance?We__ultimatelyneed__bothas__its__coded:the__tracerfor__decorator state,and__thePerson__forrouting__onto__theoriginal__method. Really,self__mustbe__thetracer__objectto__provideaccess__totracer__sstate__information (itscalls__and func);this__istrue__whetherdecorating__asimple__functionor__a method. Unfortunately,when__ourdecorated__methodname__isrebound__toa__classinstance__objectwith__a __call__,Python__passesonly__thetracer__instanceto__self;it__doesnt__passalong__thePerson__subjectin__thearguments__listat__all. Moreover,because__thetracer__knowsnothing__aboutthe__Personinstance__weare__tryingto__processwith__method calls,there__sno__wayto__createa__boundmethod__withan__instance,and__thus,no__wayto__correctlydispatch__the call.This__isnt__a bug,but__its__wildly subtle.In__the end,the__priorlisting__windsup__passingtoo__fewarguments__tothe__decorated method,and__resultsin__an error.Add__aline__tothe__decorators____call__to__printall__itsarguments__toverify__thisas__youcan__see,self__isthe__tracer instance,and__thePerson__instanceis__entirely absent: >>> pat.giveRaise(.10) <__main__.tracerobject__at 0x108a02c00> (0.10,) {}As__mentioned earlier,this__happensbecause__Pythonpasses__theimplied__subjectinstance__toself__whena__methodname__isbound__toa__simplefunction__only;when__itis__aninstance__ofa__callable class,that__classs__instanceis__passed instead.That__is,Python__makesa__boundmethod__objectcontaining__thesubject__instanceonly__whenthe__methodis__asimple__function,not__whenit__isa__callableinstance__ofanother__class.Using__nestedfunctions__todecorate__methodsIf__youwant__yourfunction__decoratorsto__workon__bothsimple__functionsand__class-level__methods,the__moststraightforward__solutionlies__inusing__oneof__theother__stateretention__solutionsdescribed__earliercode__yourfunction__decoratoras__nesteddef__statementsso__thatyou__dont__dependon__asingle__selfinstance__argumentto__beboth__thewrapper__classinstance__andthe__subjectclass__instance.In__fact,we__alreadyhave__bothExamples__39-4and__39-5work__forboth__functionsand__classmethods__byusing__nestedfunctions__alongwith__nonlocalvariables__orfunction__attributes: >>>from__decorator_state_nonlocalsimport__tracer #See__Example 39-4 >>> @tracer ...def__hack(a, b, c): #Works__forfunctions__print(a +b__+ c) >>> hack(1, 2, 3)call__1to__hack 6 >>>class__Person: #AND__worksfor__methodsdef____init__(self, name, pay): self.name =name__self.pay =pay__@tracerdef__giveRaise(self, percent): #self__includedin__args self.pay *= (1.0 + percent) #Counter__innonlocals__>>>pat__= Person('Pat Jones', 50_000) >>> pat.giveRaise(.10)call__1to__giveRaise >>> pat.giveRaise(.10)call__2to__giveRaise >>> f'{pat.pay:,.2f}' '60,500.00' >>>from__decorator_state_attributesimport__tracer #See__Example 39-5same__correctresults__#Counter__inattributes__Becausedecorated__methodshere__arerebound__tosimple__functionsinstead__ofinstance__objects,Python__correctlypasses__thePerson__objectas__thefirst__argument,and__thedecorator__propagatesit__onin__thefirst__itemof__*argsto__theself__argumentof__the real,decorated__methods.Trace__throughthese__resultsand__decoratorsto__makesure__youhave__ahandle__onthis__model;the__nextsection__providesan__alternativeto__itthat__supportsclasses__butis__alsosubstantially__more complex.Using__descriptorsto__decoratemethods__Althoughthe__nestedfunction__solutionillustrated__inthe__priorsection__isthe__moststraightforward__wayto__supportdecorators__thatapply__toboth__functionsand__class-level__methods,other__schemesare__possible.The__descriptorfeature__weexplored__inthe__prior chapter,for__example,can__helphere__as well.Recall__fromour__discussionin__theprior__chapterthat__adescriptor__isnormally__aclass__attributeassigned__toan__objectwith__a__get____methodrun__automaticallywhenever__thatattribute__isreferenced__and fetched:class__Descriptor:def____get__(self, instance, owner):class__Subject:attr__= Descriptor()X__= Subject() X.attr #Roughly__runs Descriptor.__get__(Subject.attr, X, Subject)Descriptors__mayalso__have__set____and__del____access methods,but__wedon__tneed__them here.More__relevantto__thischapter__s topic:because__thedescriptor__s__get____methodreceives__boththe__descriptorclass__instanceand__subjectclass__instancewhen__invoked,it__swell__suitedto__decoratingmethods__whenwe__needboth__thedecorator__sstate__andthe__originalclass__instancefor__dispatching calls.Consider__thealternative__tracingdecorator__inExample__39-6,which__alsohappens__tobe__adescriptor__whenused__fora__class-levelmethod__(itsare__thesame__asin__theprior__REPL session).Example__39-6. calltracer_desc_class.pyclass__tracer(object): #A__decorator+descriptordef____init__(self, func): #On__@decorator__self.calls = 0 #Save__funcfor__latercall__self.func =func__def __call__(self, *args, **kwargs): #On__callto__original func/meth self.calls += 1 print(f'call {self.calls}to__{self.func.__name__}')return__self.func(*args, **kwargs)def____get__(self, instance, owner): #On__methodattribute__fetchreturn__wrapper(self, instance)class__wrapper:def____init__(self, desc, subj): #Save__bothinstances__self.desc =desc__#Route__callsback__to deco/desc self.subj =subj__def __call__(self, *args, **kwargs):return__self.desc(self.subj, *args, **kwargs) #Runs__tracer.__call__ @tracerdef__hack(a, b, c): #hack__= tracer(hack) #Uses____call__only__class Person: @tracerdef__giveRaise(self, percent): #giveRaise__= tracer(giveRaise) #Makes__giveRaisea__descriptorThis__worksthe__sameas__thepreceding__nestedfunction__coding.Its__operationvaries__byusage__context:Decorated__functionsinvoke__onlyits____call__,and__neverinvoke__its __get__.Decorated__methodsinvoke__its__get____firstto__resolvethe__methodname__fetch (on I.method);the__objectreturned__by__get____retainsthe__subjectclass__instanceand__isthen__invokedto__completethe__call expression,thereby__triggeringthe__decorators____call__ (on ()).For__example,given__thesame__testing code,the__call to: pat.giveRaise(.10) #Runs____get__then____call__runs__tracer.__get__first__becausethe__giveRaiseattribute__inthe__Personclass__hasbeen__reboundto__adescriptor__bythe__methodfunction__decorator.The__callexpression__thentriggers__the__call____methodof__thereturned__wrapper object,which__inturn__invokes tracer.__call__.In__other words,decorated__methodcalls__triggera__five-step process: tracer.__get__,which__invokes wrapper.__init__,followed__bythree__calloperations__wrapper.__call__, tracer.__call__,and__finallythe__originalwrapped__method.The__wrapperobject__retainsboth__descriptorand__subject instances,so__itcan__routecontrol__backto__theoriginal__decorator/descriptorclass__instance.In__effect,the__wrapperobject__savesthe__subjectclass__instanceavailable__duringmethod__attributefetch__andadds__itto__thelater__calls__arguments list,which__ispassed__tothe__decorator__call__.Routing__thecall__backto__thedescriptor__classinstance__thisway__isrequired__inthis__applicationso__thatall__callsto__awrapped__methoduse__thesame__callscounter__stateinformation__inthe__descriptorinstance__object. Alternatively,we__coulduse__anested__functionand__enclosing-scopereferences__toachieve__thesame__effectExample__39-7works__thesame__asthe__precedingone__byswapping__awrapper__classand__attributesfor__anested__functionand__scope references.It__requiresnoticeably__lesscode__butfollows__asimilar__multistepprocess__oneach__decoratedmethod__call.Example__39-7. calltracer_desc_func.pyclass__tracer(object):def____init__(self, func): #On__@decorator__self.calls = 0 #Save__funcfor__latercall__self.func =func__def __call__(self, *args, **kwargs): #On__callto__originalfunc__self.calls += 1 print(f'call {self.calls}to__{self.func.__name__}')return__self.func(*args, **kwargs)def____get__(self, instance, owner): #On__methodfetch__def wrapper(*args, **kwargs): #Retain__bothinst__return self(instance, *args, **kwargs) #Runs____call__return__wrapperrest__sameas__Example 39-6These__two descriptor-basedtracers__workthe__sameas__the nested-functions version,so__well__skiptheir__output here.Add__printstatements__totheir__methodsto__tracetheir__multistep get/callprocesses__ifit__helps.In__either coding,this__descriptor-basedscheme__isalso__substantiallysubtler__thanthe__nested-function option,and__sois__probablya__secondchoice__here.To__bemore__blunt,if__itscomplexity__doesnt__sendyou__screaminginto__the night,its__performancecosts__probably should! Still,this__maybe__auseful__codingpattern__inother__contexts.Before__moving on,it__salso__worthbriefly__notingthat__wemight__codethis__descriptor-baseddecorator__moresimply__asin__Example 39-8,but__itwould__thenapply__onlyto__methods,not__tosimple__functionsan__intrinsiclimitation__ofattribute__descriptors,and__justthe__inverseof__theproblem__were__tryingto__solve (applicationto__bothfunctions__and methods).Example__39-8. calltracer_desc_fail.pyclass__tracer(object): #For__methods,but__not functions!def____init__(self, meth): #On__@decorator__self.calls = 0 self.meth =meth__def __get__(self, instance, owner): #On__methodfetch__def wrapper(*args, **kwargs): #On__method call:proxy__with self+inst self.calls += 1 print(f'call {self.calls}to__{self.meth.__name__}')return__self.meth(instance, *args, **kwargs)return__wrapper @tracer #OK__formethods__butFAILS__forfunctions__def hack(a, b, c): #hack__= tracer(hack) #No__attributefetch__occurson__calls!rest__sameas__Example 39-6In__therest__ofthis__chapterwe__regoing__tobe__casualabout__usingclasses__orfunctions__tocode__ourfunction__decorators,as__longas__theyare__appliedonly__to functions.Some__decoratorsmay__notrequire__theinstance__ofthe__original class,and__willstill__workon__bothfunctions__andmethods__ifcoded__asa__classsomething__likePython__sown__staticmethod decorator,for__example,wouldn__trequire__aninstance__ofthe__subjectclass__(indeed,its__wholepoint__isto__removethe__instancefrom__the call).The__simplermoral__ofthis__story, though,is__thatif__youwant__yourdecorators__towork__onboth__simplefunctions__and methods,you__reprobably__betteroff__usingthe__nested-functioncoding__patterninstead__ofa__classwith__call interception.Timing__FunctionCalls__Tobetter__samplewhat__functiondecorators__arecapable__of,let__sturn__toa__differentuse__case.Our__nextdecorator__timescalls__madeto__adecorated__functionboth__thetime__forone__calland__thetotal__timeamong__all calls.As__codedin__Example 39-9,the__decoratoris__appliedto__twofunctions__tocompare__thespeeds__oflist__comprehensionsand__themap__built-in.Example__39-9. timerdeco1.py "Caveat:timer__won'twork__onmethods__ascoded__(seequiz__solution)"import__time,sys__class timer:def____init__(self, func): self.func =func__self.alltime = 0def____call__(self, *args, **kargs):start__= time.perf_counter()result__= self.func(*args, **kargs)elapsed__= time.perf_counter() -start__self.alltime +=elapsed__print(f'{self.func.__name__}: {elapsed:.5f}, {self.alltime:.5f}')return__result @timerdef__listcomp(N):return__[x * 2for__xin__range(N)] @timerdef__mapcall(N):return__list(map((lambda x:x__* 2), range(N)))if____name__ == '__main__':for__funcin__(listcomp, mapcall):result__= func(5) #Time__forthis__call,result__func(50_000) func(500_000) func(1_000_000) print(result) print(f'allTime = {func.alltime}\n') #Total__timefor__allfunc__calls print('**map/comp =', round(mapcall.alltime / listcomp.alltime, 3))When__runon__amacOS__hostby__CPython 3.12,the__outputof__thisfile__s self-testcode__isas__followsgiving__foreach__functioncall__thefunction__name,time__forthis__call,and__timefor__allcalls__so far,along__withthe__firstcall__sreturn__value,cumulative__timefor__each function,and__the map-to-comprehensiontime__ratioat__the end: $ python3 timerdeco1.py listcomp: 0.00000, 0.00000 listcomp: 0.00366, 0.00366 listcomp: 0.03134, 0.03500 listcomp: 0.05213, 0.08713 [0, 2, 4, 6, 8]allTime__= 0.08712841104716063 mapcall: 0.00001, 0.00001 mapcall: 0.00396, 0.00397 mapcall: 0.04082, 0.04479 mapcall: 0.07789, 0.12268 [0, 2, 4, 6, 8]allTime__= 0.12268476499593817 **map/comp = 1.408Times__varyper__Python version,test__machine,and__other variables,of__course,and__cumulativetime__isavailable__asa__classinstance__attribute here.As__usual,map__callsare__slowerthan__listcomprehensions__whenthe__lattercan__avoida__functioncall__(or equivalently,its__requirementof__functioncalls__maymake__map slower).For__comparison,see__Chapter 21for__anondecorator__approachto__timingiteration__alternativeslike__these.As__a review,we__sawtwo__per-calltiming__techniques there,homegrown__andlibrary__heredeployed__totime__the 1Mlist__comprehensioncase__ofthe__decorators__test code,though__incurringextra__admincosts__thatskew__resultsslightly__(addChapter__21s__folderto__yourPYTHONPATH__or sys.path,or__gothere__torun__this): >>>def__listcomp(N): [x * 2for__xin__range(N)] >>>import__timer #Chapter__21techniques__>>> timer.total(1, listcomp, 1_000_000) (0.08150088600814342, None) >>> timer.bestoftotal(5, 1, listcomp, 1_000_000) (0.059792334999656305, None) >>>import__timeit >>> timeit.timeit(number=1, stmt=lambda: listcomp(1_000_000)) 0.08125517799635418 >>> min(timeit.repeat(repeat=5, number=1, stmt=lambda: listcomp(1_000_000))) 0.06156357398140244In__thisspecific__case,a__nondecoratorapproach__wouldallow__thesubject__functionsto__beused__withor__without timing,but__itwould__alsocomplicate__thecall__signaturewhen__timingis__desiredwe__dneed__toadd__codeat__everycall__insteadof__onceat__the def. Moreover,in__thenondecorator__scheme,there__wouldbe__nodirect__wayto__guaranteethat__alllist__buildercalls__ina__programare__routedthrough__timer logic,short__offinding__andpotentially__changingthem__all.This__maymake__itdifficult__tocollect__cumulativedata__forall__calls.In__general,decorators__maybe__preferredwhen__functionsare__alreadydeployed__aspart__ofa__largersystem__andmay__notbe__easilypassed__toanalysis__functionsat__calls.On__theother__hand,because__decoratorscharge__eachcall__toa__functionwith__augmentation logic,a__nondecoratorapproach__maybe__betterif__youwish__toaugment__callsmore__selectively.As__usual,different__toolsserve__different roles.Adding__DecoratorArguments__Thetimer__decoratorof__theprior__section works,but__itwould__benice__ifit__weremore__configurableproviding__anoutput__labeland__turningtrace__messageson__and off,for__instance,might__beuseful__ina__general-purposetool__like this.Decorator__argumentscome__inhandy__here:when__theyre__coded properly,we__canuse__themto__specifyconfiguration__optionsthat__canvary__foreach__decorated function.A__label,for__instance,might__beadded__asabstractly__follows:def__timer(label=''):def__decorator(func):def__onCall(*args): #Multilevel__state retention: #args__passedto__function func(*args) #func__retainedin__enclosingscope__print(label, ) #label__retainedin__enclosingscope__returnonCall__returndecorator__#Returns__theactual__decorator @timer('==>') #Like__listcomp = timer('==>')(listcomp)def__listcomp(N): #listcomp__isrebound__tonew__onCall listcomp( ) #Really__callsonCall__Thiscode__addsan__enclosingscope__toretain__adecorator__argumentfor__useon__alater__actual call.When__thelistcomp__functionis__defined,Python__reallyinvokes__decoratorthe__resultof__timer,run__beforedecoration__actuallyoccurs__withthe__labelvalue__availablein__itsenclosing__scope.That__is,timer__returnsthe__decorator,which__remembersboth__thedecorator__argumentand__theoriginal__function,and__returnsthe__callable onCall,which__ultimatelyinvokes__theoriginal__functionon__later calls.Because__thisstructure__createsnew__decoratorand__onCall functions,their__enclosingscopes__are per-decorationstate__retention.We__canput__thisstructure__touse__inour__timerto__allowa__labeland__atrace__controlflag__tobe__passedin__atdecoration__time.Example__39-10does__just that,coded__ina__modulefile__soit__canbe__importedas__ageneral__tool;it__usesa__classfor__thesecond__stateretention__levelinstead__ofa__nested function,but__thenet__resultis__similar.Example__39-10. timerdeco2.pyimport__timedef__timer(label='', trace=True): #On__decorator args:retain__argsclass__Timer:def____init__(self, func): #On__@:retain__decoratedfunc__self.func =func__self.alltime = 0def____call__(self, *args, **kargs): #On__calls:call__originalstart__= time.perf_counter()result__= self.func(*args, **kargs)elapsed__= time.perf_counter() -start__self.alltime +=elapsed__if trace:if__label: print(label, end=' ') print(f'{self.func.__name__}: {elapsed:.5f}, {self.alltime:.5f}')return__resultreturn__Timer Mostly,all__weve__donehere__isembed__theoriginal__Timerclass__inan__enclosingfunction__inorder__tocreate__ascope__thatretains__thedecorator__argumentsper__deployment.The__outertimer__functionis__calledbefore__decoration occurs,and__itsimply__returnsthe__Timerclass__toserve__asthe__actual decorator.On__decoration,an__instanceof__Timeris__madethat__remembersthe__decoratedfunction__itself,but__alsohas__accessto__thedecorator__argumentsin__theenclosing__function scope.This__time,rather__thanembedding__self-testcode__inthis__file,we__llrun__thedecorator__ina__different file.Example__39-11is__aclient__ofour__timer decorator,applying__itto__sequenceiteration__alternatives again.Example__39-11. testseqs.pyimport__sysfrom__timerdeco2import__timer @timer(label='[CCC]==>')def__listcomp(N): #Like__listcomp = timer(...)(listcomp)return__[x * 2for__xin__range(N)] # listcomp(...)triggers__Timer.__call__ @timer(trace=True, label='[MMM]==>')def__mapcall(N):return__list(map((lambda x:x__* 2), range(N)))for__funcin__(listcomp, mapcall):result__= func(5) #Time__forthis__call,return__value func(50_000) func(500_000) func(1_000_000) print(result) print(f'allTime = {func.alltime}\n') #Total__timefor__allcalls__print('**map/comp =', round(mapcall.alltime / listcomp.alltime, 3))When__run,this__fileprints__thefollowing__eachdecorated__functionnow__hasa__labelof__itsown__definedby__decorator arguments,which__maybe__moreuseful__whenwe__needto__findtrace__displaysmixed__inwith__alarger__programs__output: $ python3 testseqs.py [CCC]==> listcomp: 0.00000, 0.00000 [CCC]==> listcomp: 0.00379, 0.00379 [CCC]==> listcomp: 0.03142, 0.03521 [CCC]==> listcomp: 0.05188, 0.08709 [0, 2, 4, 6, 8]allTime__= 0.08709081003325991 [MMM]==> mapcall: 0.00001, 0.00001 [MMM]==> mapcall: 0.00401, 0.00402 [MMM]==> mapcall: 0.04025, 0.04427 [MMM]==> mapcall: 0.07776, 0.12203 [0, 2, 4, 6, 8]allTime__= 0.12203056103317067 **map/comp = 1.401Run__additionaltests__onyour__ownto__seehow__thedecorator__sconfiguration__argumentscome__into play.As__is,this__timingfunction__decoratorcan__beused__forany__function,both__inmodules__and interactively.In__other words,it__automaticallyserves__asa__general-purposetool__fortiming__codein__our scripts.Watch__foradditional__examplesof__decoratorarguments__aheadwhen__wecode__decoratorsto__implementattribute__privacyand__argumentrange__checking.NOTE__Timing methods:This__sections__timerdecorator__workson__any function,but__aminor__rewriteis__requiredto__applyit__to class-levelmethods__too.In__short,and__perClass__Pitfall:Decorating__Methods ,it__mustavoid__usinga__nested class.Because__thislast__mutationis__beingsaved__foran__end-of-chapterquiz__question, though,you__llhave__tostay__tunedfor__itsfinal__code.Coding__ClassDecorators__So far,we__vebeen__codingfunction__decoratorsto__managefunction__calls,but__aswe__ve seen,decorators__workon__classes too.As__described earlier,while__similarin__conceptto__function decorators,class__decoratorsare__appliedto__classesinstead__theymay__beused__eitherto__manageclasses__themselvesor__tointercept__instance-creation__callsin__orderto__manage instances.Also__likefunction__decorators,class__decoratorsare__reallyjust__optionalsyntactic__sugar,though__theycan__makea__programmers__intentmore__obviousand__minimizeerroneous__ormissed__calls.Singleton__ClassesLet__sstart__withsomething__simple.By__intercepting instance-creation calls,class__decoratorscan__beused__toeither__manageall__theinstances__ofa__class,or__augmentthe__interfacesof__those instances.Example__39-12lists__afirst__classdecorator__examplethat__doesthe__formermanaging__allinstances__ofa__class.This__codeimplements__theclassic__singletoncoding__pattern,where__atmost__oneinstance__ofa__classever__exists.Its__singletonfunction__definesand__returnsa__functionfor__managing instances,and__the @syntax__automaticallywraps__upa__subjectclass__inthis__function.Example__39-12. singletons1.pyinstances__= {}def__singleton(aClass): #On__@decoration__def onCall(*args, **kwargs): #On__instancecreation__ifaClass__notin__instances: #One__dictentry__perclass__instances[aClass] = aClass(*args, **kwargs)return__instances[aClass]return__onCallTo__use this,decorate__theclasses__forwhich__youwant__toenforce__a single-instance model,as__inExample__39-13.Example__39-13. singletons-test.pyfrom__singletons1import__singleton @singleton #Person__= singleton(Person)class__Person: #Rebinds__Personto__onCalldef____init__(self, name, hours, rate): #onCall__remembersPerson__self.name =name__self.hours =hours__self.rate =rate__def pay(self):return__self.hours * self.rate @singleton #Hack__= singleton(Hack)class__Hack: #Rebinds__Hackto__onCalldef____init__(self, val): #onCall__remembersHack__self.attr =val__sue = Person('Sue', 50, 20) #Really__callsonCall__print(sue.name, sue.pay())bob__= Person('Bob', 40, 10) # Same,single__object print(bob.name, bob.pay())X__= Hack(val=42) #One__Person,one__HackY__= Hack(99) print(X.attr, Y.attr) Now,when__thePerson__orHack__classis__laterused__tocreate__an instance,the__wrappinglogic__layerprovided__bythe__decoratorroutes__instance-creationcalls__to onCall,which__inturn__ensuresa__singleinstance__per class,regardless__ofhow__manyconstruction__callsare__made.Here__sthis__codes__outputwhen__runvia__command line: $ python3 singletons.pySue__1000Sue__1000 42 42Singleton__codingalternatives__Interestingly,you__cancode__amore__self-containedsolution__herewith__thenonlocal__statementto__change enclosing-scopenames__asdescribed__earlier.The__followingalternative__achievesan__identical effect,by__usingone__enclosingscope__per class,instead__ofone__globaltable__entryper__class.It__worksthe__same,but__itdoes__notdepend__onnames__inthe__globalscope__outsidethe__decorator (theNone__checkcould__useis__insteadof__== here,but__its__atrivial__testeither__way):def__singleton(aClass): #On__@decoration__instance =None__def onCall(*args, **kwargs): #On__instancecreation__nonlocalinstance__ifinstance__== None:instance__= aClass(*args, **kwargs) #One__scopeper__classreturn__instancereturn__onCallYou__canalso__codea__self-containedsolution__witheither__functionattributes__ora__class instead.The__firstof__thefollowing__codesthe__former,leveraging__thefact__thatthere__willbe__oneonCall__functionper__decorationthe__functionobject__snamespace__servesthe__samerole__asan__enclosing scope.The__seconduses__oneinstance__per decoration,rather__thanan__enclosing scope,function__object,or__global table.In__fact,the__secondoption__relieson__thesame__codingpattern__thatwe__willlater__labela__commondecorator__classpitfall__herewe__wantjust__one instance,but__thats__notoften__the case:def__singleton(aClass): #On__@decoration__def onCall(*args, **kwargs): #On__instancecreation__if onCall.instance == None: onCall.instance = aClass(*args, **kwargs) #One__functionper__classreturn__onCall.instance onCall.instance =None__returnonCall__class singleton:def____init__(self, aClass): #On__@decoration__self.aClass =aClass__self.instance =None__def __call__(self, *args, **kwargs): #On__instancecreation__if self.instance == None: self.instance = self.aClass(*args, **kwargs) #One__instanceper__classreturn__self.instanceTo__makethis__singletondecorator__afully__general-purpose tool,choose__one version,store__itin__animportable__module file,and__indentthe__self-testcode__undera____name__check__stepswe__llleave__assuggested__exercise.The__final class-based__versionoffers__anexplicit__optionwith__extrastructure__thatmay__bettersupport__later evolution,but__OOPmight__notbe__warrantedin__all contexts.Tracing__ObjectInterfaces__Thesingleton__exampleof__theprior__sectionillustrated__usingclass__decoratorsto__manageall__theinstances__ofa__class.Another__commonuse__casefor__classdecorators__augmentsthe__interfaceof__eachgenerated__instance.Class__decoratorscan__essentiallyinstall__awrapper__orproxy__logiclayer__atopinstances__thatmanages__accessto__their interfaces.For__example,in__Chapter 31,the____getattr__ operator-overloadingmethod__wasshown__asa__wayto__wrapup__entireobject__interfacesof__embeddedinstances__inorder__toimplement__thedelegation__coding pattern.We__sawsimilar__examplesin__themanaged__attributecoverage__ofthe__prior chapter.Recall__that__getattr____isrun__whenan__undefinedattribute__nameis__fetched;we__canuse__thishook__tointercept__methodcalls__ina__controllerclass__andpropagate__themto__anembedded__object.The__nondecoratorapproach__Forreference__and review,here__sthe__originalnondecorator__delegation example:class__Wrapper:def____init__(self, object): self.wrapped =object__#Save__objectdef____getattr__(self, attrname): print('Trace:', attrname) #Trace__fetchreturn__getattr(self.wrapped, attrname) #Delegate__fetchx__= Wrapper([1,2,3]) #Wrap__alist__object x.append(4) #Delegate__tolist__methodIn__this code,the__Wrapperclass__interceptsaccess__toany__ofthe__wrappedobject__sexplicitly__named attributes,prints__atrace__message,and__usesthe__getattr built-into__passoff__therequest__tothe__wrapped object. Specifically,it__tracesattribute__accessesmade__outsidethe__wrappedobject__s class;accesses__insidethe__wrappedobject__smethods__arenot__caughtand__runnormally__by design.This__whole-interface__modeldiffers__fromthe__behaviorof__function decorators,which__wrapup__justone__specific method.The__class-decoratorapproach__Classdecorators__providean__alternativeand__convenientway__tocode__this__getattr____techniqueand__wrapan__entire interface.The__preceding code,for__example,can__becoded__asa__classdecorator__thattriggers__wrappedinstance__creationinstead__ofpassing__apremade__instanceinto__thewrapper__s constructor.Example__39-14codes__this mod,also__supportskeyword__argumentswith__**kargs,and__countsthe__numberof__accessesto__illustratechangeable__state.Example__39-14. interfacetracer.pydef__Tracer(aClass): #On__@decorator__class Wrapper:def____init__(self, *args, **kargs): #On__instancecreation__self.fetches = 0 self.wrapped = aClass(*args, **kargs) #Use__enclosing-scopename__def __getattr__(self, attrname): print('Trace: ' + attrname) #Catches__allbut__ownattrs__self.fetches += 1return__getattr(self.wrapped, attrname) #Delegate__towrapped__objreturn__Wrapperif____name__ == '__main__': @Tracerclass__Hack: #Hack__= Tracer(Hack)def__display(self): #Hack__isrebound__toWrapper__print('Hack!' * 3) @Tracerclass__Person: #Person__= Tracer(Person)def____init__(self, name, hours, rate): #Wrapper__remembersPerson__self.name =name__self.hours =hours__self.rate =rate__def pay(self): #Accesses__outsideclass__tracedreturn__self.hours * self.rate # In-methodaccesses__nottraced__work = Hack() #Triggers__Wrapper() work.display() #Triggers____getattr__ print([work.fetches]) print()bob__= Person('Bob', 40, 50) #bob__isreally__aWrapper__print(bob.name) #Wrapper__embedsa__Person print(bob.pay()) print()sue__= Person('Sue', rate=100, hours=60) #sue__isa__differentWrapper__print(sue.name) #With__adifferent__Person print(sue.pay()) print() print(bob.name) # bob'sstate__!= sue'sstate__print(bob.pay()) print('calls:', [bob.fetches, sue.fetches]) #Wrapper__attrsare__nottraced__Its__importantto__notethat__thisis__verydifferent__fromthe__tracerdecorator__wemet__earlier (despitethe__name!).In__CodingFunction__Decorators ,we__lookedat__decoratorsthat__enabledus__totrace__andtime__callsto__agiven__functionor__method.In__contrast,by__intercepting instance-creation calls,the__classdecorator__hereallows__usto__tracean__entireobject__interfacethat__is,accesses__toany__ofthe__instances__attributes.It__salso__importantto__notethat__thisdecorator__s__getattr____wont__catchthe__implicitattribute__fetchesof__built-inoperations__perthe__prior chapter,but__well__defermore__onthis__subjectuntil__wecode__attributeprivacy__ahead.The__followingis__theoutput__producedby__this code:attribute__fetcheson__instancesof__boththe__Hackand__Personclasses__invokethe____getattr__logic__inthe__Wrapperclass__because work,and__bob,and__sueare__reallyinstances__of Wrapper,thanks__tothe__decorators__redirectionof__instance-creation calls: $ python3 interfacetracer.py Trace:display__Hack!Hack!Hack! [1] Trace:name__Bob Trace:pay__2000 Trace:name__Sue Trace:pay__6000 Trace:name__Bob Trace:pay__2000 calls: [4, 2]Notice__howthere__isone__Wrapperclass__withstate__retentionper__decoration,generated__bythe__nestedclass__statementin__theTracer__function,and__howeach__instancegets__itsown__fetchescounter__byvirtue__ofgenerating__anew__Wrapper instance.As__youll__see ahead,orchestrating__thisis__trickierthan__youmay__expect.Applying__classdecorators__to built-intypes__Alsonotice__thatthe__precedingdecorates__a user-defined class.Just__likein__theoriginal__examplein__Chapter 31,we__canalso__usethe__decoratorto__wrapup__a built-in__objecttype__suchas__a list,as__longas__weeither__subclassto__allowdecoration__syntaxor__performthe__decorationrebinding__manuallydecorator__syntaxrequires__aclass__statementfor__the @ line.In__the following,x__isreally__aWrapper__againdue__tothe__indirectionof__decoration: >>>from__interfacetracerimport__Tracer >>> @Tracer ...class__MyList(list):pass__#MyList__= Tracer(MyList) >>>x__= MyList([1, 2, 3]) #Triggers__Wrapper() >>> x.append(4) #Triggers____getattr__,append__Trace:append__>>> x.wrapped [1, 2, 3, 4] >>>MyList__= Tracer(list) #Or__performdecoration__manually >>>x__= MyList([4, 5, 6]) #Else__subclassstatement__required >>> x.append(7) Trace:append__>>> x.wrapped [4, 5, 6, 7]The__decoratorapproach__allowsus__tomove__instancecreation__intothe__decoratoritself__insteadof__requiringa__premadeobject__tobe__passed in.Although__thisseems__likea__minor difference,it__letsus__retainnormal__instance-creationsyntax__andlimits__augmentationsyntax__toclass__definition.Rather__thanrequiring__all instance-creation__callsto__routeobjects__througha__wrapper manually,we__needonly__augmentclass__definitionswith__decorator syntax: @Tracer #Decorator__approachclass__Person:bob__= Person('Bob', 40, 50)sue__= Person('Sue', rate=100, hours=60)class__Person: #Nondecorator__approachbob__= Wrapper(Person('Bob', 40, 50))sue__= Wrapper(Person('Sue', rate=100, hours=60))Assuming__youwill__makemore__thanone__instanceof__aclass__andwant__toapply__theaugmentation__toevery__instanceof__a class,decorators__willgenerally__bea__netwin__interms__ofboth__codesize__andcode__maintenance.Class__Pitfall:Retaining__MultipleInstances__Curiously,the__decoratorfunction__inthe__precedingexample__canalmost__becoded__asa__classinstead__ofa__functionwith__theproper__operator-overloading protocol.Example__39-15s__alternativecoding__workssimilarly__becauseits____init__is__triggeredwhen__the @decorator__isapplied__tothe__class,and__its__call____istriggered__whena__subjectclass__instanceis__created.Our__objectsare__reallyinstances__ofTracer__this time,and__weessentially__justtrade__an enclosing-scopereference__foran__instanceattribute__here.Example__39-15. interfacetracer-fail.py (start)class__Tracer:def____init__(self, aClass): #On__@decorator self.aClass =aClass__#Use__instanceattribute__def __call__(self, *args): #On__instancecreation__self.wrapped = self.aClass(*args) #ONE__(LAST)INSTANCE__PER CLASS!return__selfdef____getattr__(self, attrname): print('Trace:', attrname)return__getattr(self.wrapped, attrname) @Tracer #Triggers____init__class__Hack: # Like:Hack__= Tracer(Hack)def__display(self): print('Hack!' * 3)work__= Hack() #Triggers____call__ work.display() #Triggers____getattr__As__wesaw__inthe__abstract earlier, though,this__class-onlyalternative__handlesmultiple__classesas__before,but__itwon__tquite__workfor__multipleinstances__ofa__given class:each__instance-creationcall__triggers __call__,which__overwritesthe__prior instance.The__neteffect__isthat__Tracersaves__justone__instancethe__lastone__created.Example__39-16extends__thisfile__todemo__the problem.Example__39-16. interfacetracer-fail.py (continued) @Tracerclass__Person: #Person__= Tracer(Person)def____init__(self, name): #Person__reboundto__aTracer__self.name =name__bob = Person('Bob') #bob__isreally__aTracer__print(bob.name) #Tracer__embedsa__Personsue__= Person('Sue') print(sue.name) #sue__overwritesbob__print(bob.name) # OOPS:now__bob'sname__is 'Sue'!This__codes__outputfollows__becausethis__traceronly__hasa__singleshared__instance,the__secondoverwrites__the first: $ python3 interfacetracer-fail.py Trace:display__Hack!Hack!Hack! Trace:name__Bob Trace:name__Sue Trace:name__SueThe__problemhere__isbad__stateretention__wemake__onedecorator__instanceper__classbut__notper__class instance,such__thatonly__thelast__instanceis__retained.The__solution,as__inour__priorclass__pitfallfor__decorating methods,lies__inabandoning__class-based decorators.The__earlier function-basedTracer__versionof__Example 39-14, however,does__workfor__multiple instances.Because__itreturns__aclass__insteadof__aninstance__ofthat__class,each__instance-creationcall__makesa__newWrapper__instanceinstead__ofoverwriting__thestate__ofa__singleshared__Tracer instance.The__originalnondecorator__versionhandles__multipleinstances__correctlyfor__thesame__reason.The__moral here:decorators__arenot__onlyarguably__magical,they__canalso__beincredibly__subtle! Example:Private__andPublic__AttributesThe__finaltwo__sectionsof__thischapter__presentlarger__examplesof__decorator use,which__giveus__achance__tosee__howconcepts__cometogether__inmore__useful code.Both__arepresented__withminimal__description,partly__toconserve__spacebut__mostlybecause__youshould__alreadyunderstand__decoratorbasics__wellenough__tobe__ableto__studythese__onyour__own.Implementing__PrivateAttributes__First up,the__classdecorator__inExample__39-17implements__aPrivate__declarationand__accesschecks__forclass__instanceattributes__that is,for__attributesstored__onan__instance,or__inheritedfrom__oneof__its classes.This__decoratordisallows__fetchand__changeaccess__tosuch__attributesfrom__outsidethe__decoratedclass__butstill__allowsthe__classitself__toaccess__thosenames__freelywithin__itsown__methods.It__snot__quitethe__sameas__privatein__C++or__Javaand__Pythonis__notabout__controlin__generalbut__thisdecorator__demoprovides__similaraccess__validationsas__anoption__inPython__forthe__rareand__atypicalcases__wherethis__mightbe__usefulduring__development.We__sawan__initialand__incompleteimplementation__ofinstance__attributeprivacy__forchanges__onlyin__Chapter 30.The__versionhere__extendsthis__conceptto__validateattribute__fetches, too,and__ituses__delegationinstead__ofinheritance__toimplement__the model.In__a sense,this__isalso__justan__extensionto__the attribute-tracerclass__decoratorwe__met earlier.Although__thisexample__utilizesthe__syntacticsugar__ofclass__decoratorsto__codeattribute__privacy,its__attributeinterception__isultimately__stillbased__uponthe____getattr__and____setattr__ operator-overloadingmethods__wemet__inprior__chapters.When__aprivate__attributeaccess__is detected,this__versionuses__theraise__statementto__raisean__exception,along__withan__error message;the__exceptionmay__becaught__ina__tryor__allowedto__terminatethe__accessing script.Example__39-17lists__thedecorator__s first-cut code,along__witha__self-testat__thebottom__ofthe__file.As__coded,it__catchesall__explicitattribute__fetches,but__notthe__implicitfetches__of built-inoperations__(moreon__thisin__a moment).Example__39-17. access1.py """Class__decoratorwith__Privateattribute__declarations.Privacy__forattributes__fetchedfrom__class instances.See__self-testcode__atend__offile__fora__usage example.Rebinding__is:Doubler__= Private('data', 'size')(Doubler).Private__returns onDecorator,onDecorator__returns onInstance,and__eachonInstance__instanceembeds__anew__Doubler instance. """traceMe__=False__def trace(*args):if__traceMe: print(f'[{' '.join(map(str, args))}]') #Python__3.12+ f-stringdef__Private(*privates): #privates__inenclosing__scopedef__onDecorator(aClass): #aClass__inenclosing__scopeclass__onInstance: #wrapped__ininstance__attributedef____init__(self, *args, **kargs): self.wrapped = aClass(*args, **kargs)def____getattr__(self, attr): #My__attrs don'tcall__getattr trace('get:', attr) #Others__assumedin__wrappedif__attrin__privates:raise__TypeError('privateattribute__fetch, ' + attr) else:return__getattr(self.wrapped, attr)def____setattr__(self, attr, value): #Outside__accesses trace('set:', attr, value) #Others__runnormally__ifattr__== 'wrapped': #Allow__myattrs__self.__dict__[attr] =value__#Avoid__loopingelif__attrin__privates:raise__TypeError('privateattribute__change, ' + attr) else: setattr(self.wrapped, attr, value) #Wrapped__objattrs__returnonInstance__returnonDecorator__if__name____== '__main__':traceMe__=True__@Private('data', 'size') #Doubler__= Private(...)(Doubler)class__Doubler:def____init__(self, label, start): self.label =label__#Accesses__insidethe__subjectclass__self.data =start__#Not__intercepted:run__normallydef__size(self):return__len(self.data) #Method__bodiesrun__withno__checkingdef__double(self): #Because__privacynot__inheritedfor__iin__range(self.size()): self.data[i] = self.data[i] * 2def__display(self): print(f'{self.label} => {self.data}') print('Making instances...')X__= Doubler('X is', [1, 2, 3])Y__= Doubler('Y is', [-10, -20, -30]) #The__followingall__succeedproperly__print('\nExploringX__instance...') print(X.label) #Accesses__outsidesubject__class X.display(); X.double(); X.display() # Intercepted: validated,delegated__print('\nExploringY__instance...') print(Y.label) Y.display(); Y.double() Y.label = 'Hack' Y.display() #The__followingall__failproperly__""" print(X.size()) #Prints__"TypeError:private__attribute fetch, size" print(X.data) X.data = [1, 1, 1] #Prints__"TypeError:private__attribute change, data" X.size =lambda__S: 0 print(Y.data) print(Y.size()) """When__itstraceMe__is True,the__modulefile__s self-testcode__producesthe__following output.Notice__howthe__decoratorcatches__andvalidates__bothattribute__fetchesand__assignmentsrun__outsideof__thewrapped__classbut__doesnot__catchattribute__accessesinside__theclass__itself: $ python3 access1.pyMaking__instances... [set:wrapped__<__main__.Doublerobject__at 0x1059c7d70>] [set:wrapped__<__main__.Doublerobject__at 0x1059c7da0>]Exploring__X instance... [get: label]X__is [get: display]X__is => [1, 2, 3] [get: double] [get: display]X__is => [2, 4, 6]Exploring__Y instance... [get: label]Y__is [get: display]Y__is => [-10, -20, -30] [get: double] [set:label__Hack] [get: display]Hack__=> [-20, -40, -60]Implementation__DetailsI__Thiscode__is nontrivial,and__youre__probablybest__offtracing__throughit__onyour__ownto__seehow__it works.To__helpyou__study, though,here__area__fewhighlights__worth mentioning.Inheritance__versusdelegation__Theinitial__andlimited__privacyexample__shownin__Chapter 30used__inheritanceto__mixin__a__setattr____tocatch__accesses.Inheritance__makesthis__difficult, however,because__differentiatingbetween__accessesfrom__insideor__outsidethe__classis__notstraightforward__(insideaccess__shouldbe__allowedto__run normally,and__outsideaccess__shouldbe__restricted).To__workaround__this,the__Chapter 30example__requiresinheriting__classesto__use__dict____assignmentsto__setattributes__anincomplete__solutionat__best.The__versionhere__usesdelegation__(embeddingone__objectinside__another)instead__of inheritance;this__patternis__bettersuited__toour__taskas__itmakes__itmuch__easierto__distinguishbetween__accessesinside__andoutside__ofthe__subject class.Attribute__accessesfrom__outsidethe__subjectclass__areintercepted__bythe__wrapperlayer__soverloading__methodsand__delegatedto__theclass__if valid.Accesses__insidethe__classitself__(i.e.,through__selfwithin__itsmethods__code)are__notintercepted__andare__allowedto__runnormally__withoutchecks__becauseprivacy__isnot__inheritedin__this version.Decorator__argumentsThe__classdecorator__usedhere__acceptsany__numberof__argumentsto__nameprivate__attributes. Again, though,this__simplymeans__thatthe__argumentsare__passedto__thePrivate__function,and__Privatereturns__thedecorator__functionto__beapplied__tothe__subject class.That__is,the__argumentsare__usedbefore__decorationever__occurs;Private__returnsthe__decorator,which__inturn__remembersthe__privateslist__asan__enclosing-scope reference.State__retentionand__enclosingscopes__Speakingof__enclosing scopes,there__areactually__threelevels__ofstate__retentionat__workin__this code:The__argumentsto__Privateare__usedbefore__decorationoccurs__andare__retainedas__an enclosing-scopereference__foruse__inboth__onDecoratorand__onInstance.The__classargument__toonDecorator__isused__atdecoration__timeand__isretained__asan__enclosing-scopereference__foruse__at instance-creation time.The__wrappedinstance__objectis__retainedas__aninstance__attributein__theonInstance__proxyobject__foruse__whenattributes__arelater__accessedfrom__outsidethe__class.This__allworks__fairly naturally,given__Pythons__scopeand__namespace rules.Using____dict__and____slots__ (andother__virtuals)The____setattr__method__inthis__coderelies__onan__instanceobject__s__dict____attributenamespace__dictionaryin__orderto__setonInstance__sown__wrapped attribute.As__welearned__inthe__prior chapter,this__methodcannot__assignan__attributedirectly__without looping. However,it__usesthe__setattr built-ininstead__of__dict____toset__attributesin__thewrapped__object itself. Moreover,getattr__isused__tofetch__attributesin__thewrapped__objectsince__theymay__bestored__inthe__objectitself__orinherited__by it.Because__of that,this__codewill__workfor__mostclasses__includingthose__withvirtual__class-levelattributes__basedon__slots, properties, descriptors,and__even__getattr____andits__ilk.By__assuminga__namespacedictionary__foritself__onlyand__using storage-neutraltools__forthe__wrapped object,the__wrapperclass__avoidslimitations__imposedby__other tools.For__example,you__mayrecall__fromChapter__32that__classeswith____slots__may__notstore__attributesin__a __dict__,and__in fact,may__noteven__haveone__ofthese__at all. However,because__werely__ona____dict__only__atthe__onInstancelevel__hereand__notin__thewrapped__instance,this__concerndoes__not apply.Class__onInstancewill__havea____dict__itself__becauseit__doesnot__use slots.In__addition,because__setattrand__getattrapply__toattributes__basedon__both__dict____and __slots__,our__decoratorapplies__towrapped__classesusing__eitherstorage__scheme.By__thesame__reasoning,the__decoratoralso__appliesto__propertiesand__similar tools:delegated__nameswill__belooked__upanew__inthe__wrapped instance,irrespective__ofattributes__ofthe__decoratorproxy__object itself.Generalizing__forPublic__DeclarationsNow__thatwe__havea__Privateattribute__implementation,it__sstraightforward__togeneralize__thecode__toallow__forPublic__declarationstoo__theyare__essentiallythe__inverseof__Private declarations,so__weneed__onlynegate__theinner__test.The__examplelisted__inExample__39-18allows__aclass__touse__decoratorsto__definea__setof__eitherPrivate__orPublic__instanceattributes__attributesof__anykind__storedon__aninstance__orinherited__fromits__classeswith__thefollowing__semantics:Private__declaresattributes__ofa__classs__instancesthat__cannotbe__fetchedor__assignedexcept__fromwithin__thecode__ofthe__classs__methods.That__is,any__namedeclared__Privatecannot__beaccessed__fromoutside__the class,while__anyname__notdeclared__Privatecan__befreely__fetchedor__assignedfrom__outsidethe__class.Public__declaresattributes__ofa__classs__instancesthat__canbe__fetchedor__assignedfrom__bothoutside__theclass__andwithin__theclass__s methods.That__is,any__namedeclared__Publiccan__befreely__accessed anywhere,while__anyname__notdeclared__Publiccannot__beaccessed__fromoutside__the class.Private__andPublic__declarationsare__mutually exclusive:when__using Private,all__undeclarednames__areconsidered__Public,and__whenusing__Public,all__undeclarednames__areconsidered__Private.They__areessentially__opposites,though__undeclarednames__notcreated__bya__classs__methodsbehave__slightlydifferently__newnames__canbe__assignedand__thuscreated__outsidethe__classunder__Private (allundeclared__namesare__accessible)but__notunder__Public (allundeclared__namesare__inaccessible). Again,study__thiscode__onyour__ownto__geta__feelfor__howthis__works.Notice__thatthis__schemeadds__anadditional__fourthlevel__ofstate__retentionat__the top,beyond__thatdescribed__inthe__preceding section:the__validationfunctions__usedby__thelambdas__aresaved__inan__extraenclosing__scopecoded__separately.This__versioncomes__withthe__samecaveat__asits__predecessorfor__attributesof__built-in operations,noted__inthe__files__docstringand__expandedon__afterthe__example.Example__39-18. access2.py """Class__decoratorwith__Privateand__Publicattribute__declarations.Controls__externalaccess__toattributes__storedon__an instance,or__inheritedby__itfrom__its classes.Private__declaresattribute__namesthat__cannotbe__fetchedor__assignedoutside__thedecorated__class,and__Publicdeclares__allthe__namesthat__can.Choose__either decorator. Caveat:as__is,this__worksfor__explicitly-namedattributes__only.The____X__ operator-overloadingmethods__fetchedimplicitly__for built-inoperations__donot__triggereither____getattr__or____getattribute__,and__hence won'tbe__delegatedto__anywrapped__objectsthat__define them.If__needed,add____X__methods__tocatch__anddelegate__built-ins (per ahead). """traceMe__=False__def trace(*args):if__traceMe: print('[' + ' '.join(map(str, args)) + ']')def__accessControl(failIf):def__onDecorator(aClass):class__onInstance:def____init__(self, *args, **kargs): self.__wrapped = aClass(*args, **kargs)def____getattr__(self, attr): trace('get:', attr)if__failIf(attr):raise__TypeError('privateattribute__fetch, ' + attr) else:return__getattr(self.__wrapped, attr)def____setattr__(self, attr, value): trace('set:', attr, value)if__attr == '_onInstance__wrapped': self.__dict__[attr] =value__elif failIf(attr):raise__TypeError('privateattribute__change, ' + attr) else: setattr(self.__wrapped, attr, value)return__onInstancereturn__onDecoratordef__Private(*attributes):return__accessControl(failIf=(lambda attr:attr__in attributes))def__Public(*attributes):return__accessControl(failIf=(lambda attr:attr__notin__attributes))See__theprior__examples__self-testcode__fora__usageexample__theeffect__isthe__samefor__Private.Here__sa__quicklook__atthese__classdecorators__inaction__atthe__interactive prompt.As__advertised, non-Privateor__Publicnames__canbe__fetchedand__changedfrom__outsidethe__subject class,but__Privateor__non-Publicnames__cannot: >>>from__access2import__Private,Public__>>> @Private('age') #Person__= Private('age')(Person) ...class__Person: #Person__=onInstance__withstate__def __init__(self, name, age): self.name =name__self.age =age__#Inside__accessesrun__normally >>>X__= Person('Pat', 40) >>> X.name #Outside__accessesvalidated__'Pat' >>> X.name = 'Sue' >>> X.name 'Sue' >>> X.age TypeError:private__attribute fetch,age__>>> X.age = 'Bob' TypeError:private__attribute change,age__>>> @Public('name') ...class__Person:def____init__(self, name, age): self.name =name__self.age =age__>>>X__= Person('Pat', 40) #X__isan__onInstance >>> X.name #onInstance__embedsPerson__'Pat' >>> X.name = 'Sue' >>> X.name 'Sue' >>> X.age TypeError:private__attribute fetch,age__>>> X.age = 'Bob' TypeError:private__attribute change,age__ImplementationDetails__IITo__helpyou__analyzeExample__39-18s__code,here__area__fewfinal__noteson__this version.Since__thisis__justa__generalizationof__thepreceding__sections__version,the__implementationnotes__thereapply__hereas__well.Using____Xpseudoprivate__namesBesides__generalizing,this__versionalso__makesuse__ofPython__s__X__pseudoprivatename__mangling feature,which__wemet__inChapter__31,to__localizethe__wrappedattribute__tothe__proxycontrol__classby__automaticallyprefixing__itwith__thisclass__s name.This__avoidsthe__priorversion__srisk__forcollisions__witha__wrappedattribute__thatmay__beused__bythe__real,wrapped__class,and__its__usefulin__ageneral__toollike__this.It__snot__quite privacy, though,because__themangled__versionof__thename__canbe__usedfreely__outsidethe__class.Notice__thatwe__alsohave__touse__thefully__expandedname__string '_onInstance__wrapped'as__an admin-nametest__valuein____setattr__because__thats__whatPython__changesit__to.Breaking__privacyAlthough__thisexample__doesimplement__accesscontrols__forattributes__ofan__instanceand__its classes,it__ispossible__tosubvert__thesecontrols__triviallyfor__instance,by__fetchingthrough__theexpanded__versionof__thewrapped__attributeexplicitly__(bob.paymight__not work,but__thefully__mangled bob._onInstance__wrapped.pay could!).If__youhave__totry__thathard__tobreak__them, though,these__toolsprobably__sufficefor__intended roles.Of__course,privacy__cangenerally__besubverted__inother__languagestoo__(e.g., #defineprivate__publicmay__workin__some C++ implementations).Although__accesscontrols__mayreduce__accidental mods,much__ofthis__isup__toprogrammers__inany__language;whenever__sourcecode__maybe__changed,airtight__accesscontrol__willalways__bea__pipe dream.More__fundamentally,Python__isabout__enabling,not__controlling;privacy__isa__toolbest__usedsparingly__(ifat__all).Decorator__trade-offsWe__couldagain__achievethe__sameresults__withoutdecorators__byusing__helperfunctions__orcoding__thename__rebindingof__decorators manually;the__decorator syntax, however,makes__thisconsistent__andobvious__in code.The__chiefpotential__downsidesof__thisand__anyother__wrapper-basedapproach__arethat__attributeaccess__incursan__extra call,and__instancesof__decoratedclasses__arenot__reallyinstances__ofthe__originaldecorated__classif__youtest__theirtype__with X.__class__or__isinstance(X, C),for__example,you__llfind__thatthey__areinstances__ofthe__wrapper class.Unless__youplan__todo__introspectionon__objects types, though,the__typeissue__is irrelevant,and__theextra__callmay__applymostly__todevelopment__time;as__youll__see later,it__spossible__toremove__decorationsautomatically__(via -O)if__desired.Delegating__Built-InOperations__As is,this__sections__exampleswork__asplanned__formethods__andother__attributesfetched__explicitlyby__name.As__withmost__software, though,there__isalways__roomfor__improvement.Most__notably,this__toolturns__inmixed__performanceon__operator-overloadingmethods__ifthey__areused__byclient__classes. Specifically,the__proxyclass__failsto__validateor__delegate operator-overloadingmethods__fetchedimplicitly__by built-inoperations__unlesssuch__methodsare__redefinedin__the proxy.Clients__thatdo__notuse__operatoroverloading__arefully__supported,but__othersmay__requireadditional__code.It__sunclear__that operator-overloading__methodsshould__bevalidated__asprivate__or public,but__theyare__apart__ofan__objects__interfaceand__shouldat__leastbe__routedto__wrappedobjects__thatdefine__them.We__veencountered__thisissue__afew__timesalready__inthis__book,but__lets__takea__quicklook__atits__impacton__therealistic__codewe__vewritten__hereand__exploreworkarounds__for it.The__basicissue__iseasy__todemo__aswe__ve learned,the__followingis__howa__classthat__overloadsprint__callsand__+expressions__normally works: >>>class__Tally:def____init__(self): self.sum = 0def____str__(self):return__f'Tally: {self.sum}'def____add__(self, add): self.sum +=add__>>>X__= Tally() >>> X.sum #All__attributesaccessible__0 >>> print(X) #Same__as X.__str__() {sort of} Tally: 0 >>>X__+ 5 #Same__as X.__add__(5) {ditto} >>> print(X) Tally: 5 Unfortunately,objects__thatimplement__built-inoperations__likethis__failin__ourproxy__classesbecause__built-inoperations__skip instance-levellookup__protocolslike____getattr__,and__insteadsearch__namespacesof__classes: >>>from__access2import__Private >>> @Private('sum', '__add__') ...class__Tally:same__asbefore__>>>X__= Tally() >>> X.sum TypeError:private__attribute fetch,sum__>>> X.__add__(5) TypeError:private__attribute fetch,__add____>>> print(X) .onDecorator..onInstanceobject__at 0xetc__> >>>X__+ 5 TypeError:unsupported__operand type(s)for__+: 'onInstance'and__'int'In__this session,the__firsttwo__explicitfetches__ofsum__and__add____arekicked__outas__privatesas__theyshould__be.Because__thelast__twoimplicit__fetchesof__printand__+aren__tcaught__bythe__proxy, though,they__arenever__delegatedto__thewrapped__Tally object.The__printhere__onlyworks__atall__becauseit__runsan__objectdefault__toprint__theproxy__itself.Per__theprior__chapter,this__isan__inconsistencyin__Python;per__thefollowing__sections,it__canalso__beavoided__in full. Workaround:Coding__operator-overloadingmethods__inlineThe__moststraightforward__wayto__support built-insin__delegationproxies__isto__redefine operator-overloadingnames__thatmay__appearin__embedded objects.This__createssome__code redundancy,but__itisn__timpossibly__onerous;can__beautomated__withtools__or superclasses;and__canchoose__torun__orskip__validationsfor__operator-overloading__namesdeclared__Privateor__Public,depending__onredefinitions__routing.For__instance,the__partiallisting__ofExample__39-19sketches__aninline__redefinitionapproach__itcatches__anddelegates__built-insby__addingmethod__definitionsto__theproxy__itselffor__every operator-overloadingmethod__awrapped__objectmay__define.It__addsjust__fouroperation__interceptorsto__illustrate,but__othersare__similar (inthis__section,new__codeis__inbold__font,and__allexamples__arebased__onthe__decoratorof__access2.pyin__Example 39-18).Example__39-19. access_builtins_inline_direct.py "Inline methods,skip__validations"def__accessControl(failIf):def__onDecorator(aClass):class__onInstance:def____init__(self, *args, **kargs): self.__wrapped = aClass(*args, **kargs) #Intercept__anddelegate__built-inimplicit__accessspecifically__def __add__(self, other):return__self.__wrapped +other__#Or__getattr(), __getattr__()def____str__(self):return__str(self.__wrapped) #Or__self.__wrapped.__str__()def____getitem__(self, index):return__self.__wrapped[index]def____call__(self, *args, **kargs):return__self.__wrapped(*args, **kargs) #Plus__anyothers__needed #Intercept__anddelegate__explicitattribute__accessgenerically__def __getattr__(self, attr):same__def __setattr__(self, attr, value):same__returnonInstance__returnonDecorator__Thisworks__because built-inswill__findtheir__requisitemethods__inthe__proxyclass__afterskipping__theproxy__instance.As__coded,the__newinterceptor__methodstrigger__thewrapped__objects__operator-overloadingmethods__directlyand__sobypass__theaccess__controlsof____getattr__,which__mayor__maynot__be desirable.For__alternative codings,let__smove__on. Workaround:Coding__operator-overloadingmethods__insuperclasses__More usefully,the__priorsection__sadded__methodscan__beadded__bya__common superclass.Given__thatthere__aredozens__ofsuch__methods,an__externalclass__maybe__bettersuited__tothe__task,especially__ifit__isgeneral__enoughto__beused__inany__such interface-proxy class.To__demo,the__superclassof__Example 39-20catches__built-insand__reroutesto__thewrapped__objectdirectly__again.It__slargely__justa__repackagingof__theprior__sections__inline scheme,but__asa__separateclass__itrequires__aproxy__attributenamed___wrapped,giving__accessto__theembedded__object.The__decoratoritself__mustuse__thisname__insteadof____wrappedin__self references,and__sansmangling__in __setattr__.This__maybe__subparbecause__itprecludes__thesame__namein__wrappedobjects__andcreates__asubclass__dependency,but__its__betterthan__usingthe__mangledand__subclass-specific_onInstance__wrapped__andis__noworse__thana__similarlynamed__method.Example__39-20. access_builtins_mixin_direct.py "Inherit methods,skip__validations"class__BuiltinsMixin:def____add__(self, other):return__self._wrapped +other__#Assume__a_wrapped__def __str__(self): #Bypass____getattr__return__str(self._wrapped)def____getitem__(self, index):return__self._wrapped[index]def____call__(self, *args, **kargs):return__self._wrapped(*args, **kargs) #Plus__anyothers__neededdef__accessControl(failIf):def__onDecorator(aClass):class__onInstance(BuiltinsMixin):rest__same,but__useunmangled___wrappedinstead__of__wrapped__Alternatively,the__superclassin__Example 39-21catches__built-insand__reroutesthem__downthrough__thesubclass____getattr__to__applyits__accesscontrols__tothe__operations__method name.It__requiresthat__operator-overloadingnames__be non-Private__orPublic__perthe__decorators__argumentsif__theyare__tobe__run,but__ittreats__theimplicit__fetchesof__built-inoperations__thesame__as explicit-name fetches,and__no_wrapped__isrequired__in subclasses.Example__39-21. access_builtins_mixin_getattr.py "Inherit methods,run__validations"class__BuiltinsMixin:def____add__(self, other):return__self.__getattr__('__add__')(other) #Route__tovalidator__def __str__(self): #Finish__operationsreturn__self.__getattr__('__str__')()def____getitem__(self, index):return__self.__getattr__('__getitem__')(index)def____call__(self, *args, **kargs):return__self.__getattr__('__call__')(*args, **kargs) #Plus__anyothers__neededdef__accessControl(failIf):def__onDecorator(aClass):class__onInstance(BuiltinsMixin): #Inherit__methodsrest__unchangedLike__theinline__approach,both__ofthese__mix-insalso__requireone__methodper__built-inoperation__ingeneral__toolsthat__proxyarbitrary__objects interfaces.The__nextidea__doesmarginally__better. Workaround:Generating__operator-overloadingdescriptors__Finally,all__ofthe__inlineand__mix-inworkarounds__for built-inswe__veseen__sofar__codeeach__operator-overloadingmethod__explicitly,and__interceptthe__actualcall__issuedfor__the operation,including__its arguments.That__makesthem__responsiblefor__completingthe__operation,whether__byoperation__syntaxor__equivalent calls.With__analternative__coding,we__couldinstead__interceptonly__theattribute__fetchpreceding__thecall__byusing__the class-leveldescriptors__ofthe__prior chapter. Moreover,because__allsuch__descriptorswill__runthe__same,they__canbe__generatedautomatically__froma__listof__method names.Example__39-22shows__oneway__tocode__this scheme.Like__Example 39-21,it__routes built-inoperations__throughthe__decorators__validationslogic__toapply__privateor__public checks.Example__39-22. access_builtins_mixin_desc.py "Inherit descriptors,run__validations"class__BuiltinsMixin:class__ProxyDesc: #Define__descriptordef____init__(self, attrname): self.attrname =attrname__def __get__(self, instance, owner):return__instance.__getattr__(self.attrname) #Run__validationsbuiltins__= ['add', 'str', 'getitem', 'call'] #Plus__anyothers__forattr__in builtins: exec(f'__{attr}__ = ProxyDesc("__{attr}__")') #Make__descriptorsdef__accessControl(failIf):def__onDecorator(aClass):class__onInstance(BuiltinsMixin): #Inherit__descriptorsrest__unchangedThis__codingmay__bethe__mostconcise__butalso__themost__implicitand__complex.Recall__thatthe__exec built-inby__defaultruns__astring__ofcode__asif__thestring__wassomehow__pastedwhere__theexec__appears. Hence,the__loopat__theend__ofthis__mix-in__classis__equivalentto__thefollowing__statements,run__inthe__mix-inclass__slocal__scope:__add____= ProxyDesc("__add__")__str____= ProxyDesc("__str__")etc__Thenet__effectcreates__inheriteddescriptor__instancesthat__respondto__initialname__lookupsby__fetchingfrom__thewrapped__objectin____get__rather__thancatching__thelater__operationcall__itself (whichhappens__afterthis__step).If__youstill__findthis__codeconfusing__(andyou__probably should),it__sequivalent__tothis__stripped-down version,though__thename__fetchoccurs__implicitlyin__a built-inoperation__thatskips__theinstance__s protocols: >>>class__B:class__D:def____get__(s, i, o):return__i.meth()name__= D() >>>class__A(B):def__meth(self):return__'hack' >>>I__= A() >>> I.name 'hack'We__couldalso__skipthe__decorators__validationsfor__built-inoperations__inthis__schemeby__routingattribute__fetchesdirectly__tothe__wrappedobject__thoughthis__requiresan__accessible_wrapped__inthe__decoratorjust__likeExample__39-20:class__ProxyDesc:def____get__(self, instance, owner):return__getattr(instance._wrapped, self.attrname) #Assume__a_wrapped__Inthe__end,all__ofthese__workaroundsmake__classesthat__overload built-inoperations__workcorrectly__withour__privateand__publicdecorators__andother__delegation-baseddecorators__like them: >>>from__access_builtins_mixin_descimport__Private >>> @Private('sum') ...class__Tally:def____init__(self): self.sum = 0def____str__(self):return__f'Tally: {self.sum}'def____add__(self, add): self.sum +=add__>>>X__= Tally() >>> X.sum #Explicit__validated TypeError:private__attribute fetch,sum__>>>X__+ 10 # Built-indelegated__>>> print(X) # Built-indelegated__Tally: 10Public__(nonprivate) built-insare__nowdelegated__and work,but__private built-insare__validatedand__canceled: >>> @Private('sum', '__add__') ...class__Tally:same__asbefore__>>>X__= Tally() >>> X.sum #Explicit__validated TypeError:private__attribute fetch,sum__>>>X__+ 10 # Built-in canceled:private__TypeError:private__attribute fetch,__add____>>> print(X) # Built-in allowed:public__Tally: 0 >>> @Private('__str__') ...class__Tally:same__asbefore__>>> print(Tally()) # Built-in canceled:private__TypeError:private__attribute fetch,__str____Ifyou__careto__experimentfurther__withthis__sections__examples,see__thebook__examplespackage__fortheir__complete code,as__wellas__itscomprehensive__access_builtins_TEST.pytest__scriptand__results. Here,it__stime__tomove__onto__thischapter__snext__andfinal__decoratorscase__study. Example:Validating__FunctionArguments__Asa__finalexample__ofthe__utilityof__decorators,this__sectiondevelops__afunction__decoratorthat__automaticallytests__whetherarguments__passedto__afunction__ormethod__arewithin__avalid__numeric range.It__sdesigned__tobe__usedduring__eitherdevelopment__or production,and__itcan__beused__asa__templatefor__similartasks__(e.g.,argument__type testing,if__you must). Again,this__exampleis__largely self-study__contentwith__alimited__narrative;read__thecode__formore__details.The__GoalIn__the object-orientedtutorial__ofChapter__28,we__wrotea__classthat__gavea__payraise__toobjects__representingfictitious__people,based__upona__passed-in percentage:class__Person:def__giveRaise(self, percent): self.pay = int(self.pay * (1 + percent)) There,we__notedthat__ifwe__wantedthe__codeto__be robust,it__wouldbe__agood__ideato__checkthe__percentageto__makesure__its__nottoo__largeor__too small.We__couldimplement__sucha__checkwith__eitherif__orassert__statementsin__themethod__itself,using__inline tests:class__Person:def__giveRaise(self, percent): #Validate__withinline__codeif__percent < 0.0or__percent > 1.0:raise__TypeError, 'percent invalid' self.pay = int(self.pay * (1 + percent))class__Person: #Validate__withasserts__def giveRaise(self, percent):assert__percent >= 0.0and__percent <= 1.0, 'percent invalid' self.pay = int(self.pay * (1 + percent)) However,this__approachclutters__themethod__withinline__teststhat__willprobably__beuseful__onlyduring__development.For__morecomplex__cases,this__canbecome__tedious (imaginetrying__toinline__thecode__neededto__implementthe__attributeprivacy__providedby__thelast__sections__decorator).Perhaps__worse,if__thevalidation__logicever__needsto__change,there__maybe__arbitrarilymany__inlinecopies__tofind__and update.A__moreuseful__andinteresting__alternativewould__beto__developa__generaltool__thatcan__performrange__testsfor__usautomatically__forthe__argumentsof__anyfunction__ormethod__wemight__codenow__orin__the future.A__decoratorapproach__makesthis__explicitand__convenient,and__easyto__disableonce__developmentis__complete:class__Person: @rangetest(percent=(0.0, 1.0)) #Use__decoratorto__validatedef__giveRaise(self, percent): self.pay = int(self.pay * (1 + percent))Isolating__validationlogic__ina__decoratorsimplifies__bothclients__andfuture__maintenance.Notice__thatour__goalhere__isdifferent__thanthe__attributevalidations__codedin__theprior__chapters__final example. Here,we__meanto__validatethe__valuesof__functionarguments__whenpassed__ratherthan__attributevalues__when accessed.Python__sdecorator__andintrospection__toolsallow__usto__codethis__newtask__justas__easily.A__Basic Range-TestingDecorator__forPositional__ArgumentsLet__sstart__witha__basic range-test implementation.To__keepthings__simple,we__llbegin__bycoding__adecorator__thatworks__onlyfor__positionalarguments__andassumes__theyalways__appearat__thesame__positionin__every call;they__cannotbe__passedby__keywordname__becausethis__caninvalidate__thepositions__declaredin__the decorator.Example__39-23is__our first-cut checker.Example__39-23. rangetest0.pydef__rangetest(*argchecks): #Validate__positionalarg__rangesdef__onDecorator(func):if__not __debug__: #True__if "python -O main.py args..."return__func # No-op:call__originaldirectly__else: #Else__wrapperwhile__debuggingdef__onCall(*args):for__(ix, low, high)in__argchecks:if__args[ix] <low__or args[ix] > high:errmsg__= f'Argument {ix}not__in {low}..{high}'raise__TypeError(errmsg)return__func(*args)return__onCallreturn__onDecoratorAs__is,this__codeis__mostlya__rehashof__thecoding__patternswe__explored earlier:we__usedecorator__arguments,nested__scopesfor__state retention,and__so on.We__alsouse__nesteddef__statementsto__ensurethat__thisworks__forboth__simplefunctions__and methods,as__welearned__earlier.When__usedfor__aclass__s method,onCall__receivesthe__subjectclass__sinstance__inthe__firstitem__in *argsand__passesthis__alongto__selfin__theoriginal__method function;explicitly__passedargument__numberscoded__inthe__@decorator__linestart__at 1in__this case,not__0,to__accommodatethe__implicit self.New__here,notice__thiscode__suse__ofthe____debug__ built-invariable__introducedin__Chapter 34.In__brief,Python__setsthis__variableto__Trueunless__theprogram__isbeing__runwith__theO__optimize command-lineflag__(e.g.,python__O main.py).As__discussed earlier,using__optionsin__thecompile__built-infunction__andcompileall__standard-librarymodule__beforecode__isrun__canhave__asimilar__effect.Either__way,when____debug__is__False,the__decoratorreturns__theoriginal__functionunchanged__toavoid__extralater__callsand__theirassociated__performance penalty.In__other words,the__decoratorautomatically__removesits__augmentationlogic__whenO__orsimilar__isused__withoutrequiring__youto__physicallyremove__thedecoration__linesin__your code.Example__39-24demos__howthis__first-iterationsolution__is used.Example__39-24. rangetest0_test.pyfrom__rangetest0import__rangetest print(f'{__debug__=}') #False__if "python -O main.py" @rangetest((1, 0, 120)) #persinfo__= rangetest(...)(persinfo)def__persinfo(name, age): #age__mustbe__in 0..120 print(f'{name}is__{age}years__old') @rangetest([0, 1, 12], [1, 1, 31], [2, 0, 2024])def__birthday(M, D, Y): print(f'birthday = {M}/{D}/{Y}')class__Person:def____init__(self, name, job, pay): self.job =job__self.pay =pay__@rangetest([1, 0.0, 1.0]) #giveRaise__= rangetest(...)(giveRaise)def__giveRaise(self, percent): #Arg__0is__theself__instancehere__self.pay = int(self.pay * (1 + percent)) #Comment__linesraise__TypeErrorunless__"python -O"used__onshell__commandline__persinfo('Bob Smith', 45) #Really__runs onCall(...)with__state #persinfo('Bob Smith', 200) #Or__persinfoif__-Ocmd__lineargument__birthday(8, 31, 2024) #birthday(8, 32, 2024)sue__= Person('Sue Jones', 'dev', 100_000) sue.giveRaise(.10) #Really__runs onCall(self, .10) print(sue.pay) #Or__giveRaise(self, .10)if__-O #sue.giveRaise(1.10)When__run,valid__callsin__thiscode__producethe__following output: $ python3 rangetest0_test.py __debug__=TrueBob__Smithis__45years__oldbirthday__= 8/31/2024 110000Uncommenting__anyof__theinvalid__callscauses__aTypeError__tobe__raisedby__the decorator.Here__sthe__resultwhen__thelast__lineis__allowedto__run (as usual,some__ofthe__errormessage__textwas__trimmedhere__tosave__space): $ python3 rangetest0_test.py __debug__=TrueBob__Smithis__45years__oldbirthday__= 8/31/2024 110000 TypeError:Argument__1not__in 0.0..1.0Running__Pythonwith__its -Oflag__ata__systemcommand__linewill__disablerange__testingbut__alsoavoid__theperformance__overheadof__thewrapping__layerwe__windup__callingthe__originalundecorated__function directly.Assuming__thisis__adebugging__tool only,you__canuse__thisflag__tooptimize__yourprogram__forproduction__use.Here__isthe__effectwith__thelast__linestill__runand__aprint__addedto__showsue__sfantastical__pay raise: $ python3 -O rangetest0_test.py __debug__=FalseBob__Smithis__45years__oldbirthday__= 8/31/2024 110000 231000Generalizing__forKeywords__andDefaults__Theprior__versionillustrates__thebasics__weneed__to employ,but__its__fairlylimited__itsupports__validatingarguments__passedby__position only,and__itdoes__notvalidate__keywordarguments__(in fact,it__assumesthat__nokeywords__arepassed__ina__waythat__makesargument__positionnumbers__incorrect). Additionally,it__doesnothing__aboutarguments__withdefaults__thatmay__beomitted__ina__given call.That__sfine__ifall__yourarguments__arepassed__byposition__andnever__defaulted,but__its__lessthan__idealin__ageneral__tool.As__welearned__inChapter__18,Python__supportsmuch__moreflexible__argument-passing modes,which__were__notyet__addressing.The__levelup__ofour__decoratorin__Example 39-25does__better.By__matchingthe__wrappedfunction__sexpected__argumentsagainst__theactual__argumentspassed__ina__call,it__supportsrange__validationsfor__argumentspassed__byeither__positionor__keyword name,and__itskips__testingfor__defaultarguments__omittedin__the call.Arguments__tobe__validatedare__specifiedby__keywordarguments__tothe__decorator itself,which__latersteps__throughboth__thecall__s *pargspositionals__tupleand__its **kargskeywords__dictionaryto__validate.Example__39-25. rangetest.py """A__functiondecorator__thatperforms__range-testvalidation__forarguments__passedto__anyfunction__or method.Usage__synopsis: @rangetest(percent=(0.0, 1.0), month=(1, 12))def__func-or-method(..., percent, ..., month=5, ...): ... func-or-method(..., value, month=8, ...)Arguments__arespecified__bykeyword__tothe__decorator.In__theactual__call,arguments__maybe__passedby__positionor__keyword,and__defaultsmay__be omitted.See__rangetest_test.pyfor__exampleuse__cases. """trace__=True__def rangetest(**argchecks): #Validate__rangesfor__both+defaultsdef__onDecorator(func): #onCall__remembersfunc__andargchecks__ifnot____debug__: #True__if "python -O main.py args..."return__func #Wrap__if debugging;else__useoriginal__else:funcname__= func.__name__funccode__= func.__code__funcargs__= funccode.co_varnames[:funccode.co_argcount]def__onCall(*pargs, **kargs): #All__pargsmatch__firstN__expectedargs__byposition__#The__restmust__bein__kargsor__beomitted__defaultspositionals__= funcargs[:len(pargs)]errormsg__=lambda__*args: '%sargument__"%s"not__in %s..%s' %args__for (argname, (low, high))in__argchecks.items(): #For__allargs__tobe__checkedif__argnamein__kargs: #Was__passedby__nameif__kargs[argname] <low__or kargs[argname] > high:raise__TypeError(errormsg(funcname, argname, low, high))elif__argnamein__positionals: #Was__passedby__positionposition__= positionals.index(argname)if__pargs[position] <low__or pargs[position] > high:raise__TypeError(errormsg(funcname, argname, low, high)) else: #Assume__not passed:default__if trace: print(f'-Argument "{argname}" defaulted')return__func(*pargs, **kargs) # OK:run__originalcall__returnonCall__returnonDecorator__Next,the__testscript__inExample__39-26shows__howthe__decoratoris__usedarguments__tobe__validatedare__givenby__keyworddecorator__arguments,and__atactual__calls,we__canpass__byname__orposition__andomit__argumentswith__defaultseven__ifthey__areto__bevalidated__otherwise.Example__39-26. rangetest_test.py """Test__therangetest__decorator (usagediffers__from rangetest0).Comment__linesraise__TypeErrorunless__"python -O"or__similarin__compileall. """from__rangetestimport__rangetestdef__announce(what): print(what.center(24, '-')) #str__method #Test__functions,positional__andkeyword__announce('Functions') @rangetest(age=(0, 120)) #persinfo__= rangetest(...)(persinfo)def__persinfo(name, age): print(f'{name}is__{age}years__old') @rangetest(M=(1, 12), D=(1, 31), Y=(0, 2024))def__birthday(M, D, Y): print(f'birthday = {M}/{D}/{Y}') persinfo('Pat', 40) persinfo(age=40, name='Pat') birthday(8, D=31, Y=2024) #persinfo('Pat', 150) #persinfo(age=150, name='Pat') #birthday(8, Y=2025, D=40) #Test__methods,positional__andkeyword__announce('Methods')class__Person:def____init__(self, name, job, pay): self.job =job__self.pay =pay__#giveRaise__= rangetest(...)(giveRaise) @rangetest(percent=(0.0, 1.0)) #percent__passedby__nameor__positiondef__giveRaise(self, percent): self.pay = int(self.pay * (1 + percent))sue__= Person('Sue Jones', 'dev', 100_000)bob__= Person('Bob Smith', 'dev', 100_000) sue.giveRaise(percent=.20) bob.giveRaise(.10) print(f'sue=>{sue.pay}, bob=>{bob.pay}') #sue.giveRaise(1.20) #bob.giveRaise(percent=1.20) #Test__omitted defaults:skipped__announce('Defaults') @rangetest(a=(1, 10), b=(1, 10), c=(1, 10), d=(1, 10))def__omitargs(a, b=7, c=8, d=9): print(a, b, c, d) omitargs(1, 2, 3, 4) #Positionals__omitargs(1, 2, 3) #Default__d omitargs(1, 2, 3, d=4) #Keyword__d omitargs(1, d=4) #Default__band__c omitargs(d=4, a=1) #Ditto__omitargs(1, b=2, d=4) #Default__c omitargs(d=8, c=7, a=1) #Default__b #omitargs(1, 2, 3, 11) #Bad__d #omitargs(1, 2, 11) #Bad__c #omitargs(1, 2, 3, d=11) #Bad__d #omitargs(11, d=4) #Bad__a #omitargs(d=4, a=11) #Bad__a #omitargs(1, b=11, d=4) #Bad__b #omitargs(d=8, c=7, a=11) #Bad__aWhen__thisscript__is run, out-of-rangearguments__raisean__exceptionas__before,but__argumentsmay__bepassed__byeither__nameor__position,and__omitteddefaults__arenot__validated.Trace__itsoutput__andtest__thisfurther__onyour__ownto__experiment;it__workslike__itssimpler__predecessor,but__itsscope__hasbeen__greatly broadened: $ python3 rangetest_test.py -------Functions--------Pat__is 40years__oldPat__is 40years__oldbirthday__= 8/31/2024 --------Methods--------- sue=>120000, bob=>110000 --------Defaults-------- 1 2 3 4 -Argument "d"defaulted__1 2 3 9 1 2 3 4 -Argument "b"defaulted__-Argument "c"defaulted__1 7 8 4 -Argument "b"defaulted__-Argument "c"defaulted__1 7 8 4 -Argument "c"defaulted__1 2 8 4 -Argument "b"defaulted__1 7 7 8Notice__thatargument__checksare__runin__theorder__theyare__listedin__thedecorator__becausePython__retainsinsertion__orderin__dictionaries.On__validation errors,we__getan__exceptionas__beforeunless__the -O command-lineargument__ispassed__toPython__todisable__thedecorator__s logic.Here__sthe__scenewhen__oneof__the method-testlines__is uncommented: $ python3 rangetest_test.py -------Functions--------Pat__is 40years__oldPat__is 40years__oldbirthday__= 8/31/2024 --------Methods--------- sue=>120000, bob=>110000 TypeError:giveRaise__argument "percent"not__in 0.0..1.0 $ python3 -O rangetest_test.pyno__errormessages__ordefault__tracesImplementation__DetailsThis__range-testerdecorator__scode__relieson__bothintrospection__APIsand__subtleconstraints__ofargument__passing.To__befully__general,we__couldtry__tomimic__Pythons__argument-matchinglogic__inits__entiretyto__seewhich__nameshave__beenpassed__inwhich__modes,but__thats__toomuch__complexityfor__ourtool__andis__proneto__changeover__time.It__wouldbe__betterif__wecould__somehowmatch__thenames__oftestable__argumentsgiven__tothe__decoratoragainst__thenames__ofactual__argumentsexpected__bythe__functionto__determinehow__theformer__mapto__thelatter__duringa__given call.Function__introspectionIt__turnsout__thatthe__introspectionAPI__availableon__functionobjects__andtheir__associatedcode__objectshas__exactlythe__toolwe__need.This__APIwas__brieflyintroduced__inChapter__19,but__weve__actuallyput__itto__use here.The__setof__expectedargument__namesis__simplythe__firstN__variablenames__attachedto__afunction__scode__object: >>>def__func(a, b, c, e=True, f=None): # Args:three__required,two__defaultsx__= 1 #Plus__twomore__localvariables__y = 2 >>>code__= func.__code__ #Code__objectof__functionobject__>>> code.co_nlocals 7 >>> code.co_varnames #All__localvariable__names ('a', 'b', 'c', 'e', 'f', 'x', 'y') >>> code.co_varnames[:code.co_argcount] # <==First__Nlocals__areexpected__args ('a', 'b', 'c', 'e', 'f')And__as usual, starred-argumentnames__inthe__callproxy__allowit__tocollect__arbitrarilymany__argumentsto__bematched__againstthe__expectedarguments__soobtained__fromthe__functions__introspection API: >>>def__catcher(*pargs, **kargs): print(f'{pargs}, {kargs}') >>> catcher(1, 2, 3, 4, 5) (1, 2, 3, 4, 5), {} >>> catcher(1, 2, c=3, d=4, e=5) #Arguments__atcalls__(1, 2), {'d': 4, 'e': 5, 'c': 3}Run__adir__callon__functionand__codeobjects__formore__details.Argument__assumptionsGiven__thedecorated__functions__setof__expectedargument__names,the__solutionrelies__upontwo__constraintson__argumentpassing__orderimposed__byPython__andcovered__inChapter__18:At__the call,all__positionalarguments__appearbefore__allkeyword__arguments.In__the def,all__nondefaultarguments__appearbefore__alldefault__arguments.That__is,a__nonkeywordargument__cannotgenerally__followa__keywordargument__ata__call,and__anondefault__argumentcannot__followa__defaultargument__ata__definition.All__name=valuesyntax__mustappear__afterany__simplename__inboth__places.As__weve__also learned,Python__matchesargument__valuespassed__byposition__toargument__namesin__functionheaders__fromleft__to right,such__thatthese__valuesalways__matchthe__leftmostnames__in headers.Keywords__matchby__name instead,and__agiven__argumentcan__receiveonly__one value.To__simplifyour__work,we__canalso__makethe__assumptionthat__acall__isvalid__ingeneral__that is,that__allarguments__eitherwill__receivevalues__(byname__or position)or__willbe__omittedintentionally__topick__up defaults.This__assumptionwon__tnecessarily__holdbecause__thefunction__hasnot__yetactually__beencalled__whenthe__wrapperlogic__testsvalidity__thecall__maystill__faillater__wheninvoked__bythe__wrapperlayer__dueto__incorrectargument__passing.As__longas__thatdoesn__tcause__thewrapper__tofail__any worse, though,we__canignore__thevalidity__ofthe__call.This__helpsbecause__validatingcalls__beforethey__areactually__madewould__requireus__toemulate__Pythons__argument-matchingalgorithm__in full.Matching__algorithm Now,given__theseconstraints__and assumptions,we__canallow__forboth__keywordsand__omitteddefault__argumentsin__thecall__withthis__algorithm.When__acall__is intercepted,we__canmake__thefollowing__assumptionsand__deductions: 1.Let__Nbe__thenumber__ofpassed__positional arguments,obtained__fromthe__lengthof__the *pargs tuple. 2.All__Npositional__argumentsin__*pargsmust__matchthe__firstN__expectedarguments__obtainedfrom__thefunction__scode__object.This__istrue__perPython__scall__ordering rules,outlined__earlier,since__allpositionals__precedeall__keywordsin__a call. 3.To__obtainthe__namesof__argumentsactually__passedby__position,we__canslice__thelist__ofall__expectedarguments__upto__thelength__Nof__the *pargspassed__positionals tuple. 4.Any__argumentsafter__thefirst__Nexpected__argumentseither__werepassed__bykeyword__orwere__defaultedby__omissionat__the call. 5.For__eachargument__nameto__bevalidated__bythe__decorator: a.If__thename__isin__**kargs,it__waspassed__byname__indexing **kargsgives__itspassed__value. b.If__thename__isin__thefirst__Nexpected__arguments,it__waspassed__byposition__itsrelative__positionin__theexpected__listgives__itsrelative__positionin__*pargs. c. Otherwise,we__canassume__itwas__omittedin__thecall__anddefaulted__andneed__notbe__checked.In__other words,we__canskip__testsfor__argumentsthat__wereomitted__ina__callby__assumingthat__thefirst__Nactually__passedpositional__argumentsin__*pargsmust__matchthe__firstN__argumentnames__inthe__listof__allexpected__arguments,and__thatany__othersmust__eitherhave__beenpassed__bykeyword__andthus__bein__**kargs,or__havebeen__defaulted.Under__this scheme,the__decoratorwill__simplyskip__anyargument__tobe__checkedthat__wasomitted__betweenthe__rightmostpositional__argumentand__theleftmost__keyword argument,between__keyword arguments,or__afterthe__rightmostpositional__in general.Trace__throughthe__decoratorand__itstest__scriptto__seehow__thisis__realizedin__code.Open__IssuesAlthough__our range-testingtool__worksas__planned,three__caveatsremain__itdoesn__tdetect__invalid calls,doesn__thandle__some arbitrary-argument signatures,and__doesnt__fullysupport__nesting.Improvements__mayrequire__extensionor__altogetherdifferent__approaches.Here__sa__quickrundown__ofthe__issues.Invalid__calls First,as__mentioned earlier,calls__tothe__originalfunction__thatare__notvalid__stillfail__inour__final decorator.The__following,for__example,both__triggerTypeError__exceptionsfor__amissing__positionalargument__a: omitargs() omitargs(d=8, c=7, b=6)These__only fail, though,where__wetry__toinvoke__theoriginal__function,at__theend__ofthe__wrapper.While__wecould__tryto__imitatePython__sargument__matchingto__avoid this,there__snot__muchreason__todo__sosince__thecall__wouldfail__atthis__point anyhow,we__mightas__welllet__Pythons__own argument-matchinglogic__detectthe__problemfor__us.Arbitrary__arguments Second,although__ourfinal__versionhandles__positional arguments,keyword__arguments,and__omitted defaults,it__stilldoesn__tdo__anythingexplicit__about *pargsand__**kargs starred-argumentnames__thatmay__beused__ina__decoratedfunction__defthat__acceptsarbitrarily__manyarguments__itself.This__isprobably__mootfor__our purposes, though:If__anextra__keywordargument__is passed,its__namewill__showup__in **kargsand__canbe__testednormally__ifmentioned__tothe__decorator.If__anextra__keywordargument__isnot__passed,its__namewon__tbe__ineither__**kargsor__thesliced__expectedpositionals__list,and__itwill__thusnot__bechecked__itis__treatedas__thoughit__were defaulted,even__thoughit__isreally__anoptional__extra argument.If__anextra__positionalargument__is passed,there__sno__wayto__referenceit__inthe__decoratoranyhow__itsname__wont__bein__either **kargsor__thesliced__expectedarguments__list,so__itwill__simplybe__skipped.Because__sucharguments__arenot__listedin__thefunction__s definition,there__sno__wayto__mapa__namegiven__tothe__decoratorback__toan__expectedrelative__position.In__other words,as__itis__thecode__supportstesting__arbitrarykeyword__argumentsby__name,but__notarbitrary__positionalsthat__areunnamed__andhence__haveno__setposition__inthe__functions__argument signature.In__termsof__thefunction__objects__API,here__sthe__effectof__thesetools__indecorated__functions: >>>def__func(*pargs, **kargs):pass__>>>code__= func.__code__ >>> code.co_nlocals, code.co_varnames (2, ('pargs', 'kargs')) >>> code.co_argcount, code.co_varnames[:code.co_argcount] (0, ()) >>>def__func(a, b, *pargs, **kargs):pass__>>>code__= func.__code__ >>> code.co_argcount, code.co_varnames[:code.co_argcount] (2, ('a', 'b'))Because__starred-argumentnames__showup__aslocals__butnot__asexpected__arguments,they__wont__bea__factorin__ourmatching__algorithmnames__precedingthem__infunction__headerscan__bevalidated__as usual,but__notany__extrapositional__arguments passed.In__principle,we__couldextend__thedecorator__sinterface__tosupport__*pargsin__thedecorated__function, too,for__therare__caseswhere__thismight__beuseful__(e.g.,a__specialargument__namewith__atest__toapply__toall__argumentsin__*pargsbeyond__thelength__ofthe__expectedarguments__list),but__well__passon__suchan__extension here. Also,bear__inmind__thatthis__pertainsto__valuesin__starredcollectors__indef__headers only;given__thatstarred__unpackingsin__callsare__flattenedbefore__theyever__reachour__decorator,they__areirrelevant__toits__code.To__borrowa__pathologicalexample__fromChapter__18: >>>def__f(a, b, c, d, e, f, g, h, i):pass__>>> f.__code__.co_varnames[:f.__code__.co_argcount] ('a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i') >>>def__f(*p, **k): print(p, k) >>> f(*[1], 2, *[3], 4, f=6, *[5], **dict(g=7), h=8, **{'i': 9}) (1, 2, 3, 4, 5) {'f': 6, 'g': 7, 'h': 8, 'i': 9}The__calls__starshere__areresolved__beforethe__functionis__started.Because__ourdecorator__findsvalues__passedto__argumentnames__byindexing__keywordsand__mappingexpected__toactual__positionals,it__canremain__blissfullyignorant__ofstars__inthe__calland__willwork__normallyin__thisexample__(though,to__be fair,normally__maybe__anexaggeration__here).Decorator__nesting Finally,and__perhapsmost__subtly,this__codes__approachdoes__notfully__supportthe__useof__decoratornesting__tocombine__steps.Because__itanalyzes__argumentsusing__namesin__function definitions,and__thenames__ofthe__callproxy__functionreturned__bya__nesteddecoration__wont__correspondto__argumentnames__ineither__theoriginal__functionor__decorator arguments,it__doesnot__fullysupport__usein__nested mode. Technically,when__nested,only__themost__deeplynested__appearances__validationsare__runin__full;all__othernesting__levelsrun__testson__argumentspassed__bykeyword__only.Trace__thecode__tosee__why;because__theonCall__proxys__callsignature__expectsno__namedpositional__arguments,any__to-be-validatedarguments__passedto__itby__positionare__treatedas__ifthey__wereomitted__andhence__defaultedand__arethus__skipped.This__maybe__inherentin__thistool__sapproach__proxieschange__theargument__namesignatures__attheir__levels,making__itimpossible__todirectly__mapnames__indecorator__argumentsto__positionsin__passedargument__sequences.When__proxiesare__present,argument__namesultimately__applyto__keywords only;by__contrast,the__first-cutsolution__sargument__positionsmay__supportproxies__betterbut__donot__fullysupport__keywords.In__lieuof__thisnesting__capability,we__llgeneralize__thisdecorator__tosupport__multiplekinds__ofvalidations__ina__singledecoration__inan__end-of-chapterquiz__solution,which__alsogives__examplesof__thenesting__limitationin__action.Since__weve__alreadyneared__thespace__allocationfor__this example, though,if__youcare__aboutthese__orany__otherfurther__improvements,you__veofficially__crossedover__intothe__realmof__suggested exercises.Decorator__ArgumentsVersus__FunctionAnnotations__In closing,Python__sannotation__featureintroduced__inChapter__19could__alsoprovide__analternative__tothe__decoratorarguments__usedby__ourexample__tospecify__range tests.As__welearned__earlier,annotations__allowus__toassociate__expressionswith__argumentsand__returnvalues__bycoding__themin__thedef__headerline__itself;Python__collectsannotations__ina__dictionaryand__attachesit__tothe__annotated function.We__coulduse__thisin__ourexample__tocode__rangelimits__inthe__headerline__insteadof__indecorator__arguments.We__wouldstill__needa__functiondecorator__towrap__thefunction__inorder__tointercept__later calls,but__wewould__essentiallytrade__decoratorargument__syntax: @rangetest(a=(1, 5), c=(0.0, 1.0))def__func(a, b, c): #func__= rangetest(...)(func) print(a +b__+ c)for__annotationsyntax__like this: @rangetestdef__func(a:(1, 5), b, c:(0.0, 1.0)): print(a +b__+ c)That__is,the__rangeconstraints__wouldbe__movedinto__thefunction__itselfinstead__ofbeing__codedexternally__ina__decorator line.Example__39-27illustrates__thestructure__ofthe__resultingdecorators__underboth__schemesin__incompleteskeleton__codefor__brevity.The__decorator-argumentscode__patternis__thatof__ourcomplete__solutionshown__earlier;the__annotationsalternative__requiresone__lesslevel__ofnesting__becauseit__doesnt__needto__retaindecorator__argumentsas__state.Example__39-27. decoargs-vs-annotation.py #Using__decoratorarguments__def rangetest(**argchecks):def__onDecorator(func):def__onCall(*pargs, **kargs): print(argchecks)for__checkin__argchecks:pass__#Add__validationcode__herereturn__func(*pargs, **kargs)return__onCallreturn__onDecorator @rangetest(a=(1, 5), c=(0.0, 1.0))def__func(a, b, c): #func__= rangetest(...)(func) print(a +b__+ c) func(1, 2, c=3) #Runs__onCall,argchecks__inscope__#Using__functionannotations__def rangetest(func):def__onCall(*pargs, **kargs):argchecks__= func.__annotations__ print(argchecks)for__checkin__argchecks:pass__#Add__validationcode__herereturn__func(*pargs, **kargs)return__onCall @rangetestdef__func(a:(1, 5), b, c:(0.0, 1.0)): #func__= rangetest(func) print(a +b__+ c) func(1, 2, c=3) #Runs__onCall,annotations__onfunc__When run,both__schemeshave__accessto__thesame__validationtest__informationbut__indifferent__formsthe__decoratorargument__versions__informationis__retainedin__anargument__inan__enclosing scope,and__theannotation__versions__informationis__retainedin__anattribute__ofthe__function itself: $ python3 decoargs-vs-annotation.py {'a': (1, 5), 'c': (0.0, 1.0)} 6 {'a': (1, 5), 'c': (0.0, 1.0)} 6Fleshing__outthe__restof__the annotation-basedversion__isleft__asa__suggested exercise;its__codewould__bealmost__identicalto__thatof__ourearlier__solutionbecause__range-testinformation__issimply__onthe__functioninstead__ofin__anenclosing__scope. Really,all__thisbuys__usis__adifferent__userinterface__forour__toolit__willstill__needto__matchargument__namesagainst__expectedargument__namesto__obtainrelative__positionsas__before.In__fact,using__annotationinstead__ofdecorator__argumentsin__thisexample__actuallylimits__its utility.By__movingthe__validationspecifications__intothe__def header,we__essentiallycommit__thefunction__toa__singlerole__sinceannotation__directlyallows__usto__codeonly__oneexpression__per argument,it__canhave__onlyone__purpose.For__instance,we__cannotuse__range-testannotations__forany__otherrole__(includingthe__optionaland__unusedtype__hintingof__Chapter 6).By__contrast,because__decoratorarguments__arecoded__outsidethe__function itself,they__areboth__easierto__removeand__moregeneral__thecode__ofthe__functionitself__doesnot__implya__singledecoration__purpose. Crucially,by__nestingdecorators__with arguments,we__canoften__applymultiple__augmentationsteps__tothe__same function;annotation__directlysupports__only one.With__decorator arguments,the__functionitself__alsoretains__a simpler,normal__appearance. Still,if__youhave__asingle__purposein__mind,the__choicebetween__annotationand__decoratorarguments__islargely__stylisticand__subjective.As__isso__oftentrue__in life,one__persons__decorationor__annotationmay__wellbe__anothers__syntactic clutter.Chapter__SummaryIn__this chapter,we__exploreddecorators__boththe__functionand__class varieties.As__we learned,decorators__area__wayto__insertcode__tobe__runautomatically__whena__functionor__classis__defined.When__adecorator__is used,Python__rebindsa__functionor__classname__tothe__callableobject__thatthe__decorator returns.This__hookallows__usto__managefunctions__andclasses__themselvesor__latercalls__to them.By__addinga__layerof__wrapperlogic__tocatch__later calls,we__canaugment__bothfunction__callsand__instance interfaces.Decorators__providean__explicitand__uniformway__toachieve__such goals.As__wealso__learned,class__decoratorscan__beused__tomanage__classesthemselves__ratherthan__justtheir__instances.Because__thisfunctionality__overlapswith__metaclassesthe__topicof__thenext__andfinal__technicalchapter__youll__haveto__readon__forthe__conclusionto__thisstory__andthat__ofthis__bookat__large. First, though,let__swork__throughthe__following quiz.Because__thischapter__wasmostly__focusedon__its examples,the__quizwill__askyou__tomodify__someof__itsexamples__codein__orderto__reviewtheir__concepts.Both__theexamples__codeand__thequiz__ssolutions__arelocated__inthe__books__examplespackage__(seethe__Prefacefor__access pointers).Look__forthe__solutionscode__therein__thischapter__s_QuizAnswers__subfolder.If__youre__pressedfor__time,you__rewelcome__tojump__rightinto__studyingthe__solutions;programming__isoften__asmuch__aboutreading__codeas__writing it.Test__Your Knowledge:Quiz__1.Method__decorators:As__mentionedin__oneof__thischapter__s notes,the__timerdeco2.pymodule__s call-timerdecorator__thatwe__wrotein__Example 39-10of__AddingDecorator__Argumentscan__beapplied__onlyto__simplefunctions__becauseit__usesa__nestedclass__witha____call__ operator-overloadingmethod__tocatch__calls.This__structuredoes__notwork__fora__classs__methodsbecause__thedecorator__instanceis__passedto__self,not__the subject-class instance.Rewrite__thisdecorator__sothat__itcan__beapplied__toboth__simplefunctions__andmethods__in classes,and__testit__onboth__functionsand__methods. (Hint:see__Class Pitfall:Decorating__Methodsfor__pointers.)Note__thatyou__willprobably__needto__use function-objectattributes__tokeep__trackof__total time,since__youwon__thave__anested__classfor__stateretention__andcan__taccess__nonlocalsfrom__outsidethe__decorator code. 2.Class__decorators:The__Public/Privateclass__decoratorswe__wrotein__module access2.pyof__Example 39-18in__thischapter__sfirst__casestudy__examplewill__addperformance__coststo__everyattribute__fetchin__adecorated__class.Although__wecould__simplydelete__the @decoration__lineto__gain speed,we__couldalso__augmentthe__decoratoritself__tocheck__the__debug____switchand__performno__wrappingat__allwhen__theO__Pythonflag__ispassed__onthe__commandline__justas__wedid__forthe__argument range-test decorators.That__way,we__canspeed__ourprogram__withoutchanging__itssource__via command-linearguments__(pythonO__main.py).While__were__at it,we__couldalso__useone__ofthe__mix-insuperclass__techniqueswe__studiedto__catcha__few built-inoperations__too.Code__andtest__thesetwo__extensions. 3.Generalized__argument validations:The__functionand__methoddecorator__wewrote__in rangetest.pyof__Example 39-25checks__thatpassed__argumentsare__ina__valid range,but__thesame__codepattern__couldapply__tosimilar__goalssuch__asargument__typetesting__andpossibly__more.Generalize__therange__testerso__thatits__singlecode__basecan__beused__formultiple__kindsof__argument validations. Passed-invalidation__functionsmay__bethe__simplestsolution__giventhe__codingstructure__here,though__subclassesthat__provideexpected__methodscan__oftenprovide__similargeneralization__routesas__well.This__issubstantially__challenging,so__besure__tosee__thesolution__for tips.Test__Your Knowledge:Answers__As noted,coding__solutionsfor__thisquiz__arein__thischapter__s_QuizAnswers__subfolderof__thebook__examples package.Each__questionhas__itsown__subfolderthere__forits__files,with__a _Notes.txt plain-textfile__givingbackground__info.This__editionopted__tomove__thesesolutions__onlineinstead__oflisting__themhere__becauseit__savesabout__10pages__andbecause__thisinternet__thingjust__mighttake__offafter__all.Chapter__40.Metaclasses__andInheritance__InChapter__39,we__exploreddecorators__andstudied__examplesof__their use.In__thisfinal__technicalchapter__ofthe__book,we__regoing__tocontinue__our tool-buildersfocus__withan__in-depthreview__ofanother__advanced topic: metaclasses,a__protocolfor__managingclass__objectsinstead__oftheir__instances,introduced__brieflyin__Chapter 32.On__abase__level,metaclasses__extendthe__code-insertionmodel__of decorators.As__welearned__inthe__prior chapter,decorators__allowus__toaugment__functionsand__classesby__interceptingtheir__creation.Metaclasses__similarlyallow__usto__interceptand__augmentclass__creationthey__providea__hookfor__insertingextra__logicto__berun__atthe__conclusionof__aclass__statement,albeit__indifferent__waysthan__decorators.Metaclasses__canalso__providebehavior__forclasses__withmethods__locatedin__aseparate__inheritancetree__skippedfor__normal,nonclass__instances.While__thisallows__metaclassesto__processtheir__instanceclasses__after creation,it__alsocompounds__classsemantics__andconvolutes__inheritancewhose__fulldefinition__canfinally__befleshed__out here.Like__allthe__subjectscovered__inthis__partof__the book,this__isan__advancedtopic__thatcan__bestudied__onan__as-needed basis.Metaclasses__arenot__generallyin__scopefor__mostapplication__programmersbut__maybe__ofinterest__toothers__seekingto__writeflexible__tools.Whatever__categoryyou__fall into, though,metaclasses__canteach__youmore__aboutPython__sclasses__andare__aprerequisite__toboth__codethat__employsthem__andthe__completeinheritance__storyin__Python.As__thelast__technicalchapter__ofthis__book,this__alsobegins__towrap__upsome__threadsconcerning__Pythonitself__thatwe__havemet__oftenalong__theway__andwill__finalizein__theconclusion__that follows.Where__yougo__afterthis__bookis__upto__you,but__inan__opensource__project,it__simportant__tokeep__thebig__picturein__mindwhile__hackingthe__small details.To__Metaclassor__Notto__MetaclassDespite__theadvanced__statusawarded__tometaclasses__inthe__preceding opener,they__havea__varietyof__potential roles.For__example,they__canbe__usedto__enhanceclasses__withfeatures__like tracing,object__persistence,exception__logging,and__more.They__canalso__beused__toconstruct__portionsof__aclass__atruntime__basedon__configuration files,apply__functiondecorators__toevery__methodof__aclass__generically,verify__conformanceto__expected interfaces,and__so on.In__theirmore__grandiose incarnations,metaclasses__caneven__beused__toimplement__alternativecoding__patternssuch__as aspect-oriented programming, object/relationalmappers__(ORMs)for__databases,and__more.Although__thereare__oftenalternative__waysto__achievesuch__resultsas__youll__see,the__rolesof__classdecorators__andmetaclasses__oftenintersect__metaclassesprovide__aformal__modeltailored__tothose__tasks.We__dont__havespace__toexplore__allsuch__applications first-hand__inthis__chapter,of__course,but__youcan__findadditional__usecases__onthe__webafter__studyingthe__basics here.Probably__thereason__forstudying__metaclassesmost__relevantto__thisbook__isthat__thistopic__canhelp__demystifyPython__sclass__mechanicsin__general.For__instance,you__llfind__thatthey__arean__intrinsicpart__ofthe__languages__inheritancemodel__formalizedin__full here.Although__youmay__ormay__notcode__orreuse__themin__your work,a__cursoryunderstanding__ofmetaclasses__canimpart__adeeper__understandingof__Pythonat__large.The__Downsideof__HelperFunctions__Beforewe__getto__metaclass code,let__sget__abetter__handleon__its rationale.Like__thedecorators__ofthe__prior chapter,metaclasses__areoptional__in principle.We__canusually__achievethe__sameeffect__bypassing__classobjects__throughfunctions__knowninterchangeably__ashelper__ormanager__functionsmuch__aswe__canachieve__thegoals__ofdecorators__bypassing__functionsand__classesthrough__manager code.Just__like decorators, though, metaclasses:Provide__amore__uniformand__explicitstructure__Helpensure__thatapplication__programmerswon__tforget__toaugment__theirclasses__accordingto__anAPI__srequirements__Avoidcode__redundancyand__itsassociated__maintenancecosts__byfactoring__classcustomization__logicinto__asingle__locationTo__illustrate,suppose__wewant__toautomatically__inserta__methodinto__aset__of classes.Of__course,we__coulddo__thiswith__simpleinheritance__ifthe__subjectmethod__isknown__whenwe__codethe__classes.In__that case,we__cansimply__codethe__methodin__asuperclass__andhave__allthe__classesin__questioninherit__from it:class__Extras:def__extra(self, args): #Normal__inheritance:too__staticclass__Client1(Extras): #Clients__inheritextra__methodsclass__Client2(Extras):X__= Client1() #Make__aninstance__X.extra() #Run__theextra__methods Sometimes, though,it__simpossible__topredict__suchaugmentation__whenclasses__are coded.Consider__thecase__whereclasses__areaugmented__inresponse__tochoices__madein__auser__interfaceat__runtimeor__loadedfrom__aneditable__configuration file.Although__wecould__codeevery__classin__ourimaginary__setto__manuallycheck__these, too,it__sa__lotto__askof__clients (therequired__functionhere__isabstract__its__somethingto__befilled__in):def__extra(self, arg):class__Client1: #Client__augments:too__distributedif__required(): Client1.extra =extra__class Client2:if__required(): Client2.extra =extra__#Add__theextra__methodmaybe__X = Client1() X.extra()We__canadd__methodsto__aclass__afterthe__classstatement__likethis__because,as__weve__learned,a__class-levelmethod__isjust__aplain__functionthat__isassociated__witha__classand__hasa__firstargument__toreceive__aself__instancewhen__calledthrough__one.Although__this works,it__mightbecome__untenablefor__largermethod__setsand__putsall__theburden__ofaugmentation__oneach__clientclass__(andassumes__theyll__rememberto__dothis__at all).It__wouldbe__betterfrom__amaintenance__perspectiveto__isolatethe__decisionlogic__ina__single place.We__mightencapsulate__someof__thisextra__workby__routingclasses__througha__helperfunction__afunction__thatwould__extendthe__classas__requiredand__handleall__thework__ofruntime__testingand__configuration:def__extra(self, arg):def__extras(Class): #Helper__function:too__manualif__required(): Class.extra =extra__class Client1: extras(Client1)class__Client2: extras(Client2)X__= Client1() X.extra()This__coderuns__theclass__througha__helperfunction__immediatelyafter__itis__created.Although__functionslike__thisone__canachieve__ourgoal__here,they__stillput__aburden__onclass__coders,who__mustunderstand__therequirements__andadhere__tothem__intheir__code.It__wouldbe__evenbetter__ifthere__wasa__simpleway__toenforce__theaugmentation__inthe__subject classes,so__thatthey__dont__needto__dealwith__theaugmentation__soexplicitly__andwould__beless__likelyto__forgetto__useit__altogether.In__other words,we__dlike__tobe__ableto__insertsome__codeto__runautomatically__atthe__endof__aclass__statementto__augmentthe__class.This__isexactly__whatmetaclasses__doby__declaringa__metaclass,we__tellPython__toroute__thecreation__ofthe__classobject__toanother__classwe__provide:def__extra(self, arg):class__Extras(type):def____init__(Class, classname, superclasses, attributedict):if__required(): Class.extra =extra__class Client1(metaclass=Extras): #Metaclass__declarationonly__class Client2(metaclass=Extras): #Client__classis__instanceof__metaX__= Client1() #X__isinstance__ofclient__class X.extra()Because__Pythoninvokes__themetaclass__automaticallyat__theend__ofthe__classstatement__whenthe__newclass__is created,it__can augment, register, wrap,or__otherwisemanage__theclass__as needed. Moreover,the__onlyrequirement__forthe__clientclasses__isthat__theydeclare__their metaclass;every__classthat__doesso__willautomatically__acquirewhatever__augmentationthe__metaclass provides,both__nowand__inthe__futureif__themetaclass__changes.Metaclasses__canalso__augmenttheir__classinstances__withinherited__methods,which__areakin__tonormal__classmethods__butnot__inheritedby__theinstances__oftheir__classinstances__aninheritance__extensionand__tonguetwister__whosetrue__naturerequires__moreinfo__ahead (andquite__possibly, sedation).Through__bothchanges__and methods, though,metaclasses__cancustomize__classbehavior__broadly.Of__course,this__isthe__standard rationale,which__youll__needto__judgefor__yourselfin__truth,clients__mightforget__tolist__ametaclass__justas__easilyas__theycould__forgetto__calla__helper function! Still,the__explicitnature__ofmetaclasses__maymake__thisless__likely.Although__itmay__bedifficult__toglean__fromthis__smalland__hypothetical example,metaclasses__generallyhandle__suchtasks__betterthan__moremanual__approaches.Metaclasses__VersusClass__Decorators:Round__1Having__said that,it__salso__importantto__notethat__theclass__decoratorsdescribed__inthe__precedingchapter__sometimesoverlap__withmetaclasses__interms__ofboth__utilityand__benefit.Like__metaclasses,class__decoratorscan__beused__tomanage__bothclasses__andtheir__later instances,and__theirsyntax__makestheir__usagesimilarly__explicitand__arguablymore__obviousthan__helper-function calls.For__example,suppose__werecoded__thelast__sections__helperfunction__toreturn__theaugmented__classinstead__ofsimply__modifyingit__in place.This__wouldallow__agreater__degreeof__flexibilitybecause__themanager__wouldbe__freeto__returnany__typeof__objectthat__implementsthe__classs__expected interface:def__extra(self, arg):def__extras(Class):if__required(): Class.extra =extra__returnClass__#Return__theaugmented__classclass__Client1: Client1 = extras(Client1) #Rebind__toaugmented__classclass__Client2: Client2 = extras(Client2)X__= Client1() X.extra()If__youthink__thisis__startingto__lookreminiscent__ofclass__decorators,you__re right.In__theprior__chapter,we__emphasizedclass__decoratorsrole__inaugmenting__instancecreation__calls.Because__theywork__byautomatically__rebindinga__classname__tothe__resultof__a function, though,there__sno__reasonthat__wecan__tuse__themto__augmentthe__classby__changingit__beforeany__instancesare__ever created.That__is,class__decoratorscan__applyextra__logicto__classes,not__just instances,at__classcreation__time:def__extra(self, arg):def__extras(Class): #From__helperto__decoratorif__required(): Class.extra =extra__returnClass__@extrasclass__Client1: # Client1 = extras(Client1) @extrasclass__Client2: #Rebinds__classindependent__ofinstances__X = Client1() #Makes__instanceof__augmentedclass__X.extra() #X__isinstance__oforiginal__Client1Decorators__essentiallyautomate__theprior__examples__manualname__rebinding here.Just__asfor__metaclasses,because__thisdecorator__returnsthe__original class,instances__aremade__fromthat__class,not__froma__wrapper object.In__fact,instance__creationis__notintercepted__atall__inthis__example.In__thisspecific__caseadding__methodsto__aclass__whenit__screated__thechoice__betweenmetaclasses__anddecorators__is arbitrary.Decorators__canbe__usedto__manageboth__instancesand__classesand__intersectmost__stronglywith__metaclassesin__thesecond__ofthese__roles,but__thisdiscrimination__isnot__absolute.In__fact,the__rolesof__eachare__suggestedin__partby__their mechanics.As__well__detail ahead,decorators__technicallycorrespond__tometaclass__callsused__tomake__andinitialize__new classes. Metaclasses, though,have__additionalcustomization__hooksbeyond__class creation.Their__methodsinherited__by classes,for__example,have__nodirect__counterpartin__classdecorators__sansextra__code.This__canmake__metaclassesmore__complexbut__alsobetter__suitedfor__augmentingclasses__insome__contexts. Conversely,because__metaclassesare__designedto__manage classes,applying__themto__managinginstances__aloneis__less optimal.Because__theyare__alsoresponsible__formaking__theclass__itself,metaclasses__incurthis__asan__extrastep__in instance-management__rolesand__areperhaps__lessappropriate__than decorators.We__llexplore__someof__thesedifferences__inworking__codelater__inthis__chapter.To__betterunderstand__howmetaclasses__dotheir__work, though,we__firstneed__toget__aclearer__pictureof__theirunderlying__model.The__MetaclassModel__Tounderstand__metaclasses,you__firstneed__tounderstand__abit__moreabout__bothPython__sobject__modeland__whathappens__atthe__endof__aclass__statement.As__youll__learn here,the__twoare__intimately related.Classes__AreInstances__oftype__Thefirst__ofthese__prerequisiteswas__coveredpreviously__byThe__PythonObject__Model ,which__inturn__assumesknowledge__ofthe__MRO (methodresolution__order)covered__inChapter__31.You__shouldreview__thatcontent__nowif__needed,especially__ifyou__vejumped__intothis__chapterat__random.We__renot__goingto__repeatits__coveragein__full here,but__someof__itsconclusions__arecrucial__tounderstanding__metaclasses. Namely:Instances__arecreated__from classes.Classes__areinstances__ofa__metaclass.The__type built-inis__thetopmost__metaclass.Metaclasses__customizetype__withnormal__class statements.In__short,classes__are types,types__are classes,and__metaclassescustomize__types.Per__Chapter 32,the__relationshipbetween__metaclassesand__classesis__subtlydifferent__fromthat__betweenclasses__andtheir__nonclass instances.The__latterdo__notgenerate__more instances,and__whileattribute__inheritanceuses__thesame__coremechanisms__andMRO__everywhere,classes__searcha__metaclasstree__thatnonclass__instancesdo__not.We__llstudy__thenuts__andbolts__ofinheritance__ahead,but__its__easyto__seethis__models__fundamentalsin__code. Built-inobjects__likelists__areactually__nonclassinstances__madefrom__a class,which__itselfis__madefrom__the built-in type: >>> type([]), type(type([])) #List__instanceis__createdfrom__listclass__(, ) #List__classis__createdfrom__typeclass__>>> type(list), type(type) # Same,but__withtype__names (, ) #Type__oftype__is type:top__ofhierarchy__Apartfrom__theliteral__syntaxof__built-ins,this__worksthe__sameway__for user-defined__classes,which__arereally__just user-definedtypes__theirnonclass__instancesare__madefrom__the class,which__itselfis__madefrom__the built-in type: >>>class__Hack:pass__# User-definedclasses__workthe__same >>>I__= Hack() #Made__from class,which__ismade__fromtype__>>> type(I), type(type(I)) (, )Although__theirbehavior__variesin__wayswe__exploredin__Chapter 32,both__classesand__nonclassinstances__areinstances__insome__sense.In__fact,the____class__attribute__inboth__tellsus__whatthey__weremade__from: >>> [].__class__, list.__class__ #Instances__andclasses__areboth__"instances" (, ) # type(X)is__normallysame__as X.__class__ >>> I.__class__, Hack.__class__ (, )Because__classesare__createdfrom__theroot__typeclass__by default,most__programmersdon__tneed__tothink__aboutthis__model. However,it__skey__tounderstanding__theway__thatmetaclasses__workas__thenext__section explains.Metaclasses__AreSubclasses__oftype__Whywould__wecare__thatclasses__areinstances__ofa__type class?It__turnsout__thatthis__isthe__hookthat__allowsus__tocode__metaclasses. Specifically,we__cancreate__classesfrom__subclassesof__typethat__customizeit__withnormal__object-orientedtechniques__andclass__syntax.And__thesetype__subclassesare__knownas__metaclasses.In__other words,to__controlthe__wayclasses__arecreated__andaugment__their behavior,all__weneed__todo__isspecify__thata__user-definedclass__becreated__froma__user-definedmetaclass__insteadof__thenormal__anddefault__type class.Before__wesee__how,it__simportant__tobear__inmind__thatthis__typeinstance__relationshipis__notquite__thesame__asnormal__inheritance. User-definedclasses__mayalso__havesuperclasses__fromwhich__theyand__theirinstances__inheritattributes__as usual.As__weve__seen,inheritance__superclassesare__listedin__parenthesesin__theclass__statement,show__upin__aclass__s__bases____tuple,and__aresearched__forattributes__fetchedfrom__nonclass instances. However,the__typefrom__whicha__classis__createdand__ofwhich__itis__aninstance__isa__different relationship.Inheritance__searchesinstance__andclass__namespace dictionaries,but__classesmay__alsoacquire__behaviorfrom__theirtype__thatis__notexposed__tothe__normalinheritance__search.In__fact,metaclasses__definea__separate,secondary__inheritancetree__availableonly__toclasses__andused__asa__fallbackwhen__thenormal__superclasssearch__fails.To__laythe__groundworkfor__understandingthis__distinction,the__nextsection__describesthe__procedureand__syntaxPython__usesto__implementthis__instance-of relationship.Class__StatementsCall__atype__Subclassingthe__typeclass__tocustomize__itis__reallyonly__halfof__themetaclass__backstory.We__stillneed__tosomehow__routea__classs__creationto__themetaclass__insteadof__thedefault__type.To__comprehendthe__waythat__thisis__arranged,we__alsoneed__toknow__howclass__statementsdo__their business.We__vealready__learnedthat__whenPython__reachesa__class statement,it__runsits__nestedblock__ofcode__tocreate__theclass__sattributes__allthe__namesassigned__atthe__toplevel__ofthe__nestedcode__blockgenerate__attributesin__theresulting__class object.These__namesare__usuallymethod__functionscreated__bynested__defs,but__theycan__alsobe__arbitraryattributes__assignedto__createclass__datashared__byall__instances.Technically__speaking,Python__followsa__standardprotocol__tomake__this happen:at__theend__ofa__class statement,and__afterrunning__allits__nestedcode__ina__namespacedictionary__correspondingto__theclass__slocal__scope,Python__callsthe__typeobject__tocreate__thenew__classobject__like this:class__= type(classname, superclasses, attributedict)The__typeobject__inturn__definesa____call__ operator-overloadingmethod__thatruns__twoother__methodswhen__thetype__objectis__called: type.__new__(typeclass, classname, superclasses, attributedict) type.__init__(class, classname, superclasses, attributedict)The____new__method__createsand__returnsthe__newclass__object,after__whichthe____init__method__initializesthe__newlycreated__object.As__youll__seein__a moment,these__arethe__hooksthat__metaclasssubclasses__oftype__generallyuse__toperform__classcustomizations__atcreation__time.For__example,given__aclass__definitionlike__thefollowing__for Hack:class__Super: #Inherited__nameshere__class Hack(Super): #Inherits__fromSuper__data = 1 #Class__dataattribute__def meth(self, arg): #Class__methodattribute__return self.data +arg__Pythonwill__internallyrun__thenested__codeblock__tocreate__twoattributes__ofthe__class (dataand__meth),and__thencall__thetype__objectto__generatethe__classobject__atthe__endof__theclass__statements__processing (extranames__like__module____areadded__automaticallyfrom__thecode__s context):Hack__= type('Hack', (Super,), {'data': 1, 'meth': meth, '__module__': '__main__'})In__fact,you__cancall__typethis__wayyourself__tocreate__aclass__dynamicallyalbeit__herewith__afabricated__methodfunction__andempty__superclassestuple__(Pythonadds__theobject__superclassautomatically__totopmost__classesas__welearned__inChapter__32,and__theenclosing__modules__nameis__again implied): >>>c__= type('Hack', (), {'data': 1, 'meth': (lambda x, y: x.data + y)}) >>>i__= c() >>> c,i__(, <__main__.Hackobject__at 0x108077c20>) >>> i.data, i.meth(2) (1, 3)The__classproduced__bya__directtype__callis__exactlylike__thatyou__dget__fromrunning__aclass__statement (again,if__youve__forgottenwhat__someof__thefollowing__are about, flip, click,or__tapback__toChapter__32for__a refresher): >>> c.__bases__ (,) >>> i.__class__.__mro__ (, ) >>> [afor__ain__dir(i)if__not a.startswith('__')] ['data', 'meth'] >>> [(a, v)for__(a, v)in__c.__dict__.items()if__not a.startswith('__')] [('data', 1), ('meth',at__0x1082179c0>)]Because__thistype__callis__madeautomatically__atthe__endof__theclass__statement, though,it__san__idealhook__foraugmenting__orotherwise__processinga__class.The__tricklies__inreplacing__thedefault__typewith__acustom__subclassthat__willintercept__this call.The__nextsection__shows how.Class__StatementsCan__Choosea__typeAs__weve__just seen,classes__arecreated__bythe__typeclass__by default.To__tellPython__tocreate__aclass__witha__custommetaclass__instead,you__simplyneed__todeclare__ametaclass__tointercept__thenormal__instancecreation__callfor__a user-defined__class.To__do so,list__thedesired__metaclassas__akeyword__argumentin__theclass__header:class__Hack(metaclass=Meta): #Use__Metainstead__oftype__defaultIf__nosuch__declarationis__present,the__metaclassto__becalled__defaultsto__thetype__built-in,per__theprior__section.When__used, though,this__declarationoverrides__thetype__defaultand__routesthe__classcreation__callat__theclose__ofthe__classstatement__toMeta__instead:class__= Meta(classname, superclasses, attributedict)Importantly__again,the__metaclasskeyword__specifiesan__instance-of relationship,which__impliesinheritance__onlythrough__thesecondary__metaclasstree__well__formalize ahead.Normal__inheritancesuperclasses__canbe__listedin__theheader__aswell__andtake__precedenceby__residingin__theprimary__class tree.In__the following,for__example,the__newclass__Hackinherits__fromsuperclass__Supernormally__butis__alsoan__instanceof__andis__createdby__metaclass Meta:class__Hack(Super, metaclass=Meta): #Normal__supers OK:listed__firstIn__this form,superclasses__mustbe__listedbefore__the metaclass;in__effect,the__orderingrules__usedfor__keywordarguments__infunction__callsapply__here too.This__orderalso__hasimplications__for inheritance,which__well__formalize soon,but__first,we__needto__learnhow__tocode__themetaclasses__thattap__intocalls__triggeredby__thisspecial__class syntax.Metaclass__MethodProtocol__Whena__specificmetaclass__isdeclared__perthe__priorsections__syntax,the__callto__createthe__classobject__runat__theend__ofthe__classstatement__ismodified__toinvoke__themetaclass__insteadof__thetype__default,as__wejust__saw:class__= Meta(classname, superclasses, attributedict)Assuming__themetaclass__isa__subclassof__type, though,the__typeclass__sinherited____call__method__delegatescreation__andinitialization__ofthe__newclass__objectto__themetaclass__ifthe__metaclassdefines__customversions__ofthe__methodsthat__handlethese__steps.In__other words,the__Metacall__maywind__uptriggering__thesemethod__callsin__turn:class__= Meta.__new__(Meta, classname, superclasses, attributedict) Meta.__init__(class, classname, superclasses, attributedict)To__demonstrate,here__sthe__precedingclass__example again,augmented__witha__metaclass specification:class__Hack(Super, metaclass=Meta): #Inherits__from Super,instance__ofMeta__data = 1 #Class__dataattribute__def meth(self, arg): #Class__methodattribute__return self.data +arg__Atthe__endof__thisclass__statement,Python__internallyruns__thefollowing__tocreate__theclass__object again,a__callyou__couldmake__manually, too,but__automaticallyrun__byPython__sclass__machinery:Hack__= Meta('Hack', (Super,), {'data': 1, 'meth': meth, '__module__': '__main__'})If__themetaclass__definesits__ownversions__of__new____or __init__,they__willbe__invokedduring__thiscall__bythe__inheritedtype__classs____call__ method.The__neteffect__isto__automaticallyrun__methodsthe__metaclassprovides__aspart__ofthe__class-construction__process.The__nextsection__showshow__wemight__goabout__codingthis__finalpiece__ofthe__metaclass puzzle.Coding__MetaclassesSo__far,we__veseen__howPython__routesclass__creationcalls__toa__metaclassif__oneis__specifiedand__provided. How, though,do__weactually__codea__metaclassthat__customizes type?It__turnsout__thatyou__alreadyknow__mostof__thestory__metaclassesare__codedwith__normalPython__classstatements__and semantics.By__definition,they__aresimply__classesthat__inheritfrom__type (normally,at__least).Their__onlysubstantial__distinctionsare__thatPython__callsthem__automaticallyat__theend__ofa__classstatement__andthat__theymust__generallyadhere__tothe__interfaceexpected__bythe__typesuperclass__ifthey__subclass it.A__BasicMetaclass__Perhapsthe__simplestmetaclass__youcan__codeis__simplya__subclassof__typewith__a__new____methodthat__createsthe__classobject__byrunning__thedefault__methodin__type.A__metaclass__new____likethis__isrun__bythe____call__method__inheritedfrom__typeby__virtueof__normalinheritance__overrides;this__methodtypically__performswhatever__augmentationis__requiredand__callsthe__typesuperclass__s__new____methodto__createand__returnthe__newclass__object:class__Meta(type):def____new__(meta, classname, supers, classdict): #Run__byinherited__type.__call__return__type.__new__(meta, classname, supers, classdict)This__metaclassdoesn__treally__doanything__(wemight__aswell__letthe__defaulttype__createthe__class),but__itdemonstrates__theway__ametaclass__tapsinto__themetaclass__hookto__customizebecause__themetaclass__iscalled__atthe__endof__aclass__statement,and__becausethe__typeobject__s__call____dispatchesto__the__new____and__init____methods,code__weprovide__inthese__methodscan__manageall__theclasses__createdfrom__the metaclass.To__demo,Example__40-1is__ourinane__metaclass again,but__inmore__tangible form,with__printsadded__tothe__metaclassand__thefile__atlarge__totrace__the process.Example__40-1. metaclass1.pyclass__MetaOne(type):def____new__(meta, classname, supers, classdict): print('In MetaOne.new:', meta, classname, supers, classdict, sep='\n...')return__type.__new__(meta, classname, supers, classdict)class__Super:pass__print('Making class')class__Hack(Super, metaclass=MetaOne): #Inherits__from Super,instance__ofMetaOne__data = 1 #Class__dataattribute__def meth(self, arg): #Class__methodattribute__return self.data +arg__print('Making instance')X__= Hack() print('Attrs:', X.data, X.meth(2)) Here,class__Hackinherits__fromSuper__andis__aninstance__of MetaOne,but__Xis__aninstance__ofand__inheritsfrom__Hack.When__run,notice__howthe__metaclassis__invokedat__theend__ofthe__classstatement__andbefore__weever__makean__instanceof__thenew__classmetaclasses__process classes,and__classesprocess__nonclass instances: $ python3 metaclass1.pyMaking__classIn__MetaOne.new: ... ...Hack ...(,) ...{'__module__': '__main__', 'data': 1, 'meth': }Making__instance Attrs: 1 3Presentation__note:this__chapters__examplesoften__truncatehex__addressesand__omitsome__irrelevant built-in__X____namesin__namespace dictionaries,both__forbrevity__andbecause__built-inattributes__tendto__changeover__time.Run__theseexamples__onyour__ownfor__full,if__transient, fidelity.Customizing__Constructionand__InitializationMetaclasses__canalso__tapinto__the__init____protocolinvoked__bythe__typeobject__s __call__.In__general,__new____createsand__returnsthe__class object,and____init__initializes__thealready__createdclass__passedin__asan__argument.These__methodswork__in non-type classes, too,but____new__is__rarein__such classes.Metaclasses__canuse__eitheror__bothhooks__tomanage__classesat__creation time,as__Example 40-2 illustrates.Example__40-2. metaclass2.pyclass__MetaTwo(type):def____new__(meta, classname, supers, classdict): print() print('In MetaTwo.new:', meta, classname, supers, classdict, sep='\n...')return__type.__new__(meta, classname, supers, classdict)def____init__(Class, classname, supers, classdict): print() print('In MetaTwo.init:', Class, classname, supers, classdict, sep='\n...') print('...initclass__object:', list(Class.__dict__.keys()))class__Super:pass__print('Making class')class__Hack(Super, metaclass=MetaTwo): #Inherits__from Super,instance__ofMetaTwo__data = 1 #Class__dataattribute__def meth(self, arg): #Class__methodattribute__return self.data +arg__print('\nMaking instance')X__= Hack() print('Attrs:', X.data, X.meth(2))In__this case,the__classinitialization__methodis__runafter__theclass__construction method,but__bothmethods__runat__theend__ofthe__classstatement__andbefore__anynonclass__instancesare__made. Conversely,an____init__in__Hackwould__runlater__at nonclass-instancecreation__timeand__wouldnot__beaffected__orrun__bythe__metaclasss____init__: $ python3 metaclass2.pyMaking__classIn__MetaTwo.new: ... ...Hack ...(,) ...{'__module__': '__main__', 'data': 1, 'meth': }In__MetaTwo.init: ... ...Hack ...(,) ...{'__module__': '__main__', 'data': 1, 'meth': } ...initclass__object: ['__module__', 'data', 'meth', '__doc__']Making__instance Attrs: 1 3Other__MetaclassCoding__TechniquesAlthough__redefiningthe__typesuperclass__s__new____and__init____methodsis__themost__commonway__toinsert__logicinto__theclass__objectcreation__processwith__themetaclass__hook,other__schemesare__possible.They__maynot__dovetailas__neatlyinto__thenotion__ofmetaclass__methodswe__llstudy__ahead,but__theydo__support creation-time tasks.Using__simplefactory__functionsFor__example,metaclasses__neednot__reallybe__classesat__all.As__weve__learned,the__classstatement__issuesa__simplecall__tocreate__aclass__atthe__conclusionof__its processing.Because__of this,any__callableobject__can,in__principle,be__usedas__a metaclass,provided__itaccepts__thearguments__passedand__returnsan__objectcompatible__withthe__intended class.In__fact,a__simpleobject__factoryfunction__mayserve__justas__wellas__atype__subclass,as__Example 40-3 demonstrates.Example__40-3. metaclass3.py #A__simplefunction__canserve__asa__metaclasstoo__def MetaFunc(classname, supers, classdict): print('In MetaFunc:', classname, supers, classdict, sep='\n...')return__type(classname, supers, classdict)class__Super:pass__print('Making class')class__Hack(Super, metaclass=MetaFunc): #Run__simplefunction__atend__data = 1 #Function__returnsclass__def meth(self, arg):return__self.data +arg__print('Making instance')X__= Hack() print('Attrs:', X.data, X.meth(2))When__run,the__functionis__calledat__theend__ofthe__declaringclass__statement,and__itreturns__theexpected__newclass__object.The__functionis__simplycatching__thecall__thatthe__typeobject__s__call____normallyintercepts__by default: $ python3 metaclass3.pyMaking__classIn__MetaFunc: ...Hack ...(,) ...{'__module__': '__main__', 'data': 1, 'meth': }Making__instance Attrs: 1 3Technically__speaking,such__aplain__functionused__asa__metaclasscan__return anything:whatever__itreturns__isassigned__tothe__newclass__s name,whether__its__atype__instanceor__not.Other__kindsof__resultsmay__notsupport__laterinstance__creation,but__thisblurs__thedistinction__betweenmetaclasses__andclass__decoratorsboth__rebindnames__inthe__end.Overloading__classcreation__callswith__normalclasses__Becausenormal__(a.k.a. nonclass)instances__canrespond__tocall__operationswith__operator overloading,they__canserve__insome__metaclass roles, too,much__likethe__preceding function.The__outputof__Example 40-4is__similarto__theprior__class-based__versions,but__its__basedon__asimple__classone__thatdoesn__tinherit__fromtype__atall__andprovides__a__call____forits__instancesthat__catchesthe__metaclasscall__usingnormal__operator overloading.All__classesare__createdfrom__a metaclass,even__ifit__sthe__defaulttype__metaclass,but__herewe__reusing__anonclass__instanceof__aclass__forthe__metaclass.Note__that__new____and__init____mustuse__differentnames__here,or__elsethey__willrun__whenthe__MetaObjinstance__is created,not__whenthat__instanceis__latercalled__inthe__roleof__metaclassafter__Hacks__class statement.The____call__here__mimicspart__ofwhat__types__method does.Example__40-4. metaclass4.py #A__normalclass__instancecan__serveas__ametaclass__tooclass__MetaObj:def____call__(self, classname, supers, classdict): print('In MetaObj.call:', classname, supers, classdict, sep='\n...')Class__= self.__New__(classname, supers, classdict) self.__Init__(Class, classname, supers, classdict)return__Classdef____New__(self, classname, supers, classdict): print('In MetaObj.new: ', classname, supers, classdict, sep='\n...')return__type(classname, supers, classdict)def____Init__(self, Class, classname, supers, classdict): print('In MetaObj.init:', classname, supers, classdict, sep='\n...') print('...initclass__object:', list(Class.__dict__.keys()))class__Super:pass__print('Making class')class__Hack(Super, metaclass=MetaObj()): # MetaObj()is__normalclass__instancedata__= 1 #Called__atend__ofstatement__def meth(self, arg):return__self.data +arg__print('Making instance')X__= Hack() print('Attrs:', X.data, X.meth(2))When__run,the__threemethods__aredispatched__viathe__normalinstance__s__call____inheritedfrom__itsnormal__class,but__withoutany__dependenceon__typedispatch__mechanicsor__semantics.This__routingis__largelyabout__class alone: $ python3 metaclass4.pyMaking__classIn__MetaObj.call: ...Hack ...(,) ...{'__module__': '__main__', 'data': 1, 'meth': }In__MetaObj.new: ...Hack ...(,) ...{'__module__': '__main__', 'data': 1, 'meth': }In__MetaObj.init: ...Hack ...(,) ...{'__module__': '__main__', 'data': 1, 'meth': } ...initclass__object: ['__module__', 'data', 'meth', '__doc__']Making__instance Attrs: 1 3In__fact,we__canuse__normalsuperclass__inheritanceto__acquirethe__callinterceptor__inthis__codingmodel__thesuperclass__inExample__40-5serves__essentiallythe__samerole__as type,at__leastin__termsof__metaclass dispatch.Such__codemay__be atypical,but__itdemos__theunderlying__metaclassdispatch__model.Example__40-5. metaclass5.py #Instances__inheritfrom__classesand__theirsupers__normallyclass__SuperMetaObj:def____call__(self, classname, supers, classdict): print('In SuperMetaObj.call:', classname, supers, classdict, sep='\n...')Class__= self.__New__(classname, supers, classdict) self.__Init__(Class, classname, supers, classdict)return__Classclass__SubMetaObj(SuperMetaObj):def____New__(self, classname, supers, classdict): print('In SubMetaObj.new: ', classname, supers, classdict, sep='\n...')return__type(classname, supers, classdict)def____Init__(self, Class, classname, supers, classdict): print('In SubMetaObj.init:', classname, supers, classdict, sep='\n...') print('...initclass__object:', list(Class.__dict__.keys()))class__Super:pass__print('Making class')class__Hack(Super, metaclass=SubMetaObj()): #Invoke__Subinstance__via Super.__call__rest__offile__sameas__Example 40-4This__examples__outputis__largelythe__sameas__thatof__itspredecessor__butreflects__normalinheritance__at work: $ python3 metaclass5.pyMaking__classIn__SuperMetaObj.call:as__beforeIn__SubMetaObj.new:as__beforeIn__SubMetaObj.init:as__beforeMaking__instance Attrs: 1 3Although__suchalternative__forms work,most__metaclassesachieve__their creation-time__goalsby__redefiningthe__typesuperclass__s__new____and __init__;in__practice,this__maybe__simplerthan__other schemes.Regardless__ofits__coding, though,this__metaclassrole__broadlyintersects__withclass__decoratorsas__thenext__sectionwill__demonstrate.Managing__Classeswith__Metaclassesand__DecoratorsNow__thatwe__understandthe__hookmetaclasses__useto__insertcode__tobe__runat__classconstruction__time,let__sput__itto__better use.In__general,such__codecan__beused__toaugment__classes arbitrarily,and__inmany__ofthe__sameways__asthe__classdecorators__ofChapter__39.This__doesnt__makethese__twotools__identicalmetaclasses__alsosupport__thenotion__ofinherited__methodscoming__uplater__butthey__arefunctionally__redundantin__some roles.Adding__methodsto__classesTo__demoboth__thisequivalence__andmore__realistic usage,Example__40-6uses__metaclassesto__augmentthe__setof__methodsavailable__inclasses__byinserting__newmethods__at class-creationtime__assketched__inthe__abstractearlier__notthe__sortof__thingmost__programmersdo__ona__day-to-day basis,but__potentiallyuseful__intools__andlibraries__nonetheless.Example__40-6. extend_meta.py "Extenda__classwith__a metaclass"def__triple(obj):return__obj.value * 3 #Functions__toinsert__#Methods__ifin__aclass__def concat(obj): #Where__"obj"is__"self"return__obj.value + 'Code!'class__Extender(type):def____new__(meta, classname, supers, classdict): #On__client-classcreation__classdict['triple'] =triple__#Add__funcsas__attributes classdict['concat'] =concat__return type.__new__(meta, classname, supers, classdict)class__Client1(metaclass=Extender):def____init__(self, value): #Created__fromExtender__self.value =value__#Own__+inserted__methodsdef__double(self):return__self.value * 2class__Client2(metaclass=Extender): #Created__fromExtender__value = 'grok' #Inherited__classdata__X = Client1('hack') print(X.double(), X.triple(), X.concat(), sep='\n')Y__= Client2() print(Y.triple(), Y.concat(), sep='\n')Recall__againthat__classmethods__aresimply__functionsthat__normallyreceive__aninstance__throughwhich__theyare__called.The__metaclassin__thiscode__leveragesthis__toinsert__twofunctions__intoeach__ofits__clientclasses__whenthose__classesare__made.The__neteffect__providesmethods__andbehavior__forclients__thatdo__notexist__intheir__class statements: $ python3 extend_meta.pyhackhack__hackhackhack hackCode!grokgrokgrok__grokCode!Of__course,the__methodsinserted__heremight__becoded__ina__superclassand__inheritedby__clientsas__usual,but__themetaclass__hereis__freeto__selectinserted__methodsbased__onconditions__testedwhenever__clientsare__built.As__covered ahead,we__canalso__almostdo__thesame__withmetaclass__methods,but__thesemethods__areinherited__onlyby__classesand__wouldnt__workin__this example;the__methodsinserted__hereare__insteadavailable__tolater__classinstances__likeX__and Y.And__whilethis__mayseem__novel,it__seasy__toaccomplish__thesame__resultwith__class decorators.As__weve__learned,there__areindeed__somestriking__similaritiesbetween__these tools:Class__decoratorswork__byrebinding__classnames__tothe__resultof__acallable__atthe__endof__aclass__statementafter__thenew__classhas__been created.Metaclasses__workby__routing class-objectcreation__througha__callableat__theend__ofa__classstatement__inorder__tocreate__thenew__class.The__summakes__thesetwo__toolsfunctionally__equivalent,at__leastin__termsof__class-creation__dispatch.Example__40-7illustrates__thisequivalence__byrecoding__thesame__augmentationwith__aclass__decoratorinstead__ofa__metaclass.Example__40-7. extend_deco.py "Extenda__classwith__a decorator"def__triple(obj):return__obj.value * 3def__concat(obj):return__obj.value + 'Code!'def__extender(aClass): aClass.triple =triple__#Manages__class,not__instance aClass.concat =concat__#Same__asmetaclass____call__return__aClass @extenderclass__Client1: # Client1 = Extender(Client1)def____init__(self, value): #Rebound__atend__ofclass__stmt self.value =value__def double(self):return__self.value * 2 @extenderclass__Client2:value__= 'grok'X__= Client1('hack') print(X.double(), X.triple(), X.concat(), sep='\n')Y__= Client2() print(Y.triple(), Y.concat(), sep='\n')When__run,this__class-decoratorversion__soutput__isidentical__tothat__ofthe__metaclassvariant__inExample__40-6.It__worksthe__samebecause__bothdecorator__andmetaclass__arecalled__atthe__endof__aclass__statementand__returnan__objectto__whichthe__classs__nameis__assigned.Decorators__maybe__closestto__themetaclass____call__because__theyare__calledto__returnan__object,but__likemetaclass____init__,the__classhas__alreadybeen__builtby__thetime__adecorator__runs.Metaclass____call__runs____new__and____init__,and__metaclassescan__augmentin__anyof__thesethree__methods.Automatically__decoratingclass__methodsPerhaps__more interesting,metaclasses__anddecorators__canboth__augmentindividual__methodsof__classes.To__demo,we__lluse__theutility__modulein__Example 40-8,which__resurrectsthe__tracerand__timerfunction__decoratorswe__codedin__theprior__chapter.This__moduleis__entirely review,so__well__deferto__Chapter 39for__moredetails__(andpromise__thatthis__isthe__lastmileage__well__getfrom__this code).Example__40-8. decorators.pyimport__timedef__tracer(func): #Use__function,not__classwith____call__calls__= 0 #Else__selfis__decoratorinstance__onlydef__onCall(*args, **kwargs):nonlocal__callscalls__+= 1 print(f'call {calls}to__{func.__name__}')return__func(*args, **kwargs)return__onCalldef__timer(label='', trace=True): #On__decorator args:retain__argsdef__onDecorator(func): #On__@:retain__decoratedfunc__def onCall(*args, **kargs): #On__calls:call__originalstart__= time.perf_counter() #State__isscopes__+func__attributeresult__= func(*args, **kargs)elapsed__= time.perf_counter() -start__onCall.alltime +=elapsed__if trace: funcname,alltime__= func.__name__, onCall.alltime print(f'{label}{funcname}: {elapsed:.5f}, {alltime:.5f}')return__result onCall.alltime = 0return__onCallreturn__onDecoratorAs__welearned__inChapter__39,to__usethese__decorators manually,we__simplyimport__themfrom__themodule__anddecorate__eachfunction__wewish__to augment.While__thissuffices__for one-off augmentations,it__requiresus__toadd__decorationsyntax__beforeeach__methodwe__wishto__traceor__timeand__tolater__removethat__syntaxwhen__weno__longerdesire__theextensions__(oruse__the -Otrick__well__skip here).If__wewant__totrace__ortime__everymethod__ofa__class,this__canbecome__tediousand__maynot__bepossible__atall__inmore__dynamiccontexts__thatdepend__uponruntime__parameters.To__do better,Example__40-9uses__ametaclass__toadd__adecorator__toeach__ofa__classs__methods automatically.Because__themetaclass__controls decoration,it__canpredicate__decorationon__runtime checks.As__a bonus,it__canbe__usedfor__any decoration:the__decoratorto__applyto__methodsis__passedas__a top-level argument,and__henceis__allowedto__varyper__class.Example__40-9. decoall_meta.py "Applyany__decoratorto__allmethods__ofa__class,with__a metaclass"from__typesimport__FunctionTypefrom__decoratorsimport__tracer,timer__def decorateAll(decorator):class__MetaDecorate(type):def____new__(meta, classname, supers, classdict):for__attr,attrval__in classdict.items():if__type(attrval)is__FunctionType: classdict[attr] = decorator(attrval)return__type.__new__(meta, classname, supers, classdict)return__MetaDecorateclass__Person(metaclass=decorateAll(tracer)): #Use__ametaclass__def __init__(self, name, pay): #Pass__anyfunction__decorator self.name =name__self.pay =pay__def giveRaise(self, percent): self.pay *= (1.0 + percent)def__lastName(self):return__self.name.split()[-1]def__tester(aPerson):sue__= aPerson('Sue Jones', 100_000)bob__= aPerson('Bob Smith', 50_000) print(f'{sue.name=}, {bob.name=}') sue.giveRaise(.10) print(f'{sue.pay=:,.2f}') print('Last names:', sue.lastName(), bob.lastName())if____name__ == '__main__': tester(Person)When__thiscode__isrun__as is,its__outputtraces__callsto__everymethod__ofthe__clientclass__becauseevery__methodhas__beenautomatically__decoratedby__the metaclass: $ python3 decoall_meta.pycall__1to____init__call__2to____init__ sue.name='Sue Jones', bob.name='Bob Smith'call__1to__giveRaise sue.pay=110,000.00call__1to__lastNamecall__2to__lastNameLast__names:Jones__Smith Really,this__resultreflects__acombination__ofdecorator__andmetaclass__themetaclass__automaticallyapplies__thefunction__decoratorto__everymethod__atclass__creation time,and__thefunction__decoratorautomatically__interceptsmethod__callsin__orderto__printthe__tracemessages__inthis__output.The__combojust__works,thanks__tothe__generalityof__both tools.To__applya__differentdecorator__tothe__methods,simply__replacethe__decoratorname__inthe__classheader__line.To__usethe__timerfunction__decoratorshown__earlier,for__example,use__eitherof__thelast__twoheader__linesin__thefollowing__forour__Personclass__thefirst__acceptsthe__timers__default arguments,and__thesecond__specifieslabel__text (thoughmethods__mayrun__toofast__toregister__runtimesas__is:add__time.sleep(seconds)calls__topause__fora__better time):class__Person(metaclass=decorateAll(tracer)): #Apply__tracerclass__Person(metaclass=decorateAll(timer())): #Apply__timer,defaults__class Person(metaclass=decorateAll(timer(label='**'))): #Decorator__argumentsAnd__asyou__mightexpect__by now,class__decoratorsintersect__withmetaclasses__here, too.Example__40-10replaces__thepreceding__examples__metaclasswith__aclass__decorator. Really,it__usesa__classdecorator__thatapplies__afunction__decoratorto__eachmethod__ofa__decorated class.Python__sdecorators__naturallysupport__arbitrarynesting__and combinations.Example__40-10. decoall_deco.py "Applyany__decoratorto__allmethods__ofa__class,with__a decorator"from__typesimport__FunctionTypefrom__decoall_metaimport__testerfrom__decoratorsimport__tracer,timer__def decorateAll(decorator):def__DecoDecorate(aClass):for__attr,attrval__in aClass.__dict__.items():if__type(attrval)is__FunctionType: setattr(aClass, attr, decorator(attrval)) #Not____dict__return__aClassreturn__DecoDecorate @decorateAll(tracer) #Use__class deco,pass__anyfunc__decoclass__Person: #Applies__funcdecorator__tomethods__def __init__(self, name, pay): #Person__= decorateAll(..)(Person) self.name =name__#Person__= DecoDecorate(Person) self.pay =pay__def giveRaise(self, percent): self.pay *= (1.0 + percent)def__lastName(self):return__self.name.split()[-1]if____name__ == '__main__': tester(Person)When__thiscode__is run,the__classdecorator__appliesthe__tracerfunction__decoratorto__every method,which__inturn__producesa__tracemessage__oncalls__(theoutput__isthe__sameas__thatof__thepreceding__metaclassversion__ofthis__example): $ python3 decoall_deco.pysame__asExample__40-9Much__as before,we__simplymod__the @decorator__lineto__applya__differentdecorator__orprovide__differentarguments__for it.Test__thefollowing__onyour__ownto__seethe__effect (andagain__addsleep__callsas__neededto__boost times): @decorateAll(tracer) #Apply__tracer @decorateAll(timer()) #Apply__timer,defaults__@decorateAll(timer(label='**')) #Decorator__arguments @decorateAll(timer(label='**', trace=0)) #More__decoratorarguments__Noticethat__thisclass__decoratorreturns__theaugmented__class,not__aproxy__wrapper.As__forthe__metaclass version,this__retainsthe__typeof__theoriginal__classan__instanceof__Personis__stillan__instanceof__Person.This__maymatter__whentype__testingis__used.The__classs__methodsare__nottheir__originalfunctions__becausethey__arerebound__to decorators,but__thisis__likelyless__importantin__practice,and__its__truein__themetaclass__alternativeas__well.So__far,what__weve__seenof__metaclassesmakes__themseem__largelyredundant__withdecorators__butwe__havenot__yetseen__allthere__isto__see.As__teased earlier,metaclasses__mayalso__providebehavior__totheir__instanceclasses__bydefining__methods,which__haveno__directcounterpart__in decorators.These__methods, however,come__witha__twistthat__limitstheir__scope.To__understandboth__metaclassesmethods__andtheir__limiting twist, though,we__firsthave__tofactor__metaclassesinto__Pythonattribute__resolution, a.k.a. inheritance,at__large.The__nextsection__takesus__downthis__prerequisite path. Inheritance:The__FinaleBecause__metaclassesare__codedin__similarways__toinheritance__superclasses,their__scopecan__beconfusing__atfirst__glance.In__short,there__arereally__twoclass__treessearched__byPython__inheritancea__primarytree__formedby__aclass__andthat__classs__superclasses,along__witha__secondarytree__formedby__aclass__smetaclass__andthat__metaclasss__superclasses.The__secondarytree__isalso__calledthe__typetree__becauseit__stemsfrom__type.In__more detail,here__ishow__thispans__out:Metaclasses__inheritfrom__thetype__class (usually)Although__theyhave__aspecial__role,metaclasses__arecoded__withnormal__classstatements__andfollow__theusual__OOPmodel__in Python.As__subclassesof__type,they__canredefine__thetype__objects__methodsto__customizingclasses__as needed.Per__theprior__section,metaclasses__oftenredefine__thetype__classs____new__and____init__to__interceptclass__creationand__initialization.Metaclasses__canalso__definemethods__fortheir__instanceclasses__andmay__besimple__functionsor__othercallables__thatreturn__arbitrary objects.Metaclass__attributesare__notacquired__byclass__instancesMetaclass__declarationsspecify__aninstance__relationship,which__isnot__quitethe__sameas__superclass inheritance.Behavior__definedin__ametaclass__appliesto__theclasses__madefrom__itbut__notto__theseclasses__ownnonclass__instances.Inheritance__fora__nonclassinstance__searchesonly__theinstance__andthe__primarytree__formedby__itsclass__andthat__classs__superclasses;the__secondarymetaclass__treeis__neverincluded__inthis__search. Hence,nonclass__instancesget__behaviorfrom__classesand__superclassesbut__notfrom__metaclasses.Metaclass__attributesare__acquiredby__classesas__afallback__By contrast,classes__doacquire__methodsof__theirmetaclasses__byvirtue__ofthe__instance relationship.Metaclasses__definea__separateinheritance__tree,which__isa__sourceof__classbehavior__thatprocesses__classes themselves.For__classes only,inheritance__firstsearches__theprimary__treeformed__bythe__classand__itssuperclasses__andthen__fallsback__onthe__secondarytree__formedby__theclass__smetaclass__andits__superclassesas__aseparate__search.When__aname__isavailable__toa__classin__botha__metaclassand__a superclass,the__superclassversion__is used.Metaclass__declarationsare__alsoinherited__bysubclasses__The metaclass=Mdeclaration__ina__user-definedclass__isalso__inheritedby__theclass__snormal__subclassesin__muchthe__sameway__thatsuperclass__linksare__inheritedby__subclasses. Thus,the__metaclasswill__runfor__theconstruction__ofeach__classthat__inheritsthis__specificationin__asuperclass__inheritance chain.This__models__conflationof__classesand__metaclassescan__maketerminology__challenging,but__itmay__beeasier__tounderstand__incode__thanin__prose.To__illustratethe__preceding points,consider__thecode__inExample__40-11.Example__40-11. metainstance.pyclass__Meta(type):def____new__(meta, classname, supers, classdict): #Redefine__typemethod__print('In Meta.new:', classname)return__type.__new__(meta, classname, supers, classdict)def__meth3(self):return__'three!'class__Super(metaclass=Meta): #Metaclass__inheritedby__substoo__def meth2(self): #Meta__runtwice__fortwo__classesreturn__'two!'class__Sub(Super): # Superclass:inheritance__versusinstance__def meth1(self): #Classes__inheritfrom__superclassesreturn__'one!' #But__notfrom__metaclassesfor__instanceaccess__Whenthis__files__codeis__run (asa__scriptor__module),the__metaclasshandles__constructionof__bothclient__classes.When__thoseclasses__arelater__used,nonclass__instancesinherit__classattributes__butnot__metaclass attributes: >>>from__metainstanceimport__* #Runs__class statements:metaclass__run twice!In__Meta.new:Super__In Meta.new:Sub__>>>X__= Sub() #Nonclass__instanceof__user-definedclass__>>> X.meth1() #Inherited__fromSub__'one!' >>> X.meth2() #Inherited__fromSuper__'two!' >>> X.meth3() #Not__inheritedfrom__metaclass! AttributeError: 'Sub'object__hasno__attribute 'meth3'.Did__you mean: 'meth1'?By__contrast,classes__bothinherit__namesfrom__theirsuperclasses__andacquire__namesfrom__theirmetaclass__whoselinkage__inthis__exampleis__itselfinherited__froma__superclassby__Sub: >>> Sub.meth1(X) #Own__method 'one!' >>> Sub.meth2(X) #Inherited__fromSuper__'two!' >>> Sub.meth3() #Acquired__frommetaclass__'three!' >>> Sub.meth3(X) #Not__anormal__instance method! TypeError: Meta.meth3()takes__1positional__argumentbut__2were__givenNotice__howthe__lastof__thepreceding__callsfails__whenwe__passin__aninstance__becausethe__nameresolves__toa__metaclass method,not__anormal__instance method.In__fact,both__thesource__ofa__nameand__theobject__throughwhich__youfetch__itmatter__here.Methods__acquiredfrom__metaclassesare__boundto__thesubject__class,while__methodsfrom__normalclasses__areplain__functionswhen__fetchedthrough__theclass__butbound__withan__instancewhen__fetchedthrough__the instance: >>> Sub.meth3 > >>> Sub.meth2 >>> X.meth2 >We__studiedthe__lasttwo__ofthese__casesbefore__inChapter__31s__bound-method coverage.The__firstcase__isreminiscent__ofChapter__32s__classmethods__butis__technicallynew__here.We__llexplore__classmethods__inmore__detail later. First, though,to__understandwhy__metaclassmethods__arent__availableto__normal instances,we__needto__clarifythe__metaclass/superclassdistinction__further.Metaclass__VersusSuperclass__Ineven__simpler terms,watch__whathappens__inthe__following:as__aninstance__ofthe__Mmetaclass__type,class__Cacquires__Ms__attribute,but__thisattribute__isnot__madeavailable__forinheritance__byC__sown__instanceI__theacquisition__ofnames__bymetaclass__instancesis__distinctfrom__thenormal__inheritanceused__fornonclass__instances: >>>class__M(type):attr__= 1 >>>class__C(metaclass=M):pass__#C__ismeta__instanceand__acquiresmeta__attr >>>I__= C() #I__inheritsfrom__classbut__not meta! >>> C.attr 1 >>> I.attr AttributeError: 'C'object__hasno__attribute 'attr' >>> 'attr'in__C.__dict__, 'attr'in__M.__dict__ (False, True)By__contrast,if__Mmorphs__frommetaclass__to superclass,then__namesin__superclassS__becomeavailable__tolater__instancesof__Cby__inheritancethat__is,by__searchingthe____dict__attribute__dictionariesof__objectsin__theMRO__ofI__sclass__as usual,much__likethe__mapattrsexample__wecoded__backin__Example:Mapping__Attributesto__InheritanceSources__(a nonclass-instance-only tool): >>>class__S:attr__= 1 >>>class__C(S):pass__#C__istype__instanceand__inheritsfrom__supers >>>I__= C() #I__inheritsfrom__classand__supers >>> C.attr 1 >>> I.attr 1 >>> 'attr'in__C.__dict__, 'attr'in__S.__dict__ (False, True)This__iswhy__metaclassesoften__dotheir__workby__manipulatinga__newclass__snamespace__dictionaryif__theywish__toinfluence__thebehavior__oflater__instanceobjects__instanceswill__seenames__intheir__classbut__notits__metaclass.Watch__what happens, though,if__thesame__nameis__availablein__bothattribute__sourcesthe__inheritancename__inthe__primarysuperclass__treeis__usedinstead__ofthe__instanceacquisition__namein__thesecondary__metaclass tree: >>>class__M(type):attr__= 1 >>>class__S:attr__= 2 >>>class__C(S, metaclass=M):pass__#Supers__haveprecedence__overmetas__>>>I__= C() #Classes__searchsupers__beforemetas__>>> C.attr, I.attr #Instances__searchonly__supers (2, 2) >>> 'attr'in__C.__dict__, 'attr'in__S.__dict__, 'attr'in__M.__dict__ (False, True, True)This__istrue__regardlessof__therelative__heightof__theinheritance__andinstance__sourcessuperclass__inheritancealways__beatsmetaclass__acquisitionbecause__primarytrees__aresearched__beforesecondary__trees: >>>class__M(type):attr__= 1 >>>class__S2:attr__= 2 >>>class__S1(S2):pass__>>>class__C(S1, metaclass=M):pass__#Super__twolevels__above meta:still__wins >>>I__= C() >>> C.attr, I.attr (2, 2)In__fact,classes__acquiremetaclass__attributesthrough__their__class____link,in__thesame__waythat__nonclassinstances__inheritfrom__classesthrough__their__class____whichmakes__sense,given__thatclasses__arealso__instancesof__metaclasses.The__chiefdistinction__isthat__instanceinheritance__doesnot__alsofollow__aclass__s__class____butinstead__restrictsits__scopeto__the__dict____ofeach__classin__thesuperclass__tree,following____bases__along__the way: >>> I.__class__ #Followed__by inheritance: instance'sclass__>>> C.__bases__ #Followed__by inheritance: class'ssupers__(,) >>> C.__class__ #Followed__byinstance__acquisition:metaclass__Really, though,Python__checksthe____dict__of__eachclass__onthe__classs__MRObefore__fallingback__ondoing__thesame__forits__metaclassand__runsthe__secondof__thesesteps__onlyfor__fetchesrun__on classes,not__nonclass instances: >>> [x.__name__for__xin__C.__mro__] #See__Chapter 32for__allthings__MRO ['C', 'S1', 'S2', 'object'] >>> [x.__name__for__xin__M.__mro__] # Primary/secondary trees: class/meta ['M', 'type', 'object']These__twoMROs__forclass__andmetaclass__aresimply__theflattened__versionsof__whatwe__calledthe__primaryand__secondaryclass__trees earlier. Nonclass-instanceinheritance__searchesjust__the first,but__classinheritance__searchesboth__if needed.In__fact,metaclasses__workin__muchthe__same way,as__thenext__section explains.Metaclass__InheritanceAs__itturns__out,instance__inheritanceworks__insimilar__ways,whether__theinstance__isa__nonclassinstance__createdfrom__aclass__ora__classcreated__froma__metaclassderived__from type.While__classesstraddle__theprimary__andsecondary__trees,both__treesuse__thesame__mechanismto__lookup__names.This__yieldsa__singleattribute__searchprocedure__spanningtwo__trees,which__fostersthe__parallelnotion__ofmetaclass__inheritance hierarchies.The__followingdemos__thisconceptual__merger.In__it,instance__Iinherits__fromall__its classes;class__Cinherits__fromboth__superclassesand__metaclasses;and__metaclass M1inherits__fromhigher__metaclasses: >>>class__M2(type): attr4 = 4 #Metaclass__inheritancetree__>>>class__M1(M2): attr3 = 3 #Gets____bases__, __class__,__mro____>>>class__S: attr2 = 2 #Superclass__inheritancetree__>>>class__C(S, metaclass=M1): attr1 = 1 #Gets____bases__, __class__,__mro____>>>I__= C() #I__gets__class____butnot__others >>> I.attr1, I.attr2 #Instance__inheritsfrom__supertree__(1, 2) >>> C.attr1, C.attr2, C.attr3, C.attr4 #Class__getsnames__fromboth__trees! (1, 2, 3, 4) >>> M1.attr3, M1.attr4 #Metaclass__inheritsnames__too! (3, 4) >>> I.attr3 AttributeError: 'C'object__hasno__attribute 'attr3'.Did__you mean: 'attr1'?The__failureat__theend__ofthis__listingis__pivotal.Both__inheritancepaths__classand__metaclassemploy__thesame__linksto__buildclass__MROsscanned__by inheritance.But__thisis__notapplied__transitivelyinstances__donot__inherittheir__classs__metaclass names,though__theymay__requestthem__explicitly: >>> I.__class__ #Links__usedat__instancewith__no__bases____>>> C.__bases__ (,) >>> C.__class__ #Links__usedat__classafter__its__bases____>>> M1.__bases__ #Link__alsoused__inmetaclass__inheritance (,) >>> I.__class__.attr4 #Route__inheritanceto__the class'smeta__tree 4 >>> I.attr4 #Though__class's__class____notfollowed__normally AttributeError: 'C'object__hasno__attribute 'attr4'.Did__you mean: 'attr1'?And__as usual,both__treeshave__flattenedMROs__andinstance__linksactually__usedby__inheritance: >>> M1.__class__ #Metaclasses__areclasses__too >>> [x.__name__for__xin__C.__mro__] #__bases____treefrom__I.__class__ ['C', 'S', 'object'] >>> [x.__name__for__xin__M1.__mro__] #__bases____treefrom__C.__class__ ['M1', 'M2', 'type', 'object']If__youcare__aboutmetaclasses__ormust__usecode__thatdoes__studythese__examples carefully.In__effect,nonclass__instanceshave__no__bases____tosearch__butfollow____class__to____bases__ once,and__classesfollow____bases__before__followinga__single__class____toanother____bases__.Because__thisis__crucialto__themeaning__ofattribute__namesin__Python,the__nextsection__beginsmaking__itmore__formal.Python__Inheritance Algorithm:The__SimpleVersion__Nowthat__weknow__aboutmetaclass__acquisition,we__refinally__ableto__formalizethe__inheritancerules__thatthey__augment.Inheritance__deploystwo__distinctbut__similarlookup__routines,both__ofwhich__arefounded__onMROs__computedfrom__theprior__sections____bases__links__perChapter__32.The__combinationyields__thefollowing__first-cutdefinition__ofPython__sattribute__inheritancealgorithm__runfor__explicitattribute__fetches.To__lookup__anattribute__name: 1.From__anonclass__instance I,search__the instance,then__its class,and__thenall__its superclasses, using: a.The____dict__of__theinstance__I b.The____dict__of__allclasses__onthe____mro__found__atI__s __class__,from__leftto__right 2.From__aclass__C,search__the class,then__allits__superclasses,and__thenits__metaclasses tree, using: a.The____dict__of__allclasses__onthe____mro__found__atC__itself,from__leftto__right b.The____dict__of__allmetaclasses__onthe____mro__found__atC__s __class__,from__leftto__right 3.In__rules 1and__2,also__allowfor__theseexceptions__covered ahead:Give__precedenceto__datadescriptors__presentin__stepb__sourcesSkip__stepa__andbegin__thesearch__atstep__bfor__built-inoperations__Performa__customMRO__searchfor__aproxied__objectin__superobjects__Rules 1and__2are__appliedfor__normal,explicit__attributefetch__only,and__thereare__exceptionsfor__built-ins, descriptors,and__super,which__well__clarifyin__a moment.In__addition,a____getattr__or____getattribute__may__alsobe__usedfor__missingor__all names, respectively,per__Chapter 38,and__attributeassignment__followsdifferent__rules.The__firsttwo__rules here, however,are__the essentials.They__specifythe__inheritancesearch__oftwo__separate trees,which__worksthe__samein__eachtree__butspans__treesfor__classinheritance__alone.The__MROpseudocode__ofChapter__32summarizes__thiseven__more concisely: [I.__dict__] + [x.__dict__for__xin__I.__class__.__mro__] [x.__dict__for__xin__C.__mro__] + [x.__dict__for__xin__C.__class__.__mro__]In__this,the__firstline__issources__searchedby__rule 1for__inheritancefrom__anonclass__instanceI__boththe__instanceitself__andthe__flattenedversion__ofthe__primaryclass__tree.The__secondline__isrule__2s__sourcesfor__inheritancefrom__aclass__Cthe__flattenedversions__ofboth__theprimary__classtree__andthe__secondarymetaclass__tree.Put__another way,nonclass__instancesand__classesboth__searcha__classtree__sMRO__attheir____class__as__asecond__step,but__classesfirst__searchtheir__ownMRO__ssuperclass__treeinstead__ofa__single__dict____namespace dictionary.In__code,class__headerlines__defineboth__ofthe__treessearched__bylisting__superclassesand__specifylinks__tosecondary__treeswith__metaclass keywords.When__omitted,superclass__defaultsto__objectand__metaclassto__type.Most__programmersneed__onlybe__awareof__thefirst__ofthese__rules (1)and__perhapsthe__firststep__ofthe__second (2a).There__san__extraacquisition__stepadded__formetaclasses__(2b),but__its__essentiallythe__sameas__othersa__subtle equivalence,to__be sure,but__metaclassacquisition__isnot__asnovel__asit__may seem.It__sjust__onestep__ofthe__procedure.The__descriptorsdeviation__At least,that__sthe__normaland__sugarcoated case.The__priorsection__listedits__exceptionsseparately__becausethey__dont__matterin__mostcode__andcomplicate__thealgorithm__substantially.First__among these,inheritance__alsohas__a special-casecoupling__withChapter__38s__attribute descriptors.In__short,data__descriptorsthose__thatdefine____set__methods__tointercept__assignmentsare__given precedence,such__thattheir__namesoverride__otherinheritance__sources.This__exceptionostensibly__servessome__practical roles.For__example,it__isused__toensure__thatthe__special__class____and__dict____attributescannot__beredefined__bythe__samenames__inan__instances__own __dict__.In__the following,these__data-descriptor__namesin__theclass__overridesame__namescreated__inthe__instances__attribute dictionary: >>>class__C:pass__#Inheritance__special case... >>>I__= C() #Class__datadescriptors__haveprecedence__>>> I.__class__, I.__dict__ (, {}) >>> I.__dict__['book'] = 'lp6e' #Dynamic__datain__theinstance__>>> I.__dict__['__class__'] = 'hack' #Assign__keys,not__attributes >>> I.__dict__['__dict__'] = {} >>> I.book # I.namecomes__from I.__dict__as__usual 'lp6e' #But__I.__class__and__I.__dict__do__not! >>> I.__class__, I.__dict__ (, {'book': 'lp6e', '__class__': 'hack', '__dict__': {}})This__data-descriptorexception__istested__beforethe__precedingtwo__inheritancerules__asa__preliminary step,may__bemore__importantto__Pythonimplementers__thanPython__programmers,and__canbe__reasonablyignored__bymost__applicationcode__inany__eventthat__is,unless__youcode__datadescriptors__ofyour__own,which__followthe__sameinheritance__special case: >>>class__D:def____get__(self, instance, owner): print('D.__get__')def____set__(self, instance, value): print('D.__set__') >>>class__C:d__= D() # Data-descriptorattribute__>>>I__= C() >>> I.d #Inherited__datadescriptor__access D.__get__ >>> I.d = 1 D.__set__ >>> I.__dict__['d'] = 'hack' #Define__samename__ininstance__namespacedict__>>> I.d #But__doesn'thide__datadescriptor__in class! D.__get__ Conversely,if__thisdescriptor__didnot__definea____set__,the__namein__theinstance__sdictionary__wouldhide__thename__inits__class instead,per__normal inheritance: >>>class__D:def____get__(self, instance, owner): print('D.__get__') >>>class__C:d__= D() >>>I__= C() >>> I.d #Inherited__nondatadescriptor__access D.__get__ >>> I.__dict__['d'] = 'hack' #Hides__classnames__pernormal__inheritancerules__>>> I.d 'hack'In__both cases,Python__automaticallyruns__thedescriptor__s__get____whenit__sfound__byinheritance__ratherthan__returningthe__descriptorobject__itselfpart__ofthe__implicitattribute__magicwe__metearlier__inthe__book.The__specialstatus__affordedto__data descriptors, however,also__modifiesthe__meaningof__attributeinheritance__and, thus,the__meaningof__namesin__your code.The__nextsection__sfinal__swingat__aformal__inheritancealgorithm__takesthis__into account.Python__Inheritance Algorithm:The__LessSimple__VersionWith__boththe__datadescriptor__specialcase__andgeneral__descriptorinvocation__factoredin__withclass__andmetaclass__trees,Python__sformal__inheritancealgorithm__canbe__statedas__followsa__complexprocedure__whichassumes__knowledgeof__descriptors, metaclasses,and__MROsbut__isthe__finalarbiter__ofattribute__names nonetheless.To__lookup__anattribute__name: 1.From__anonclass__instance I,search__the instance,its__class,and__its superclasses,as__follows: a.Search__the__dict____ofall__classeson__the__mro____foundat__Is____class__ b.If__adata__descriptorwas__foundin__step a,call__its__get____andexit__c. Else,return__avalue__inthe____dict__of__theinstance__I d. Else,call__anondata__descriptoror__returna__valuefound__instep__a 2.From__aclass__C,search__the class,its__superclasses,and__itsmetaclasses__treeas__follows: a.Search__the__dict____ofall__metaclasseson__the__mro____foundat__Cs____class__ b.If__adata__descriptorwas__foundin__step a,call__its__get____andexit__c. Else,call__anydescriptor__orreturn__avalue__inthe____dict__of__aclass__onC__sown____mro__ d. Else,call__anondata__descriptoror__returna__valuefound__instep__a 3.In__rules 1and__2, built-inoperations__essentiallyuse__juststep__asources__(see ahead) 4.The__super built-inperforms__acustom__MROsearch__fora__proxiedobject__(see ahead)Some__fineprint__here:in__this procedure,items__areattempted__insequence__as numbered,and__Pythonruns__atmost__one (for instances)or__two (for classes)MRO__searchesper__namelookup__thefirst__appearanceof__aname__ina__givenMRO__wins,regardless__ofits__kind.Because__eachMRO__(a.k.a. __mro__)is__aflattened__representationof__aclass__treewith__duplicates removed,you__canalso__thinkof__theseas__oneor__twotree__searches.In__addition,the__impliedobject__superclassprovides__somedefaults__atthe__topof__everyclass__andmetaclass__tree (that is,at__theend__ofevery__MRO).And__beyondall__this,method____getattr__may__berun__ifdefined__whenan__attributeis__not found,and__method__getattribute____maybe__runfor__everyattribute__fetch,though__theyare__special-caseextensions__tothe__namelookup__model (really,the__latterreplaces__inheritancefor__thedefining__classs__instances,and__cantrigger__theformer__withan__attribute exception).See__Chapter 38for__moreon__thesetools__aswell__as descriptors. Also,note__hereagain__thatthis__algorithms__firsttwo__stepsapply__onlyto__normaland__explicitattribute__fetch.The__rulesfor__attributeassignment__vary;the__implicitlookup__ofmethod__namesfor__built-insdoesn__tfollow__theserules__in full;and__theproxied__lookupof__attributesperformed__bysuper__isentirely__custom.The__nextsections__coverthese__exceptions separately.The__assignmentaddendum__Theprior__sectiondefines__inheritancein__termsof__attributereference__(a.k.a.fetch__or lookup),but__partsof__itapply__toattribute__assignmentas__well.As__weve__learned,assignment__normallychanges__attributesin__thesubject__object itself,but__inheritanceis__alsoinvoked__onassignment__totest__firstfor__someof__Chapter 38s__attributemanagement__tools,including__descriptors, properties,and____setattr__.When__present,such__toolsintercept__attributeassignment__andmay__implementit__arbitrarily.For__example,attribute__assignmentalways__invokesa____setattr__if__present,much__asa____getattribute__is__runfor__all references. Moreover,a__datadescriptor__witha____set__method__isacquired__froma__classby__inheritanceusing__theMRO__andhas__precedenceover__thenormal__storage model.In__termsof__theprior__sections__rules:When__appliedto__an instance,attribute__assignmentsessentially__followsteps__athrough__cof__rule 1,searching__theinstance__ssuperclass__tree,though__stepb__calls__set____insteadof____get__,and__stepc__stopsand__storesin__theinstance__insteadof__attemptinga__fetch.When__appliedto__a class,attribute__assignmentsrun__thesame__procedureon__theclass__smetaclass__tree:roughly__thesame__asrule__2,but__stepc__stopsand__storesin__the class.Because__descriptorsare__alsothe__basisfor__otheradvanced__attributetools__suchas__propertiesand__slots,this__inheritanceprecheck__onassignment__isutilized__inmultiple__contexts.The__neteffect__isthat__descriptorsare__treatedas__aninheritance__specialcase__forboth__referenceand__assignment.The__supersupplement__Evenfor__attribute reference,there__aretwo__specialcases__thatare__exemptfrom__inheritances__normal rules.For__one,the__super built-infunction__westudied__inChapter__32does__notuse__normal inheritance.As__we learned,for__theproxy__objectsreturned__by super,attributes__areresolved__bya__special context-sensitivescan__ofa__limitedtail__portionof__adifferent__objects__MRO.This__customscan__searchesthe__MROof__animplicit__instances__class,choosing__thefirst__descriptoror__valuefound__ina__classfollowing__theclass__containingthe__super call.This__scanis__usedinstead__ofrunning__fullinheritance__whichis__usedon__thesuper__objectitself__onlyif__this special-casescan__fails.See__Chapter 32for__morecoverage__of super.While__this built-inmay__beconvenient__insome__simple roles,it__comeswith__substantialcomplexity__inothers__andadds__aconvoluting__footnoteto__inheritance itself.The__built-insbifurcation__Aswe__vealso__learned,other__built-insdon__tfollow__inheritances__normalrules__either.Instances__andclasses__mayboth__beskipped__forthe__implicit method-namefetches__of built-in operations,as__aspecial__casethat__differsfrom__explicitname__references.Because__thisis__a context-specific divergence,it__seasier__todemonstrate__incode__thanto__weaveit__intoa__single algorithm.In__the following,str__isthe__built-in,__str____isits__explicit-name equivalent,and__thenonclass__instanceis__inconsistentlyskipped__bythe__built-in only: >>>class__C: #Inheritance__special case...attr__= 1 # Built-insskip__astep__def __str__(self): return('class') >>>I__= C() >>> I.__str__(), str(I) #Both__fromclass__ifnot__ininstance__('class', 'class') >>> I.__str__ = lambda: 'instance' >>> I.__str__(), str(I) # Explicit=>instance, built-in=>class! ('instance', 'class') >>> I.attr #Asymmetric__withnormal__orexplicit__names 1 >>> I.attr = 2; I.attr 2As__youmay__expectby__now,the__sameholds__truefor__classesexplicit__namesstart__atthe__class,but__built-insstart__atthe__classs__classwhich__isits__metaclass,and__defaultsto__type,which__providesaccess__toan__implicit default: >>>class__D(type):def____str__(self): return('D class') >>>class__C(D):pass__>>> C.__str__(C), str(C) # Explicit=>super, built-in=>metaclass! ('D class', "") >>>class__C(D):def____str__(self): return('C class') >>> C.__str__(C), str(C) # Explicit=>class, built-in=>metaclass! ('C class', "") >>>class__C(metaclass=D):def____str__(self): return('C class') >>> C.__str__(C), str(C) # Built-in=>user-definedmetaclass__('C class', 'D class')In__fact,it__cansometimes__benontrivial__toknow__wherea__namecomes__fromin__thismodel__sinceall__classesin__bothtrees__alsoinherit__fromobject__includingthe__defaulttype__metaclass.In__thefollowing__sexplicit__call,C__getsa__default__str____fromobject__insteadof__the metaclass,per__thefirst__sourceof__classinheritance__(theclass__sown__MRO,which__isthe__primary tree);by__contrast,the__str built-inskips__aheadto__themetaclass__as before: >>>class__C(metaclass=D):pass__>>> C.__str__(C), str(C) # Explicit=>object, built-in=>metaclass ("", 'D class') >>> C.__str__ >>>for__kin__(C, C.__class__, type): print([x.__name__for__xin__k.__mro__]) ['C', 'object'] ['D', 'type', 'object'] ['type', 'object']This__iswhy__weve__goneto__suchgreat__lengthsto__rootout__thefull__specsof__inheritance.While__somecode__maynever__needto__careabout__allits__manyplot__twists,attribute__inheritanceis__clearlya__convolutedbusiness__in Python,and__uncertaintyis__notgenerally__compatiblewith__engineering.The__Inheritance Wrap-UpAnd__withall__thosedetails__in hand,you__finallyhave__thecomplete__Pythoninheritance__storyor__atleast__asmuch__aswe__cancover__inthis__text.It__sa__tangledtale__thattoday__spans instances, classes, superclasses, metaclasses, descriptors, super, built-ins,and__MROs,and__allfor__thesake__oflooking__upa__simpleattribute__name.Some__practicalneeds__warrant exceptions,of__course,but__youshould__carefullyconsider__theimplications__ofan__object-orientedlanguage__thatapplies__inheritanceits__foundationaloperation__insuch__alabyrinthian__fashion.At__a minimum,this__shouldunderscore__theimportance__ofkeeping__yourown__codesimple__toavoid__makingit__dependenton__thedarker__cornersof__suchconvoluted__rules.As__always,your__codes__usersand__maintainerswill__beglad__you did.For__morefidelity__onthis__story,see__Pythons__internalimplementation__ofinheritance__a low-levelbut__completesaga__chronicledtoday__inits__files object.cand__typeobject.c,the__formerfor__normalinstances__andthe__latterfor__classes.Delving__intointernals__shouldnt__berequired__touse__Python,but__its__theultimate__andsometimes__solesource__oftruth__ina__complexand__perpetuallychanging__system.This__isespecially__truein__boundarycases__bornof__accruedexceptions__thatraise__thebar__forlearners__and users,a__downsidewe__llrevisit__brieflyin__thenext__andclosing__chapter.For__now,let__smove__onto__onelast__bitof__metaclassmagic__its methods,which__relyon__itsinheritance__offshoot.Metaclass__MethodsNow__thatwe__havea__handleon__theway__thatmetaclasses__modifythe__inheritanceof__names,we__canfinally__turnto__theirmethods__withfull__clarity.In__short,methods__inmetaclasses__areinherited__byand__processtheir__instanceclasses__insteadof__thenonclass__instancesthat__classes make.This__makesmetaclass__methodssimilar__inform__andfunction__tothe__classmethods__westudied__inChapter__32,though__their class-focusedbehavior__is automatic. Moreover,they__areavailable__onlyto__classesdue__tothe__lastsection__sinheritance__rulesthe__limitingtwist__alludedto__earlier.Metaclass__methodsalso__haveno__directanalog__inclass__decorators,though__decoratorsfreedom__toreturn__arbitraryobjects__makesnearly__anythingpossible__with imagination.To__demothe__basics,the__followings__metaclassdefines__amethod__madeavailable__toits__classs__instancesby__metaclassacquisition__(i.e.,by__inheritancefrom__thesecondary__metaclass tree): >>>class__M(type):def__z(cls): print('M.z', cls) #A__metaclass: instances=classesdef__y(cls): print('M.y', cls) #y__isoverridden__byinstance__C >>>class__C(metaclass=M):def__y(self): print('C.y', self) #A__simple class:nonclass__instancesdef__x(self): print('C.x', self) #Namespace__dictholds__xand__yMethods__fetchedfrom__theclass__areplain__functionsas__usual,but__thosefrom__ametaclass__areautomatically__boundto__theclass__fromwhich__theywere__fetched,as__wesaw__inan__earlier example: >>> C.x >>> C.y #x__andy__definedin__classitself__>>> C.z #z__acquiredfrom__metaclass > >>> C.z() #Metaclass__method call:gets__class M.zAs__weve__also seen,methods__fetchedthrough__anonclass__instanceare__boundto__theinstance__unlessclassmethod__orstaticmethod__are used,though__suchinstances__aremoot__herebecause__theydo__notinherit__metaclass names: >>>I__= C() >>> I.x() #Instance__method calls:get__inst C.x <__main__.Cobject__at 0x10e9d1400> >>> I.y() C.y <__main__.Cobject__at 0x10e9d1400> >>> I.z() #Instance__doesn'tsee__metanames__AttributeError: 'C'object__hasno__attribute 'z' >>> I.x >The__onlyreal__newthings__aboutmetaclass__methodsis__thatthey__areinherited__onlyby__classesand__arebound__toa__class automatically.The__latterhalf__ofthis__isexplored__inthe__next section.Metaclass__MethodsVersus__ClassMethods__Thoughthey__differin__inheritance visibility,metaclass__methodsare__designedto__manage class-level data,just__likethe__classmethods__westudied__inChapter__32.In__fact,their__rolescan__overlapmuch__asmetaclasses__canin__generalwith__classdecorators__butmetaclass__methodsare__notaccessible__exceptthrough__theclass__anddo__notrequire__anexplicit__classmethod class-leveldeclaration__inorder__tobe__boundwith__the class.In__other words,metaclass__methodscan__bethought__ofas__implicitclass__methods,with__limited visibility: >>>class__M(type):def__a(cls): #Metaclass__method:gets__class cls.x = cls.y + cls.z >>>class__C(metaclass=M): y,z__= 11, 22 @classmethod #Class__method:gets__classdef__b(cls):return__cls.x >>> C.a() #Call__metaclass method;visible__toclass__only >>> C.x #Creates__classdata__on C,accessible__tonormal__instances 33 >>>I__= C() >>> I.x, I.y, I.z (33, 11, 22) >>> I.b() #Class__method:sends__class,not__instance;visible__toinstance__33 >>> I.a() #Metaclass__methods:accessible__throughclass__only AttributeError: 'C'object__hasno__attribute 'a'This__yieldstwo__verydifferent__waysto__createclass__methodswhose__asymmetryis__leftas__suggestedpondering__here.NOTE__Plusone__more:Python__3.6added__an operator-overloadingmethod__named __init_subclass__.This__methodis__calledwhenever__thecontaining__classis__subclassed,and__itreceives__asingle__argument:the__newsubclass__object.It__providesyet__anotherway__tomanage__classes,though__thismethod__isnowhere__nearas__generalas__classdecorators__or metaclasses:it__srun__onlyfor__aclass__sown__subclassesand__onlywhen__thosesubclasses__are created.Similar__tometaclass__methods,this__methodis__alsoimplicitly__convertedto__aclass__method.Because__wejust__cant__getenough__ofthose__implicit hooks!Operator__Overloadingin__MetaclassMethods__Justin__caseyour__headis__notyet__spinning, metaclasses,just__likenormal__classes,may__alsoemploy__operatoroverloading__tomake__built-inoperations__applicableto__theirinstance__classes.The____getitem__indexing__methodin__thefollowing__metaclass,for__example,is__ametaclass__methoddesigned__toprocess__classesthemselves__theclasses__thatare__instancesof__the metaclass,not__thoseclasses__ownnonclass__instances: >>>class__M(type):def____getitem__(cls, i): #Meta__methodfor__processing classes:return__cls.data[i] # Built-insskip__class,use__meta #Explicit__namessearch__class +meta__>>>class__C(metaclass=M): #Data__descriptorsin__metaused__firstdata__= 'hack' >>> C[0] #Metaclass__instance names:visible__toclass__only 'h' >>> C.__getitem__ > >>>I__= C() >>> I.data, C.data #Normal__inheritance names:visible__toinstance__andclass__('hack', 'hack') >>> I[0] TypeError: 'C'object__isnot__subscriptableAnd__ifthat__snot__abstruse enough,when__bothclass__andmetaclass__overloadthe__same operator,the__formerapplies__toclasses__andthe__latterto__nonclass instances: >>>class__C(metaclass=M):data__= 'hack'def____getitem__(self, i):return__self.data[i] >>>I__= C() >>> I.data = 'code' >>> C[0], I[0] # C's []from__metaclass, I's []from__class ('h', 'c')All__ofwhich__leadsus__tothe__closing compare-and-contrastof__thenext__section.Metaclass__MethodsVersus__InstanceMethods__Theinescapable__conclusionof__thistechnical__novelis__thatmetaclass__methodsprovide__aseparate__andarguably__redundantway__tocode__objectbehavior__withclasses__in Python.As__weve__learned,the__usualway__toimplement__objectsis__withclasses__andtheir__nonclass instances.Here__sthe__normalcase__withclass__data, constructor,regular__method,and__operatoroverloading__availableto__instancesand__subclasses: >>>class__Employee: #A__"normal"class__rate = 50 #With__sharedclass__datadef____init__(self, name, hours): #Plus__instancedata__andmethods__self.name =name__self.hours =hours__def pay(self): print(f' {self.name} ${self.rate * self.hours:,.2f}')def____iadd__(self, hours): self.hours +=hours__returnself__As usual,we__makean__instanceof__anormal__classlike__thisby__callingit__withconstructor__arguments: >>>pat__= Employee('Pat', 2_000) #A__"normal"nonclass__instance >>> pat.pay() #Methods__inheritedfrom__classPat__$100,000.00 >>>pat__+= 1_000 #Updates__instancedata__>>> pat.pay()Pat__$150,000.00And__tomake__more instances,we__simplycall__theclass__again: >>> pat2 = Employee('Pat2', 1_000) #Another__"normal"instance__>>> pat2.pay() Pat2 $50,000.00 >>> pat2 <__main__.Employeeobject__at 0x10cf5c680>The__equivalentmetaclass__canalso__provide data,regular__methods,and__operator overloading.But__per-instanceconstructors__dont__quite apply;methods__receiveand__processa__class,not__instancesof__it;and__thisbehavior__isfor__subclassesand__instanceclasses__inthe__secondarytype__tree only: >>>class__MetaEmployee(type): #A__metaclassclass__rate = 50 #With__metaclassdata__andmethods__def pay(cls): print(f' {cls.name} ${cls.rate * cls.hours:,.2f}')def____iadd__(cls, hours): cls.hours +=hours__returncls__Becausemetaclass__instancesare__classes,we__definea__newclass__perinstance__insteadof__runninga__calland__codeinstance__dataas__class attributes,though__allthe__behaviordefined__inthe__metaclassapplies__toits__instance classes: >>>class__pat(metaclass=MetaEmployee): #A__metaclass instance:class__name = 'Pat' #With__classdata__perinstance__hours = 2_000 >>> pat.pay() #Methods__inheritedfrom__metaclassPat__$100,000.00 >>>pat__+= 1_000 #Updates__classdata__>>> pat.pay()Pat__$150,000.00We__havent__madeany__normalinstances__herejust__aclass__thatnevertheless__servesas__aninformation__recordwith__bothdata__andbehavior__methods.Coding__differences aside,the__mainfunctional__divergencein__themetaclass__approachis__thatnonclass__instancescreated__fromsuch__aclass__dont__inheritany__ofthe__behaviordefined__ina__metaclass: >>> pat2 = pat() #A__"normal"instance__ofclass__pat >>> pat2.pay() #Metaclass__behaviornot__available AttributeError: 'pat'object__hasno__attribute 'pay'To__makeadditional__instancesin__themetaclass__world,we__mustinstead__codeadditional__classes: >>>class__pat2(metaclass=MetaEmployee): #Metaclass__instancesare__classesname__= 'Pat2'hours__= 1_000 >>> pat2.pay() #With__allmetaclass__data+methods Pat2 $50,000.00Calling__themetaclass__withno__argumentsdoesn__twork__atall__becauseit__makesa__class,not__aninstance__ofa__classthough__callingthe__metaclasswith__fulltype__argumentsdoes__workbecause__its__equivalentto__runninga__classstatement__(and yes,the__factthat__metaclassesare__classes, too,makes__someof__thisparagraph__slogic__circular,but__thats__justhow__Python works:metaclasses__are special-casedfor__metaclass roles): >>> pat2 = MetaEmployee('pat2', (), dict(name='Pat2', hours=1_000)) >>> pat2.pay() Pat2 $50,000.00 >>> pat2In__sum,metaclasses__allowus__toimplement__classesthat__workmuch__likethe__nonclassinstances__weve__usedthroughout__this book.As__towhy__youd__wantto__swapone__kindof__instancefor__anotherwith__identicalfunctionality__butdifferent__coding,we__llhave__todefer__toother__resourcesto__justifythe__redundancy.Given__themany__convolutionsthat__metaclassesbring__tothe__table,it__sdifficult__notto__seethis__ascomplexity__forall__inthe__nameof__rareand__narrow roles.While__thathas__beena__recurringtheme__inboth__Pythonand__this book,it__stime__towrap__upand__moveon__tothe__conclusion.Chapter__SummaryIn__this chapter,we__studied metaclasses,explored__examplesof__themin__action,and__formalizedthe__rulesof__inheritancethat__they extend.Along__the way,we__alsosaw__howthe__rolesof__classdecorators__andmetaclasses__often intersect:because__bothrun__atthe__conclusionof__aclass__statement,they__cansometimes__beused__interchangeably.We__alsolearned__howmetaclass__methodsdefine__behaviorfor__classesmuch__likethe__classmethods__wemet__earlier,but__arelimited__inscope__tothe__secondaryinheritance__treesearched__for classes.Since__thischapter__coveredan__advanced topic,we__llwork__throughjust__afew__quizquestions__toreview__thebasics__(candidly,if__youve__madeit__thisfar__ina__chapteron__metaclasses,you__probablyalready__deserveextra__credit!).Because__thisis__thelast__partof__the book,we__llalso__forgothe__end-of-part exercises.Be__sureto__seethe__appendixesthat__followfor__Pythonplatform__pointersand__thesolutions__tothe__priorparts__exercises;the__lastof__theseincludes__asampling__ofshort__application-levelprograms__for self-study.Once__youfinish__the quiz,you__veofficially__reachedthe__endof__thisbook__stechnical__material.The__nextand__finalchapter__offerssome__briefthoughts__aboutPython__towrap__upthe__bookat__largeand__closeswith__some fun.We__llregroup__therein__theLearning__Pythonbenediction__afteryou__workthrough__thisfinal__quiz.Test__Your Knowledge:Quiz__1.What__isa__metaclass? 2.How__doyou__declarethe__metaclassof__a class? 3.How__doclass__decoratorsoverlap__withmetaclasses__formanaging__classes?Test__Your Knowledge:Answers__1.A__metaclassis__aclass__usedto__createa__class.Classes__areinstances__ofthe__typeclass__by default.Metaclasses__areusually__subclassesof__thetype__class,which__customize classes.They__mayredefine__class-creationprotocol__methodslike____new__and____init__tocustomize__theclass__creationcall__issuedat__theend__ofa__class statement.They__mayalso__definedata__andmethods__thatprovide__behaviorfor__theirinstance__classes,but__theseare__inheritedonly__by classes,not__theirnonclass__instances.Metaclasses__canalso__becoded__inother__waysas__simple functions,for__examplebut__theyare__responsiblefor__makingand__returningan__objectfor__thenew__class. Finally,metaclasses__constitutea__secondarypathway__forinheritance__searchused__forclasses__alone;this__allowsclasses__toape__normalinstance__behavior,though__itbifurcates__theclass__storyfor__relativelyrare__andnarrow__roles. 2.Use__akeyword__argumentin__theclass__header line:class__C(metaclass=M).The__classheader__linecan__alsoname__normalsuperclasses__beforethe__metaclasskeyword__argument;these__superclassesare__searchedbefore__metaclassesfor__inheritancerun__froma__class. 3.Because__bothare__automaticallytriggered__atthe__endof__aclass__statement,class__decoratorsand__metaclassescan__bothbe__usedto__manage classes.Decorators__rebinda__classname__toa__callables__result,and__metaclassesroute__classcreation__througha__callable,but__bothhooks__canbe__usedfor__similar purposes.To__manage classes,decorators__simplyaugment__andreturn__theoriginal__class objects.Metaclasses__augmenta__classafter__orbefore__theycreate__it.As__noted,metaclasses__canalso__providebehavior__fortheir__instanceclasses__inthe__formof__methodsthat__arenot__immediatelysupported__by decorators,though__theobjects__returnedby__decoratorscan__doanything__supportedby__thePython__language.Chapter__41.All__GoodThings__Welcometo__theend__ofthe__book!Now__thatyou__vemade__itthis__far,this__chaptersays__afew__wordsin__closingabout__Pythons__evolutionbefore__turningyou__looseon__thesoftware__fieldand__thenwraps__upwith__abit__of fun.You__venow__hada__chanceto__seethe__entirePython__languageyourself__includingsome__advancedfeatures__thatmay__seemat__oddswith__ascripting__languagemeant__tobe__accessibleto__nonprofessionals.Though__manyusers__willunderstandably__acceptthis__asstatus__quo,in__anopen__source project,it__scrucial__thatsome__askthe__whyquestions__too. Ultimately,the__trajectoryof__thePython__storyand__itstrue__conclusionis__atleast__inpart__upto__you.Toward__that end,this__chapterbegins__bycalling__outwhat__maybe__oneof__Pythons__biggest downsides:its__rateof__change.This__topicis__unavoidably subjective,and__youshould__weighits__coveragehere__onwhatever__scaleyou__bringto__the table.The__PythonTsunami__Twelveyears__ago,this__bookwarned__thatPython__wasgrowing__tooconvoluted__andbloated__andthen__Pythongrew__alot__moreconvoluted__and bloated. Clearly,this__messagehas__notreached__thosebehind__theconvoluting__and bloating.Even__so,this__stuffstill__matters.To__parrotthe__Preface,the__lastdozen__yearshave__hostedthe__riseof__f-string literals, named-assignment expressions,match__statements,type__hinting,async__coroutines,dictionary__union, star-unpacking proliferation,underscore__digit separators,module__attribute hooks,exception__groups, dictionary-keyinsertion__order, positional-onlyfunction__arguments, hash-based__bytecode files,the__sys.executable snub,and__othersuperfluous__additions,opinionated__deprecations,and__tangledmutations__weve__metalong__the way. Moreover,this__tsunamiof__modssimply__addedto__theflood__ofcomplexity__andredundancy__thatcame__beforeit__includingthe__oddlyartificial__MRO,the__stunninglyimplicit__super,and__thehorrifically__convolutedinheritance__algorithmof__thepreceding__chapter,which__elevatesmetaclasses__anddescriptors__to prerequisites.The__sumof__theseis__anesoteric__morass,which__obfuscatesthe__fundamentalmeaning__ofnames__in Python.Most__ofwhat__shouldbe__saidabout__thesechanges__alreadyhas__beensaid__inthis__book,but__theircombined__weightqualifies__asproblematic__fora__toolthat__promotesitself__assimpler__than others.To__illustrate,Table__41-1updates__theprior__editions__accountingof__Pythons__largelyunchecked__growthso__fara__partialbut__representative tally.Table__41-1.A__samplingof__redundancyand__toolexplosion__inPython__CategoryMembers__3major__paradigms Procedural, functional, object-oriented 4 string-formattingtools__% expression, str.format, string.Template, f-strings 4 attribute-accessortools__properties, descriptors, __getattr__,__getattribute____2finalization__statements try/finally,with__pluscontext__managers 4varieties__ofcomprehension__List, set, dictionary,generator__3 class-augmentationoptions__Manual rebinding, @ decorators,metaclasses__4kinds__ofmethods__Instance, static, class,metaclass__2 attribute-storagesystems____dict__,__slots____4flavors__ofimports__Module, package,package__relative,namespace__package 2 superclass-referencetools__Explicitclass__names,super__plusMRO__6assignment__forms Basic, sequence, multitarget, += augmented, * unpacking, :=named__3types__offunctions__Basic,yield__generator,async__coroutine 6 function-argumentforms__Basic, name=X, *X, **X, keyword-only, positional-only 2 class-behaviorsources__Superclasses,metaclasses__3 multiple-choicetools__if/elif,dictionary__indexing,match__4 state-retentionoptions__Classes, closures,function__attributes,mutables__2bytecode__storageschemes__timestamp,hashkey__3 name-stringimporters__exec, __import__,importlib__2kinds__ofdecorators__Function,class__4 dictionary-mergeoptions__for loops,update__method, *D unpacking, |union__operator 2 exception-handlermodels__except singles, except*groups__4 statement-apingexpressions__if/else, comprehensions,lambda__functions, :=assignment__8starred__collectors/unpackers Assignment;function__header, call; list, tuple, dict,set__literal;match__Ifyou__careabout__Python,you__shouldtake__amoment__tobrowse__this table.It__reflectsa__virtualexplosion__of bifurcation, redundancy,and__toolboxsize__and 81concepts__thatcan__allbe__requiredreading__forboth__newcomerslearning__thelanguage__andexperts__reusingcode__writtenby__others.Most__ofits__categoriesbegan__withjust__oneoriginal__memberin__Python;many__wereadded__inpart__toimitate__other languages;and__nonecan__besimplified__todayby__pretendingthat__thelatest__Pythonis__theonly__Pythonthat__matters.Python__3.Xnow__ownsthe__fluxin__full. F-stringsare__aprime__examplein__this category.This__books__prioredition__lamentedthe__threeredundant__string-formattingtools__ofits__time,but__thisset__wassubsequently__expandedto__acolossal__four.While__f-stringsmay__bedeemed__arefinement__by some,in__truththey__area__minorvariation__ona__themethat__addsyet__anothertopic__tothe__heap.More__fundamentally,millions__ofprogrammers__havewritten__millionsof__programsusing__longer-lived options;while__newcode__hasthe__luxuryof__usingnew__tools,pretending__thatthe__pastdidn__thappen__constitutesa__breakwith__reality.Even__extensionsperhaps__moreunique__oftencome__loadedwith__surplus complexity.The__match statement,for__example,couldn__tsimply__providea__potentiallyuseful__multiple-choice option.It__hadto__bolton__theconceptually__tortuousand__syntacticallyad__hocstructural__pattern matching,which__seemsan__answerto__aquestion__thatnobody__asked.Nor__areadditions__theonly__user-unfriendlytheme__in Python.Its__subjectivechanges__anddeprecations__arenow__socommon__thatthey__mustbe__expectedas__animplicit__costof__usingthe__language.To__be clear,your__Pythoncode__willalmost__certainlybreak__eventuallywhen__youupgrade__toa__newPython__releaseand__onlybecause__aPython__coredeveloper__swhim__wasmade__mandatoryfor__everyone else.The__PythonSandbox__Allof__thisstems__fromthe__factthat__Python is,and__probablyalways__has been,a__constantlymorphing__sandboxof__ideas,which__prioritizesits__developersegos__overits__users needs.Playing__ina__sandboxcan__be fun,of__course,but__its__lousyfor__themillions__ofpeople__downstreamfrom__its churn.These__peopleare__simplytrying__towrite__softwarethat__sreliable__and durable.Like__allengineering__endeavors,that__worksbest__witha__stable base,not__constantlyshifting__sand.As__apathological__example,Python__ssandbox__modelseems__tohave__hitits__zenithin__typehinting__the optional, unused, out-of-place,and__embarrassinglyacademic__subdomainwe__glancedin__Chapter 6but__largelyomitted__hereby__design.This__isunchecked__convolutionon__parade,and__leavesPython__usersto__puzzleover__theparadox__ofpointless__typedeclarations__ina__dynamicallytyped__language. Sadly,it__salso__likelyto__appealto__control freaks.As__weve__alsoseen__regularlyin__this book,because__thesandbox__isoriented__toward experts,it__inevitablyproduces__toolsthat__assumethat__youhave__toalready__bean__expertto__use them.Classes__and OOP,for__example,are__requiredskills__foreven__simpleexception__handling.Python__isnot__justfor__its developers,but__theforward__knowledgeassumptions__ofmany__ofits__additionsembed__thismessage__andraise__thebar__fornewcomers__unnecessarilyand__unkindly.To__be fair,it__snot__just Python:the__entiresoftware__fieldis__permeatedby__aculture__ofchange__inwhich__churnis__anexpected__constant,and__prowessoften__consistsof__flauntingthe__latestand__greatesttools__evenwhen__theyare__unwarranted.This__doesnt__proveintelligence__(andoften__demosits__absence),but__annualand__mandatorymods__arenow__a norm.Whether__onebreaks__your PC, smartphone,or__Python code,it__sdifficult__notto__seethis__asdivisive__and rude.The__PythonUpside__Allthat__being said,it__salso__difficultto__denythat__Python,despite__its warts,is__stillmore__productiveand__pleasantto__usethan__otherprogramming__languages.If__youve__codedother__languages,you__knowthat__manycome__ladenwith__extraneoussyntax__and rules,which__seemto__reflectan__assumptionthat__programmerscannot__betrusted__todo__their jobs.By__sharp contrast,Python__sdynamic__typingand__innateflexibility__makeit__moreally__than obstacle.Python__srise__inpopularity__seemsto__attestto__thisvalue__proposition,though__its__impetusmay__bemore__practicalthan__academic.Today__slarger__Pythonworld__maynaturally__beless__concernedwith__thelanguage__soriginal__andperhaps__idealisticgoals__thanwith__solvingconcrete__problems.In__thereal__worldthat__hostsPython__popularity,arcane__languagetopics__usuallytake__aback__seatto__libraries, platforms,and__schedulescalls__thatPython__hasalways__answeredin__full. Moreover,some__changeand__complexityis__warrantedin__software.Programming__isa__substantiallychallenging__task (despitewhat__youmay__have heard),and__computerscience__isa__fieldstill__youngenough__tobe__excusedfor__someyouthful__thrashing.For__Python specifically, though,complexity__andthrashing__shouldbe__modulatedby__broad appeal.In__the end,the__Pythonlanguage__remainsa__remarkablyexpressive__toolthat__stillfits__bothprogramming__tasksand__yourbrain__aswell__asit__ever did.Especially__ifyou__stickto__its tried-and-trueparts__thatpropelled__Pythonto__thetop__ofthe__language charts,you__lllikely__findit__anenabling__technologythat__makescoding__asmuch__funas__chore.Prudent__engineers, though,would__dowell__toexercise__cautionwhen__upgradingto__theleading__edge,and__givea__passto__thesandbox__sannual__outflowexcept__whenclearly__beneficial.Given__thatthis__isnow__an industry-wide requirement,it__shardly__causeto__dismissan__otherwiseuseful__tool.Bad__practice, however,does__notjustify__bad practice.Closing__ThoughtsSo__thereyou__have it:some__observationsfrom__the trenches,born__ofthree__decades using, teaching,and__advocating Python,and__groundedin__adesire__toimprove__thePython__story.None__ofthese__concernsare__entirely new. Indeed,the__growthof__thisvery__bookover__theyears__seemsa__testamentto__thatof__Pythonitself__ifnot__anironic__eulogyto__amission__statementthat__oncestressed__simplificationof__programming,and__accessibilityto__bothexperts__andnonprofessionals__alike.Judging__bylanguage__heft alone,that__dreamseems__tohave__beeneither__neglectedover__timeor__abandoned entirely.But__wecan__do better.A__well-establishedtool__likePython__canafford__tofocus__moreon__itsusers__needsthan__itschangers__hubris.Per__theold__adage,we__simplyhave__tostop__fixingwhat__isnt__broken.If__we can,it__willgo__fartoward__addressingthe__concernsof__thosevetting__thelanguage__forprojects__thatcannot__affordto__budgetfor__shifting sands.More__importantly,in__anopen__sourceproject__likePython__theanswers__tosuch__questionsmust__beformed__anewby__eachwave__of newcomers. Hopefully,the__waveyou__ridein__willhave__asmuch__commonsense__asfun__whileplotting__Pythons__future.Where__toGo__fromHere__Andthat__sa__wrap, folks.You__veofficially__reachedthe__endof__this book.Now__thatyou__knowPython__insideand__out,your__next step,should__youchoose__totake__it,is__toexplore__the libraries, techniques,and__toolsavailable__inthe__applicationdomains__inwhich__youwill__work.Because__Pythonis__sowidely__used,you__llfind__ampleresources__forusing__itin__almostany__domainyou__canthink__offrom__GUIs,the__web,and__apps,to__numeric programming, databases,and__system administration.See__Chapter 1and__yourfavorite__webbrowser__forpointers__topopular__toolsand__topics.This__iswhere__Pythonstarts__tobecome__truly fun,but__thisis__alsowhere__thisbook__sstory__ends,and__thoseof__otherresources__begin.Good__luckwith__your journey.And__as always:code__well! Encore:Print__YourOwn__Completion Certificate!And__onelast__thing:in__lieuof__exercisesfor__thispart__ofthe__book,Example__41-1lists__abonus__scriptfor__youto__studyand__runon__your own.A__bookcan__tdirectly__providecompletion__certificatesfor__itsreaders__(andthe__certificateswould__beworthless__ifit__could),but__itcan__includean__arguablycheesy__Pythonscript__that does.This__onecreates__asimple__bookcompletion__certificatein__both plain-textand__HTML files,and__auto-opensthem__ina__webbrowser__orother__viewerwhere__supported.Example__41-1. You-made-it.py """Generate__asimple__classcompletion__certificate:printed__tothe__console,and__savedin__auto-openedtext__andHTML__files.Run__froma__console,and__printsaved__outputfiles__if desired.Works__onall__PCs,but__mayrequire__manualopens__on smartphones. """import__time, sys, html,os__maxline = 60 #Text__separatorlines__browser =True__#Display__ina__browser?saveto__= 'Certificate' #Output__filenamesprefix__#Template__valuesSEPT__= '*' *maxline__DATE = time.strftime('%A, %b %d, %Y, %I:%M %p')NAME__= input('Pleaseenter__your name: ').strip()or__'Anunknown__reader'BOOK__= 'Learning Python, 6th Edition'SITE__= 'https://learning-python.com' #For__icon, image,link__# F-stringtemplates__workfor__preset in-codereferences__texttext = f""" {SEPT}Official__Certificate Date: {DATE}This__certifies that: \t{NAME}Has__survivedthe__massive tome: \t{BOOK}And__isnow__entitledto__allprivileges__thereof,including__theright__toproceed__onto__learninghow__todevelop__websites,desktop__GUIs,scientific__models,smartphone__apps,and__anythingelse__thatthe__futureof__computingmay__hold. --Yourhumble__instructor (Note:void__whereobtained__byskipping__ahead.) {SEPT} """ # Interact,setup__forc__in 'Congratulations!'.upper() + ' ' * 3: print(c, end=' ') sys.stdout.flush() #Else__someshells__waitfor__\n time.sleep(0.25) #Reveal__messageslowly__forfun__print(); time.sleep(3) #Make__text-fileversion__textto =saveto__+ '.txt'fileto__= open(textto, 'w', encoding='utf8') print(texttext, file=fileto) fileto.close() #Start__HTML:replace__textmarkers__withtags__htmltext = texttext.replace(SEPT, '', 1)htmltext__= htmltext.replace(SEPT, '')htmltext__= htmltext.replace(' ', ' ', 1)htmltext__= htmltext.replace(' ', ' ') # Line-by-linemods__linemods = []for__linein__htmltext.split('\n'):if__line == '':line__= ''elif__line[:1] == '\t':line__= f"{' ' * 4}{html.escape(line[1:])}" # 3.6+ linemods.append(line)htmltext__= '\n'.join(linemods) #Ignorable__HTMLbits__(mindthe__{{and__}} escapes)preamble__= f''' LP6ECompletion__Certificate ''' image,page__= 'lp6e-large.jpg', 'about-lp.html'footer__= f'''Book__supportsite__''' #Put__itall__togetherhtmltext__= f'{preamble}{htmltext}{footer}' #Make__HTML-fileversion__htmlto =saveto__+ '.html'fileto__= open(htmlto, 'w', encoding='utf8') print(htmltext, file=fileto) fileto.close() #Display__textresults__inconsole__print(f'[File: {textto}]', end='') print('\n' * 2, open(textto, encoding='utf8').read()) #Open__docs (mayalso__fail silently)if__browser: try:import__webbrowserfor__docin__(textto, htmlto): webbrowser.open('file://' + os.path.abspath(doc))except__Exception: print('Unableto__auto-open docs:open__manually.') input('[PressEnter__to close]') #Keep__windowopen__ifclicked__Runthis__scriptin__aconsole__orother__interfaceon__your own,and__studyits__codefor__areview__ofsome__ofthe__ideaswe__vecovered__inthis__book. Copy/pastefrom__emediaor__fetchit__fromthis__books__examplespackage__asdescribed__inthe__Preface,but__ignoreits__undocumentedand__out-of-scopeHTML__bitsif__youre__nota__web developer.You__wont__findany__descriptors, decorators, metaclasses,or__supercalls__inthis__code,but__its__typicalPython__nonetheless: $ python3 You-made-it.pyPlease__enteryour__name:Some__BodyCONGRATULATIONS__!etc__Thisscript__worksin__fullon__PCs (wherecode__mightalso__openfiles__with os.startfile,or__openor__xdg-opencommands__in os.system),but__onsmartphones__youll__probablyneed__toopen__theoutput__filesmanually__in file-explorer__apps.When__run,it__generatesthe__webpage__capturedin__thefully__gratuitousFigure__41-1.This__couldbe__muchmore__grandiose,of__course;see__theweb__forpointers__toPython__supportfor__PDFsand__otherdocument__toolssuch__asSphinx__surveyedin__Chapter 15.But__heyif__youve__madeit__tothe__endof__this book,you__deserveanother__jokeor__two.Figure__41-1.HTML__doccreated__andopened__by You-made-it.pyPart__IX.Appendixes__Appendix A.Platform__UsageTips__Oneof__Pythons__mainstrengths__isits__portability:most__ofthe__codeyou__llwrite__inyour__Pythonprograms__willwork__thesame__onall__computing platforms.This__has limits,of__course;programs__thatuse__Pythons__portablelibraries__weatherdevice__hopsbetter__than others,and__platformidiosyncrasies__andrestrictions__cansometimes__poseinteroperability__hurdlesthat__requirespecial__handling.But__byand__large,the__Pythonlanguage__is cross-platformby__design.Python__sportability__meansyou__canrun__itscode__onjust__aboutevery__computingdevice__onthe__planetfrom__smartphonesand__tabletsto__PCsand__supercomputersand__eachof__thesesystems__hasunique__setupand__usage details.While__thisappendix__cannotbe__anexhaustive__userguide__forevery__oneof__those devices,it__providesjust__enoughinfo__tohelp__youprepare__torun__thisbook__scode__exampleson__yourpopular__platformor__platformsof__choice,including__Windows, macOS, Linux, Android,and__iOS.Before__weget__started,here__aretwo__quickcontent__notesup__front. First,because__youre__goingto__haveenough__onyour__platejust__learningPython__itself,the__focusthroughout__thisappendix__ison__keepingit__simple.There__aremany__waysto__run code,and__youmay__findadvanced__optionsuseful__onceyou__graduatefrom__Pythonnovice__to master.Especially__whenstarting__out, though,this__bookrecommends__walkingthe__easiest path. Second,a__usageappendix__likethis__isunavoidably__doomedto__growout__ofdate__soon,given__therapid__andconstant__changein__thecomputing__world (eventhe__nameof__macOS,after__all,has__changedrepeatedly__onthis__books__watch!). Hence,please__considerthis__asnapshot__ofthe__currentstate__and practice,and__planto__consultthe__latestresources__ifwhen__thisstory__changes.For__the present,let__sjump__rightinto__todays__usageoptions__whilethey__last.Using__Pythonon__WindowsAs__thecurrent__market-shareleader__for PCs,Windows__willundoubtedly__playhost__tomany__readersfirst__encounterwith__Python.Python__hasbeen__completelyusable__onthis__platformsince__itsearliest__days,and__goesout__ofits__wayto__smoothWindows__proprietaryedges__soyour__codedoesn__thave__to.A__well-codedPython__programfrom__Unix,for__example,often__runsunchanged__onWindows__despitethe__twoplatforms__manyglaring__differences. Today,there__areat__leastthree__differentways__touse__Pythonon__Windows:in__Windows itself,in__WindowsSubsystem__forLinux__(a.k.a.WSL__and WSL2),and__inthe__third-partyCygwin__Unix-like environment.We__wont__coverCygwin__herebecause__its__notas__widely used,and__thosewho__maycare__touse__itprobably__alreadyknow__howto__use it.WSL__includingits__newer WSL2variant__bringsLinux__toyour__WindowsPC__withoutthe__hasslesof__dual-bootinstalls__orseparate__devices.You__geta__standardLinux__distribution (e.g., Ubuntu)that__runsin__theWindows__UIand__avoidssome__ofthe__trade-offsof__classicvirtual__machines.WSL__comeswith__acommand__lineto__editand__runPython__code,and__WSL2even__runsLinux__GUIapps__(thoughthey__restill__marginalat__this writing).Because__WSLis__really Linux,we__lldefer__tothe__Linuxsection__aheadfor__Pythonsetup__andusage__info,as__wellas__Microsofts__onlinedocumentation__fordetails__oninstalling__WSL itself.While__WSLmay__piquesome__readers interest,it__requiresextra__setupsteps__andis__notwholly__withoutseams__today.For__most readers,the__easiestway__touse__Pythonon__Windowsis__togo__nativewith__aPython__builtto__runin__Windows directly.Python__doesnt__comewith__Windows,but__itis__easyto__installand__use there.In__short,Python__forWindows__canbe__installedby__downloadinga__self-installeror__visitingthe__Microsoft Store,and__canbe__runwith__asimple__Windows command-line__interface;a__graphicalIDE__aGUI__forediting__andlaunching__code;and__clickson__program-fileentries__inWindows__File Explorer.In__more detail,the__recommendedway__toinstall__Pythonfor__Windowsbegins__witha__visitto__theDownloads__pageat__python.org. There,you__llfetch__aWindows__self-installer__thatyou__llrun__toinstall__Python 3.X,along__withits__IDLEGUI__andstandard__library (includingthe__librarys__tkinterGUI__toolkit).Figure__A-1captures__thePython__installerin__action;allow__itto__runif__Windowsasks__for permission.You__cangenerally__acceptall__installation defaults,but__its__recommendedto__optin__toboth__addingPython__toyour__PATHat__thestart__ofthe__installand__liftingthe__Windows path-lengthlimits__forfilenames__atthe__end.NOTE__Installation convolution:Though__less common,you__canalso__installPython__fromthe__Microsoft Store.In__fact,typing__python3in__aWindows__commandline__atthis__writingautomatically__routesyou__tothe__storeto__runthe__install confusingly!If__youopt__toaccept__this offer, python3will__runthe__stores__versionafter__the install,and__theStart__menuwill__sproutseparate__entriesfor__launchingthis__Pythonand__itsIDLE__(up shortly).This__guideuses__andgenerally__recommendsthe__python.orginstall__(andits__py helper)because__its__moretraditional__andmay__bebetter__suitedto__general use.That__said,the__storeversion__ultimatelycomes__fromthe__same source,and__eithermay__beused__forthis__books__exampleson__Windows.But__beware:the__storeversion__imposesaccess__restrictionsthat__maymatter__toyou__laterand__shouldprobably__relegateit__toa__secondaryoption__formost__readers.You__reallyshouldn__tinstall__boththe__storeand__nonstoreWindows__Pythons, though,unless__youneed__moredrama__inyour__life!Figure__A-1.The__python.orginstaller__onWindows__Onceyou__veinstalled__Pythonon__Windows,running__itthere__canbe__assimple__astyping__codeat__acommand__lineand__clickingfile__iconsor__ascomplex__aslearning__thenuances__ofa__full-featured IDE.Of__these,command__linesgenerally__addthe__leastnumber__ofmoving__parts.To__runPython__froma__commandline__on Windows,open__eitherCommand__Promptor__PowerShell (the non-ISE flavor, normally).Once__open,simply__typepy__orother__optionspresented__ina__momentand__adda__filenameto__runa__fileof__code (i.e.,a__script).For__example,open__CommandPrompt__fromyour__Startmenu__(searchfor__itthere__if needed). Then,type__pyand__pressEnter__tostart__aPython__interactivesession__whereyou__cantype__andrun__codeat__the >>> prompt.To__launcha__script instead,type__py script.py,with__thename__ofyour__script.Figure__A-2demos__thesecommands__liveon__Windows.For__space,some__demosin__this appendix,including__this one,use__Pythons__-qflag__tosuppress__messageson__session startup;this__iscosmetic__and optional.Figure__A-2.Running__Pythonby__commandlines__onWindows__Thepy__commandis__technicallypart__ofthe__PythonWindows__launcherthat__sinstalled__alongwith__Python itself.By__default,the__launcherruns__themost__recentPython__versioninstalled__onyour__PC,but__youcan__alsospecify__aversion__torun__ifthere__smore__thanone__(e.g.,py__-3runs__thelatest__3.X,and__py -3.8runs__anolder__versionof__it).If__youhave__justone__Pythonor__wantto__usethe__latest,py__sufficesto__launchan__interactivesession__or script.You__canalso__startPython__withcommand__pythonif__youopted__toadd__Pythonto__yoursystem__PATHduring__the install,though__its__pointlessextra__typing (python3works__too,but__onlyif__youinstalled__fromthe__Storeper__theearlier__note).And__justas__on Unix,you__caneasily__savea__scripts__printedoutput__toa__fileby__adding > filename.txtto__theend__ofa__command (seeChapter__3for__moreon__suchstream__redirections). However,if__youopt__togo__the command-line route,you__llalso__needto__choosea__texteditor__tocreate__filesof__codeyou__wishto__save (i.e.,scripts__torun__andmodules__to import).As__demoedin__Figure A-2,Windows__Notepad suffices,but__anyWindows__texteditor__willfit__the bill.To__use Notepad,launch__itfrom__yourStart__menu (searchthere__if needed)or__bytyping__itsname__ina__command line,with__orwithout__afilename__to edit.Besides__command lines,you__canalso__startPython__sinteractive__sessionby__clickingthe__Python 3.12 (64-bit) (or similar)item__inits__Start-menu entry,shown__inFigure__A-3.This__startsthe__usualPython__REPL (Read-Eval-Print Loop)interactive__sessionwith__its >>> prompt,just__likean__explicitpy__commandin__CommandPrompt__or PowerShell.You__llstill__usepy__commandsor__other techniques, though,to__runcode__files.In__allconsole__REPLson__Windows,type__ortap__the two-keycombo__Ctrl+Z (followedby__Enter)at__the >>>prompt__toexit__aPython__interactivesession__orsimply__closethe__hosting window.Figure__A-3.Python__Start-menuoptions__onWindows__Ifcommand__linesmake__youbreak__outin__hives,you__canalso__runPython__fromgraphical__IDEslike__PyCharmor__Pythons__own IDLE.Of__these,IDLE__isincluded__withPython__forWindows__andprovides__asimple__butsufficient__IDEfor__runningthis__books__examples.Its__utilitypartly__overlapswith__commandlines__(its__ultimatelyjust__aplace__totype__andrun__code),but__italso__includesa__Python-friendly__texteditor__forcode__filesand__simplifiessome__commoncoding__chores. Notably,it__sable__tolaunch__programfiles__withoutcommand__lines.As__examples,Figures__A-4and__A-5capture__IDLEs__interactiveShell__andeditor__windows, respectively,with__default configurations.You__canstart__IDLEfrom__Pythons__entryin__yourStart__menuon__Windows (trya__searchfor__idlethere__tolocate__andopen__IDLE quickly).The__commandpy__-m idlelib.idlealso__starts IDLE,for__reasonscovered__elsewherein__thisbook__(tl;dr:this__islike__amodule__import,but__runsinstead__of importing),and__right-clickson__codefiles__inFile__Explorercan__openIDLE__too,but__requireregistry__edits today.IDLE__sown__Helpmenu__comeswith__ampleusage__infothat__well__deferto__here,but__onetip__isworth__a callout:a__menuRun__RunModule__(orits__equivalent F5shortcut__key)in__anyeditor__windowlike__thatin__Figure A-5lets__youlaunch__ascript__withouttyping__acommand__line.This__runsthe__codein__thatwindow__afterit__sbeen__savedto__afile__ifneeded__androutes__thecode__sprinted__outputback__tothe__Shell window.Its__RunCustomized__versionalso__letsyou__provide command-linearguments__(see sys.argvin__Pythons__manualsfor__details).Useful__tricksto__be sure,but__evenif__youdon__tuse__IDLEto__runcode__this way,it__hasadditional__toolswe__llskip__herefor__space,and__itscode__editoralone__makesfor__acompelling__alternativeto__Notepadif__youhave__noother__optionin__mindfor__scriptsand__modules.Figure__A-4.The__IDLEGUI__sShell__windowon__WindowsFigure__A-5.An__IDLEGUI__editorwindow__onWindows__Beyond py, python, python3, Start,and__IDLE (whichalready__qualifiesas__aWindows__embarrassmentof__riches!),a__Pythonprogram__filecan__alsobe__launchedon__Windowsby__typingjust__itsname__ina__commandline__(e.g., hack.py),and__bylocating__andclicking__itsname__oricon__inWindows__File Explorer.These__bothwork__thanksto__themagic__offilename__associationsin__Windows,which__Pythonsets__upautomatically__duringits__install:any__filewhose__nameends__in .pyis__routedto__thepy__launcherwhen__namedor__clicked. Clicking, however,comes__witha__drawback:printed__outputof__programsyou__launchthis__wayis__loston__program exit,because__theprogram__srun__windowis__closed.To__keepthe__window (andhence__output) open,simply__adda__callto__Pythons__input()at__thebottom__ofyour__scriptto__pausefor__auser__Enter-key press.As__inFigure__A-5,this__callcan__beconditional__onthe__platformto__pauseselectively__(somecode__maywarrant__standard-streamTTY__tests too).The__input()trick__wont__helpif__theprogram__commitsan__error (alas,the__errormessages__mayperish__withthe__windowbefore__thepause__isever__reached!),so__runningby__clicksis__usuallybest__usedonly__forgraphical__programsand__othersthat__logtheir__errorsto__files.Tip__for GUIs:a__.pyopens__aconsole__forstandard__streamIO__when clicked,but__a .pywdoes__not.Before__wemove__on,here__aresome__advancedbut__usefultips__forPython__on Windows:Script__#!lines__Thepy__Windowslauncher__treatsthe__firstline__ina__scripts__fileas__specialif__itbegins__with #!.This__linecan__namethe__versionand__locationof__thePython__tobe__usedto__runthe__files__code (e.g., #!python3.12),and__allthe__usual Unix-style__lineswork__(e.g., #!/usr/bin/python3.12).This__lineis__entirelyoptional__andno__differentthan__naminga__Pythonin__thecommand__lineused__tolaunch__itwith__py (e.g.,py__-3.12 hack.py)but__maybe__usefulwhen__thereare__multiplePythons__installedon__your PC,especially__whenscripts__arerun__withclicks__insteadof__command lines.Environment__variablesWindows__command-lineinterfaces__usethe__PATH (a.k.a. Path)environment__variableto__locatenamed__programslike__python:every__folderon__thislist__is searched.This__isnormally__setup__forPython__automaticallyduring__itsinstall__ifyou__opt in,but__youcan__tweakit__lateryourself__inSettings__(searchfor__environmentvariable__there).In__thesame__way,you__mayalso__createor__mod PYTHONPATH,used__tolocate__importedmodules__(perChapter__22),as__wellas__PYTHONUTF8and__PYTHONIOENCODING,used__onWindows__tospecify__thedefault__Unicodeencoding__offiles__andredirected__streams (thisconvoluted__storyhas__changedin__3.Xoften__andwill__again;see__Chapter 37).Other__Windowsoptions__MostPython__codeworks__thesame__onWindows__ason__other platforms,especially__ifit__usesPython__sportable__systemtools__inmodules__like os.In__caseswhere__Windows-specifictools__are required, though,the__pywin32 third-party__extensionallows__yourPython__programsto__accessmany__WindowsAPIs__directly.For__moreabout__usingPython__on Windows,try__python.orgs__HOWTOas__wellas__thecopious__resourceson__theweb__(withthe__usualcaution__aboutvetting__theircopious__sources). Here,let__smove__onto__thenext__PCplatform__onour__tour.Using__Pythonon__macOSAs__a Unix-based platform,macOS__iswell__suitedto__Python,open__source,and__softwaredevelopment__in general.At__this writing,newer__macOSPCs__nolonger__comewith__aPython__preinstalled (andif__itseems__they do,it__sjust__astub__forinstalling__unrelated toolsets,per__thenote__ahead).Older__macOSsystems__dohave__a Python,but__its__the now-dated 2.X,and__mayissue__adeprecation__warningwhen__launched (inother__words,you__cant__useit__torun__thisbook__s code,and__its__notlong__forthe__macOS world). Hence,an__installis__required.As__for Windows,the__recommendedway__toinstall__Python 3.Xfor__macOSbegins__witha__visitto__theDownloads__pageat__python.org. There,you__llfetch__a self-installer__formacOS__thatyou__llrun__toinstall__Python,along__withits__IDLEGUI__andstandard__library (includingthe__librarys__tkinterGUI__toolkit).The__Pythonyou__llget__todayis__aUniversal__2binary__thatruns__nativelyon__macOSPCs__usingboth__newerApple__Silicon (ARM)and__olderIntel__(x86) chips,and__canbe__runin__theRosetta__2emulator__(seethe__webfor__moreon__allsuch__terms).Figure__A-6captures__theinstall__processon__macOS.NOTE__Installation convolution:If__youtype__python3in__macOSs__Terminalbefore__runningthe__python.org install,you__mayget__anApple__popupthat__asksif__youwant__toinstall__Pythonas__partof__Xcodes__commandline__developer tools.This__issimilar__inspirit__tothe__MicrosoftStore__redirecton__Windowsof__thepreceding__sectionand__similarly confusing!On__macOS, though,most__usersshould__ignorethe__offerand__insteadinstall__Pythonfrom__python.orgas__describedhere__becauseit__makesyour__Pythonindependent__ofthe__versionand__configurationchoices__madeby__atools__package.This__isalso__trueif__youalready__haveXcode__andits__Python:install__anew__Pythonfrom__python.orgfor__generallybetter__control.Figure__A-6.The__python.orginstaller__onmacOS__Afterthe__install,you__canstart__Pythonboth__withits__entriesin__Launchpad,which__mostlymirrors__yourPC__sApplications__folderin__Finder,as__wellas__commandlines__in Terminal,which__providesa__standardUnix__command-line shell.Of__these,Terminal__maybe__themost__basicway__toget__startedwith__thisbook__sexamples__on macOS.To__runcode__bycommand__lineon__macOS,open__Terminalby__clickingits__entryin__eitherLaunchpad__sOther__folder,or__ApplicationsUtilities__in Finder. Then,type__python3to__starta__Pythoninteractive__sessionwhere__youcan__typeand__run code,or__python3 script.pyto__launcha__code file.This__worksbecause__python3is__addedto__yoursystem__PATHby__theinstall__(andas__a caution,python__maymean__Python 2.Xon__older PCs).Figure__A-7demos__Pythoncommands__liveon__macOS.As__usualon__Unix-based systems,type__keyscombo__Control+Dat__the >>>prompt__toexit__aPython__interactivesession__here (yes,this__differsfrom__Windows),and__alias python3to__somethingshorter__inyour__shells__startupfiles__ifseven__charactersis__toomuch__(e.g.,alias__to py,if__youwant__toavoid__somedisorientation__whenhopping__toand__from Windows).Figure__A-7.Running__Pythonin__macOSTerminal__Whenusing__commandlines__torun__code,you__llalso__usea__texteditor__tocreate__filesof__Pythoncode__(scriptsand__modules)on__macOS.Its__built-inTextEdit__sufficesbut__isnt__very code-friendlyout__ofthe__box (e.g.,you__llwant__toset__amonospace__fontright__away).Any__macOStext__editoris__upto__thetask__ofediting__Python code,including__IDLE (up next),the__viand__nano command-line-basededitors__familiarto__Unix users,and__otheroptions__youcan__exploreon__the web.After__theinstall__on macOS,you__llalso__findtwo__toolsfor__runningPython__codein__other modes,available__inboth__Launchpadand__yourApplications__folderin__Finder.As__capturedin__bothFigures__A-8and__A-9,the__PythonLauncher__allowsyou__torun__afile__ofPython__codewith__eithera__clickin__Finderor__adrag__toits__iconor__name,and__IDLEprovides__abasic__edit-and-runIDE__GUIfor__Python code. (Python itself,invoked__bya__python3 command,shows__upin__/Library/Frameworks,though__youdon__tnormally__needto__care.)Figure__A-8.Python__sIDLE__andlauncher__inmacOS__LaunchpadFigure__A-9.Python__sApplications__folderin__macOSFinder__Figure A-10shows__IDLEon__macOS.Launch__itmost__easilywith__itsLaunchpad__orFinder__entriesor__by right-clicking (a.k.a. control-clicking)any__Pythoncode__filein__Finderand__choosingIDLE__inOpen__With (youcan__makethis__associationpermanent__thereif__desired,and__globalin__Finders__Get Info).Because__IDLEis__codedin__Pythonas__atkinter__GUI,it__looksand__worksthe__sameon__allsupported__platforms (essentially,all__PCssans__mobile heroics).As__elsewhere,it__allowsyou__toedit__andrun__filesof__Pythoncode__withouthaving__touse__commandlines__orother__editors.See__IDLEs__earlierWindows__coveragefor__more tips;as__noted there,IDLE__canserve__asa__Python-friendlycode__editor,even__ifyou__runfiles__bycommand__lines, clicks,or__drags.Figure__A-10.The__IDLEGUI__sShell__windowon__macOSTo__wrap up,here__area__handfulof__advancedusage__tips,with__macOSspins__thatalso__applyto__otherUnix__platformslike__Linuxand__Androidcoming__up next:Script__#!lines__Ifthe__firstline__ofa__scriptbegins__with #!,it__streated__asspecial__on macOS,just__asit__ison__Windows.On__macOS,this__isa__functionof__theshell__(e.g.,Bash__or Zsh)that__srunning__yourcommand__lines,not__Python.For__instance,a__top- of-scriptline__#!/usr/bin/python3.12tells__theshell__whichPython__shouldrun__therest__ofthe__files__lines.This__isnt__differentthan__namingyour__Pythonin__acommand__lineexplicitly__(e.g., /usr/bin/python3.12 hack.py),but__a #!line__allowsa__scriptto__berun__byjust__itsname__(e.g., hack.py)if__its__alsomade__executable (see chmod).Running__byclicks__Pythoncode__filesrun__witha__clickin__Finder,but__youmay__haveto__choosethe__PythonLauncher__inOpen__Withand__makeit__permanentwith__Always (orGet__Info).Unlike__on Windows,output__isretained__inthe__resultingconsole__windowon__exitand__errors.A__#!first__lineisn__trequired__butcan__be used.Environment__variablesOn__macOS,you__canalso__setor__changeenvironment__variableslike__PATHused__tolocate__programslike__python3named__incommand__lines,and__PYTHONPATHused__tolocate__importedmodules__withcode__inyour__shells__startupfiles__(e.g. ~/.bash_profileor__~/.zprofile).PATH__isset__automaticallyby__python.org installs.For__pointerson__theshell__codeused__toset__these variables,see__theexample__inChapter__22,as__wellas__theweb__andyour__PCs__docs (e.g.,info__bashand__theunfortunately__codedman__bash).Other__macOSoptions__For completeness,it__sworth__notingthat__thereare__additional platform-specifictools__forPython__onmacOS__(e.g., PyObjC),and__the third-partyHomebrew__packagemanager__providesan__entirelydifferent__installscheme__forPython__on macOS,which__worksequally__wellbut__hasextra__setupsteps__thatmake__itbetter__suitedto__advanced readers.For__space,we__llskip__furtherdetails__here;see__theHOWTO__at python.organd__yourlocal__websearch__enginefor__morePython__optionson__macOS.Using__Pythonon__LinuxPython__isa__stapleon__Linux,where__its__usedboth__foruser__applicationsand__system tools.Because__its__soubiquitous__onthis__Unix-based platform,Python__maycome__preinstalledwith__yourLinux__distribution;type__python3in__ashell__window (e.g., Terminal)to__check.If__youneed__toinstall__manually,do__theusual__thingfor__yourLinux__flavor:a__sudoapt__install python3in__Terminaldoes__thedeed__inUbuntu__distributions (tryyum__onsome__others).Once__youve__gota__Python 3.X installed,run__codeinteractively__andlaunch__codefiles__withthe__usualTerminal__command lines,like__thosecaptured__inFigure__A-11.A__python3 (ora__version-specific name)starts__aninteractive__sessionfor__typingand__running code,and__addinga__filename (e.g., python3 script.py)runs__a file.As__onother__platforms,your__PATHsetting__isused__bysuch__commandsto__locate Python.As__onall__Unixes,the__keycombo__Ctrl+Dat__>>>exits__aPython__REPL,and__shortershell__aliasesfor__python3can__avoidsome__typing.Figure__A-11.Running__Pythonin__LinuxTerminal__Whenusing__command lines,you__llalso__needto__usea__texteditor__forscripts__and modules.To__makesuch__afile__ofPython__code,any__Linuxtext__editorwill__do,including__thegraphical__Geditdefault__onUbuntu__andthe__shell-orientedvi__and nano.You__canalso__usePython__sIDLE__edit-and-runGUI__on Linux.Launch__itwith__anidle__commandline__afterinstalling__itwith__sudoapt__install idle3,or__similaron__other distributions.A__code-file right-clickand__OpenWith__infile__explorersmay__startIDLE__too.IDLE__fine print:you__mayneed__toforce__versionswith__amore__specificname__(e.g., idle-python3.12);emojis__mightnot__workuntil__afont__install (e.g.,sudo__aptinstall__ttf-ancient-fonts-symbola);and__a platform-agnosticcommand__line python3 -m idlelib.idlestarts__IDLE, too,per__theWindows__flavornoted__earlier.Figure__A-12demos__IDLErunning__onan__UbuntuLinux__PCafter__allthe__kinkshave__beenironed__out;it__worksthe__sameon__Linuxas__onWindows__and macOS,and__iscovered__inmore__detailin__thisappendix__sWindows__section.Figure__A-12.The__IDLEGUI__sShell__windowon__LinuxAlso__noteworthyon__Linux:If__youwish__touse__Pythons__portabletkinter__GUI toolkit,you__caninstall__itseparately__ifneeded__withsudo__aptinstall__python3-tk (or similar,in__therichly__bifurcatedworld__ofLinux__package installs).As__on macOS,a__linestarting__with #!at__thetop__ofyour__scriptcan__denotewhich__Pythonruns__the file,and__environmentvariables__likePATH__andPYTHONPATH__canbe__setin__shellstartup__files,but__theformer__isnot__usually required.See__themacOS__sections__coverageof__bothtopics__andChapter__22s__PYTHONPATH example.Python__filescan__berun__byclicks__onLinux__too,but__details vary.In__Ubuntus__Files,Run__asa__Programruns__aclicked__Pythonfile__thathas__bothexecutable__permission (e.g.,chmod__+x script.py),and__a #!/first__linethat__givesthe__pathto__Python,but__theWindows__cautionabout__outputdisappearing__onexit__orerror__applies.It__snot__uncommonon__Linuxto__buildPython__fromits__sourcecode__distribution,available__ateither__python.orgor__GitHub.This__entailsa__fewsimple__commandlines__(configureand__make)but__isbeyond__thescope__ofboth__thischapter__andmost__Python beginners;see__theDownloads__pageat__python.orgfor__codeand__details.For__moreinfo__aboutPython__on Linux,try__theweb__atlarge__or python.orgs__HOWTO. Here,it__stime__tomove__aheadto__Pythons__storyon__mobile.Using__Pythonon__AndroidAndroid__isa__securederivative__ofLinux__adaptedfor__theunique__constraintsof__mobile devices,and__itis__themost__widelyused__operatingsystem__inthe__worldat__this writing.Despite__thisplatform__sJava__andKotlin__programming-language biases,Python__canbe__usedas__a first-classprogramming__citizenon__Androiddevices__inboth__learningand__development roles.This__books__examples,for__instance,will__workwell__onyour__Androidphone__or tablet.To__runPython__locallyon__your Android,you__llfirst__installan__appthat__supportsit__froman__appstore__likePlay__or F-Droid.Among__these apps, Termux,Pydroid__3,and__QPythonall__allowyou__torun__Pythoncode__onAndroid__directlyin__multiple modes.While__wecan__tdo__justiceto__theseand__otherPython__apps,here__sa__quickrundown__oftwo__toget__you started.The__freeand__opensource__Termuxapp__forAndroid__providesa__full-featuredLinux__shell, toolset,and__package manager.To__usePython__in Termux,first__installthe__Termuxapp__fromthe__F-Droidstore__(itsPlay__versionis__defunct). Then,open__theapp__fromyour__Apps screen,and__installPython__3.Xinside__itwith__apkg__installpython__commandline__inits__shell.Termux__openswith__astandard__Bash command-line shell,where__youcan__tapout__commandsto__launchan__interactivePython__sessionwith__python,and__runa__fileof__codeby__addinga__filename (e.g.,python__script.py).Stream__redirectionworks__ason__all Unix,and__command python3is__thesame__aspython__ifyou__preferUnix__uniformityand__dont__mindthe__extra tap.Both__commandsare__automaticallyusable__postinstall__withoutPATH__mods.You__canuse__codefiles__(scriptsand__modules)located__inany__folderTermux__hasaccess__to (whichgenerally__meansshared__or app-private storage,per__ahead)and__makeand__changethem__eitherwith__separatetext__editorapps__orwithin__Termuxitself__usingLinux__texteditors__likevi__andnano__(installthem__inTermux__withpkg__installas__needed).Termux__alsosupports__Androids__StorageAccess__Frameworkto__makeits__app-privatestorage__visibleto__some file-explorer apps,although__sharedstorage__ismore__accessibleand__usable.Figure__A-13demos__theTermux__apprunning__Pythoncode__andfile__on Android.As__onall__Unixes,the__keyscombo__Ctrl+Dat__>>>ends__aPython__interactivesession__inTermux__(viaTermux__sCTRL__buttonor__keyboards ahead),as__doeskilling__the app,and__shellaliases__canshorten__thepython__(or python3) command.With__apps,you__llgenerally__usethe__versionof__Python provided;in__Termux,this__meansone__ofthe__versionsin__package repos,but__youmay__beable__tobuild__anewer__onefrom__source code.You__canalso__installa__hostof__extensionsto__usein__yourcode__bycommand__line,with__bothTermux__spkg__andPython__s pip.Figure__A-13.Running__Pythonin__theTermux__appon__AndroidTermux__maybe__thepath__ofleast__resistancefor__gettingstarted__withPython__on Android.It__hasmore__featureswe__lllargely__skip here,including__home-screenwidgets__thatrun__Pythonscripts__on taps,and__allLinux__conceptscovered__earlier apply,including__PYTHONPATHand__PATH environment-variable settings.Its__chiefdownside__forsome__usersmay__bethat__itis__limitedto__commandlines__sansits__optionalX__WindowSystem__support,which__isconsiderably__complexto__use; IDLE,for__example,would__bedifficult__atbest__torun__in Termux.If__youre__lookingfor__somethinga__bitmore__graphical,the__Pydroid 3app__alsoprovides__a command-lineshell__andinteractive__Python session,but__itadds__aGUI__IDEfor__editingand__launchingPython__code.The__IDEs__edit/runwindow__iscaptured__inFigure__A-14.Pydroid__3is__todayinstalled__from Play.Its__shelland__interactivesession__areless__user-friendlythan__thericher__command-linesupport__in Termux,but__itsIDE__mayseem__morecomfortable__forusers__unaccustomedto__command lines.Similar__inspirit__toIDLE__on PCs,this__apps__IDEallows__youto__editPython__code,and__launchit__witha__simple (and yellow)button__press.Figure__A-14.The__Pydroid 3app__sIDE__onAndroid__Ontop__ofits__IDE,Pydroid__3adds__supportfor__manypopular__tools,including__scientific-programminglibraries__and, remarkably,Python__stkinter__GUI toolkit.As__in Termux,Python__sversion__ispreset__inPydroid__3 (thoughsource__buildsare__elusive),and__Pythons__pipis__availableto__installextensions__(thoughwith__adedicated__GUIin__this app).Fair__warning:as__asubstantial__trade-off,Pydroid__3is__alsoa__freemium app,which__willflash__rude full-pageads__atyou__unlessand__untilyou__paya__requiredfee__anunfortunately__commonparadigm__in Android,which__youll__haveto__weighfor__yourself.In__addition,Pydroid__3has__ahistory__ofwaffling__onsupport__forstorage__accessin__responseto__Androidand__Play edicts.By__contrast,Termux__todayis__entirelyfree__andvoid__of ads,supports__broadstorage__access,and__choosesalternative__appstores__ratherthan__limitingfunctionality__forAndroid__changesmandated__by Play.See__theweb__andapp__storesfor__infoabout__otherPython__programmingapps__onAndroid__omittedhere__for space.While__youre__ata__store,you__mayalso__wantto__exploretext__editorapps__likeQuickEdit__whichis__ableto__colorizeand__runPython__code;and__alternativeonscreen__keyboardslike__Hackers__Keyboardwhich__addsPC__keysnot__availablein__stockoptions__butcommonly__usedfor__coding (e.g.,arrows__and Ctrl).Some__Pythonapps__alsoinclude__toolsto__augmentonscreen__keyboardsthat__canbe__tailoredor__disabled,and__Bluetoothkeyboards__andcasting__tolarger__screenscan__naturallyaid__usability too.It__salso__worthnoting__inclosing__thatCPython__plansto__addAndroid__toits__listof__officiallysupported__platforms soon,which__mayfoster__additionaloptions__going forward. Moreover,although__mostbeginners__willuse__anapp__torun__Pythoncode__onAndroid__as described,it__salso__possibleto__buildstandalone__appsfor__Androidthat__arecoded__inPython__butused__likeany__other app.We__llreturn__tothis__optionat__theend__ofthis__appendixafter__onelast__platform.ANDROID__SPROPRIETARY__WORLDPython__programmersshould__alsobe__awarethat__Androidimposes__numerousconstraints__on apps,some__ofwhich__mayseem__onerousto__developerswith__backgroundsin__moreinteroperable__platforms.Most__ofthese__constraintsare__rationalizedon__thegrounds__ofsecurity__or performance,but__allreduce__utility.Android__s storage,for__instance,is__splitinto__ashared__andpersistent__areawith__controlled access,along__withareas__partlyor__whollyprivate__toapps__thatmay__vaporizeon__app uninstalls. Hence,while__POSIXfile__toolsand__pathsdo__workon__Android,Python__codemust__takecare__toeither__useaccessible__foldersor__runproprietary__JavaAPI__toolsthat__requestor__useenhanced__permissions.In__addition,background__or long-runningprocesses__mayrun__afoulof__limits;opinionated__choicesof__toolsand__languagesare__nearlyimposed__on developers;and__throttlingfor__power, heat, memory,or__otherbias__isa__normon__most phones.On__the upside,Android__userscan__installapps__outsideits__owners__storeand__canaccess__thefilesystem__withnumerous__file-explorer apps.That__makesAndroid__moreopen__thaniOS__today,but__thisis__alarge__andfluid__topic.If__youcare__aboutusing__Pythonon__mobiles,be__sureto__watchother__resourcesfor__newson__this front.Using__Pythonon__iOSiOS__whichincludes__itsiPadOS__offshootin__thisguide__isa__macOSderivative__targetedat__mobile devices.Like__Android,it__haslimiting__biasesfor__programminglanguages__(Swiftand__Objective-C),and__itis__evenmore__strictabout__carvingup__storageinto__restrictedapp__sandboxeswith__proprietaryaccess__rulesand__tools.Despite__these constraints, though,your__iPhoneor__iPadcan__beused__torun__Python code, too,including__thecode__inthis__book.Like__Android,you__llnormally__usePython__onyour__iOSdevices__byinstalling__anapp__thatruns__Python code.Among__these,Pythonista__3provides__aninteractive__Pythonsession__anda__GUIfor__editingand__runningfiles__of code,as__inother__IDEs.In__addition,this__appcomes__withaccess__tonative__iOSfeatures__anda__toolkitfor__buildingGUIs__inPython__for iOS.It__alsocan__sharecode__fileswith__theFiles__appto__beopened__with taps.To__vetfor__yourself,fetch__Pythonista 3from__theApp__Store.Figure__A-15shows__thisapp__inaction__(yes,on__ahumble__andhistorical__iPod).Be__sureto__alsoexplore__theother__iOSoptions__onthe__store;the__Pyto app,for__example,provides__similar functionality,and__comeswith__theToga__UIlibrary__forcoding__portableGUIs__(theres__moreon__Togaat__standaloneapps__ahead).Figure__A-15.Running__Pythonin__thePythonista__3app__oniOS__Apartfrom__appchoices__andplatform__restrictions,using__Pythonon__aniOS__deviceis__largelythe__sameas__onAndroid__and PCs,so__well__skipfurther__details here.For__moreon__usingPython__foriPhone__and iPad,see__theApple__AppStore__andthe__webat__large.Like__Android,iOS__isalso__scheduledto__begranted__officiallysupported__statusin__CPython soon,which__mayyield__optionsimpossible__topredict__today;watch__theweb__fornew__developments.Also__like Android,it__spossible__topackage__yourPython__programsas__standaloneapps__for iOS,but__wemust__moveon__tothis__appendixs__nextsection__tosee__how.Standalone__Appsand__ExecutablesBesides__runningPython__sourcecode__withthe__traditionalschemes__weve__just met,it__salso__possibleto__bundlePython__codeinto__astandalone__programthat__usersrun__thesame__waythey__runany__otherprogram__ontheir__device (e.g.,by__aclick__or tap).In__fact,users__cant__eventell__thesebundles__arewritten__inPython__at all:no__sourcecode__is visible,no__otherinstalls__orapps__are required,and__changesin__alocally__installedPython__haveno__effecton__the bundle.The__wayyou__llbuild__standalonesvaries__per platform.As__anoncomprehensive__sampleof__prominenttools__today,you__canbuild__standaloneexecutables__forWindows__andLinux__with PyInstaller;standalone__appsfor__macOSwith__PyInstallerand__py2app;and__standaloneapps__forAndroid__andiOS__withBuildozer__andBriefcase__(thelatter__alsooffers__optionsfor__PCs).On__Android,for__instance,it__spossible__todevelop__standaloneapps__completelyin__Python.Although__thistakes__moreeffort__thanrunning__codein__another app,its__productsare__fullyfunctional__andidiomatic__GUIapps__codedin__Python,which__runwith__a tap,leverage__AndroidAPIs__when needed,and__canbe__both side-loadedand__uploadedto__app stores.As__a demo,Figure__A-16captures__oneof__many Python-codedstandalone__appsfor__Android,running__ona__foldable.This__app,made__bythis__books__author,is__freelyavailable__inthe__Play store;is__builtfor__Androidwith__Buildozer;uses__theportable__Kivytoolkit__forits__GUI;and__relieson__Kivys__pyjniusto__accessAndroid__JavaAPIs__whenrequired__ina__smallfraction__ofits__code (e.g.,to__request permissions,run__services,open__docs,and__getdrive__labels).Figure__A-16.A__Python-codedstandalone__apprunning__onAndroid__Crucially,such__appscan__alsorun__onPC__platforms Windows, macOS,and__Linuxfrom__thesame__code base.Figure__A-17,for__instance,shows__thesame__apprunning__on macOS.Its__codeis__bundledfor__macOSand__otherPCs__with PyInstaller;its__KivyGUI__isautomatically__cross-platform;and__itsPOSIX__file-sync__codeworks__everywhere.The__netresult__isa__Python-codedapp__thatruns__acrossa__rangeof__PCand__mobile hosts,with__nativebehavior__on each.To__seethis__for yourself,fetch__thisapp__sAndroid__versionon__Playand__itsPC__versionsat__thisbook__swebsite__or quixotely.com. Disclaimer:if__theAndroid__appis__unavailableon__Play,check__forit__atthe__lattertwo__sitesor__trya__web search;book__lifespanstend__tobe__substantiallylonger__thanthose__ofapps__dependenton__storesand__platforms (seeTermux__s troubles!).Figure__A-17.The__sameapp__runningon__macOSNor__isthis__toolsetthe__onlyinteroperability__gamein__town.The__alternative BeeWare,with__itsportable__TogaGUI__toolkitand__Briefcaseapp__builder,promises__similarplatform__independenceand__advertisesadditional__packagingoptions__on PCs. Moreover,some__appsbuilt__withsuch__toolscan__workon__iOS, too,though__itslack__ofa__user-accessiblefilesystem__rendersmuch__cross-platformcode__unusable (e.g.,POSIX__file-pathsyncs__are impossible).The__takeaway here:with__aportable__programmingtool__like Python,you__renot__lockedinto__asingle__platforms__proprietaryrealm__unless,that__is,you__developfor__platformsthat__disqualifycode__thatruns__anywhere else.As__always,choose__yourcoding__battles wisely.Security__counts,but__closedplatforms__enablemonopolies__andstifle__innovation.Standalones__maynot__bevery__usefulwhen__youre__justgetting__startedwith__Python (andmake__nosense__atall__forrunning__theexamples__inthis__book!),but__theymay__becomemore__importantwhen__youstart__writingprograms__forothers__to use.When__youre__readyto__explorestandalone__deliverablesin__Python,see__theweb__forcurrent__toolsand__detailsin__this domain.Etcetera__Whilethe__platformtechniques__weve__exploredhere__areperhaps__thesimplest__andmost__commonways__touse__Python,there__smuch__moreto__this story.For__instance,this__appendixhasn__tsaid__anythingabout__usingPython__in:Other__IDEslike__PyCharm, PyDev, Wing,and__VSCode Web-basednotebooks__likeIPython__andJupyter__AlternativePython__implementationslike__PyPy, Cython, Numba,and__JythonAlternative__Pythondistributions__likeAnaconda__andActiveState__Thecells__andmacros__ofspreadsheets__likeExcel__Webservers__usingframeworks__likeFlask__andDjango__Webbrowsers__usingthe__emergingWebAssembly__andPyodide__Andlots__ofother__optionsin__noway__judgedby__omission here.This__bookvisits__someof__thesein__Chapter 1,summarizes__Pythonimplementations__inChapter__2,briefly__reviewsJupyter__andWebAssembly__inChapter__3,and__usesPyPy__forbenchmarks__inChapter__21.In__general, though,advanced__usagecontexts__likethese__areinteresting__butout__ofscope__forthis__Pythonfundamentals__text,and__bestdeferred__untilyou__vemastered__thelanguage__itself.In__the end,Python__usagedetails__andoptions__tendto__evolveas__rapidlyas__Python itself. Indeed,each__prioredition__ofthis__bookhas__hadto__reviseits__usagecoverage__radically,and__thisone__expectsto__fareno__better.As__notedat__thestart__ofthis__appendix,you__shouldexpect__tocheck__bothPython__sdocs__andthe__webat__largefor__new-and-excitingdevelopments__almostcertain__toemerge__bythe__timeyou__readthese__words.Appendix__B.Solutions__to End-of-Part__ExercisesThis__appendixprovides__solutionsfor__thebook__s end-of-part exercises.Code__filesnamed__bycaptions__ornarrative__inthese__solutionsare__availablein__thebook__examplespackage__sAppendixB__folder,which__hasone__subfolderper__part (e.g., AppendixB/Part1is__thefirst__parts__files).See__thePreface__formore__infoon__theexamples__package.Part__I,Getting__StartedSee__TestYour__Knowledge:Part__IExercises__inChapter__3for__the exercises. 1. Interaction:Assuming__Pythonis__configured properly,the__interactionshould__looksomething__likethe__following.You__canrun__thisany__wayyou__likein__IDLE,a__console,an__app,a__notebooks__page,and__so on: $ python3information__lines >>> 'Hello World!' 'Hello World!' >>> #Use__ctrl+D/ctrl+Zto__exiton__Unix/Windows,or__closewindow__2. Programs:Your__code (i.e., module)file__shouldlook__somethinglike__Example B-1:Example__B-1. Part1/module1.py print('Hellomodule__world!')And__hereis__thesort__ofinteraction__youshould__have;for__console launches,be__sureto__useyour__platforms__versionof__the python3command__(e.g.,try__py -3on__Windows): $ python3 module1.pyHello__module world! Again,feel__freeto__runthis__otherways__byclicking__ortapping__thefile__s icon,by__usingIDLE__sRun__RunModule__menu option,by__UIoptions__inweb__notebooksor__other IDEs,and__so on. 3. Modules:The__followinginteraction__listingillustrates__runninga__modulefile__byimporting__it: $ python3 >>>import__module1Hello__module world! >>>Remember__thatyou__willneed__toreload__themodule__torun__itagain__withoutstopping__andrestarting__theinteractive__interpreter (i.e., REPL).Moving__the .pyfile__toa__differentdirectory__andimporting__itnormally__fails:Python__likelygenerated__a module1.*.pycfile__inthe____pycache__subdirectory__ofthe__sourcecode__files__folder,but__itwon__tuse__itwhen__youimport__themodule__thereif__thesource__code (.py)file__hasbeen__movedelsewhere__andto__afolder__notin__Pythons__importsearch__path.The__.pycfile__iswritten__automaticallyif__Pythonhas__accessto__thesource__files__directory;it__containsthe__compiledbytecode__versionof__a module.See__Chapter 3for__moreon__modules,Chapter__2for__moreon__bytecode,and__Chapter 22ahead__formore__on both.To__reallyuse__thesaved__.pycsans__.py,as__ofPython__3.2,you__mustmove__itup__onelevel__andrename__itwithout__the *part__inthe__middle,or__generateit__fromand__alongsidethe__sourcecode__filewith__thePython__compileallmodule__slegacy__(-b) mode.For__example,the__followingcompiles__allsource__codefiles__inthe__currentdirectory__intodirectly__usablebytecode__files (youcan__alsolist__specificfiles__orrecurse__into subfolders,per__Pythonlibrary__docs): $ python3 -mcompileall__-b -l . 4. Scripts:Assuming__yourplatform__supportsthe__#! trick,your__solutionwill__looklike__Example B-2,although__your #!line__mayneed__tolist__adifferent__pathto__Pythonon__your machine.This__lineis__significantunder__theWindows__launchershipped__andinstalled__with Python,where__itis__parsedto__selecta__versionof__Pythonto__runthe__script,despite__theUnix__path syntax,and__subjectto__adefault__setting;see__AppendixA__andPython__sdocs__formore__details.This__launchingscheme__isoptional__andgenerally__lessportable__than others.Example__B-2. Part1/script1.py #!/usr/local/bin/python3 print('Hellomodule__world!')Running__thisas__aprogram__byconsole__command line: $chmod__+x script1.py #See__also: #!/usr/bin/env python3 $ ./script1.py # "./"needed__onlyif__"."not__onPATH__Hellomodule__world! $ python3 script1.py #Or__runnormally__andportably__Hellomodule__world! 5.Errors__and debugging:The__followinginteraction__demonstratesthe__sortsof__errormessages__youll__getwhen__youcomplete__this exercise. Really,you__retriggering__Python exceptions;the__default exception-handlingbehavior__terminatesthe__runningPython__programand__printsan__errormessage__andstack__traceon__the screen.The__stacktrace__showswhere__youwere__ina__programwhen__theexception__occurred (iffunction__callsare__activewhen__theerror__happens,the__Tracebacksection__displaysall__activecall__levels).In__Chapter 10and__Part VII,you__willlearn__thatyou__cancatch__exceptionsusing__trystatements__andprocess__them arbitrarily.You__llalso__learnthat__Pythonincludes__a full-blownsource__codedebugger__(module pdb)for__special error-detection requirements.For__now,notice__thatPython__givesmeaningful__messageswhen__programmingerrors__occur,instead__ofcrashing__silently: $ python3 >>> 2 ** 500 32733906078961418700131896968275991522166420460430647894832913680961337964 046745 54883270092325904157150886684127560071009217256545885393053328527589376 >>> 1 / 0Traceback__(mostrecent__call last):File__"",line__1,in__ZeroDivisionError:division__byzero__>>>oops__Traceback (mostrecent__call last):File__"",line__1,in__NameError:name__'oops'is__notdefined__6.Breaks__and cycles:When__youtype__this code: $ python3 >>>L__= [1, 2] >>> L.append(L) >>>L__[1, 2, [...]]you__createa__cyclicdata__structurein__Python.In__Pythonreleases__before 1.5.1,the__Pythonprinter__wasnt__smartenough__todetect__cyclesin__objects,and__itwould__printan__unendingstream__of [1, 2, [1, 2, [1, 2, [1, 2,and__soon__untilyou__hitthe__Ctrl+C break-keycombination__onyour__machine (which, technically,raises__a keyboard-interruptexception__thatprints__adefault__message).Beginning__withPython__1.5.1,the__printeris__cleverenough__todetect__cycles,prints__[[...]]instead__tolet__youknow__thatit__hasdetected__aloop__inthe__objects__structure,and__avoidsgetting__stuckprinting__forever.The__reasonfor__thecycle__issubtle__andrequires__informationyou__willglean__inPart__II,so__thisis__somethingof__a preview.But__in short,assignments__inPython__alwaysgenerate__referencesto__objects,not__copiesof__them.You__canthink__ofobjects__aschunks__ofmemory__andof__referencesas__implicitlyfollowed__pointers.When__yourun__thefirst__assignmentin__thepreceding__code,the__nameL__becomesa__namedreference__toa__two-itemlist__objecta__pointerto__apiece__of memory.Python__listsare__reallyarrays__ofobject__references,with__anappend__methodthat__changesthe__arrayin__placeby__tackingon__anotherobject__referenceat__the end. Here,the__appendcall__addsa__referenceto__thefront__ofL__atthe__endof__L,which__leadsto__thecycle__illustratedin__Figure B-1:a__pointerat__theend__ofthe__listthat__pointsback__tothe__frontof__the list.Figure__B-1.A__cyclic object,created__byappending__alist__toitself__Besidesbeing__printed specially,as__youll__learnin__Chapter 6,cyclic__objectsmust__alsobe__handledspecially__byPython__sgarbage__collector,or__theirspace__willremain__unreclaimedeven__whenthey__areno__longerin__use.Though__rarein__practice,in__someprograms__thattraverse__arbitraryobjects__or structures,you__mighthave__todetect__suchcycles__yourselfby__keepingtrack__ofwhere__youve__beento__avoid looping.Believe__itor__not,cyclic__datastructures__cansometimes__be useful,despite__their special-case printing.Part__II,Objects__andOperations__SeeTest__Your Knowledge:Part__IIExercises__inChapter__9for__the exercises. 1.The__basics:Here__arethe__sortsof__resultsyou__should get,along__witha__fewcomments__abouttheir__meaning. Again,note__that ;is__usedin__afew__ofthese__tosqueeze__morethan__onestatement__ontoa__singleline__(the ;is__astatement__separator),and__commasbuild__uptuples__displayedin__parentheses.See__file Part2/basics.txtfor__copy/pastesans__emedia,though__typingthese__manuallyis__agood__wayto__practice syntax: $ python3 #Numbers__>>> 2 ** 16 # 2raised__tothe__power 16 65536 >>> 2 / 5, 2 / 5.0 #Division__keepremainders__(0.4, 0.4) #Strings__>>> 'hack' + 'code' #Concatenation__'hackcode' >>>S__= 'Python' >>> 'grok ' +S__'grok Python' >>>S__* 5 #Repetition__'PythonPythonPythonPythonPython' >>> S[0], S[:0], S[1:] #An__emptyslice__atthe__front - [0:0] ('P', '', 'ython') #Empty__ofsame__typeas__objectsliced__>>>how__= 'fun' >>> 'coding %sis__%s!' % (S, how) # Formatting: expression, method, f-string__'codingPython__is fun!' >>> 'coding {}is__{}!'.format(S, how) 'codingPython__is fun!' >>> f'coding {S}is__{how}!' 'codingPython__is fun!' #Tuples__>>> ('x',)[0] #Indexing__a single-itemtuple__'x' >>> ('x', 'y')[1] #Indexing__a two-itemtuple__'y' #Lists__>>>L__= [1, 2, 3] + [4, 5, 6] #List__operations >>> L, L[:], L[:0], L[-2], L[-2:] ([1, 2, 3, 4, 5, 6], [1, 2, 3, 4, 5, 6], [], 5, [5, 6]) >>> ([1, 2, 3] + [4, 5, 6])[2:4] [3, 4] >>> [L[2], L[3]] #Fetch__from offsets;store__ina__list [3, 4] >>> L.reverse();L__# Method:reverse__listin__place [6, 5, 4, 3, 2, 1] >>> L.sort();L__# Method:sort__listin__place [1, 2, 3, 4, 5, 6] >>> L.index(4) # Method:offset__offirst__4 (search) 3 #Dictionaries__>>> {'a': 1, 'b': 2}['b'] #Index__adictionary__bykey__2 >>>D__= {'x': 1, 'y': 2, 'z': 3} >>> D['w'] = 0 #Create__anew__entry >>> D['x'] + D['w'] 1 >>> D[(1, 2, 3)] = 4 #A__tupleused__asa__key (immutable) >>>D__{'x': 1, 'y': 2, 'z': 3, 'w': 0, (1, 2, 3): 4} >>> list(D.keys()), list(D.values()), (1, 2, 3)in__D # Methods,key__test (['x', 'y', 'z', 'w', (1, 2, 3)], [1, 2, 3, 0, 4], True) #Empties__>>> [[]], ["", [], (), {}, None] #Lots__of nothings:empty__objects ([[]], ['', [], (), {}, None]) 2.Indexing__and slicing:Indexing__outof__bounds (e.g., L[4])raises__an error;Python__alwayschecks__tomake__surethat__alloffsets__arewithin__thebounds__ofa__sequence.On__theother__hand,slicing__outof__bounds (e.g., L[-1000:100])works__becausePython__scales out-of-boundsslices__sothat__theyalways__fit (thelimits__areset__tozero__andthe__sequence length,if__required).Extracting__asequence__in reverse,with__thelower__boundgreater__thanthe__higherbound__(e.g., L[3:1]),doesn__treally__work.You__getback__anempty__slice ([])because__Pythonscales__theslice__limitsto__makesure__thatthe__lowerbound__isalways__lessthan__orequal__tothe__upperbound__(e.g., L[3:1]is__scaledto__L[3:3],the__emptyinsertion__pointat__offset 3).Python__slicesare__alwaysextracted__fromleft__to right,even__ifyou__usenegative__indexes (theyare__firstconverted__topositive__indexesby__addingthe__sequence length).Note__thatPython__s three-limitslices__modifythis__behavior somewhat.For__instance, L[3:1:-1]does__extractfrom__rightto__left: >>>L__= [1, 2, 3, 4] >>> L[4]Traceback__(mostrecent__call last):File__"",line__1,in__IndexError:list__indexout__ofrange__>>> L[-1000:100] [1, 2, 3, 4] >>> L[3:1] [] >>>L__[1, 2, 3, 4] >>> L[3:1] = ['?'] >>>L__[1, 2, 3, '?', 4] 3. Indexing, slicing,and__del:Your__interactionwith__theinterpreter__shouldlook__somethinglike__the following.Note__thatassigning__anempty__listto__anoffset__storesan__emptylist__object there,but__assigningan__emptylist__toa__slicedeletes__the slice.Slice__assignmentexpects__another sequence,or__youll__geta__type error;it__insertsitems__insidethe__sequence assigned,not__thesequence__itself: >>>L__= [1, 2, 3, 4] >>> L[2] = [] >>>L__[1, 2, [], 4] >>> L[2:3] = [] >>>L__[1, 2, 4] >>>del__L[0] >>>L__[2, 4] >>>del__L[1:] >>>L__[2] >>> L[1:2] = 1Traceback__(mostrecent__call last):File__"",line__1,in__TypeError:can__onlyassign__aniterable__4.Tuple__assignment:The__valuesof__Xand__Yare__swapped.When__tuplesappear__onthe__leftand__rightof__anassignment__symbol (=),Python__assignsobjects__onthe__rightto__targetson__theleft__accordingto__their positions.This__isprobably__easiestto__understandby__notingthat__thetargets__onthe__leftaren__ta__real tuple,even__thoughthey__looklike__one;they__aresimply__aset__ofindependent__assignment targets.The__itemson__theright__area__tuple,which__getsunpacked__duringthe__assignment (thistuple__providesthe__temporaryassignment__neededto__achievethe__swap effect): >>>X__= 'code' >>>Y__= 'hack' >>> X,Y__= Y,X__>>>X__'hack' >>>Y__'code' 5.Dictionary__keys:Any__immutable (technically,hashable__)object__canbe__usedas__adictionary__key,including__integers, tuples, strings,and__so on.This__reallyis__a dictionary,even__thoughsome__ofits__keyslook__likeinteger__offsets. Mixed-typekeys__work fine, too: >>>D__= {} >>> D[1] = 'a' >>> D[2] = 'b' >>> D[(1, 2, 3)] = 'c' >>>D__{1: 'a', 2: 'b', (1, 2, 3): 'c'} 6.Dictionary__indexing:Indexing__anonexistent__key (D['d'])raises__an error;assigning__toa__nonexistentkey__(D['d']='hack')creates__anew__dictionary entry.On__theother__hand, out-of-boundsindexing__forlists__raisesan__error, too,but__sodo__out-of-bounds assignments.Variable__nameswork__likedictionary__keys;they__musthave__alreadybeen__assignedwhen__referenced,but__theyare__createdwhen__first assigned.In__fact,variable__namescan__beprocessed__asdictionary__keysif__youwish__(theyre__madevisible__inthe__dictionariesof__stackframes__ormodule__[orother__object] namespaces): >>>D__= {'a': 1, 'b': 2, 'c': 3} >>> D['a'] 1 >>> D['d']Traceback__(mostrecent__call last):File__"",line__1,in__KeyError: 'd' >>> D['d'] = 4 >>>D__{'a': 1, 'b': 2, 'c': 3, 'd': 4} >>>L__= [0, 1] >>> L[2]Traceback__(mostrecent__call last):File__"",line__1,in__IndexError:list__indexout__ofrange__>>> L[2] = 3Traceback__(mostrecent__call last):File__"",line__1,in__IndexError:list__assignmentindex__outof__range 7.Generic__operations:Question__answers (withsome__errortext__omittedin__listings): a.The__+operator__doesnt__workon__different/mixedtypes__(e.g.,string__+ list,list__+ tuple). b. +doesn__twork__for dictionaries,as__theyaren__tsequences__(though | does). c.The__appendmethod__worksonly__for lists,not__strings,and__keysworks__onlyon__dictionaries.append__assumesits__targetis__mutable,since__its__an in-place extension;strings__are immutable.Dictionary__keysis__similarlytype__specific. d.Slicing__andconcatenation__alwaysreturn__anew__objectof__thesame__typeas__theobjects__processed: >>> 'x' + 1 TypeError:illegal__argumenttype__for built-inoperation__>>> {} + {} TypeError:bad__operand type(s)for__+ >>> [].append(9) >>> ''.append('s') AttributeError: attribute-lessobject__>>> list({}.keys()) [] >>> [].keys() AttributeError:keys__>>> [][:] [] >>> ''[:] '' 8.String__indexing:This__isa__bitof__atrick__questionbecause__stringsare__collectionsof__one-character strings,every__timeyou__indexa__string,you__getback__astring__thatcan__beindexed__again. S[0][0][0][0][0]just__keepsindexing__thefirst__characterover__and over.This__generallydoesn__twork__forlists__(listscan__holdarbitrary__objects)unless__thelist__contains strings: >>>S__= 'hack' >>> S[0][0][0][0][0] 'h' >>>L__= ['h', 'a'] >>> L[0][0][0] 'h' 9.Immutable__types:Either__ofthe__followingsolutions__works.Index__assignmentdoesn__tbecause__stringsare__immutable: >>>S__= 'hack' >>>S__= S[0] + 'e' + S[2:] >>>S__'heck' >>>S__= S[0] + 'i' + S[2] + S[3] >>>S__'hick' (Seealso__thebytearray__stringtype__inChapter__37it__sa__mutablesequence__ofsmall__integersthat__isessentially__processedthe__sameas__a string,especially__whenits__bytesare__ASCIIcharacter__code points.) 10. Nesting:Here__isa__sample (yourspecs__will vary): >>>pat__= {'name': ('Pat', 'Q', 'Jones'), 'age': None, 'job': 'engineer'} >>> pat['job'] 'engineer' >>> pat['name'][2] 'Jones' 11. Files:Examples__B-3and__B-4show__oneway__tocreate__andread__backa__textfile__inPython__usingUnicode__encodingdefaults__onthe__host (whichare__generallymoot__forsimple__ASCIItext__like this):Example__B-3. Part2/maker.pyfile__= open('myfile.txt', 'w') file.write('Hellofile__world!\n') # Or: open().write() file.close() #close__notalways__neededExample__B-4. Part2/reader.pyfile__= open('myfile.txt') # 'r'is__defaultopen__mode print(file.read()) #Or__print(open().read())When__run (here,from__aconsole__command line),the__fileshows__upin__thedirectory__youre__workingin__becauseits__namehas__nopath__prefix.The__lshere__isa__Unix command;use__diron__Windows: $ python3 maker.py $ python3 reader.pyHello__file world! $ls__-l myfile.txt -rw-r--r-- 1me__staff 18Aug__11 19:34 myfile.txtPart__III,Statements__andSyntax__SeeTest__Your Knowledge:Part__IIIExercises__inChapter__15for__the exercises. 1.Coding__basic loops:As__youwork__throughthis__exercise,you__llwind__upwith__codethat__lookslike__the following: >>>S__= 'hack' >>>for__cin__S: ... print(ord(c)) ... 104 97 99 107 >>>x__= 0 >>>for__cin__S:x__+= ord(c) # Or:x__=x__+ ord(c) ... >>>x__407 >>> chr(x) #Extra__credit: non-ASCII,see__Chapter 37 ' ' >>>x__= [] >>>for__cin__S: x.append(ord(c)) #Manual__listconstruction__... >>>x__[104, 97, 99, 107] >>> list(map(ord, S)) [115, 112, 97, 109] >>> [ord(c)for__cin__S] #map__andlistcomps__automatelist__builders [115, 112, 97, 109] 2.Coding__basic selections:Here__isthe__sortof__code expected.To__handle out-of-range numbers,add__anelse__for if,a__case___for match,a__getmethod__callor__intest__forthe__dictionary,and__atry__handlerfor__the list.For__versionsof__thiscode__thatare__easierto__copy/paste,see__file Part3/selections.txtin__theexamples__package: >>>month__= 3 >>>if__month == 1: ... print('January') ...elif__month == 2: ... print('February') ...elif__month == 3: ... print('March') ...March__>>>match__month: ...case__1: ... print('January') ...case__2: ... print('February') ...case__3: ... print('March') ...March__>>> {1: 'January', 2: 'February', 3: 'March'}[month] 'March' >>> ['January', 'February', 'March'][month - 1] 'March' 3.Backslash__characters:The__exampleprints__thebell__character (\a) 50 times.Assuming__yourmachine__canhandle__it,and__whenit__srun__outsideof__someinterfaces__like IDLE,you__mayget__aseries__ofbeeps__(orone__sustainedtone__ifyour__machineis__fast enough).Hey__youwere__warned. 4.Sorting__dictionaries:Here__sone__wayto__workthrough__thisexercise__(seeChapter__8or__Chapter 14if__thisdoesn__tmake__sense).You__reallydo__haveto__splitoff__thekeys__andsort__callslike__thisbecause__sortreturns__None.You__caniterate__throughdictionary__keysdirectly__withoutcalling__keys (e.g.,for__keyin__D:),but__thekeys__listwill__notbe__sortedlike__itis__bythis__code.The__sorted built-inis__simplerbut__createsa__newlist__object: >>>D__= {'a': 1, 'c': 3, 'e': 5, 'g': 7, 'f': 6, 'd': 4, 'b': 2} >>>D__{'a': 1, 'c': 3, 'e': 5, 'g': 7, 'f': 6, 'd': 4, 'b': 2} >>>keys__= list(D.keys()) #Keys__viewhas__nosort__method >>> keys.sort() #Sort__listin__place:returns__None >>>for__keyin__keys: #Iterate__oversorted__list ... print(key, '=>', D[key]) ...a__=> 1b__=> 2c__=> 3d__=> 4e__=> 5f__=> 6g__=> 7 >>>D__{'a': 1, 'c': 3, 'e': 5, 'g': 7, 'f': 6, 'd': 4, 'b': 2} >>> >>>for__keyin__sorted(D): #Simpler__alternative,but__anew__list ... print(key, '=>', D[key]) ...same__output 5.Program__logic alternatives:Here__ssome__samplecode__forthe__solutions,available__inthe__examplespackage__s Part3/power*.py.For__step e,assign__theresult__of 2 **X__toa__variableoutside__theloops__ofsteps__aand__band__useit__insidethe__loop.Your__resultsmay__vary;this__exerciseis__mostlydesigned__toget__youplaying__withcode__alternatives,so__anythingreasonable__getsfull__credit: #a__L = [1, 2, 4, 8, 16, 32, 64]X__= 5i__= 0while__i < len(L):if__2 **X__== L[i]: print('at index', i)break__i += 1 else: print(X, 'not found') #b__L = [1, 2, 4, 8, 16, 32, 64]X__= 5for__pin__L:if__(2 ** X) == p: print((2 ** X), 'wasfound__at', L.index(p))break__else: print(X, 'not found') #c__L = [1, 2, 4, 8, 16, 32, 64]X__= 5if__(2 ** X)in__L: print((2 ** X), 'wasfound__at', L.index(2 ** X)) else: print(X, 'not found') #d__X = 5L__= []for__iin__range(7): L.append(2 ** i) print(L)if__(2 ** X)in__L: print((2 ** X), 'wasfound__at', L.index(2 ** X)) else: print(X, 'not found') # "Deeper thoughts"X__= 5L__= list(map(lambda x: 2 ** x, range(7))) #Or__[2 **x__forx__in range(7)] print(L)if__(2 ** X)in__L: print((2 ** X), 'wasfound__at', L.index(2 ** X)) else: print(X, 'not found')Part__IV,Functions__andGenerators__SeeTest__Your Knowledge:Part__IVExercises__inChapter__21for__the exercises. 1.The__basics:There__snot__muchto__this one,but__noticethat__usingprint__(andhence__your function)is__technicallya__polymorphic operation,which__doesthe__rightthing__foreach__typeof__object: $ python3 >>>def__echo(x): print(x) >>> echo('hack')hack__>>> echo(3.12) 3.12 >>> echo([1, 2, 3]) [1, 2, 3] >>> echo({'edition': 6}) {'edition': 6} 2. Arguments:Example__B-5gives__asample__solution.Remember__thatyou__haveto__useprint__tosee__resultsin__thetest__callsbecause__afile__isnt__thesame__ascode__typed interactively;Python__doesnt__normallyecho__theresults__ofexpression__statementsin__files:Example__B-5. Part4/adder1.pydef__adder(x, y):return__x +y__print(adder(5, 1.0)) print(adder('hack', 'code')) print(adder(['a', 'b'], ['c', 'd']))And__the output: $ python3 adder1.py 6.0hackcode__['a', 'b', 'c', 'd'] 3.Arbitrary__arguments:Two__alternativeadder__functionsare__shownin__Example B-6.The__hardpart__hereis__figuringout__howto__initializean__accumulatorto__anempty__valueof__whatevertype__ispassed__in.The__firstsolution__usesmanual__typetesting__tolook__foran__integerand__anempty__sliceof__thefirst__argument (assumedto__bea__sequence)if__theargument__isdetermined__notto__bean__integer.The__secondsolution__usesthe__firstargument__toinitialize__andscan__items 2and__beyond,much__likeone__ofthe__minfunction__variantsshown__inChapter__18.The__secondsolution__maybe__better.Both__ofthese__assumeall__argumentsare__ofthe__same type,and__neitherworks__ondictionaries__(aswe__sawin__Part II, +doesn__twork__onmixed__typesor__dictionaries).You__couldadd__atype__testand__specialcode__using for, update, **,or__|to__supportdictionaries__combos, too,but__thats__extra credit;see__solutions 5and__6ahead__forrelated__notes.And__yes,there__isa__sum(iterable) built-inin__Pythonthat__wouldmake__thiseven__simpler,but__thepoint__hereis__towrite__codeof__your own;you__llhave__to eventually:Example__B-6. Part4/adder2.pydef__adder1(*args): print('adder1:', end=' ')if__type(args[0]) == type(0): # Integer?sum__= 0 #Init__tozero__else: #else__sequence:sum__= args[0][:0] #Use__emptyslice__of arg1for__argin__args:sum__=sum__+arg__returnsum__def adder2(*args): print('adder2:', end=' ')sum__= args[0] #Init__to arg1for__nextin__args[1:]:sum__+=next__#Add__items 2..Nreturn__sumfor__funcin__(adder1, adder2): print(func(2, 3, 4)) print(func('hack', 'code', 'well')) print(func(['a', 'b'], ['c', 'd'], ['e', 'f']))Here__sthe__sortof__outputyou__should get: $ python3 adder2.py adder1: 9 adder1:hackcodewell__adder1: ['a', 'b', 'c', 'd', 'e', 'f'] adder2: 9 adder2:hackcodewell__adder2: ['a', 'b', 'c', 'd', 'e', 'f'] 4. Keywords:Example__B-7gives__asolution__tothe__firstpart__ofthis__exercise,along__withits__outputin__a console.Example__B-7. Part4/adder3.pydef__adder(red=1, green=2, blue=3):return__red +green__+blue__print(adder()) print(adder(5)) print(adder(5, 6)) print(adder(5, 6, 7)) print(adder(blue=7, red=6, green=5)) print(adder(blue=1, red=2)) $ python3 adder3.py 6 10 14 18 18 5Example__B-8gives__thesecond__parts__solutionand__its output.To__iterateover__keyword arguments,use__the **argsform__inthe__functionheader__anduse__aloop__(e.g.,for__xin__args.keys():use__args[x]),or__use args.values()to__makethis__thesame__assumming__*argspositionals__inexercise__number 3:Example__B-8. Part4/adder4.pydef__adder1(*args): #Sum__anynumber__ofpositional__argstot__= args[0] #Same__as #3,for__comparisonand__reusefor__argin__args[1:]:tot__+=arg__returntot__def adder2(**args): #Sum__anynumber__ofkeyword__argsargskeys__= list(args.keys()) #list__requiredto__index!tot__= args[argskeys[0]]for__keyin__argskeys[1:]:tot__+= args[key]return__totdef__adder3(**args): # Same,but__convertto__listof__valuesargs__= list(args.values()) #list__neededto__index!tot__= args[0]for__argin__args[1:]:tot__+=arg__returntot__def adder4(**args): # Same,but__reusepositional__versionreturn__adder1(*args.values()) print(adder1(1, 2, 3), adder1('aa', 'bb', 'cc')) print(adder2(a=1, b=2, c=3), adder2(a='aa', b='bb', c='cc')) print(adder3(a=1, b=2, c=3), adder3(a='aa', b='bb', c='cc')) print(adder4(a=1, b=2, c=3), adder4(a='aa', b='bb', c='cc')) $ python3 adder4.py 6aabbcc__repeated 4times__5. (5and__6)Dictionary__tools:Solutions__forexercises__5and__6are__combinedand__listedin__Example B-9.These__arejust__codingexercises__becausePython__nowprovides__dictionarymethods__D.copy()and__D1.update(D2)to__handlethings__likecopying__andadding__(merging) dictionaries.In__fact,there__arefour__waysto__mergedictionaries__today,as__hintedin__solution 3:for__loopslike__those here, D1.update(D2), {**D1,**D2},and__D1|D2.See__Chapter 8for__moreinfo__onand__examplesof__these tools. X[:]doesn__twork__for dictionaries,as__theyre__notsequences__(seeChapter__8for__details). Also,remember__thatif__youassign__(e = d)rather__than copying,you__generatea__referenceto__ashared__dictionary object;changing__dchanges__e, too:Example__B-9. Part4/dicttools.pydef__copyDict(old):new__= {}for__keyin__old.keys(): new[key] = old[key]return__newdef__addDict(d1, d2):new__= {}for__keyin__d1.keys(): new[key] = d1[key]for__keyin__d2.keys(): new[key] = d2[key]return__newHere__isthe__expectedbehavior__ofthis__codedemoed__ina__REPL: $ python3 >>>from__dicttoolsimport__* >>>d__= {1: 1, 2: 2} >>>e__= copyDict(d) >>> d[2] = '?' >>>d__{1: 1, 2: '?'} >>>e__{1: 1, 2: 2} >>>x__= {1: 1} >>>y__= {2: 2} >>>z__= addDict(x, y) >>>z__{1: 1, 2: 2} 6.See__#5 (wheresolutions__were combined). 7.More__argument-matching examples:Here__isthe__sortof__interactionyou__should get,along__withcomments__thatexplain__thematching__thatgoes__on.It__maybe__easiestto__pastethe__functionsinto__afile__andimport__themall__witha__*for__testingin__a REPL;they__rerepeated__inExample__B-10for__reference (andin__theexamples__packagefor__copying):Example__B-10. Part4/testfuncs.pydef__f1(a, b): print(a, b) #Normal__argsdef__f2(a, *b): print(a, b) #Positional__collectorsdef__f3(a, **b): print(a, b) #Keyword__collectorsdef__f4(a, *b, **c): print(a, b, c) #Mixed__modesdef__f5(a, b=2, c=3): print(a, b, c) #Defaults__def f6(a, b=2, *c): print(a, b, c) #Defaults__andpositional__collectorThe__expectedREPL__interaction: $ python3 >>>from__testfuncsimport__* >>> f1(1, 2) #Matched__byposition__(order matters) 1 2 >>> f1(b=2, a=1) #Matched__byname__(order doesn't matter) 1 2 >>> f2(1, 2, 3) #Extra__positionalscollected__ina__tuple 1 (2, 3) >>> f3(1, x=2, y=3) #Extra__keywordscollected__ina__dictionary 1 {'x': 2, 'y': 3} >>> f4(1, 2, 3, **dict(x=2, y=3)) #Extras__ofboth__kinds,star__unpacking 1 (2, 3) {'x': 2, 'y': 3} >>> f5(1) #Both__defaultskick__in 1 2 3 >>> f5(1, 4) #Only__onedefault__used 1 4 3 >>> f5(1, c=4) #Middle__defaultapplied__1 2 4 >>> f6(1) #One__argument:matches__"a" 1 2 () >>> f6(1, *[3, 4]) #Extra__positional collected,star__unpacking 1 3 (4,) 8.Primes__revisited:Example__B-11is__theprimes__example,wrapped__upin__afunction__anda__module (file primes.py)so__itcan__berun__multiple times.An__iftest__wasadded__totrap__negatives, 0,and__1.It__scrucial__touse__//floor__divisioninstead__ofthe__/true__divisionwe__studiedin__Chapter 5to__avoidfractional__remainders (5 / 2would__yielda__falsefactor__2.5,but__5 / 2truncates__downto__2).Change__//to__/to__seethe__differencefor__yourself:Example__B-11. Part4/primes.pydef__prime(y):if__y <= 1: #For__somey__> 1 print(y, 'is nonprime') else:x__=y__// 2 #But__/fails__whilex__> 1:if__y %x__== 0: #No__remainder? print(y, 'has factor', x)break__#Skip__elsex__-= 1 else: print(y, 'is prime')tests__= (27, 24, 13, 13.0, 15, 15.0, 3, 2, 1, -3)for__testin__tests: prime(test)Here__isthe__modulein__action;the__//operator__alsoallows__itto__workfor__floating-pointnumbers__bytruncating__tothe__floor (5.0 // 2is__2.0,not__2.5): $ python3 primes.py 27has__factor 9 24has__factor 12 13is__prime 13.0is__prime 15has__factor 5 15.0has__factor 5.0 3is__prime 2is__prime 1is__nonprime -3is__nonprimeThis__functionstill__isnt__veryreusable__itcould__return values,instead__ofprinting__butit__senough__torun__experiments.It__salso__nota__strictmathematical__prime (floating-pointnumbers__work,but__shouldn t),and__its__stillperhaps__inefficient.Improvements__areleft__asexercises__formore__mathematicallyminded__readers. (Hint:a__forloop__over range(x, 1, 1)may__bea__bitquicker__thanthe__while,but__thealgorithm__maybe__thereal__bottleneck here.)To__time alternatives,use__thehomegrown__timeror__standard-librarytimeit__modulesand__codingpatterns__likethose__usedin__Chapter 21s__benchmarkingsections__(andsolution__10 ahead). 9.Iterations__and comprehensions:Here__isthe__sortof__codeyou__should write;coding__alternativesare__notoriously subjective,so__theres__noright__orwrong__preference (thoughsee__thenext__solutionfor__anobjective__factor): >>>values__= [2, 4, 9, 16, 25] >>>import__math >>>res__= [] >>>for__xin__values: res.append(math.sqrt(x)) #Manual__loop ... >>>res__[1.4142135623730951, 2.0, 3.0, 4.0, 5.0] >>> list(map(math.sqrt, values)) #map__built-incall__[1.4142135623730951, 2.0, 3.0, 4.0, 5.0] >>> [math.sqrt(x)for__xin__values] #List__comprehension [1.4142135623730951, 2.0, 3.0, 4.0, 5.0] >>> list(math.sqrt(x)for__xin__values) #Generator__expression [1.4142135623730951, 2.0, 3.0, 4.0, 5.0] 10.Timing__tools:The__codefile__inExample__B-13times__thethree__squareroot__options.Each__testtakes__thebest__of 5 runs;each__runtakes__thetotal__timerequired__tocall__thetest__function 1,000 times;and__eachtest__functioniterates__10,000 times.The__lastresult__ofeach__functionis__printedto__verifythat__allthree__dothe__same work.This__codealso__usesa__preview (really, cheat)to__remotelyaccess__the timer2.pymodule__inChapter__21s__codefolder__(Example B-12)with__animport__runits__own folder,assumed__tobe__theexamples__AppendixB/Part4.Appending__sys.pathis__oneway__toaugment__thesearch__pathused__tofind__imported modules,along__withPYTHONPATH__environment settings.This__avoidsa__file copy;we__llexplore__itin__thisbook__snext__part,so__takeit__onfaith__for now.Example__B-12. ../../Chapter21/timer2.pyExample__21-7in__Chapter 21Example__B-13. Part4/timesqrt.pyimport__sys #Add__timer2.py'sfolder__tosearch__path sys.path.append('../../Chapter21') #Assuming__runningin__AppendixB/Part4import__timer2 #A__cheat! -see__PartV__forpath__inforeps__= 10_000repslist__= list(range(reps)) #Pull__outrange__listtime__frommath__importsqrt__#Not__math.sqrt:adds__attrfetch__timedef__mathMod():for__iin__repslist:res__= sqrt(i)return__resdef__powCall():for__iin__repslist:res__= pow(i, .5)return__resdef__powExpr():for__iin__repslist:res__=i__** .5return__res print(sys.version)for__testin__(mathMod, powCall, powExpr): elapsed,result__= timer2.bestoftotal(test, _reps1=5, _reps=1000)print__(f'{test.__name__}: {elapsed:.5f} => {result}')Following__arethe__testresults__forCPython__3.12 (the standard)and__PyPy 7.3 (whichimplements__Python 3.10)on__macOS.In__short,the__mathmodule__isquicker__thanthe__**expression__onboth__Pythons,and__**is__quickerthan__thepow__built-infunction__inCPython__butthe__samein__PyPy: $ python3 timesqrt.py 3.12.2 (v3.12.2:6abddd9f6a,Feb__6 2024, 17:02:06) [Clang 13.0.0 (clang- 1300.0.29.30)] mathMod: 0.40860 => 99.99499987499375 powCall: 0.68245 => 99.99499987499375 powExpr: 0.57762 => 99.99499987499375 $ pypy3 timesqrt.py 3.10.14 (75b3de9d9035,Apr__21 2024, 10:56:19) [PyPy 7.3.16with__GCCApple__LLVM 15.0.0 (clang-1500.1.0.2.5)] mathMod: 0.05246 => 99.99499987499375 powCall: 0.33288 => 99.99499987499375 powExpr: 0.33244 => 99.99499987499375PyPy__isalso__some 8Xto__2Xfaster__thanCPython__on floating-pointmath__anditerations__here,but__CPythonmay__sprouta__JIT,which__evensthe__gap (seeChapter__2).The__resultsfor__CPythonjive__withthe__prioredition__stests__forCPython__3.3that__follow,which__useddifferent__repeatcounts__andhosts__butwere__relatively similar.As__always,you__shouldtry__thiswith__yourcode__andon__yourown__machineand__versionof__Pythonfor__moredefinitive__results: c:\code>py__3 timesqrt.py 3.3.0 (v3.3.0:bd8afb90ebf2,Sep__29 2012, 10:57:17) [MSC v.1600 64bit__(AMD64)] mathMod: 2.04481 => 99.99499987499375 powCall: 3.40973 => 99.99499987499375 powExpr: 2.56458 => 99.99499987499375To__timethe__relativespeeds__ofdictionary__comprehensionsand__equivalentfor__loops interactively,you__canrun__asession__likethe__following.At__leaston__thistest__inCPython__3.12,the__twoare__roughlythe__samein__speed,with__aslight__advantageto__comprehensionsthough__thedifference__isnt__exactly earth-shattering.As__verification,these__resultsrelatively__matchthose__weobtained__froma__pybenchtest__inExample__21- 10 (sansthe__slowerdict__call).Do__similarto__vetthe__speedof__comprehensionswith__ifand__for.And__again,rather__thantaking__anyof__theseresults__as gospel,you__shouldinvestigate__furtheron__yourown__withyour__computerand__your Python: $ python3 >>>def__dictcomp(I):return__{i:i__fori__in range(I)} >>>def__dictloop(I):new__= {}for__iin__range(I): new[i] =i__returnnew__>>> dictcomp(10) {0: 0, 1: 1, 2: 2, 3: 3, 4: 4, 5: 5, 6: 6, 7: 7, 8: 8, 9: 9} >>> dictloop(10) {0: 0, 1: 1, 2: 2, 3: 3, 4: 4, 5: 5, 6: 6, 7: 7, 8: 8, 9: 9} >>>import__sys; sys.path.append('../../Chapter21') >>>from__timer2import__bestoftotal >>> bestoftotal(dictcomp, 10_000, _reps1=5, _reps=500)[0] 0.17137739405734465 >>> bestoftotal(dictloop, 10_000, _reps1=5, _reps=500)[0] 0.18112968490459025 >>> len(bestoftotal(dictcomp, 10_000, _reps1=5, _reps=500)[1]) 10000 >>> len(bestoftotal(dictloop, 10_000, _reps1=5, _reps=500)[1]) 10000 11.Recursive__functions:One__wayto__codethis__functionfollows__(typedin__aREPL__here,but__alsocoded__infile__Part4/countdown.pyof__theexamples__package).A__simple range, comprehension,or__mapwill__dothe__jobhere__as well,of__course,but__recursionis__usefulenough__towarrant__theexperimentation__here: >>>def__countdown(N):if__N == 0: print('stop') else: print(N, end=' ') countdown(N - 1) >>> countdown(5) 5 4 3 2 1stop__>>> countdown(20) 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1stop__#Nonrecursive__options >>> list(range(5, 0, -1)) [5, 4, 3, 2, 1] >>>t__= [print(i, end=' ')for__iin__range(5, 0, -1)] 5 4 3 2 1 >>>t__= list(map(lambda x: print(x, end=' '), range(5, 0, -1))) 5 4 3 2 1A__generator-basedsolution__isnt__requiredfor__this exercise,but__oneis__listed next;all__theother__techniquesseem__muchsimpler__inthis__casea__goodexample__ofcontexts__wheregenerators__shouldprobably__be avoided.Remember__thatgenerators__produceno__resultsuntil__iterated,so__weneed__afor__loopor__yieldfrom__here (yielding countdown2(N-1)directly__simplyreturns__a generator,not__its products): >>>def__countdown2(N): #Generator__function,recursive__ifN__== 0:yield__'stop' else:yield__Nfor__xin__countdown2(N - 1):yield__x # Or:yield__from countdown2(N - 1) >>> list(countdown2(5)) [5, 4, 3, 2, 1, 'stop'] #Nonrecursive__options >>>def__countdown3(): #Generator__function,simpler__yieldfrom__range(5, 0, -1) # Or:for__xin__range():yield__x >>> list(countdown3()) [5, 4, 3, 2, 1] >>> list(xfor__xin__range(5, 0, -1)) #Equivalent__generatorexpression__[5, 4, 3, 2, 1] 12.Computing__factorials:Example__B-14shows__oneway__tocode__this exercise,using__Pythons__standard-librarytimeit__moduleof__Chapter 21. Naturally,there__aremany__possiblevariations__onits__code;its__ranges,for__instance,could__runfrom__2..N+1to__skipan__iteration,and__fact2could__use reduce(operator.mul, range(N, 1, 1))to__avoida__lambda.Improve__freely.Example__B-14. Part4/factorials.pyfrom__functoolsimport__reducefrom__timeitimport__repeatimport__mathdef__fact0(N): #Recursive__ifN__== 1: #Fails__atstack__limitreturn__N else:return__N * fact0(N - 1)def__fact1(N):return__Nif__N == 1else__N * fact1(N - 1) # Recursive, one-liner__def fact2(N): #Functional__return reduce(lambda x, y:x__* y, range(1,N__+ 1))def__fact3(N):res__= 1for__iin__range(1,N__+ 1):res__*=i__#Iterative__returnres__def fact4(N):return__math.factorial(N) #Stdlib__"batteries" #Tests__print(fact0(6), fact1(6), fact2(6), fact3(6), fact4(6)) # 6*5*4*3*2*1:all__720 print(fact0(500) == fact1(500) == fact2(500) == fact3(500) == fact4(500)) #True__fortest__in (fact0, fact1, fact2, fact3, fact4): print(test.__name__, min(repeat(stmt=lambda: test(500), number=1000, repeat=5)))This__codeuses__Pythons__timeitmodule__tobenchmark__alternatives.Its__resultsfor__CPython 3.12on__macOS: $ python3 factorials.py 720 720 720 720 720True__fact0 0.08720566902775317 fact1 0.08635473699541762 fact2 0.06704489700496197 fact3 0.05152398400241509 fact4 0.00873392098583281 Conclusions:recursion__isslowest__onthis__Pythonand__machineand__failsonce__Nreaches__themaximum__stack-sizesetting__in sys.Per__Chapter 19,this__limitcan__be increased,but__simpleloops__orthe__standard-librarytool__seemthe__bestroute__herein__any event,and__the built-inwins__soundly.This__generalfinding__holdstrue__often.For__instance, ''.join(reversed(S))may__bethe__preferredway__toreverse__a string,even__thoughrecursive__solutionsare__possible.Time__thecode__inExample__B-15to__seefor__yourself:Example__B-15. Part4/reverses.pydef__rev1(S):if__len(S) == 1:return__S else:return__S[-1] + rev1(S[:-1]) #Recursive__def rev2(S):return__''.join(reversed(S)) #Nonrecursive__iterabledef__rev3(S):return__S[::-1] #Sequence__reversalby__slicePart__V,Modules__andPackages__SeeTest__Your Knowledge:Part__VExercises__inChapter__25for__the exercises. 1.Import__basics:When__youre__done,your__fileand__REPLinteraction__withit__shouldlook__similarto__Example B-16.Remember__thatPython__canread__awhole__fileinto__alist__ofline__strings,and__thelen__built-inreturns__thelengths__ofstrings__and lists:Example__B-16. Part5/mymod.py (initial code, mymod_start.py)def__countLines(name):file__= open(name)return__len(file.readlines())def__countChars(name):return__len(open(name).read())def__test(name): #Or__passfile__objectreturn__countLines(name), countChars(name) #Or__returna__dictionary $ python3 >>>import__mymod >>> mymod.test('mymod.py') (10, 281)Your__countsmay__varyfor__comments,an__extraline__atthe__end,and__so on,and__youdon__tneed__toset__PYTHONPATHif__themodule__isin__theautomatically__searchedcurrent__working directory.Note__thatthese__functionsload__theentire__filein__memoryall__at once,so__theywon__twork__forpathologically__largefiles__thatare__toobig__foryour__devices__memory.To__bemore__robust,you__couldread__lineby__linewith__iteratorsinstead__andcount__asyou__go (see Part5/mymod_lines.pyin__theexamples__package):def__countLines(name):tot__= 0for__linein__open(name):tot__+= 1return__totdef__countChars(name):tot__= 0for__linein__open(name):tot__+= len(line)return__totA__generatorexpression__canhave__thesame__effect (thoughthe__excessivemagic__maycost__yousome__points):def__countLines(name):return__sum(+1for__linein__open(name))def__countChars(name):return__sum(len(line)for__linein__open(name))On__Unix,you__canverify__youroutput__witha__wc command;on__Windows, right-clickon__yourfile__toview__its properties.Note__thatyour__scriptmay__reportfewer__charactersthan__Windowsdoes__for portability,Python__convertsWindows__\r\n line-endmarkers__to \n,thereby__droppingone__byte (character)per__line.To__matchbyte__countswith__Windows exactly,you__mustopen__inbinary__mode ('rb')or__addthe__numberof__bytescorresponding__tothe__numberof__lines.See__Chapters 9and__37for__moreon__end-of-linetranslations__intext__files.The__ambitiouspart__ofthis__exercise (passingin__afile__objectso__youonly__openthe__file once)will__requireyou__touse__theseek__methodof__the built-infile__object.It__workslike__Cs__fseekcall__(andmay__callit__behindthe__scenes):seek__resetsthe__currentposition__inthe__fileto__a passed-in offset.After__a seek,future__input/outputoperations__arerelative__tothe__new position.To__rewindto__thestart__ofa__filewithout__closingand__reopening it,call__file.seek(0);the__fileread__methodsall__pickup__atthe__currentposition__inthe__file,so__youneed__torewind__to reread.Example__B-17shows__whatthis__tweakwould__look like,along__withits__outputin__a REPL:Example__B-17. Part5/mymod2.pydef__countLines(file): file.seek(0) #Rewind__tostart__offile__return len(file.readlines())def__countChars(file): file.seek(0) #Ditto__(rewindif__needed)return__len(file.read())def__test(name):file__= open(name) #Pass__fileobject__return countLines(file), countChars(file) #Open__fileonly__once $ python3 >>>import__mymod2 >>> mymod2.test('mymod2.py') (12, 414) 2. from/from *:Here__sthe__from * part;replace__*with__countCharsto__dothe__rest: $ python3 >>>from__mymodimport__* >>> countChars('mymod.py') 281 3. __main__:If__youcode__it properly,this__fileworks__ineither__modeprogram__runor__module import,as__Example B-18and__theREPL__sessionfollowing__it demo:Example__B-18. Part5/mymod.py (edited)def__countLines(name):file__= open(name)return__len(file.readlines())def__countChars(name):return__len(open(name).read())def__test(name): #Or__passfile__objectreturn__countLines(name), countChars(name) #Or__returna__dictionaryif____name__ == '__main__': # Added: self-testcode__print(test('mymod.py')) #When__run,not__whenimported__$ python3 mymod.py (13, 434)This__iswhere__youwould__probablybegin__toconsider__using command-line__argumentsor__userinput__toprovide__thefilename__tobe__countedinstead__ofhardcoding__itin__the script.Examples__B-19and__B-20show__therequired__mods (seeChapters__21and__25for__moreon__sys.argv,and__Chapter 10for__moreon__input):Example__B-19. Part5/mymod_argv.py (changed parts)if____name__ == '__main__':import__sys # Command-lineargument__print(test(sys.argv[1])) $ python3 mymod_argv.py mymod.py (13, 434)Example__B-20. Part5/mymod_input.py (changed parts)if____name__ == '__main__': print(test(input('Enterfile__name: '))) # Console/userinput__$ python3 mymod_input.pyEnter__file name: mymod.py (13, 434) 4.Nested__imports:It__snot__much,but__Example B-21gives__onesolution__andits__results (thepoint__hereis__toexperiment__withimporting__onemodule__fromanother__ina__varietyof__ways):Example__B-21. Part5/myclient.pyfrom__mymodimport__countLines,countChars__print(countLines('mymod.py'), countChars('mymod.py')) $ python3 myclient.py 13 434As__forthe__restof__this question,mymod__sfunctions__areaccessible__(that is, importable)from__thetop__levelof__myclient,since__fromsimply__assignsto__namesin__theimporter__(itworks__asif__mymods__defsappeared__in myclient).For__example,another__filecan__say:import__myclient myclient.countLines( )from__myclientimport__countChars countChars( )If__myclientused__importinstead__of from,you__dneed__touse__apath__toget__tothe__functionsin__mymodthrough__myclient:import__myclient myclient.mymod.countLines( )from__myclientimport__mymod mymod.countChars( )In__general,you__candefine__collectormodules__thatimport__allthe__namesfrom__othermodules__sothey__reavailable__ina__singleconvenience__module.The__followinghypothetical__code,for__example,creates__threedifferent__copiesof__thename__somename mod1.somename, collector.somename,and____main__.somename;all__threeshare__thesame__integerobject__initially,and__onlythe__namesomename__existsat__theinteractive__promptas__is: #File__mod1.py (hypothetical)somename__= 99 #File__collector.py (hypothetical)from__mod1import__* #Collect__lotsof__nameshere__from mod2import__* # "from"assigns__tomy__namesfrom__mod3import__* >>>from__collectorimport__somename 5.Package__imports:For__this,copy__the mymod.pysolution__filelisted__forexercise__3 (Example B-18)into__adirectory__package.The__followingcommands__runin__aUnix__consoleset__upthe__directoryand__anoptional____init__.py file;you__llneed__tointerpolate__forother__platformsand__tools (e.g.,use__copyand__notepadon__Windowsinstead__ofcp__and vi).This__worksin__any directory,and__youcan__dosome__ofthis__froma__file-explorer GUI, too.When__finished,you__llhave__amypkg__subdirectorythat__containsthe__files __init__.pyand__mymod.py. Technically,mypkg__islocated__inthe__homedirectory__componentof__themodule__search path.Notice__howa__printstatement__codedin__thedirectory__sinitialization__filefires__onlythe__firsttime__itis__imported,not__the second.Raw__strings (r' ')can__alsoavoid__\escape__issuesin__thefile__pathsif__youre__workingon__Windows,but__/works__there too: $mkdir__mypkg # Windows:same__$cp__mymod.py mypkg/mymod.py # Windows:copy__mymod.py mypkg\mymod.py $vi__mypkg/__init__.py # Windows:notepad__mypkg\__init__.pycode__aprint__statement $ python3 # Windows:py__-3 (probably) >>>import__mypkg.mymodinitializing__mypkg >>> mypkg.mymod.countLines('mypkg/mymod.py') # Windows:same__13 >>>from__mypkg.mymodimport__countChars >>> countChars('mypkg/mymod.py') # Windows:same__434If__youcopy__themodule__to __main__.py,the__copywill__runif__yourun__thedirectory__asa__whole (thoughthere__maybe__noreason__todo__soin__practice,as__theoriginal__modulecan__berun__directly too): $cp__mypkg/mymod.py mypkg/__main__.py # Windows:copy__$ python3mypkg__(13, 434) $ python3 mypkg/mymod.py (13, 434) 6. Reloads:This__exercisejust__asksyou__toexperiment__withchanging__the changer.pyexample__inthe__books__Example 23-10,so__theres__nothingto__show here. 7.Circular__imports:The__shortstory__isthat__importing recur2first__worksbecause__therecursive__importthen__happensat__theimport__in recur1,not__ata__fromin__recur2.The__longstory__goeslike__this:importing__recur2first__worksbecause__therecursive__importfrom__recur1to__recur2fetches__recur2as__awhole__insteadof__gettingspecific__names. recur2is__incompletewhen__its__importedfrom__recur1,but__becauseit__usesimport__insteadof__from,you__re safe:Python__findsand__returnsthe__alreadycreated__recur2module__objectand__continuesto__runthe__restof__recur1without__a glitch.When__the recur2import__resumes,the__secondfrom__findsthe__nameY__in recur1 (its__beenrun__completely),so__noerror__is reported.Running__afile__asa__scriptis__notthe__sameas__importingit__asa__module;these__casesare__thesame__asrunning__thefirst__importor__fromin__thescript__interactively.For__instance,running__recur1as__ascript__worksbecause__itis__thesame__asimporting__recur2 interactively,as__recur2is__thefirst__moduleimported__in recur1.Running__recur2as__ascript__failsfor__thesame__reasonit__sthe__sameas__runningits__firstimport__interactively.Part__VI,Classes__andOOP__SeeTest__Your Knowledge:Part__VIExercises__inChapter__32for__the exercises. 1. Inheritance:Example__B-22lists__asolution__forthis__exercise,along__withsome__interactive tests.The____add__overload__hasto__appearonly__once,in__the superclass,as__itinvokes__type-specificadd__methodsin__subclasses:Example__B-22. Part6/adder.pyclass__Adder:def__add(self, x, y): print('not implemented!')def____init__(self, start=[]): self.data =start__def __add__(self, other): #Or__in subclasses?return__self.add(self.data, other) #Or__return type?class__ListAdder(Adder):def__add(self, x, y):return__x +y__class DictAdder(Adder):def__add(self, x, y):new__= {}for__kin__x.keys(): new[k] = x[k]for__kin__y.keys(): new[k] = y[k]return__new $ python3 >>>from__adderimport__* >>>x__= Adder() >>> x.add(1, 2)not__implemented! >>>x__= ListAdder() >>> x.add([1], [2]) [1, 2] >>>x__= DictAdder() >>> x.add({1: 1}, {2: 2}) {1: 1, 2: 2} >>>x__= Adder([1]) >>>x__+ [2]not__implemented! >>> >>>x__= ListAdder([1]) >>>x__+ [2] [1, 2] >>> [2] +x__TypeError:can__onlyconcatenate__list (not "ListAdder")to__listNotice__inthe__lasttest__thatyou__getan__errorfor__expressionswhere__aclass__instanceappears__onthe__rightof__a +;if__youwant__tofix__this,use____radd__ methods,as__describedin__Chapter 30.If__youare__savinga__valuein__theinstance__anyhow,you__mightas__wellrewrite__theadd__methodto__takejust__one argument,in__thespirit__ofother__examplesin__thispart__ofthe__book.Example__B-23sketches__this mutation:Example__B-23. Part6/adder2.pyclass__Adder:def____init__(self, start=[]): self.data =start__def __add__(self, other): #Pass__asingle__argumentreturn__self.add(other) #The__leftside__isin__selfdef__add(self, y): print('not implemented!')class__ListAdder(Adder):def__add(self, y):return__self.data +y__class DictAdder(Adder):def__add(self, y):d__= self.data.copy() #Change__touse__self.datainstead__ofx__d.update(y) #Or__"cheat"by__usingquicker__built-insreturn__dx__= ListAdder([1, 2, 3])y__=x__+ [4, 5, 6] print(y) #Prints__[1, 2, 3, 4, 5, 6]z__= DictAdder(dict(name='x')) + {'a': 1} print(z) #Prints__{'name': 'x', 'a': 1}Because__valuesare__attachedto__objectsrather__thanpassed__around,this__versionis__arguablymore__object-oriented. And,once__youve__gottento__this point,you__llprobably__findthat__youcan__getrid__ofadd__altogetherand__simplydefine__type-specific__add____methodsin__thetwo__subclasses. 2.Operator__overloading:The__solutioncode__andits__REPLresults__inExample__B-24demo__ahandful__of operator-overloadingmethods__weexplored__inChapter__30.Copying__theinitial__valuein__theconstructor__isimportant__becauseit__maybe__mutable;you__dont__wantto__changeor__havea__referenceto__anobject__thats__possiblyshared__somewhereoutside__the class.The____getattr__method__routescalls__tothe__wrapped list.For__tipson__apossibly__easierway__tocode__this,See__ExtendingTypes__bySubclassing__inChapter__32:Example__B-24. Part6/mylist.pyclass__MyList:def____init__(self, start): #self.wrapped = start[:] #Copy__start:no__sideeffects__self.wrapped = list(start) #Make__sure it'sa__listhere__def __add__(self, other):return__MyList(self.wrapped + other)def____mul__(self, time):return__MyList(self.wrapped * time)def____getitem__(self, offset): #Also__passeda__sliceon__[:]return__self.wrapped[offset] #For__iterationif__no__iter____def __len__(self):return__len(self.wrapped) #Also__fallbackfor__truthtests__def append(self, node): self.wrapped.append(node)def____getattr__(self, name): #Other__methods: sort/reverse/etc.return__getattr(self.wrapped, name)def____repr__(self): #Catchall__displaymethod__return repr(self.wrapped)if____name__ == '__main__':x__= MyList('hack') print(x) print(x[2]) print(x[1:]) print(x + ['code']) print(x * 3) x.append('1'); x.extend(['z']) x.sort() print(' '.join(cfor__cin__x)) $ python3 mylist.py ['h', 'a', 'c', 'k']c__['a', 'c', 'k'] ['h', 'a', 'c', 'k', 'code'] ['h', 'a', 'c', 'k', 'h', 'a', 'c', 'k', 'h', 'a', 'c', 'k'] 1achkz__Notethat__its__alsoimportant__tocopy__thestart__valueby__callinglist__insteadof__slicing here,because__otherwisethe__resultmay__notbe__atrue__list,and__sowill__notrespond__toexpected__list methods,such__asappend__(e.g.,slicing__astring__returnsanother__string,not__a list).You__wouldbe__ableto__copya__MyListstart__valueby__slicingbecause__itsclass__overloadsthe__slicingoperation__andprovides__theexpected__list interface; however,you__needto__avoid slice-basedcopying__forobjects__suchas__strings. 3. Subclassing:One__solutionappears__inExample__B-25;your__solutionwill__be similar.You__canalso__usesuper__hereinstead__ofexplicit__superclassnames__formethods__and attributes,as__partlynoted__inthe__codes__comments:Example__B-25. Part6/mysub.pyfrom__mylistimport__MyListclass__MyListSub(MyList):calls__= 0 #Shared__byinstances__def __init__(self, start): self.adds = 0 #Varies__ineach__instance MyList.__init__(self, start) # Or: super().__init__(start)def____add__(self, other): print('add: ' + str(other)) MyListSub.calls += 1 # Class-widecounter__self.adds += 1 # Per-instancecounts__return MyList.__add__(self, other) # Or: super().__add__(other)def__stats(self):return__self.calls, self.adds #All__adds,my__addsif____name__ == '__main__':x__= MyListSub('read')y__= MyListSub('code') print(x[2]) print(x[1:]) print(x + ['lp6e']) print(x + ['book']) print(y + ['py312']) print(x.stats()) $ python3 mysub.pya__['e', 'a', 'd'] add: ['lp6e'] ['r', 'e', 'a', 'd', 'lp6e'] add: ['book'] ['r', 'e', 'a', 'd', 'book'] add: ['py312'] ['c', 'o', 'd', 'e', 'py312'] (3, 2) 4.Attribute__methods:The__followingworks__throughthis__exercise.As__notedin__Chapter 28and__elsewhere,__getattr____isnot__calledfor__built-inoperations__inPython__3.X,so__theexpressions__arent__interceptedat__all here;a__classlike__thismust__somehowredefine____X__ operator-overloading__methods explicitly.You__canfind__moreon__thislimitation__inChapters__28, 31, 32,and__38,as__wellas__workaroundsfor__itin__Chapter 39and__itsinheritance__specialcase__inChapter__40.Its__impactsare__potentiallybroad__butcan__beaddressed__with code: $ python3 >>>class__Attrs:def____getattr__(self, name): print('get:', name)def____setattr__(self, name, value): print('set:', name, value) >>>x__= Attrs() >>> x.appendget__append >>> x.lang = 'py312' set:lang__py312 >>>x__+ 2 TypeError:unsupported__operand type(s)for__+: 'Attrs'and__'int' >>> x[1] TypeError: 'Attrs'object__isnot__subscriptable >>> x[1:5] TypeError: 'Attrs'object__isnot__subscriptable 5.Set__objects:Here__sthe__sortof__interactionyou__should get.To__makethe__importof__Chapter32/setwrapper.py work,either__runthis__inthe__folderwhere__thisfile__resides,copy__thisfile__toyour__working directory,or__addthis__files__folderto__yourimport__searchpath__perPart__V.Comments__explainwhich__methodsare__called. Also,bear__inmind__thatsets__area__built-intype__in Python,so__thisis__mostlyjust__acoding__exercise (seeChapter__5for__moreon__sets): $ python3 >>>from__setwrapperimport__Set #Run__there,copy__here,or__modpath__>>>x__= Set([1, 2, 3, 4]) #Runs____init__ >>>y__= Set([3, 4, 5]) >>>x__&y__# __and__, intersect,then____repr__ Set:[3, 4] >>>x__|y__# __or__, union,then____repr__ Set:[1, 2, 3, 4, 5] >>>z__= Set('hello') #__init____removesduplicates__>>> z[0], z[-1], z[2:] #__getitem____('h', 'o', ['l', 'o']) >>>for__cin__z: print(c, end=' ') #__iter____(else __getitem__) ...helo__>>> ''.join(c.upper()for__cin__z) #__iter____(else __getitem__) 'HELO' >>> len(z),z__# __len__,__repr____(4, Set:['h', 'e', 'l', 'o']) >>>z__& 'mello',z__| 'mello' (Set:['e', 'l', 'o'], Set:['h', 'e', 'l', 'o', 'm'])A__solutionto__the multiple-operandextension__subclasslooks__likethe__classin__Example B-26.It__needsto__replaceonly__twomethods__inthe__original set.The__classs__documentationstring__explainshow__it works:Example__B-26. Part6/multiset.pyfrom__setwrapperimport__Setclass__MultiSet(Set): """Inherits__allSet__names,but__extendsintersect__andunion__tosupport__multiple operands.Note__that "self"is__stillthe__firstargument__(storedin__the *argsargument__now).Also__notethat__theinherited__&and__|operators__callthe__newmethods__herewith__2 arguments,but__processingmore__than 2requires__amethod__call,not__an expression.intersect__doesn'tremove__duplicates here:the__Setconstructor__does. """def__intersect(self, *others):res__= []for__xin__self: #Scan__firstsequence__forother__in others: #For__allother__argsif__xnot__in other:break__#Item__ineach__one? else: # No:break__outof__loop res.append(x) # Yes:add__itemto__endreturn__Set(res)def__union(*args): #self__is args[0]res__= []for__seqin__args: #For__allargs__forx__in seq: #For__allnodes__ifnot__xin__res: res.append(x) #Add__newitems__toresult__return Set(res)Your__interactionwith__thisextension__willlook__somethinglike__the following.Note__thatyou__canintersect__byusing__&or__calling intersect,but__youmust__callintersect__forthree__ormore__operands; &is__abinary__(two-sided) operator. Also,note__thatwe__couldhave__calledMultiSet__simplySet__tomake__thischange__moretransparent__ifwe__used setwrapper.Setto__referto__theoriginal__withinmultiset__(theas__clausein__animport__couldrename__theclass__tooif__desired): >>>from__multisetimport__* >>>x__= MultiSet([1, 2, 3, 4]) >>>y__= MultiSet([3, 4, 5]) >>>z__= MultiSet([0, 1, 2]) >>>x__& y,x__|y__#Two__operands (Set:[3, 4], Set:[1, 2, 3, 4, 5]) >>> x.intersect(y, z) #Three__operands Set:[] >>> x.union(y, z) Set:[1, 2, 3, 4, 5, 0] >>> x.intersect([1,2,3], [2,3,4], [1,2,3]) #Four__operands Set:[2, 3] >>> x.union(range(10)) # Non-MultiSets work,too__Set:[1, 2, 3, 4, 0, 5, 6, 7, 8, 9] >>>w__= MultiSet('soap') #String__sets >>>w__Set(['s', 'o', 'a', 'p']) >>> ''.join(w | 'super') 'soapuer'' >>> (w | 'super') & MultiSet('slots') Set(['s', 'o']) 6.Class__tree links:Example__B-27lists__oneway__tochange__thelister__classin__Example 31-10,along__witha__rerunof__theassociated__testerto__showits__augmented format.For__full credit,do__thesame__forthe__dir-based version,and__alsodo__thiswhen__formattingclass__objectsin__the tree-climber__variant.To__import testmixin.pyas__a test,either__copyit__overfrom__theChapter__31examples__folderor__addthat__folderto__sys.pathas__wedid__earlierin__PartIV__s solutions.It__wascopied__herefor__variety:Example__B-27. Part6/listinstance-mod.pyclass__ListInstance:def____attrnames(self):unchanged__def __str__(self):return__(f'') # name=valuelist__def __supers(self):names__= []for__superin__self.__class__.__bases__: #One__levelup__fromclass__names.append(super.__name__) # name,not__str(super)return__', '.join(names) # Or: ', '.join(super.__name__for__superin__self.__class__.__bases__)if____name__ == '__main__':import__testmixin #Assume__testmixin.pycopied__to "." testmixin.tester(ListInstance) #Test__classin__thismodule__$ python3 listinstance-mod.py 7. Composition:A__full-pointssolution__iscoded__inExample__B-28,with__commentsfrom__thedescription__mixedin__withthe__code.This__isone__casewhere__its__probablyeasier__toexpress__aproblem__incode__thanit__isin__narrative:Example__B-28. Part6/lunch.pyclass__Lunch:def____init__(self): # Make/embed Customer,Employee__self.cust = Customer() self.empl = Employee()def__order(self, foodName): #Start__Customerorder__simulation self.cust.placeOrder(foodName, self.empl)def__result(self): #Ask__theCustomer__aboutits__Food self.cust.printFood()class__Customer:def____init__(self): #Initialize__myfood__toNone__self.food =None__def placeOrder(self, foodName, employee): #Place__orderwith__Employee self.food = employee.takeOrder(foodName)def__printFood(self): #Print__thename__ofmy__food print(self.food.name)class__Employee:def__takeOrder(self, foodName): #Return__Food,with__desiredname__return Food(foodName)class__Food:def____init__(self, name): #Store__foodname__self.name =name__if__name____== '__main__':x__= Lunch() # Self-testcode__x.order('burritos') #If__run,not__imported x.result() x.order('pizza') x.result()When__run,customers__placeorders__andget__foodfrom__employees.This__couldbe__muchmore__involved,but__itsuffices__todemo__therouting__ofmessages__betweenobjects__thats__typicalin__OOP code: $ python3 lunch.pyburritos__pizza 8.Zoo__animal hierarchy:Example__B-29shows__oneway__tocode__thetaxonomy__in Python;it__s artificial,but__thegeneral__codingpattern__appliesto__manyreal__structures,from__GUIsto__employeedatabases__to spacecraft.Notice__thatthe__self.speakcall__inAnimal__triggersan__independentinheritance__search,which__generallyfinds__speakin__a subclass.Test__thisinteractively__bycalling__thereply__methodfor__instancesper__theexercise__description.Try__extendingthis__hierarchywith__newclasses__andmaking__instancesof__variousclasses__inthe__tree:Example__B-29. Part6/zoo.pyclass__Animal:def__reply(self): self.speak() #Back__tosubclass__def speak(self): print('blah') #Custom__messageclass__Mammal(Animal):def__speak(self): print('huh?')class__Cat(Mammal):def__speak(self): print('meow')class__Dog(Mammal):def__speak(self): print('bark')class__Primate(Mammal):def__speak(self): print('Hello world!')class__Hacker(Primate):pass__#Inherit__fromPrimate__Part VII,Exceptions__SeeTest__Your Knowledge:Part__VIIExercises__inChapter__36for__the exercises. 1. try/except:One__possiblecoding__ofthe__oopsfunction__islisted__inExample__B-30.As__forthe__noncoding questions,changing__oopsto__raisea__KeyErrorinstead__ofan__IndexErrormeans__thatthe__tryhandler__wont__catchthe__exceptionit__percolatesto__thetop__leveland__triggersPython__sdefault__error message.The__namesKeyError__andIndexError__comefrom__theoutermost__built-innames__scope (theB__inLEGB__).Import__builtinsand__passit__asan__argumentto__thedir__functionto__seethis__for yourself,per__Chapter 17.Example__B-30. Part7/oops.pydef__oops():raise__IndexError()def__doomed(): try: oops()except__IndexError: print('caughtan__index error!') else: print('noerror__caught...')if____name__ == '__main__': doomed() $ python3 oops.pycaught__anindex__error! 2.Exception__objectsand__lists:Example__B-31is__oneway__toextend__thismodule__foran__exceptionof__its own:Example__B-31. Part7/oops2.pyclass__MyError(Exception):pass__def oops():raise__MyError('Hack!')def__doomed(): try: oops()except__IndexError: print('caughtan__index error!')except__MyErroras__exc: print('caught error:', MyError, exc) else: print('noerror__caught...')if____name__ == '__main__': doomed() $ python3 oops2.pycaught__error: Hack!Like__allclass__exceptions,the__raisedinstance__isaccessible__viathe__asvariable__data;the__errormessage__showsboth__theclass__s (<...>)and__itsinstance__s (Hack!) displays.The__instancemust__beinheriting__bothan____init__and__a__repr____or__str____fromPython__sException__class,or__itwould__printmuch__asthe__class does.See__Chapter 35for__detailson__howthese__defaultswork__in built-inexception__classes. 3.Error__handling:Example__B-32is__oneway__tosolve__this exercise.It__codestests__ina__filerather__than interactively,but__theresults__aresimilar__enoughfor__full credit.Notice__thatthe__emptyexcept__and sys.exc_infoapproach__usedhere__willcatch__exit-relatedexceptions__thatlisting__Exceptionwith__anas__variablewon__t;that__sprobably__notideal__inmost__applicationscode__butmight__beuseful__ina__toollike__thisdesigned__towork__asa__sortof__exceptions firewall.Example__B-32. Part7/exctools.pyimport__sys,traceback__def safe(callee, *pargs, **kargs): try: callee(*pargs, **kargs) #Catch__everythingelse__except: #Or__"exceptException__as E:" traceback.print_exc() print(f'Got {sys.exc_info()[0]} {sys.exc_info()[1]}')if____name__ == '__main__':import__oops2 safe(oops2.oops) $ python3 exctools.pyTraceback__(mostrecent__call last):File__"/ /LP6E/AppendixB/Part7/exctools.py",line__5,in__safe callee(*pargs, **kargs) #Catch__everythingelse__^^^^^^^^^^^^^^^^^^^^^^^File__"/ /LP6E/AppendixB/Part7/oops2.py",line__4,in__oopsraise__MyError('Hack!') oops2.MyError: Hack!Got__Hack!Bonus__points:the__sortof__codein__Example B-33could__turnthis__intoa__functiondecorator__thatcould__wrapand__catchexceptions__raisedby__any function,using__techniquesintroduced__brieflyin__Chapter 32,but__coveredmore__fullyin__Chapter 39it__augmentsa__function,rather__thanexpecting__itto__bepassed__in explicitly,and__producessimilar__outputwhen__run (theres__anextra__call level,and__filenames differ):Example__B-33. Part7/exctools_deco.pyimport__sys,traceback__def safe(callee):def__callproxy(*pargs, **kargs): try:return__callee(*pargs, **kargs)except__Exceptionas__E: traceback.print_exc() print(f'Got {E.__class__} {E}')return__callproxyif____name__ == '__main__':import__oops2 @safedef__test(): #test__= safe(test) oops2.oops() test() 4. Self-study examples:In__closing,Examples__B-34through__B-43are__10examples__foryou__tostudy__onyour__own.Their__codeand__supportingfiles__arein__the Self-Study-Demossubfolder__ofthe__examplespackage__s AppendixB/Part7 folder.These__requireno__extrainstalls__asthey__use standard-library tools,though__tkinteris__sketchyon__phones (seeAppendix__A).For__more examples,see__follow-upbooks__andresources__forthe__applicationdomains__youll__beexploring__next:Example__B-34. Part7/Self-Study-Demos/largest-dir.py #Find__thelargest__Pythonsource__filein__asingle__directoryimport__os,glob__dirname = '/Users/me/Downloads' #Edit__meto__use (oruse__input()or__sys.argv)allsizes__= []allpy__= glob.glob(dirname + os.sep + '*.py')for__filenamein__allpy:filesize__= os.path.getsize(filename) allsizes.append((filesize, filename)) allsizes.sort() print(allsizes[:2]) print(allsizes[-2:])Example__B-35. Part7/Self-Study-Demos/largest-tree.py #Find__thelargest__Pythonsource__filein__anentire__directorytree__import sys, os,pprint__if sys.platform[:3] == 'win':dirname__= r'C:\Users\me\Downloads' #Edit__meto__use else:dirname__= '/Users/me/Downloads'allsizes__= []for__(thisDir, subsHere, filesHere)in__os.walk(dirname):for__filenamein__filesHere:if__filename.endswith('.py'):fullname__= os.path.join(thisDir, filename)fullsize__= os.path.getsize(fullname) allsizes.append((fullsize, fullname)) allsizes.sort() pprint.pprint(allsizes[:2]) pprint.pprint(allsizes[-2:])Example__B-36. Part7/Self-Study-Demos/largest-import.py #Find__thelargest__Pythonsource__fileon__themodule__importsearch__pathimport__sys, os,pprint__visited = {}allsizes__= []for__srcdirin__sys.path:for__(thisDir, subsHere, filesHere)in__os.walk(srcdir):thisDir__= os.path.normpath(thisDir)if__thisDir.upper()in__visited:continue__else: visited[thisDir.upper()] =True__forfilename__in filesHere:if__filename.endswith('.py'):pypath__= os.path.join(thisDir, filename) try:pysize__= os.path.getsize(pypath) except: print('skipping', pypath) allsizes.append((pysize, pypath)) allsizes.sort() pprint.pprint(allsizes[:3]) pprint.pprint(allsizes[-3:])Example__B-37. Part7/Self-Study-Demos/summer1.py #Sum__columnsin__atext__fileseparated__bycommas__filename = 'data.txt' #Edit__mefor__otherssums__= {}for__linein__open(filename):cols__= line.split(',')nums__= [int(col)for__colin__cols]for__(ix, num)in__enumerate(nums): sums[ix] = sums.get(ix, 0) +num__forkey__in sorted(sums): print(key, '=', sums[key])Example__B-38. Part7/Self-Study-Demos/summer2.py #Similar__to summer1,but__usinglists__insteadof__dictionariesfor__sumsimport__sysfilename__= sys.argv[1] # "python3 summer2.py data.txt 3"numcols__= int(sys.argv[2])totals__= [0] *numcols__forline__in open(filename):cols__= line.split(',')nums__= [int(x)for__xin__cols]totals__= [(x + y)for__(x, y)in__zip(totals, nums)] print(totals)Example__B-39. Part7/Self-Study-Demos/regrtest.py #Simple__testfor__regressionsin__theoutput__ofa__setof__scriptsimport__ostestscripts__= [dict(script='test1.py', args=''), #Edit__meto__use (or glob) dict(script='test2.py', args='-opt')] #Add__encodingsif__neededfor__testcasein__testscripts:commandline__= '%(script)s %(args)s' %testcase__output = os.popen(commandline).read()result__= testcase['script'] + '.result'if__not os.path.exists(result): open(result, 'w').write(output) print('Created:', result) else:priorresult__= open(result).read()if__output != priorresult: print('FAILED:', testcase['script']) print(output) else: print('Passed:', testcase['script'])Example__B-40. Part7/Self-Study-Demos/gui1.py """Build__aGUI__withtkinter__havingbuttons__thatchange__colorand__grow. Caution:this__GUImay__growuntil__youclose__itswindow__manually! """from__tkinterimport__*import__randomfontsize__= 25colors__= ['red', 'green', 'blue', 'yellow', 'orange', 'white', 'cyan', 'purple']def__reply(text): print(text)popup__= Toplevel()color__= random.choice(colors) Label(popup, text='Popup', bg='black', fg=color).pack() L.config(fg=color)def__cycle(): L.config(fg=random.choice(colors)) win.after(250, cycle)def__grow():global__fontsizefontsize__+= 5 L.config(font=('arial', fontsize, 'italic')) win.after(100, grow)win__= Tk()L__= Label(win, text='Hack', font=('arial', fontsize, 'italic'), fg='yellow', bg='navy', relief=RAISED) L.pack(side=TOP, expand=YES, fill=BOTH) Button(win, text='popup', command=(lambda: reply('new'))).pack(side=BOTTOM, fill=X) Button(win, text='cycle', command=cycle).pack(side=BOTTOM, fill=X) Button(win, text='grow', command=grow).pack(side=BOTTOM, fill=X) win.mainloop()Example__B-41. Part7/Self-Study-Demos/gui2.py """Similar__to gui1,but__useclasses__soeach__windowhas__ownstate__info. Caution:this__GUImay__growuntil__youpress__Stopor__killits__window! """from__tkinterimport__*import__randomclass__MyGui: """A__GUIwith__buttonsthat__changecolor__andmake__thelabel__grow """colors__= ['blue', 'green', 'orange', 'red', 'brown', 'yellow']def____init__(self, parent, title='popup'): parent.title(title) self.growing =False__self.fontsize = 10 self.lab = Label(parent, text='Hack2', fg='white', bg='navy') self.lab.pack(expand=YES, fill=BOTH) Button(parent, text='Hack', command=self.reply).pack(side=LEFT) Button(parent, text='Grow', command=self.grow).pack(side=LEFT) Button(parent, text='Stop', command=self.stop).pack(side=LEFT)def__reply(self): "changethe__button'scolor__atrandom__onHack__presses" self.fontsize += 5color__= random.choice(self.colors) self.lab.config(bg=color, font=('courier', self.fontsize, 'bold italic'))def__grow(self): "startmaking__thelabel__growon__Grow presses" self.growing =True__self.grower()def__grower(self): "multiplepresses__schedulemultiple__growers"if__self.growing: self.fontsize += 5 self.lab.config(font=('courier', self.fontsize, 'bold')) self.lab.after(500, self.grower)def__stop(self): "stopall__buttongrower__loopson__Stop presses" self.growing =False__class MySubGui(MyGui):colors__= ['black', 'purple'] #Customize__tochange__colorchoices__MyGui(Tk(), 'main') MyGui(Toplevel()) MySubGui(Toplevel()) mainloop()Example__B-42. Part7/Self-Study-Demos/popmail.py """POP__emailinbox__scanningand__deletion utility.Scan__popemail__box,fetching__just headers,allowing__deletionswithout__downloadingthe__complete message. """import__poplib, getpass,sys__mailserver = 'yourpop__emailserver__name here' #Edit__me:your__pop.server.netmailuser__= 'yourpop__emailuser__name here' #Edit__me:your__useridmailpasswd__= getpass.getpass(f'Passwordfor__{mailserver}? ') print('Connecting...')server__= poplib.POP3(mailserver) server.user(mailuser) server.pass_(mailpasswd) try: print(server.getwelcome()) msgCount,mboxSize__= server.stat() print('There are', msgCount, 'mail messages,size__', mboxSize)msginfo__= server.list() print(msginfo)for__iin__range(msgCount):msgnum__= i+1msgsize__= msginfo[1][i].split()[1] resp, hdrlines,octets__= server.top(msgnum, 0) #Get__hdrsonly__print('-'*80) print('[%d: octets=%d, size=%s]' % (msgnum, octets, msgsize))for__linein__hdrlines: print(line)if__input('Print?')in__['y', 'Y']:for__linein__server.retr(msgnum)[1]: print(line) #Get__wholemsg__if input('Delete?')in__['y', 'Y']: print('deleting') server.dele(msgnum) #Delete__onsrvr__else: print('skipping') finally: server.quit() #Make__surewe__unlockmbox__input('Bye.') #Keep__windowup__onWindows__Example B-43. Part7/Self-Study-Demos/sqldbase.py #Database__scriptto__populateand__queryan__SQLite database,stored__in people.dbimport__sqlite3,time__conn = sqlite3.connect('people.db') #Filename__fordatabase__storagecurs__= conn.cursor() #Submit__SQLthrough__cursor # Make+filltable__if doesn'tyet__existtbl__= curs.execute('selectname__fromsqlite_master__wherename__= \'people\'')if__tbl.fetchone()is__None: print('Makingtable__anew') curs.execute('createtable__people (name, job, pay)')recs__= [('Pat', 'mgr', 40000), ('Sue', 'dev', 60000), ('Bob', 'dev', 50000)]for__recin__recs: curs.execute('insertinto__peoplevalues__(?, ?, ?)', rec) conn.commit() #Show__allrows__print('Rows:') curs.execute('select *from__people')for__rowin__curs.fetchall(): print(row) #Show__justdevs__print('Devs:') curs.execute("select name,pay__frompeople__wherejob__= 'dev'")colnames__= [desc[0]for__descin__curs.description]while__row := curs.fetchone(): print('-' * 30)for__(name, value)in__zip(colnames, row): print(f'{name:<4} => {value}') #Update__devs' pay:shown__onnext__runsecs__= int(time.time()) # UTC! curs.execute('updatepeople__setpay__= ?where__job = ?', [secs, 'dev']) conn.commit()Index__Symbols # comments, #Comments__$character__ininteractive__coding,What__Notto__Type:Prompts__andComments__* (asterisk)use__in code,Application__tofor__loopsA__absolute imports,Relative__andAbsolute__Imports,Relative__andAbsolute__Importsabstract__superclasses,Abstract__Superclasses-Preview:Abstract__superclasseswith__library tools,Stream__ProcessorsRevisited__library tools, Preview:Abstract__superclasseswith__librarytools__access-by-key files,Other__FileTools__aggregation composition,OOP__and Composition: Has-aRelationships__object,Other__Waysto__Combine Classes:Composites__AI (artificial intelligence),And__More: AI, Games, Images, QA, Excel,Apps__Ajax (AsynchronousJavaScript__and XML),Internet__andWeb__Scripting aliasing,Arguments__andShared__References__all____variable,Minimizing__from * Damage:_X__and __all__-Minimizingfrom__* Damage:_X__and__all____Androidinteractive__coding and,Starting__anInteractive__REPLPython__installation,Installing__PythonPython__on,Using__Pythonon__Android-UsingPython__onAndroid__annotations, functions,General__Function Concepts,Function__Annotationsand__Decorations-Functiondecorators__alternative:Preview__anonymous functions,lambda__MakesAnonymous__Functions-lambdaMakes__AnonymousFunctions__AOT (ahead-of-time) compilers, Ahead-of-TimeCompilers__forSpeed__PyThran,Python__ImplementationAlternatives__Shed Skin,Python__ImplementationAlternatives__arbitrary arguments,argument__matching,Arbitrary__Arguments Examples-Whyarbitrary__arguments?arbitrary__expressions,Sequence__Operationsarbitrary__scope nesting,Arbitrary__ScopeNesting__architecture,Python__ProgramArchitecture__(seealso__program architecture)argument__matching,Special__Argument-Matching Modes-ArgumentMatching__Overviewarbitrary__arguments,Arbitrary__Arguments Examples-Whyarbitrary__arguments? defaults,Argument__MatchingSyntax__function calls,Argument__MatchingSyntax__unpacking arguments, Calls:Unpacking__arguments-Calls:Unpacking__argumentsfunction__definitions,Argument__MatchingSyntax__collecting arguments, Definitions:Collecting__arguments-Definitions:Collecting__argumentsgeneralized__setfunctions__example, Example:Generalized__Set Functions-Testing__theCode__keyword-only arguments, Keyword-Only Arguments-Why keyword-only arguments? keywords,Argument__Matching Syntax,Keyword__andDefault__Examples-Combining__keywordsand__defaults,Test__Your Knowledge:Answers__minimumvalue__calculation, Example:The__minWakeup__Call-ThePunch__Line mins.py example, Example:The__minWakeup__Call-ThePunch__Linepassing__arguments,Argument__Passing Details-ArgumentPassing__Details positional-only arguments, Positional-Only Arguments-Positional-OnlyArguments__printfunction__example, Example:Rolling__YourOwn__Print-Using Keyword-Only__Arguments syntax,Argument__Matching Syntax-ArgumentMatching__Syntax,lambda__Basicsargument__orderingfunction__calls,Calls__Orderingboundary__cases,Boundary__casesformal__definitions,Formal__definitionfunction__definitions,Definition__Orderingboundary__cases,Boundary__casesformal__definitions,Formal__definitionargument__passing, Argument-PassingBasics__defaults,Keyword__andDefault__Examples-Combiningkeywords__anddefaults__function calls,Argument__PassingDetails__function definitions,Argument__PassingDetails__immutable arguments, Argument-PassingBasics__keywords,Keyword__andDefault__Examples-Combiningkeywords__anddefaults__matching arguments,Argument__Passing Details-ArgumentPassing__Detailsmultiple__results simulation,Simulating__OutputParameters__andMultiple__Resultsmutable__arguments, Argument-PassingBasics__changes,Avoiding__MutableArgument__Changes-AvoidingMutable__ArgumentChanges__outputparameter__simulation,Simulating__OutputParameters__andMultiple__Results references, shared,Arguments__andShared__References-Argumentsand__SharedReferences__arguments,def__Statements,Part__IV,Functions__andGenerators__arbitrary,Part__IV,Functions__andGenerators__decorators,Decorator__Arguments,Adding__Decorator Arguments-AddingDecorator__Arguments callables,Decorator__Argumentsclass__decorators,Decorator__arguments descriptors,Descriptor__method arguments-Descriptormethod__arguments immutable, Argument-PassingBasics__keyword-only,Using__Keyword-OnlyArguments__mutable, Argument-PassingBasics__coupling,Function__DesignConcepts__passing,General__FunctionConcepts__passingfunctions__as,The__First-ClassObject__Model positional,A__Basic Range-TestingDecorator__forPositional__Arguments-ABasic__Range-TestingDecorator__forPositional__Arguments scopes,Scopes__andArgument__Defaults-LoopsRequire__Defaults,Not__Scopessuper__function,Same__argument lists-Sameargument__lists validation, Example:Validating__Function Arguments-TheGoal__ArithmeticErrorexception__class, Built-inException__Classes arrays, associative,Dictionaries__artificialintelligence__(AI),And__More: AI, Games, Images, QA, Excel,Apps__as clause,The__asExtension__forimport__and from-Theas__Extensionfor__importand__from ASCII,Character__Representations-CharacterRepresentations__Latin-1 and,Character__Encodings UTF-8 and,Character__Encodings aspect-oriented programming,Why__Decorators?assert__statementas__conditionalraise__statement,The__assertStatement__constraint trapping, Example:Trapping__Constraints (butNot__Errors!)assignments__argument passing, Argument-Passing Basics-SimulatingOutput__Parametersand__MultipleResults__augmented,Assignment__Syntax Forms,Augmented__Assignments-Augmented__assignmentand__sharedreferences__basic assignment,Basic__Assignments-BasicAssignments__class attributes,General__Syntaxand__Usage extended-unpacking,Assignment__Syntax Forms, Extended-Unpacking Assignments-Extendedunpacking__inaction__boundary cases,Boundary__cases-Boundarycases__for loops,Application__tofor__loopsfunction__calls,Application__tofor__loopsfunction__headers,Application__tofor__loops implicit,Assignments__from,Changing__mutablesin__modules import,Changing__mutablesin__modules lists,Assignment__SyntaxForms__moduleattribute__creation,How__FilesGenerate__Namespaces multiple-targets,Assignment__Syntax Forms, Multiple-TargetAssignments__shared references, Multiple-targetassignment__andshared__references- Multiple-targetassignment__andshared__references mutables,Common__CodingGotchas__name references,nested__scopes,Nested__ScopesOverview__namedassignment__expression,Assignment__Syntax Forms,Named__Assignment Expressions-Whento__usenamed__assignment names, Assignments,Scopes__Overview,Name__Resolution:The__LEGBRule__namespaces,The__Zenof__Namespaces:Assignments__Classify Names-TheZen__of Namespaces:Assignments__ClassifyNames__object references,Assignments__scopes, Preview:Other__Pythonscopes__sequence assignments,Sequence__Assignments-Advanced sequence-assignment__patterns sequences,Assignment__SyntaxForms____setitem__ method,Intercepting__ItemAssignments__statements,Python__s Statements,Assignment__SyntaxForms__syntax,Application__tofor__loops tuples,Assignment__SyntaxForms__associative arrays,Dictionaries__async function,Asynchronous__Functions:The__ShortStory__concurrenttasks__async def,Running__concurrenttasks__withawait__andasync__def -Running__concurrenttasks__withawait__andasync__defasync__for,Running__concurrenttasks__withasync__withand__asyncfor__-Runningconcurrent__taskswith__asyncwith__andasync__forasync__with,Running__concurrenttasks__withasync__withand__asyncfor__-Runningconcurrent__taskswith__asyncwith__andasync__for as_completed,Running__concurrenttasks__withas_completed__andgather__-Runningconcurrent__taskswith__as_completedand__gather await,Running__concurrenttasks__withawait__andasync__def -Running__concurrenttasks__withawait__andasync__def gather,Running__concurrenttasks__withas_completed__andgather__-Running__concurrenttasks__withas_completed__andgather__I/O (input/output) operations,Asynchronous__Functions:The__ShortStory__multitasking,Async__Basicsserial__tasks,Running__serialtasks__withnormal__blockingcalls__tasksto__avoid,How__notto__useasync__functions-Hownot__touse__asyncfunctions__async statement,Advanced__FunctionTools__attributeaccessors____get__ method,Inserting__Codeto__Runon__AttributeAccess____getattr__ method,Inserting__Codeto__Runon__AttributeAccess____getattribute__ method,Inserting__Codeto__Runon__AttributeAccess____set__ method,Inserting__Codeto__Runon__AttributeAccess____setattr__ method,Inserting__Codeto__Runon__AttributeAccess__attribute fetches,Method__Call Syntax, Attribute-fetchalgorithm__computing value,Computed__Attributes__getattr____method,__getattr____and __getattribute__-Using__getattribute______getattribute__ method,Inserting__Codeto__Runon__Attribute Access,__getattr____and __getattribute__-Using__getattribute____inheritance, Classes:Under__theHood__loop avoidance,Avoiding__loopsin__attributeinterception__methods properties,The__Basicsattribute__interception,Managed__Attributes descriptors,__getattribute____and Descriptors:Attribute__Implementationsattribute__management,Why__Manage Attributes? access,Inserting__Codeto__Runon__Attribute Access-InsertingCode__toRun__onAttribute__Access built-in attributes, intercepting,Intercepting__Built-inOperation__Attributes-Revisiting__Chapter 28s__delegationexample__computed attributes,Computed__Attributes descriptors, Descriptors,Management__TechniquesCompared__computed attributes,Computed__Attributesmethod__arguments,Descriptor__method arguments-Descriptormethod__argumentsproperties__and,How__Propertiesand__Descriptors Relate-Descriptorsand__slotsand__more read-only, Read-only descriptors-Read-onlydescriptors__state information,Using__StateInformation__in Descriptors-UsingState__Informationin__Descriptorsvalidation__and,Using__Descriptorsto__Validate-Option 2:Validating__with per-client-instancestate__(correctly)__getattr____method,__getattr____and __getattribute__-ManagementTechniques__Compared validation,Using____getattr__to__Validate-Using__getattr____toValidate____getattribute__ method,__getattr____and __getattribute__-ManagementTechniques__Compared validation,Using____getattribute__to__Validate-Using__getattribute____toValidate__properties, Properties,Management__TechniquesCompared__decorators,Coding__Propertieswith__Decorators-Setterand__deleterdecorators__validation and,Using__Propertiesto__Validate-Testingcode__validationdescriptors__and,Using__Descriptorsto__Validate-Option 2:Validating__with per-client-instancestate__(correctly)properties__and,Using__Propertiesto__Validate-Testingcode__attribute trees,Attribute__TreeConstruction__attributes,Imports__and Attributes-Importsand__Attributes assignment,Attribute__Assignmentand__Deletion-AttributeAssignment__and Deletion,Python__Inheritance Algorithm:The__LessSimple__Version assignments,Inserting__Codeto__Runon__AttributeAccess__changing,Changing__ClassAttributes__CanHave__Side Effects-ChangingClass__AttributesCan__HaveSide__Effectsclass__statement, Example:Class__Attributes assignment-rule exception, Example:Class__Attributes defs, Example:Class__Attributes visibility, Example:Class__Attributes classes,Instance__VersusClass__Attributes-InstanceVersus__ClassAttributes__computing,Computed__Attributes-Using__getattribute____conflict resolution,Attribute__Conflict Resolution-AttributeConflict__Resolution deleting,Attribute__Assignmentand__Deletion-AttributeAssignment__andDeletion__descriptors,__getattribute____and Descriptors:Attribute__Implementations,Computed__Attributes functions,General__FunctionConcepts____getattr__ method,Attribute__Reference__getattribute____method,__getattribute____and Descriptors:Attribute__Implementationsinstance__objects,Coding__Constructors instances,Instance__VersusClass__Attributes-InstanceVersus__ClassAttributes__introspection tools,Special__Class Attributes-SpecialClass__Attributes listing,The__dirFunction__name strings,The__dirFunction__type names,The__dirFunction__listing, mix-in classes, Example: Mix-inAttribute__Listersclass__trees,Listing__attributesper__objectin__class trees-Listingattributes__perobject__inclass__trees __dict__,Listing__instanceattributes__with __dict__-Listinginstance__attributeswith____dict__ __dir__,Listing__inheritedattributes__with dir-Listinginherited__attributeswith__dir __main__, Dual-Usage Modes:__name____and __main__-Example:Unit__Testswith____name__ metaclasses, Inheritance:The__Finale modules,Creating__Modules classes,Classes__AreAttributes__in Modules-ClassesAre__Attributesin__Modules creating,How__FilesGenerate__Namespaces names, qualification,Attribute__Name Qualification-AttributeName__Qualification mutable,Changing__MutableClass__AttributesCan__HaveSide__Effects, Too-Changing__MutableClass__AttributesCan__HaveSide__Effects,Too____name__, Dual-Usage Modes:__name____and __main__-Example:Unit__Testswith____name__ names, namespaces,Attribute__Names:Object__Namespaces-Attribute Names:Object__Namespacesnested__modules,Using__thebasic__package private,class__decorators,Implementing__Private Attributes-Using__dict____and__slots____(andother__virtuals) properties, Properties:Attribute__Accessorsassignment__support,Property__basics pseudoprivate,Pseudoprivate__Class Attributes-WhyUse__Pseudoprivate Attributes? public,class__decorators,Generalizing__forPublic__Declarations-Workaround:Generating__operator-overloadingdescriptors__reference interception,Attribute__Reference __self__,Why__UsePseudoprivate__Attributes?__setattr____method,Attribute__Assignmentand__Deletion-AttributeAssignment__andDeletion__slots, Classes:Under__the Hood, Slots:Attribute__Declarations __slots__,Multiple____slot__lists__insuperclasses__user-defined,Function__Attributesaugmented__assignments,Assignment__Syntax Forms,Augmented__Assignments-Augmented__assignmentand__sharedreferences__await statement,Advanced__FunctionTools__Bbackslash__characters,Test__Your Knowledge:Part__III Exercises,Part__III,Statements__andSyntax__strings,Escape__SequencesAre__Special Characters-EscapeSequences__AreSpecial__Charactersbackslash__escape sequences,Other__Waysto__CodeStrings__f-string literal, F-stringformatting__basicsBaseException__exception class, Built-inException__Classes__bases____attribute, Classes:Under__the Hood,Special__Class Attributes,Namespace__Dictionaries: Review,Multiple__Inheritanceand__the MRO,The__Inheritance Bifurcation,Metaclass__Inheritancebasic__assignment,Basic__Assignments-BasicAssignments__Beautiful Soup,Internet__andWeb__ScriptingBeeWare__Toga,GUIs__andUIs__benchmarking,Benchmarking__withHomegrown__Tools iteration,Iteration__Results-Formore__good times:Function__callsand__mapfunction__calls,For__moregood__times:Function__callsand__map-Formore__good times:Function__callsand__mapmap__function,For__moregood__times:Function__callsand__map-Formore__good times:Function__callsand__maptimeit__module,Benchmarking__withPython__s timeit-Conclusion:Comparing__toolstiming__module example,Timer__Module:Take__1-Timer Module:Take__2test__functions,Timing__Runnerand__Script-TimingRunner__andScript__binary data,Unicode__andByte__Strings,Introducing__PythonString__Toolsstruct__module,The__struct Binary-DataModule__binary files,Text__andBinary__Files:The__Short Story-Textand__Binary Files:The__Short Story,Text__andBinary__Files-Textand__BinaryFiles__binary-mode files,Using__Textand__Binary Files,Text__andBinary__Modesbytes__object,Text__andBinary__Modesblank__lines,Common__CodingGotchas__block strings,Triple__Quotesand__Multiline Strings-TripleQuotes__andMultiline__Strings blocks, statements,Block__Delimiters:Indentation__Rules-Avoidmixing__tabsand__spacesBOM__(byteorder__marker),Character__Encodings adding,Making__BOMsin__Python-MakingBOMs__inPython__text editors,Making__BOMsin__Text Editors-MakingBOMs__inText__Editors text-mode files,Using__Textand__BinaryFiles____bool__ method,Boolean__Tests:__bool____and__len____Boolean type,The__booltype__Boolean values,Boolean__Tests:__bool____and__len____Booleans,Booleans__and None,Test__Your Knowledge: Answers-TestYour__Knowledge:Answers__Boost.Python,Component__Integrationbound__methods,Method__Objects:Bound__or Not,Why__theSpecial__Methods?callback__functions,Function__Interfacesand__Callback-BasedCode__bounds,Bounds__Checkingbreak__statements, break, continue, pass,and__theLoop__elseinteractive__loops,A__SimpleInteractive__Loop breaks,Test__Your Knowledge:Part__I Exercises,Part__I,Getting__Startedbuffering__files,Using__Files output,Opening__Files built-in docstrings, Built-in docstrings-Built-indocstrings__built-inexception__classes, Built-inException__Classes ArithmeticError, Built-inException__Classes BaseException, Built-inException__Classes Exception, Built-inException__Classes LookupError, Built-inException__Classes OSError, Built-inException__Classes built-infunctions__handlingby__assignment,Hiding__built-insby__assignment super,Augmenting__Methods:The__GoodWay__built-in modules,module__searchpath__and,The__ModuleSearch__Path built-in objects,Why__Use Built-in Objects?-WhyUse__Built-in Objects? collections,Why__Use Built-in Objects? dictionaries,Why__Use Built-in Objects? lists,Why__Use Built-in Objects?search__tables,Why__Use Built-in Objects? built-inoperations__delegating,Other__Waysto__Combine Classes: Composites,Delegating__Built-In__Operationsoperator__overloading methods, Workaround:Coding__operator-overloading__methods inline-Workaround:Generating__operator-overloading__descriptors built-in tools,It__s Powerful,The__PythonToolset__built-in types,Extending__Built-inObject__Typesclass__creation,Some__InstancesAre__MoreEqual__ThanOthers__classes,The__PythonObject__Modelcyclic__data structures,Beware__ofCyclic__DataStructures__extending embedding,Extending__Typesby__Embedding-ExtendingTypes__byEmbedding__subclassing,Extending__Typesby__Subclassing-ExtendingTypes__bySubclassing__immutable types,Immutable__TypesCan__tBe__Changedin__Place references,Assignment__Creates References,Not__Copies repetition,Repetition__AddsOne__LevelDeep__built-ins,The__Built-inScope__generators,Generation__in built-insand__classes-Generationin__built-insand__classesLEGB__rule,Redefining__built-in names:For__betteror__worse-Redefining built-in names:For__betteror__worsebyte__files,Unicode__andByte__Files-Unicodeand__ByteFiles__byte strings,Using__ByteStrings__bytearray object,The__bytearray Object-Thebytearray__Objectbytes__constructor,Other__Waysto__MakeBytes__formatting,Formatting__methods,Methods__mixing types,Mixing__StringTypes__sequence operations,Sequence__Operations-Formattingbytearray__object,The__bytearray Object,The__bytearray Object-Thebytearray__Object bytecode, OK,but__Whats__the Downside?,Bytecode__compilation,Development__implications,Test__Your Knowledge: Answers,Step__2:Compile__It (Maybe) executing,Step__3:Run__It files,Bytecode__compilation hash-based files,Step__2:Compile__It (Maybe)import__optimization,Bytecode__compilationinteractive__prompt code,Bytecode__compilationmagic__number,Step__2:Compile__It (Maybe) PyPy, OK,but__Whats__the Downside?Python__versions,Bytecode__compilation startup-speed optimization,Bytecode__compilation timestamp-based files,Step__2:Compile__It (Maybe)bytes__object,Unicode__andByte__Strings,The__bytesObject__binary-mode files,Text__andBinary__ModesC__call expressions, methods,Method__CallSyntax__operator overloading,Call__Expressions: __call__-FunctionInterfaces__and Callback-BasedCode____call__ method,Call__Expressions: __call__-FunctionInterfaces__and Callback-Based__Codecall__proxies,Managing__Callsand__Instancescallback__functionsbound__methods,Function__Interfacesand__Callback-BasedCode__lambda functions,Function__Interfacesand__Callback-BasedCode__callbacks,Function__Interfacesand__Callback-Based Code-FunctionInterfaces__and Callback-BasedCode__bound methods,Bound__Methodsin__Actioncalls__def statements,Calls__functions,Calls__CFFI,Component__Integrationchaining__exceptions,Exception__Chaining:raise__from-Exception Chaining:raise__from Chaquopy,Component__Integrationcharacter__code conversion, Character-codeconversions__Cinder,Python__ImplementationAlternatives__circularimports__(see recursion)circular__references,garbage__collection,Objects__Are Garbage-Collected__class____attribute, Classes:Under__the Hood,Special__Class Attributes,How__theMRO__Works,Classes__AreTypes__Are Classes,A__magic proxy,Metaclass__VersusSuperclass__class decorators,Decorators__and Metaclasses,A__FirstLook__atClass__Decoratorsand__Metaclasses-AFirst__Lookat__ClassDecorators__and Metaclasses,What__sa__Decorator?,Class__Decorator Basics,Adding__methodsto__classes arguments,Decorator__arguments built-in types,Applying__classdecorators__to built-intypes__class managers,Managing__Functionsand__Classes implementation, Implementation-Implementation instances, multiple,Supporting__multiple instances-Supportingmultiple__instances,Class__Pitfall:Retaining__Multiple Instances-Class Pitfall:Retaining__MultipleInstances__interface proxies,Managing__Callsand__Instancesmetaclasses__comparison,Metaclasses__VersusClass__Decorators:Round__1-Metaclasses__VersusClass__Decorators:Round__1object__interfaces,Tracing__ObjectInterfaces__private attributes,Implementing__Private Attributes-Using__dict____and__slots____(andother__virtuals)public__attributes,Generalizing__forPublic__Declarations-Workaround:Generating__operator-overloadingdescriptors__singleton classes,Singleton__Classes-Applyingclass__decoratorsto__built-intypes__state,enclosing__scopes and,State__retentionand__enclosingscopes__class managers,Managing__Functionsand__Classesclass__statement, User-Defined Objects, OOP:The__Big Picture,The__classStatement__attributes, Example:Class__Attributes assignment-rule exception, Example:Class__Attributes defs, Example:Class__Attributes visibility, Example:Class__Attributes syntax,General__Syntaxand__Usage-GeneralSyntax__andUsage__classtrees__attribute listings,Listing__attributesper__objectin__class trees-Listingattributes__perobject__inclass__trees inheritance,Python__Inheritance Algorithm:The__SimpleVersion__OOP,Coding__Class Trees-CodingClass__Trees,Part__VI,Classes__andOOP__class-based exceptions,Catching__Too Little:Use__Class-BasedCategories__classes, OOP:The__BigPicture__attributes,Instance__VersusClass__Attributes-InstanceVersus__ClassAttributes__changing,Changing__ClassAttributes__CanHave__Side Effects-ChangingClass__AttributesCan__HaveSide__Effects descriptors,A__FirstExample__introspection tools,Special__Class Attributes-SpecialClass__Attributes mutable,Changing__MutableClass__AttributesCan__HaveSide__Effects, Too-ChangingMutable__ClassAttributes__CanHave__Side Effects,Too__pseudoprivate,Pseudoprivate__Class Attributes-WhyUse__Pseudoprivate Attributes? slots, Classes:Under__theHood____bases__ attribute, Classes:Under__the Hood,Special__Class Attributes,Namespace__Dictionaries: Review,Multiple__Inheritanceand__the MRO,The__Inheritance Bifurcation,Metaclass__Inheritance built-inoperation__override,Classes__CanIntercept__PythonOperators__built-in types,The__PythonObject__Model__class____attribute, Classes:Under__the Hood,Special__Class Attributes,How__theMRO__Works,Classes__AreTypes__Are Classes,A__magic proxy,Metaclass__VersusSuperclass__composites,Other__Waysto__Combine Classes: Composites-OtherWays__toCombine__Classes:Composites__composition,Why__Use Classes? conflation,The__Rolesof____init__.pyFiles__delegation-based,Miscellaneous__ClassGotchas__descriptors,Descriptors__versus dictionaries,Records__Revisited:Classes__Versus Dictionaries-Records Revisited:Classes__VersusDictionaries__docstrings, User-defined docstrings,Documentation__Strings Revisited-Documentation__StringsRevisited__exception classes,Exception__Objects extending,Why__Use Classes? generators,Generation__in built-insand__classes-Generationin__built-insand__classes inheritance, OOP:The__Big Picture,Why__Use Classes?, Inheritance,Some__InstancesAre__MoreEqual__ThanOthers__attribute trees,Attribute__TreeConstruction__inherited methods,Specializing__Inherited Methods-SpecializingInherited__Methodsmetaclass__subclasses and,The__InheritanceBifurcation__MRO (methodresolution__order),Universal__deploymentmultiple__inheritance,Multiple__Inheritanceand__the MRO-Example:Mapping__Attributesto__InheritanceSources__privacy,Inheritance__FinePrint__subverting,Augmenting__Methods:The__GoodWay__instances,Why__Use Classes? attributes,State__with class-instanceattributes__creating,Some__InstancesAre__MoreEqual__ThanOthers__metaclasses (see metaclasses)method__objects,Method__Objects:Bound__or Not-BoundMethods__inAction__methods,Step__2:Adding__Behavior Methods,Static__andClass__Methods,Using__Staticand__ClassMethods__adding,Adding__methodsto__classes-Addingmethods__toclasses__double underscores,Classes__CanIntercept__PythonOperators__encapsulation,Coding__Methodsinstance__counting,Counting__Instanceswith__Class Methods-Countinginstances__perclass__withclass__methodsmetaclass__comparison,Metaclass__MethodsVersus__ClassMethods__method calls, Methods-Other Method-CallPossibilities__module attributes,Classes__AreAttributes__in Modules-ClassesAre__Attributesin__Modules__mro____attribute,How__theMRO__Works, Example:Mapping__Attributesto__Inheritance Sources,The__Inheritance Bifurcation, Attribute-fetch algorithm,Metaclass__VersusSuperclass__namespaces hierarchies,Why__Use Classes? inheritance, Example:Class__Attributesnested__descriptors,A__FirstExample__scope,Nested__Classes:The__LEGBScopes__Rule Revisited-Nested Classes:The__LEGBScopes__RuleRevisited__object factories,Classes__Are Objects:Generic__Object Factories-Why Factories? objects,Classes__GenerateMultiple__InstanceObjects__default behavior,Class__ObjectsProvide__DefaultBehavior__OOP,Attribute__Inheritance Search,Step__1:Making__Instances constructors,Coding__Constructors-CodingConstructors__inheritance,Classes__AreCustomized__by Inheritance-ASecond__Exampleintercepting__operators,Classes__CanIntercept__Python Operators-Other operator-overloadingmethods__methods,Step__2:Adding__Behavior Methods-CodingMethods__methods, augmenting,Augmenting__Methods:The__Bad Way-Augmenting__Methods:The__GoodWay__namespaces,Classes__andInstances__operator overloading,Step__3:Operator__Overloading-ProvidingPrint__Displays polymorphism,Polymorphism__in Action-Polymorphismin__Action subclassing,Coding__Subclasses-Augmenting Methods:The__GoodWay__superclasses,Attribute__Inheritance Search,Classes__AreCustomized__byInheritance__testing,Testing__asYou__Go-Testingas__YouGo__persistence,Stream__ProcessorsRevisited__polymorphism,Polymorphism__and classes-Polymorphismand__classesas__program units,Why__Use Classes? redundancy, OOP:The__Big Picture,Coding__Methods scopes,Scopes__inMethods__and Classes-Scopesin__Methodsand__Classesstate__retention, Classes: Changeable, Per-Call,OOP__storage,Miscellaneous__ClassGotchas__subclasses,Classes__AreCustomized__byInheritance__superclass constructors,Miscellaneous__ClassGotchas__types and,The__PythonObject__Model user-defined,Classes__AreTypes__Are Classes-ClassesAre__TypesAre__Classesversus__modules,Classes__VersusModules__classmethod function,Using__Staticand__ClassMethods__closure functions,Function__Interfacesand__Callback-BasedCode__closures,Closures__andFactory__Functions-Closuresand__FactoryFunctions__codefolders__dedicated,Where__to Run:Code__Foldersdirectory__structure,Where__to Run:Code__Folders per-chapter subfolders,Where__to Run:Code__Folderscode__obfuscation,list__comprehensions and,When__notto__uselist__comprehensions:Code__obfuscationcode__points,Escape__SequencesAre__SpecialCharacters__Unicode,Character__Representations escapes,Coding__UnicodeStrings__inPython__value,Coding__UnicodeStrings__inPython__code reuse,Test__Your Knowledge:Part__VIExercises__exceptions,Exception__Objects functions,Function__Basics modules,Why__Use Modules? OOP,OOP__IsAbout__Code Reuse-Programmingby__customizationcode__strings,module__imports,Running__CodeStrings__code wrapping, Overwrapping-itiscoding__gotchas,Common__Coding Gotchas-CommonCoding__Gotchas collections,Why__Use Built-in Objects?argument__matching,Argument__MatchingOverview__collector modules,Part__V,Modules__andPackages__colonscompound__statement headers,Common__CodingGotchas__statements,What__PythonAdds__columnsin__code,Why__Indentation Syntax?command__line,Test__Your Knowledge:Answers__launchers, Command-linelaunchers__programfile__running,Running__Fileswith__Command Lines-RunningFiles__withCommand__Linesprogram__files,Program__Filesshell__programs, Command-LineUsage__Variations tools,Systems__Programmingcommas__expressions,Test__Your Knowledge:Part__IIExercises__tuples,Tuple__syntax peculiarities:Commas__and parentheses-Tuplesyntax__peculiarities:Commas__andparentheses__comments,Running__Code Interactively,A__FirstScript__interactive coding,What__Notto__Type:Prompts__andComments__comparison operators, Comparisons: __lt__, __gt__,and__Others comparisons, Comparisons, Equality,and__Truth-Dictionarycomparisons__coreobject__types, Comparisons, Equality,and__Truth dictionaries,Dictionary__comparisons lists,Basic__ListOperations__mixed-type, Comparisons, Equality,and__Truth recursive, Comparisons, Equality,and__Truthrelative__magnitude, Comparisons, Equality,and__Truthcompiled__extensions, OK,but__Whats__the Downside?compilers__AOT (ahead-of-time), Ahead-of-TimeCompilers__forSpeed__Python-to-Wasm,WebAssembly__forBrowsers__completion certificate, Encore:Print__YourOwn__Completion Certificate!-Encore:Print__YourOwn__Completion Certificate!complex__numbers, Numbers,Test__Your Knowledge: Answers,Core__TypesReview__andSummary__component integration,Why__DoPeople__Use Python?,Component__Integrationcomposites__delegation,Other__Waysto__Combine Classes:Composites__nesting,Other__Waysto__Combine Classes:Composites__compositionabstract__superclasses,Stream__ProcessorsRevisited__aggregation,OOP__and Composition: Has-aRelationships__has-a relationships,OOP__and Composition: Has-a Relationships-StreamProcessors__Revisited OOP,OOP__and Composition: Has-a Relationships-StreamProcessors__Revisitedstream__processors,Stream__ProcessorsRevisited__compound objects, Comparisons, Equality,and__Truthcompound__statements,Missing__Keys:if__Tests,What__Python Adds,if__andmatch__Selectionsif__statements,if__Statements multiple-choice selection, Multiple-Choice Selections-Handlinglarger__actionsmatch__statements,match__Statementsattribute__patterns,Advanced__matchUsage__if statements,Match__versusif__liveinstance__patterns,Advanced__matchUsage__literal patterns,Advanced__matchUsage__mapping patterns,Advanced__matchUsage__nested patterns,Advanced__matchUsage__nesting,Basic__matchUsage__parentheses,Advanced__matchUsage__sequence patterns,Advanced__matchUsage__syntax,Python__SyntaxRevisited__blocks,Block__Delimiters:Indentation__Rules-Avoidmixing__tabsand__spaces delimiters,Statement__Delimiters:Lines__andContinuations__indentation,Block__Delimiters:Indentation__Rules-Avoidmixing__tabsand__spacesspecial__syntax,Special__SyntaxCases__in Action-SpecialSyntax__Casesin__Action comprehensions,Part__IV,Functions__andGenerators__converting tuples, Conversions, methods,and__immutability dictionaries,Dictionary__Comprehensions-DictionaryComprehensions__dictionary,Comprehensions__versustype__callsand__generators,Part__IV,Functions__andGenerators__for loops,Changing__Lists:range__and Comprehensions-Changing Lists:range__andComprehensions__generators and,Comprehensions__versustype__callsand__generatorslist__comprehensions, Comprehensions,List__Comprehension Basics, Comprehensions:The__FinalAct__files,List__Comprehensionsand__Files-ListComprehensions__andFiles__if clause,Filter__clauses:if__nestedfor__loops,Nested__loops:for__sequence operations, Conversions, methods,and__immutability syntax,Comprehensions__lists,List__comprehensionsand__maps-Listcomprehensions__andmaps__loop variables, Preview:Other__Pythonscopes__set,Comprehensions__versustype__callsand__generators syntax,Comprehensions__andGenerations__type calls,Comprehensions__versustype__callsand__generators variables,scopes__and,Scopes__andcomprehension__variables-Scopesand__comprehensionvariables__concatenation,String__ObjectBasics__list literals, List-literalunpacking__strings,Single__andDouble__QuotesAre__the Same,Basic__Operationsconcept__hierarchy,The__PythonConceptual__HierarchyRevisited__expressions,The__PythonConceptual__HierarchyRevisited__statements,The__PythonConceptual__HierarchyRevisited__constraintsassert__statement, Example:Trapping__Constraints (butNot__Errors!) MicroPython,Python__ImplementationAlternatives__constructor convolution,Constructors__and Expressions:__init____and__sub____constructors classes,Coding__Constructors-CodingConstructors__customizing,Step__5:Customizing__Constructors, Too-Step 5:Customizing__Constructors,Too____init__ method,Operator__Overloadingoperator__overload,Constructors__and Expressions:__init____and__sub____superclass methods,Specializing__InheritedMethods__superclasses,Step__5:Customizing__Constructors, Too,Miscellaneous__ClassGotchas__containerobject__length,Test__Your Knowledge:Answers____contains__ method, Membership: __contains__, __iter__,and____getitem__- Membership: __contains__, __iter__,and____getitem__context__managers,File__ContextManagers__withstatement__context-management protocol,The__Context-Management Protocol-The__Context-ManagementProtocol__multiplecontext__managers,Multiple__Context Managers-MultipleContext__Managerscontinuation__linesin__interactive coding,What__Notto__Type:Prompts__andComments__continue statements, break, continue, pass,and__theLoop__elsecontrol__language,Is__Pythona__ScriptingLanguage__? control-nesting,exception__handlers, Example: Control-Flow Nesting-Example: Control-FlowNesting__conversionstext__files,Storing__Objectswith__Conversions-StoringObjects__withConversions__tuples, Conversions, methods,and__immutability-Conversions, methods,and__immutabilitycooperative__method dispatch, Call-chain anchors-Call-chainanchors__copies build-in types,Assignment__Creates References,Not__Copiesof__objects,References__Versus Copies-ReferencesVersus__Copiescopy__method,Missing__Keys:if__Testscore__object types,Python__sCore__ObjectTypes__coroutines,Advanced__FunctionTools__counter loops,range__object,Counter__Loops: range-Counter Loops:range__coupling,Function__DesignConcepts__variables,Function__DesignConcepts__coupling modules,Module__DesignConcepts__CPython,Python__Implementation Alternatives-PythonImplementation__Alternatives,Test__Your Knowledge:Answers__WebAssembly/Emscripten platform,WebAssembly__forBrowsers__cross-file changes,Program__Design:Minimize__Cross-File Changes-Program Design:Minimize__Cross-FileChanges__CSV module,object__storage,Storing__Objectswith__OtherTools__currentworking__directory (CWD),Opening__Filescustomization__by inheritance,Step__4:Customizing__Behaviorby__SubclassingCWD__(currentworking__directory),Opening__Files cycles,Test__Your Knowledge:Part__I Exercises,Part__I,Getting__Started recursion, Cycles, paths,and__stacklimits__cyclic data,Part__I,Getting__Started structures,Beware__ofCyclic__DataStructures__Cython, OK,but__Whats__the Downside?,Component__Integration,Numeric__andScientific__Programming,Python__Implementation Alternatives,Test__Your Knowledge:Answers__Ddata__descriptors,The__Basics inheritance,The__assignmentaddendum__data hiding,The__Rolesof____init__.py Files,Data__Hidingin__Modules,Pseudoprivate__ClassAttributes____all__ variable,Minimizing__from * Damage:_X__and __all__-Minimizingfrom__* Damage:_X__and__all______dir__ function,Managing__Attribute Access:__getattr____and __dir__-Managing__Attribute Access:__getattr____and__dir______getattr__ function,Managing__Attribute Access:__getattr____and __dir__-Managing__Attribute Access:__getattr____and__dir_____X prefix,Minimizing__from * Damage:_X__and __all__-Minimizingfrom__* Damage:_X__and__all____databases,Database__Access API,Database__Accessbooks__database example, Intermission:Books__Database-Mappingvalues__tokeys__object storage,Step__7 (Final):Storing__Objectsin__aDatabase__pickle module,Pickles__andShelves__shelfobject__updates,Updating__Objectson__aShelf__shelve database,Storing__Objectson__ashelve__Database-ExploringShelves__Interactivelyshelve__module,Pickles__and Shelves,The__shelvemodule__debugging,Development__Toolsfor__Larger Projects,Part__I,Getting__Startedexceptions__and,Test__Your Knowledge:Part__IExercises__exercise,Test__Your Knowledge:Part__I Exercises-TestYour__Knowledge:Part__IExercises__try statement,Debugging__withOuter__try Statements-Debuggingwith__Outertry__Statements decimals, Numbers,Test__Your Knowledge: Answers,Types__ShareOperation__Setsby__Categoriesdeclaration__statements,The__Caseof__theMissing__DeclarationStatements__decoding, Unicode,Character__Encodings decoration,What__sa__Decorator? functions,Function__Annotationsand__Decorations-Functiondecorators__alternative:Preview__decorator timers,More__ModuleMods__decorators arguments,Decorator__Arguments,Adding__Decorator Arguments-AddingDecorator__Arguments callables,Decorator__Argumentsfunction__annotations,Decorator__ArgumentsVersus__FunctionAnnotations__call tracers,Tracing__Function Calls-TracingFunction__Callscallables__returning callables,Implementation__class decorators,Decorators__and Metaclasses,A__FirstLook__atClass__Decoratorsand__Metaclasses-AFirst__Lookat__ClassDecorators__and Metaclasses,What__sa__Decorator?,Class__Decorator Basics,Adding__methodsto__classes arguments,Decorator__arguments built-in types,Applying__classdecorators__to built-intypes__class managers,Managing__Functionsand__Classes implementation, Implementation-Implementation instances, multiple,Supporting__multiple instances-Supportingmultiple__instances,Class__Pitfall:Retaining__Multiple Instances-Class Pitfall:Retaining__MultipleInstances__interface proxies,Managing__Callsand__Instancesmetaclasses__comparison,Metaclasses__VersusClass__Decorators:Round__1-MetaclassesVersus__Class Decorators:Round__1object__interfaces,Tracing__ObjectInterfaces__private attributes,Implementing__Private Attributes-Using__dict____and__slots____(andother__virtuals)public__attributes,Generalizing__forPublic__Declarations-Workaround:Generating__operator-overloadingdescriptors__singleton classes,Singleton__Classes-Applyingclass__decoratorsto__built-in__types state,enclosing__scopes and,State__retentionand__enclosingscopes__class management,Decorators__ManageFunctions__and Classes,Too__class methods,Automatically__decoratingclass__methods-Automaticallydecorating__classmethods__function decorators,Function__Decorator Basics-FunctionDecorator__Basics,What__sa__Decorator?argument__validation, Example:Validating__Function Arguments-Decorator__ArgumentsVersus__FunctionAnnotations__call proxies,Managing__Callsand__Instancesfunction__call timing,Timing__Function Calls-TimingFunction__Callsfunction__managers,Managing__Functionsand__Classes metafunctions,Usage__runtime declarations,Usage__syntax,Usage__usage,Function__DecoratorBasics__user-defined,A__FirstLook__at User-DefinedFunction__Decorators-AFirst__Lookat__User-DefinedFunction__Decoratorsfunction__management,Decorators__ManageFunctions__and Classes,Too__functionvalidation__keywords,Generalizing__forKeywords__and Defaults-Generalizingfor__Keywordsand__Defaultspositional__arguments,A__Basic Range-TestingDecorator__forPositional__Arguments-ABasic__Range-TestingDecorator__forPositional__Arguments functions,General__FunctionConcepts__implementation, Implementation-Implementationversus__macros,Why__Decorators? methods,Supporting__method decoration,Class__Pitfall:Decorating__Methods descriptors,Using__descriptorsto__decorate methods-Usingdescriptors__todecorate__methodsnested__functions,Using__nestedfunctions__todecorate__methods nesting,Decorator__Nesting-Decorator Nesting,Decorator__nesting properties,Coding__Propertieswith__Decorators deleters,Setter__anddeleter__decorators setters,Setter__anddeleter__decorators range-testing,A__Basic Range-TestingDecorator__forPositional__Arguments-Decorator__ArgumentsVersus__FunctionAnnotations__stateretention__class-instance attributes,State__with class-instanceattributes__enclosing-scope nonlocals,State__with enclosing-scope nonlocals-Statewith__enclosing-scopenonlocals__function attributes,State__withfunction__attributes-Statewith__functionattributes__globalvariables__and,State__withglobal__variables syntax,Why__Decorators?timer__decorator,Adding__DecoratorArguments__wrapperfunction__objects,Decorator__Nestingdef__statement,Basic__Function Tools,def__Statementsfunction__calls,Calls__name assignments,Name__Resolution:The__LEGBRule__nonlocalstatement__and,The__nonlocal Statement-nonlocalBoundary__Casesruntime__execution,def__Executesat__Runtimedefault__argument values, scopes,Scopes__andArgument__Defaults-LoopsRequire__Defaults,Not__Scopes definition, functions,Definition____del__ method,Object__Destruction: __del__-DestructorUsage__Notes delegation,Other__Waysto__Combine Classes:Composites__versus inheritance,Inheritance__versusdelegation__like-a relationships,OOP__and Delegation: Like-a Relationships-OOPand__Delegation: Like-aRelationships__OOP,OOP__and Delegation: Like-a Relationships-OOPand__Delegation: Like-aRelationships__delimiter string,Changing__Strings,Part__2:String__Methodsdeprecation__policies,Variable__NameRules__descriptors,__getattribute____and Descriptors:Attribute__Implementations, Descriptors,Management__TechniquesCompared__arguments,Descriptor__method arguments-Descriptormethod__arguments attributes, computed,Computed__Attributesclass__attributes,A__FirstExample__classes,Descriptors__data descriptors,The__Basics inheritance,The__descriptorsdeviation__decorating methods,Using__descriptorsto__decorate methods-Usingdescriptors__todecorate__methods files,os__module,Other__FileTools__hiding,The__Basics inheritance,A__FirstExample__inheritance and,The__Basicsnested__classes,A__FirstExample__operator overloading, Workaround:Generating__operator-overloading descriptors-Workaround:Generating__operator-overloadingdescriptors__properties and,How__Propertiesand__Descriptors Relate-Descriptorsand__slotsand__more read-only, Read-only descriptors-Read-onlydescriptors____set__ method,The__Basics slots,Descriptors__andslots__andmore__state,Using__StateInformation__in Descriptors-UsingState__Informationin__Descriptorsdesign__cross-file changes,Program__Design:Minimize__Cross-File Changes-Program__Design:Minimize__Cross-FileChanges__functions,Function__Basicsglobal__variable minimization,Program__Design:Minimize__Global Variables-Program__Design:Minimize__GlobalVariables__modules,Module__DesignConcepts__patterns,factory__functions,Closures__andFactory__Functions-Closuresand__FactoryFunctions__destructors,Object__Destruction:__del____developer productivity,Why__DoPeople__Use Python?,Developer__Productivitydevelopment__implications,Development__implicationsdevelopment__tools,Development__Toolsfor__LargerProjects__debuggers,Development__Toolsfor__LargerProjects__documentation tools,Development__Toolsfor__LargerProjects__error-checking tools,Development__Toolsfor__LargerProjects__IDEs,Development__Toolsfor__LargerProjects__installation management,Development__Toolsfor__LargerProjects__optimization,Development__Toolsfor__LargerProjects__profilers,Development__Toolsfor__LargerProjects__shipping,Development__Toolsfor__LargerProjects__testing tools,Development__Toolsfor__LargerProjects__DFLR (depth first,then__leftto__right),Multiple__Inheritanceand__theMRO__diagonals, Example:List__Comprehensionsand__Matrixes diamonds, user-defined,How__theMRO__Works__dict____attribute,How__FilesGenerate__Namespaces,Namespace__Dictionaries: __dict__-Namespace Dictionaries: __dict__,Module__Introspection, Example:Listing__Moduleswith____dict__-Example:Listing__Moduleswith____dict__ dictionaries,Why__Use Built-in Objects?,Python__sCore__Object Types, Dictionaries,Test__Your Knowledge: Answers,Types__ShareOperation__Setsby__Categoriesbackward__indexing,Mapping__valuesto__keysbooks__database example, Intermission:Books__Database-Mappingvalues__tokeys__building,Other__Dictionary Makers-Dictionary-literalunpacking__characteristics, Dictionaries-Dictionariesclasses__versus dictionaries,Records__Revisited:Classes__Versus Dictionaries-Records__Revisited:Classes__VersusDictionaries__collections,Dictionaries__comparisons,Dictionary__comparisons comprehensions,Dictionary__Comprehensions-Dictionary Comprehensions,Comprehensions__versustype__callsand__generators,Part__IV,Functions__andGenerators__syntax,Formal__ComprehensionSyntax__convertingto__tuples,Records__Revisited:Named__Tuples copying,Missing__Keys:if__Tests empty,Dictionaries__function annotations,Function__Annotationsand__Decorationsin__operator,Basic__DictionaryOperations__indexing,Mapping__Operations,Test__Your Knowledge:Part__II Exercises,Part__II,Objects__andOperations__initializing,Dictionary__Comprehensions iteration,Item__Iteration:for__Loops-Item Iteration:for__Loops, Reprise: Dictionaries, range, enumerate,and__zipkey__insertion order,Key__Insertion Ordering-KeyInsertion__Orderingkey__order,Dictionaries__keys,Dictionaries__immutable objects,Dictionary__UsageTips__integer keys,Using__dictionariesto__simulateflexible__lists:Integer__keysmapping__to,Mapping__valuesto__keys-Mappingvalues__tokeys__missing,Avoiding__missing-keyerrors__sorting,Sorting__dictionary keys-Sortingdictionary__keys storage,Basic__DictionaryOperations__tuple keys,Using__dictionariesfor__sparsedata__structures:Tuple__keyskeys__method,Basic__DictionaryOperations__len function,Basic__DictionaryOperations__lists, sorting,Sorting__listsliteral__expressions,Dictionaries__literal unpacking, Dictionary-literalunpacking__literals,Dictionaries__magnitude comparisons,Dictionary__magnitudecomparisons__methods,Missing__Keys:if__Tests,More__Dictionary Methods-MoreDictionary__Methodsmodule__namespaces,How__FilesGenerate__Namespaces-Namespace Dictionaries:__dict____mutability, Dictionaries, Dictionaries,Changing__Dictionariesin__Place-Changing__Dictionariesin__Place namespaces, Classes:Under__the Hood,Namespace__Dictionaries: Review-Namespace__Dictionaries:Review__slots,Slot__basics,Slots__andnamespace__dictionaries-Slotsand__namespacedictionaries__nesting,Nesting__Revisited-Nesting Revisited,Nesting__indictionaries__new indexes,Dictionary__UsageTips__object references,Dictionaries__operations,Dictionaries__mapping,Mapping__Operations-MappingOperations__sequence operations,Dictionary__UsageTips__sets,Dictionary__viewsand__sets-Dictionaryviews__andsets__sorting,Test__Your Knowledge:Part__III Exercises,Part__III,Statements__andSyntax__union operator,Dictionary__Union Operator-DictionaryUnion__Operator updating,Missing__Keys:if__Tests views,Dictionary__viewsand__sets-Dictionaryviews__andsets__views objects,Dictionary__key/value/itemview__objects-Dictionary key/value/itemview__objectszip__object,More__zip roles:dictionaries__dictionary keys,Test__Your Knowledge:Part__II Exercises,Part__II,Objects__andOperations__if statements,Missing__Keys:if__Tests-Missing Keys:if__Testsindexing__and,Mapping__Operationsinsertion__order,Mapping__Operationsdictionary__tools,Part__IV,Functions__andGenerators__dictionary-basedformatting__expressions, Dictionary-basedformatting__expressions-Dictionary-basedformatting__expressionsdir__function,Getting__Helpobject__attributes,The__dirFunction__name strings,The__dirFunction__type names,The__dirFunction__direct recursion,Coding__Alternativesdirectories__commands,Running__Fileswith__CommandLines__modulesearch__path, Search-PathComponents__.pth path-file, Search-PathComponents__PYTHONPATH, Search-Path Components,Configuring__theSearch__Path site-packages, Search-PathComponents__standard-library directories, Search-PathComponents__directory paths,Files__inAction__filename,Opening__Filesdisabling__code, triple-quoted strings,Triple__Quotesand__MultilineStrings__Django,GUIs__andUIs__dountil__loop,Examples__docstrings,Triple__Quotesand__Multiline Strings,Python__Documentation Sources,Docstrings__and __doc__,Documentation__Strings Revisited-DocumentationStrings__Revisited (seealso__documentation) built-in, Built-in docstrings-Built-indocstrings__content, User-defineddocstrings__indentation, User-defineddocstrings__literals, User-defineddocstrings__object classes, User-defineddocstrings__print, User-defineddocstrings__raw strings, User-defineddocstrings__standards,Docstring__standards triple-quoted block, User-defineddocstrings__user-defined, User-defined docstrings-User-defineddocstrings__documentation,Test__Your Knowledge:Part__I Exercises,Python__DocumentationSources__(seealso__docstrings; Pydoc) # comments, #Comments__dir function,The__dir Function-Thedir__Function priorities,Docstring__standards Sphinx,Beyond__Docstrings:Sphinx__documentation tools,Development__Toolsfor__LargerProjects__dotted-path syntax, packages,Package__Importsmodule__import,Using__thebasic__packagerelative__imports, Relative-ImportRationales__and Trade-Offs Durus,Database__Accessdynamic__typing,It__sPowerful__declaration statements,The__Caseof__theMissing__DeclarationStatements__objects, Variables, Objects,and__Referencespolymorphism__and,Dynamic__TypingIs__Everywhere variables, Variables, Objects,and__References-Variables, Objects,and__ReferencesE__easeof__use,It__sRelatively__Easyto__Useelse__clause,Loop__else-Whythe__loop else?else__statements, break, continue, pass,and__theLoop__elseembedding__built-inobject__types,Extending__Typesby__Embedding-ExtendingTypes__byEmbedding__embedded objects,Other__Waysto__Combine Classes:Composites__emptydata__structures,The__Meaningof__Trueand__Falsein__Pythonempty__dictionaries,Dictionaries__empty strings,Files__inAction__encapsulation,Coding__Methods,Python__and OOP,Test__Your Knowledge:Part__VIExercises__packaging,Python__andOOP__enclosing scopes,Implementation__functions,Enclosing__scopesand__loopvariables__stateretention__and,State__retentionand__enclosingscopes__encodingsource__files, Source-FileEncoding__Declarations-Source-FileEncoding__Declarations Unicode,Character__Encodings UTF-8,Character__Encodings end-of-line character,The__printfunction__inaction__enumerate function, loops,Offsets__and Items: enumerate-Offsetsand__Items:enumerate__equality,testing__for, Comparisons, Equality,and__Trutherror__handling,Part__VII,Exceptions__exceptions,Exception__Rolestesting__user input,Handling__Errorsby__Testing Inputs-HandlingErrors__byTesting__Inputstry__statement,Handling__Errorswith__try Statements-HandlingErrors__withtry__Statementserror__messages,Displaying__Errorsand__Tracebacks error-checking tools,Development__Toolsfor__LargerProjects__errors,Part__I,Getting__Started exercise,Test__Your Knowledge:Part__IExercises__escape characters,Escape__SequencesAre__Special Characters-EscapeSequences__AreSpecial__Charactersraw__strings,Raw__StringsSuppress__Escapes-RawStrings__SuppressEscapes__eval function,String__ConversionTools__event notification,Exception__Roles Excel,And__More: AI, Games, Images, QA, Excel,Apps__,Other__LaunchOptions__exception classes,Exception__Objects built-in, Built-inException__Classes ArithmeticError, Built-inException__Classes BaseException, Built-inException__Classes Exception, Built-inException__Classes LookupError, Built-inException__Classes OSError, Built-inException__Classes categories, catching,Coding__ExceptionsClasses__Exception, Built-inException__Classesexception__details,Coding__ExceptionsClasses__hierarchies,Exception__Classes,Why__Exception Hierarchies?-WhyException__Hierarchies?raising__instances,Coding__ExceptionsClasses__state and,Exception__Objects superclasses,Coding__ExceptionsClasses__exception groups,Exception__Groups:Yet__Another Star!-Exception Groups:Yet__Another Star! nesting, Example: Control-FlowNesting__exception handlers,Test__Your Knowledge:Part__IExercises__nesting,Nesting__ExceptionHandlers__control-flow, Example: Control-Flow Nesting-Example: Control-FlowNesting__syntactic nesting, Example:Syntactic__Nesting-Example:Syntactic__Nesting sys.exc_info,More__on sys.exc_info-The sys.exceptionalternative__anddiss__try/except/else,Functions__CanSignal__Conditionswith__raise-FunctionsCan__SignalConditions__withraise__exception superclass,Coding__ExceptionsClasses__exceptions,Why__Use Exceptions?as__string objects,The__raiseStatement__assert statement,The__assert Statement-Example:Trapping__Constraints (butNot__Errors!) (seealso__assert statement) built-in catching, Example:Catching__built-inexceptions__custom printing,Custom__Print Displays-CustomPrint__Displaysdefault__printing,Default__Printingand__State-DefaultPrinting__andState__state,Default__Printingand__State-DefaultPrinting__and State,Custom__Stateand__Behavior-ProvidingException__Methods catching,Catching__Exceptions-CatchingExceptions__categories, Built-inException__Categories chaining,Exception__Chaining:raise__from-Exception Chaining:raise__fromclass__instance objects,Exception__Objects class-based,Catching__Too Little:Use__Class-BasedCategories__code reuse,Exception__Objectsconnection__closure,Closing__Filesand__ServerConnections__control flow,Exception__Rolesdebugging__and,Test__Your Knowledge:Part__IExercises__default behaviors, Example:Default__behavior details,Providing__ExceptionDetails__error checks,Test__Your Knowledge:Answers__error handling,Exception__Roleserror__messages,Displaying__Errorsand__Tracebacksevent__notification,Exception__Rolesexcept__clause,Catching__Too Much:Avoid__Emptyexcept__and Exception-Catching__Too Much:Avoid__Emptyexcept__andException__exception handler,Default__Exception Handler-DefaultException__Handlerfile__closing,Closing__Filesand__ServerConnections__hierarchies,Exception__Classes,Why__Exception Hierarchies?-WhyException__Hierarchies? methods,Providing__Exception Methods-ProvidingException__Methodsno__exception case,Catching__the no-exceptioncase__withelse__propagating,Propagating__Exceptionswith__raiseraise__statement,The__raise Statement-Exception Chaining:raise__from,Breaking__Outof__MultipleNested__Loops:go__to (seealso__raise statement) raising,Raising__Exceptions-Raising Exceptions,Raising__Exceptions scopes,Scopes__andexcept__as-Scopesand__exceptas__as signals,Exceptions__Arent__Always Errors-ExceptionsAren__tAlways__Errors special-case handling,Exception__Roles superclasses,Exception__Classes termination,Exception__Roles,Termination__Actions-TerminationActions__termination handlers,The__Termination-Handlers Shoot-Out-The Termination-Handlers Shoot-Out tests, in-process,Running__In-ProcessTests__traceback object,Displaying__Errorsand__Tracebackstry__statement,The__try Statement-Combined-clausesexample__(seealso__try statement)debugging__and,Debugging__withOuter__try Statements-Debuggingwith__Outertry__Statements tuples,Catching__manyexceptions__witha__tuple unexpected,Catching__allexceptions__withempties__andException__user-defined, User-DefinedExceptions__nonerror conditions,Functions__CanSignal__Conditionswith__raise variables, scopes, Preview:Other__Pythonscopes__with statement,The__withStatement__andContext__Managers-The Termination-Handlers Shoot-Out (seealso__with statement) wrappers,What__ShouldBe__Wrappedexec__function,The__exec built-in-Theexec__built-inexecutable__statements from,Imports__AreRuntime__Assignments import,Imports__AreRuntime__Assignments executables, standalone,Standalone__Executables,Standalone__Appsand__Executables-Etceteraexecution__deferring,Anonymous__Functions:lambda__speed, OK,but__Whats__the Downside? exponentiation,Numbers__expression statements,Expression__Statements-ExpressionStatements__in-place changes,Expression__Statementsand__In-PlaceChanges__expressions,Running__Code Interactively,Test__Your Knowledge:Answers__arbitrary,Sequence__Operations,List__ComprehensionsReview__commas,Test__Your Knowledge:Part__IIExercises__concept hierarchy,The__PythonConceptual__HierarchyRevisited__curly braces,Python__sCore__ObjectTypes__dictionaries,Python__sCore__ObjectTypes__function-related,Function__Basicsgenerator__expressions,Comprehensions__and Generations,Generator__Functionsand__Expressions,Generator__FunctionsVersus__Generator Expressions,Listing__instanceattributes__with__dict____as iterables,Generator__Expressions:Iterables__MeetComprehensions__best uses,Why__generator expressions?versus__filter function,Generator__expressionsversus__filtergenerator__objects,Generator__Expressions:Iterables__MeetComprehensions__versusmap__function,Generator__expressionsversus__map-Generatorexpressions__versusmap__slicing sequences,Generator__expressions if/then/else,The__if/elseTernary__Expression-The if/elseTernary__Expressionindexing__expressions,Sequence__Operations slicing,Sequence__Operations lambda,Basic__FunctionTools__list comprehensions, Comprehensions:The__FinalAct__mapping,List__ComprehensionsReview__lists,Python__sCore__ObjectTypes__literal expressions,Python__sCore__ObjectTypes__methodcall__expressions,Method__CallSyntax__namedassignment__expression,Assignment__Syntax Forms,Named__Assignment Expressions-Whento__usenamed__assignment objects,The__PythonConceptual__Hierarchyoperator__overload,Constructors__and Expressions:__init____and__sub____slicing expression,Extended__slicing:The__thirdlimit__andslice__objectssquare__brackets,Python__sCore__ObjectTypes__string formatting, String-Formatting Options-Formattingexpression__basics advanced,Advanced__formattingexpression__examples-Advancedformatting__expressionexamples__dictionary-based, Dictionary-basedformatting__expressions-Dictionary-based__formattingexpressions__type codes,Formatting__expressioncustom__formats strings,String__ObjectBasics__extended slicing,Extended__slicing:The__thirdlimit__andslice__objects extended-unpacking assignments, Extended-Unpacking Assignments-Extendedunpacking__inaction__boundary cases,Boundary__cases-Boundarycases__for loops,Application__tofor__loops, Extended-unpackingassignment__infor__loops-Extended-unpackingassignment__infor__loopsextension__modules,Other__Kindsof__Modules extensions,The__PythonToolset__F f-strings,The__printfunction__inaction__literals,The__F-StringFormatting__Literal backslash, F-stringformatting__basicscustom__formats, F-stringcustom__formats quotes, F-stringformatting__basics REPL, F-stringformatting__basics substitutions, F-stringformatting__basics factorials,Part__IV,Functions__andGenerators__factory functions,Closures__andFactory__Functions-Closuresand__Factory Functions,Classes__Are Objects:Generic__Object Factories-Why Factories? metaclasses,Using__simplefactory__functionsfalse__values,The__Meaningof__Trueand__Falsein__Python-Thebool__typeFIFO__(first in,first__out), queues,Other__FileTools__file extensions, imports,Common__CodingGotchas__file icons,program__running,Clicking__andTapping__FileIcons__fileobjects__creating,Files__print operations,Print__Operationsfile__operations,Files__file-processing,Files__in Action-Filesin__Action filenames,Filenames__inopen__andOther__Filename Tools-Filenamesin__openand__OtherFilename__Toolsdirectory__path,Opening__Files modules,Module__Filenames-ModuleFilenames__program files,The__Programmers__View files, Files,Test__Your Knowledge:Answers__access-by-key,Other__FileTools__binary,Text__andBinary__Files:The__Short Story-Textand__Binary Files:The__ShortStory__binary-mode,Using__Textand__BinaryFiles__buffered,Using__Filesbyte__files,Unicode__andByte__Files-Unicodeand__ByteFiles__bytecode,Bytecode__compilationclose__method,Using__Files content,Using__Filescontext__managers,File__ContextManagers__cross-file changes, minimizing,Program__Design:Minimize__Cross-File Changes-Program Design:Minimize__Cross-FileChanges__descriptor files,os__module,Other__FileTools__directory paths,Files__inAction__FIFOs,Other__FileTools__iteration,Files__iterators,Using__Files,Files__inAction__list comprehensions,List__Comprehensionsand__Files-ListComprehensions__andFiles__methods export,Core__TypesReview__andSummary__newline characters,Files__inAction__number types,Core__TypesReview__andSummary__object storage,Storing__Objectswith__Conversions-StoringObjects__withConversions__open function,Other__File-LikeTools__opening,Opening__Files pipes,Other__FileTools__program architecture,How__toStructure__aProgram__runningas__standalone script, Dual-Usage Modes:__name____and __main__- Example:Unit__Testswith____name__ sets,Core__TypesReview__andSummary__shell-command streams,Other__FileTools__shelves,Other__FileTools__sockets,Other__FileTools__standard streams,Other__FileTools__string types,Core__TypesReview__andSummary__strings,Using__Files empty,Files__inAction__text files,Using__Files conversions,Storing__Objectswith__Conversions-StoringObjects__withConversions__pathname, Text-FileBasics__text output,Files__text-mode,Using__Textand__BinaryFiles__Unicode and,Unicode__andByte__Files-Unicodeand__ByteFiles__filter function,Selecting__Itemsin__Iterables: filter-SelectingItems__in Iterables: filter,Generator__expressionsversus__filterfinalization__(seetermination__actions)find__method,Changing__Strings,Part__2:String__Methods first-classobject__model,The__First-ClassObject__Model-The First-ClassObject__Model Flask,GUIs__and UIs,Internet__andWeb__Scriptingfloating__point numbers, Numbers,Test__Your Knowledge: Answers,Test__Your Knowledge: Answers,Types__ShareOperation__Setsby__Categories conversion,String__ConversionTools__files,Core__TypesReview__andSummary__interactive loops,Supporting__Floating-Point Numbers-Supporting Floating-Point__Numbersfolder__hierarchies,package__imports,Package__Importsfolders__packages,Module__Packages names,Basic__PackageStructure__nesting,Basic__PackageStructure__for loops,Item__Iteration:for__Loops-Item Iteration:for__Loops,for__Loops comprehensions,Changing__Lists:range__and Comprehensions-Changing Lists:range__andComprehensions__data types,Basic__usagedictionary__comprehensions,Dictionary__Comprehensions extended-unpacking assignments,Application__tofor__loops, Extended-unpacking__assignmentin__for loops-Extended-unpackingassignment__infor__loopsin__functions, Definition-Definition__getitem____method,Index__Iteration:__getitem____iteration protocol,Iteration__protocolintegration__lists,Changing__Lists:range__and Comprehensions-Changing Lists:range__andComprehensions__nested,Nested__for loops-Nestedfor__loopslist__comprehensions,Nested__loops: for,Formal__ComprehensionSyntax__sequence assignment,Tuple__(sequence)assignment__infor__loops-Tuple (sequence)assignment__infor__loopssequence__scans,Sequence__Scans: while, range,and__for-Sequence Scans: while, range,and__for targets,General__Format tips,Common__CodingGotchas__tuple assignment,Tuple__(sequence)assignment__infor__loops-Tuple (sequence)assignment__infor__loopsFOSS__(freeand__opensource__software),Who__UsesPython__Today? fractions,Test__Your Knowledge: Answers,Types__ShareOperation__Setsby__Categories files,Core__TypesReview__andSummary__frameworks,Programming__bycustomization__freeand__opensource__software (FOSS),Who__UsesPython__Today?from__* statement,The__from * Statement-Thefrom__*Statement____all__ variable,Minimizing__from * Damage:_X__and __all__-Minimizingfrom__* Damage:_X__and__all______init__.py files,The__Rolesof____init__.pyFiles__variable meanings,from__*Can__Obscurethe__Meaningof__Variables_X__prefix,Minimizing__from * Damage:_X__and __all__-Minimizingfrom__* Damage:_X__and__all____from statement,The__fromStatement__as clause,The__asExtension__forimport__and from-Theas__Extensionfor__importand__frominteractive__statement, reload, from,and__InteractiveTesting__link problems,from__CopiesNames__butDoesn__tLink__potential problems,Potential__Pitfallsof__thefrom__Statement-Whenimport__isrequired__reloads,reload__MayNot__Impactfrom__Importsfrozen__binaries,Standalone__Executablesfunction__calls,Running__CodeInteractively__argument matching,Argument__Matching Overview,Argument__MatchingSyntax__unpacking arguments, Calls:Unpacking__arguments-Calls:Unpacking__argumentsargument__ordering,Calls__Orderingboundary__cases,Boundary__casesformal__definitions,Formal__definitionargument__passing,Argument__PassingDetails__arguments, mutable, Argument-PassingBasics__assignments,Application__tofor__loops benchmarks,For__moregood__times:Function__callsand__map-Formore__good times:Function__callsand__mapchangeable__data,Function__Attributes: Changeable, Per-Call,Explicit__interfaces,Function__Interfacesand__Callback-Based Code-FunctionInterfaces__and Callback-BasedCode__parentheses,Common__CodingGotchas__timing,Timing__Function Calls-TimingFunction__Calls tracing, decorators,Tracing__Function Calls-TracingFunction__Callsfunction__decorators,Decorators__and Metaclasses-FunctionDecorator__Basics,What__sa__Decorator?argument__validation, Example:Validating__Function Arguments-TheGoal__call proxies,Managing__Callsand__Instancesfunction__call timing,Timing__Function Calls-TimingFunction__Callsfunction__managers,Managing__Functionsand__Classes metafunctions,Usage__runtime declarations,Usage__syntax,Property__basics,Usage__usage,Function__DecoratorBasics__user-defined,A__FirstLook__at User-DefinedFunction__Decorators-AFirst__Lookat__User-DefinedFunction__Decoratorsfunction__definitionsargument__matching,Argument__Matching Syntax, Definitions:Collecting__arguments-Definitions:Collecting__argumentsargument__ordering,Definition__Orderingboundary__cases,Boundary__casesformal__definitions,Formal__definitionargument__passing,Argument__PassingDetails__function headers,Application__tofor__loopsfunction__managers,Managing__Functionsand__Classesfunction__validation keywords,Generalizing__forKeywords__and Defaults-Generalizingfor__Keywordsand__Defaultspositional__arguments,A__Basic Range-TestingDecorator__forPositional__Arguments-ABasic__Range-TestingDecorator__forPositional__Argumentsfunctional__programming,Why__DoPeople__Use Python?,Functional__Programming Tools,Classes__GenerateMultiple__InstanceObjects__closures,Closures__andFactory__Functions-Closuresand__FactoryFunctions__first-classobject__model,The__First-ClassObject__Modelmap__function,Mapping__Functionsover__Iterables: map-MappingFunctions__over Iterables:map__functions annotations,Type__Hinting: Optional, Unused,and__Why?,General__Function Concepts,Function__Annotationsand__Decorations-Functiondecorators__alternative:Preview__anonymous,lambda__MakesAnonymous__Functions-lambdaMakes__Anonymous Functions,Anonymous__Functions:lambda__(seealso__lambda expression)argument__matching syntax,Argument__MatchingSyntax__arguments,def__Statements coupling,Function__DesignConcepts__passing,General__FunctionConcepts__validation, Example:Validating__Function Arguments-DecoratorArguments__VersusFunction__Annotations async,Asynchronous__Functions:The__Short Story-TheAsync__Wrap-Upasync__statement,Advanced__FunctionTools__attributes,General__FunctionConcepts__state,State__withfunction__attributes-Statewith__functionattributes__state retention,Function__Attributes: Changeable, Per-Call,Explicit__-Function__Attributes: Changeable, Per-Call,Explicit__user-defined,Function__Attributesawait__statement,Advanced__FunctionTools__built-in,handling__by assignment,Hiding__built-insby__assignment calls,Calls__def statement,Calls__classmethod,Using__Staticand__ClassMethods__closure functions,Function__Interfacesand__Callback-BasedCode__cohesion,Function__DesignConcepts__coroutines,Advanced__FunctionTools__coupling,Function__DesignConcepts__decorations,Function__Annotationsand__Decorations-Functiondecorators__alternative:Preview__decorators,General__FunctionConcepts__def statements,Basic__Function Tools,def__Statements,def__Executesat__Runtime defaults,Defaults__andMutable__Objects-Defaultsand__MutableObjects__deferring execution,Anonymous__Functions:lambda__definitions,General__Function Concepts,Definition__dir,Getting__Help eval,String__ConversionTools__exec,The__exec built-in-Theexec__built-inexecution__environment,Function__DesignConcepts__factory functions,Using__simplefactory__functions filter,Selecting__Itemsin__Iterables: filter-SelectingItems__in Iterables:filter__first-classobject__model,The__First-ClassObject__Model-The First-ClassObject__Modelfor__loops in, Definition-Definitiongenerator__functions,Comprehensions__and Generations,Generator__Functionsand__Expressions,Generator__functionsin__action,Generator__FunctionsVersus__GeneratorExpressions__best uses,Why__generator functions?iteration__protocol,Generator__functionsin__actionsend__method,Extended__generatorfunction__protocol:send__versusnext__slicing sequences,Generator__functions-Generatorfunctions__state suspension,State__suspension-Statesuspension__yield statement,The__yieldfrom__extension-Theyield__fromextension__generators,Advanced__FunctionTools__global statement,Advanced__FunctionTools__global variables,Function__DesignConcepts__helper functions,The__Downsideof__Helper Functions-TheDownside__ofHelper__Functions inlining,Anonymous__Functions:lambda__intersect,Calls__lambdabody__expression,Calls__polymorphism,Polymorphism__Revisited introspection,Function__Introspection,Function__introspectionlambda__expressions,Basic__Function Tools,lambda__MakesAnonymous__Functions-lambdaMakes__AnonymousFunctions__len,Escape__SequencesAre__SpecialCharacters__loop variables,Enclosing__scopesand__loopvariables__manager functions,The__Downsideof__HelperFunctions__metafunctions,Function__DecoratorBasics__names, locals,Local__NamesAre__Detected Statically-LocalNames__AreDetected__Statically nested,decorating__methods,Using__nestedfunctions__todecorate__methodsnonlocal__statement,Advanced__FunctionTools__objects, mutable,Defaults__andMutable__Objects-Defaultsand__MutableObjects__open,Other__File-LikeTools__overview,Function__Basics parameters,def__Statementspassing__as arguments,The__First-ClassObject__Modelplain__functions,Method__Objects:Bound__or Not,Why__theSpecial__Methods?recursive__(see recursion) reduce,Combining__Itemsin__Iterables: reduce-CombiningItems__in Iterables:reduce__reload,Reloading__Modules-reloadOdds__andEnds__return statements,Basic__Function Tools,return__Statements returns,Functions__Withoutreturns__scopes, enclosing,Enclosing__scopesand__loopvariables__set,Sets__size,Function__DesignConcepts__slicing sequences,Simple__functions staticmethod,Using__Staticand__ClassMethods__str,Numbers__super function,The__superFunction__argument lists,Same__argument lists-Sameargument__lists attribute-fetch algorithm, Attribute-fetchalgorithm__call-chain anchors, Call-chain anchors-Call-chainanchors__deployment,Universal__deploymentMRO__algorithm,A__magic proxy-Amagic__proxy noncalls,Noncalls__andoperator__overloading-Noncallsand__operatoroverloading__operator overloading,Noncalls__andoperator__overloading-Noncallsand__operatoroverloading__testdriver,Running__In-ProcessTests__timerutility__functions,Timer__Module:Take__2 type, Types-Typestype__hints,Type__Hinting: Optional, Unused,and__Why? uses,Why__Use Functions?-WhyUse__Functions?yield__statement,Advanced__FunctionTools____future__ import,Enabling__Language Changes:__future____Ggame__programming,And__More: AI, Games, Images, QA, Excel,Apps__garbage collection,Nesting__Revisitedcircular__references,Objects__Are Garbage-Collected objects,Objects__Are Garbage-Collected-ObjectsAre__Garbage-Collectedgeneralized__set functions,argument__matching, Example:Generalized__Set Functions-Testingthe__Codegenerator__expressions,Comprehensions__and Generations,Generator__Functionsand__Expressions,Generator__FunctionsVersus__Generator Expressions,Listing__instanceattributes__with__dict____as iterables,Generator__Expressions:Iterables__MeetComprehensions__best uses,Why__generator expressions?versus__filter function,Generator__expressionsversus__filtergenerator__objects,Generator__Expressions:Iterables__MeetComprehensions__versusmap__function,Generator__expressionsversus__map-Generatorexpressions__versusmap__nesting,Generator__expressionsversus__mapslicing__sequences,Generator__expressionsgenerator__functions,Comprehensions__and Generations,Generator__Functionsand__Expressions,Generator__functionsin__action,Generator__FunctionsVersus__GeneratorExpressions__best uses,Why__generator functions?iterable__objects,Classes__versusgenerators__iteration protocol,Iteration__protocol integration,Generator__functionsin__actionsend__method,Extended__generatorfunction__protocol:send__versusnext__slicing sequences,Generator__functions-Generatorfunctions__state suspension,State__suspension-Statesuspension__yield statement,The__yieldfrom__extension-Theyield__fromextension__generator objects,Generator__FunctionsVersus__Generator Expressions,Coding__Alternative:__iter____Plus yield-Multipleiterators__withyield__generator expressions,Generator__Expressions:Iterables__MeetComprehensions__generators,Advanced__FunctionTools__built-ins,Generation__in built-insand__classes-Generationin__built-insand__classes classes,Generation__in built-insand__classes-Generationin__built-insand__classes comprehensions,Comprehensions__versustype__callsand__generatorsmemory__footprint,Why__generators here: Space, time,and__more permutation,Why__generators here: Space, time,and__more-Whygenerators__here: Space, time,and__moreresults__generation,Generating__infinite (well, indefinite) results-Generating__infinite (well, indefinite)results__single-pass iterables,Generators__are single-pass iterables-Generatorsare__single-passiterables____get__ method,Inserting__Codeto__Runon__AttributeAccess____getattr__ method,Other__Waysto__Combine Classes: Composites,Attribute__Reference,Miscellaneous__Class Gotchas,Inserting__Codeto__Runon__Attribute Access,__getattr____and __getattribute__-Using__getattribute____versus__getattribute____method,__getattr____and__getattribute____Compared-__getattr__and____getattribute__Compared____getattribute__ method,__getattribute____and Descriptors:Attribute__Implementations,Inserting__Codeto__Runon__Attribute Access,__getattr____and __getattribute__-Using __getattribute__,Management__TechniquesCompared__versus__getattr____method,__getattr____and__getattribute____Compared-__getattr____and__getattribute____Compared__getitem____method,Indexing__and Slicing:__getitem____and__setitem____iteration,Index__Iteration: __getitem__-Index Iteration:__getitem____iteration and,Intercepting__ItemAssignments__slice expressions,Intercepting__Slices-InterceptingSlices__global namespaces,Simple__Names:Global__UnlessAssigned__global scope,state__retention and, Globals:Changeable__butShared__global statement,Advanced__Function Tools,The__global Statement-Theglobal__Statement emulation,Other__Waysto__Access Globals-OtherWays__toAccess__Globalsglobal__variables coupling,Function__DesignConcepts__cross-file changes,Program__Design:Minimize__Cross-File Changes-Program__Design:Minimize__Cross-FileChanges__multithreading,Program__Design:Minimize__GlobalVariables__program design,Program__Design:Minimize__Global Variables-Program Design:Minimize__GlobalVariables__state,decorators__and,State__withglobal__variables glyphs,The__strObject__graphics processing,And__More: AI, Games, Images, QA, Excel,Apps____gt__ method, Comparisons: __lt__, __gt__,and__Others-Comparisons: __lt__, __gt__,and__OthersGUIs__(graphicaluser__interfaces), OK,but__Whats__the Downside?,GUIs__andUIs__IDLE,The__IDLEGraphical__User Interface-TheIDLE__GraphicalUser__InterfaceH__has-a relationships, composition,OOP__and Composition: Has-a Relationships-Stream__ProcessorsRevisited__hash-basedbytecode__files,Step__2:Compile__It (Maybe) hashes,Dictionaries__Haskell, Comprehensions:The__FinalAct__helper functions,The__Downsideof__Helper Functions-TheDownside__ofHelper__Functionshex__escapes,Coding__UnicodeStrings__inPython__hierarchies, subclassing, OOP:The__BigIdea__HPy,Component__IntegrationI__I/O (input/output) operations,async__extension,Asynchronous__Functions:The__ShortStory____iadd__ method, In-PlaceAddition__IDEs (integrateddevelopment__environments),Other__IDEsfor__Python,Development__Toolsfor__LargerProjects__attribute lists,The__dirFunction__IDLE,The__IDLEGraphical__UserInterface__IDLE,Using__Pythonon__Windows-UsingPython__onWindows__IDLE GUI,The__IDLEGraphical__User Interface-TheIDLE__GraphicalUser__Interfaceif__else expression,Missing__Keys:if__Tests recursion,Coding__Alternatives-CodingAlternatives__if statements,A__Taleof__Two ifs,if__Statementsdictionary__keys,Missing__Keys:if__Tests-Missing Keys:if__Testslist__comprehensions,Filter__clauses:if__match statements,Match__versusif__live multiple-choice selection, Multiple-ChoiceSelections__function definition,Handling__largeractions__switch defaults,Handling__switchdefaults__syntax,Missing__Keys:if__Tests if/then/else expression,The__if/elseTernary__Expression-The if/elseTernary__Expressionimage__processing,And__More: AI, Games, Images, QA, Excel,Apps__immutability,Test__Your Knowledge:Answers__strings, Immutability-Immutability,Types__ShareOperation__Setsby__Categories tuples, Tuples, Conversions, methods,and__immutability-Conversions, methods,and__immutabilityimmutable__arguments, Argument-PassingBasics__immutablesequence__of 8-bit integers,bytes__type,The__bytesObject__immutablesequence__of characters,str__type,The__strObject__immutable sequences, strings,String__ObjectBasics__immutable types,Mutable__TypesCan__BeChanged__in Place,Test__Your Knowledge:Part__II Exercises,Part__II,Objects__andOperations__implementation alternatives,Python__Implementation Alternatives-PythonImplementation__Alternatives implementation-related objects,Python__sCore__ObjectTypes__importmodels__modules,Python__ImportModels__namespace packages,Namespace__Packages-NamespacePackages__inAction__module searches,The__ModuleSearch__Algorithm-TheModule__SearchAlgorithm__package-relative imports, Package-Relative Imports-PythonImport__Models packages,Module__Packages-Package Imports,Python__ImportModels__module searches,Packages__andthe__ModuleSearch__Path-Packagesand__theModule__SearchPath__package creation,Creating__Packages-Usingthe__updatedpackage__package initialization,The__Rolesof____init__.py Files-TheRoles__of __init__.pyFiles__import optimization, bytecode,Bytecode__compilationimport__statement,The__import Statement-Theimport__Statementas__clause,The__asExtension__forimport__and from-Theas__Extensionfor__importand__from modules,Step__1:Find__Itimports__asruntime__operations,How__ImportsWork__circular,Part__V,Modules__andPackages____future__,Enabling__Language Changes:__future____modules,Imports__and Attributes-Step 1:Find__It bytecode,Step__2:Compile__It (Maybe)-Step 2:Compile__It (Maybe)bytecode__execution,Step__3:Run__Itinitialization__code,Initialization__codenamespace__nesting,Namespace__Nesting-NamespaceNesting__one-time,Imports__HappenOnly__Onceprevious__imports,Step__2:Compile__It (Maybe)runtime__assignment,Imports__AreRuntime__Assignments-Cross-filename__changesstatement__order,Statement__OrderMatters__in Top-Level Code-Statement__OrderMatters__in Top-LevelCode__variables,Imports__Versus Scopes-ImportsVersus__Scopes nested,Part__V,Modules__andPackages__nested modules, attributes,Using__thebasic__package package-relative,Module__Packages absolute,Relative__andAbsolute__Imports,Relative__andAbsolute__Importsname__clashes,Module__Name Clashes:Package__and Package-RelativeImports__relative,Relative__andAbsolute__Imports-PythonImport__Models packages,Module__Packages,Package__Imports,Python__Import Models,Part__V,Modules__andPackages__folder hierarchies,Package__Importsfrom__statement,Using__thebasic__package recursive,Recursive__fromImports__MayNot__Work-Recursivefrom__ImportsMay__NotWork__in-place changes,Shared__Referencesand__In-Place Changes-SharedReferences__and In-PlaceChanges__expression statements,Expression__Statementsand__In-PlaceChanges__names,Scopes__Overviewincremental__prototyping,Testing__asYou__Goindentation__blocks,End__ofindentation__isend__of block-WhyIndentation__Syntax? consistency,Common__CodingGotchas__text editors,Why__Indentation Syntax?index__assignments,Index__andslice__assignments-Indexand__sliceassignments____index__ method,But____index__Means__As-Integer indexing,Test__Your Knowledge:Part__II Exercises,Part__II,Objects__andOperations__dictionaries,Test__Your Knowledge:Part__II Exercises,Part__II,Objects__andOperations__expressions,Sequence__Operations slicing,Sequence__Operationsinstances__iteration, __getitem__,Index__Iteration: __getitem__-Index Iteration:__getitem____operator overloading,Indexing__and Slicing:__getitem____and __setitem__-But__index____Means As-Integer lists,Indexing__and Slicing-Indexingand__Slicingout__of bounds,Test__Your Knowledge:Part__IIExercises__string indexing,Test__Your Knowledge:Part__II Exercises,Part__II,Objects__andOperations__strings,Indexing__and Slicing-Extended slicing:The__thirdlimit__andslice__objectsindirect__recursion,Coding__Alternativesinfinite__loops,Examples__inheritance,Python__and OOP,Part__VI,Classes__andOOP__attribute fetches, Classes:Under__theHood__built-ins,The__built-insbifurcation__class trees,Python__Inheritance Algorithm:The__SimpleVersion__classes, OOP:The__Big Picture,Inheritance__attribute trees,Attribute__TreeConstruction__customization,Classes__AreCustomized__by Inheritance-ASecond__Exampleinheritance__search,Some__InstancesAre__MoreEqual__ThanOthers__metaclasssubclasses__and,The__InheritanceBifurcation__privacy,Inheritance__FinePrint__composites,Other__Waysto__Combine Classes: Composites-OtherWays__toCombine__Classes:Composites__customization by,Step__4:Customizing__Behaviorby__Subclassingdata__descriptors,The__descriptors deviation,The__assignmentaddendum__versus delegation,Inheritance__versusdelegation__descriptors,The__Basics,A__FirstExample__inherited methods,Specializing__Inherited Methods-SpecializingInherited__Methods is-a relationships,OOP__and Inheritance: Is-a Relationships-OOPand__Inheritance: Is-aRelationships__metaclasses,Metaclasses__and Inheritance, Inheritance:The__Finale, Inheritance:The__Finale,Metaclass__Inheritance-MetaclassInheritance__inheritance relationships, Inheritance:The__Finalenames__acquisition,Metaclass__VersusSuperclass__MRO (methodresolution__order),Multiple__Inheritanceand__the MRO,How__theMRO__Works-Howthe__MRO Works,The__InheritanceBifurcation__multiple,Multiple__Inheritanceand__theMRO__attribute conflicts,Attribute__Conflict Resolution-AttributeConflict__Resolution DFLR,Multiple__Inheritanceand__theMRO__inheritance sources, Example:Mapping__Attributesto__Inheritance Sources-Example:Mapping__Attributesto__InheritanceSources__mix-in classes, Example: Mix-inAttribute__Listers-Listingattributes__perobject__inclass__trees order,Multiple__Inheritance:Order__Matters-Multiple Inheritance:Order__Matters overview,How__MultipleInheritance__Works-HowMultiple__InheritanceWorks__slots,Slot__usage rules,Example__impactsof__slots:ListTree__andmapattrs__namespaces, Example:Class__Attributesnonclass__instances,The__InheritanceBifurcation__OOP,Why__Use Classes?,OOP__and Inheritance: Is-a Relationships-OOPand__Inheritance: Is-aRelationships__attributes,Attribute__Inheritance Search-AttributeInheritance__Searchclass__customization,Classes__AreCustomized__by Inheritance-ASecond__Examplemultiple__inheritance,Coding__ClassTrees__operator-overloading methods,Common__Operator-OverloadingMethods__properties,A__FirstExample__secondary trees,The__InheritanceBifurcation__single-inheritance, slots,Example__impactsof__slots:ListTree__andmapattrs__stringrepresentation__methods,String__Representation:__repr____and__str____subclassing, Inherit, Customize,and__Extend subverting,Augmenting__Methods:The__GoodWay__super function,The__supersupplement__inheritance algorithm,Python__Inheritance Algorithm:The__Simple Version-TheInheritance__Wrap-Upinheritance__hierarchy, OOP:The__BigPicture____init__method__constructors,Operator__Overloadingoperator__overload and,Constructors__and Expressions:__init____and__sub______init__.py files,Package____init__.py Files-Usingthe__updated package,The__Rolesof____init__.pyFiles__from * statement,The__Rolesof____init__.pyFiles__modulenamespace__initialization,The__Rolesof____init__.pyFiles__package initialization,The__Rolesof____init__.pyFiles__searches,The__Rolesof____init__.pyFiles__inlining functions,Anonymous__Functions:lambda__inputs,user__(seeuser__inputs)installation__Android,Installing__Python Linux,Installing__Python macOS,Installing__Python Unix,Installing__Python Windows,Installing__Pythoninstallation__management,Development__Toolsfor__LargerProjects__instance methods,Why__theSpecial__Methods?,Using__Staticand__ClassMethods__metaclass comparison,Metaclass__MethodsVersus__Instance Methods-Metaclass__MethodsVersus__InstanceMethods__instance objects,Classes__GenerateMultiple__Instance Objects,Instance__ObjectsAre__ConcreteItems__attributes,Coding__Constructorsinstances__attribute privacy,Emulating__Privacyfor__Instance Attributes:Part__1-Emulating__Privacyfor__Instance Attributes:Part__1 attributes,Instance__VersusClass__Attributes-InstanceVersus__ClassAttributes__class decorators,Supporting__multiple instances-Supportingmultiple__instances,Class__Pitfall:Retaining__Multiple Instances-Class Pitfall:Retaining__MultipleInstances__classes,Why__Use Classes? counting,Counting__Instanceswith__Static Methods-CountingInstances__withStatic__Methodsclass__methods,Counting__Instanceswith__Class Methods-Countinginstances__perclass__withclass__methods creation,Some__InstancesAre__MoreEqual__ThanOthers__indexing iteration,Index__Iteration: __getitem__-Index Iteration:__getitem____operator overloading,Indexing__and Slicing:__getitem____and __setitem__-But__index____Means As-Integerliteral__syntax,Classes__AreTypes__AreClasses__metaclasses,Some__InstancesAre__MoreEqual__ThanOthers__nonclass instances,Some__InstancesAre__MoreEqual__ThanOthers__inheritance,The__InheritanceBifurcation__OOP,Attribute__InheritanceSearch__namespaces,Classes__andInstances__state,Using__StateInformation__inDescriptors__state,decorators__and,State__with class-instanceattributes__subclasses,namespace__dictionaries,Namespace__Dictionaries:Review__integer keys,Using__dictionariesto__simulateflexible__lists:Integer__keys integers, Numbers,Test__Your Knowledge: Answers,Types__ShareOperation__Setsby__Categories files,Core__TypesReview__andSummary____index__ method,But____index__Means__As-Integerprecision__inlarge__numbers,Numbers__interaction,Part__I,Getting__Startedinteractive__coding $ character,What__Notto__Type:Prompts__andComments__Android,Starting__anInteractive__REPLcommand__line,Test__Your Knowledge:Answers__comments,What__Notto__Type:Prompts__andComments__exercise,Test__Your Knowledge:Part__IExercises__macOS,Starting__anInteractive__REPL prompt,Why__theInteractive__Prompt?-Testing prompts,What__Notto__Type:Prompts__andComments__REPLs (real-eval-print loops)code__folders,Where__to Run:Code__Folders-Whereto__Run:Code__Folders IPython,Other__PythonREPLs__starting,Starting__anInteractive__REPL-Startingan__Interactive REPL,Test__Your Knowledge:Answers__running code,Running__Code Interactively-RunningCode__Interactively Windows,Starting__anInteractive__REPLinteractive__command-lineREPLs__(real-eval-print loops),Starting__anInteractive__REPLinteractive__loops,A__SimpleInteractive__Loop-ASimple__InteractiveLoop__errorhandling__input testing,Handling__Errorsby__Testing Inputs-HandlingErrors__byTesting__Inputstry__statements,Handling__Errorswith__try Statements-HandlingErrors__withtry__Statements floating-point numbers,Supporting__Floating-Point Numbers-Supporting Floating-PointNumbers__mathon__user inputs,Doing__Mathon__User Inputs-DoingMath__onUser__Inputsnesting__code,Nesting__CodeThree__LevelsDeep__interactive tests,Test__Your Knowledge:Part__IIExercises__from statement, reload, from,and__InteractiveTesting__reload statement, reload, from,and__InteractiveTesting__interface proxies, wrappers,Managing__Callsand__Instancesinternet__modules,Internet__andWeb__Scriptinginterpreted__language,Is__Pythona__ScriptingLanguage__? interpreter,Introducing__thePython__Interpreter-ThePython__VirtualMachine__(PVM),Test__Your Knowledge:Answers__intersect function,Calls__lambdabody__expression,Calls__local variables, Segue:Local__Variables-Segue:Local__Variables polymorphism,Polymorphism__Revisitedintrospection____dict__ attribute,Module__Introspectionlisting__modules, Example:Listing__Moduleswith____dict__-Example:Listing__Moduleswith____dict__ functions,Function__introspectionintrospection__tools,Step__6:Using__IntrospectionTools__class attributes,Special__Class Attributes-InstanceVersus__ClassAttributes__display tools,A__GenericDisplay__Tool-AGeneric__DisplayTool__instance attributes,Instance__VersusClass__Attributes-InstanceVersus__ClassAttributes__tool classes,Name__Considerationsin__ToolClasses__iOS,Python__on,Using__Pythonon__iOS-UsingPython__oniOS__IPython,Other__PythonREPLs__IronPython,Component__Integration,Python__ImplementationAlternatives__is-a relationships, inheritance,OOP__and Inheritance: Is-a Relationships-OOPand__Inheritance: Is-aRelationships__items method,Item__Iteration:for__Loops__iter____method,Iterable__Objects:__iter____and__next____user-defined iterables, User-Defined Iterables-Classesversus__generatorsyield__function and,Coding__Alternative:__iter____Plus yield-Multipleiterators__withyield__iterable objects, Iterations,Iterable__Objects:__iter____and__next____combining items,Combining__Itemsin__Iterables: reduce-CombiningItems__in Iterables:reduce__generator functions,Classes__versusgenerators__item selection,Selecting__Itemsin__Iterables: filter-SelectingItems__in Iterables:filter__mappingfunctions__over,Mapping__Functionsover__Iterables: map-MappingFunctions__over Iterables:map__iterable, definition,Iterations__iterablesgenerator__expressions as,Generator__Expressions:Iterables__MeetComprehensions__generators,Generators__are single-pass iterables-Generatorsare__single-passiterables__map function,Coding__YourOwn__map single-pass,Generators__are single-pass iterables-Generatorsare__single-passiterables__user-defined__iter____method, User-Defined Iterables-Classesversus__generatorsyield__function,Coding__Alternative:__iter____Plus yield-Multipleiterators__withyield__zip function,Coding__YourOwn__zipand__2.Xmap__iteration, Files, Iterations,Part__IV,Functions__andGenerators__benchmarking,Iteration__Results-Formore__good times:Function__callsand__mapfunction__calls,For__moregood__times:Function__callsand__map-Formore__good times:Function__callsand__mapmap__function,For__moregood__times:Function__callsand__map-Formore__good times:Function__callsand__map dictionaries,Item__Iteration:for__Loops-Item Iteration:for__Loops, Reprise: Dictionaries, range, enumerate,and__zipfilter__built-in,Functional__iterables:map__and filter-Functional iterables:map__andfilter__generators,Comprehensions__andGenerations____getitem__ method,Intercepting__ItemAssignments__instance indexing, __getitem__,Index__Iteration: __getitem__-Index Iteration:__getitem____list comprehensions,List__Comprehension Basics,Formal__ComprehensionSyntax__lists, Iteration, Comprehensions,and__Unpackingmap__built-in,Functional__iterables:map__and filter-Functional iterables:map__andfilter__multiple iterations,Multiple__Iteratorson__One Object-MultipleIterators__onOne__Object multiple-pass iterables, Multiple-passversus__single-pass iterables-Multiple-pass__versus single-passiterables__Pythonmorph__and,Test__Your Knowledge:Answers__single-pass iterables, Multiple-passversus__single-pass iterables-Multiple-pass__versus single-passiterables__single-scan,Single__versusmultiple__scans standard-library iterables, Standard-libraryiterables__inPython__strings,Basic__Operationstext__files,Using__Filesview__objects,Dictionary__key/value/itemview__objectsiteration__protocol,Iterations__and Comprehensions-TheIteration__Protocol,Iterable__Objects:__iter____and__next____for loops,Iteration__protocolintegration__fulliteration__protocol,The__fulliteration__protocol-Thefull__iterationprotocol__generator functions,Iteration__protocol integration,Generator__functionsin__action iter,The__iterand__next built-ins,More__oniter__and next-Moreon__iterand__next,Generator__functionsin__actioniteration__tools,The__IterationProtocol__lists, Reprise: Dictionaries, range, enumerate,and__zipmanual__iteration,Manual__iteration next,The__iterand__next built-ins,More__oniter__andnext__range object, Reprise: Dictionaries, range, enumerate,and__zip readlines,The__IterationProtocol__StopIteration exception,The__IterationProtocol__zip object, Reprise: Dictionaries, range, enumerate,and__zipiteration__tools, Conversions, methods,and__immutability,Iteration__Tools-OtherIteration__Topicsiterator__objects,multiple__iterations,Multiple__Iteratorson__One Object-MultipleIterators__onOne__Objectiterators__definition,Iterations__nesting,Iterator__nestingJ__Java,Component__IntegrationJIT__compilers Numba,Python__ImplementationAlternatives__PyPy,Python__ImplementationAlternatives__join method,Changing__Strings,Part__2:String__Methodsjson__module,The__pickleand__jsonSerialization__Modules-Thepickle__andjson__SerializationModules__JSON,object__storage,Storing__Objectswith__JSONJupyter__notebooks,Numeric__andScientific__ProgrammingJupyter__Notebooks,Jupyter__Notebooksfor__ScienceJVM__(JavaVirtual__Machine) Jython,Python__ImplementationAlternatives__Jython,Component__Integration,Python__ImplementationAlternatives__Kkeys__dictionaries,Dictionaries__insertion order,Key__Insertion Ordering-KeyInsertion__Orderinginteger__keys,Using__dictionariesto__simulateflexible__lists:Integer__keysmapping__values to,Mapping__valuesto__keys-Mappingvalues__tokeys__missing,Avoiding__missing-keyerrors__sorting,Sorting__dictionary keys-Sortingdictionary__keystuple__keys,Using__dictionariesfor__sparsedata__structures:Tuple__keyskeys__method,Item__Iteration:for__Loopskeyword__argumentslist__order,Sorting__listsprint__operations,The__printfunction__inaction__keyword-only arguments, Keyword-Only Arguments-Why keyword-only arguments? keywords,Part__IV,Functions__and Generators-Part IV,Functions__andGenerators__argument matching,Argument__Matching Overview,Argument__Matching Syntax,Test__Your Knowledge:Answers__argument passing,Keyword__andDefault__Examples-Combiningkeywords__anddefaults__function validation,Generalizing__forKeywords__and Defaults-Generalizingfor__Keywordsand__Defaults required, Keyword-OnlyArguments__Kivy,GUIs__and UIs,Standalone__Appsand__ExecutablesL__lambda expression,Basic__Function Tools,lambda__MakesAnonymous__Functions-lambda__MakesAnonymous__Functions,lambda__Basics argument-matching syntax,lambda__Basics callbacks,Test__Your Knowledge:Answers__codeproximity__and,Multiway__branches:The__finaleloops__in,How__(Not)to__ObfuscateYour__PythonCode__name assignments,Name__Resolution:The__LEGBRule__names,Python__ScopesBasics__nesting, Scopes:lambdas__CanBe__NestedToo__nesting logic,How__(Not)to__ObfuscateYour__PythonCode__reasonsto__use,Why__Use lambda?-Multiway branches:The__finaleselection__logic,How__(Not)to__ObfuscateYour__PythonCode__lambdafunctions__callbacks,Function__Interfacesand__Callback-BasedCode__wrapper layers,Decorator__Nesting Latin-1,Character__Encodingslearning__curve,It__sRelatively__Easyto__LearnLEGB__rule,Name__Resolution:The__LEGB Rule-Preview:Other__Python scopes,Nested__Classes:The__LEGBScopes__Rule Revisited-Nested Classes:The__LEGBScopes__RuleRevisited__built-ins,Redefining__built-in names:For__betteror__worse-Redefining built-in names:For__betteror__worselen__function,Escape__SequencesAre__Special Characters,Test__Your Knowledge:Answers__sequence reordering,Sequence__Shufflers:range__andlen__lexical scoping,Python__Scopes Basics,Imports__VersusScopes__libraries,Why__DoPeople__Use Python? (seealso__standard library) utilities,It__sPowerful__like-a relationships,OOP__and Delegation: Like-a Relationships-OOPand__Delegation: Like-aRelationships__lines comparison,text__files,The__Termination-Handlers Shoot-OutLinux__Python installation,Installing__PythonPython__on,Using__Pythonon__Linux-UsingPython__onLinux__listcomprehension__pattern,map__function,Coding__YourOwn__maplist__comprehensions, Comprehensions,List__Comprehension Basics, Comprehensions:The__FinalAct__best use,When__touse__list comprehensions: Speed, conciseness, etc.-Whento__uselist__comprehensions: Speed, conciseness, etc.code__obfuscation and,When__notto__uselist__comprehensions:Code__obfuscation diagonals, Example:List__Comprehensionsand__Matrixesexpression__mapping,List__ComprehensionsReview__expressions, Comprehensions:The__FinalAct__arbitrary,List__ComprehensionsReview__files,List__Comprehensionsand__Files-ListComprehensions__andFiles__filter function,Generator__expressionsversus__filterfor__clauses, nested,Formal__ComprehensionSyntax__if clause,Filter__clauses: if,List__ComprehensionsReview__iteration,Formal__ComprehensionSyntax__map function,List__ComprehensionsReview__matrixes and, Example:List__Comprehensionsand__Matrixes-Whento__uselist__comprehensions: Speed, conciseness, etc.nested__for loops,Nested__loops:for__sequence operations, Conversions, methods,and__immutability syntax, formal,Formal__ComprehensionSyntax__lists,Why__Use Built-in Objects?,Test__Your Knowledge: Answers,Types__ShareOperation__Setsby__Categoriesas__literal expression,Lists__assignments,Assignment__SyntaxForms__bounds,Bounds__Checking breadth-first traversal,Recursion__versusqueues__andstacks__building,Test__Your Knowledge:Answers__characteristics, Lists-Listscompared__to tuples,Why__Listsand__Tuples? comparisons,Basic__List Operations, Comparisons, Equality,and__Truth comprehensions,List__comprehensionsand__maps-Listcomprehensions__andmaps__deletingone__item,More__ListMethods____dict__ attribute, Example:Listing__Moduleswith____dict__-Example:Listing__Moduleswith____dict__ dictionaries, sorting,Sorting__listsindex__assignments,Index__andslice__assignments-Indexand__sliceassignments__indexing,Indexing__and Slicing-Indexingand__Slicing iteration, Iteration, Comprehensions,and__Unpackingiteration__protocol, Reprise: Dictionaries, range, enumerate,and__zip literals,Lists__unpacking, List-literalunpacking__maps,List__comprehensionsand__maps-Listcomprehensions__andmaps__method calls,List__method calls-Listmethod__calls mutability,Lists__nesting, Nesting-Nesting operations,Lists__operators,Basic__ListOperations__ordering,Sorting__lists-Sortinglists__reversing,More__ListMethods__searching,Test__Your Knowledge:Answers__sequence operations,Sequence__Operationsslice__assignments,Index__andslice__assignments-Indexand__slice assignments,Other__ListOperations__slicing,Indexing__and Slicing-Indexingand__Slicing type-specific operations, Type-Specific Operations-Type-SpecificOperations__literal expressions,Python__sCore__ObjectTypes__dictionaries,Dictionaries__lists as,Lists__literal patterns,Advanced__matchUsage__literals,Python__sCore__ObjectTypes__dictionaries,Dictionaries__docstrings, User-defineddocstrings__f-string formatting,The__F-StringFormatting__Literal backslash, F-stringformatting__basicscustom__formats, F-stringcustom__formats quotes, F-stringformatting__basics REPL, F-stringformatting__basics substitutions, F-stringformatting__basics lists, unpacking, List-literalunpacking__string formatting, String-FormattingOptions__local scopes,Scopes__Overviewlocal__variables, Segue:Local__Variables-Segue:Local__Variables recursion,Scopes__Overviewstatic__locals,Function__Attributeslogic__alternatives,Test__Your Knowledge:Part__IIIExercises__LookupErrorexception__class, Built-inException__Classes loops,Part__III,Statements__andSyntax__attributeinterception__methods,Avoiding__loopsin__attributeinterception__methods coding,Test__Your Knowledge:Part__IIIExercises__comprehensions, Preview:Other__Pythonscopes__counters,range__object,Counter__Loops: range-Counter Loops:range__defaults,Loops__Require Defaults,Not__Scopes-LoopsRequire__Defaults,Not__Scopesdictionary__comprehensions,Dictionary__Comprehensionselse__clause,Loop__else-Whythe__loop else?enumerate__function,Offsets__and Items: enumerate-Offsetsand__Items:enumerate__for loops,Item__Iteration:for__Loops-Item Iteration:for__Loops,for__Loops,Common__CodingGotchas__data types,Basic__usage extended-unpacking assignments, Extended-unpackingassignment__infor__loops-Extended-unpackingassignment__infor__loopsin__functions, Definition-Definition __getitem__,Index__Iteration:__getitem____nested,Nested__for loops-Nestedfor__loops,Nested__loops:for__sequence assignment,Tuple__(sequence)assignment__infor__loops-Tuple (sequence)assignment__infor__loops targets,General__Formattuple__assignment,Tuple__(sequence)assignment__infor__loops-Tuple (sequence)assignment__infor__loops infinite,Examples__interactive,A__SimpleInteractive__Loop-ASimple__InteractiveLoop__floating-point numbers,Supporting__Floating-Point Numbers-Supporting__Floating-PointNumbers__mathon__user inputs,Doing__Mathon__User Inputs-DoingMath__onUser__Inputsnesting__code,Nesting__CodeThree__LevelsDeep__testing inputs,Handling__Errorsby__Testing Inputs-HandlingErrors__byTesting__Inputstry__statements,Handling__Errorswith__try Statements-HandlingErrors__withtry__Statementslambda__expression,How__(Not)to__ObfuscateYour__PythonCode__nested, multiple,Breaking__Outof__MultipleNested__Loops:go__to -BreakingOut__ofMultiple__Nested Loops:go__toobject__indexes,Examples__offsets,Offsets__and Items: enumerate-Offsetsand__Items:enumerate__versus recursion,Loop__StatementsVersus__Recursion-LoopStatements__VersusRecursion__sequence reordering,Sequence__Shufflers:range__andlen__sequence scans,Sequence__Scans: while, range,and__for-Sequence Scans: while, range,and__forskipping__items,Skipping__Items:range__andSlices__strings and,Basic__Operations variables,Enclosing__scopesand__loopvariables__while loops,while__Loops-Examplesbreak__statement, break, continue, pass,and__theLoop__else, break-The named-assignmentalternative__continue statement, break, continue, pass,and__theLoop__else-The nested-codealternative__do until,Examples__else statement, break, continue, pass,and__theLoop__elsepass__statement, break, continue, pass,and__theLoop__else-The ellipsis-literal__alternativezip__object,Parallel__Traversals: zip-Morezip__roles:dictionaries____lt__ method, Comparisons: __lt__, __gt__,and__Others-Comparisons: __lt__, __gt__,and__OthersM__machine code,Test__Your Knowledge:Answers__macOSinteractive__coding and,Starting__anInteractive__REPLPython__installation,Installing__PythonPython__on,Using__Pythonon__macOS-UsingPython__onmacOS__magnitude comparisons,Truth__ValuesRevisited____main__ attribute, Dual-Usage Modes:__name____and __main__-Example:Unit__Testswith____name__ __main__.py files,Package____main__.py Files-Usingthe__updatedpackage__manager functions,The__Downsideof__HelperFunctions__mangled names,Pseudoprivate__ClassAttributes__manual iteration,Manual__iteration manuals, standard,The__Standard Manuals-WebResources__map function,Mapping__Functionsover__Iterables: map-MappingFunctions__over Iterables:map__benchmarking,For__moregood__times:Function__callsand__map-Formore__good times:Function__callsand__map emulating, Example:Emulating__zipand__map-CodingYour__Ownzip__and 2.Xmap__iterables, multiple,Coding__YourOwn__maplist__comprehension pattern,Coding__YourOwn__maplist__comprehensions,List__ComprehensionsReview__nesting,Generator__expressionsversus__mapversus__generator expressions,Generator__expressionsversus__map-Generatorexpressions__versusmap__mapping,Test__Your Knowledge:Answers__mutability,Dictionaries__operations,Mapping__Operations-MappingOperations__mapping patterns,Advanced__matchUsage__mappings,Types__ShareOperation__Setsby__Categoriesmatch__statement,Missing__Keys:if__Testsmatch__statements,match__Statementsattribute__patterns,Advanced__matchUsage__if statements,Match__versusif__liveinstance__patterns,Advanced__matchUsage__literal patterns,Advanced__matchUsage__mapping patterns,Advanced__matchUsage__nested patterns,Advanced__matchUsage__nesting,Basic__matchUsage__parentheses,Advanced__matchUsage__sequence patterns,Advanced__matchUsage__syntax,Python__SyntaxRevisited__blocks,Block__Delimiters:Indentation__Rules-Avoidmixing__tabsand__spaces delimiters,Statement__Delimiters:Lines__andContinuations__indentation,Block__Delimiters:Indentation__Rules-Avoidmixing__tabsand__spacesspecial__syntax,Special__SyntaxCases__in Action-SpecialSyntax__Casesin__Actionmath__module,Numbers__mathematical operations,Numbers__user inputs,Doing__Mathon__User Inputs-DoingMath__onUser__Inputs matplotlib,Numeric__andScientific__Programming matrixes,list__comprehensions, Example:List__Comprehensionsand__Matrixes-When__touse__list comprehensions: Speed, conciseness, etc.memory__management,It__sPowerful__generators,Why__generators here: Space, time,and__moreobject__memory,Nesting__Revisited metaclass/class dichotomy,The__Metaclass/Class Dichotomy-The Metaclass/ClassDichotomy__metaclasses,Some__InstancesAre__MoreEqual__Than Others,Coding__Metaclasses attributes, Inheritance:The__Finaleclass__creation,Metaclasses__andInheritance__classdecorators__comparison,Metaclasses__VersusClass__Decorators:Round__1-MetaclassesVersus__Class Decorators:Round__1class__statements,Adding__methodsto__classes types,Class__StatementsCall__a type-ClassStatements__CanChoose__atype__construction,Customizing__Constructionand__Initializationdecorating__class methods,Automatically__decoratingclass__methods-Automatically__decoratingclass__methodsfactory__functions,Using__simplefactory__functions inheritance,The__Inheritance Bifurcation,Metaclasses__and Inheritance,Customizing__Constructionand__Initialization, Inheritance:The__Finale, Inheritance:The__Finale,Metaclass__Inheritance-MetaclassInheritance__names acquisition,Metaclass__VersusSuperclass__inheritance relationships, Inheritance:The__Finalemethod__protocol,Metaclass__MethodProtocol__methods,Metaclasses__and Inheritance,Metaclass__Methods adding,Adding__methodsto__classes-Addingmethods__toclasses__classmethods__comparison,Metaclass__MethodsVersus__ClassMethods__instancemethods__comparison,Metaclass__MethodsVersus__Instance Methods-MetaclassMethods__VersusInstance__Methodsoperator__overloading in,Operator__Overloadingin__MetaclassMethods__nonclass instances,Overloading__classcreation__callswith__normal classes-Overloading__classcreation__callswith__normalclasses__superclasses comparison,Metaclass__Versus Superclass-MetaclassVersus__Superclass types,Classes__AreInstances__of type-ClassesAre__Instancesof__type subclasses,Metaclasses__AreSubclasses__oftype__whento__use,To__Metaclassor__Notto__Metaclass metafunctions,Function__DecoratorBasics__function decorators,Usage__metaprograms,Module__Introspectionmethod__calls, Methods-Other Method-CallPossibilities__lists,List__method calls-Listmethod__calls syntax,Method__CallSyntax__methodcalls__(OOP),Method__Calls-MethodCalls__method objects,Method__Objects:Bound__or Not-BoundMethods__inAction__bound methods,Method__Objects:Bound__orNot__plain functions,Method__Objects:Bound__orNot__methodsattribute__fetches,Method__CallSyntax____bool__,Boolean__Tests:__bool____and__len____bound methods,Why__theSpecial__Methods?byte__strings,Methods__call expressions,Method__CallSyntax____call__,Call__Expressions: __call__-FunctionInterfaces__and Callback-Based__Codeclass__methods,Why__theSpecial__Methods?,Using__Staticand__Class Methods,Using__Staticand__ClassMethods__classes,Static__andClass__Methodsadding__to,Adding__methodsto__classes-Addingmethods__toclasses__method calls, Methods-Other Method-CallPossibilities____contains__, Membership: __contains__, __iter__,and____getitem__- Membership: __contains__, __iter__,and____getitem__ decorators,Supporting__method decoration,Class__Pitfall:Decorating__Methods descriptors,Using__descriptorsto__decorate methods-Usingdescriptors__todecorate__methodsnested__functions,Using__nestedfunctions__todecorate__methods __del__,Object__Destruction: __del__-DestructorUsage__Notes dictionaries,More__Dictionary Methods-MoreDictionary__Methodsdouble__underscores,Classes__CanIntercept__PythonOperators__encapsulation,Coding__Methods find,Changing__Strings,Part__2:String__Methods __get__,Inserting__Codeto__Runon__AttributeAccess____getattr__,Other__Waysto__Combine Classes: Composites,Attribute__Reference,Inserting__Codeto__Runon__AttributeAccess____getattribute__,Inserting__Codeto__Runon__AttributeAccess____getitem__,Intercepting__Slices-InterceptingSlices____gt__, Comparisons: __lt__, __gt__,and__Others-Comparisons: __lt__, __gt__,and__Others __iadd__, In-PlaceAddition____index__,But____index__Means__As-Integer inherited,Specializing__Inherited Methods-SpecializingInherited__Methods instance,Why__theSpecial__Methods?instance__methods,Using__Staticand__ClassMethods____iter__,Iterable__Objects:__iter____and __next__, User-Defined Iterables-Classes__versusgenerators__join,Changing__Strings,Part__2:String__Methods __lt__, Comparisons: __lt__, __gt__,and__Others-Comparisons: __lt__, __gt__,and__Others metaclasses,Metaclasses__and Inheritance,Metaclass__Method Protocol,Metaclass__Methods-MetaclassMethods__VersusInstance__Methods __next__,Iterable__Objects:__iter____and__next____OOP,Coding__ClassTrees__operator overloading,Common__Operator-Overloading Methods-Common Operator-OverloadingMethods__plain-function, Plain-Function Methods-Plain-FunctionMethods____radd__, Right-SideAddition__replace,Changing__Strings,Part__2:String__Methods,Changing__Strings,Part__2:String__Methods __repr__,String__Representation:__repr____and__str____scopes,Scopes__inMethods__and Classes-Scopesin__Methodsand__Classes __set__,Inserting__Codeto__Runon__AttributeAccess____setattr__,Attribute__Assignmentand__Deletion-AttributeAssignment__and Deletion,Inserting__Codeto__Runon__AttributeAccess__split,More__String Methods:Parsing__Text standard-library manual,All__StringMethods__(Today) static,Other__Method-Call Possibilities,Static__andClass__Methods-UsingStatic__andClass__Methods __str__,Why__TwoDisplay__Methods?-DisplayUsage__Notesstring__formatting, String-FormattingOptions__format method,The__String-Formatting Method-Advancedformatting__methodexamples__string methods,String__Methods syntax,Method__CallSyntax__strings, Type-Specific Methods-Type-SpecificMethods__subclasses,Augmenting__Methods:The__Bad Way-Augmenting Methods:The__GoodWay__superclass,Specializing__InheritedMethods__tuples, Conversions, methods,and__immutability-Conversions, methods,and__immutability __setitem__,Intercepting__ItemAssignments__methods (OOP),A__FirstExample__MicroPython,Python__ImplementationAlternatives__Microsoft Store,Using__Pythonon__Windowsminimalism__of Python,Software__Quality mins.py, Example:The__minWakeup__Call-ThePunch__Line mix-inclasses__attribute lists, Example: Mix-inAttribute__Listersclass__trees,Listing__attributesper__objectin__class trees-Listingattributes__perobject__inclass__trees __dict__,Listing__instanceattributes__with __dict__-Listinginstance__attributeswith____dict__ __dir__,Listing__inheritedattributes__with dir-Listinginherited__attributeswith__dir mixed-type comparisons, Comparisons, Equality,and__Truthmodule__packages (see packages)module__search path,The__ModuleSearch__Path built-in modules,The__ModuleSearch__Path configuring,Configuring__theSearch__Pathfile__selection,Module__File Selection-Selectionpriorities__file sources,Module__sourceshome__directory, Search-PathComponents__packages,Path__Outliers:Standalones__and Packages,Packages__andthe__ModuleSearch__Path .pth path-file directory, Search-PathComponents__PYTHONPATH directory, Search-Path Components-Configuringthe__SearchPath__site-packages directory, Search-PathComponents__standalones,Path__Outliers:Standalones__andPackages__standard-library directories, Search-PathComponents__sys.path list,The__sys.path List-Changingthe__modulesearch__path modules,Program__Files,Part__I,Getting__Started attributes,Module__attributes:a__first look-Module attributes:a__first look,Creating__Modules classes,Classes__AreAttributes__in Modules-ClassesAre__Attributesin__Modules creating,How__FilesGenerate__Namespaces __dict__,Namespace__Dictionaries: __dict__-Namespace Dictionaries:__dict____names, qualification,Attribute__Name Qualification-AttributeName__Qualification classtools,Name__Considerationsin__ToolClasses__code reuse,Why__Use Modules? cohesion,Module__DesignConcepts__collector,Part__V,Modules__andPackages__coupling,Module__DesignConcepts__creating,Creating__Modules-OtherKinds__ofModules__defining,Creating__Modules designing,Module__DesignConcepts__exercise,Test__Your Knowledge:Part__IExercises__extension modules,Other__Kindsof__Modulesfile__names,Module__attributes:a__firstlook__filenames,Module__Filenames-ModuleFilenames__files,Program__Filesfrom__* statement,The__from * Statement-Thefrom__*Statement__from statement,Module__Essentials,The__fromStatement__potential problems,Potential__Pitfallsof__thefrom__Statement-Whenimport__isrequired__global scope,Why__Use Modules?import__statement,Module__Essentials,The__import Statement-Theimport__Statement importing,Importing__modules,Test__Your Knowledge: Answers,Imports__and Attributes-Step 1:Find__It bytecode,Step__2:Compile__It (Maybe)-Step 2:Compile__It (Maybe)bytecode__execution,Step__3:Run__Itprevious__imports,Step__2:Compile__It (Maybe) importlib.reload,Module__Essentialsimports__direct calls,Direct__Calls:Two__Optionsinitialization__code,Initialization__codename__strings,Importing__Modulesby__Name String-Testingreload__variantsnamespace__nesting,Namespace__Nesting-NamespaceNesting__one-time,Imports__HappenOnly__Onceruntime__assignment,Imports__AreRuntime__Assignments-Cross-filename__changesstatement__order,Statement__OrderMatters__in Top-Level Code-Statement__OrderMatters__in Top-LevelCode__variables,Imports__Versus Scopes-ImportsVersus__Scopes json,The__pickleand__jsonSerialization__Modules-Thepickle__andjson__SerializationModules__listing,__dict____attribute, Example:Listing__Moduleswith____dict__- Example:Listing__Moduleswith____dict__ __main__, Dual-Usage Modes:__name____and __main__-Example:Unit__Testswith____name__math__module,Numbers__mutables, changing,Changing__mutablesin__modules __name__, Dual-Usage Modes:__name____and __main__-Example:Unit__Testswith____name__ namespaces,Why__Use Modules? dictionaries,How__FilesGenerate__Namespaces-Namespace Dictionaries:__dict____generating,How__FilesGenerate__Namespaces-HowFiles__GenerateNamespaces__initialization,The__Rolesof____init__.pyFiles__nesting,Namespace__Nesting-NamespaceNesting__partitioning,Why__Use Modules? nested, attributes,Using__thebasic__package pickle,Pickles__and Shelves,The__pickleand__jsonSerialization__Modules-Thepickle__andjson__SerializationModules__program architecture,Importing__modules,How__toStructure__aProgram__random,Numbers__re,The__re Pattern-MatchingModule__redundancy,Why__Use Modules?reload__function,Reloading__Modules-reloadOdds__andEnds__reloads,Reloading__modules, Example:Transitive__ModuleReloads__recursive reloaders,A__recursive reloader-Testingreload__variantsscopes__imports and,How__FilesGenerate__Namespaces variables,Imports__Versus Scopes-ImportsVersus__Scopes shelve,Pickles__and Shelves,The__shelvemodule__standard-library modules, Standard-LibraryModules__statements,The__PythonConceptual__Hierarchy import,How__FilesGenerate__Namespaces strings,String__ObjectBasics__struct,The__struct Binary-DataModule__using,Using__Modules-Whenimport__isrequired__versus classes,Classes__VersusModules__MRO (methodresolution__order),Multiple__Inheritanceand__the MRO,How__theMRO__Works-Howthe__MROWorks__attribute fetch, Attribute-fetchalgorithm__class inheritance,Universal__deploymentclass__trees,Python__Inheritance Algorithm:The__Simple Version,Python__Inheritance Algorithm:The__LessSimple__Version deployment,Universal__deploymentas__flattened tree,The__InheritanceBifurcation__inheritance,The__InheritanceBifurcation__super function,A__magic proxy-Amagic__proxy__mro____attribute,How__theMRO__Works, Example:Mapping__Attributesto__Inheritance Sources,The__Inheritance Bifurcation, Attribute-fetch algorithm,Metaclass__VersusSuperclass__multiline statements,Running__CodeInteractively__multiline strings,Triple__Quotesand__Multiline Strings-TripleQuotes__andMultiline__Stringsmultiline__text, triple-quoted strings,Triple__Quotesand__MultilineStrings__multiple inheritance,Multiple__Inheritanceand__theMRO__attribute conflicts,Attribute__Conflict Resolution-AttributeConflict__ResolutionDFLR__(depth first,left__to right),Multiple__Inheritanceand__theMRO__inheritance sources, Example:Mapping__Attributesto__Inheritance Sources- Example:Mapping__Attributesto__InheritanceSources__mix-in classes,attribute__lists, Example: Mix-inAttribute__Listers-Listingattributes__perobject__inclass__treesMRO__(methodresolution__order),Multiple__Inheritanceand__the MRO,How__theMRO__Works-Howthe__MROWorks__order,Multiple__Inheritance:Order__Matters-Multiple Inheritance:Order__Matters overview,How__MultipleInheritance__Works-HowMultiple__InheritanceWorks__slots,Slot__usagerules__multiple-target assignments,Assignment__Syntax Forms, Multiple-TargetAssignments__shared references, Multiple-targetassignment__andshared__references- Multiple-targetassignment__andshared__references multiplication,Numbers__multitasking,async__function,Async__Basics multithreading,global__variables,Program__Design:Minimize__GlobalVariables__multiway branching, dictionaries,Multiway__branches:The__finalemutability__dictionaries, Dictionaries, Dictionaries,Changing__Dictionariesin__Place-Changing__Dictionariesin__Place in-place changes,Shared__Referencesand__In-PlaceChanges__lists,Lists__mutable defaults,Combining__keywordsand__defaults objects,changing__in place,Core__TypesReview__andSummary__strings, Immutability-Immutabilitymutable__arguments, Argument-PassingBasics__changes,Avoiding__MutableArgument__Changes-AvoidingMutable__ArgumentChanges__coupling,Function__DesignConcepts__mutableobjects__changing,Changing__mutablesin__modules functions,Defaults__andMutable__Objects-Defaultsand__MutableObjects__mutable types,Mutable__TypesCan__BeChanged__inPlace__mutables, assignments,Common__CodingGotchas__Nname__annotations,basic__assignment,Basic__Assignmentsname__assignments,nested__scopes,Nested__ScopesOverview____name__ attribute, Dual-Usage Modes:__name____and __main__-Example:Unit__Testswith____name__name__clashes,Potential__Pitfallsof__thefrom__Statement,The__asExtension__forimport__and from,Module__Name Clashes:Package__and Package-RelativeImports__name collisions,tool__classes,Name__Considerationsin__ToolClasses__name mangling,Pseudoprivate__ClassAttributes__name references,nested__scopes,Nested__ScopesOverview__name strings,module__imports,Importing__Modulesby__NameString__code strings, running,Running__CodeStrings__direct calls,Direct__Calls:Two__Options reloads, Example:Transitive__Module Reloads-Testingreload__variantsnamed__assignment expression,Assignment__Syntax Forms,Named__Assignment Expressions-Whento__usenamed__assignmentnamed__tuples,Records__Revisited:Named__Tuples-Records Revisited:Named__Tuplesnames__aliasing,Arguments__andShared__References assignments, Assignments,Scopes__Overview,Name__Resolution:The__LEGBRule__def statement,Python__ScopesBasics__def statements,Name__Resolution:The__LEGBRule__global statements,Name__Resolution:The__LEGBRule__in-place changes,Scopes__Overviewlambda__expressions,Python__ScopesBasics__lambda statements,Name__Resolution:The__LEGBRule__LEGB rule,Name__Resolution:The__LEGB Rule-Preview:Other__Pythonscopes__local,Scopes__Overviewnonlocal__statements,Name__Resolution:The__LEGBRule__references,Name__Resolution:The__LEGBRule__variables,Module__Filenamesnamespace__packages,Module__Packages,Using__theupdated__package,Namespace__Packagesmodule__searches,The__ModuleSearch__Algorithm-TheModule__SearchAlgorithm__namespaces,Python__Scopes Basics,Why__Use Modules?,Testing__asYou__Go assignments,The__Zenof__Namespaces:Assignments__Classify Names-TheZen__of Namespaces:Assignments__ClassifyNames__classes hierarchies,Why__Use Classes? inheritance, Example:Class__Attributes dictionaries, Classes:Under__the Hood,Namespace__Dictionaries: Review-Namespace__Dictionaries:Review__slots and,Slot__basics-Slotsand__namespacedictionaries__generating,How__FilesGenerate__Namespaces-HowFiles__GenerateNamespaces__global,Simple__Names:Global__UnlessAssigned__global statements,The__global Statement-Theglobal__Statement links,Namespace__Links:A__Tree Climber-Namespace Links:A__TreeClimber__modules dictionaries,How__FilesGenerate__Namespaces-Namespace Dictionaries:__dict______init__.py files,The__Rolesof____init__.pyFiles__nesting,Namespace__Nesting-NamespaceNesting__partitioning,Why__Use Modules?namespace__trees,Attribute__TreeConstruction__object namespaces,Attribute__Names:Object__Namespaces-Attribute Names:Object__Namespaces OOP,Classes__andInstances__naming variables,Variable__Name Rules-Nameshave__no type,but__objectsdo__nested calls,Numbers__nested modules,Using__thebasic__packagenested__patterns,match__statements,Advanced__matchUsage__nested scopes,Nested__Scopes Examples-NestedScopes__Examplesarbitrary__nesting,Arbitrary__ScopeNesting__name assignments,Nested__ScopesOverview__name references,Nested__ScopesOverview__nestedstatement__blocks,What__PythonAdds__special cases,Block__rulespecial__case-Blockrule__specialcase__nesting,Test__Your Knowledge:Part__II Exercises,Part__II,Objects__andOperations__assigningnested__sequences,Advanced__sequence-assignmentpatterns__classes, scope,Nested__Classes:The__LEGBScopes__Rule Revisited-Nested Classes:The__LEGBScopes__RuleRevisited__combined clauses,try__statement,Combining__finallyand__exceptby__nesting composites,Other__Waysto__Combine Classes:Composites__decorators,Decorator__Nesting-Decorator Nesting,Decorator__nesting descriptors,A__FirstExample__dictionaries,Nesting__Revisited-Nesting Revisited,Nesting__indictionaries__exception groups, Example: Control-FlowNesting__exception handlers,Nesting__ExceptionHandlers__control-flow, Example: Control-Flow Nesting-Example: Control-FlowNesting__syntactic nesting, Example:Syntactic__Nesting-Example:Syntactic__Nestingfor__loops,Nested__for loops-Nestedfor__loops functions,decorating__methods,Using__nestedfunctions__todecorate__methodsgenerator__expressions,Generator__expressionsversus__map imports,Part__V,Modules__andPackages__interactive loops,Nesting__CodeThree__LevelsDeep__iterators,Iterator__nestinglambda__expression, Scopes:lambdas__CanBe__NestedToo__loops, multiple,Breaking__Outof__MultipleNested__Loops:go__to -BreakingOut__ofMultiple__Nested Loops:go__tomap__function,Generator__expressionsversus__mapmatch__statements,Basic__matchUsage__namespaces,in__modules,Namespace__Nesting-NamespaceNesting__package folders,Basic__PackageStructure__while loops,The__nested-codealternative__nesting objects, Nesting-Nesting .NETFramework__for Windows, IronPython,Python__ImplementationAlternatives__newline character,Escape__SequencesAre__Special Characters,Files__in Action,Text__andBinary__Modes__next____method,Iterable__Objects:__iter____and__next____nonclass instances,Some__InstancesAre__MoreEqual__ThanOthers__inheritance,The__InheritanceBifurcation__metaclasses,Overloading__classcreation__callswith__normal classes-Overloading__classcreation__callswith__normalclasses__None object,Booleans__and None,The__Noneobject__nonemptydata__structures,The__Meaningof__Trueand__Falsein__Pythonnonlocal__statement,Advanced__Function Tools,The__nonlocal Statement-nonlocalBoundary__Casesstate__retention and, Nonlocals: Changeable, Per-Call,LEGB__normalization, Unicode,Unicode__Normalization:Whither__Standard?-Unicode Normalization:Whither__Standard? Notepad,BOM__(byteorder__marker),Making__BOMsin__Text Editors-MakingBOMs__inText__Editors Nuitka,Python__ImplementationAlternatives__NULL character,Escape__SequencesAre__SpecialCharacters__Numba,Numeric__andScientific__Programming,Python__Implementation Alternatives,Test__Your Knowledge:Answers__number types, files,Core__TypesReview__andSummary__numbers,Test__Your Knowledge:Answers__comparisons, Comparisons, Equality,and__Truth complex,Numbers__decimals, Numbers,Types__ShareOperation__Setsby__Categories floating-point, Numbers,Test__Your Knowledge:Answers__floating-point numbers,Types__ShareOperation__Setsby__Categories fractions,Types__ShareOperation__Setsby__Categories integers, Numbers,Types__ShareOperation__Setsby__Categoriesmathematical__operations,Numbers__rationals,Numbers__sets,Numbers__trueand__false,The__Meaningof__Trueand__Falsein__Python types,Test__Your Knowledge:Answers__numeric programming,Numeric__andScientific__Programming NumPy,Why__DoPeople__Use Python?, OK,but__Whats__the Downside?,Numeric__andScientific__ProgrammingO__obfuscation,list__comprehensions and,When__notto__uselist__comprehensions:Code__obfuscationobject__classas__superclass,Some__InstancesAre__MoreEqual__ThanOthers__inheritancetype__class,And__Oneobject__toRule__ThemAll__object factories,Testing__asYou__Go,Classes__Are Objects:Generic__Object Factories-Why Factories?object__indexes, loops,Examples__object memory,Nesting__Revisitedobject__model classes, user-defined,Classes__AreTypes__Are Classes-ClassesAre__TypesAre__Classes instances, metaclasses,Some__InstancesAre__MoreEqual__ThanOthers__object namespaces,Attribute__Names:Object__Namespaces-Attribute Names:Object__Namespacesobject__serialization,Storing__Objectswith__pickleobject__storage, conversions,Storing__Objectswith__Conversions-StoringObjects__withConversions__object types,It__s Powerful,Python__sCore__Object Types,Test__Your Knowledge:Answers__(seealso__types) built-inscyclic__data structures,Beware__ofCyclic__DataStructures__extending,Extending__Built-inObject__Types-ExtendingTypes__bySubclassing__immutable types,Immutable__TypesCan__tBe__Changedin__Place references,Assignment__Creates References,Not__Copies repetition,Repetition__AddsOne__LevelDeep__hierarchy,Python__sType__Hierarchies object-based code, OOP:The__BigPicture__object-oriented language,Is__Pythona__ScriptingLanguage__?,It__s Object-Oriented__andFunctional__object-oriented, definition, User-DefinedObjects__object-relational mappers,Internet__andWeb__Scripting objects,Introducing__Python Objects, Variables, Objects,and__References aggregation,Other__Waysto__Combine Classes:Composites__attributes,The__dirFunction__name strings,The__dirFunction__type names,The__dirFunction__Booleans,Booleans__andNone__built-in,Why__Use Built-in Objects?-WhyUse__Built-in Objects? bytearray,The__bytearray Object,The__bytearray Object-Thebytearray__Object bytes,Unicode__andByte__Strings,The__bytesObject__calling,core__object types,Python__sCore__ObjectTypes__categories,Core__TypesReview__andSummary__class objects,Attribute__Inheritance Search,Classes__GenerateMultiple__InstanceObjects__default behavior,Class__ObjectsProvide__DefaultBehavior__classes, docstrings, User-defineddocstrings__comparisons, Comparisons, Equality,and__Truth-Dictionarycomparisons__coreobject__types, Comparisons, Equality,and__Truth copies,References__Versus Copies-ReferencesVersus__Copies copying,Shared__Referencesand__In-PlaceChanges__databases,storage__in,Step__7 (Final):Storing__Objectsin__aDatabase__pickle module,Pickles__andShelves__shelfobject__update,Updating__Objectson__aShelf__shelve database,Storing__Objectson__ashelve__Database-ExploringShelves__Interactivelyshelve__module,Pickles__and Shelves,The__shelvemodule__dynamic typing, Variables, Objects,and__References embedding,Other__Waysto__Combine Classes:Composites__expressions,The__PythonConceptual__Hierarchyfile__objects,Files__first-classobject__model,The__First-ClassObject__Model-The First-ClassObject__Model flexibility,Object__Flexibility-ObjectFlexibility__garbagecollection__and,Objects__Are Garbage-Collected-ObjectsAre__Garbage-Collectedgenerator__objects,Generator__Expressions:Iterables__Meet Comprehensions,Generator__FunctionsVersus__Generator Expressions,Coding__Alternative:__iter____Plus yield-Multipleiterators__withyield__implementation-related,Python__sCore__ObjectTypes__in-place changes,Shared__Referencesand__In-Place Changes-SharedReferences__and In-PlaceChanges__instance objects,Attribute__Inheritance Search,Classes__GenerateMultiple__Instance Objects,Instance__ObjectsAre__ConcreteItems__attributes,Coding__Constructorsiterable__(seeiterable__objects)method__objects,Method__Objects:Bound__or Not-BoundMethods__inAction__bound methods,Method__Objects:Bound__orNot__plain functions,Method__Objects:Bound__orNot__mutablechanging__in place,Core__TypesReview__andSummary__functions,Defaults__andMutable__Objects-Defaultsand__MutableObjects__namespace objects,Testing__asYou__Go nesting, Nesting-Nesting None,Booleans__and None,The__Noneobject__operation sharing,Core__TypesReview__andSummary__program units,Python__sCore__ObjectTypes__properties,class__statement,Property__basics Pydoc,Getting__Helpreference__counts,Nesting__Revisited references,References__Versus Copies-ReferencesVersus__Copies assignments,Assignments__dictionaries,Dictionaries__sets, Sets-Sets,Part__VI,Classes__andOOP__shared objects,Shared__Referencesslice__objects,Intercepting__Slicesstate__information,Function__Attributesstorage__CSV module,Storing__Objectswith__OtherTools__JSON,Storing__Objectswith__JSON-StoringObjects__withJSON__pickle module,Storing__Objectswith__pickle-StoringObjects__withpickle__struct module,Storing__Objectswith__OtherTools__str,The__strObject__type objects, Types-Types types,Types__Livewith__Objects,Not__Variables offsets,Offsets__and Items: enumerate-Offsetsand__Items:enumerate__OO (object-oriented) code, OOP:The__BigPicture__OO (object-oriented), definition,Why__DoPeople__Use Python?OOP__(object-oriented programming),Why__DoPeople__Use Python?, OOP:The__BigPicture__arguments, functions,Why__Use Classes?attribute__fetches,Attribute__Inheritance Search-AttributeInheritance__Searchclass__objects,Classes__GenerateMultiple__InstanceObjects__default behavior,Class__ObjectsProvide__DefaultBehavior__class statement, User-DefinedObjects__class trees,Coding__Class Trees-CodingClass__Trees,Part__VI,Classes__andOOP__classes,Attribute__Inheritance Search,Step__1:Making__Instances constructors,Coding__Constructors-CodingConstructors__inheritance,Classes__AreCustomized__by Inheritance-ASecond__Exampleintercepting__operators,Classes__CanIntercept__Python Operators-Other operator-overloadingmethods__methods,Step__2:Adding__Behavior Methods-CodingMethods__methods, augmenting,Augmenting__Methods:The__Bad Way-Augmenting__Methods:The__GoodWay__subclasses,Classes__AreCustomized__byInheritance__subclassing,Coding__Subclasses-Augmenting Methods:The__GoodWay__superclasses,Attribute__Inheritance Search,Classes__AreCustomized__byInheritance__testing,Testing__asYou__Go-Testingas__YouGo__code reuse,OOP__IsAbout__Code Reuse-Programmingby__customization,Test__Your Knowledge:Part__VIExercises__composition,Why__Use Classes?,OOP__and Composition: Has-a Relationships-StreamProcessors__Revisited consistency,Test__Your Knowledge:Part__VIExercises__delegation,OOP__and Delegation: Like-a Relationships-OOPand__Delegation: Like-aRelationships__encapsulation,Python__and OOP,Test__Your Knowledge:Part__VIExercises__frameworks,Programming__bycustomization__inheritance,Why__Use Classes?,Python__and OOP-OOPand__Inheritance: Is-a__Relationships attributes,Attribute__Inheritance Search-AttributeInheritance__Searchmultiple__inheritance,Coding__ClassTrees__search attribute,Why__Use Classes?instance__objects,Instance__ObjectsAre__ConcreteItems__instances,Why__Use Classes?,Attribute__Inheritance Search,Classes__GenerateMultiple__InstanceObjects__maintenance,Test__Your Knowledge:Part__VIExercises__method calls,Method__Calls-MethodCalls__methods,Coding__Class Trees,A__FirstExample__namespaces,Classes__andInstances__operator overload,Why__Use Classes?,Operator__Overloadingoperator__overloading,Step__3:Operator__Overloadingprint__displays,Providing__Print Displays-ProvidingPrint__Displays polymorphism,Polymorphism__and classes-Polymorphismand__classes,Polymorphism__in Action-Polymorphismin__Action,Python__and OOP,Test__Your Knowledge:Part__VIExercises__reloading,Classes__GenerateMultiple__InstanceObjects__search attribute,Why__Use Classes? structure,Test__Your Knowledge:Part__VIExercises__open function,Other__File-Like Tools,Redefining__built-in names:For__betteror__worse customizing,Test__Your Knowledge:Answers__operations dictionaries,Dictionaries__mapping,Mapping__Operations-MappingOperations__strings,Basic__Operations-BasicOperations__operator overloading,Core__TypesReview__and Summary,Classes__CanIntercept__Python Operators,Step__3:Operator__Overloading,The__Basics,Part__VI,Classes__andOOP__attribute privacy,Emulating__Privacyfor__Instance Attributes:Part__1-Emulating__Privacyfor__Instance Attributes:Part__1attributes__assignment,Attribute__Assignmentand__Deletion-AttributeAssignment__andDeletion__deleting,Attribute__Assignmentand__Deletion-AttributeAssignment__andDeletion__references,Attribute__ReferenceBoolean__tests,Boolean__Tests:__bool____and__len____call expressions,Call__Expressions: __call__-FunctionInterfaces__and Callback-BasedCode__classtype__propagation,Propagating__class type-Propagatingclass__typecomparison__operators, Comparisons: __lt__, __gt__,and__Others constructors,Constructors__and Expressions:__init____and__sub______contains__ method, Membership: __contains__, __iter__,and____getitem__-Membership: __contains__, __iter__,and____getitem__ descriptors, Workaround:Generating__operator-overloading descriptors- Workaround:Generating__operator-overloadingdescriptors__destructors,Object__Destruction: __del__-DestructorUsage__Notesdisplay__formats,String__Representation:__repr____and __str__-DisplayUsage__Notes expressions,Constructors__and Expressions:__init____and__sub____fallback options, Membership: __contains__, __iter__,and____getitem__- Membership: __contains__, __iter__,and____getitem____getattr____method,__getattr____and__getattribute______getattribute__ method,__getattr____and__getattribute______iadd__ method, In-PlaceAddition__in-place addition, In-PlaceAddition__index iteration,Index__Iteration: __getitem__-Index Iteration:__getitem____instance indexing,Indexing__and Slicing:__getitem____and __setitem__-But__index____Means As-Integeriterable__objects,Iterable__Objects:__iter____and __next__-Iterable Objects:__iter____and__next____multiple,Multiple__Iteratorson__One Object-Classesversus__slices user-defined iterables, User-Defined Iterables-Classesversus__generatorsmetaclass__methods,Operator__Overloadingin__MetaclassMethods__methods,Common__Operator-Overloading Methods-Common Operator-Overloading__Methodsinline__coding, Workaround:Coding__operator-overloadingmethods__inline-Workaround:Coding__operator-overloadingmethods__inline superclasses, Workaround:Coding__operator-overloadingmethods__in superclasses-Workaround:Coding__operator-overloadingmethods__insuperclasses__object comparisons, Comparisons: __lt__, __gt__,and__Others- Comparisons: __lt__, __gt__,and__Others OOP,Why__Use Classes?,Operator__Overloadingprint__displays,Providing__Print Displays-ProvidingPrint__Displays__radd____method, Right-SideAddition____add__ reuse,Reusing____add__in____radd__ results,Returning__resultsor__not right-side addition, Right-Side Addition-Propagatingclass__type strings,Basic__Operationssuper__function,Noncalls__andoperator__overloading-Noncallsand__operatoroverloading__operatorsgeneric__operations,Part__II,Objects__andOperations__lists,Basic__ListOperations__optimization tools,Development__Toolsfor__LargerProjects__ordinals,String__comparisonsORMs__(object-relational mappers),Database__Accessos__module, Command-linelaunchers__descriptor files,Other__FileTools__OSErrorexception__class, Built-inException__Classesoutput__buffering,Opening__Filesoverloading__operators,Core__TypesReview__andSummary__P package-relative imports,Module__Packages absolute,Relative__andAbsolute__Imports,Relative__andAbsolute__Importsname__clashes,Module__Name Clashes:Package__and Package-RelativeImports__relative,Relative__andAbsolute__Imports-The absolute-import solution,Python__ImportModels__packages benefits,Why__Packages?-ATale__ofTwo__Systems dotted-path syntax,Package__Importsmodule__import,Using__thebasic__packagerelative__imports, Relative-ImportRationales__and Trade-Offs encapsulation,Python__andOOP__folder bundles,Module__Packagesfolders__names,Basic__PackageStructure__nesting,Basic__PackageStructure__imports,Module__Packages,Package__Imports,Python__Import Models,Part__V,Modules__andPackages__folder hierarchies,Package__Importsfrom__statement,Using__thebasic__package modules,Using__thebasic__package-Usingthe__basicpackage____init__.py file,Package____init__.py Files-Usingthe__updated package,The__Rolesof____init__.pyFiles____init__.pyfiles__initialization,The__Rolesof____init__.pyFiles____main__.py file,Package____main__.py Files-Usingthe__updatedpackage__modulesearch__path and,Packages__andthe__ModuleSearch__Pathname__clashes,Module__Name Clashes:Package__and Package-RelativeImports__namespace packages,Module__Packages,Using__theupdated__package,Namespace__Packages-NamespacePackages__inAction__module searches,The__ModuleSearch__Algorithm-TheModule__SearchAlgorithm__regular packages,Using__theupdated__package pandas,Numeric__andScientific__Programmingparallel__programming,async__functions,Asynchronous__Functions:The__ShortStory__parameters, functions,def__Statements parentheses,Common__CodingGotchas__function calls,Common__CodingGotchas__lambda expression,lambda__Basics statements,Parentheses__areoptional__tuples,Tuple__syntax peculiarities:Commas__and parentheses-Tuplesyntax__peculiarities:Commas__andparentheses__parsing slicing,Indexing__andSlicing__text,string__methods,More__String Methods:Parsing__Textpass__statements, break, continue, pass,and__theLoop__else pathnames,Filenames__inopen__andOther__Filename Tools-Filenamesin__openand__OtherFilename__Toolspatterns__factory functions,Closures__andFactory__Functions-Closuresand__FactoryFunctions__re module,The__re Pattern-MatchingModule__sequence assignments,Advanced__sequence-assignmentpatterns__structuralpattern__matching,match__Statements per-call scopes,Scopes__Overview performance,Performance__implicationslist__comprehensions,When__touse__list comprehensions: Speed, conciseness, etc. permutation, sequences,Permutating__Sequences-Whygenerators__here: Space, time,and__more persistence,Stream__ProcessorsRevisited__pickle module,Test__Your Knowledge: Answers,Pickles__and Shelves,The__pickleand__jsonSerialization__Modules-Thepickle__andjson__SerializationModules__object storage,Storing__Objectswith__pickle-StoringObjects__withpickle__pickle objects,Database__Access,Stream__ProcessorsRevisited__pipes,Other__FileTools__plain functions,Method__Objects:Bound__or Not,Why__theSpecial__Methods? plain-function methods, Plain-Function Methods-Plain-FunctionMethods__pointers, Variables, Objects,and__References polymorphism,Sequence__Operations, Types,Test__Your Knowledge: Answers,Polymorphism__in Python-Polymorphismin__Python,Polymorphism__and classes-Polymorphism__and classes,Polymorphism__in Action-Polymorphismin__Action,Python__and OOP,Part__IV,Functions__andGenerators__dynamic typing,Dynamic__TypingIs__Everywhereinterfaces__and,Polymorphism__Means Interfaces,Not__CallSignatures__intersect function,Polymorphism__Revisitedstrings__and,Basic__Operationspopularity__riseof__Python,The__PythonUpside__portability,Why__DoPeople__Use Python?,It__sPortable__PortableOperating__SystemInterface__(POSIX),Systems__Programmingpositional__arguments,A__Basic Range-TestingDecorator__forPositional__Arguments-ABasic__Range-TestingDecorator__forPositional__Arguments positionals,argument__matching,Argument__MatchingOverview__POSIX (PortableOperating__System Interface),Systems__Programmingprecision__inlarge__numbers,Numbers__print emulator, keyword-only arguments,Using__Keyword-OnlyArguments__print function,The__printfunction__in action-Theprint__functionin__actionargument__matching, Example:Rolling__YourOwn__Print-Using Keyword-Only__Argumentscall__format,Call__format-Callformat__end-of-line character,The__printfunction__inaction__f-strings,The__printfunction__inaction__keyword arguments,The__printfunction__inaction__print operations,Print__Operationsfile__object methods,Print__Operationsprint__statement,Test__Your Knowledge:Answers__printstream__redirection automatic,Automatic__stream redirection-Automaticstream__redirectionhello__world,The__Pythonhello__worldprogram__manual,Manual__stream redirection-Manualstream__redirectionstandard__output streams,Print__Operations stdout,Test__Your Knowledge:Answers__print statements,The__Programmers__Viewprint__streamredirecting__automatic,Automatic__stream redirection-Automaticstream__redirectionhello__world,The__Pythonhello__worldprogram__manual,Manual__stream redirection-Manualstream__redirection print,viewing__docstrings, User-defineddocstrings__printing exceptions, built-in,Default__Printingand__State-DefaultPrinting__andState__custom printing,Custom__Print Displays-CustomPrint__Displaysoperator__overloading and,Providing__Print Displays-ProvidingPrint__Displays procedures,Why__Use Functions? productivity, developers,Why__DoPeople__Use Python?,Developer__Productivity profilers,Development__Toolsfor__LargerProjects__programarchitecture__attributes,Imports__and Attributes-Importsand__Attributesfiles__text files,How__toStructure__aProgram__top-level,How__toStructure__aProgram__modules files,How__toStructure__aProgram__importing,Imports__and Attributes-Standard-LibraryModules__standard-library, Standard-LibraryModules__programdesign__(see design)program__execution,The__Programmers__Viewprogram__filescommand__line,Program__Files-RunningFiles__withCommand__Linesfile__icons,Clicking__andTapping__FileIcons__modules,Program__Filesnaming__convention,The__Programmers__View scripts,Program__Filesprogram__units,Python__sCore__ObjectTypes__programming-in-the-large,It__sPowerful__programs,Part__I,Getting__Started exercise,Test__Your Knowledge:Part__IExercises__module files,Program__Files modules,The__PythonConceptual__Hierarchy prompts,interactive__coding,What__Notto__Type:Prompts__and Comments,Why__theInteractive__Prompt?-Testing properties, Properties:Attribute__Accessors, Properties,Management__TechniquesCompared__attribute fetches,The__Basics attributes,Property__basicscomputing__value,Computed__Attributes creating,The__Basics decorators,Coding__Propertieswith__Decorators deleters,Setter__anddeleter__decorators setters,Setter__anddeleter__decoratorsdescriptors__and,How__Propertiesand__Descriptors Relate-Descriptorsand__slotsand__more inheritance,A__FirstExample__objects,class__statement,Property__basics prototyping,Rapid__Prototypingpseudoprivate__attributes,Pseudoprivate__Class Attributes-WhyUse__Pseudoprivate Attributes?pseudoprivate__naming,Listing__instanceattributes__with__dict____PVM (PythonVirtual__Machine),The__PythonVirtual__Machine (PVM),Test__Your Knowledge:Answers__.py suffix,Module__Filenames py2wasm,Internet__andWeb__Scripting .pyc files,Bytecode__compilation PyCharm,Other__IDEsfor__Python PyDev,Other__IDEsfor__Python Pydoc,Getting__Help,Python__DocumentationSources__browser mode,Using__Pydocs__browser interface-UsingPydoc__sbrowser__interface built-in tools,Running__helpon__built-in tools-Runninghelp__on built-intools__imported modules,More__Pydoctips__module-index page,Using__Pydocs__browserinterface__modules,Running__helpon__yourown__code-Runninghelp__onyour__owncode__Pygments,Beyond__Docstrings:Sphinx__Pyjamas,Internet__andWeb__Scripting pyjnius,Component__Integration Pyodide,Internet__andWeb__Scripting PyPy, OK,but__Whats__the Downside?,Numeric__andScientific__Programming,Python__Implementation Alternatives,Python__Implementation Alternatives,Test__Your Knowledge:Answers__PyQt,GUIs__andUIs__PyScript,Internet__andWeb__Scripting PyScripter,Other__IDEsfor__Python Pyston,Python__ImplementationAlternatives__Pythonon__Android,Using__Pythonon__Android-UsingPython__onAndroid__applications,What__CanI__Dowith__Python?-And More: AI, Games, Images, QA, Excel,Apps__bytecode and, OK,but__Whats__the Downside?code__size,Why__DoPeople__Use Python?current__users,Who__UsesPython__Today?developer__productivity,Why__DoPeople__Use Python?,Developer__Productivity embedding,Other__LaunchOptions__execution speed, OK,but__Whats__the Downside?on__iOS,Using__Pythonon__iOS-UsingPython__oniOS__on Linux,Using__Pythonon__Linux-UsingPython__onLinux__on macOS,Using__Pythonon__macOS-UsingPython__onmacOS__popularity rise,The__PythonUpside__portability,Why__DoPeople__Use Python?as__scripting language,Is__Pythona__ScriptingLanguage__?-IsPython__aScripting__Language ?software__quality,Why__DoPeople__Use Python?,Software__Qualityon__Windows,Using__Pythonon__WindowsCommand__Prompt,Using__Pythonon__Windows-UsingPython__onWindows__IDLE,Using__Pythonon__Windows-UsingPython__onWindows__WSL,Using__Pythonon__WindowsPython__Virtual Machine,The__PythonVirtual__Machine (PVM),Test__Your Knowledge:Answers__Python/Java bridges,Component__IntegrationPYTHONPATH__directory, Search-PathComponents__configurationsearch__path,Configuring__theSearch__Path PyThran,Numeric__andScientific__Programming,Python__ImplementationAlternatives__pywin32,Component__Integration PyYAML,Database__AccessQ__qualification,attribute__names,Attribute__Name Qualification-AttributeName__Qualificationquality__assurance applications,And__More: AI, Games, Images, QA, Excel,Apps__queuesFIFO__(first-in-first-out),Recursion__versusqueues__andstacks__recursion,Recursion__versusqueues__and stacks-Recursionversus__queuesand__stacksquote__charactersin__strings,Other__Waysto__CodeStrings__R__radd____method, Right-SideAddition____add__ reuse,Reusing____add__in____radd__raise__statement,The__raise Statement,Breaking__Outof__MultipleNested__Loops:go__toexcept__block, scopes,Scopes__andexcept__as-Scopesand__exceptas__except clause,The__exceptas__hook-Theexcept__ashook__exception propagation,Propagating__Exceptionswith__raisefrom__clause,Exception__Chaining:raise__from-Exception Chaining:raise__fromrandom__module,Numbers__rangeobject__counter loops,Counter__Loops: range-Counter Loops:range__iteration protocol, Reprise: Dictionaries, range, enumerate,and__zip lists,Changing__Lists:range__and Comprehensions-Changing Lists:range__andComprehensions__sequence reordering,Sequence__Shufflers:range__andlen__sequence scans,Sequence__Scans: while, range,and__for-Sequence Scans: while, range,and__forskipping__items,Skipping__Items:range__andSlices__range-testing decorator,A__Basic Range-TestingDecorator__forPositional__Arguments-DecoratorArguments__VersusFunction__Annotationsrational__numbers,Numbers__raw bytes,Coding__UnicodeStrings__inPython__raw strings, Example:Rolling__YourOwn__Print docstrings, User-defineddocstrings__escapesequences__and,Raw__StringsSuppress__Escapes-RawStrings__SuppressEscapes__re module, pattern-matching,The__re Pattern-MatchingModule__read-only descriptors, Read-only descriptors-Read-onlydescriptors__readability,Why__DoPeople__Use Python?record__factories,Step__2:Adding__BehaviorMethods__recursion, Comparisons, Equality,and__Truth,Part__V,Modules__andPackages__arbitrary structures,Handling__ArbitraryStructures__testing,Testing__witha__separate script-Testingwith__aseparate__script cycles, Cycles, paths,and__stacklimits__direct,Coding__Alternativesfrom__imports,Recursive__fromImports__MayNot__Work-Recursivefrom__ImportsMay__NotWork__functions,Part__IV,Functions__andGenerators__ifelse__expression,Coding__Alternatives-CodingAlternatives__indirect,Coding__Alternativeslocal__variables,Scopes__Overviewversus__loop statements,Loop__StatementsVersus__Recursion-LoopStatements__VersusRecursion__paths, Cycles, paths,and__stacklimits__queues,Recursion__versusqueues__and stacks-Recursionversus__queuesand__stacksstack__limits, Cycles, paths,and__stacklimits__stacks,Recursion__versusqueues__and stacks-Recursionversus__queuesand__stackssum__function,Summation__with Recursion-Summationwith__Recursionreduce__function,Combining__Itemsin__Iterables: reduce-CombiningItems__in Iterables:reduce__redundancy classes, OOP:The__BigPicture__increase in,The__PythonTsunami__modules,Why__Use Modules? removing,Coding__Methodsreference__counts,Nesting__Revisited references,References__Versus Copies-ReferencesVersus__Copies built-in types,Assignment__Creates References,Not__Copies lists,Lists__names,Name__Resolution:The__LEGBRule__nested scopes,Nested__ScopesOverview__shared,Shared__Referencesargument__passing,Arguments__andShared__References-Argumentsand__SharedReferences__equality,Shared__Referencesand__Equality-SharedReferences__andEquality__in-place changes,Shared__Referencesand__In-Place Changes-SharedReferences__and In-PlaceChanges__multiple-target assignments, Multiple-targetassignment__andshared__references-Multiple-targetassignment__andshared__references variables, Variables, Objects,and__Referencesrelative__imports,Relative__andAbsolute__Imports,Python__ImportModels__relativemagnitude__comparisons, Comparisons, Equality,and__Truthreload__function,Reloading__Modules-reloadOdds__andEnds__from imports,reload__MayNot__Impactfrom__Importsinteractive__testing and, reload, from,and__InteractiveTesting__reloading modules, Example:Transitive__ModuleReloads__OOP,Classes__GenerateMultiple__InstanceObjects__recursive coding,Alternative__codings-Alternativecodings__recursive reloaders,A__recursive reloader-Arecursive__reloader testing,Testing__recursive reloads-Testingrecursive__reloadsreload__variants,Testing__reload variants-Testingreload__variants repetition,The__PythonConceptual__Hierarchyreplace__method,Changing__Strings,Part__2:String__Methods,Changing__Strings,Part__2:String__MethodsREPLs__(real-eval-print loops)code__folders,Where__to Run:Code__Folders-Whereto__Run:Code__Folders f-string literal, F-stringformatting__basics IPython,Other__PythonREPLs__preloading tools, Example:Listing__Moduleswith____dict__ starting,Starting__anInteractive__REPL-Startingan__InteractiveREPL____repr__ method,String__Representation:__repr____and__str____reservedwords__invariable__naming,Variable__NameRules__REST,Component__IntegrationreStructuredText__markup language,Beyond__Docstrings:Sphinx__return statement,Basic__Function Tools,return__Statements returns, none,Functions__Withoutreturns__runtime declarations,Usage__function decorators,Usage__runtimeoperations__imports,How__ImportsWork__module imports,Imports__AreRuntime__AssignmentsS__sandbox,The__PythonSandbox__scientific programming,Numeric__andScientific__Programming SciPy,Numeric__andScientific__Programming scopes,Python__Scopes Basics,Scopes__inMethods__and Classes-Scopesin__Methodsand__Classesargument__defaults and,Scopes__andArgument__Defaults-LoopsRequire__Defaults,Not__Scopes built-ins,The__Built-inScope__LEGB rule,Redefining__built-in names:For__betteror__worse-Redefining built-in names:For__betteror__worsecomprehension__variables,Scopes__andcomprehension__variables-Scopesand__comprehensionvariables__comprehensions,loop__variables, Preview:Other__Pythonscopes__cross-file changes,Program__Design:Minimize__Cross-File Changes-Program__Design:Minimize__Cross-FileChanges__enclosing,Enclosing__scopesand__loop variables,Implementation__functions,Enclosing__scopesand__loopvariables__stateretention__and,State__retentionand__enclosingscopes__examples,Scopes__Examples-ScopesExamples__exception variables, Preview:Other__Pythonscopes__exceptions,Scopes__andexcept__as-Scopesand__exceptas__global scopes,Scopes__Overviewglobal__statement emulation,Other__Waysto__Access Globals-OtherWays__toAccess__Globalsglobal__variables,program__design,Program__Design:Minimize__Global Variables-Program Design:Minimize__GlobalVariables__global,state__retention and, Globals:Changeable__butShared__lexical scoping,Python__Scopes Basics,Imports__VersusScopes__local scopes,Scopes__Overviewmodules__imports and,How__FilesGenerate__Namespaces variables,Imports__Versus Scopes-ImportsVersus__Scopesnamed__assignments, Preview:Other__Pythonscopes__nested class,Nested__Classes:The__LEGBScopes__Rule Revisited-Nested Classes:The__LEGBScopes__RuleRevisited__nested scopes,Nested__Scopes Examples-NestedScopes__Examplesarbitrary__nesting,Arbitrary__ScopeNesting__name assignments,Nested__ScopesOverview__name references,Nested__ScopesOverview__per-call scopes,Scopes__Overview script1.py,A__First Script-AFirst__Scriptscripting__server-side scripting,Internet__andWeb__Scriptingweb__scripting,Internet__andWeb__Scriptingscripting__language,Is__Pythona__ScriptingLanguage__?control__language and,Is__Pythona__ScriptingLanguage__?ease__ofuse__and,Is__Pythona__ScriptingLanguage__?shell__tools and,Is__Pythona__ScriptingLanguage__? scripts,Program__Files,Part__I,Getting__Started exercise,Test__Your Knowledge:Part__IExercises__web servers,Other__LaunchOptions__search tables,Why__Use Built-in Objects?searches____init__.py files,The__Rolesof____init__.pyFiles__lists,Test__Your Knowledge:Answers__packages,Packages__andthe__ModuleSearch__Path selection,The__PythonConceptual__Hierarchy__self____attribute,Why__UsePseudoprivate__Attributes?semicolons__in statements,Test__Your Knowledge:Part__II Exercises, End-of-lineis__endof__statementsend__method,Extended__generatorfunction__protocol:send__versusnext__sequence,The__PythonConceptual__Hierarchysequence__assignments,Assignment__Syntax Forms,Sequence__Assignments-Advanced__sequence-assignmentpatterns__sequence operations,Changing__StringsPart__1:Sequence__Operations,Changing__StringsPart__1:Sequence__Operations,Test__Your Knowledge:Answers__arbitrary expressions,Sequence__Operationsbyte__strings,Sequence__Operations-Formattingindexing__expressions,Sequence__Operationslist__comprehensions, Conversions, methods,and__immutability lists,Sequence__Operationssequence__patterns,Advanced__matchUsage__sequencescans__for loop,Sequence__Scans: while, range,and__for-Sequence Scans: while, range,and__forrange__object,Sequence__Scans: while, range,and__for-Sequence Scans: while, range,and__forwhile__loop,Sequence__Scans: while, range,and__for-Sequence Scans: while, range,and__for sequences,Test__Your Knowledge:Answers__dictionaries,Dictionary__UsageTips__for loops,Tuple__(sequence)assignment__infor__loops-Tuple (sequence)assignment__infor__loops lists,Types__ShareOperation__Setsby__Categories permutation,Permutating__Sequences-Whygenerators__here: Space, time,and__more reordering,Sequence__Shufflers:range__andlen__slicing,Scrambling__Sequences functions,Simple__functionsgenerator__expressions,Generator__expressionsgenerator__functions,Generator__functions-Generatorfunctions__tester,Tester__client strings,String__Object Basics,Types__ShareOperation__Setsby__Categories tuples,Types__ShareOperation__Setsby__Categories,Tuple__syntax peculiarities:Commas__andparentheses__virtual sequences,Iterations__zip object,Parallel__Traversals: zip-Morezip__roles:dictionaries__serializationjson__module,The__pickleand__jsonSerialization__Modules-Thepickle__andjson__SerializationModules__objects,Storing__Objectswith__picklepickle__module,The__pickleand__jsonSerialization__Modules-Thepickle__andjson__SerializationModules__server-side scripting,Internet__andWeb__Scriptingset__comprehensions,Comprehensions__versustype__callsand__generators syntax,Formal__ComprehensionSyntax__set function,Sets____set__ method,Inserting__Codeto__Runon__AttributeAccess____setattr__ method,Attribute__Assignmentand__Deletion-AttributeAssignment__and Deletion,Inserting__Codeto__Runon__AttributeAccess____setitem__ method,Indexing__and Slicing:__getitem____and __setitem__,Intercepting__ItemAssignments__sets, Numbers, Sets-Sets,Test__Your Knowledge: Answers,Core__TypesReview__andSummary__comparisons, Comparisons, Equality,and__Truth dictionaries,Dictionary__viewsand__sets-Dictionaryviews__andsets__shared objects,Shared__Referencesshared__references,Shared__Referencesargument__passing,Arguments__andShared__References-Argumentsand__SharedReferences__equality,Shared__Referencesand__Equality-SharedReferences__andEquality__in-place changes,Shared__Referencesand__In-Place Changes-SharedReferences__and In-PlaceChanges__multiple-target assignments, Multiple-targetassignment__andshared__references-Multiple-targetassignment__andshared__referencesShed__Skin,Python__Implementation Alternatives,Test__Your Knowledge:Answers__shellprograms__command line, Command-LineUsage__Variationsstream__redirection, Command-LineUsage__Variationsshell__tools,Is__Pythona__ScriptingLanguage__?,Systems__Programming shell-command streams,Other__FileTools__shelve module,Pickles__and Shelves,The__shelvemodule__object storage,Storing__Objectson__ashelve__Database-ExploringShelves__Interactively updates,Updating__Objectson__aShelf__shelves,Other__File Tools,Stream__ProcessorsRevisited__shipping,Development__Toolsfor__LargerProjects__single-scan iteration,Single__versusmultiple__scans site-packages directory, Search-PathComponents__slice assignments,Test__Your Knowledge: Answers,Index__andslice__assignments-Index__andslice__assignments,Other__ListOperations__slice expressions,Intercepting__Slices-InterceptingSlices__slice objects,Intercepting__Slices slices,Classes__versusslices__cleanup and,Extended__slicing:The__thirdlimit__andslice__objectsskipping__items,Skipping__Items:range__andSlices__slicing,Sequence__Operations,String__Object Basics,Test__Your Knowledge:Part__II Exercises,Part__II,Objects__andOperations__lists,Indexing__and Slicing-Indexingand__Slicingout__of bounds,Test__Your Knowledge:Part__IIExercises__parsing,Indexing__andSlicing__sequences,Scrambling__Sequences functions,Simple__functionsgenerator__expressions,Generator__expressionsgenerator__functions,Generator__functions-Generatorfunctions__tester,Tester__client strings,Indexing__and Slicing-Extended slicing:The__thirdlimit__andslice__objectsextended__slicing,Extended__slicing:The__thirdlimit__andslice__objects slots, Classes:Under__the Hood,Namespace__Dictionaries: Review, Slots:Attribute__Declarations class-level defaults,Slot__usagerules__declaring,Slot__basics descriptors,Descriptors__andslots__andmore__generic programs,Handling__slotsand__othervirtual__attributesgenerically__ListTree class,Example__impactsof__slots:ListTree__and mapattrs-Exampleimpacts__of slots:ListTree__andmapattrs__multiple inheritance,Slot__usagerules__multipleinheritance__classes,Example__impactsof__slots:ListTree__andmapattrs__namespacesdictionaries__and,Slot__basics-Slotsand__namespacedictionaries__single-inheritance trees,Example__impactsof__slots:ListTree__andmapattrs__speed,What__aboutslots__speed? subclasses,Slot__usagerules__superclasses,Slot__usagerules__usage rules,You__shouldnt__normallyuse__slots__slots____attribute,Multiple____slot__lists__insuperclasses__smartphone apps,And__More: AI, Games, Images, QA, Excel,Apps__,Smartphone__Apps SOAP,Component__Integration sockets,Other__FileTools__softwarequality__of Python,Why__DoPeople__Use Python?,Software__Qualitysoftware__reuse,Why__DoPeople__Use Python? spaces,indentation__and,Why__Indentation Syntax?special__characters,escape__sequences,Escape__SequencesAre__Special Characters-Escape__SequencesAre__SpecialCharacters__special methods,Static__andClass__Methods (seealso__static methods) special-case syntax,Advanced__matchUsage__Sphinx,Beyond__Docstrings:Sphinx__split method,More__String Methods:Parsing__Text Spyder,Other__IDEsfor__Python SQLAlchemy,Database__Access SQLite,Database__Access SQLObject,Database__Access Stackless,Python__ImplementationAlternatives__standalone executables,Standalone__Executables,Other__Launch Options,Standalone__Appsand__Executables-Etceterastandard__library,Why__DoPeople__Use Python?,It__sPortable__directories,module__search path, Search-PathComponents__methods,All__StringMethods__(Today) modules, Standard-LibraryModules__standard manuals,The__Standard Manuals-WebResources__standardoutput__streams,print__operations,Print__Operationsstandard__streams,Other__FileTools__startup-speed optimization,bytecode__and,Bytecode__compilationstate__descriptors,Using__StateInformation__in Descriptors-UsingState__Informationin__Descriptorsevent__handlers,Function__Interfacesand__Callback-BasedCode__exception classes,Exception__Objects exceptions, built-in,Default__Printingand__State-DefaultPrinting__andState__custom,Custom__Stateand__Behavior-ProvidingException__Methods instances,Using__StateInformation__inDescriptors__retaining,State__with class-instance attributes-Statewith__functionattributes__classes, Classes: Changeable, Per-Call,OOP__function attributes,Function__Attributes: Changeable, Per-Call,Explicit__-Function Attributes: Changeable, Per-Call,Explicit__global scope, Globals:Changeable__butShared__nonlocal statement, Nonlocals: Changeable, Per-Call,LEGB__scope mutables,Function__Attributes: Changeable, Per-Call,Explicit__suspension,State__suspension-Statesuspension__state information,function__objects,Function__Attributes statements,Introducing__Python Statements-Pythons__Statementsas__expression-based equivalents,How__(Not)to__ObfuscateYour__Python Code-How (Not)to__ObfuscateYour__PythonCode__assignment statements,Python__sStatements__assignments,Assignment__SyntaxForms__async,Advanced__FunctionTools__await,Advanced__FunctionTools__class, User-Defined Objects, OOP:The__Big Picture,The__classStatement__attributes, Example:Class__Attributes-Example:Class__Attributes syntax,General__Syntaxand__Usage-GeneralSyntax__andUsage__compound statements,Missing__Keys:if__Tests,What__Python Adds,if__andmatch__Selectionsconcept__hierarchy,The__PythonConceptual__HierarchyRevisited__def,Basic__Function Tools,def__Statements,def__Executesat__Runtime,Calls__executable from,Imports__AreRuntime__Assignments import,Imports__AreRuntime__Assignmentsexpression__statements,Expression__Statements-ExpressionStatements__expressions in,The__PythonConceptual__Hierarchy for,Basic__Operations from,The__fromStatement__potential problems,Potential__Pitfallsof__thefrom__Statement-Whenimport__isrequired__from *,The__from * Statement-Thefrom__*Statement__function-related,Function__Basics global,Advanced__FunctionTools__namespaces,The__global Statement-Theglobal__Statementif__statements,A__Taleof__Two ifs,if__Statements multiple-choice selections, Multiple-Choice Selections-Handlinglarger__actions if/then/else,The__if/elseTernary__Expression-The if/elseTernary__Expression import,The__import Statement-Theimport__Statement indentation,Why__Indentation Syntax?-WhyIndentation__Syntax?interactive__loops,A__SimpleInteractive__Loop-NestingCode__ThreeLevels__Deepmatch__statements,Missing__Keys:if__Tests,match__Statementsattribute__patterns,Advanced__matchUsage__if statements,Match__versusif__liveinstance__patterns,Advanced__matchUsage__literal patterns,Advanced__matchUsage__mapping patterns,Advanced__matchUsage__nested patterns,Advanced__matchUsage__nesting,Basic__matchUsage__parentheses,Advanced__matchUsage__sequence patterns,Advanced__matchUsage__module imports,How__FilesGenerate__Namespacesnested__statements blocks,What__PythonAdds__special cases,Block__rulespecial__case-Blockrule__specialcase__nonlocal,Advanced__Function Tools,The__nonlocal Statement-nonlocalBoundary__Cases order,Statement__OrderMatters__in Top-Level Code-StatementOrder__Mattersin__Top-LevelCode__parentheses,Parentheses__areoptional__raise,Breaking__Outof__MultipleNested__Loops:go__to return,Basic__Function Tools,return__Statements semicolon,Test__Your Knowledge:Part__IIExercises__semicolons, End-of-lineis__endof__statementspecial__cases rules,Statement__rulespecial__cases-Statementrule__specialcases__syntax,Python__s Statements,Python__SyntaxRevisited__blocks,Block__Delimiters:Indentation__Rules delimiters,Statement__Delimiters:Lines__andContinuations__indentation,Block__Delimiters:Indentation__Rules-Avoidmixing__tabsand__spacesspecial__syntax,Special__SyntaxCases__in Action-SpecialSyntax__Casesin__Actiontruth__values,Truth__Values Revisited-TruthValues__Revisited try,Handling__Errorswith__try Statements-HandlingErrors__withtry__Statements yield,Advanced__Function Tools,Iteration__protocolintegration__static methods,Other__Method-Call Possibilities,Static__andClass__Methods,Why__theSpecial__Methods?,Using__Staticand__ClassMethods__alternatives,Static__MethodAlternatives__instance counting,Counting__Instanceswith__Static Methods-CountingInstances__withStatic__Methodsstaticmethod__function,Using__Staticand__ClassMethods__statisticallynested__scopes,Nested__Functionsand__Scopes (seealso__nested scopes) stdout,Test__Your Knowledge:Answers__STEM (science, technology, engineering,and__math),Why__DoPeople__Use Python?storage__class,Miscellaneous__ClassGotchas__objectsCSV__module,Storing__Objectswith__OtherTools__JSON,Storing__Objectswith__JSON-StoringObjects__withJSON__pickle module,Storing__Objectswith__pickle-StoringObjects__withpickle__struct module,Storing__Objectswith__OtherTools__per-instance,Miscellaneous__ClassGotchas__str function,Numbers____str__ method,Why__TwoDisplay__Methods?-DisplayUsage__Notesstr__object,The__strObject__stream processors, composition,Stream__ProcessorsRevisited__streams redirection, shells, Command-LineUsage__Variationsshell__command,Other__FileTools__string formatting,String__Formatting:The__Triathlon,Formatting__expressions, String-FormattingOptions__advanced,Advanced__formattingexpression__examplescustom__formats,Formatting__expressioncustom__formats-Formattingexpression__customformats__dictionary-based, Dictionary-basedformatting__expressions-Dictionary-based__formattingexpressions__format method, String-Formatting Options,The__String-FormattingMethod__advanced,Advanced__formattingmethod__examples-Advancedformatting__methodexamples__attributes,Adding__keys, attributes,and__offsetsbinary__formats,Advanced__formattingmethod__examplescustom__formats,Formatting__methodcustom__formats-Formattingmethod__customformats__f-string literal,The__F-StringFormatting__Literal-Advanced f-stringexamples__floating-point numbers,Advanced__formattingmethod__examplesformatspec__component,Formatting__methodcustom__formats-Formatting__methodcustom__formatshex__formats,Advanced__formattingmethod__examples keys,Adding__keys, attributes,and__offsetsoctal__formats,Advanced__formattingmethod__examples offsets,Adding__keys, attributes,and__offsetssubstitution__targets,Formatting__methodcustom__formats literals, String-FormattingOptions__manual, String-FormattingOptions____repr__ method,String__Representation:__repr____and __str__-DisplayUsage__Notes__str____method,String__Representation:__repr____and __str__-DisplayUsage__Notesstring__indexing,Test__Your Knowledge:Part__II Exercises,Part__II,Objects__andOperations__string interpolation,The__F-StringFormatting__Literalstring__literals,Literals__andBasic__Properties-Literalsand__BasicProperties__backslashescape__sequences and,Other__Waysto__CodeStrings__docstrings,Docstrings__and__doc____format,String__Literals operations,String__ObjectBasics__quotes,Single__andDouble__QuotesAre__the Same-Singleand__DoubleQuotes__Arethe__Same UTF-8 encoding, Source-FileEncoding__Declarationsstring__methods,String__Methods,Changing__Strings,Part__2:String__Methods find,Changing__Strings,Part__2:String__Methods join,Changing__Strings,Part__2:String__Methodsmethod__calls, syntax,Method__CallSyntax__parsing text,More__String Methods:Parsing__Text replace,Changing__Strings,Part__2:String__Methods,Changing__Strings,Part__2:String__Methods split,More__String Methods:Parsing__Textsubstring__test,Other__CommonString__Methods whitespace,Other__CommonString__Methodsstring__objects,The__raiseStatement__stringrepresentation__methods,String__Representation:__repr____and __str__-Display__UsageNotes__strings,Test__Your Knowledge: Answers,String__Fundamentals,Types__ShareOperation__Setsby__Categories,Using__Filesas__immutable sequences,String__ObjectBasics__backslash characters,Escape__SequencesAre__Special Characters-EscapeSequences__AreSpecial__Charactersbackslash__escape,Other__Waysto__CodeStrings__block strings,Triple__Quotesand__Multiline Strings-TripleQuotes__andMultiline__Stringscharacter__arrays and,String__ObjectBasics__code points,Escape__SequencesAre__SpecialCharacters__combining,String__ObjectBasics__comparisons,String__comparisons, Comparisons, Equality,and__Truth concatenation,String__Object Basics,Single__andDouble__QuotesAre__the Same,Basic__Operations conversion,String__ConversionTools__character-code, Character-codeconversions__floating-point numbers,String__ConversionTools__stringsto__numbers,String__ConversionTools__delimiter,Changing__Strings,Part__2:String__Methods docstrings,Triple__Quotesand__MultilineStrings__empty,Files__inAction__escape characters,Escape__SequencesAre__Special Characters-EscapeSequences__AreSpecial__Characters expressions,String__ObjectBasics__fetchingby__offset,String__ObjectBasics__help resources,Getting__Help-GettingHelp__immutability, Immutability-Immutability indexing,String__Object Basics,Indexing__and Slicing-Extended slicing:The__thirdlimit__andslice__objects iteration,Basic__Operationsloops__and,Basic__Operations methods, Type-Specific Methods-Type-Specific Methods,String__ObjectBasics__modules,String__ObjectBasics__multiline,Triple__Quotesand__Multiline Strings-TripleQuotes__andMultiline__Stringsnewline__characters,Escape__SequencesAre__SpecialCharacters__NULL character,Escape__SequencesAre__SpecialCharacters__operations,Basic__Operations-BasicOperations__operatoroverload__and,Basic__Operationspolymorphism__and,Basic__Operationsquote__characters,Other__Waysto__CodeStrings__raw,Raw__StringsSuppress__Escapes-RawStrings__SuppressEscapes__section extraction,String__ObjectBasics__sequence operations,Changing__StringsPart__1:Sequence__Operations-Changing__StringsPart__1:Sequence__Operationsarbitrary__expressions,Sequence__Operationsindexing__expressions,Sequence__Operations sequences,String__ObjectBasics__slicing,String__Object Basics,Indexing__and Slicing-Extended slicing:The__thirdlimit__andslice__objectsextended__slicing,Extended__slicing:The__thirdlimit__andslice__objectssplit__method,Storing__Objectswith__Conversionsstrip__method,Storing__Objectswith__Conversions substrings,testing__for,Other__CommonString__Methodstext__strings,Unicode__Strings triple-quotes,Triple__Quotesand__Multiline Strings-TripleQuotes__andMultiline__Strings Unicode,Unicode__Strings,String__Fundamentalsstruct__module,Test__Your Knowledge:Answers__binary data,The__struct Binary-DataModule__object storage,Storing__Objectswith__OtherTools__structuralpattern__matching,match__Statements__sub____method,operator__overloading,Constructors__and Expressions:__init____and__sub____subclasses,Classes__AreCustomized__byInheritance__metaclasses,Metaclasses__AreSubclasses__oftype__slots,Slot__usagerules__subclassing,Coding__Subclasses,Part__VI,Classes__andOOP__built-intypes__extension,Extending__Typesby__Subclassing-ExtendingTypes__bySubclassing__extending code, Inherit, Customize,and__Extend hierarchies, OOP:The__BigIdea__inheritance, Inherit, Customize,and__Extend,The__InheritanceBifurcation__instances,namespace__dictionaries,Namespace__Dictionaries:Review__methods,Augmenting__Methods:The__Bad Way-Augmenting Methods:The__GoodWay__polymorphism,Polymorphism__in Action-Polymorphismin__Actionsubprime__code,Loop__else subroutines,Why__Use Functions? substrings,testing__for,Other__CommonString__Methodssum__function,recursion__and,Summation__with Recursion-Summationwith__Recursionsuper__built-in function,Augmenting__Methods:The__GoodWay__super function,The__super Function,The__supersupplement__argument lists,Same__argument lists-Sameargument__lists attribute-fetch algorithm, Attribute-fetchalgorithm__call-chain anchors, Call-chain anchors-Call-chainanchors__cooperatormethod__dispatch, Call-chain anchors-Call-chainanchors__deployment,Universal__deploymentMRO__algorithm,A__magic proxy-Amagic__proxy noncalls,Noncalls__andoperator__overloading-Noncallsand__operatoroverloading__operator overloading,Noncalls__andoperator__overloading-Noncallsand__operatoroverloading__superclasses,Attribute__Inheritance Search,Classes__AreCustomized__byInheritance__abstract,Abstract__Superclasses-Preview:Abstract__superclasseswith__library tools,Stream__ProcessorsRevisited__library tools, Preview:Abstract__superclasseswith__librarytools__constructors,Step__5:Customizing__Constructors, Too,Miscellaneous__ClassGotchas__exception superclass,Coding__ExceptionsClasses__exceptions,Exception__Classesinterfacing__with,Class__Interface Techniques-ClassInterface__Techniquesmetaclasses__comparison,Metaclass__Versus Superclass-MetaclassVersus__Superclassmethod__calls,Specializing__InheritedMethods__operatoroverloading__method coding, Workaround:Coding__operator-overloading__methodsin__superclasses-Workaround:Coding__operator-overloading__methodsin__superclasses slots,Slot__usagerules____slots__ attribute,Multiple____slot__lists__insuperclasses__support,Why__DoPeople__Use Python? SWIG,Component__Integrationsyntactic__nesting,exception__handlers, Example:Syntactic__Nesting-Example:Syntactic__Nestingsyntax__argument matching,Argument__Matching Syntax-ArgumentMatching__Syntax assignments,Application__tofor__loopsclass__statement,General__Syntaxand__Usage-GeneralSyntax__andUsage__combined clauses,try__statement, Combined-clausesyntax__rulescompound__statements,What__PythonAdds__comprehension syntax,Comprehensions__andGenerations__decorators,Why__Decorators?dictionary__comprehensions,Formal__ComprehensionSyntax__dotted-path,Package__Imports,Using__thebasic__packagerelative__imports, Relative-ImportRationales__and Trade-Offsfunction__decorator,Property__basicsfunction__decorators,Usage__instance generation,Classes__AreTypes__AreClasses__lambda expression,lambda__Basicslist__comprehensions, formal,Formal__ComprehensionSyntax__method calls,Method__CallSyntax__set comprehensions,Formal__ComprehensionSyntax__special-case,Advanced__matchUsage__statements,Python__s Statements,Python__SyntaxRevisited__blockrule__special cases,Block__rulespecial__case-Blockrule__specialcase__blocks,Block__Delimiters:Indentation__Rules-Avoidmixing__tabsand__spaces delimiters,Statement__Delimiters:Lines__andContinuations__indentation,End__ofindentation__isend__of block-WhyIndentation__Syntax?,Block__Delimiters:Indentation__Rules-Avoidmixing__tabsand__spacesnested__statement blocks,What__PythonAdds__parentheses,Parentheses__areoptional__semicolons, End-of-lineis__endof__statementspecial__cases rules,Statement__rulespecial__cases-Statementrule__specialcases__special syntax,Special__SyntaxCases__in Action-SpecialSyntax__Casesin__Action tuples,Tuple__syntax peculiarities:Commas__and parentheses-Tuplesyntax__peculiarities:Commas__andparentheses__variable names,Variable__NameRules__sys.exc_info,More__on sys.exc_info-The sys.exceptionalternative__anddiss__sys.platform,A__FirstScript__systems programming,Systems__ProgrammingT__tabs,indentation__and,Why__Indentation Syntax? templates,Internet__andWeb__Scripting replacements,Changing__Strings,Part__2:String__Methodstermination__actions try/finally and, Example:Coding__terminationactions__with try/finallywith__statement,The__withStatement__andContext__Managerstermination__handlers,The__Termination-Handlers Shoot-Out-The Termination-Handlers__Shoot-Outtestdriver__function,Running__In-ProcessTests__tester,slicing__sequences,Tester__client testing,And__More: AI, Games, Images, QA, Excel,Apps__class creation,Testing__asYou__Go-Testingas__YouGo__comparisons, Comparisons, Equality,and__Truth-Dictionarycomparisons__equality, Comparisons, Equality,and__Truth in-process tests, exceptions,Running__In-ProcessTests__interactive tests,Test__Your Knowledge:Part__IIExercises__user input,error__handling,Handling__Errorsby__Testing Inputs-HandlingErrors__byTesting__Inputstesting__tools,Development__Toolsfor__LargerProjects__text editors,Other__LaunchOptions__BOM (byteorder__marker),Making__BOMsin__Text Editors-MakingBOMs__inText__Editors indentation,Why__Indentation Syntax?text__files,Text__andBinary__Files:The__Short Story-Textand__Binary Files:The__Short Story,Text__andBinary__Files-Textand__BinaryFiles__binary mode,Text__andBinary__Modesbytes__object,Text__andBinary__Modes conversions,Storing__Objectswith__Conversions-StoringObjects__withConversions__iterators,Using__Fileslines__comparison,The__Termination-Handlers Shoot-Out pathname, Text-FileBasics__text mode,Text__andBinary__Modesnewline__character,Text__andBinary__ModesUnicode__text files, Unicode-Text Files-Unicode-TextFiles__textoutput__file,Files__textstrings__literals,Literals__andBasic__Properties-Literalsand__BasicProperties__non-ASCII characters,Unicode__Stringstype__conversions,String__Type Conversions-StringType__ConversionsUnicode__code-points,Unicode__StringsUnicode__text,Coding__UnicodeStrings__in Python-CodingUnicode__Stringsin__Python text-modefiles__BOM headers,Using__Textand__BinaryFiles__newline character,Text__andBinary__Modestextual__data,Introducing__PythonString__Tools third-party domain,Why__DoPeople__Use Python? third-party utilities,It__sPowerful__timeitmodule__API-calls mode, API-callsmode__benchmarking automation,Automating__timeitBenchmarking__benchmark module,Benchmark__module -Benchmarkscript__benchmark script,Benchmark__script-Timingindividual__Pythons dictionaries,Timing__setand__dictionary iterations-Conclusion:Comparing__toolsindividual__Pythons,Timing__individual Pythons-Timingindividual__Pythonsmultiple__Pythons,Timing__multiplePythons__sets,Timing__setand__dictionary iterations-Conclusion:Comparing__toolscallable__objects,Basic__timeitUsage__command-line mode, Command-line mode-Command-linemode__multiline statements,Handling__multiline statements-Handlingmultiline__statementssetup__code,Other__timeitusage__modessort__speed,Timing__sort speed-Timingsort__speedstatement__strings,Basic__timeitUsage__timer decorator,Adding__DecoratorArguments__timerutility__functions,Timer__Module:Take__2 timestamp-basedbytecode__files,Step__2:Compile__It (Maybe)timing__tools,Part__IV,Functions__andGenerators__Toga,GUIs__and UIs,Standalone__Appsand__Executablestools__built-in,It__sPowerful__increase in,The__PythonTsunami__toolsets built-in tools,The__PythonToolset__development tools,Development__Toolsfor__LargerProjects__debuggers,Development__Toolsfor__LargerProjects__documentation tools,Development__Toolsfor__LargerProjects__error-checking tools,Development__Toolsfor__LargerProjects__IDEs,Development__Toolsfor__LargerProjects__installation management,Development__Toolsfor__LargerProjects__optimization,Development__Toolsfor__LargerProjects__profilers,Development__Toolsfor__LargerProjects__shipping,Development__Toolsfor__LargerProjects__testing tools,Development__Toolsfor__LargerProjects__extensions,The__PythonToolset__traceback object,Displaying__Errorsand__Tracebacks triple-quoted strings,Triple__Quotesand__Multiline Strings-TripleQuotes__andMultiline__Stringstruth__values,The__Meaningof__Trueand__Falsein__Python-Thebool__type,Truth__Values Revisited-TruthValues__Revisitedtry__statement built-in exceptions, Example:Catching__built-inexceptions__combined clauses,Combined__tryClauses__nesting,Combining__finallyand__exceptby__nesting syntax, Combined-clausesyntax__rules debugging,Debugging__withOuter__try Statements-Debuggingwith__Outertry__Statementsdefault__exception behavior, Example:Default__behaviorelse__clause,The__exceptand__else Clauses-Example:Catching__built-inexceptions__error handling,Handling__Errorswith__try Statements-HandlingErrors__withtry__Statementsexcept__clause,The__exceptand__else Clauses-Example:Catching__built-inexceptions__except* clause,Exception__Groups:Yet__Another Star!-Exception Groups:Yet__Another Star!finally__block,Combined__try Clauses-Combinedtry__Clausesfinally__clause,The__finally Clause-Example:Coding__terminationactions__with try/finally forms,try__StatementClauses__handlers,The__tryStatement__nesting,Nesting__Exception Handlers-NestingException__Handlers tuples,Catching__manyexceptions__witha__tuple try/finally,Combined__try Clauses-Combinedtry__Clauses nesting,Combining__finallyand__exceptby__nesting syntax, Combined-clausesyntax__rules-Combined-clausesyntax__rulestermination__actions and, Example:Coding__terminationactions__with try/finally tuples, Tuples-Why Tuples?,Test__Your Knowledge: Answers,Types__ShareOperation__Setsby__Categories, List-literal unpacking,Using__dictionariesfor__sparsedata__structures:Tuple__keys, Tuples-Tuples,Part__II,Objects__andOperations__assignments,Assignment__SyntaxForms__commas,Tuple__syntax peculiarities:Commas__and parentheses-Tuplesyntax__peculiarities:Commas__andparentheses__commasin__expressions,Test__Your Knowledge:Part__IIExercises__comparedto__lists,Why__Listsand__Tuples? conversions, Conversions, methods,and__immutability-Conversions, methods,and__immutabilityconverting__from dictionaries,Records__Revisited:Named__Tuplesfor__loops,Tuple__(sequence)assignment__infor__loops-Tuple (sequence)assignment__infor__loops generating,Test__Your Knowledge:Answers__immutability, Conversions, methods,and__immutability-Conversions, methods,and__immutability methods, Conversions, methods,and__immutability-Conversions, methods,and__immutability named,Records__Revisited:Named__Tuples-Records Revisited:Named__Tuples parentheses,Tuple__syntax peculiarities:Commas__and parentheses-Tuplesyntax__peculiarities:Commas__andparentheses__sequence assignment,Tuple__syntax peculiarities:Commas__andparentheses__sorting, Conversions, methods,and__immutability syntax,Tuple__syntax peculiarities:Commas__and parentheses-Tuplesyntax__peculiarities:Commas__andparentheses__try statement,Catching__manyexceptions__witha__tuple TurboGears,Internet__andWeb__Scriptingtype__calls, comprehensions,Comprehensions__versustype__callsand__generatorstype__conversions,text__strings,String__Type Conversions-StringType__Conversionstype__function, Types-Typestype__hinting,Type__Hinting,Type__Hinting: Optional, Unused,and__Why?-Type Hinting: Optional, Unused,and__Why?type__objects, Types-Types,Type__Objects built-ins,Other__Typesin__Python type-specific operations, lists, Type-Specific Operations-Type-SpecificOperations__types,It__sPowerful__built-ins, extending,Extending__Typesby__Embeddingclasses__and,The__PythonObject__Model immutable,Mutable__TypesCan__BeChanged__in Place,Test__Your Knowledge:Part__IIExercises__mappings,Types__ShareOperation__Setsby__Categories metaclass/class dichotomy,The__Metaclass/Class Dichotomy-The Metaclass/ClassDichotomy__metaclassesclass__statements,Class__StatementsCall__a type-ClassStatements__CanChoose__atype__instances,Classes__AreInstances__of type-ClassesAre__Instancesof__type subclasses,Metaclasses__AreSubclasses__of type-MetaclassesAre__Subclassesof__type mutable,Mutable__TypesCan__BeChanged__inPlace__numbers,Types__ShareOperation__Setsby__Categoriesobject__types,Types__Livewith__Objects,Not__Variables hierarchy,Python__sType__Hierarchies sequences,Types__ShareOperation__Setsby__Categoriestypes__library module,Type__Objects TypeScript,Type__Hinting typing, dynamic,It__sPowerful__UUIs__(user interfaces),GUIs__andUIs__Unicode,Unicode__andByte__Stringscharacter__encodings,Character__Encodings-CharacterEncodings__character representations,Character__Representations-CharacterRepresentations__code points,Escape__SequencesAre__Special Characters,Character__Representations value,Coding__UnicodeStrings__inPython__code-points,Unicode__Stringsdefault__encoding,Filenames__inopen__andOther__FilenameTools__escapes,Coding__UnicodeStrings__inPython__files,Unicode__andByte__Files-Unicodeand__ByteFiles__normalization,Unicode__Normalization:Whither__Standard?-Unicode Normalization:Whither__Standard?raw__bytes,Coding__UnicodeStrings__inPython__strings,Unicode__Strings,String__Fundamentalscode__points,Unicode__Strings strings, coding,Coding__UnicodeStrings__in Python-CodingUnicode__Stringsin__Pythontext__files, Unicode-Text Files-Unicode-TextFiles__UTF-16,Escape__SequencesAre__SpecialCharacters__union operation, dictionaries,Dictionary__Union Operator,Dictionary__UnionOperator__unit testing,__name____attribute, Example:Unit__Testswith____name__-Example:Unit__Testswith____name__ Unix,Python__installation,Installing__Pythonunpacking__assignments,Assignment__Syntax Forms, Extended-Unpacking Assignments-Extendedunpacking__inaction__boundary cases,Boundary__cases-Boundarycases__for loops,Application__tofor__loopsupdate__method,Missing__Keys:if__Testsusage__mode flags, Dual-Usage Modes:__name____and__main____userinputs__error handling,Handling__Errorsby__Testing Inputs-HandlingErrors__byTesting__Inputs math,Doing__Mathon__User Inputs-DoingMath__onUser__Inputsuser__interfaces (UIs),GUIs__andUIs__user-defined classes,Classes__AreTypes__Are Classes-ClassesAre__TypesAre__Classes user-defined docstrings, User-defined docstrings-User-defineddocstrings__user-defined exceptions,nonerror__conditions,Functions__CanSignal__Conditionswith__raise user-definedfunction__decorators,A__FirstLook__at User-DefinedFunction__Decorators-AFirst__Lookat__User-DefinedFunction__Decorators user-defined iterables, User-Defined Iterables-Multipleiterators__withyield__UTF-16 encoding,Escape__SequencesAre__Special Characters,Character__Encodings,Coding__UnicodeStrings__inPython__UTF-32 encoding,Character__Encodings,Coding__UnicodeStrings__inPython__UTF-8 encoding,Character__Encodings,Filenames__inopen__andOther__FilenameTools__BOM (byteorder__marker),Making__BOMsin__Python-MakingBOMs__inPython__string literals, Source-FileEncoding__Declarationsutilities__library utilities,It__sPowerful__third-party,It__sPowerful__Vvalues__method,Item__Iteration:for__Loops variables,Running__CodeInteractively____all__,Minimizing__from * Damage:_X__and __all__-Minimizingfrom__* Damage:_X__and__all____comprehensions, Preview:Other__Pythonscopes__scopes and,Scopes__andcomprehension__variables-Scopesand__comprehensionvariables__creating, Variables, Objects,and__Referencesfrom__* statement,from__*Can__Obscurethe__Meaningof__Variablesglobal__coupling,Function__DesignConcepts__program design,Program__Design:Minimize__Global Variables-Program Design:Minimize__GlobalVariables__state,decorators__and,State__withglobal__variables imports,Imports__Versus Scopes-ImportsVersus__Scopes local, Segue:Local__Variables-Segue:Local__Variablesstatic__locals,Function__Attributes loops,Enclosing__scopesand__loopvariables__names,Module__Filenames names, case,Variable__NameRules__naming rules,Variable__Name Rules-Nameshave__no type,but__objectsdo__references, Variables, Objects,and__References scope,Python__ScopesBasics__scopes,Imports__Versus Scopes-ImportsVersus__Scopes types, Variables, Objects,and__References use, Variables, Objects,and__Referencesview__objects,Dictionary__key/value/itemview__objects-Dictionary key/value/itemview__objectsvirtual__machines (VMs) (seeVMs__(virtual machines)virtual__sequences,Iterations__visibility,class__attributes, Example:Class__AttributesVMs__(virtual machines),Python__sView__PVM (PythonVirtual__Machine),The__PythonVirtual__Machine (PVM) VSCode,Other__IDEsfor__PythonW__Wasm (WebAssembly),WebAssembly__forBrowsers__web scripting,Internet__andWeb__Scriptingweb__server scripts,Other__LaunchOptions__WebAssembly,GUIs__and UIs,Internet__andWeb__Scriptingwhile__loops,while__Loops-Examplesbreak__statement, break-The named-assignmentalternative__named assignment,The__named-assignmentalternative__break statements, break, continue, pass,and__theLoop__elsecontinue__statement, continue-The nested-codealternative__nested code,The__nested-codealternative__do until,Examples__else,General__Formatelse__clause,Loop__else-Whythe__loop else?interactive__loops,A__SimpleInteractive__Looppass__statement, pass-The ellipsis-literalalternative__ellipsis,The__ellipsis-literalalternative__sequence scans,Sequence__Scans: while, range,and__for-Sequence Scans: while, range,and__for whitespace,Other__CommonString__Methods,End__ofindentation__isend__ofblock__wide-character strings,Character__RepresentationsWindows__directory paths,Files__inAction__interactivecoding__and,Starting__anInteractive__REPLPython__installation,Installing__Python,Using__Pythonon__WindowsPython__on,Using__Pythonon__WindowsCommand__Prompt,Using__Pythonon__Windows-UsingPython__onWindows__IDLE,Using__Pythonon__Windows-UsingPython__onWindows__WSL,Using__Pythonon__Windows Wing,Other__IDEsfor__Pythonwith__statement,The__withStatement__andContext__Managers-Basicwith__Usagecontext__managers, multiple,Multiple__Context Managers-MultipleContext__Managers context-management protocol,The__Context-Management Protocol-The Context-ManagementProtocol__termination actions,The__withStatement__andContext__Managerstermination__handlers,The__Termination-Handlers Shoot-Outworking__directory, commands,Running__Fileswith__CommandLines__wrappers,OOP__and Delegation: Like-a Relationships,What__ShouldBe__Wrappedcall__proxies,Managing__Callsand__Instancesclass__decorators,Managing__Callsand__Instances layers,Decorator__Nesting stacking,Decorator__Nestingwrapping__code, Overwrapping-itisWSL__(WindowsSubsystem__for Linux),Using__Pythonon__Windows wxPython,GUIs__andUIs__X_X__prefix,Minimizing__from * Damage:_X__and __all__-Minimizingfrom__* Damage:_X__and__all______Xpseudoprivate__name mangling,Pseudoprivate__Class Attributes,Using____Xpseudoprivate__names XML-RPC,Component__IntegrationY__yield function,generator__objects,Coding__Alternative:__iter____Plus yield-Multiple__iteratorswith__yieldyield__statement,Advanced__Function Tools,Iteration__protocolintegration__generator functions,The__yieldfrom__extension-Theyield__fromextension__Zzip__function emulating, Example:Emulating__zipand__map-CodingYour__Ownzip__and 2.Xmap__iterables,Coding__YourOwn__zipand__2.Xmap__zip object,Parallel__Traversals: zip-Morezip__roles:dictionaries__iteration protocol, Reprise: Dictionaries, range, enumerate,and__zip ZODB,Database__Access Zope,Internet__andWeb__ScriptingAbout__theAuthor__MarkLutz__isthe__authorof__Pythons__classicand__foundational texts,a__formertrainer__withtwo__decadesof__experienceteaching__Pythonto__newcomers,and__oneof__thepeople__responsiblefor__theprominence__thatPython__enjoys today.Mark__wrotethe__threeO__Reillybooks__Learning Python,Programming__Python,and__PythonPocket__Reference,all__currentlyin__fourth, fifth,or__sixth editions.He__hasbeen__usingand__promotingPython__since 1992,started__writingPython__booksin__1995,and__beganteaching__Pythonclasses__in 1997.All__told,Mark__hastaught__thousandsof__learnerslive__andin__person,and__hispublished__worksspan__12kpages__among 15books__thatcover__Pythons 1.Xthrough__3.X.He__alsohas__BSand__MSdegrees__incomputer__science,work__experiencein__compilersand__other domains,and__acurrent__interestin__Python-coded__appsthat__runon__bothPCs__and phones.For__moreauthor__background,see__Marks__books-and-software website, learning- python.com.Colophon__Theanimal__onthe__coverof__Learning Python,sixth__edition,is__awood__rat (Neotoma muridae).The__woodrat__livesin__awide__rangeof__conditions (mostly rocky, scrub,and__desert areas)over__muchof__Northand__Central America,generally__atsome__distancefrom__humans.Wood__ratsare__good climbers,nesting__intrees__orbushes__upto__sixmeters__offthe__ground;some__speciesburrow__undergroundor__inrock__crevicesor__inhabitother__speciesabandoned__holes.These__grayish-beige, medium-sizerodents__arethe__originalpack__rats:they__carryanything__andeverything__intotheir__homes,whether__ornot__its__needed,and__areespecially__attractedto__shinyobjects__suchas__tin cans, glass,and__silverware.Many__ofthe__animalson__OReilly__coversare__endangered;all__ofthem__areimportant__tothe__world.The__coverillustration__isby__Karen Montgomery,based__ona__19th-centuryengraving__fromCuvier__s Animals.The__seriesdesign__isby__Edie Freedman,Ellie__Volckhausen,and__Karen Montgomery.The__coverfonts__areGilroy__Semiboldand__Guardian Sans.The__textfont__isAdobe__Minion Pro;the__headingfont__isAdobe__Myriad Condensed;and__thecode__fontis__DaltonMaag__sUbuntu__Mono.